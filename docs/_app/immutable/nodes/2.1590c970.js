import{s as $i,n as gl,f as Gs,c as ia,u as sa,g as ra,d as oa,e as no,h as As,i as Gn,j as kv,o as nd,k as kf,l as Hc,m as Mg,p as yz,t as xz,q as bz,b as DM}from"../chunks/scheduler.05fe8c6c.js";import{S as Xi,i as ji,g as ln,e as Uf,y as wz,h as cn,f as Fe,k as Zt,x as gn,z as Mz,a as Yo,d as $e,t as Ye,r as xi,u as bi,v as wi,w as Mi,s as Uv,c as Nv,b as Sg,p as Ag,j as IM}from"../chunks/index.45b2d56e.js";import{e as ob}from"../chunks/transform.3586df06.js";import{w as us,d as Fv,r as Sz}from"../chunks/index.33afaa81.js";function Az(s,t){for(var e=0;e<t.length;e++){const n=t[e];if(typeof n!="string"&&!Array.isArray(n)){for(const i in n)if(i!=="default"&&!(i in s)){const r=Object.getOwnPropertyDescriptor(n,i);r&&Object.defineProperty(s,i,r.get?r:{enumerable:!0,get:()=>n[i]})}}}return Object.freeze(Object.defineProperty(s,Symbol.toStringTag,{value:"Module"}))}function Ez(s,t){const e={},n={},i={$$scope:1};let r=s.length;for(;r--;){const o=s[r],a=t[r];if(a){for(const l in o)l in a||(n[l]=1);for(const l in a)i[l]||(e[l]=a[l],i[l]=1);s[r]=a}else for(const l in o)i[l]=1}for(const o in n)o in e||(e[o]=void 0);return e}function Tz(s){return typeof s=="object"&&s!==null?s:{}}function ab(s,t,e){const n=s.slice();return n[5]=t[e],n}function lb(s){let t,e;return{c(){t=ln("link"),this.h()},l(n){t=cn(n,"LINK",{rel:!0,href:!0,as:!0,type:!0,crossorigin:!0}),this.h()},h(){Zt(t,"rel","preload"),Zt(t,"href",e=s[5]),Zt(t,"as","font"),Zt(t,"type","font/woff2"),Zt(t,"crossorigin","")},m(n,i){Yo(n,t,i)},p(n,i){i&16&&e!==(e=n[5])&&Zt(t,"href",e)},d(n){n&&Fe(t)}}}function Cz(s){let t,e,n,i,r,o,a,l,c,h,f,d,m,g,y,_,v,w,b,M,A,T,P,C,S,L;document.title=t=s[0];let H=ob(s[4]),$=[];for(let B=0;B<H.length;B+=1)$[B]=lb(ab(s,H,B));return{c(){e=ln("meta"),n=ln("meta"),i=ln("meta"),r=ln("meta"),o=ln("meta"),a=ln("meta"),l=ln("meta"),c=ln("meta"),h=ln("meta"),f=ln("meta"),m=ln("meta"),g=ln("meta"),y=ln("meta"),_=ln("meta"),v=ln("meta"),w=ln("meta"),b=ln("meta"),M=ln("meta"),A=ln("meta"),P=ln("meta"),C=ln("link");for(let B=0;B<$.length;B+=1)$[B].c();L=Uf(),this.h()},l(B){const G=wz("svelte-1htu80s",document.head);e=cn(G,"META",{name:!0,content:!0}),n=cn(G,"META",{name:!0,content:!0}),i=cn(G,"META",{name:!0,content:!0}),r=cn(G,"META",{property:!0,content:!0}),o=cn(G,"META",{property:!0,content:!0}),a=cn(G,"META",{property:!0,content:!0}),l=cn(G,"META",{property:!0,content:!0}),c=cn(G,"META",{property:!0,content:!0}),h=cn(G,"META",{property:!0,content:!0}),f=cn(G,"META",{property:!0,content:!0}),m=cn(G,"META",{property:!0,content:!0}),g=cn(G,"META",{property:!0,content:!0}),y=cn(G,"META",{property:!0,content:!0}),_=cn(G,"META",{name:!0,content:!0}),v=cn(G,"META",{name:!0,content:!0}),w=cn(G,"META",{name:!0,content:!0}),b=cn(G,"META",{name:!0,content:!0}),M=cn(G,"META",{name:!0,content:!0}),A=cn(G,"META",{name:!0,content:!0}),P=cn(G,"META",{name:!0,content:!0}),C=cn(G,"LINK",{rel:!0,href:!0});for(let I=0;I<$.length;I+=1)$[I].l(G);L=Uf(),G.forEach(Fe),this.h()},h(){Zt(e,"name","description"),Zt(e,"content",s[1]),Zt(n,"name","author"),Zt(n,"content","The Pudding"),Zt(i,"name","news_keywords"),Zt(i,"content",s[3]),Zt(r,"property","og:title"),Zt(r,"content",s[0]),Zt(o,"property","og:site_name"),Zt(o,"content","The Pudding"),Zt(a,"property","og:url"),Zt(a,"content",s[2]),Zt(l,"property","og:description"),Zt(l,"content",s[1]),Zt(c,"property","og:type"),Zt(c,"content","article"),Zt(h,"property","og:locale"),Zt(h,"content","en_US"),Zt(f,"property","og:image"),Zt(f,"content",d=s[2]+"/assets/social-facebook.jpg"),Zt(m,"property","og:image:type"),Zt(m,"content","image/jpeg"),Zt(g,"property","og:image:width"),Zt(g,"content","1200"),Zt(y,"property","og:image:height"),Zt(y,"content","600"),Zt(_,"name","twitter:card"),Zt(_,"content","summary_large_image"),Zt(v,"name","twitter:site"),Zt(v,"content","https://pudding.cool"),Zt(w,"name","twitter:creator"),Zt(w,"content","@puddingviz"),Zt(b,"name","twitter:title"),Zt(b,"content",s[0]),Zt(M,"name","twitter:description"),Zt(M,"content",s[1]),Zt(A,"name","twitter:image:src"),Zt(A,"content",T=s[2]+"/assets/social-twitter.jpg"),Zt(P,"name","robots"),Zt(P,"content","max-image-preview:large"),Zt(C,"rel","canonical"),Zt(C,"href",S=s[2]+"/")},m(B,G){gn(document.head,e),gn(document.head,n),gn(document.head,i),gn(document.head,r),gn(document.head,o),gn(document.head,a),gn(document.head,l),gn(document.head,c),gn(document.head,h),gn(document.head,f),gn(document.head,m),gn(document.head,g),gn(document.head,y),gn(document.head,_),gn(document.head,v),gn(document.head,w),gn(document.head,b),gn(document.head,M),gn(document.head,A),gn(document.head,P),gn(document.head,C);for(let I=0;I<$.length;I+=1)$[I]&&$[I].m(document.head,null);gn(document.head,L)},p(B,[G]){if(G&1&&t!==(t=B[0])&&(document.title=t),G&2&&Zt(e,"content",B[1]),G&8&&Zt(i,"content",B[3]),G&1&&Zt(r,"content",B[0]),G&4&&Zt(a,"content",B[2]),G&2&&Zt(l,"content",B[1]),G&4&&d!==(d=B[2]+"/assets/social-facebook.jpg")&&Zt(f,"content",d),G&1&&Zt(b,"content",B[0]),G&2&&Zt(M,"content",B[1]),G&4&&T!==(T=B[2]+"/assets/social-twitter.jpg")&&Zt(A,"content",T),G&4&&S!==(S=B[2]+"/")&&Zt(C,"href",S),G&16){H=ob(B[4]);let I;for(I=0;I<H.length;I+=1){const et=ab(B,H,I);$[I]?$[I].p(et,G):($[I]=lb(et),$[I].c(),$[I].m(L.parentNode,L))}for(;I<$.length;I+=1)$[I].d(1);$.length=H.length}},i:gl,o:gl,d(B){Fe(e),Fe(n),Fe(i),Fe(r),Fe(o),Fe(a),Fe(l),Fe(c),Fe(h),Fe(f),Fe(m),Fe(g),Fe(y),Fe(_),Fe(v),Fe(w),Fe(b),Fe(M),Fe(A),Fe(P),Fe(C),Mz($,B),Fe(L)}}}function Pz(s,t,e){let{title:n="Title TK"}=t,{description:i="Description TK"}=t,{url:r="https://pudding.cool"}=t,{keywords:o=""}=t,{preloadFont:a=[]}=t;return s.$$set=l=>{"title"in l&&e(0,n=l.title),"description"in l&&e(1,i=l.description),"url"in l&&e(2,r=l.url),"keywords"in l&&e(3,o=l.keywords),"preloadFont"in l&&e(4,a=l.preloadFont)},[n,i,r,o,a]}class Rz extends Xi{constructor(t){super(),ji(this,t,Pz,Cz,$i,{title:0,description:1,url:2,keywords:3,preloadFont:4})}}var te=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function mu(s){return s&&s.__esModule&&Object.prototype.hasOwnProperty.call(s,"default")?s.default:s}function Lz(s){if(s.__esModule)return s;var t=s.default;if(typeof t=="function"){var e=function n(){return this instanceof n?Reflect.construct(t,arguments,this.constructor):t.apply(this,arguments)};e.prototype=t.prototype}else e={};return Object.defineProperty(e,"__esModule",{value:!0}),Object.keys(s).forEach(function(n){var i=Object.getOwnPropertyDescriptor(s,n);Object.defineProperty(e,n,i.get?i:{enumerable:!0,get:function(){return s[n]}})}),e}var Dz=typeof te=="object"&&te&&te.Object===Object&&te,Iz=typeof self=="object"&&self&&self.Object===Object&&self;Dz||Iz||Function("return this")();/**
 * @license
 * Copyright 2010-2023 Three.js Authors
 * SPDX-License-Identifier: MIT
 */const id="155dev",Oo={LEFT:0,MIDDLE:1,RIGHT:2,ROTATE:0,DOLLY:1,PAN:2},zo={ROTATE:0,PAN:1,DOLLY_PAN:2,DOLLY_ROTATE:3},OM=0,Eg=1,zM=2,Oz=3,zz=0,Bv=1,sd=2,ks=3,Mr=0,oi=1,An=2,kz=2,yr=0,Yr=1,Tg=2,Cg=3,Pg=4,kM=5,$r=100,Hv=101,Vv=102,Rg=103,Lg=104,Gv=200,qv=201,Wv=202,$v=203,rd=204,od=205,Xv=206,jv=207,Yv=208,Zv=209,Kv=210,UM=0,NM=1,FM=2,Nf=3,BM=4,HM=5,VM=6,GM=7,gu=0,qM=1,WM=2,xr=0,$M=1,XM=2,jM=3,Jv=4,YM=5,vu=300,Sr=301,io=302,Vc=303,Gc=304,Rl=306,vl=1e3,In=1001,_l=1002,Ve=1003,Ff=1004,Qv=1004,Oc=1005,t_=1005,fn=1006,e_=1007,n_=1007,so=1008,i_=1008,ai=1009,_u=1010,yu=1011,aa=1012,Ll=1013,ls=1014,Cn=1015,yl=1016,ad=1017,ld=1018,Zr=1020,s_=1021,Vn=1023,cd=1024,ud=1025,Kr=1026,Zo=1027,ZM=1028,r_=1029,KM=1030,o_=1031,a_=1033,wf=33776,Mf=33777,Sf=33778,Af=33779,Dg=35840,Ig=35841,Og=35842,zg=35843,JM=36196,kg=37492,Ug=37496,Ng=37808,Fg=37809,Bg=37810,Hg=37811,Vg=37812,Gg=37813,qg=37814,Wg=37815,$g=37816,Xg=37817,jg=37818,Yg=37819,Zg=37820,Kg=37821,Ef=36492,QM=36283,Jg=36284,Qg=36285,tv=36286,tS=2200,eS=2201,nS=2202,qc=2300,Wc=2301,Tf=2302,Ho=2400,Vo=2401,$c=2402,hd=2500,l_=2501,Uz=0,Nz=1,Fz=2,Xc=3e3,br=3001,iS=3200,sS=3201,lo=0,rS=1,Jr="",ve="srgb",Es="srgb-linear",c_="display-p3",Bz=0,Cf=7680,Hz=7681,Vz=7682,Gz=7683,qz=34055,Wz=34056,$z=5386,Xz=512,jz=513,Yz=514,Zz=515,Kz=516,Jz=517,Qz=518,oS=519,aS=512,lS=513,cS=514,uS=515,hS=516,fS=517,dS=518,pS=519,jc=35044,tk=35048,ek=35040,nk=35045,ik=35049,sk=35041,rk=35046,ok=35050,ak=35042,lk="100",ev="300 es",Bf=1035,Us=2e3,Yc=2001;class Gi{addEventListener(t,e){this._listeners===void 0&&(this._listeners={});const n=this._listeners;n[t]===void 0&&(n[t]=[]),n[t].indexOf(e)===-1&&n[t].push(e)}hasEventListener(t,e){if(this._listeners===void 0)return!1;const n=this._listeners;return n[t]!==void 0&&n[t].indexOf(e)!==-1}removeEventListener(t,e){if(this._listeners===void 0)return;const i=this._listeners[t];if(i!==void 0){const r=i.indexOf(e);r!==-1&&i.splice(r,1)}}dispatchEvent(t){if(this._listeners===void 0)return;const n=this._listeners[t.type];if(n!==void 0){t.target=this;const i=n.slice(0);for(let r=0,o=i.length;r<o;r++)i[r].call(this,t);t.target=null}}}const Xn=["00","01","02","03","04","05","06","07","08","09","0a","0b","0c","0d","0e","0f","10","11","12","13","14","15","16","17","18","19","1a","1b","1c","1d","1e","1f","20","21","22","23","24","25","26","27","28","29","2a","2b","2c","2d","2e","2f","30","31","32","33","34","35","36","37","38","39","3a","3b","3c","3d","3e","3f","40","41","42","43","44","45","46","47","48","49","4a","4b","4c","4d","4e","4f","50","51","52","53","54","55","56","57","58","59","5a","5b","5c","5d","5e","5f","60","61","62","63","64","65","66","67","68","69","6a","6b","6c","6d","6e","6f","70","71","72","73","74","75","76","77","78","79","7a","7b","7c","7d","7e","7f","80","81","82","83","84","85","86","87","88","89","8a","8b","8c","8d","8e","8f","90","91","92","93","94","95","96","97","98","99","9a","9b","9c","9d","9e","9f","a0","a1","a2","a3","a4","a5","a6","a7","a8","a9","aa","ab","ac","ad","ae","af","b0","b1","b2","b3","b4","b5","b6","b7","b8","b9","ba","bb","bc","bd","be","bf","c0","c1","c2","c3","c4","c5","c6","c7","c8","c9","ca","cb","cc","cd","ce","cf","d0","d1","d2","d3","d4","d5","d6","d7","d8","d9","da","db","dc","dd","de","df","e0","e1","e2","e3","e4","e5","e6","e7","e8","e9","ea","eb","ec","ed","ee","ef","f0","f1","f2","f3","f4","f5","f6","f7","f8","f9","fa","fb","fc","fd","fe","ff"];let cb=1234567;const $o=Math.PI/180,xl=180/Math.PI;function qi(){const s=Math.random()*4294967295|0,t=Math.random()*4294967295|0,e=Math.random()*4294967295|0,n=Math.random()*4294967295|0;return(Xn[s&255]+Xn[s>>8&255]+Xn[s>>16&255]+Xn[s>>24&255]+"-"+Xn[t&255]+Xn[t>>8&255]+"-"+Xn[t>>16&15|64]+Xn[t>>24&255]+"-"+Xn[e&63|128]+Xn[e>>8&255]+"-"+Xn[e>>16&255]+Xn[e>>24&255]+Xn[n&255]+Xn[n>>8&255]+Xn[n>>16&255]+Xn[n>>24&255]).toLowerCase()}function yn(s,t,e){return Math.max(t,Math.min(e,s))}function u_(s,t){return(s%t+t)%t}function ck(s,t,e,n,i){return n+(s-t)*(i-n)/(e-t)}function uk(s,t,e){return s!==t?(e-s)/(t-s):0}function zc(s,t,e){return(1-e)*s+e*t}function hk(s,t,e,n){return zc(s,t,1-Math.exp(-e*n))}function fk(s,t=1){return t-Math.abs(u_(s,t*2)-t)}function dk(s,t,e){return s<=t?0:s>=e?1:(s=(s-t)/(e-t),s*s*(3-2*s))}function pk(s,t,e){return s<=t?0:s>=e?1:(s=(s-t)/(e-t),s*s*s*(s*(s*6-15)+10))}function mk(s,t){return s+Math.floor(Math.random()*(t-s+1))}function gk(s,t){return s+Math.random()*(t-s)}function vk(s){return s*(.5-Math.random())}function _k(s){s!==void 0&&(cb=s);let t=cb+=1831565813;return t=Math.imul(t^t>>>15,t|1),t^=t+Math.imul(t^t>>>7,t|61),((t^t>>>14)>>>0)/4294967296}function yk(s){return s*$o}function xk(s){return s*xl}function nv(s){return(s&s-1)===0&&s!==0}function mS(s){return Math.pow(2,Math.ceil(Math.log(s)/Math.LN2))}function Hf(s){return Math.pow(2,Math.floor(Math.log(s)/Math.LN2))}function bk(s,t,e,n,i){const r=Math.cos,o=Math.sin,a=r(e/2),l=o(e/2),c=r((t+n)/2),h=o((t+n)/2),f=r((t-n)/2),d=o((t-n)/2),m=r((n-t)/2),g=o((n-t)/2);switch(i){case"XYX":s.set(a*h,l*f,l*d,a*c);break;case"YZY":s.set(l*d,a*h,l*f,a*c);break;case"ZXZ":s.set(l*f,l*d,a*h,a*c);break;case"XZX":s.set(a*h,l*g,l*m,a*c);break;case"YXY":s.set(l*m,a*h,l*g,a*c);break;case"ZYZ":s.set(l*g,l*m,a*h,a*c);break;default:console.warn("THREE.MathUtils: .setQuaternionFromProperEuler() encountered an unknown order: "+i)}}function Vi(s,t){switch(t.constructor){case Float32Array:return s;case Uint32Array:return s/4294967295;case Uint16Array:return s/65535;case Uint8Array:return s/255;case Int32Array:return Math.max(s/2147483647,-1);case Int16Array:return Math.max(s/32767,-1);case Int8Array:return Math.max(s/127,-1);default:throw new Error("Invalid component type.")}}function Ae(s,t){switch(t.constructor){case Float32Array:return s;case Uint32Array:return Math.round(s*4294967295);case Uint16Array:return Math.round(s*65535);case Uint8Array:return Math.round(s*255);case Int32Array:return Math.round(s*2147483647);case Int16Array:return Math.round(s*32767);case Int8Array:return Math.round(s*127);default:throw new Error("Invalid component type.")}}const gS={DEG2RAD:$o,RAD2DEG:xl,generateUUID:qi,clamp:yn,euclideanModulo:u_,mapLinear:ck,inverseLerp:uk,lerp:zc,damp:hk,pingpong:fk,smoothstep:dk,smootherstep:pk,randInt:mk,randFloat:gk,randFloatSpread:vk,seededRandom:_k,degToRad:yk,radToDeg:xk,isPowerOfTwo:nv,ceilPowerOfTwo:mS,floorPowerOfTwo:Hf,setQuaternionFromProperEuler:bk,normalize:Ae,denormalize:Vi};let pt=class vS{constructor(t=0,e=0){vS.prototype.isVector2=!0,this.x=t,this.y=e}get width(){return this.x}set width(t){this.x=t}get height(){return this.y}set height(t){this.y=t}set(t,e){return this.x=t,this.y=e,this}setScalar(t){return this.x=t,this.y=t,this}setX(t){return this.x=t,this}setY(t){return this.y=t,this}setComponent(t,e){switch(t){case 0:this.x=e;break;case 1:this.y=e;break;default:throw new Error("index is out of range: "+t)}return this}getComponent(t){switch(t){case 0:return this.x;case 1:return this.y;default:throw new Error("index is out of range: "+t)}}clone(){return new this.constructor(this.x,this.y)}copy(t){return this.x=t.x,this.y=t.y,this}add(t){return this.x+=t.x,this.y+=t.y,this}addScalar(t){return this.x+=t,this.y+=t,this}addVectors(t,e){return this.x=t.x+e.x,this.y=t.y+e.y,this}addScaledVector(t,e){return this.x+=t.x*e,this.y+=t.y*e,this}sub(t){return this.x-=t.x,this.y-=t.y,this}subScalar(t){return this.x-=t,this.y-=t,this}subVectors(t,e){return this.x=t.x-e.x,this.y=t.y-e.y,this}multiply(t){return this.x*=t.x,this.y*=t.y,this}multiplyScalar(t){return this.x*=t,this.y*=t,this}divide(t){return this.x/=t.x,this.y/=t.y,this}divideScalar(t){return this.multiplyScalar(1/t)}applyMatrix3(t){const e=this.x,n=this.y,i=t.elements;return this.x=i[0]*e+i[3]*n+i[6],this.y=i[1]*e+i[4]*n+i[7],this}min(t){return this.x=Math.min(this.x,t.x),this.y=Math.min(this.y,t.y),this}max(t){return this.x=Math.max(this.x,t.x),this.y=Math.max(this.y,t.y),this}clamp(t,e){return this.x=Math.max(t.x,Math.min(e.x,this.x)),this.y=Math.max(t.y,Math.min(e.y,this.y)),this}clampScalar(t,e){return this.x=Math.max(t,Math.min(e,this.x)),this.y=Math.max(t,Math.min(e,this.y)),this}clampLength(t,e){const n=this.length();return this.divideScalar(n||1).multiplyScalar(Math.max(t,Math.min(e,n)))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}roundToZero(){return this.x=this.x<0?Math.ceil(this.x):Math.floor(this.x),this.y=this.y<0?Math.ceil(this.y):Math.floor(this.y),this}negate(){return this.x=-this.x,this.y=-this.y,this}dot(t){return this.x*t.x+this.y*t.y}cross(t){return this.x*t.y-this.y*t.x}lengthSq(){return this.x*this.x+this.y*this.y}length(){return Math.sqrt(this.x*this.x+this.y*this.y)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)}normalize(){return this.divideScalar(this.length()||1)}angle(){return Math.atan2(-this.y,-this.x)+Math.PI}angleTo(t){const e=Math.sqrt(this.lengthSq()*t.lengthSq());if(e===0)return Math.PI/2;const n=this.dot(t)/e;return Math.acos(yn(n,-1,1))}distanceTo(t){return Math.sqrt(this.distanceToSquared(t))}distanceToSquared(t){const e=this.x-t.x,n=this.y-t.y;return e*e+n*n}manhattanDistanceTo(t){return Math.abs(this.x-t.x)+Math.abs(this.y-t.y)}setLength(t){return this.normalize().multiplyScalar(t)}lerp(t,e){return this.x+=(t.x-this.x)*e,this.y+=(t.y-this.y)*e,this}lerpVectors(t,e,n){return this.x=t.x+(e.x-t.x)*n,this.y=t.y+(e.y-t.y)*n,this}equals(t){return t.x===this.x&&t.y===this.y}fromArray(t,e=0){return this.x=t[e],this.y=t[e+1],this}toArray(t=[],e=0){return t[e]=this.x,t[e+1]=this.y,t}fromBufferAttribute(t,e){return this.x=t.getX(e),this.y=t.getY(e),this}rotateAround(t,e){const n=Math.cos(e),i=Math.sin(e),r=this.x-t.x,o=this.y-t.y;return this.x=r*n-o*i+t.x,this.y=r*i+o*n+t.y,this}random(){return this.x=Math.random(),this.y=Math.random(),this}*[Symbol.iterator](){yield this.x,yield this.y}},Te=class _S{constructor(t,e,n,i,r,o,a,l,c){_S.prototype.isMatrix3=!0,this.elements=[1,0,0,0,1,0,0,0,1],t!==void 0&&this.set(t,e,n,i,r,o,a,l,c)}set(t,e,n,i,r,o,a,l,c){const h=this.elements;return h[0]=t,h[1]=i,h[2]=a,h[3]=e,h[4]=r,h[5]=l,h[6]=n,h[7]=o,h[8]=c,this}identity(){return this.set(1,0,0,0,1,0,0,0,1),this}copy(t){const e=this.elements,n=t.elements;return e[0]=n[0],e[1]=n[1],e[2]=n[2],e[3]=n[3],e[4]=n[4],e[5]=n[5],e[6]=n[6],e[7]=n[7],e[8]=n[8],this}extractBasis(t,e,n){return t.setFromMatrix3Column(this,0),e.setFromMatrix3Column(this,1),n.setFromMatrix3Column(this,2),this}setFromMatrix4(t){const e=t.elements;return this.set(e[0],e[4],e[8],e[1],e[5],e[9],e[2],e[6],e[10]),this}multiply(t){return this.multiplyMatrices(this,t)}premultiply(t){return this.multiplyMatrices(t,this)}multiplyMatrices(t,e){const n=t.elements,i=e.elements,r=this.elements,o=n[0],a=n[3],l=n[6],c=n[1],h=n[4],f=n[7],d=n[2],m=n[5],g=n[8],y=i[0],_=i[3],v=i[6],w=i[1],b=i[4],M=i[7],A=i[2],T=i[5],P=i[8];return r[0]=o*y+a*w+l*A,r[3]=o*_+a*b+l*T,r[6]=o*v+a*M+l*P,r[1]=c*y+h*w+f*A,r[4]=c*_+h*b+f*T,r[7]=c*v+h*M+f*P,r[2]=d*y+m*w+g*A,r[5]=d*_+m*b+g*T,r[8]=d*v+m*M+g*P,this}multiplyScalar(t){const e=this.elements;return e[0]*=t,e[3]*=t,e[6]*=t,e[1]*=t,e[4]*=t,e[7]*=t,e[2]*=t,e[5]*=t,e[8]*=t,this}determinant(){const t=this.elements,e=t[0],n=t[1],i=t[2],r=t[3],o=t[4],a=t[5],l=t[6],c=t[7],h=t[8];return e*o*h-e*a*c-n*r*h+n*a*l+i*r*c-i*o*l}invert(){const t=this.elements,e=t[0],n=t[1],i=t[2],r=t[3],o=t[4],a=t[5],l=t[6],c=t[7],h=t[8],f=h*o-a*c,d=a*l-h*r,m=c*r-o*l,g=e*f+n*d+i*m;if(g===0)return this.set(0,0,0,0,0,0,0,0,0);const y=1/g;return t[0]=f*y,t[1]=(i*c-h*n)*y,t[2]=(a*n-i*o)*y,t[3]=d*y,t[4]=(h*e-i*l)*y,t[5]=(i*r-a*e)*y,t[6]=m*y,t[7]=(n*l-c*e)*y,t[8]=(o*e-n*r)*y,this}transpose(){let t;const e=this.elements;return t=e[1],e[1]=e[3],e[3]=t,t=e[2],e[2]=e[6],e[6]=t,t=e[5],e[5]=e[7],e[7]=t,this}getNormalMatrix(t){return this.setFromMatrix4(t).invert().transpose()}transposeIntoArray(t){const e=this.elements;return t[0]=e[0],t[1]=e[3],t[2]=e[6],t[3]=e[1],t[4]=e[4],t[5]=e[7],t[6]=e[2],t[7]=e[5],t[8]=e[8],this}setUvTransform(t,e,n,i,r,o,a){const l=Math.cos(r),c=Math.sin(r);return this.set(n*l,n*c,-n*(l*o+c*a)+o+t,-i*c,i*l,-i*(-c*o+l*a)+a+e,0,0,1),this}scale(t,e){return this.premultiply(Pm.makeScale(t,e)),this}rotate(t){return this.premultiply(Pm.makeRotation(-t)),this}translate(t,e){return this.premultiply(Pm.makeTranslation(t,e)),this}makeTranslation(t,e){return t.isVector2?this.set(1,0,t.x,0,1,t.y,0,0,1):this.set(1,0,t,0,1,e,0,0,1),this}makeRotation(t){const e=Math.cos(t),n=Math.sin(t);return this.set(e,-n,0,n,e,0,0,0,1),this}makeScale(t,e){return this.set(t,0,0,0,e,0,0,0,1),this}equals(t){const e=this.elements,n=t.elements;for(let i=0;i<9;i++)if(e[i]!==n[i])return!1;return!0}fromArray(t,e=0){for(let n=0;n<9;n++)this.elements[n]=t[n+e];return this}toArray(t=[],e=0){const n=this.elements;return t[e]=n[0],t[e+1]=n[1],t[e+2]=n[2],t[e+3]=n[3],t[e+4]=n[4],t[e+5]=n[5],t[e+6]=n[6],t[e+7]=n[7],t[e+8]=n[8],t}clone(){return new this.constructor().fromArray(this.elements)}};const Pm=new Te;function yS(s){for(let t=s.length-1;t>=0;--t)if(s[t]>=65535)return!0;return!1}const wk={Int8Array,Uint8Array,Uint8ClampedArray,Int16Array,Uint16Array,Int32Array,Uint32Array,Float32Array,Float64Array};function rl(s,t){return new wk[s](t)}function Zc(s){return document.createElementNS("http://www.w3.org/1999/xhtml",s)}const ub={};function kc(s){s in ub||(ub[s]=!0,console.warn(s))}function pl(s){return s<.04045?s*.0773993808:Math.pow(s*.9478672986+.0521327014,2.4)}function Rm(s){return s<.0031308?s*12.92:1.055*Math.pow(s,.41666)-.055}const Mk=new Te().fromArray([.8224621,.0331941,.0170827,.177538,.9668058,.0723974,-1e-7,1e-7,.9105199]),Sk=new Te().fromArray([1.2249401,-.0420569,-.0196376,-.2249404,1.0420571,-.0786361,1e-7,0,1.0982735]);function Ak(s){return s.convertSRGBToLinear().applyMatrix3(Sk)}function Ek(s){return s.applyMatrix3(Mk).convertLinearToSRGB()}const Tk={[Es]:s=>s,[ve]:s=>s.convertSRGBToLinear(),[c_]:Ak},Ck={[Es]:s=>s,[ve]:s=>s.convertLinearToSRGB(),[c_]:Ek},Ui={enabled:!0,get legacyMode(){return console.warn("THREE.ColorManagement: .legacyMode=false renamed to .enabled=true in r150."),!this.enabled},set legacyMode(s){console.warn("THREE.ColorManagement: .legacyMode=false renamed to .enabled=true in r150."),this.enabled=!s},get workingColorSpace(){return Es},set workingColorSpace(s){console.warn("THREE.ColorManagement: .workingColorSpace is readonly.")},convert:function(s,t,e){if(this.enabled===!1||t===e||!t||!e)return s;const n=Tk[t],i=Ck[e];if(n===void 0||i===void 0)throw new Error(`Unsupported color space conversion, "${t}" to "${e}".`);return i(n(s))},fromWorkingColorSpace:function(s,t){return this.convert(s,this.workingColorSpace,t)},toWorkingColorSpace:function(s,t){return this.convert(s,t,this.workingColorSpace)}};let za;class h_{static getDataURL(t){if(/^data:/i.test(t.src)||typeof HTMLCanvasElement>"u")return t.src;let e;if(t instanceof HTMLCanvasElement)e=t;else{za===void 0&&(za=Zc("canvas")),za.width=t.width,za.height=t.height;const n=za.getContext("2d");t instanceof ImageData?n.putImageData(t,0,0):n.drawImage(t,0,0,t.width,t.height),e=za}return e.width>2048||e.height>2048?(console.warn("THREE.ImageUtils.getDataURL: Image converted to jpg for performance reasons",t),e.toDataURL("image/jpeg",.6)):e.toDataURL("image/png")}static sRGBToLinear(t){if(typeof HTMLImageElement<"u"&&t instanceof HTMLImageElement||typeof HTMLCanvasElement<"u"&&t instanceof HTMLCanvasElement||typeof ImageBitmap<"u"&&t instanceof ImageBitmap){const e=Zc("canvas");e.width=t.width,e.height=t.height;const n=e.getContext("2d");n.drawImage(t,0,0,t.width,t.height);const i=n.getImageData(0,0,t.width,t.height),r=i.data;for(let o=0;o<r.length;o++)r[o]=pl(r[o]/255)*255;return n.putImageData(i,0,0),e}else if(t.data){const e=t.data.slice(0);for(let n=0;n<e.length;n++)e instanceof Uint8Array||e instanceof Uint8ClampedArray?e[n]=Math.floor(pl(e[n]/255)*255):e[n]=pl(e[n]);return{data:e,width:t.width,height:t.height}}else return console.warn("THREE.ImageUtils.sRGBToLinear(): Unsupported image type. No color space conversion applied."),t}}let Pk=0,Go=class{constructor(t=null){this.isSource=!0,Object.defineProperty(this,"id",{value:Pk++}),this.uuid=qi(),this.data=t,this.version=0}set needsUpdate(t){t===!0&&this.version++}toJSON(t){const e=t===void 0||typeof t=="string";if(!e&&t.images[this.uuid]!==void 0)return t.images[this.uuid];const n={uuid:this.uuid,url:""},i=this.data;if(i!==null){let r;if(Array.isArray(i)){r=[];for(let o=0,a=i.length;o<a;o++)i[o].isDataTexture?r.push(Lm(i[o].image)):r.push(Lm(i[o]))}else r=Lm(i);n.url=r}return e||(t.images[this.uuid]=n),n}};function Lm(s){return typeof HTMLImageElement<"u"&&s instanceof HTMLImageElement||typeof HTMLCanvasElement<"u"&&s instanceof HTMLCanvasElement||typeof ImageBitmap<"u"&&s instanceof ImageBitmap?h_.getDataURL(s):s.data?{data:Array.from(s.data),width:s.width,height:s.height,type:s.data.constructor.name}:(console.warn("THREE.Texture: Unable to serialize Texture."),{})}let Rk=0;class xn extends Gi{constructor(t=xn.DEFAULT_IMAGE,e=xn.DEFAULT_MAPPING,n=In,i=In,r=fn,o=so,a=Vn,l=ai,c=xn.DEFAULT_ANISOTROPY,h=Jr){super(),this.isTexture=!0,Object.defineProperty(this,"id",{value:Rk++}),this.uuid=qi(),this.name="",this.source=new Go(t),this.mipmaps=[],this.mapping=e,this.channel=0,this.wrapS=n,this.wrapT=i,this.magFilter=r,this.minFilter=o,this.anisotropy=c,this.format=a,this.internalFormat=null,this.type=l,this.offset=new pt(0,0),this.repeat=new pt(1,1),this.center=new pt(0,0),this.rotation=0,this.matrixAutoUpdate=!0,this.matrix=new Te,this.generateMipmaps=!0,this.premultiplyAlpha=!1,this.flipY=!0,this.unpackAlignment=4,typeof h=="string"?this.colorSpace=h:(kc("THREE.Texture: Property .encoding has been replaced by .colorSpace."),this.colorSpace=h===br?ve:Jr),this.userData={},this.version=0,this.onUpdate=null,this.isRenderTargetTexture=!1,this.needsPMREMUpdate=!1}get image(){return this.source.data}set image(t=null){this.source.data=t}updateMatrix(){this.matrix.setUvTransform(this.offset.x,this.offset.y,this.repeat.x,this.repeat.y,this.rotation,this.center.x,this.center.y)}clone(){return new this.constructor().copy(this)}copy(t){return this.name=t.name,this.source=t.source,this.mipmaps=t.mipmaps.slice(0),this.mapping=t.mapping,this.channel=t.channel,this.wrapS=t.wrapS,this.wrapT=t.wrapT,this.magFilter=t.magFilter,this.minFilter=t.minFilter,this.anisotropy=t.anisotropy,this.format=t.format,this.internalFormat=t.internalFormat,this.type=t.type,this.offset.copy(t.offset),this.repeat.copy(t.repeat),this.center.copy(t.center),this.rotation=t.rotation,this.matrixAutoUpdate=t.matrixAutoUpdate,this.matrix.copy(t.matrix),this.generateMipmaps=t.generateMipmaps,this.premultiplyAlpha=t.premultiplyAlpha,this.flipY=t.flipY,this.unpackAlignment=t.unpackAlignment,this.colorSpace=t.colorSpace,this.userData=JSON.parse(JSON.stringify(t.userData)),this.needsUpdate=!0,this}toJSON(t){const e=t===void 0||typeof t=="string";if(!e&&t.textures[this.uuid]!==void 0)return t.textures[this.uuid];const n={metadata:{version:4.6,type:"Texture",generator:"Texture.toJSON"},uuid:this.uuid,name:this.name,image:this.source.toJSON(t).uuid,mapping:this.mapping,channel:this.channel,repeat:[this.repeat.x,this.repeat.y],offset:[this.offset.x,this.offset.y],center:[this.center.x,this.center.y],rotation:this.rotation,wrap:[this.wrapS,this.wrapT],format:this.format,internalFormat:this.internalFormat,type:this.type,colorSpace:this.colorSpace,minFilter:this.minFilter,magFilter:this.magFilter,anisotropy:this.anisotropy,flipY:this.flipY,generateMipmaps:this.generateMipmaps,premultiplyAlpha:this.premultiplyAlpha,unpackAlignment:this.unpackAlignment};return Object.keys(this.userData).length>0&&(n.userData=this.userData),e||(t.textures[this.uuid]=n),n}dispose(){this.dispatchEvent({type:"dispose"})}transformUv(t){if(this.mapping!==vu)return t;if(t.applyMatrix3(this.matrix),t.x<0||t.x>1)switch(this.wrapS){case vl:t.x=t.x-Math.floor(t.x);break;case In:t.x=t.x<0?0:1;break;case _l:Math.abs(Math.floor(t.x)%2)===1?t.x=Math.ceil(t.x)-t.x:t.x=t.x-Math.floor(t.x);break}if(t.y<0||t.y>1)switch(this.wrapT){case vl:t.y=t.y-Math.floor(t.y);break;case In:t.y=t.y<0?0:1;break;case _l:Math.abs(Math.floor(t.y)%2)===1?t.y=Math.ceil(t.y)-t.y:t.y=t.y-Math.floor(t.y);break}return this.flipY&&(t.y=1-t.y),t}set needsUpdate(t){t===!0&&(this.version++,this.source.needsUpdate=!0)}get encoding(){return kc("THREE.Texture: Property .encoding has been replaced by .colorSpace."),this.colorSpace===ve?br:Xc}set encoding(t){kc("THREE.Texture: Property .encoding has been replaced by .colorSpace."),this.colorSpace=t===br?ve:Jr}}xn.DEFAULT_IMAGE=null;xn.DEFAULT_MAPPING=vu;xn.DEFAULT_ANISOTROPY=1;let Oe=class xS{constructor(t=0,e=0,n=0,i=1){xS.prototype.isVector4=!0,this.x=t,this.y=e,this.z=n,this.w=i}get width(){return this.z}set width(t){this.z=t}get height(){return this.w}set height(t){this.w=t}set(t,e,n,i){return this.x=t,this.y=e,this.z=n,this.w=i,this}setScalar(t){return this.x=t,this.y=t,this.z=t,this.w=t,this}setX(t){return this.x=t,this}setY(t){return this.y=t,this}setZ(t){return this.z=t,this}setW(t){return this.w=t,this}setComponent(t,e){switch(t){case 0:this.x=e;break;case 1:this.y=e;break;case 2:this.z=e;break;case 3:this.w=e;break;default:throw new Error("index is out of range: "+t)}return this}getComponent(t){switch(t){case 0:return this.x;case 1:return this.y;case 2:return this.z;case 3:return this.w;default:throw new Error("index is out of range: "+t)}}clone(){return new this.constructor(this.x,this.y,this.z,this.w)}copy(t){return this.x=t.x,this.y=t.y,this.z=t.z,this.w=t.w!==void 0?t.w:1,this}add(t){return this.x+=t.x,this.y+=t.y,this.z+=t.z,this.w+=t.w,this}addScalar(t){return this.x+=t,this.y+=t,this.z+=t,this.w+=t,this}addVectors(t,e){return this.x=t.x+e.x,this.y=t.y+e.y,this.z=t.z+e.z,this.w=t.w+e.w,this}addScaledVector(t,e){return this.x+=t.x*e,this.y+=t.y*e,this.z+=t.z*e,this.w+=t.w*e,this}sub(t){return this.x-=t.x,this.y-=t.y,this.z-=t.z,this.w-=t.w,this}subScalar(t){return this.x-=t,this.y-=t,this.z-=t,this.w-=t,this}subVectors(t,e){return this.x=t.x-e.x,this.y=t.y-e.y,this.z=t.z-e.z,this.w=t.w-e.w,this}multiply(t){return this.x*=t.x,this.y*=t.y,this.z*=t.z,this.w*=t.w,this}multiplyScalar(t){return this.x*=t,this.y*=t,this.z*=t,this.w*=t,this}applyMatrix4(t){const e=this.x,n=this.y,i=this.z,r=this.w,o=t.elements;return this.x=o[0]*e+o[4]*n+o[8]*i+o[12]*r,this.y=o[1]*e+o[5]*n+o[9]*i+o[13]*r,this.z=o[2]*e+o[6]*n+o[10]*i+o[14]*r,this.w=o[3]*e+o[7]*n+o[11]*i+o[15]*r,this}divideScalar(t){return this.multiplyScalar(1/t)}setAxisAngleFromQuaternion(t){this.w=2*Math.acos(t.w);const e=Math.sqrt(1-t.w*t.w);return e<1e-4?(this.x=1,this.y=0,this.z=0):(this.x=t.x/e,this.y=t.y/e,this.z=t.z/e),this}setAxisAngleFromRotationMatrix(t){let e,n,i,r;const l=t.elements,c=l[0],h=l[4],f=l[8],d=l[1],m=l[5],g=l[9],y=l[2],_=l[6],v=l[10];if(Math.abs(h-d)<.01&&Math.abs(f-y)<.01&&Math.abs(g-_)<.01){if(Math.abs(h+d)<.1&&Math.abs(f+y)<.1&&Math.abs(g+_)<.1&&Math.abs(c+m+v-3)<.1)return this.set(1,0,0,0),this;e=Math.PI;const b=(c+1)/2,M=(m+1)/2,A=(v+1)/2,T=(h+d)/4,P=(f+y)/4,C=(g+_)/4;return b>M&&b>A?b<.01?(n=0,i=.707106781,r=.707106781):(n=Math.sqrt(b),i=T/n,r=P/n):M>A?M<.01?(n=.707106781,i=0,r=.707106781):(i=Math.sqrt(M),n=T/i,r=C/i):A<.01?(n=.707106781,i=.707106781,r=0):(r=Math.sqrt(A),n=P/r,i=C/r),this.set(n,i,r,e),this}let w=Math.sqrt((_-g)*(_-g)+(f-y)*(f-y)+(d-h)*(d-h));return Math.abs(w)<.001&&(w=1),this.x=(_-g)/w,this.y=(f-y)/w,this.z=(d-h)/w,this.w=Math.acos((c+m+v-1)/2),this}min(t){return this.x=Math.min(this.x,t.x),this.y=Math.min(this.y,t.y),this.z=Math.min(this.z,t.z),this.w=Math.min(this.w,t.w),this}max(t){return this.x=Math.max(this.x,t.x),this.y=Math.max(this.y,t.y),this.z=Math.max(this.z,t.z),this.w=Math.max(this.w,t.w),this}clamp(t,e){return this.x=Math.max(t.x,Math.min(e.x,this.x)),this.y=Math.max(t.y,Math.min(e.y,this.y)),this.z=Math.max(t.z,Math.min(e.z,this.z)),this.w=Math.max(t.w,Math.min(e.w,this.w)),this}clampScalar(t,e){return this.x=Math.max(t,Math.min(e,this.x)),this.y=Math.max(t,Math.min(e,this.y)),this.z=Math.max(t,Math.min(e,this.z)),this.w=Math.max(t,Math.min(e,this.w)),this}clampLength(t,e){const n=this.length();return this.divideScalar(n||1).multiplyScalar(Math.max(t,Math.min(e,n)))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this.z=Math.floor(this.z),this.w=Math.floor(this.w),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this.z=Math.ceil(this.z),this.w=Math.ceil(this.w),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this.z=Math.round(this.z),this.w=Math.round(this.w),this}roundToZero(){return this.x=this.x<0?Math.ceil(this.x):Math.floor(this.x),this.y=this.y<0?Math.ceil(this.y):Math.floor(this.y),this.z=this.z<0?Math.ceil(this.z):Math.floor(this.z),this.w=this.w<0?Math.ceil(this.w):Math.floor(this.w),this}negate(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this.w=-this.w,this}dot(t){return this.x*t.x+this.y*t.y+this.z*t.z+this.w*t.w}lengthSq(){return this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w}length(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)+Math.abs(this.w)}normalize(){return this.divideScalar(this.length()||1)}setLength(t){return this.normalize().multiplyScalar(t)}lerp(t,e){return this.x+=(t.x-this.x)*e,this.y+=(t.y-this.y)*e,this.z+=(t.z-this.z)*e,this.w+=(t.w-this.w)*e,this}lerpVectors(t,e,n){return this.x=t.x+(e.x-t.x)*n,this.y=t.y+(e.y-t.y)*n,this.z=t.z+(e.z-t.z)*n,this.w=t.w+(e.w-t.w)*n,this}equals(t){return t.x===this.x&&t.y===this.y&&t.z===this.z&&t.w===this.w}fromArray(t,e=0){return this.x=t[e],this.y=t[e+1],this.z=t[e+2],this.w=t[e+3],this}toArray(t=[],e=0){return t[e]=this.x,t[e+1]=this.y,t[e+2]=this.z,t[e+3]=this.w,t}fromBufferAttribute(t,e){return this.x=t.getX(e),this.y=t.getY(e),this.z=t.getZ(e),this.w=t.getW(e),this}random(){return this.x=Math.random(),this.y=Math.random(),this.z=Math.random(),this.w=Math.random(),this}*[Symbol.iterator](){yield this.x,yield this.y,yield this.z,yield this.w}};class Wi extends Gi{constructor(t=1,e=1,n={}){super(),this.isWebGLRenderTarget=!0,this.width=t,this.height=e,this.depth=1,this.scissor=new Oe(0,0,t,e),this.scissorTest=!1,this.viewport=new Oe(0,0,t,e);const i={width:t,height:e,depth:1};n.encoding!==void 0&&(kc("THREE.WebGLRenderTarget: option.encoding has been replaced by option.colorSpace."),n.colorSpace=n.encoding===br?ve:Jr),this.texture=new xn(i,n.mapping,n.wrapS,n.wrapT,n.magFilter,n.minFilter,n.format,n.type,n.anisotropy,n.colorSpace),this.texture.isRenderTargetTexture=!0,this.texture.flipY=!1,this.texture.generateMipmaps=n.generateMipmaps!==void 0?n.generateMipmaps:!1,this.texture.internalFormat=n.internalFormat!==void 0?n.internalFormat:null,this.texture.minFilter=n.minFilter!==void 0?n.minFilter:fn,this.depthBuffer=n.depthBuffer!==void 0?n.depthBuffer:!0,this.stencilBuffer=n.stencilBuffer!==void 0?n.stencilBuffer:!1,this.depthTexture=n.depthTexture!==void 0?n.depthTexture:null,this.samples=n.samples!==void 0?n.samples:0}setSize(t,e,n=1){(this.width!==t||this.height!==e||this.depth!==n)&&(this.width=t,this.height=e,this.depth=n,this.texture.image.width=t,this.texture.image.height=e,this.texture.image.depth=n,this.dispose()),this.viewport.set(0,0,t,e),this.scissor.set(0,0,t,e)}clone(){return new this.constructor().copy(this)}copy(t){this.width=t.width,this.height=t.height,this.depth=t.depth,this.scissor.copy(t.scissor),this.scissorTest=t.scissorTest,this.viewport.copy(t.viewport),this.texture=t.texture.clone(),this.texture.isRenderTargetTexture=!0;const e=Object.assign({},t.texture.image);return this.texture.source=new Go(e),this.depthBuffer=t.depthBuffer,this.stencilBuffer=t.stencilBuffer,t.depthTexture!==null&&(this.depthTexture=t.depthTexture.clone()),this.samples=t.samples,this}dispose(){this.dispatchEvent({type:"dispose"})}}class fd extends xn{constructor(t=null,e=1,n=1,i=1){super(null),this.isDataArrayTexture=!0,this.image={data:t,width:e,height:n,depth:i},this.magFilter=Ve,this.minFilter=Ve,this.wrapR=In,this.generateMipmaps=!1,this.flipY=!1,this.unpackAlignment=1}}class Lk extends Wi{constructor(t=1,e=1,n=1){super(t,e),this.isWebGLArrayRenderTarget=!0,this.depth=n,this.texture=new fd(null,t,e,n),this.texture.isRenderTargetTexture=!0}}class f_ extends xn{constructor(t=null,e=1,n=1,i=1){super(null),this.isData3DTexture=!0,this.image={data:t,width:e,height:n,depth:i},this.magFilter=Ve,this.minFilter=Ve,this.wrapR=In,this.generateMipmaps=!1,this.flipY=!1,this.unpackAlignment=1}}class Dk extends Wi{constructor(t=1,e=1,n=1){super(t,e),this.isWebGL3DRenderTarget=!0,this.depth=n,this.texture=new f_(null,t,e,n),this.texture.isRenderTargetTexture=!0}}class Ik extends Wi{constructor(t=1,e=1,n=1,i={}){super(t,e,i),this.isWebGLMultipleRenderTargets=!0;const r=this.texture;this.texture=[];for(let o=0;o<n;o++)this.texture[o]=r.clone(),this.texture[o].isRenderTargetTexture=!0}setSize(t,e,n=1){if(this.width!==t||this.height!==e||this.depth!==n){this.width=t,this.height=e,this.depth=n;for(let i=0,r=this.texture.length;i<r;i++)this.texture[i].image.width=t,this.texture[i].image.height=e,this.texture[i].image.depth=n;this.dispose()}this.viewport.set(0,0,t,e),this.scissor.set(0,0,t,e)}copy(t){this.dispose(),this.width=t.width,this.height=t.height,this.depth=t.depth,this.scissor.copy(t.scissor),this.scissorTest=t.scissorTest,this.viewport.copy(t.viewport),this.depthBuffer=t.depthBuffer,this.stencilBuffer=t.stencilBuffer,t.depthTexture!==null&&(this.depthTexture=t.depthTexture.clone()),this.texture.length=0;for(let e=0,n=t.texture.length;e<n;e++)this.texture[e]=t.texture[e].clone(),this.texture[e].isRenderTargetTexture=!0;return this}}let Pn=class{constructor(t=0,e=0,n=0,i=1){this.isQuaternion=!0,this._x=t,this._y=e,this._z=n,this._w=i}static slerpFlat(t,e,n,i,r,o,a){let l=n[i+0],c=n[i+1],h=n[i+2],f=n[i+3];const d=r[o+0],m=r[o+1],g=r[o+2],y=r[o+3];if(a===0){t[e+0]=l,t[e+1]=c,t[e+2]=h,t[e+3]=f;return}if(a===1){t[e+0]=d,t[e+1]=m,t[e+2]=g,t[e+3]=y;return}if(f!==y||l!==d||c!==m||h!==g){let _=1-a;const v=l*d+c*m+h*g+f*y,w=v>=0?1:-1,b=1-v*v;if(b>Number.EPSILON){const A=Math.sqrt(b),T=Math.atan2(A,v*w);_=Math.sin(_*T)/A,a=Math.sin(a*T)/A}const M=a*w;if(l=l*_+d*M,c=c*_+m*M,h=h*_+g*M,f=f*_+y*M,_===1-a){const A=1/Math.sqrt(l*l+c*c+h*h+f*f);l*=A,c*=A,h*=A,f*=A}}t[e]=l,t[e+1]=c,t[e+2]=h,t[e+3]=f}static multiplyQuaternionsFlat(t,e,n,i,r,o){const a=n[i],l=n[i+1],c=n[i+2],h=n[i+3],f=r[o],d=r[o+1],m=r[o+2],g=r[o+3];return t[e]=a*g+h*f+l*m-c*d,t[e+1]=l*g+h*d+c*f-a*m,t[e+2]=c*g+h*m+a*d-l*f,t[e+3]=h*g-a*f-l*d-c*m,t}get x(){return this._x}set x(t){this._x=t,this._onChangeCallback()}get y(){return this._y}set y(t){this._y=t,this._onChangeCallback()}get z(){return this._z}set z(t){this._z=t,this._onChangeCallback()}get w(){return this._w}set w(t){this._w=t,this._onChangeCallback()}set(t,e,n,i){return this._x=t,this._y=e,this._z=n,this._w=i,this._onChangeCallback(),this}clone(){return new this.constructor(this._x,this._y,this._z,this._w)}copy(t){return this._x=t.x,this._y=t.y,this._z=t.z,this._w=t.w,this._onChangeCallback(),this}setFromEuler(t,e){const n=t._x,i=t._y,r=t._z,o=t._order,a=Math.cos,l=Math.sin,c=a(n/2),h=a(i/2),f=a(r/2),d=l(n/2),m=l(i/2),g=l(r/2);switch(o){case"XYZ":this._x=d*h*f+c*m*g,this._y=c*m*f-d*h*g,this._z=c*h*g+d*m*f,this._w=c*h*f-d*m*g;break;case"YXZ":this._x=d*h*f+c*m*g,this._y=c*m*f-d*h*g,this._z=c*h*g-d*m*f,this._w=c*h*f+d*m*g;break;case"ZXY":this._x=d*h*f-c*m*g,this._y=c*m*f+d*h*g,this._z=c*h*g+d*m*f,this._w=c*h*f-d*m*g;break;case"ZYX":this._x=d*h*f-c*m*g,this._y=c*m*f+d*h*g,this._z=c*h*g-d*m*f,this._w=c*h*f+d*m*g;break;case"YZX":this._x=d*h*f+c*m*g,this._y=c*m*f+d*h*g,this._z=c*h*g-d*m*f,this._w=c*h*f-d*m*g;break;case"XZY":this._x=d*h*f-c*m*g,this._y=c*m*f-d*h*g,this._z=c*h*g+d*m*f,this._w=c*h*f+d*m*g;break;default:console.warn("THREE.Quaternion: .setFromEuler() encountered an unknown order: "+o)}return e!==!1&&this._onChangeCallback(),this}setFromAxisAngle(t,e){const n=e/2,i=Math.sin(n);return this._x=t.x*i,this._y=t.y*i,this._z=t.z*i,this._w=Math.cos(n),this._onChangeCallback(),this}setFromRotationMatrix(t){const e=t.elements,n=e[0],i=e[4],r=e[8],o=e[1],a=e[5],l=e[9],c=e[2],h=e[6],f=e[10],d=n+a+f;if(d>0){const m=.5/Math.sqrt(d+1);this._w=.25/m,this._x=(h-l)*m,this._y=(r-c)*m,this._z=(o-i)*m}else if(n>a&&n>f){const m=2*Math.sqrt(1+n-a-f);this._w=(h-l)/m,this._x=.25*m,this._y=(i+o)/m,this._z=(r+c)/m}else if(a>f){const m=2*Math.sqrt(1+a-n-f);this._w=(r-c)/m,this._x=(i+o)/m,this._y=.25*m,this._z=(l+h)/m}else{const m=2*Math.sqrt(1+f-n-a);this._w=(o-i)/m,this._x=(r+c)/m,this._y=(l+h)/m,this._z=.25*m}return this._onChangeCallback(),this}setFromUnitVectors(t,e){let n=t.dot(e)+1;return n<Number.EPSILON?(n=0,Math.abs(t.x)>Math.abs(t.z)?(this._x=-t.y,this._y=t.x,this._z=0,this._w=n):(this._x=0,this._y=-t.z,this._z=t.y,this._w=n)):(this._x=t.y*e.z-t.z*e.y,this._y=t.z*e.x-t.x*e.z,this._z=t.x*e.y-t.y*e.x,this._w=n),this.normalize()}angleTo(t){return 2*Math.acos(Math.abs(yn(this.dot(t),-1,1)))}rotateTowards(t,e){const n=this.angleTo(t);if(n===0)return this;const i=Math.min(1,e/n);return this.slerp(t,i),this}identity(){return this.set(0,0,0,1)}invert(){return this.conjugate()}conjugate(){return this._x*=-1,this._y*=-1,this._z*=-1,this._onChangeCallback(),this}dot(t){return this._x*t._x+this._y*t._y+this._z*t._z+this._w*t._w}lengthSq(){return this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w}length(){return Math.sqrt(this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w)}normalize(){let t=this.length();return t===0?(this._x=0,this._y=0,this._z=0,this._w=1):(t=1/t,this._x=this._x*t,this._y=this._y*t,this._z=this._z*t,this._w=this._w*t),this._onChangeCallback(),this}multiply(t){return this.multiplyQuaternions(this,t)}premultiply(t){return this.multiplyQuaternions(t,this)}multiplyQuaternions(t,e){const n=t._x,i=t._y,r=t._z,o=t._w,a=e._x,l=e._y,c=e._z,h=e._w;return this._x=n*h+o*a+i*c-r*l,this._y=i*h+o*l+r*a-n*c,this._z=r*h+o*c+n*l-i*a,this._w=o*h-n*a-i*l-r*c,this._onChangeCallback(),this}slerp(t,e){if(e===0)return this;if(e===1)return this.copy(t);const n=this._x,i=this._y,r=this._z,o=this._w;let a=o*t._w+n*t._x+i*t._y+r*t._z;if(a<0?(this._w=-t._w,this._x=-t._x,this._y=-t._y,this._z=-t._z,a=-a):this.copy(t),a>=1)return this._w=o,this._x=n,this._y=i,this._z=r,this;const l=1-a*a;if(l<=Number.EPSILON){const m=1-e;return this._w=m*o+e*this._w,this._x=m*n+e*this._x,this._y=m*i+e*this._y,this._z=m*r+e*this._z,this.normalize(),this._onChangeCallback(),this}const c=Math.sqrt(l),h=Math.atan2(c,a),f=Math.sin((1-e)*h)/c,d=Math.sin(e*h)/c;return this._w=o*f+this._w*d,this._x=n*f+this._x*d,this._y=i*f+this._y*d,this._z=r*f+this._z*d,this._onChangeCallback(),this}slerpQuaternions(t,e,n){return this.copy(t).slerp(e,n)}random(){const t=Math.random(),e=Math.sqrt(1-t),n=Math.sqrt(t),i=2*Math.PI*Math.random(),r=2*Math.PI*Math.random();return this.set(e*Math.cos(i),n*Math.sin(r),n*Math.cos(r),e*Math.sin(i))}equals(t){return t._x===this._x&&t._y===this._y&&t._z===this._z&&t._w===this._w}fromArray(t,e=0){return this._x=t[e],this._y=t[e+1],this._z=t[e+2],this._w=t[e+3],this._onChangeCallback(),this}toArray(t=[],e=0){return t[e]=this._x,t[e+1]=this._y,t[e+2]=this._z,t[e+3]=this._w,t}fromBufferAttribute(t,e){return this._x=t.getX(e),this._y=t.getY(e),this._z=t.getZ(e),this._w=t.getW(e),this}toJSON(){return this.toArray()}_onChange(t){return this._onChangeCallback=t,this}_onChangeCallback(){}*[Symbol.iterator](){yield this._x,yield this._y,yield this._z,yield this._w}},N=class bS{constructor(t=0,e=0,n=0){bS.prototype.isVector3=!0,this.x=t,this.y=e,this.z=n}set(t,e,n){return n===void 0&&(n=this.z),this.x=t,this.y=e,this.z=n,this}setScalar(t){return this.x=t,this.y=t,this.z=t,this}setX(t){return this.x=t,this}setY(t){return this.y=t,this}setZ(t){return this.z=t,this}setComponent(t,e){switch(t){case 0:this.x=e;break;case 1:this.y=e;break;case 2:this.z=e;break;default:throw new Error("index is out of range: "+t)}return this}getComponent(t){switch(t){case 0:return this.x;case 1:return this.y;case 2:return this.z;default:throw new Error("index is out of range: "+t)}}clone(){return new this.constructor(this.x,this.y,this.z)}copy(t){return this.x=t.x,this.y=t.y,this.z=t.z,this}add(t){return this.x+=t.x,this.y+=t.y,this.z+=t.z,this}addScalar(t){return this.x+=t,this.y+=t,this.z+=t,this}addVectors(t,e){return this.x=t.x+e.x,this.y=t.y+e.y,this.z=t.z+e.z,this}addScaledVector(t,e){return this.x+=t.x*e,this.y+=t.y*e,this.z+=t.z*e,this}sub(t){return this.x-=t.x,this.y-=t.y,this.z-=t.z,this}subScalar(t){return this.x-=t,this.y-=t,this.z-=t,this}subVectors(t,e){return this.x=t.x-e.x,this.y=t.y-e.y,this.z=t.z-e.z,this}multiply(t){return this.x*=t.x,this.y*=t.y,this.z*=t.z,this}multiplyScalar(t){return this.x*=t,this.y*=t,this.z*=t,this}multiplyVectors(t,e){return this.x=t.x*e.x,this.y=t.y*e.y,this.z=t.z*e.z,this}applyEuler(t){return this.applyQuaternion(hb.setFromEuler(t))}applyAxisAngle(t,e){return this.applyQuaternion(hb.setFromAxisAngle(t,e))}applyMatrix3(t){const e=this.x,n=this.y,i=this.z,r=t.elements;return this.x=r[0]*e+r[3]*n+r[6]*i,this.y=r[1]*e+r[4]*n+r[7]*i,this.z=r[2]*e+r[5]*n+r[8]*i,this}applyNormalMatrix(t){return this.applyMatrix3(t).normalize()}applyMatrix4(t){const e=this.x,n=this.y,i=this.z,r=t.elements,o=1/(r[3]*e+r[7]*n+r[11]*i+r[15]);return this.x=(r[0]*e+r[4]*n+r[8]*i+r[12])*o,this.y=(r[1]*e+r[5]*n+r[9]*i+r[13])*o,this.z=(r[2]*e+r[6]*n+r[10]*i+r[14])*o,this}applyQuaternion(t){const e=this.x,n=this.y,i=this.z,r=t.x,o=t.y,a=t.z,l=t.w,c=l*e+o*i-a*n,h=l*n+a*e-r*i,f=l*i+r*n-o*e,d=-r*e-o*n-a*i;return this.x=c*l+d*-r+h*-a-f*-o,this.y=h*l+d*-o+f*-r-c*-a,this.z=f*l+d*-a+c*-o-h*-r,this}project(t){return this.applyMatrix4(t.matrixWorldInverse).applyMatrix4(t.projectionMatrix)}unproject(t){return this.applyMatrix4(t.projectionMatrixInverse).applyMatrix4(t.matrixWorld)}transformDirection(t){const e=this.x,n=this.y,i=this.z,r=t.elements;return this.x=r[0]*e+r[4]*n+r[8]*i,this.y=r[1]*e+r[5]*n+r[9]*i,this.z=r[2]*e+r[6]*n+r[10]*i,this.normalize()}divide(t){return this.x/=t.x,this.y/=t.y,this.z/=t.z,this}divideScalar(t){return this.multiplyScalar(1/t)}min(t){return this.x=Math.min(this.x,t.x),this.y=Math.min(this.y,t.y),this.z=Math.min(this.z,t.z),this}max(t){return this.x=Math.max(this.x,t.x),this.y=Math.max(this.y,t.y),this.z=Math.max(this.z,t.z),this}clamp(t,e){return this.x=Math.max(t.x,Math.min(e.x,this.x)),this.y=Math.max(t.y,Math.min(e.y,this.y)),this.z=Math.max(t.z,Math.min(e.z,this.z)),this}clampScalar(t,e){return this.x=Math.max(t,Math.min(e,this.x)),this.y=Math.max(t,Math.min(e,this.y)),this.z=Math.max(t,Math.min(e,this.z)),this}clampLength(t,e){const n=this.length();return this.divideScalar(n||1).multiplyScalar(Math.max(t,Math.min(e,n)))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this.z=Math.floor(this.z),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this.z=Math.ceil(this.z),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this.z=Math.round(this.z),this}roundToZero(){return this.x=this.x<0?Math.ceil(this.x):Math.floor(this.x),this.y=this.y<0?Math.ceil(this.y):Math.floor(this.y),this.z=this.z<0?Math.ceil(this.z):Math.floor(this.z),this}negate(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this}dot(t){return this.x*t.x+this.y*t.y+this.z*t.z}lengthSq(){return this.x*this.x+this.y*this.y+this.z*this.z}length(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)}normalize(){return this.divideScalar(this.length()||1)}setLength(t){return this.normalize().multiplyScalar(t)}lerp(t,e){return this.x+=(t.x-this.x)*e,this.y+=(t.y-this.y)*e,this.z+=(t.z-this.z)*e,this}lerpVectors(t,e,n){return this.x=t.x+(e.x-t.x)*n,this.y=t.y+(e.y-t.y)*n,this.z=t.z+(e.z-t.z)*n,this}cross(t){return this.crossVectors(this,t)}crossVectors(t,e){const n=t.x,i=t.y,r=t.z,o=e.x,a=e.y,l=e.z;return this.x=i*l-r*a,this.y=r*o-n*l,this.z=n*a-i*o,this}projectOnVector(t){const e=t.lengthSq();if(e===0)return this.set(0,0,0);const n=t.dot(this)/e;return this.copy(t).multiplyScalar(n)}projectOnPlane(t){return Dm.copy(this).projectOnVector(t),this.sub(Dm)}reflect(t){return this.sub(Dm.copy(t).multiplyScalar(2*this.dot(t)))}angleTo(t){const e=Math.sqrt(this.lengthSq()*t.lengthSq());if(e===0)return Math.PI/2;const n=this.dot(t)/e;return Math.acos(yn(n,-1,1))}distanceTo(t){return Math.sqrt(this.distanceToSquared(t))}distanceToSquared(t){const e=this.x-t.x,n=this.y-t.y,i=this.z-t.z;return e*e+n*n+i*i}manhattanDistanceTo(t){return Math.abs(this.x-t.x)+Math.abs(this.y-t.y)+Math.abs(this.z-t.z)}setFromSpherical(t){return this.setFromSphericalCoords(t.radius,t.phi,t.theta)}setFromSphericalCoords(t,e,n){const i=Math.sin(e)*t;return this.x=i*Math.sin(n),this.y=Math.cos(e)*t,this.z=i*Math.cos(n),this}setFromCylindrical(t){return this.setFromCylindricalCoords(t.radius,t.theta,t.y)}setFromCylindricalCoords(t,e,n){return this.x=t*Math.sin(e),this.y=n,this.z=t*Math.cos(e),this}setFromMatrixPosition(t){const e=t.elements;return this.x=e[12],this.y=e[13],this.z=e[14],this}setFromMatrixScale(t){const e=this.setFromMatrixColumn(t,0).length(),n=this.setFromMatrixColumn(t,1).length(),i=this.setFromMatrixColumn(t,2).length();return this.x=e,this.y=n,this.z=i,this}setFromMatrixColumn(t,e){return this.fromArray(t.elements,e*4)}setFromMatrix3Column(t,e){return this.fromArray(t.elements,e*3)}setFromEuler(t){return this.x=t._x,this.y=t._y,this.z=t._z,this}setFromColor(t){return this.x=t.r,this.y=t.g,this.z=t.b,this}equals(t){return t.x===this.x&&t.y===this.y&&t.z===this.z}fromArray(t,e=0){return this.x=t[e],this.y=t[e+1],this.z=t[e+2],this}toArray(t=[],e=0){return t[e]=this.x,t[e+1]=this.y,t[e+2]=this.z,t}fromBufferAttribute(t,e){return this.x=t.getX(e),this.y=t.getY(e),this.z=t.getZ(e),this}random(){return this.x=Math.random(),this.y=Math.random(),this.z=Math.random(),this}randomDirection(){const t=(Math.random()-.5)*2,e=Math.random()*Math.PI*2,n=Math.sqrt(1-t**2);return this.x=n*Math.cos(e),this.y=n*Math.sin(e),this.z=t,this}*[Symbol.iterator](){yield this.x,yield this.y,yield this.z}};const Dm=new N,hb=new Pn;class js{constructor(t=new N(1/0,1/0,1/0),e=new N(-1/0,-1/0,-1/0)){this.isBox3=!0,this.min=t,this.max=e}set(t,e){return this.min.copy(t),this.max.copy(e),this}setFromArray(t){this.makeEmpty();for(let e=0,n=t.length;e<n;e+=3)this.expandByPoint(lr.fromArray(t,e));return this}setFromBufferAttribute(t){this.makeEmpty();for(let e=0,n=t.count;e<n;e++)this.expandByPoint(lr.fromBufferAttribute(t,e));return this}setFromPoints(t){this.makeEmpty();for(let e=0,n=t.length;e<n;e++)this.expandByPoint(t[e]);return this}setFromCenterAndSize(t,e){const n=lr.copy(e).multiplyScalar(.5);return this.min.copy(t).sub(n),this.max.copy(t).add(n),this}setFromObject(t,e=!1){return this.makeEmpty(),this.expandByObject(t,e)}clone(){return new this.constructor().copy(this)}copy(t){return this.min.copy(t.min),this.max.copy(t.max),this}makeEmpty(){return this.min.x=this.min.y=this.min.z=1/0,this.max.x=this.max.y=this.max.z=-1/0,this}isEmpty(){return this.max.x<this.min.x||this.max.y<this.min.y||this.max.z<this.min.z}getCenter(t){return this.isEmpty()?t.set(0,0,0):t.addVectors(this.min,this.max).multiplyScalar(.5)}getSize(t){return this.isEmpty()?t.set(0,0,0):t.subVectors(this.max,this.min)}expandByPoint(t){return this.min.min(t),this.max.max(t),this}expandByVector(t){return this.min.sub(t),this.max.add(t),this}expandByScalar(t){return this.min.addScalar(-t),this.max.addScalar(t),this}expandByObject(t,e=!1){if(t.updateWorldMatrix(!1,!1),t.boundingBox!==void 0)t.boundingBox===null&&t.computeBoundingBox(),ka.copy(t.boundingBox),ka.applyMatrix4(t.matrixWorld),this.union(ka);else{const i=t.geometry;if(i!==void 0)if(e&&i.attributes!==void 0&&i.attributes.position!==void 0){const r=i.attributes.position;for(let o=0,a=r.count;o<a;o++)lr.fromBufferAttribute(r,o).applyMatrix4(t.matrixWorld),this.expandByPoint(lr)}else i.boundingBox===null&&i.computeBoundingBox(),ka.copy(i.boundingBox),ka.applyMatrix4(t.matrixWorld),this.union(ka)}const n=t.children;for(let i=0,r=n.length;i<r;i++)this.expandByObject(n[i],e);return this}containsPoint(t){return!(t.x<this.min.x||t.x>this.max.x||t.y<this.min.y||t.y>this.max.y||t.z<this.min.z||t.z>this.max.z)}containsBox(t){return this.min.x<=t.min.x&&t.max.x<=this.max.x&&this.min.y<=t.min.y&&t.max.y<=this.max.y&&this.min.z<=t.min.z&&t.max.z<=this.max.z}getParameter(t,e){return e.set((t.x-this.min.x)/(this.max.x-this.min.x),(t.y-this.min.y)/(this.max.y-this.min.y),(t.z-this.min.z)/(this.max.z-this.min.z))}intersectsBox(t){return!(t.max.x<this.min.x||t.min.x>this.max.x||t.max.y<this.min.y||t.min.y>this.max.y||t.max.z<this.min.z||t.min.z>this.max.z)}intersectsSphere(t){return this.clampPoint(t.center,lr),lr.distanceToSquared(t.center)<=t.radius*t.radius}intersectsPlane(t){let e,n;return t.normal.x>0?(e=t.normal.x*this.min.x,n=t.normal.x*this.max.x):(e=t.normal.x*this.max.x,n=t.normal.x*this.min.x),t.normal.y>0?(e+=t.normal.y*this.min.y,n+=t.normal.y*this.max.y):(e+=t.normal.y*this.max.y,n+=t.normal.y*this.min.y),t.normal.z>0?(e+=t.normal.z*this.min.z,n+=t.normal.z*this.max.z):(e+=t.normal.z*this.max.z,n+=t.normal.z*this.min.z),e<=-t.constant&&n>=-t.constant}intersectsTriangle(t){if(this.isEmpty())return!1;this.getCenter(dc),Sh.subVectors(this.max,dc),Ua.subVectors(t.a,dc),Na.subVectors(t.b,dc),Fa.subVectors(t.c,dc),Br.subVectors(Na,Ua),Hr.subVectors(Fa,Na),So.subVectors(Ua,Fa);let e=[0,-Br.z,Br.y,0,-Hr.z,Hr.y,0,-So.z,So.y,Br.z,0,-Br.x,Hr.z,0,-Hr.x,So.z,0,-So.x,-Br.y,Br.x,0,-Hr.y,Hr.x,0,-So.y,So.x,0];return!Im(e,Ua,Na,Fa,Sh)||(e=[1,0,0,0,1,0,0,0,1],!Im(e,Ua,Na,Fa,Sh))?!1:(Ah.crossVectors(Br,Hr),e=[Ah.x,Ah.y,Ah.z],Im(e,Ua,Na,Fa,Sh))}clampPoint(t,e){return e.copy(t).clamp(this.min,this.max)}distanceToPoint(t){return this.clampPoint(t,lr).distanceTo(t)}getBoundingSphere(t){return this.isEmpty()?t.makeEmpty():(this.getCenter(t.center),t.radius=this.getSize(lr).length()*.5),t}intersect(t){return this.min.max(t.min),this.max.min(t.max),this.isEmpty()&&this.makeEmpty(),this}union(t){return this.min.min(t.min),this.max.max(t.max),this}applyMatrix4(t){return this.isEmpty()?this:(ar[0].set(this.min.x,this.min.y,this.min.z).applyMatrix4(t),ar[1].set(this.min.x,this.min.y,this.max.z).applyMatrix4(t),ar[2].set(this.min.x,this.max.y,this.min.z).applyMatrix4(t),ar[3].set(this.min.x,this.max.y,this.max.z).applyMatrix4(t),ar[4].set(this.max.x,this.min.y,this.min.z).applyMatrix4(t),ar[5].set(this.max.x,this.min.y,this.max.z).applyMatrix4(t),ar[6].set(this.max.x,this.max.y,this.min.z).applyMatrix4(t),ar[7].set(this.max.x,this.max.y,this.max.z).applyMatrix4(t),this.setFromPoints(ar),this)}translate(t){return this.min.add(t),this.max.add(t),this}equals(t){return t.min.equals(this.min)&&t.max.equals(this.max)}}const ar=[new N,new N,new N,new N,new N,new N,new N,new N],lr=new N,ka=new js,Ua=new N,Na=new N,Fa=new N,Br=new N,Hr=new N,So=new N,dc=new N,Sh=new N,Ah=new N,Ao=new N;function Im(s,t,e,n,i){for(let r=0,o=s.length-3;r<=o;r+=3){Ao.fromArray(s,r);const a=i.x*Math.abs(Ao.x)+i.y*Math.abs(Ao.y)+i.z*Math.abs(Ao.z),l=t.dot(Ao),c=e.dot(Ao),h=n.dot(Ao);if(Math.max(-Math.max(l,c,h),Math.min(l,c,h))>a)return!1}return!0}const Ok=new js,pc=new N,Om=new N;class Ts{constructor(t=new N,e=-1){this.center=t,this.radius=e}set(t,e){return this.center.copy(t),this.radius=e,this}setFromPoints(t,e){const n=this.center;e!==void 0?n.copy(e):Ok.setFromPoints(t).getCenter(n);let i=0;for(let r=0,o=t.length;r<o;r++)i=Math.max(i,n.distanceToSquared(t[r]));return this.radius=Math.sqrt(i),this}copy(t){return this.center.copy(t.center),this.radius=t.radius,this}isEmpty(){return this.radius<0}makeEmpty(){return this.center.set(0,0,0),this.radius=-1,this}containsPoint(t){return t.distanceToSquared(this.center)<=this.radius*this.radius}distanceToPoint(t){return t.distanceTo(this.center)-this.radius}intersectsSphere(t){const e=this.radius+t.radius;return t.center.distanceToSquared(this.center)<=e*e}intersectsBox(t){return t.intersectsSphere(this)}intersectsPlane(t){return Math.abs(t.distanceToPoint(this.center))<=this.radius}clampPoint(t,e){const n=this.center.distanceToSquared(t);return e.copy(t),n>this.radius*this.radius&&(e.sub(this.center).normalize(),e.multiplyScalar(this.radius).add(this.center)),e}getBoundingBox(t){return this.isEmpty()?(t.makeEmpty(),t):(t.set(this.center,this.center),t.expandByScalar(this.radius),t)}applyMatrix4(t){return this.center.applyMatrix4(t),this.radius=this.radius*t.getMaxScaleOnAxis(),this}translate(t){return this.center.add(t),this}expandByPoint(t){if(this.isEmpty())return this.center.copy(t),this.radius=0,this;pc.subVectors(t,this.center);const e=pc.lengthSq();if(e>this.radius*this.radius){const n=Math.sqrt(e),i=(n-this.radius)*.5;this.center.addScaledVector(pc,i/n),this.radius+=i}return this}union(t){return t.isEmpty()?this:this.isEmpty()?(this.copy(t),this):(this.center.equals(t.center)===!0?this.radius=Math.max(this.radius,t.radius):(Om.subVectors(t.center,this.center).setLength(t.radius),this.expandByPoint(pc.copy(t.center).add(Om)),this.expandByPoint(pc.copy(t.center).sub(Om))),this)}equals(t){return t.center.equals(this.center)&&t.radius===this.radius}clone(){return new this.constructor().copy(this)}}const cr=new N,zm=new N,Eh=new N,Vr=new N,km=new N,Th=new N,Um=new N;class la{constructor(t=new N,e=new N(0,0,-1)){this.origin=t,this.direction=e}set(t,e){return this.origin.copy(t),this.direction.copy(e),this}copy(t){return this.origin.copy(t.origin),this.direction.copy(t.direction),this}at(t,e){return e.copy(this.origin).addScaledVector(this.direction,t)}lookAt(t){return this.direction.copy(t).sub(this.origin).normalize(),this}recast(t){return this.origin.copy(this.at(t,cr)),this}closestPointToPoint(t,e){e.subVectors(t,this.origin);const n=e.dot(this.direction);return n<0?e.copy(this.origin):e.copy(this.origin).addScaledVector(this.direction,n)}distanceToPoint(t){return Math.sqrt(this.distanceSqToPoint(t))}distanceSqToPoint(t){const e=cr.subVectors(t,this.origin).dot(this.direction);return e<0?this.origin.distanceToSquared(t):(cr.copy(this.origin).addScaledVector(this.direction,e),cr.distanceToSquared(t))}distanceSqToSegment(t,e,n,i){zm.copy(t).add(e).multiplyScalar(.5),Eh.copy(e).sub(t).normalize(),Vr.copy(this.origin).sub(zm);const r=t.distanceTo(e)*.5,o=-this.direction.dot(Eh),a=Vr.dot(this.direction),l=-Vr.dot(Eh),c=Vr.lengthSq(),h=Math.abs(1-o*o);let f,d,m,g;if(h>0)if(f=o*l-a,d=o*a-l,g=r*h,f>=0)if(d>=-g)if(d<=g){const y=1/h;f*=y,d*=y,m=f*(f+o*d+2*a)+d*(o*f+d+2*l)+c}else d=r,f=Math.max(0,-(o*d+a)),m=-f*f+d*(d+2*l)+c;else d=-r,f=Math.max(0,-(o*d+a)),m=-f*f+d*(d+2*l)+c;else d<=-g?(f=Math.max(0,-(-o*r+a)),d=f>0?-r:Math.min(Math.max(-r,-l),r),m=-f*f+d*(d+2*l)+c):d<=g?(f=0,d=Math.min(Math.max(-r,-l),r),m=d*(d+2*l)+c):(f=Math.max(0,-(o*r+a)),d=f>0?r:Math.min(Math.max(-r,-l),r),m=-f*f+d*(d+2*l)+c);else d=o>0?-r:r,f=Math.max(0,-(o*d+a)),m=-f*f+d*(d+2*l)+c;return n&&n.copy(this.origin).addScaledVector(this.direction,f),i&&i.copy(zm).addScaledVector(Eh,d),m}intersectSphere(t,e){cr.subVectors(t.center,this.origin);const n=cr.dot(this.direction),i=cr.dot(cr)-n*n,r=t.radius*t.radius;if(i>r)return null;const o=Math.sqrt(r-i),a=n-o,l=n+o;return l<0?null:a<0?this.at(l,e):this.at(a,e)}intersectsSphere(t){return this.distanceSqToPoint(t.center)<=t.radius*t.radius}distanceToPlane(t){const e=t.normal.dot(this.direction);if(e===0)return t.distanceToPoint(this.origin)===0?0:null;const n=-(this.origin.dot(t.normal)+t.constant)/e;return n>=0?n:null}intersectPlane(t,e){const n=this.distanceToPlane(t);return n===null?null:this.at(n,e)}intersectsPlane(t){const e=t.distanceToPoint(this.origin);return e===0||t.normal.dot(this.direction)*e<0}intersectBox(t,e){let n,i,r,o,a,l;const c=1/this.direction.x,h=1/this.direction.y,f=1/this.direction.z,d=this.origin;return c>=0?(n=(t.min.x-d.x)*c,i=(t.max.x-d.x)*c):(n=(t.max.x-d.x)*c,i=(t.min.x-d.x)*c),h>=0?(r=(t.min.y-d.y)*h,o=(t.max.y-d.y)*h):(r=(t.max.y-d.y)*h,o=(t.min.y-d.y)*h),n>o||r>i||((r>n||isNaN(n))&&(n=r),(o<i||isNaN(i))&&(i=o),f>=0?(a=(t.min.z-d.z)*f,l=(t.max.z-d.z)*f):(a=(t.max.z-d.z)*f,l=(t.min.z-d.z)*f),n>l||a>i)||((a>n||n!==n)&&(n=a),(l<i||i!==i)&&(i=l),i<0)?null:this.at(n>=0?n:i,e)}intersectsBox(t){return this.intersectBox(t,cr)!==null}intersectTriangle(t,e,n,i,r){km.subVectors(e,t),Th.subVectors(n,t),Um.crossVectors(km,Th);let o=this.direction.dot(Um),a;if(o>0){if(i)return null;a=1}else if(o<0)a=-1,o=-o;else return null;Vr.subVectors(this.origin,t);const l=a*this.direction.dot(Th.crossVectors(Vr,Th));if(l<0)return null;const c=a*this.direction.dot(km.cross(Vr));if(c<0||l+c>o)return null;const h=-a*Vr.dot(Um);return h<0?null:this.at(h/o,r)}applyMatrix4(t){return this.origin.applyMatrix4(t),this.direction.transformDirection(t),this}equals(t){return t.origin.equals(this.origin)&&t.direction.equals(this.direction)}clone(){return new this.constructor().copy(this)}}let de=class iv{constructor(t,e,n,i,r,o,a,l,c,h,f,d,m,g,y,_){iv.prototype.isMatrix4=!0,this.elements=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],t!==void 0&&this.set(t,e,n,i,r,o,a,l,c,h,f,d,m,g,y,_)}set(t,e,n,i,r,o,a,l,c,h,f,d,m,g,y,_){const v=this.elements;return v[0]=t,v[4]=e,v[8]=n,v[12]=i,v[1]=r,v[5]=o,v[9]=a,v[13]=l,v[2]=c,v[6]=h,v[10]=f,v[14]=d,v[3]=m,v[7]=g,v[11]=y,v[15]=_,this}identity(){return this.set(1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1),this}clone(){return new iv().fromArray(this.elements)}copy(t){const e=this.elements,n=t.elements;return e[0]=n[0],e[1]=n[1],e[2]=n[2],e[3]=n[3],e[4]=n[4],e[5]=n[5],e[6]=n[6],e[7]=n[7],e[8]=n[8],e[9]=n[9],e[10]=n[10],e[11]=n[11],e[12]=n[12],e[13]=n[13],e[14]=n[14],e[15]=n[15],this}copyPosition(t){const e=this.elements,n=t.elements;return e[12]=n[12],e[13]=n[13],e[14]=n[14],this}setFromMatrix3(t){const e=t.elements;return this.set(e[0],e[3],e[6],0,e[1],e[4],e[7],0,e[2],e[5],e[8],0,0,0,0,1),this}extractBasis(t,e,n){return t.setFromMatrixColumn(this,0),e.setFromMatrixColumn(this,1),n.setFromMatrixColumn(this,2),this}makeBasis(t,e,n){return this.set(t.x,e.x,n.x,0,t.y,e.y,n.y,0,t.z,e.z,n.z,0,0,0,0,1),this}extractRotation(t){const e=this.elements,n=t.elements,i=1/Ba.setFromMatrixColumn(t,0).length(),r=1/Ba.setFromMatrixColumn(t,1).length(),o=1/Ba.setFromMatrixColumn(t,2).length();return e[0]=n[0]*i,e[1]=n[1]*i,e[2]=n[2]*i,e[3]=0,e[4]=n[4]*r,e[5]=n[5]*r,e[6]=n[6]*r,e[7]=0,e[8]=n[8]*o,e[9]=n[9]*o,e[10]=n[10]*o,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,this}makeRotationFromEuler(t){const e=this.elements,n=t.x,i=t.y,r=t.z,o=Math.cos(n),a=Math.sin(n),l=Math.cos(i),c=Math.sin(i),h=Math.cos(r),f=Math.sin(r);if(t.order==="XYZ"){const d=o*h,m=o*f,g=a*h,y=a*f;e[0]=l*h,e[4]=-l*f,e[8]=c,e[1]=m+g*c,e[5]=d-y*c,e[9]=-a*l,e[2]=y-d*c,e[6]=g+m*c,e[10]=o*l}else if(t.order==="YXZ"){const d=l*h,m=l*f,g=c*h,y=c*f;e[0]=d+y*a,e[4]=g*a-m,e[8]=o*c,e[1]=o*f,e[5]=o*h,e[9]=-a,e[2]=m*a-g,e[6]=y+d*a,e[10]=o*l}else if(t.order==="ZXY"){const d=l*h,m=l*f,g=c*h,y=c*f;e[0]=d-y*a,e[4]=-o*f,e[8]=g+m*a,e[1]=m+g*a,e[5]=o*h,e[9]=y-d*a,e[2]=-o*c,e[6]=a,e[10]=o*l}else if(t.order==="ZYX"){const d=o*h,m=o*f,g=a*h,y=a*f;e[0]=l*h,e[4]=g*c-m,e[8]=d*c+y,e[1]=l*f,e[5]=y*c+d,e[9]=m*c-g,e[2]=-c,e[6]=a*l,e[10]=o*l}else if(t.order==="YZX"){const d=o*l,m=o*c,g=a*l,y=a*c;e[0]=l*h,e[4]=y-d*f,e[8]=g*f+m,e[1]=f,e[5]=o*h,e[9]=-a*h,e[2]=-c*h,e[6]=m*f+g,e[10]=d-y*f}else if(t.order==="XZY"){const d=o*l,m=o*c,g=a*l,y=a*c;e[0]=l*h,e[4]=-f,e[8]=c*h,e[1]=d*f+y,e[5]=o*h,e[9]=m*f-g,e[2]=g*f-m,e[6]=a*h,e[10]=y*f+d}return e[3]=0,e[7]=0,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,this}makeRotationFromQuaternion(t){return this.compose(zk,t,kk)}lookAt(t,e,n){const i=this.elements;return Oi.subVectors(t,e),Oi.lengthSq()===0&&(Oi.z=1),Oi.normalize(),Gr.crossVectors(n,Oi),Gr.lengthSq()===0&&(Math.abs(n.z)===1?Oi.x+=1e-4:Oi.z+=1e-4,Oi.normalize(),Gr.crossVectors(n,Oi)),Gr.normalize(),Ch.crossVectors(Oi,Gr),i[0]=Gr.x,i[4]=Ch.x,i[8]=Oi.x,i[1]=Gr.y,i[5]=Ch.y,i[9]=Oi.y,i[2]=Gr.z,i[6]=Ch.z,i[10]=Oi.z,this}multiply(t){return this.multiplyMatrices(this,t)}premultiply(t){return this.multiplyMatrices(t,this)}multiplyMatrices(t,e){const n=t.elements,i=e.elements,r=this.elements,o=n[0],a=n[4],l=n[8],c=n[12],h=n[1],f=n[5],d=n[9],m=n[13],g=n[2],y=n[6],_=n[10],v=n[14],w=n[3],b=n[7],M=n[11],A=n[15],T=i[0],P=i[4],C=i[8],S=i[12],L=i[1],H=i[5],$=i[9],B=i[13],G=i[2],I=i[6],et=i[10],Y=i[14],J=i[3],ut=i[7],dt=i[11],nt=i[15];return r[0]=o*T+a*L+l*G+c*J,r[4]=o*P+a*H+l*I+c*ut,r[8]=o*C+a*$+l*et+c*dt,r[12]=o*S+a*B+l*Y+c*nt,r[1]=h*T+f*L+d*G+m*J,r[5]=h*P+f*H+d*I+m*ut,r[9]=h*C+f*$+d*et+m*dt,r[13]=h*S+f*B+d*Y+m*nt,r[2]=g*T+y*L+_*G+v*J,r[6]=g*P+y*H+_*I+v*ut,r[10]=g*C+y*$+_*et+v*dt,r[14]=g*S+y*B+_*Y+v*nt,r[3]=w*T+b*L+M*G+A*J,r[7]=w*P+b*H+M*I+A*ut,r[11]=w*C+b*$+M*et+A*dt,r[15]=w*S+b*B+M*Y+A*nt,this}multiplyScalar(t){const e=this.elements;return e[0]*=t,e[4]*=t,e[8]*=t,e[12]*=t,e[1]*=t,e[5]*=t,e[9]*=t,e[13]*=t,e[2]*=t,e[6]*=t,e[10]*=t,e[14]*=t,e[3]*=t,e[7]*=t,e[11]*=t,e[15]*=t,this}determinant(){const t=this.elements,e=t[0],n=t[4],i=t[8],r=t[12],o=t[1],a=t[5],l=t[9],c=t[13],h=t[2],f=t[6],d=t[10],m=t[14],g=t[3],y=t[7],_=t[11],v=t[15];return g*(+r*l*f-i*c*f-r*a*d+n*c*d+i*a*m-n*l*m)+y*(+e*l*m-e*c*d+r*o*d-i*o*m+i*c*h-r*l*h)+_*(+e*c*f-e*a*m-r*o*f+n*o*m+r*a*h-n*c*h)+v*(-i*a*h-e*l*f+e*a*d+i*o*f-n*o*d+n*l*h)}transpose(){const t=this.elements;let e;return e=t[1],t[1]=t[4],t[4]=e,e=t[2],t[2]=t[8],t[8]=e,e=t[6],t[6]=t[9],t[9]=e,e=t[3],t[3]=t[12],t[12]=e,e=t[7],t[7]=t[13],t[13]=e,e=t[11],t[11]=t[14],t[14]=e,this}setPosition(t,e,n){const i=this.elements;return t.isVector3?(i[12]=t.x,i[13]=t.y,i[14]=t.z):(i[12]=t,i[13]=e,i[14]=n),this}invert(){const t=this.elements,e=t[0],n=t[1],i=t[2],r=t[3],o=t[4],a=t[5],l=t[6],c=t[7],h=t[8],f=t[9],d=t[10],m=t[11],g=t[12],y=t[13],_=t[14],v=t[15],w=f*_*c-y*d*c+y*l*m-a*_*m-f*l*v+a*d*v,b=g*d*c-h*_*c-g*l*m+o*_*m+h*l*v-o*d*v,M=h*y*c-g*f*c+g*a*m-o*y*m-h*a*v+o*f*v,A=g*f*l-h*y*l-g*a*d+o*y*d+h*a*_-o*f*_,T=e*w+n*b+i*M+r*A;if(T===0)return this.set(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0);const P=1/T;return t[0]=w*P,t[1]=(y*d*r-f*_*r-y*i*m+n*_*m+f*i*v-n*d*v)*P,t[2]=(a*_*r-y*l*r+y*i*c-n*_*c-a*i*v+n*l*v)*P,t[3]=(f*l*r-a*d*r-f*i*c+n*d*c+a*i*m-n*l*m)*P,t[4]=b*P,t[5]=(h*_*r-g*d*r+g*i*m-e*_*m-h*i*v+e*d*v)*P,t[6]=(g*l*r-o*_*r-g*i*c+e*_*c+o*i*v-e*l*v)*P,t[7]=(o*d*r-h*l*r+h*i*c-e*d*c-o*i*m+e*l*m)*P,t[8]=M*P,t[9]=(g*f*r-h*y*r-g*n*m+e*y*m+h*n*v-e*f*v)*P,t[10]=(o*y*r-g*a*r+g*n*c-e*y*c-o*n*v+e*a*v)*P,t[11]=(h*a*r-o*f*r-h*n*c+e*f*c+o*n*m-e*a*m)*P,t[12]=A*P,t[13]=(h*y*i-g*f*i+g*n*d-e*y*d-h*n*_+e*f*_)*P,t[14]=(g*a*i-o*y*i-g*n*l+e*y*l+o*n*_-e*a*_)*P,t[15]=(o*f*i-h*a*i+h*n*l-e*f*l-o*n*d+e*a*d)*P,this}scale(t){const e=this.elements,n=t.x,i=t.y,r=t.z;return e[0]*=n,e[4]*=i,e[8]*=r,e[1]*=n,e[5]*=i,e[9]*=r,e[2]*=n,e[6]*=i,e[10]*=r,e[3]*=n,e[7]*=i,e[11]*=r,this}getMaxScaleOnAxis(){const t=this.elements,e=t[0]*t[0]+t[1]*t[1]+t[2]*t[2],n=t[4]*t[4]+t[5]*t[5]+t[6]*t[6],i=t[8]*t[8]+t[9]*t[9]+t[10]*t[10];return Math.sqrt(Math.max(e,n,i))}makeTranslation(t,e,n){return t.isVector3?this.set(1,0,0,t.x,0,1,0,t.y,0,0,1,t.z,0,0,0,1):this.set(1,0,0,t,0,1,0,e,0,0,1,n,0,0,0,1),this}makeRotationX(t){const e=Math.cos(t),n=Math.sin(t);return this.set(1,0,0,0,0,e,-n,0,0,n,e,0,0,0,0,1),this}makeRotationY(t){const e=Math.cos(t),n=Math.sin(t);return this.set(e,0,n,0,0,1,0,0,-n,0,e,0,0,0,0,1),this}makeRotationZ(t){const e=Math.cos(t),n=Math.sin(t);return this.set(e,-n,0,0,n,e,0,0,0,0,1,0,0,0,0,1),this}makeRotationAxis(t,e){const n=Math.cos(e),i=Math.sin(e),r=1-n,o=t.x,a=t.y,l=t.z,c=r*o,h=r*a;return this.set(c*o+n,c*a-i*l,c*l+i*a,0,c*a+i*l,h*a+n,h*l-i*o,0,c*l-i*a,h*l+i*o,r*l*l+n,0,0,0,0,1),this}makeScale(t,e,n){return this.set(t,0,0,0,0,e,0,0,0,0,n,0,0,0,0,1),this}makeShear(t,e,n,i,r,o){return this.set(1,n,r,0,t,1,o,0,e,i,1,0,0,0,0,1),this}compose(t,e,n){const i=this.elements,r=e._x,o=e._y,a=e._z,l=e._w,c=r+r,h=o+o,f=a+a,d=r*c,m=r*h,g=r*f,y=o*h,_=o*f,v=a*f,w=l*c,b=l*h,M=l*f,A=n.x,T=n.y,P=n.z;return i[0]=(1-(y+v))*A,i[1]=(m+M)*A,i[2]=(g-b)*A,i[3]=0,i[4]=(m-M)*T,i[5]=(1-(d+v))*T,i[6]=(_+w)*T,i[7]=0,i[8]=(g+b)*P,i[9]=(_-w)*P,i[10]=(1-(d+y))*P,i[11]=0,i[12]=t.x,i[13]=t.y,i[14]=t.z,i[15]=1,this}decompose(t,e,n){const i=this.elements;let r=Ba.set(i[0],i[1],i[2]).length();const o=Ba.set(i[4],i[5],i[6]).length(),a=Ba.set(i[8],i[9],i[10]).length();this.determinant()<0&&(r=-r),t.x=i[12],t.y=i[13],t.z=i[14],gs.copy(this);const c=1/r,h=1/o,f=1/a;return gs.elements[0]*=c,gs.elements[1]*=c,gs.elements[2]*=c,gs.elements[4]*=h,gs.elements[5]*=h,gs.elements[6]*=h,gs.elements[8]*=f,gs.elements[9]*=f,gs.elements[10]*=f,e.setFromRotationMatrix(gs),n.x=r,n.y=o,n.z=a,this}makePerspective(t,e,n,i,r,o,a=Us){const l=this.elements,c=2*r/(e-t),h=2*r/(n-i),f=(e+t)/(e-t),d=(n+i)/(n-i);let m,g;if(a===Us)m=-(o+r)/(o-r),g=-2*o*r/(o-r);else if(a===Yc)m=-o/(o-r),g=-o*r/(o-r);else throw new Error("THREE.Matrix4.makePerspective(): Invalid coordinate system: "+a);return l[0]=c,l[4]=0,l[8]=f,l[12]=0,l[1]=0,l[5]=h,l[9]=d,l[13]=0,l[2]=0,l[6]=0,l[10]=m,l[14]=g,l[3]=0,l[7]=0,l[11]=-1,l[15]=0,this}makeOrthographic(t,e,n,i,r,o,a=Us){const l=this.elements,c=1/(e-t),h=1/(n-i),f=1/(o-r),d=(e+t)*c,m=(n+i)*h;let g,y;if(a===Us)g=(o+r)*f,y=-2*f;else if(a===Yc)g=r*f,y=-1*f;else throw new Error("THREE.Matrix4.makeOrthographic(): Invalid coordinate system: "+a);return l[0]=2*c,l[4]=0,l[8]=0,l[12]=-d,l[1]=0,l[5]=2*h,l[9]=0,l[13]=-m,l[2]=0,l[6]=0,l[10]=y,l[14]=-g,l[3]=0,l[7]=0,l[11]=0,l[15]=1,this}equals(t){const e=this.elements,n=t.elements;for(let i=0;i<16;i++)if(e[i]!==n[i])return!1;return!0}fromArray(t,e=0){for(let n=0;n<16;n++)this.elements[n]=t[n+e];return this}toArray(t=[],e=0){const n=this.elements;return t[e]=n[0],t[e+1]=n[1],t[e+2]=n[2],t[e+3]=n[3],t[e+4]=n[4],t[e+5]=n[5],t[e+6]=n[6],t[e+7]=n[7],t[e+8]=n[8],t[e+9]=n[9],t[e+10]=n[10],t[e+11]=n[11],t[e+12]=n[12],t[e+13]=n[13],t[e+14]=n[14],t[e+15]=n[15],t}};const Ba=new N,gs=new de,zk=new N(0,0,0),kk=new N(1,1,1),Gr=new N,Ch=new N,Oi=new N,fb=new de,db=new Pn;class ca{constructor(t=0,e=0,n=0,i=ca.DEFAULT_ORDER){this.isEuler=!0,this._x=t,this._y=e,this._z=n,this._order=i}get x(){return this._x}set x(t){this._x=t,this._onChangeCallback()}get y(){return this._y}set y(t){this._y=t,this._onChangeCallback()}get z(){return this._z}set z(t){this._z=t,this._onChangeCallback()}get order(){return this._order}set order(t){this._order=t,this._onChangeCallback()}set(t,e,n,i=this._order){return this._x=t,this._y=e,this._z=n,this._order=i,this._onChangeCallback(),this}clone(){return new this.constructor(this._x,this._y,this._z,this._order)}copy(t){return this._x=t._x,this._y=t._y,this._z=t._z,this._order=t._order,this._onChangeCallback(),this}setFromRotationMatrix(t,e=this._order,n=!0){const i=t.elements,r=i[0],o=i[4],a=i[8],l=i[1],c=i[5],h=i[9],f=i[2],d=i[6],m=i[10];switch(e){case"XYZ":this._y=Math.asin(yn(a,-1,1)),Math.abs(a)<.9999999?(this._x=Math.atan2(-h,m),this._z=Math.atan2(-o,r)):(this._x=Math.atan2(d,c),this._z=0);break;case"YXZ":this._x=Math.asin(-yn(h,-1,1)),Math.abs(h)<.9999999?(this._y=Math.atan2(a,m),this._z=Math.atan2(l,c)):(this._y=Math.atan2(-f,r),this._z=0);break;case"ZXY":this._x=Math.asin(yn(d,-1,1)),Math.abs(d)<.9999999?(this._y=Math.atan2(-f,m),this._z=Math.atan2(-o,c)):(this._y=0,this._z=Math.atan2(l,r));break;case"ZYX":this._y=Math.asin(-yn(f,-1,1)),Math.abs(f)<.9999999?(this._x=Math.atan2(d,m),this._z=Math.atan2(l,r)):(this._x=0,this._z=Math.atan2(-o,c));break;case"YZX":this._z=Math.asin(yn(l,-1,1)),Math.abs(l)<.9999999?(this._x=Math.atan2(-h,c),this._y=Math.atan2(-f,r)):(this._x=0,this._y=Math.atan2(a,m));break;case"XZY":this._z=Math.asin(-yn(o,-1,1)),Math.abs(o)<.9999999?(this._x=Math.atan2(d,c),this._y=Math.atan2(a,r)):(this._x=Math.atan2(-h,m),this._y=0);break;default:console.warn("THREE.Euler: .setFromRotationMatrix() encountered an unknown order: "+e)}return this._order=e,n===!0&&this._onChangeCallback(),this}setFromQuaternion(t,e,n){return fb.makeRotationFromQuaternion(t),this.setFromRotationMatrix(fb,e,n)}setFromVector3(t,e=this._order){return this.set(t.x,t.y,t.z,e)}reorder(t){return db.setFromEuler(this),this.setFromQuaternion(db,t)}equals(t){return t._x===this._x&&t._y===this._y&&t._z===this._z&&t._order===this._order}fromArray(t){return this._x=t[0],this._y=t[1],this._z=t[2],t[3]!==void 0&&(this._order=t[3]),this._onChangeCallback(),this}toArray(t=[],e=0){return t[e]=this._x,t[e+1]=this._y,t[e+2]=this._z,t[e+3]=this._order,t}_onChange(t){return this._onChangeCallback=t,this}_onChangeCallback(){}*[Symbol.iterator](){yield this._x,yield this._y,yield this._z,yield this._order}}ca.DEFAULT_ORDER="XYZ";class dd{constructor(){this.mask=1}set(t){this.mask=(1<<t|0)>>>0}enable(t){this.mask|=1<<t|0}enableAll(){this.mask=-1}toggle(t){this.mask^=1<<t|0}disable(t){this.mask&=~(1<<t|0)}disableAll(){this.mask=0}test(t){return(this.mask&t.mask)!==0}isEnabled(t){return(this.mask&(1<<t|0))!==0}}let Uk=0;const pb=new N,Ha=new Pn,ur=new de,Ph=new N,mc=new N,Nk=new N,Fk=new Pn,mb=new N(1,0,0),gb=new N(0,1,0),vb=new N(0,0,1),Bk={type:"added"},_b={type:"removed"};class Ne extends Gi{constructor(){super(),this.isObject3D=!0,Object.defineProperty(this,"id",{value:Uk++}),this.uuid=qi(),this.name="",this.type="Object3D",this.parent=null,this.children=[],this.up=Ne.DEFAULT_UP.clone();const t=new N,e=new ca,n=new Pn,i=new N(1,1,1);function r(){n.setFromEuler(e,!1)}function o(){e.setFromQuaternion(n,void 0,!1)}e._onChange(r),n._onChange(o),Object.defineProperties(this,{position:{configurable:!0,enumerable:!0,value:t},rotation:{configurable:!0,enumerable:!0,value:e},quaternion:{configurable:!0,enumerable:!0,value:n},scale:{configurable:!0,enumerable:!0,value:i},modelViewMatrix:{value:new de},normalMatrix:{value:new Te}}),this.matrix=new de,this.matrixWorld=new de,this.matrixAutoUpdate=Ne.DEFAULT_MATRIX_AUTO_UPDATE,this.matrixWorldNeedsUpdate=!1,this.matrixWorldAutoUpdate=Ne.DEFAULT_MATRIX_WORLD_AUTO_UPDATE,this.layers=new dd,this.visible=!0,this.castShadow=!1,this.receiveShadow=!1,this.frustumCulled=!0,this.renderOrder=0,this.animations=[],this.userData={}}onBeforeRender(){}onAfterRender(){}applyMatrix4(t){this.matrixAutoUpdate&&this.updateMatrix(),this.matrix.premultiply(t),this.matrix.decompose(this.position,this.quaternion,this.scale)}applyQuaternion(t){return this.quaternion.premultiply(t),this}setRotationFromAxisAngle(t,e){this.quaternion.setFromAxisAngle(t,e)}setRotationFromEuler(t){this.quaternion.setFromEuler(t,!0)}setRotationFromMatrix(t){this.quaternion.setFromRotationMatrix(t)}setRotationFromQuaternion(t){this.quaternion.copy(t)}rotateOnAxis(t,e){return Ha.setFromAxisAngle(t,e),this.quaternion.multiply(Ha),this}rotateOnWorldAxis(t,e){return Ha.setFromAxisAngle(t,e),this.quaternion.premultiply(Ha),this}rotateX(t){return this.rotateOnAxis(mb,t)}rotateY(t){return this.rotateOnAxis(gb,t)}rotateZ(t){return this.rotateOnAxis(vb,t)}translateOnAxis(t,e){return pb.copy(t).applyQuaternion(this.quaternion),this.position.add(pb.multiplyScalar(e)),this}translateX(t){return this.translateOnAxis(mb,t)}translateY(t){return this.translateOnAxis(gb,t)}translateZ(t){return this.translateOnAxis(vb,t)}localToWorld(t){return this.updateWorldMatrix(!0,!1),t.applyMatrix4(this.matrixWorld)}worldToLocal(t){return this.updateWorldMatrix(!0,!1),t.applyMatrix4(ur.copy(this.matrixWorld).invert())}lookAt(t,e,n){t.isVector3?Ph.copy(t):Ph.set(t,e,n);const i=this.parent;this.updateWorldMatrix(!0,!1),mc.setFromMatrixPosition(this.matrixWorld),this.isCamera||this.isLight?ur.lookAt(mc,Ph,this.up):ur.lookAt(Ph,mc,this.up),this.quaternion.setFromRotationMatrix(ur),i&&(ur.extractRotation(i.matrixWorld),Ha.setFromRotationMatrix(ur),this.quaternion.premultiply(Ha.invert()))}add(t){if(arguments.length>1){for(let e=0;e<arguments.length;e++)this.add(arguments[e]);return this}return t===this?(console.error("THREE.Object3D.add: object can't be added as a child of itself.",t),this):(t&&t.isObject3D?(t.parent!==null&&t.parent.remove(t),t.parent=this,this.children.push(t),t.dispatchEvent(Bk)):console.error("THREE.Object3D.add: object not an instance of THREE.Object3D.",t),this)}remove(t){if(arguments.length>1){for(let n=0;n<arguments.length;n++)this.remove(arguments[n]);return this}const e=this.children.indexOf(t);return e!==-1&&(t.parent=null,this.children.splice(e,1),t.dispatchEvent(_b)),this}removeFromParent(){const t=this.parent;return t!==null&&t.remove(this),this}clear(){for(let t=0;t<this.children.length;t++){const e=this.children[t];e.parent=null,e.dispatchEvent(_b)}return this.children.length=0,this}attach(t){return this.updateWorldMatrix(!0,!1),ur.copy(this.matrixWorld).invert(),t.parent!==null&&(t.parent.updateWorldMatrix(!0,!1),ur.multiply(t.parent.matrixWorld)),t.applyMatrix4(ur),this.add(t),t.updateWorldMatrix(!1,!0),this}getObjectById(t){return this.getObjectByProperty("id",t)}getObjectByName(t){return this.getObjectByProperty("name",t)}getObjectByProperty(t,e){if(this[t]===e)return this;for(let n=0,i=this.children.length;n<i;n++){const o=this.children[n].getObjectByProperty(t,e);if(o!==void 0)return o}}getObjectsByProperty(t,e){let n=[];this[t]===e&&n.push(this);for(let i=0,r=this.children.length;i<r;i++){const o=this.children[i].getObjectsByProperty(t,e);o.length>0&&(n=n.concat(o))}return n}getWorldPosition(t){return this.updateWorldMatrix(!0,!1),t.setFromMatrixPosition(this.matrixWorld)}getWorldQuaternion(t){return this.updateWorldMatrix(!0,!1),this.matrixWorld.decompose(mc,t,Nk),t}getWorldScale(t){return this.updateWorldMatrix(!0,!1),this.matrixWorld.decompose(mc,Fk,t),t}getWorldDirection(t){this.updateWorldMatrix(!0,!1);const e=this.matrixWorld.elements;return t.set(e[8],e[9],e[10]).normalize()}raycast(){}traverse(t){t(this);const e=this.children;for(let n=0,i=e.length;n<i;n++)e[n].traverse(t)}traverseVisible(t){if(this.visible===!1)return;t(this);const e=this.children;for(let n=0,i=e.length;n<i;n++)e[n].traverseVisible(t)}traverseAncestors(t){const e=this.parent;e!==null&&(t(e),e.traverseAncestors(t))}updateMatrix(){this.matrix.compose(this.position,this.quaternion,this.scale),this.matrixWorldNeedsUpdate=!0}updateMatrixWorld(t){this.matrixAutoUpdate&&this.updateMatrix(),(this.matrixWorldNeedsUpdate||t)&&(this.parent===null?this.matrixWorld.copy(this.matrix):this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.matrix),this.matrixWorldNeedsUpdate=!1,t=!0);const e=this.children;for(let n=0,i=e.length;n<i;n++){const r=e[n];(r.matrixWorldAutoUpdate===!0||t===!0)&&r.updateMatrixWorld(t)}}updateWorldMatrix(t,e){const n=this.parent;if(t===!0&&n!==null&&n.matrixWorldAutoUpdate===!0&&n.updateWorldMatrix(!0,!1),this.matrixAutoUpdate&&this.updateMatrix(),this.parent===null?this.matrixWorld.copy(this.matrix):this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.matrix),e===!0){const i=this.children;for(let r=0,o=i.length;r<o;r++){const a=i[r];a.matrixWorldAutoUpdate===!0&&a.updateWorldMatrix(!1,!0)}}}toJSON(t){const e=t===void 0||typeof t=="string",n={};e&&(t={geometries:{},materials:{},textures:{},images:{},shapes:{},skeletons:{},animations:{},nodes:{}},n.metadata={version:4.6,type:"Object",generator:"Object3D.toJSON"});const i={};i.uuid=this.uuid,i.type=this.type,this.name!==""&&(i.name=this.name),this.castShadow===!0&&(i.castShadow=!0),this.receiveShadow===!0&&(i.receiveShadow=!0),this.visible===!1&&(i.visible=!1),this.frustumCulled===!1&&(i.frustumCulled=!1),this.renderOrder!==0&&(i.renderOrder=this.renderOrder),Object.keys(this.userData).length>0&&(i.userData=this.userData),i.layers=this.layers.mask,i.matrix=this.matrix.toArray(),i.up=this.up.toArray(),this.matrixAutoUpdate===!1&&(i.matrixAutoUpdate=!1),this.isInstancedMesh&&(i.type="InstancedMesh",i.count=this.count,i.instanceMatrix=this.instanceMatrix.toJSON(),this.instanceColor!==null&&(i.instanceColor=this.instanceColor.toJSON()));function r(a,l){return a[l.uuid]===void 0&&(a[l.uuid]=l.toJSON(t)),l.uuid}if(this.isScene)this.background&&(this.background.isColor?i.background=this.background.toJSON():this.background.isTexture&&(i.background=this.background.toJSON(t).uuid)),this.environment&&this.environment.isTexture&&this.environment.isRenderTargetTexture!==!0&&(i.environment=this.environment.toJSON(t).uuid);else if(this.isMesh||this.isLine||this.isPoints){i.geometry=r(t.geometries,this.geometry);const a=this.geometry.parameters;if(a!==void 0&&a.shapes!==void 0){const l=a.shapes;if(Array.isArray(l))for(let c=0,h=l.length;c<h;c++){const f=l[c];r(t.shapes,f)}else r(t.shapes,l)}}if(this.isSkinnedMesh&&(i.bindMode=this.bindMode,i.bindMatrix=this.bindMatrix.toArray(),this.skeleton!==void 0&&(r(t.skeletons,this.skeleton),i.skeleton=this.skeleton.uuid)),this.material!==void 0)if(Array.isArray(this.material)){const a=[];for(let l=0,c=this.material.length;l<c;l++)a.push(r(t.materials,this.material[l]));i.material=a}else i.material=r(t.materials,this.material);if(this.children.length>0){i.children=[];for(let a=0;a<this.children.length;a++)i.children.push(this.children[a].toJSON(t).object)}if(this.animations.length>0){i.animations=[];for(let a=0;a<this.animations.length;a++){const l=this.animations[a];i.animations.push(r(t.animations,l))}}if(e){const a=o(t.geometries),l=o(t.materials),c=o(t.textures),h=o(t.images),f=o(t.shapes),d=o(t.skeletons),m=o(t.animations),g=o(t.nodes);a.length>0&&(n.geometries=a),l.length>0&&(n.materials=l),c.length>0&&(n.textures=c),h.length>0&&(n.images=h),f.length>0&&(n.shapes=f),d.length>0&&(n.skeletons=d),m.length>0&&(n.animations=m),g.length>0&&(n.nodes=g)}return n.object=i,n;function o(a){const l=[];for(const c in a){const h=a[c];delete h.metadata,l.push(h)}return l}}clone(t){return new this.constructor().copy(this,t)}copy(t,e=!0){if(this.name=t.name,this.up.copy(t.up),this.position.copy(t.position),this.rotation.order=t.rotation.order,this.quaternion.copy(t.quaternion),this.scale.copy(t.scale),this.matrix.copy(t.matrix),this.matrixWorld.copy(t.matrixWorld),this.matrixAutoUpdate=t.matrixAutoUpdate,this.matrixWorldNeedsUpdate=t.matrixWorldNeedsUpdate,this.matrixWorldAutoUpdate=t.matrixWorldAutoUpdate,this.layers.mask=t.layers.mask,this.visible=t.visible,this.castShadow=t.castShadow,this.receiveShadow=t.receiveShadow,this.frustumCulled=t.frustumCulled,this.renderOrder=t.renderOrder,this.animations=t.animations.slice(),this.userData=JSON.parse(JSON.stringify(t.userData)),e===!0)for(let n=0;n<t.children.length;n++){const i=t.children[n];this.add(i.clone())}return this}}Ne.DEFAULT_UP=new N(0,1,0);Ne.DEFAULT_MATRIX_AUTO_UPDATE=!0;Ne.DEFAULT_MATRIX_WORLD_AUTO_UPDATE=!0;const vs=new N,hr=new N,Nm=new N,fr=new N,Va=new N,Ga=new N,yb=new N,Fm=new N,Bm=new N,Hm=new N;let Rh=!1;class gi{constructor(t=new N,e=new N,n=new N){this.a=t,this.b=e,this.c=n}static getNormal(t,e,n,i){i.subVectors(n,e),vs.subVectors(t,e),i.cross(vs);const r=i.lengthSq();return r>0?i.multiplyScalar(1/Math.sqrt(r)):i.set(0,0,0)}static getBarycoord(t,e,n,i,r){vs.subVectors(i,e),hr.subVectors(n,e),Nm.subVectors(t,e);const o=vs.dot(vs),a=vs.dot(hr),l=vs.dot(Nm),c=hr.dot(hr),h=hr.dot(Nm),f=o*c-a*a;if(f===0)return r.set(-2,-1,-1);const d=1/f,m=(c*l-a*h)*d,g=(o*h-a*l)*d;return r.set(1-m-g,g,m)}static containsPoint(t,e,n,i){return this.getBarycoord(t,e,n,i,fr),fr.x>=0&&fr.y>=0&&fr.x+fr.y<=1}static getUV(t,e,n,i,r,o,a,l){return Rh===!1&&(console.warn("THREE.Triangle.getUV() has been renamed to THREE.Triangle.getInterpolation()."),Rh=!0),this.getInterpolation(t,e,n,i,r,o,a,l)}static getInterpolation(t,e,n,i,r,o,a,l){return this.getBarycoord(t,e,n,i,fr),l.setScalar(0),l.addScaledVector(r,fr.x),l.addScaledVector(o,fr.y),l.addScaledVector(a,fr.z),l}static isFrontFacing(t,e,n,i){return vs.subVectors(n,e),hr.subVectors(t,e),vs.cross(hr).dot(i)<0}set(t,e,n){return this.a.copy(t),this.b.copy(e),this.c.copy(n),this}setFromPointsAndIndices(t,e,n,i){return this.a.copy(t[e]),this.b.copy(t[n]),this.c.copy(t[i]),this}setFromAttributeAndIndices(t,e,n,i){return this.a.fromBufferAttribute(t,e),this.b.fromBufferAttribute(t,n),this.c.fromBufferAttribute(t,i),this}clone(){return new this.constructor().copy(this)}copy(t){return this.a.copy(t.a),this.b.copy(t.b),this.c.copy(t.c),this}getArea(){return vs.subVectors(this.c,this.b),hr.subVectors(this.a,this.b),vs.cross(hr).length()*.5}getMidpoint(t){return t.addVectors(this.a,this.b).add(this.c).multiplyScalar(1/3)}getNormal(t){return gi.getNormal(this.a,this.b,this.c,t)}getPlane(t){return t.setFromCoplanarPoints(this.a,this.b,this.c)}getBarycoord(t,e){return gi.getBarycoord(t,this.a,this.b,this.c,e)}getUV(t,e,n,i,r){return Rh===!1&&(console.warn("THREE.Triangle.getUV() has been renamed to THREE.Triangle.getInterpolation()."),Rh=!0),gi.getInterpolation(t,this.a,this.b,this.c,e,n,i,r)}getInterpolation(t,e,n,i,r){return gi.getInterpolation(t,this.a,this.b,this.c,e,n,i,r)}containsPoint(t){return gi.containsPoint(t,this.a,this.b,this.c)}isFrontFacing(t){return gi.isFrontFacing(this.a,this.b,this.c,t)}intersectsBox(t){return t.intersectsTriangle(this)}closestPointToPoint(t,e){const n=this.a,i=this.b,r=this.c;let o,a;Va.subVectors(i,n),Ga.subVectors(r,n),Fm.subVectors(t,n);const l=Va.dot(Fm),c=Ga.dot(Fm);if(l<=0&&c<=0)return e.copy(n);Bm.subVectors(t,i);const h=Va.dot(Bm),f=Ga.dot(Bm);if(h>=0&&f<=h)return e.copy(i);const d=l*f-h*c;if(d<=0&&l>=0&&h<=0)return o=l/(l-h),e.copy(n).addScaledVector(Va,o);Hm.subVectors(t,r);const m=Va.dot(Hm),g=Ga.dot(Hm);if(g>=0&&m<=g)return e.copy(r);const y=m*c-l*g;if(y<=0&&c>=0&&g<=0)return a=c/(c-g),e.copy(n).addScaledVector(Ga,a);const _=h*g-m*f;if(_<=0&&f-h>=0&&m-g>=0)return yb.subVectors(r,i),a=(f-h)/(f-h+(m-g)),e.copy(i).addScaledVector(yb,a);const v=1/(_+y+d);return o=y*v,a=d*v,e.copy(n).addScaledVector(Va,o).addScaledVector(Ga,a)}equals(t){return t.a.equals(this.a)&&t.b.equals(this.b)&&t.c.equals(this.c)}}let Hk=0,Zn=class extends Gi{constructor(){super(),this.isMaterial=!0,Object.defineProperty(this,"id",{value:Hk++}),this.uuid=qi(),this.name="",this.type="Material",this.blending=Yr,this.side=Mr,this.vertexColors=!1,this.opacity=1,this.transparent=!1,this.alphaHash=!1,this.blendSrc=rd,this.blendDst=od,this.blendEquation=$r,this.blendSrcAlpha=null,this.blendDstAlpha=null,this.blendEquationAlpha=null,this.depthFunc=Nf,this.depthTest=!0,this.depthWrite=!0,this.stencilWriteMask=255,this.stencilFunc=oS,this.stencilRef=0,this.stencilFuncMask=255,this.stencilFail=Cf,this.stencilZFail=Cf,this.stencilZPass=Cf,this.stencilWrite=!1,this.clippingPlanes=null,this.clipIntersection=!1,this.clipShadows=!1,this.shadowSide=null,this.colorWrite=!0,this.precision=null,this.polygonOffset=!1,this.polygonOffsetFactor=0,this.polygonOffsetUnits=0,this.dithering=!1,this.alphaToCoverage=!1,this.premultipliedAlpha=!1,this.forceSinglePass=!1,this.visible=!0,this.toneMapped=!0,this.userData={},this.version=0,this._alphaTest=0}get alphaTest(){return this._alphaTest}set alphaTest(t){this._alphaTest>0!=t>0&&this.version++,this._alphaTest=t}onBuild(){}onBeforeRender(){}onBeforeCompile(){}customProgramCacheKey(){return this.onBeforeCompile.toString()}setValues(t){if(t!==void 0)for(const e in t){const n=t[e];if(n===void 0){console.warn(`THREE.Material: parameter '${e}' has value of undefined.`);continue}const i=this[e];if(i===void 0){console.warn(`THREE.Material: '${e}' is not a property of THREE.${this.type}.`);continue}i&&i.isColor?i.set(n):i&&i.isVector3&&n&&n.isVector3?i.copy(n):this[e]=n}}toJSON(t){const e=t===void 0||typeof t=="string";e&&(t={textures:{},images:{}});const n={metadata:{version:4.6,type:"Material",generator:"Material.toJSON"}};n.uuid=this.uuid,n.type=this.type,this.name!==""&&(n.name=this.name),this.color&&this.color.isColor&&(n.color=this.color.getHex()),this.roughness!==void 0&&(n.roughness=this.roughness),this.metalness!==void 0&&(n.metalness=this.metalness),this.sheen!==void 0&&(n.sheen=this.sheen),this.sheenColor&&this.sheenColor.isColor&&(n.sheenColor=this.sheenColor.getHex()),this.sheenRoughness!==void 0&&(n.sheenRoughness=this.sheenRoughness),this.emissive&&this.emissive.isColor&&(n.emissive=this.emissive.getHex()),this.emissiveIntensity&&this.emissiveIntensity!==1&&(n.emissiveIntensity=this.emissiveIntensity),this.specular&&this.specular.isColor&&(n.specular=this.specular.getHex()),this.specularIntensity!==void 0&&(n.specularIntensity=this.specularIntensity),this.specularColor&&this.specularColor.isColor&&(n.specularColor=this.specularColor.getHex()),this.shininess!==void 0&&(n.shininess=this.shininess),this.clearcoat!==void 0&&(n.clearcoat=this.clearcoat),this.clearcoatRoughness!==void 0&&(n.clearcoatRoughness=this.clearcoatRoughness),this.clearcoatMap&&this.clearcoatMap.isTexture&&(n.clearcoatMap=this.clearcoatMap.toJSON(t).uuid),this.clearcoatRoughnessMap&&this.clearcoatRoughnessMap.isTexture&&(n.clearcoatRoughnessMap=this.clearcoatRoughnessMap.toJSON(t).uuid),this.clearcoatNormalMap&&this.clearcoatNormalMap.isTexture&&(n.clearcoatNormalMap=this.clearcoatNormalMap.toJSON(t).uuid,n.clearcoatNormalScale=this.clearcoatNormalScale.toArray()),this.iridescence!==void 0&&(n.iridescence=this.iridescence),this.iridescenceIOR!==void 0&&(n.iridescenceIOR=this.iridescenceIOR),this.iridescenceThicknessRange!==void 0&&(n.iridescenceThicknessRange=this.iridescenceThicknessRange),this.iridescenceMap&&this.iridescenceMap.isTexture&&(n.iridescenceMap=this.iridescenceMap.toJSON(t).uuid),this.iridescenceThicknessMap&&this.iridescenceThicknessMap.isTexture&&(n.iridescenceThicknessMap=this.iridescenceThicknessMap.toJSON(t).uuid),this.anisotropy!==void 0&&(n.anisotropy=this.anisotropy),this.anisotropyRotation!==void 0&&(n.anisotropyRotation=this.anisotropyRotation),this.anisotropyMap&&this.anisotropyMap.isTexture&&(n.anisotropyMap=this.anisotropyMap.toJSON(t).uuid),this.map&&this.map.isTexture&&(n.map=this.map.toJSON(t).uuid),this.matcap&&this.matcap.isTexture&&(n.matcap=this.matcap.toJSON(t).uuid),this.alphaMap&&this.alphaMap.isTexture&&(n.alphaMap=this.alphaMap.toJSON(t).uuid),this.lightMap&&this.lightMap.isTexture&&(n.lightMap=this.lightMap.toJSON(t).uuid,n.lightMapIntensity=this.lightMapIntensity),this.aoMap&&this.aoMap.isTexture&&(n.aoMap=this.aoMap.toJSON(t).uuid,n.aoMapIntensity=this.aoMapIntensity),this.bumpMap&&this.bumpMap.isTexture&&(n.bumpMap=this.bumpMap.toJSON(t).uuid,n.bumpScale=this.bumpScale),this.normalMap&&this.normalMap.isTexture&&(n.normalMap=this.normalMap.toJSON(t).uuid,n.normalMapType=this.normalMapType,n.normalScale=this.normalScale.toArray()),this.displacementMap&&this.displacementMap.isTexture&&(n.displacementMap=this.displacementMap.toJSON(t).uuid,n.displacementScale=this.displacementScale,n.displacementBias=this.displacementBias),this.roughnessMap&&this.roughnessMap.isTexture&&(n.roughnessMap=this.roughnessMap.toJSON(t).uuid),this.metalnessMap&&this.metalnessMap.isTexture&&(n.metalnessMap=this.metalnessMap.toJSON(t).uuid),this.emissiveMap&&this.emissiveMap.isTexture&&(n.emissiveMap=this.emissiveMap.toJSON(t).uuid),this.specularMap&&this.specularMap.isTexture&&(n.specularMap=this.specularMap.toJSON(t).uuid),this.specularIntensityMap&&this.specularIntensityMap.isTexture&&(n.specularIntensityMap=this.specularIntensityMap.toJSON(t).uuid),this.specularColorMap&&this.specularColorMap.isTexture&&(n.specularColorMap=this.specularColorMap.toJSON(t).uuid),this.envMap&&this.envMap.isTexture&&(n.envMap=this.envMap.toJSON(t).uuid,this.combine!==void 0&&(n.combine=this.combine)),this.envMapIntensity!==void 0&&(n.envMapIntensity=this.envMapIntensity),this.reflectivity!==void 0&&(n.reflectivity=this.reflectivity),this.refractionRatio!==void 0&&(n.refractionRatio=this.refractionRatio),this.gradientMap&&this.gradientMap.isTexture&&(n.gradientMap=this.gradientMap.toJSON(t).uuid),this.transmission!==void 0&&(n.transmission=this.transmission),this.transmissionMap&&this.transmissionMap.isTexture&&(n.transmissionMap=this.transmissionMap.toJSON(t).uuid),this.thickness!==void 0&&(n.thickness=this.thickness),this.thicknessMap&&this.thicknessMap.isTexture&&(n.thicknessMap=this.thicknessMap.toJSON(t).uuid),this.attenuationDistance!==void 0&&this.attenuationDistance!==1/0&&(n.attenuationDistance=this.attenuationDistance),this.attenuationColor!==void 0&&(n.attenuationColor=this.attenuationColor.getHex()),this.size!==void 0&&(n.size=this.size),this.shadowSide!==null&&(n.shadowSide=this.shadowSide),this.sizeAttenuation!==void 0&&(n.sizeAttenuation=this.sizeAttenuation),this.blending!==Yr&&(n.blending=this.blending),this.side!==Mr&&(n.side=this.side),this.vertexColors&&(n.vertexColors=!0),this.opacity<1&&(n.opacity=this.opacity),this.transparent===!0&&(n.transparent=this.transparent),n.depthFunc=this.depthFunc,n.depthTest=this.depthTest,n.depthWrite=this.depthWrite,n.colorWrite=this.colorWrite,n.stencilWrite=this.stencilWrite,n.stencilWriteMask=this.stencilWriteMask,n.stencilFunc=this.stencilFunc,n.stencilRef=this.stencilRef,n.stencilFuncMask=this.stencilFuncMask,n.stencilFail=this.stencilFail,n.stencilZFail=this.stencilZFail,n.stencilZPass=this.stencilZPass,this.rotation!==void 0&&this.rotation!==0&&(n.rotation=this.rotation),this.polygonOffset===!0&&(n.polygonOffset=!0),this.polygonOffsetFactor!==0&&(n.polygonOffsetFactor=this.polygonOffsetFactor),this.polygonOffsetUnits!==0&&(n.polygonOffsetUnits=this.polygonOffsetUnits),this.linewidth!==void 0&&this.linewidth!==1&&(n.linewidth=this.linewidth),this.dashSize!==void 0&&(n.dashSize=this.dashSize),this.gapSize!==void 0&&(n.gapSize=this.gapSize),this.scale!==void 0&&(n.scale=this.scale),this.dithering===!0&&(n.dithering=!0),this.alphaTest>0&&(n.alphaTest=this.alphaTest),this.alphaHash===!0&&(n.alphaHash=this.alphaHash),this.alphaToCoverage===!0&&(n.alphaToCoverage=this.alphaToCoverage),this.premultipliedAlpha===!0&&(n.premultipliedAlpha=this.premultipliedAlpha),this.forceSinglePass===!0&&(n.forceSinglePass=this.forceSinglePass),this.wireframe===!0&&(n.wireframe=this.wireframe),this.wireframeLinewidth>1&&(n.wireframeLinewidth=this.wireframeLinewidth),this.wireframeLinecap!=="round"&&(n.wireframeLinecap=this.wireframeLinecap),this.wireframeLinejoin!=="round"&&(n.wireframeLinejoin=this.wireframeLinejoin),this.flatShading===!0&&(n.flatShading=this.flatShading),this.visible===!1&&(n.visible=!1),this.toneMapped===!1&&(n.toneMapped=!1),this.fog===!1&&(n.fog=!1),Object.keys(this.userData).length>0&&(n.userData=this.userData);function i(r){const o=[];for(const a in r){const l=r[a];delete l.metadata,o.push(l)}return o}if(e){const r=i(t.textures),o=i(t.images);r.length>0&&(n.textures=r),o.length>0&&(n.images=o)}return n}clone(){return new this.constructor().copy(this)}copy(t){this.name=t.name,this.blending=t.blending,this.side=t.side,this.vertexColors=t.vertexColors,this.opacity=t.opacity,this.transparent=t.transparent,this.blendSrc=t.blendSrc,this.blendDst=t.blendDst,this.blendEquation=t.blendEquation,this.blendSrcAlpha=t.blendSrcAlpha,this.blendDstAlpha=t.blendDstAlpha,this.blendEquationAlpha=t.blendEquationAlpha,this.depthFunc=t.depthFunc,this.depthTest=t.depthTest,this.depthWrite=t.depthWrite,this.stencilWriteMask=t.stencilWriteMask,this.stencilFunc=t.stencilFunc,this.stencilRef=t.stencilRef,this.stencilFuncMask=t.stencilFuncMask,this.stencilFail=t.stencilFail,this.stencilZFail=t.stencilZFail,this.stencilZPass=t.stencilZPass,this.stencilWrite=t.stencilWrite;const e=t.clippingPlanes;let n=null;if(e!==null){const i=e.length;n=new Array(i);for(let r=0;r!==i;++r)n[r]=e[r].clone()}return this.clippingPlanes=n,this.clipIntersection=t.clipIntersection,this.clipShadows=t.clipShadows,this.shadowSide=t.shadowSide,this.colorWrite=t.colorWrite,this.precision=t.precision,this.polygonOffset=t.polygonOffset,this.polygonOffsetFactor=t.polygonOffsetFactor,this.polygonOffsetUnits=t.polygonOffsetUnits,this.dithering=t.dithering,this.alphaTest=t.alphaTest,this.alphaHash=t.alphaHash,this.alphaToCoverage=t.alphaToCoverage,this.premultipliedAlpha=t.premultipliedAlpha,this.forceSinglePass=t.forceSinglePass,this.visible=t.visible,this.toneMapped=t.toneMapped,this.userData=JSON.parse(JSON.stringify(t.userData)),this}dispose(){this.dispatchEvent({type:"dispose"})}set needsUpdate(t){t===!0&&this.version++}};const wS={aliceblue:15792383,antiquewhite:16444375,aqua:65535,aquamarine:8388564,azure:15794175,beige:16119260,bisque:16770244,black:0,blanchedalmond:16772045,blue:255,blueviolet:9055202,brown:10824234,burlywood:14596231,cadetblue:6266528,chartreuse:8388352,chocolate:13789470,coral:16744272,cornflowerblue:6591981,cornsilk:16775388,crimson:14423100,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:12092939,darkgray:11119017,darkgreen:25600,darkgrey:11119017,darkkhaki:12433259,darkmagenta:9109643,darkolivegreen:5597999,darkorange:16747520,darkorchid:10040012,darkred:9109504,darksalmon:15308410,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:16716947,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:11674146,floralwhite:16775920,forestgreen:2263842,fuchsia:16711935,gainsboro:14474460,ghostwhite:16316671,gold:16766720,goldenrod:14329120,gray:8421504,green:32768,greenyellow:11403055,grey:8421504,honeydew:15794160,hotpink:16738740,indianred:13458524,indigo:4915330,ivory:16777200,khaki:15787660,lavender:15132410,lavenderblush:16773365,lawngreen:8190976,lemonchiffon:16775885,lightblue:11393254,lightcoral:15761536,lightcyan:14745599,lightgoldenrodyellow:16448210,lightgray:13882323,lightgreen:9498256,lightgrey:13882323,lightpink:16758465,lightsalmon:16752762,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:11584734,lightyellow:16777184,lime:65280,limegreen:3329330,linen:16445670,magenta:16711935,maroon:8388608,mediumaquamarine:6737322,mediumblue:205,mediumorchid:12211667,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:13047173,midnightblue:1644912,mintcream:16121850,mistyrose:16770273,moccasin:16770229,navajowhite:16768685,navy:128,oldlace:16643558,olive:8421376,olivedrab:7048739,orange:16753920,orangered:16729344,orchid:14315734,palegoldenrod:15657130,palegreen:10025880,paleturquoise:11529966,palevioletred:14381203,papayawhip:16773077,peachpuff:16767673,peru:13468991,pink:16761035,plum:14524637,powderblue:11591910,purple:8388736,rebeccapurple:6697881,red:16711680,rosybrown:12357519,royalblue:4286945,saddlebrown:9127187,salmon:16416882,sandybrown:16032864,seagreen:3050327,seashell:16774638,sienna:10506797,silver:12632256,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:16775930,springgreen:65407,steelblue:4620980,tan:13808780,teal:32896,thistle:14204888,tomato:16737095,turquoise:4251856,violet:15631086,wheat:16113331,white:16777215,whitesmoke:16119285,yellow:16776960,yellowgreen:10145074},_s={h:0,s:0,l:0},Lh={h:0,s:0,l:0};function Vm(s,t,e){return e<0&&(e+=1),e>1&&(e-=1),e<1/6?s+(t-s)*6*e:e<1/2?t:e<2/3?s+(t-s)*6*(2/3-e):s}class Vt{constructor(t,e,n){return this.isColor=!0,this.r=1,this.g=1,this.b=1,this.set(t,e,n)}set(t,e,n){if(e===void 0&&n===void 0){const i=t;i&&i.isColor?this.copy(i):typeof i=="number"?this.setHex(i):typeof i=="string"&&this.setStyle(i)}else this.setRGB(t,e,n);return this}setScalar(t){return this.r=t,this.g=t,this.b=t,this}setHex(t,e=ve){return t=Math.floor(t),this.r=(t>>16&255)/255,this.g=(t>>8&255)/255,this.b=(t&255)/255,Ui.toWorkingColorSpace(this,e),this}setRGB(t,e,n,i=Ui.workingColorSpace){return this.r=t,this.g=e,this.b=n,Ui.toWorkingColorSpace(this,i),this}setHSL(t,e,n,i=Ui.workingColorSpace){if(t=u_(t,1),e=yn(e,0,1),n=yn(n,0,1),e===0)this.r=this.g=this.b=n;else{const r=n<=.5?n*(1+e):n+e-n*e,o=2*n-r;this.r=Vm(o,r,t+1/3),this.g=Vm(o,r,t),this.b=Vm(o,r,t-1/3)}return Ui.toWorkingColorSpace(this,i),this}setStyle(t,e=ve){function n(r){r!==void 0&&parseFloat(r)<1&&console.warn("THREE.Color: Alpha component of "+t+" will be ignored.")}let i;if(i=/^(\w+)\(([^\)]*)\)/.exec(t)){let r;const o=i[1],a=i[2];switch(o){case"rgb":case"rgba":if(r=/^\s*(\d+)\s*,\s*(\d+)\s*,\s*(\d+)\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(a))return n(r[4]),this.setRGB(Math.min(255,parseInt(r[1],10))/255,Math.min(255,parseInt(r[2],10))/255,Math.min(255,parseInt(r[3],10))/255,e);if(r=/^\s*(\d+)\%\s*,\s*(\d+)\%\s*,\s*(\d+)\%\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(a))return n(r[4]),this.setRGB(Math.min(100,parseInt(r[1],10))/100,Math.min(100,parseInt(r[2],10))/100,Math.min(100,parseInt(r[3],10))/100,e);break;case"hsl":case"hsla":if(r=/^\s*(\d*\.?\d+)\s*,\s*(\d*\.?\d+)\%\s*,\s*(\d*\.?\d+)\%\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(a))return n(r[4]),this.setHSL(parseFloat(r[1])/360,parseFloat(r[2])/100,parseFloat(r[3])/100,e);break;default:console.warn("THREE.Color: Unknown color model "+t)}}else if(i=/^\#([A-Fa-f\d]+)$/.exec(t)){const r=i[1],o=r.length;if(o===3)return this.setRGB(parseInt(r.charAt(0),16)/15,parseInt(r.charAt(1),16)/15,parseInt(r.charAt(2),16)/15,e);if(o===6)return this.setHex(parseInt(r,16),e);console.warn("THREE.Color: Invalid hex color "+t)}else if(t&&t.length>0)return this.setColorName(t,e);return this}setColorName(t,e=ve){const n=wS[t.toLowerCase()];return n!==void 0?this.setHex(n,e):console.warn("THREE.Color: Unknown color "+t),this}clone(){return new this.constructor(this.r,this.g,this.b)}copy(t){return this.r=t.r,this.g=t.g,this.b=t.b,this}copySRGBToLinear(t){return this.r=pl(t.r),this.g=pl(t.g),this.b=pl(t.b),this}copyLinearToSRGB(t){return this.r=Rm(t.r),this.g=Rm(t.g),this.b=Rm(t.b),this}convertSRGBToLinear(){return this.copySRGBToLinear(this),this}convertLinearToSRGB(){return this.copyLinearToSRGB(this),this}getHex(t=ve){return Ui.fromWorkingColorSpace(jn.copy(this),t),Math.round(yn(jn.r*255,0,255))*65536+Math.round(yn(jn.g*255,0,255))*256+Math.round(yn(jn.b*255,0,255))}getHexString(t=ve){return("000000"+this.getHex(t).toString(16)).slice(-6)}getHSL(t,e=Ui.workingColorSpace){Ui.fromWorkingColorSpace(jn.copy(this),e);const n=jn.r,i=jn.g,r=jn.b,o=Math.max(n,i,r),a=Math.min(n,i,r);let l,c;const h=(a+o)/2;if(a===o)l=0,c=0;else{const f=o-a;switch(c=h<=.5?f/(o+a):f/(2-o-a),o){case n:l=(i-r)/f+(i<r?6:0);break;case i:l=(r-n)/f+2;break;case r:l=(n-i)/f+4;break}l/=6}return t.h=l,t.s=c,t.l=h,t}getRGB(t,e=Ui.workingColorSpace){return Ui.fromWorkingColorSpace(jn.copy(this),e),t.r=jn.r,t.g=jn.g,t.b=jn.b,t}getStyle(t=ve){Ui.fromWorkingColorSpace(jn.copy(this),t);const e=jn.r,n=jn.g,i=jn.b;return t!==ve?`color(${t} ${e.toFixed(3)} ${n.toFixed(3)} ${i.toFixed(3)})`:`rgb(${Math.round(e*255)},${Math.round(n*255)},${Math.round(i*255)})`}offsetHSL(t,e,n){return this.getHSL(_s),_s.h+=t,_s.s+=e,_s.l+=n,this.setHSL(_s.h,_s.s,_s.l),this}add(t){return this.r+=t.r,this.g+=t.g,this.b+=t.b,this}addColors(t,e){return this.r=t.r+e.r,this.g=t.g+e.g,this.b=t.b+e.b,this}addScalar(t){return this.r+=t,this.g+=t,this.b+=t,this}sub(t){return this.r=Math.max(0,this.r-t.r),this.g=Math.max(0,this.g-t.g),this.b=Math.max(0,this.b-t.b),this}multiply(t){return this.r*=t.r,this.g*=t.g,this.b*=t.b,this}multiplyScalar(t){return this.r*=t,this.g*=t,this.b*=t,this}lerp(t,e){return this.r+=(t.r-this.r)*e,this.g+=(t.g-this.g)*e,this.b+=(t.b-this.b)*e,this}lerpColors(t,e,n){return this.r=t.r+(e.r-t.r)*n,this.g=t.g+(e.g-t.g)*n,this.b=t.b+(e.b-t.b)*n,this}lerpHSL(t,e){this.getHSL(_s),t.getHSL(Lh);const n=zc(_s.h,Lh.h,e),i=zc(_s.s,Lh.s,e),r=zc(_s.l,Lh.l,e);return this.setHSL(n,i,r),this}setFromVector3(t){return this.r=t.x,this.g=t.y,this.b=t.z,this}applyMatrix3(t){const e=this.r,n=this.g,i=this.b,r=t.elements;return this.r=r[0]*e+r[3]*n+r[6]*i,this.g=r[1]*e+r[4]*n+r[7]*i,this.b=r[2]*e+r[5]*n+r[8]*i,this}equals(t){return t.r===this.r&&t.g===this.g&&t.b===this.b}fromArray(t,e=0){return this.r=t[e],this.g=t[e+1],this.b=t[e+2],this}toArray(t=[],e=0){return t[e]=this.r,t[e+1]=this.g,t[e+2]=this.b,t}fromBufferAttribute(t,e){return this.r=t.getX(e),this.g=t.getY(e),this.b=t.getZ(e),this}toJSON(){return this.getHex()}*[Symbol.iterator](){yield this.r,yield this.g,yield this.b}}const jn=new Vt;Vt.NAMES=wS;class Tr extends Zn{constructor(t){super(),this.isMeshBasicMaterial=!0,this.type="MeshBasicMaterial",this.color=new Vt(16777215),this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.specularMap=null,this.alphaMap=null,this.envMap=null,this.combine=gu,this.reflectivity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.fog=!0,this.setValues(t)}copy(t){return super.copy(t),this.color.copy(t.color),this.map=t.map,this.lightMap=t.lightMap,this.lightMapIntensity=t.lightMapIntensity,this.aoMap=t.aoMap,this.aoMapIntensity=t.aoMapIntensity,this.specularMap=t.specularMap,this.alphaMap=t.alphaMap,this.envMap=t.envMap,this.combine=t.combine,this.reflectivity=t.reflectivity,this.refractionRatio=t.refractionRatio,this.wireframe=t.wireframe,this.wireframeLinewidth=t.wireframeLinewidth,this.wireframeLinecap=t.wireframeLinecap,this.wireframeLinejoin=t.wireframeLinejoin,this.fog=t.fog,this}}const _r=Vk();function Vk(){const s=new ArrayBuffer(4),t=new Float32Array(s),e=new Uint32Array(s),n=new Uint32Array(512),i=new Uint32Array(512);for(let l=0;l<256;++l){const c=l-127;c<-27?(n[l]=0,n[l|256]=32768,i[l]=24,i[l|256]=24):c<-14?(n[l]=1024>>-c-14,n[l|256]=1024>>-c-14|32768,i[l]=-c-1,i[l|256]=-c-1):c<=15?(n[l]=c+15<<10,n[l|256]=c+15<<10|32768,i[l]=13,i[l|256]=13):c<128?(n[l]=31744,n[l|256]=64512,i[l]=24,i[l|256]=24):(n[l]=31744,n[l|256]=64512,i[l]=13,i[l|256]=13)}const r=new Uint32Array(2048),o=new Uint32Array(64),a=new Uint32Array(64);for(let l=1;l<1024;++l){let c=l<<13,h=0;for(;!(c&8388608);)c<<=1,h-=8388608;c&=-8388609,h+=947912704,r[l]=c|h}for(let l=1024;l<2048;++l)r[l]=939524096+(l-1024<<13);for(let l=1;l<31;++l)o[l]=l<<23;o[31]=1199570944,o[32]=2147483648;for(let l=33;l<63;++l)o[l]=2147483648+(l-32<<23);o[63]=3347054592;for(let l=1;l<64;++l)l!==32&&(a[l]=1024);return{floatView:t,uint32View:e,baseTable:n,shiftTable:i,mantissaTable:r,exponentTable:o,offsetTable:a}}function pi(s){Math.abs(s)>65504&&console.warn("THREE.DataUtils.toHalfFloat(): Value out of range."),s=yn(s,-65504,65504),_r.floatView[0]=s;const t=_r.uint32View[0],e=t>>23&511;return _r.baseTable[e]+((t&8388607)>>_r.shiftTable[e])}function Pc(s){const t=s>>10;return _r.uint32View[0]=_r.mantissaTable[_r.offsetTable[t]+(s&1023)]+_r.exponentTable[t],_r.floatView[0]}const Gk={toHalfFloat:pi,fromHalfFloat:Pc},Tn=new N,Dh=new pt;class ue{constructor(t,e,n=!1){if(Array.isArray(t))throw new TypeError("THREE.BufferAttribute: array should be a Typed Array.");this.isBufferAttribute=!0,this.name="",this.array=t,this.itemSize=e,this.count=t!==void 0?t.length/e:0,this.normalized=n,this.usage=jc,this.updateRange={offset:0,count:-1},this.gpuType=Cn,this.version=0}onUploadCallback(){}set needsUpdate(t){t===!0&&this.version++}setUsage(t){return this.usage=t,this}copy(t){return this.name=t.name,this.array=new t.array.constructor(t.array),this.itemSize=t.itemSize,this.count=t.count,this.normalized=t.normalized,this.usage=t.usage,this.gpuType=t.gpuType,this}copyAt(t,e,n){t*=this.itemSize,n*=e.itemSize;for(let i=0,r=this.itemSize;i<r;i++)this.array[t+i]=e.array[n+i];return this}copyArray(t){return this.array.set(t),this}applyMatrix3(t){if(this.itemSize===2)for(let e=0,n=this.count;e<n;e++)Dh.fromBufferAttribute(this,e),Dh.applyMatrix3(t),this.setXY(e,Dh.x,Dh.y);else if(this.itemSize===3)for(let e=0,n=this.count;e<n;e++)Tn.fromBufferAttribute(this,e),Tn.applyMatrix3(t),this.setXYZ(e,Tn.x,Tn.y,Tn.z);return this}applyMatrix4(t){for(let e=0,n=this.count;e<n;e++)Tn.fromBufferAttribute(this,e),Tn.applyMatrix4(t),this.setXYZ(e,Tn.x,Tn.y,Tn.z);return this}applyNormalMatrix(t){for(let e=0,n=this.count;e<n;e++)Tn.fromBufferAttribute(this,e),Tn.applyNormalMatrix(t),this.setXYZ(e,Tn.x,Tn.y,Tn.z);return this}transformDirection(t){for(let e=0,n=this.count;e<n;e++)Tn.fromBufferAttribute(this,e),Tn.transformDirection(t),this.setXYZ(e,Tn.x,Tn.y,Tn.z);return this}set(t,e=0){return this.array.set(t,e),this}getX(t){let e=this.array[t*this.itemSize];return this.normalized&&(e=Vi(e,this.array)),e}setX(t,e){return this.normalized&&(e=Ae(e,this.array)),this.array[t*this.itemSize]=e,this}getY(t){let e=this.array[t*this.itemSize+1];return this.normalized&&(e=Vi(e,this.array)),e}setY(t,e){return this.normalized&&(e=Ae(e,this.array)),this.array[t*this.itemSize+1]=e,this}getZ(t){let e=this.array[t*this.itemSize+2];return this.normalized&&(e=Vi(e,this.array)),e}setZ(t,e){return this.normalized&&(e=Ae(e,this.array)),this.array[t*this.itemSize+2]=e,this}getW(t){let e=this.array[t*this.itemSize+3];return this.normalized&&(e=Vi(e,this.array)),e}setW(t,e){return this.normalized&&(e=Ae(e,this.array)),this.array[t*this.itemSize+3]=e,this}setXY(t,e,n){return t*=this.itemSize,this.normalized&&(e=Ae(e,this.array),n=Ae(n,this.array)),this.array[t+0]=e,this.array[t+1]=n,this}setXYZ(t,e,n,i){return t*=this.itemSize,this.normalized&&(e=Ae(e,this.array),n=Ae(n,this.array),i=Ae(i,this.array)),this.array[t+0]=e,this.array[t+1]=n,this.array[t+2]=i,this}setXYZW(t,e,n,i,r){return t*=this.itemSize,this.normalized&&(e=Ae(e,this.array),n=Ae(n,this.array),i=Ae(i,this.array),r=Ae(r,this.array)),this.array[t+0]=e,this.array[t+1]=n,this.array[t+2]=i,this.array[t+3]=r,this}onUpload(t){return this.onUploadCallback=t,this}clone(){return new this.constructor(this.array,this.itemSize).copy(this)}toJSON(){const t={itemSize:this.itemSize,type:this.array.constructor.name,array:Array.from(this.array),normalized:this.normalized};return this.name!==""&&(t.name=this.name),this.usage!==jc&&(t.usage=this.usage),(this.updateRange.offset!==0||this.updateRange.count!==-1)&&(t.updateRange=this.updateRange),t}}class qk extends ue{constructor(t,e,n){super(new Int8Array(t),e,n)}}class Wk extends ue{constructor(t,e,n){super(new Uint8Array(t),e,n)}}class $k extends ue{constructor(t,e,n){super(new Uint8ClampedArray(t),e,n)}}class Xk extends ue{constructor(t,e,n){super(new Int16Array(t),e,n)}}class d_ extends ue{constructor(t,e,n){super(new Uint16Array(t),e,n)}}class jk extends ue{constructor(t,e,n){super(new Int32Array(t),e,n)}}class p_ extends ue{constructor(t,e,n){super(new Uint32Array(t),e,n)}}class Yk extends ue{constructor(t,e,n){super(new Uint16Array(t),e,n),this.isFloat16BufferAttribute=!0}getX(t){let e=Pc(this.array[t*this.itemSize]);return this.normalized&&(e=Vi(e,this.array)),e}setX(t,e){return this.normalized&&(e=Ae(e,this.array)),this.array[t*this.itemSize]=pi(e),this}getY(t){let e=Pc(this.array[t*this.itemSize+1]);return this.normalized&&(e=Vi(e,this.array)),e}setY(t,e){return this.normalized&&(e=Ae(e,this.array)),this.array[t*this.itemSize+1]=pi(e),this}getZ(t){let e=Pc(this.array[t*this.itemSize+2]);return this.normalized&&(e=Vi(e,this.array)),e}setZ(t,e){return this.normalized&&(e=Ae(e,this.array)),this.array[t*this.itemSize+2]=pi(e),this}getW(t){let e=Pc(this.array[t*this.itemSize+3]);return this.normalized&&(e=Vi(e,this.array)),e}setW(t,e){return this.normalized&&(e=Ae(e,this.array)),this.array[t*this.itemSize+3]=pi(e),this}setXY(t,e,n){return t*=this.itemSize,this.normalized&&(e=Ae(e,this.array),n=Ae(n,this.array)),this.array[t+0]=pi(e),this.array[t+1]=pi(n),this}setXYZ(t,e,n,i){return t*=this.itemSize,this.normalized&&(e=Ae(e,this.array),n=Ae(n,this.array),i=Ae(i,this.array)),this.array[t+0]=pi(e),this.array[t+1]=pi(n),this.array[t+2]=pi(i),this}setXYZW(t,e,n,i,r){return t*=this.itemSize,this.normalized&&(e=Ae(e,this.array),n=Ae(n,this.array),i=Ae(i,this.array),r=Ae(r,this.array)),this.array[t+0]=pi(e),this.array[t+1]=pi(n),this.array[t+2]=pi(i),this.array[t+3]=pi(r),this}}class jt extends ue{constructor(t,e,n){super(new Float32Array(t),e,n)}}class Zk extends ue{constructor(t,e,n){super(new Float64Array(t),e,n)}}let Kk=0;const os=new de,Gm=new Ne,qa=new N,zi=new js,gc=new js,Un=new N;class we extends Gi{constructor(){super(),this.isBufferGeometry=!0,Object.defineProperty(this,"id",{value:Kk++}),this.uuid=qi(),this.name="",this.type="BufferGeometry",this.index=null,this.attributes={},this.morphAttributes={},this.morphTargetsRelative=!1,this.groups=[],this.boundingBox=null,this.boundingSphere=null,this.drawRange={start:0,count:1/0},this.userData={}}getIndex(){return this.index}setIndex(t){return Array.isArray(t)?this.index=new(yS(t)?p_:d_)(t,1):this.index=t,this}getAttribute(t){return this.attributes[t]}setAttribute(t,e){return this.attributes[t]=e,this}deleteAttribute(t){return delete this.attributes[t],this}hasAttribute(t){return this.attributes[t]!==void 0}addGroup(t,e,n=0){this.groups.push({start:t,count:e,materialIndex:n})}clearGroups(){this.groups=[]}setDrawRange(t,e){this.drawRange.start=t,this.drawRange.count=e}applyMatrix4(t){const e=this.attributes.position;e!==void 0&&(e.applyMatrix4(t),e.needsUpdate=!0);const n=this.attributes.normal;if(n!==void 0){const r=new Te().getNormalMatrix(t);n.applyNormalMatrix(r),n.needsUpdate=!0}const i=this.attributes.tangent;return i!==void 0&&(i.transformDirection(t),i.needsUpdate=!0),this.boundingBox!==null&&this.computeBoundingBox(),this.boundingSphere!==null&&this.computeBoundingSphere(),this}applyQuaternion(t){return os.makeRotationFromQuaternion(t),this.applyMatrix4(os),this}rotateX(t){return os.makeRotationX(t),this.applyMatrix4(os),this}rotateY(t){return os.makeRotationY(t),this.applyMatrix4(os),this}rotateZ(t){return os.makeRotationZ(t),this.applyMatrix4(os),this}translate(t,e,n){return os.makeTranslation(t,e,n),this.applyMatrix4(os),this}scale(t,e,n){return os.makeScale(t,e,n),this.applyMatrix4(os),this}lookAt(t){return Gm.lookAt(t),Gm.updateMatrix(),this.applyMatrix4(Gm.matrix),this}center(){return this.computeBoundingBox(),this.boundingBox.getCenter(qa).negate(),this.translate(qa.x,qa.y,qa.z),this}setFromPoints(t){const e=[];for(let n=0,i=t.length;n<i;n++){const r=t[n];e.push(r.x,r.y,r.z||0)}return this.setAttribute("position",new jt(e,3)),this}computeBoundingBox(){this.boundingBox===null&&(this.boundingBox=new js);const t=this.attributes.position,e=this.morphAttributes.position;if(t&&t.isGLBufferAttribute){console.error('THREE.BufferGeometry.computeBoundingBox(): GLBufferAttribute requires a manual bounding box. Alternatively set "mesh.frustumCulled" to "false".',this),this.boundingBox.set(new N(-1/0,-1/0,-1/0),new N(1/0,1/0,1/0));return}if(t!==void 0){if(this.boundingBox.setFromBufferAttribute(t),e)for(let n=0,i=e.length;n<i;n++){const r=e[n];zi.setFromBufferAttribute(r),this.morphTargetsRelative?(Un.addVectors(this.boundingBox.min,zi.min),this.boundingBox.expandByPoint(Un),Un.addVectors(this.boundingBox.max,zi.max),this.boundingBox.expandByPoint(Un)):(this.boundingBox.expandByPoint(zi.min),this.boundingBox.expandByPoint(zi.max))}}else this.boundingBox.makeEmpty();(isNaN(this.boundingBox.min.x)||isNaN(this.boundingBox.min.y)||isNaN(this.boundingBox.min.z))&&console.error('THREE.BufferGeometry.computeBoundingBox(): Computed min/max have NaN values. The "position" attribute is likely to have NaN values.',this)}computeBoundingSphere(){this.boundingSphere===null&&(this.boundingSphere=new Ts);const t=this.attributes.position,e=this.morphAttributes.position;if(t&&t.isGLBufferAttribute){console.error('THREE.BufferGeometry.computeBoundingSphere(): GLBufferAttribute requires a manual bounding sphere. Alternatively set "mesh.frustumCulled" to "false".',this),this.boundingSphere.set(new N,1/0);return}if(t){const n=this.boundingSphere.center;if(zi.setFromBufferAttribute(t),e)for(let r=0,o=e.length;r<o;r++){const a=e[r];gc.setFromBufferAttribute(a),this.morphTargetsRelative?(Un.addVectors(zi.min,gc.min),zi.expandByPoint(Un),Un.addVectors(zi.max,gc.max),zi.expandByPoint(Un)):(zi.expandByPoint(gc.min),zi.expandByPoint(gc.max))}zi.getCenter(n);let i=0;for(let r=0,o=t.count;r<o;r++)Un.fromBufferAttribute(t,r),i=Math.max(i,n.distanceToSquared(Un));if(e)for(let r=0,o=e.length;r<o;r++){const a=e[r],l=this.morphTargetsRelative;for(let c=0,h=a.count;c<h;c++)Un.fromBufferAttribute(a,c),l&&(qa.fromBufferAttribute(t,c),Un.add(qa)),i=Math.max(i,n.distanceToSquared(Un))}this.boundingSphere.radius=Math.sqrt(i),isNaN(this.boundingSphere.radius)&&console.error('THREE.BufferGeometry.computeBoundingSphere(): Computed radius is NaN. The "position" attribute is likely to have NaN values.',this)}}computeTangents(){const t=this.index,e=this.attributes;if(t===null||e.position===void 0||e.normal===void 0||e.uv===void 0){console.error("THREE.BufferGeometry: .computeTangents() failed. Missing required attributes (index, position, normal or uv)");return}const n=t.array,i=e.position.array,r=e.normal.array,o=e.uv.array,a=i.length/3;this.hasAttribute("tangent")===!1&&this.setAttribute("tangent",new ue(new Float32Array(4*a),4));const l=this.getAttribute("tangent").array,c=[],h=[];for(let L=0;L<a;L++)c[L]=new N,h[L]=new N;const f=new N,d=new N,m=new N,g=new pt,y=new pt,_=new pt,v=new N,w=new N;function b(L,H,$){f.fromArray(i,L*3),d.fromArray(i,H*3),m.fromArray(i,$*3),g.fromArray(o,L*2),y.fromArray(o,H*2),_.fromArray(o,$*2),d.sub(f),m.sub(f),y.sub(g),_.sub(g);const B=1/(y.x*_.y-_.x*y.y);isFinite(B)&&(v.copy(d).multiplyScalar(_.y).addScaledVector(m,-y.y).multiplyScalar(B),w.copy(m).multiplyScalar(y.x).addScaledVector(d,-_.x).multiplyScalar(B),c[L].add(v),c[H].add(v),c[$].add(v),h[L].add(w),h[H].add(w),h[$].add(w))}let M=this.groups;M.length===0&&(M=[{start:0,count:n.length}]);for(let L=0,H=M.length;L<H;++L){const $=M[L],B=$.start,G=$.count;for(let I=B,et=B+G;I<et;I+=3)b(n[I+0],n[I+1],n[I+2])}const A=new N,T=new N,P=new N,C=new N;function S(L){P.fromArray(r,L*3),C.copy(P);const H=c[L];A.copy(H),A.sub(P.multiplyScalar(P.dot(H))).normalize(),T.crossVectors(C,H);const B=T.dot(h[L])<0?-1:1;l[L*4]=A.x,l[L*4+1]=A.y,l[L*4+2]=A.z,l[L*4+3]=B}for(let L=0,H=M.length;L<H;++L){const $=M[L],B=$.start,G=$.count;for(let I=B,et=B+G;I<et;I+=3)S(n[I+0]),S(n[I+1]),S(n[I+2])}}computeVertexNormals(){const t=this.index,e=this.getAttribute("position");if(e!==void 0){let n=this.getAttribute("normal");if(n===void 0)n=new ue(new Float32Array(e.count*3),3),this.setAttribute("normal",n);else for(let d=0,m=n.count;d<m;d++)n.setXYZ(d,0,0,0);const i=new N,r=new N,o=new N,a=new N,l=new N,c=new N,h=new N,f=new N;if(t)for(let d=0,m=t.count;d<m;d+=3){const g=t.getX(d+0),y=t.getX(d+1),_=t.getX(d+2);i.fromBufferAttribute(e,g),r.fromBufferAttribute(e,y),o.fromBufferAttribute(e,_),h.subVectors(o,r),f.subVectors(i,r),h.cross(f),a.fromBufferAttribute(n,g),l.fromBufferAttribute(n,y),c.fromBufferAttribute(n,_),a.add(h),l.add(h),c.add(h),n.setXYZ(g,a.x,a.y,a.z),n.setXYZ(y,l.x,l.y,l.z),n.setXYZ(_,c.x,c.y,c.z)}else for(let d=0,m=e.count;d<m;d+=3)i.fromBufferAttribute(e,d+0),r.fromBufferAttribute(e,d+1),o.fromBufferAttribute(e,d+2),h.subVectors(o,r),f.subVectors(i,r),h.cross(f),n.setXYZ(d+0,h.x,h.y,h.z),n.setXYZ(d+1,h.x,h.y,h.z),n.setXYZ(d+2,h.x,h.y,h.z);this.normalizeNormals(),n.needsUpdate=!0}}normalizeNormals(){const t=this.attributes.normal;for(let e=0,n=t.count;e<n;e++)Un.fromBufferAttribute(t,e),Un.normalize(),t.setXYZ(e,Un.x,Un.y,Un.z)}toNonIndexed(){function t(a,l){const c=a.array,h=a.itemSize,f=a.normalized,d=new c.constructor(l.length*h);let m=0,g=0;for(let y=0,_=l.length;y<_;y++){a.isInterleavedBufferAttribute?m=l[y]*a.data.stride+a.offset:m=l[y]*h;for(let v=0;v<h;v++)d[g++]=c[m++]}return new ue(d,h,f)}if(this.index===null)return console.warn("THREE.BufferGeometry.toNonIndexed(): BufferGeometry is already non-indexed."),this;const e=new we,n=this.index.array,i=this.attributes;for(const a in i){const l=i[a],c=t(l,n);e.setAttribute(a,c)}const r=this.morphAttributes;for(const a in r){const l=[],c=r[a];for(let h=0,f=c.length;h<f;h++){const d=c[h],m=t(d,n);l.push(m)}e.morphAttributes[a]=l}e.morphTargetsRelative=this.morphTargetsRelative;const o=this.groups;for(let a=0,l=o.length;a<l;a++){const c=o[a];e.addGroup(c.start,c.count,c.materialIndex)}return e}toJSON(){const t={metadata:{version:4.6,type:"BufferGeometry",generator:"BufferGeometry.toJSON"}};if(t.uuid=this.uuid,t.type=this.type,this.name!==""&&(t.name=this.name),Object.keys(this.userData).length>0&&(t.userData=this.userData),this.parameters!==void 0){const l=this.parameters;for(const c in l)l[c]!==void 0&&(t[c]=l[c]);return t}t.data={attributes:{}};const e=this.index;e!==null&&(t.data.index={type:e.array.constructor.name,array:Array.prototype.slice.call(e.array)});const n=this.attributes;for(const l in n){const c=n[l];t.data.attributes[l]=c.toJSON(t.data)}const i={};let r=!1;for(const l in this.morphAttributes){const c=this.morphAttributes[l],h=[];for(let f=0,d=c.length;f<d;f++){const m=c[f];h.push(m.toJSON(t.data))}h.length>0&&(i[l]=h,r=!0)}r&&(t.data.morphAttributes=i,t.data.morphTargetsRelative=this.morphTargetsRelative);const o=this.groups;o.length>0&&(t.data.groups=JSON.parse(JSON.stringify(o)));const a=this.boundingSphere;return a!==null&&(t.data.boundingSphere={center:a.center.toArray(),radius:a.radius}),t}clone(){return new this.constructor().copy(this)}copy(t){this.index=null,this.attributes={},this.morphAttributes={},this.groups=[],this.boundingBox=null,this.boundingSphere=null;const e={};this.name=t.name;const n=t.index;n!==null&&this.setIndex(n.clone(e));const i=t.attributes;for(const c in i){const h=i[c];this.setAttribute(c,h.clone(e))}const r=t.morphAttributes;for(const c in r){const h=[],f=r[c];for(let d=0,m=f.length;d<m;d++)h.push(f[d].clone(e));this.morphAttributes[c]=h}this.morphTargetsRelative=t.morphTargetsRelative;const o=t.groups;for(let c=0,h=o.length;c<h;c++){const f=o[c];this.addGroup(f.start,f.count,f.materialIndex)}const a=t.boundingBox;a!==null&&(this.boundingBox=a.clone());const l=t.boundingSphere;return l!==null&&(this.boundingSphere=l.clone()),this.drawRange.start=t.drawRange.start,this.drawRange.count=t.drawRange.count,this.userData=t.userData,this}dispose(){this.dispatchEvent({type:"dispose"})}}const xb=new de,Eo=new la,Ih=new Ts,bb=new N,Wa=new N,$a=new N,Xa=new N,qm=new N,Oh=new N,zh=new pt,kh=new pt,Uh=new pt,wb=new N,Mb=new N,Sb=new N,Nh=new N,Fh=new N;class Xe extends Ne{constructor(t=new we,e=new Tr){super(),this.isMesh=!0,this.type="Mesh",this.geometry=t,this.material=e,this.updateMorphTargets()}copy(t,e){return super.copy(t,e),t.morphTargetInfluences!==void 0&&(this.morphTargetInfluences=t.morphTargetInfluences.slice()),t.morphTargetDictionary!==void 0&&(this.morphTargetDictionary=Object.assign({},t.morphTargetDictionary)),this.material=t.material,this.geometry=t.geometry,this}updateMorphTargets(){const e=this.geometry.morphAttributes,n=Object.keys(e);if(n.length>0){const i=e[n[0]];if(i!==void 0){this.morphTargetInfluences=[],this.morphTargetDictionary={};for(let r=0,o=i.length;r<o;r++){const a=i[r].name||String(r);this.morphTargetInfluences.push(0),this.morphTargetDictionary[a]=r}}}}getVertexPosition(t,e){const n=this.geometry,i=n.attributes.position,r=n.morphAttributes.position,o=n.morphTargetsRelative;e.fromBufferAttribute(i,t);const a=this.morphTargetInfluences;if(r&&a){Oh.set(0,0,0);for(let l=0,c=r.length;l<c;l++){const h=a[l],f=r[l];h!==0&&(qm.fromBufferAttribute(f,t),o?Oh.addScaledVector(qm,h):Oh.addScaledVector(qm.sub(e),h))}e.add(Oh)}return e}raycast(t,e){const n=this.geometry,i=this.material,r=this.matrixWorld;i!==void 0&&(n.boundingSphere===null&&n.computeBoundingSphere(),Ih.copy(n.boundingSphere),Ih.applyMatrix4(r),Eo.copy(t.ray).recast(t.near),!(Ih.containsPoint(Eo.origin)===!1&&(Eo.intersectSphere(Ih,bb)===null||Eo.origin.distanceToSquared(bb)>(t.far-t.near)**2))&&(xb.copy(r).invert(),Eo.copy(t.ray).applyMatrix4(xb),!(n.boundingBox!==null&&Eo.intersectsBox(n.boundingBox)===!1)&&this._computeIntersections(t,e,Eo)))}_computeIntersections(t,e,n){let i;const r=this.geometry,o=this.material,a=r.index,l=r.attributes.position,c=r.attributes.uv,h=r.attributes.uv1,f=r.attributes.normal,d=r.groups,m=r.drawRange;if(a!==null)if(Array.isArray(o))for(let g=0,y=d.length;g<y;g++){const _=d[g],v=o[_.materialIndex],w=Math.max(_.start,m.start),b=Math.min(a.count,Math.min(_.start+_.count,m.start+m.count));for(let M=w,A=b;M<A;M+=3){const T=a.getX(M),P=a.getX(M+1),C=a.getX(M+2);i=Bh(this,v,t,n,c,h,f,T,P,C),i&&(i.faceIndex=Math.floor(M/3),i.face.materialIndex=_.materialIndex,e.push(i))}}else{const g=Math.max(0,m.start),y=Math.min(a.count,m.start+m.count);for(let _=g,v=y;_<v;_+=3){const w=a.getX(_),b=a.getX(_+1),M=a.getX(_+2);i=Bh(this,o,t,n,c,h,f,w,b,M),i&&(i.faceIndex=Math.floor(_/3),e.push(i))}}else if(l!==void 0)if(Array.isArray(o))for(let g=0,y=d.length;g<y;g++){const _=d[g],v=o[_.materialIndex],w=Math.max(_.start,m.start),b=Math.min(l.count,Math.min(_.start+_.count,m.start+m.count));for(let M=w,A=b;M<A;M+=3){const T=M,P=M+1,C=M+2;i=Bh(this,v,t,n,c,h,f,T,P,C),i&&(i.faceIndex=Math.floor(M/3),i.face.materialIndex=_.materialIndex,e.push(i))}}else{const g=Math.max(0,m.start),y=Math.min(l.count,m.start+m.count);for(let _=g,v=y;_<v;_+=3){const w=_,b=_+1,M=_+2;i=Bh(this,o,t,n,c,h,f,w,b,M),i&&(i.faceIndex=Math.floor(_/3),e.push(i))}}}}function Jk(s,t,e,n,i,r,o,a){let l;if(t.side===oi?l=n.intersectTriangle(o,r,i,!0,a):l=n.intersectTriangle(i,r,o,t.side===Mr,a),l===null)return null;Fh.copy(a),Fh.applyMatrix4(s.matrixWorld);const c=e.ray.origin.distanceTo(Fh);return c<e.near||c>e.far?null:{distance:c,point:Fh.clone(),object:s}}function Bh(s,t,e,n,i,r,o,a,l,c){s.getVertexPosition(a,Wa),s.getVertexPosition(l,$a),s.getVertexPosition(c,Xa);const h=Jk(s,t,e,n,Wa,$a,Xa,Nh);if(h){i&&(zh.fromBufferAttribute(i,a),kh.fromBufferAttribute(i,l),Uh.fromBufferAttribute(i,c),h.uv=gi.getInterpolation(Nh,Wa,$a,Xa,zh,kh,Uh,new pt)),r&&(zh.fromBufferAttribute(r,a),kh.fromBufferAttribute(r,l),Uh.fromBufferAttribute(r,c),h.uv1=gi.getInterpolation(Nh,Wa,$a,Xa,zh,kh,Uh,new pt),h.uv2=h.uv1),o&&(wb.fromBufferAttribute(o,a),Mb.fromBufferAttribute(o,l),Sb.fromBufferAttribute(o,c),h.normal=gi.getInterpolation(Nh,Wa,$a,Xa,wb,Mb,Sb,new N),h.normal.dot(n.direction)>0&&h.normal.multiplyScalar(-1));const f={a,b:l,c,normal:new N,materialIndex:0};gi.getNormal(Wa,$a,Xa,f.normal),h.face=f}return h}class ua extends we{constructor(t=1,e=1,n=1,i=1,r=1,o=1){super(),this.type="BoxGeometry",this.parameters={width:t,height:e,depth:n,widthSegments:i,heightSegments:r,depthSegments:o};const a=this;i=Math.floor(i),r=Math.floor(r),o=Math.floor(o);const l=[],c=[],h=[],f=[];let d=0,m=0;g("z","y","x",-1,-1,n,e,t,o,r,0),g("z","y","x",1,-1,n,e,-t,o,r,1),g("x","z","y",1,1,t,n,e,i,o,2),g("x","z","y",1,-1,t,n,-e,i,o,3),g("x","y","z",1,-1,t,e,n,i,r,4),g("x","y","z",-1,-1,t,e,-n,i,r,5),this.setIndex(l),this.setAttribute("position",new jt(c,3)),this.setAttribute("normal",new jt(h,3)),this.setAttribute("uv",new jt(f,2));function g(y,_,v,w,b,M,A,T,P,C,S){const L=M/P,H=A/C,$=M/2,B=A/2,G=T/2,I=P+1,et=C+1;let Y=0,J=0;const ut=new N;for(let dt=0;dt<et;dt++){const nt=dt*H-B;for(let ft=0;ft<I;ft++){const Lt=ft*L-$;ut[y]=Lt*w,ut[_]=nt*b,ut[v]=G,c.push(ut.x,ut.y,ut.z),ut[y]=0,ut[_]=0,ut[v]=T>0?1:-1,h.push(ut.x,ut.y,ut.z),f.push(ft/P),f.push(1-dt/C),Y+=1}}for(let dt=0;dt<C;dt++)for(let nt=0;nt<P;nt++){const ft=d+nt+I*dt,Lt=d+nt+I*(dt+1),Ot=d+(nt+1)+I*(dt+1),It=d+(nt+1)+I*dt;l.push(ft,Lt,It),l.push(Lt,Ot,It),J+=6}a.addGroup(m,J,S),m+=J,d+=Y}}copy(t){return super.copy(t),this.parameters=Object.assign({},t.parameters),this}static fromJSON(t){return new ua(t.width,t.height,t.depth,t.widthSegments,t.heightSegments,t.depthSegments)}}function bl(s){const t={};for(const e in s){t[e]={};for(const n in s[e]){const i=s[e][n];i&&(i.isColor||i.isMatrix3||i.isMatrix4||i.isVector2||i.isVector3||i.isVector4||i.isTexture||i.isQuaternion)?i.isRenderTargetTexture?(console.warn("UniformsUtils: Textures of render targets cannot be cloned via cloneUniforms() or mergeUniforms()."),t[e][n]=null):t[e][n]=i.clone():Array.isArray(i)?t[e][n]=i.slice():t[e][n]=i}}return t}function si(s){const t={};for(let e=0;e<s.length;e++){const n=bl(s[e]);for(const i in n)t[i]=n[i]}return t}function Qk(s){const t=[];for(let e=0;e<s.length;e++)t.push(s[e].clone());return t}function MS(s){return s.getRenderTarget()===null?s.outputColorSpace:Es}const SS={clone:bl,merge:si};var t3=`void main() {
	gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );
}`,e3=`void main() {
	gl_FragColor = vec4( 1.0, 0.0, 0.0, 1.0 );
}`;class qs extends Zn{constructor(t){super(),this.isShaderMaterial=!0,this.type="ShaderMaterial",this.defines={},this.uniforms={},this.uniformsGroups=[],this.vertexShader=t3,this.fragmentShader=e3,this.linewidth=1,this.wireframe=!1,this.wireframeLinewidth=1,this.fog=!1,this.lights=!1,this.clipping=!1,this.forceSinglePass=!0,this.extensions={derivatives:!1,fragDepth:!1,drawBuffers:!1,shaderTextureLOD:!1},this.defaultAttributeValues={color:[1,1,1],uv:[0,0],uv1:[0,0]},this.index0AttributeName=void 0,this.uniformsNeedUpdate=!1,this.glslVersion=null,t!==void 0&&this.setValues(t)}copy(t){return super.copy(t),this.fragmentShader=t.fragmentShader,this.vertexShader=t.vertexShader,this.uniforms=bl(t.uniforms),this.uniformsGroups=Qk(t.uniformsGroups),this.defines=Object.assign({},t.defines),this.wireframe=t.wireframe,this.wireframeLinewidth=t.wireframeLinewidth,this.fog=t.fog,this.lights=t.lights,this.clipping=t.clipping,this.extensions=Object.assign({},t.extensions),this.glslVersion=t.glslVersion,this}toJSON(t){const e=super.toJSON(t);e.glslVersion=this.glslVersion,e.uniforms={};for(const i in this.uniforms){const o=this.uniforms[i].value;o&&o.isTexture?e.uniforms[i]={type:"t",value:o.toJSON(t).uuid}:o&&o.isColor?e.uniforms[i]={type:"c",value:o.getHex()}:o&&o.isVector2?e.uniforms[i]={type:"v2",value:o.toArray()}:o&&o.isVector3?e.uniforms[i]={type:"v3",value:o.toArray()}:o&&o.isVector4?e.uniforms[i]={type:"v4",value:o.toArray()}:o&&o.isMatrix3?e.uniforms[i]={type:"m3",value:o.toArray()}:o&&o.isMatrix4?e.uniforms[i]={type:"m4",value:o.toArray()}:e.uniforms[i]={value:o}}Object.keys(this.defines).length>0&&(e.defines=this.defines),e.vertexShader=this.vertexShader,e.fragmentShader=this.fragmentShader,e.lights=this.lights,e.clipping=this.clipping;const n={};for(const i in this.extensions)this.extensions[i]===!0&&(n[i]=!0);return Object.keys(n).length>0&&(e.extensions=n),e}}let Dl=class extends Ne{constructor(){super(),this.isCamera=!0,this.type="Camera",this.matrixWorldInverse=new de,this.projectionMatrix=new de,this.projectionMatrixInverse=new de,this.coordinateSystem=Us}copy(t,e){return super.copy(t,e),this.matrixWorldInverse.copy(t.matrixWorldInverse),this.projectionMatrix.copy(t.projectionMatrix),this.projectionMatrixInverse.copy(t.projectionMatrixInverse),this.coordinateSystem=t.coordinateSystem,this}getWorldDirection(t){this.updateWorldMatrix(!0,!1);const e=this.matrixWorld.elements;return t.set(-e[8],-e[9],-e[10]).normalize()}updateMatrixWorld(t){super.updateMatrixWorld(t),this.matrixWorldInverse.copy(this.matrixWorld).invert()}updateWorldMatrix(t,e){super.updateWorldMatrix(t,e),this.matrixWorldInverse.copy(this.matrixWorld).invert()}clone(){return new this.constructor().copy(this)}};class nn extends Dl{constructor(t=50,e=1,n=.1,i=2e3){super(),this.isPerspectiveCamera=!0,this.type="PerspectiveCamera",this.fov=t,this.zoom=1,this.near=n,this.far=i,this.focus=10,this.aspect=e,this.view=null,this.filmGauge=35,this.filmOffset=0,this.updateProjectionMatrix()}copy(t,e){return super.copy(t,e),this.fov=t.fov,this.zoom=t.zoom,this.near=t.near,this.far=t.far,this.focus=t.focus,this.aspect=t.aspect,this.view=t.view===null?null:Object.assign({},t.view),this.filmGauge=t.filmGauge,this.filmOffset=t.filmOffset,this}setFocalLength(t){const e=.5*this.getFilmHeight()/t;this.fov=xl*2*Math.atan(e),this.updateProjectionMatrix()}getFocalLength(){const t=Math.tan($o*.5*this.fov);return .5*this.getFilmHeight()/t}getEffectiveFOV(){return xl*2*Math.atan(Math.tan($o*.5*this.fov)/this.zoom)}getFilmWidth(){return this.filmGauge*Math.min(this.aspect,1)}getFilmHeight(){return this.filmGauge/Math.max(this.aspect,1)}setViewOffset(t,e,n,i,r,o){this.aspect=t/e,this.view===null&&(this.view={enabled:!0,fullWidth:1,fullHeight:1,offsetX:0,offsetY:0,width:1,height:1}),this.view.enabled=!0,this.view.fullWidth=t,this.view.fullHeight=e,this.view.offsetX=n,this.view.offsetY=i,this.view.width=r,this.view.height=o,this.updateProjectionMatrix()}clearViewOffset(){this.view!==null&&(this.view.enabled=!1),this.updateProjectionMatrix()}updateProjectionMatrix(){const t=this.near;let e=t*Math.tan($o*.5*this.fov)/this.zoom,n=2*e,i=this.aspect*n,r=-.5*i;const o=this.view;if(this.view!==null&&this.view.enabled){const l=o.fullWidth,c=o.fullHeight;r+=o.offsetX*i/l,e-=o.offsetY*n/c,i*=o.width/l,n*=o.height/c}const a=this.filmOffset;a!==0&&(r+=t*a/this.getFilmWidth()),this.projectionMatrix.makePerspective(r,r+i,e,e-n,t,this.far,this.coordinateSystem),this.projectionMatrixInverse.copy(this.projectionMatrix).invert()}toJSON(t){const e=super.toJSON(t);return e.object.fov=this.fov,e.object.zoom=this.zoom,e.object.near=this.near,e.object.far=this.far,e.object.focus=this.focus,e.object.aspect=this.aspect,this.view!==null&&(e.object.view=Object.assign({},this.view)),e.object.filmGauge=this.filmGauge,e.object.filmOffset=this.filmOffset,e}}const ja=-90,Ya=1;class AS extends Ne{constructor(t,e,n){super(),this.type="CubeCamera",this.renderTarget=n,this.coordinateSystem=null;const i=new nn(ja,Ya,t,e);i.layers=this.layers,this.add(i);const r=new nn(ja,Ya,t,e);r.layers=this.layers,this.add(r);const o=new nn(ja,Ya,t,e);o.layers=this.layers,this.add(o);const a=new nn(ja,Ya,t,e);a.layers=this.layers,this.add(a);const l=new nn(ja,Ya,t,e);l.layers=this.layers,this.add(l);const c=new nn(ja,Ya,t,e);c.layers=this.layers,this.add(c)}updateCoordinateSystem(){const t=this.coordinateSystem,e=this.children.concat(),[n,i,r,o,a,l]=e;for(const c of e)this.remove(c);if(t===Us)n.up.set(0,1,0),n.lookAt(1,0,0),i.up.set(0,1,0),i.lookAt(-1,0,0),r.up.set(0,0,-1),r.lookAt(0,1,0),o.up.set(0,0,1),o.lookAt(0,-1,0),a.up.set(0,1,0),a.lookAt(0,0,1),l.up.set(0,1,0),l.lookAt(0,0,-1);else if(t===Yc)n.up.set(0,-1,0),n.lookAt(-1,0,0),i.up.set(0,-1,0),i.lookAt(1,0,0),r.up.set(0,0,1),r.lookAt(0,1,0),o.up.set(0,0,-1),o.lookAt(0,-1,0),a.up.set(0,-1,0),a.lookAt(0,0,1),l.up.set(0,-1,0),l.lookAt(0,0,-1);else throw new Error("THREE.CubeCamera.updateCoordinateSystem(): Invalid coordinate system: "+t);for(const c of e)this.add(c),c.updateMatrixWorld()}update(t,e){this.parent===null&&this.updateMatrixWorld();const n=this.renderTarget;this.coordinateSystem!==t.coordinateSystem&&(this.coordinateSystem=t.coordinateSystem,this.updateCoordinateSystem());const[i,r,o,a,l,c]=this.children,h=t.getRenderTarget(),f=t.xr.enabled;t.xr.enabled=!1;const d=n.texture.generateMipmaps;n.texture.generateMipmaps=!1,t.setRenderTarget(n,0),t.render(e,i),t.setRenderTarget(n,1),t.render(e,r),t.setRenderTarget(n,2),t.render(e,o),t.setRenderTarget(n,3),t.render(e,a),t.setRenderTarget(n,4),t.render(e,l),n.texture.generateMipmaps=d,t.setRenderTarget(n,5),t.render(e,c),t.setRenderTarget(h),t.xr.enabled=f,n.texture.needsPMREMUpdate=!0}}class xu extends xn{constructor(t,e,n,i,r,o,a,l,c,h){t=t!==void 0?t:[],e=e!==void 0?e:Sr,super(t,e,n,i,r,o,a,l,c,h),this.isCubeTexture=!0,this.flipY=!1}get images(){return this.image}set images(t){this.image=t}}class ES extends Wi{constructor(t=1,e={}){super(t,t,e),this.isWebGLCubeRenderTarget=!0;const n={width:t,height:t,depth:1},i=[n,n,n,n,n,n];e.encoding!==void 0&&(kc("THREE.WebGLCubeRenderTarget: option.encoding has been replaced by option.colorSpace."),e.colorSpace=e.encoding===br?ve:Jr),this.texture=new xu(i,e.mapping,e.wrapS,e.wrapT,e.magFilter,e.minFilter,e.format,e.type,e.anisotropy,e.colorSpace),this.texture.isRenderTargetTexture=!0,this.texture.generateMipmaps=e.generateMipmaps!==void 0?e.generateMipmaps:!1,this.texture.minFilter=e.minFilter!==void 0?e.minFilter:fn}fromEquirectangularTexture(t,e){this.texture.type=e.type,this.texture.colorSpace=e.colorSpace,this.texture.generateMipmaps=e.generateMipmaps,this.texture.minFilter=e.minFilter,this.texture.magFilter=e.magFilter;const n={uniforms:{tEquirect:{value:null}},vertexShader:`

				varying vec3 vWorldDirection;

				vec3 transformDirection( in vec3 dir, in mat4 matrix ) {

					return normalize( ( matrix * vec4( dir, 0.0 ) ).xyz );

				}

				void main() {

					vWorldDirection = transformDirection( position, modelMatrix );

					#include <begin_vertex>
					#include <project_vertex>

				}
			`,fragmentShader:`

				uniform sampler2D tEquirect;

				varying vec3 vWorldDirection;

				#include <common>

				void main() {

					vec3 direction = normalize( vWorldDirection );

					vec2 sampleUV = equirectUv( direction );

					gl_FragColor = texture2D( tEquirect, sampleUV );

				}
			`},i=new ua(5,5,5),r=new qs({name:"CubemapFromEquirect",uniforms:bl(n.uniforms),vertexShader:n.vertexShader,fragmentShader:n.fragmentShader,side:oi,blending:yr});r.uniforms.tEquirect.value=e;const o=new Xe(i,r),a=e.minFilter;return e.minFilter===so&&(e.minFilter=fn),new AS(1,10,this).update(t,o),e.minFilter=a,o.geometry.dispose(),o.material.dispose(),this}clear(t,e,n,i){const r=t.getRenderTarget();for(let o=0;o<6;o++)t.setRenderTarget(this,o),t.clear(e,n,i);t.setRenderTarget(r)}}const Wm=new N,n3=new N,i3=new Te;class vr{constructor(t=new N(1,0,0),e=0){this.isPlane=!0,this.normal=t,this.constant=e}set(t,e){return this.normal.copy(t),this.constant=e,this}setComponents(t,e,n,i){return this.normal.set(t,e,n),this.constant=i,this}setFromNormalAndCoplanarPoint(t,e){return this.normal.copy(t),this.constant=-e.dot(this.normal),this}setFromCoplanarPoints(t,e,n){const i=Wm.subVectors(n,e).cross(n3.subVectors(t,e)).normalize();return this.setFromNormalAndCoplanarPoint(i,t),this}copy(t){return this.normal.copy(t.normal),this.constant=t.constant,this}normalize(){const t=1/this.normal.length();return this.normal.multiplyScalar(t),this.constant*=t,this}negate(){return this.constant*=-1,this.normal.negate(),this}distanceToPoint(t){return this.normal.dot(t)+this.constant}distanceToSphere(t){return this.distanceToPoint(t.center)-t.radius}projectPoint(t,e){return e.copy(t).addScaledVector(this.normal,-this.distanceToPoint(t))}intersectLine(t,e){const n=t.delta(Wm),i=this.normal.dot(n);if(i===0)return this.distanceToPoint(t.start)===0?e.copy(t.start):null;const r=-(t.start.dot(this.normal)+this.constant)/i;return r<0||r>1?null:e.copy(t.start).addScaledVector(n,r)}intersectsLine(t){const e=this.distanceToPoint(t.start),n=this.distanceToPoint(t.end);return e<0&&n>0||n<0&&e>0}intersectsBox(t){return t.intersectsPlane(this)}intersectsSphere(t){return t.intersectsPlane(this)}coplanarPoint(t){return t.copy(this.normal).multiplyScalar(-this.constant)}applyMatrix4(t,e){const n=e||i3.getNormalMatrix(t),i=this.coplanarPoint(Wm).applyMatrix4(t),r=this.normal.applyMatrix3(n).normalize();return this.constant=-i.dot(r),this}translate(t){return this.constant-=t.dot(this.normal),this}equals(t){return t.normal.equals(this.normal)&&t.constant===this.constant}clone(){return new this.constructor().copy(this)}}const To=new Ts,Hh=new N;class pd{constructor(t=new vr,e=new vr,n=new vr,i=new vr,r=new vr,o=new vr){this.planes=[t,e,n,i,r,o]}set(t,e,n,i,r,o){const a=this.planes;return a[0].copy(t),a[1].copy(e),a[2].copy(n),a[3].copy(i),a[4].copy(r),a[5].copy(o),this}copy(t){const e=this.planes;for(let n=0;n<6;n++)e[n].copy(t.planes[n]);return this}setFromProjectionMatrix(t,e=Us){const n=this.planes,i=t.elements,r=i[0],o=i[1],a=i[2],l=i[3],c=i[4],h=i[5],f=i[6],d=i[7],m=i[8],g=i[9],y=i[10],_=i[11],v=i[12],w=i[13],b=i[14],M=i[15];if(n[0].setComponents(l-r,d-c,_-m,M-v).normalize(),n[1].setComponents(l+r,d+c,_+m,M+v).normalize(),n[2].setComponents(l+o,d+h,_+g,M+w).normalize(),n[3].setComponents(l-o,d-h,_-g,M-w).normalize(),n[4].setComponents(l-a,d-f,_-y,M-b).normalize(),e===Us)n[5].setComponents(l+a,d+f,_+y,M+b).normalize();else if(e===Yc)n[5].setComponents(a,f,y,b).normalize();else throw new Error("THREE.Frustum.setFromProjectionMatrix(): Invalid coordinate system: "+e);return this}intersectsObject(t){if(t.boundingSphere!==void 0)t.boundingSphere===null&&t.computeBoundingSphere(),To.copy(t.boundingSphere).applyMatrix4(t.matrixWorld);else{const e=t.geometry;e.boundingSphere===null&&e.computeBoundingSphere(),To.copy(e.boundingSphere).applyMatrix4(t.matrixWorld)}return this.intersectsSphere(To)}intersectsSprite(t){return To.center.set(0,0,0),To.radius=.7071067811865476,To.applyMatrix4(t.matrixWorld),this.intersectsSphere(To)}intersectsSphere(t){const e=this.planes,n=t.center,i=-t.radius;for(let r=0;r<6;r++)if(e[r].distanceToPoint(n)<i)return!1;return!0}intersectsBox(t){const e=this.planes;for(let n=0;n<6;n++){const i=e[n];if(Hh.x=i.normal.x>0?t.max.x:t.min.x,Hh.y=i.normal.y>0?t.max.y:t.min.y,Hh.z=i.normal.z>0?t.max.z:t.min.z,i.distanceToPoint(Hh)<0)return!1}return!0}containsPoint(t){const e=this.planes;for(let n=0;n<6;n++)if(e[n].distanceToPoint(t)<0)return!1;return!0}clone(){return new this.constructor().copy(this)}}function TS(){let s=null,t=!1,e=null,n=null;function i(r,o){e(r,o),n=s.requestAnimationFrame(i)}return{start:function(){t!==!0&&e!==null&&(n=s.requestAnimationFrame(i),t=!0)},stop:function(){s.cancelAnimationFrame(n),t=!1},setAnimationLoop:function(r){e=r},setContext:function(r){s=r}}}function s3(s,t){const e=t.isWebGL2,n=new WeakMap;function i(c,h){const f=c.array,d=c.usage,m=s.createBuffer();s.bindBuffer(h,m),s.bufferData(h,f,d),c.onUploadCallback();let g;if(f instanceof Float32Array)g=s.FLOAT;else if(f instanceof Uint16Array)if(c.isFloat16BufferAttribute)if(e)g=s.HALF_FLOAT;else throw new Error("THREE.WebGLAttributes: Usage of Float16BufferAttribute requires WebGL2.");else g=s.UNSIGNED_SHORT;else if(f instanceof Int16Array)g=s.SHORT;else if(f instanceof Uint32Array)g=s.UNSIGNED_INT;else if(f instanceof Int32Array)g=s.INT;else if(f instanceof Int8Array)g=s.BYTE;else if(f instanceof Uint8Array)g=s.UNSIGNED_BYTE;else if(f instanceof Uint8ClampedArray)g=s.UNSIGNED_BYTE;else throw new Error("THREE.WebGLAttributes: Unsupported buffer data format: "+f);return{buffer:m,type:g,bytesPerElement:f.BYTES_PER_ELEMENT,version:c.version}}function r(c,h,f){const d=h.array,m=h.updateRange;s.bindBuffer(f,c),m.count===-1?s.bufferSubData(f,0,d):(e?s.bufferSubData(f,m.offset*d.BYTES_PER_ELEMENT,d,m.offset,m.count):s.bufferSubData(f,m.offset*d.BYTES_PER_ELEMENT,d.subarray(m.offset,m.offset+m.count)),m.count=-1),h.onUploadCallback()}function o(c){return c.isInterleavedBufferAttribute&&(c=c.data),n.get(c)}function a(c){c.isInterleavedBufferAttribute&&(c=c.data);const h=n.get(c);h&&(s.deleteBuffer(h.buffer),n.delete(c))}function l(c,h){if(c.isGLBufferAttribute){const d=n.get(c);(!d||d.version<c.version)&&n.set(c,{buffer:c.buffer,type:c.type,bytesPerElement:c.elementSize,version:c.version});return}c.isInterleavedBufferAttribute&&(c=c.data);const f=n.get(c);f===void 0?n.set(c,i(c,h)):f.version<c.version&&(r(f.buffer,c,h),f.version=c.version)}return{get:o,remove:a,update:l}}class Il extends we{constructor(t=1,e=1,n=1,i=1){super(),this.type="PlaneGeometry",this.parameters={width:t,height:e,widthSegments:n,heightSegments:i};const r=t/2,o=e/2,a=Math.floor(n),l=Math.floor(i),c=a+1,h=l+1,f=t/a,d=e/l,m=[],g=[],y=[],_=[];for(let v=0;v<h;v++){const w=v*d-o;for(let b=0;b<c;b++){const M=b*f-r;g.push(M,-w,0),y.push(0,0,1),_.push(b/a),_.push(1-v/l)}}for(let v=0;v<l;v++)for(let w=0;w<a;w++){const b=w+c*v,M=w+c*(v+1),A=w+1+c*(v+1),T=w+1+c*v;m.push(b,M,T),m.push(M,A,T)}this.setIndex(m),this.setAttribute("position",new jt(g,3)),this.setAttribute("normal",new jt(y,3)),this.setAttribute("uv",new jt(_,2))}copy(t){return super.copy(t),this.parameters=Object.assign({},t.parameters),this}static fromJSON(t){return new Il(t.width,t.height,t.widthSegments,t.heightSegments)}}var r3=`#ifdef USE_ALPHAHASH
	if ( diffuseColor.a < getAlphaHashThreshold( vPosition ) ) discard;
#endif`,o3=`#ifdef USE_ALPHAHASH
	const float ALPHA_HASH_SCALE = 0.05;
	float hash2D( vec2 value ) {
		return fract( 1.0e4 * sin( 17.0 * value.x + 0.1 * value.y ) * ( 0.1 + abs( sin( 13.0 * value.y + value.x ) ) ) );
	}
	float hash3D( vec3 value ) {
		return hash2D( vec2( hash2D( value.xy ), value.z ) );
	}
	float getAlphaHashThreshold( vec3 position ) {
		float maxDeriv = max(
			length( dFdx( position.xyz ) ),
			length( dFdy( position.xyz ) )
		);
		float pixScale = 1.0 / ( ALPHA_HASH_SCALE * maxDeriv );
		vec2 pixScales = vec2(
			exp2( floor( log2( pixScale ) ) ),
			exp2( ceil( log2( pixScale ) ) )
		);
		vec2 alpha = vec2(
			hash3D( floor( pixScales.x * position.xyz ) ),
			hash3D( floor( pixScales.y * position.xyz ) )
		);
		float lerpFactor = fract( log2( pixScale ) );
		float x = ( 1.0 - lerpFactor ) * alpha.x + lerpFactor * alpha.y;
		float a = min( lerpFactor, 1.0 - lerpFactor );
		vec3 cases = vec3(
			x * x / ( 2.0 * a * ( 1.0 - a ) ),
			( x - 0.5 * a ) / ( 1.0 - a ),
			1.0 - ( ( 1.0 - x ) * ( 1.0 - x ) / ( 2.0 * a * ( 1.0 - a ) ) )
		);
		float threshold = ( x < ( 1.0 - a ) )
			? ( ( x < a ) ? cases.x : cases.y )
			: cases.z;
		return clamp( threshold , 1.0e-6, 1.0 );
	}
#endif`,a3=`#ifdef USE_ALPHAMAP
	diffuseColor.a *= texture2D( alphaMap, vAlphaMapUv ).g;
#endif`,l3=`#ifdef USE_ALPHAMAP
	uniform sampler2D alphaMap;
#endif`,c3=`#ifdef USE_ALPHATEST
	if ( diffuseColor.a < alphaTest ) discard;
#endif`,u3=`#ifdef USE_ALPHATEST
	uniform float alphaTest;
#endif`,h3=`#ifdef USE_AOMAP
	float ambientOcclusion = ( texture2D( aoMap, vAoMapUv ).r - 1.0 ) * aoMapIntensity + 1.0;
	reflectedLight.indirectDiffuse *= ambientOcclusion;
	#if defined( USE_ENVMAP ) && defined( STANDARD )
		float dotNV = saturate( dot( geometry.normal, geometry.viewDir ) );
		reflectedLight.indirectSpecular *= computeSpecularOcclusion( dotNV, ambientOcclusion, material.roughness );
	#endif
#endif`,f3=`#ifdef USE_AOMAP
	uniform sampler2D aoMap;
	uniform float aoMapIntensity;
#endif`,d3=`vec3 transformed = vec3( position );
#ifdef USE_ALPHAHASH
	vPosition = vec3( position );
#endif`,p3=`vec3 objectNormal = vec3( normal );
#ifdef USE_TANGENT
	vec3 objectTangent = vec3( tangent.xyz );
#endif`,m3=`float G_BlinnPhong_Implicit( ) {
	return 0.25;
}
float D_BlinnPhong( const in float shininess, const in float dotNH ) {
	return RECIPROCAL_PI * ( shininess * 0.5 + 1.0 ) * pow( dotNH, shininess );
}
vec3 BRDF_BlinnPhong( const in vec3 lightDir, const in vec3 viewDir, const in vec3 normal, const in vec3 specularColor, const in float shininess ) {
	vec3 halfDir = normalize( lightDir + viewDir );
	float dotNH = saturate( dot( normal, halfDir ) );
	float dotVH = saturate( dot( viewDir, halfDir ) );
	vec3 F = F_Schlick( specularColor, 1.0, dotVH );
	float G = G_BlinnPhong_Implicit( );
	float D = D_BlinnPhong( shininess, dotNH );
	return F * ( G * D );
} // validated`,g3=`#ifdef USE_IRIDESCENCE
	const mat3 XYZ_TO_REC709 = mat3(
		 3.2404542, -0.9692660,  0.0556434,
		-1.5371385,  1.8760108, -0.2040259,
		-0.4985314,  0.0415560,  1.0572252
	);
	vec3 Fresnel0ToIor( vec3 fresnel0 ) {
		vec3 sqrtF0 = sqrt( fresnel0 );
		return ( vec3( 1.0 ) + sqrtF0 ) / ( vec3( 1.0 ) - sqrtF0 );
	}
	vec3 IorToFresnel0( vec3 transmittedIor, float incidentIor ) {
		return pow2( ( transmittedIor - vec3( incidentIor ) ) / ( transmittedIor + vec3( incidentIor ) ) );
	}
	float IorToFresnel0( float transmittedIor, float incidentIor ) {
		return pow2( ( transmittedIor - incidentIor ) / ( transmittedIor + incidentIor ));
	}
	vec3 evalSensitivity( float OPD, vec3 shift ) {
		float phase = 2.0 * PI * OPD * 1.0e-9;
		vec3 val = vec3( 5.4856e-13, 4.4201e-13, 5.2481e-13 );
		vec3 pos = vec3( 1.6810e+06, 1.7953e+06, 2.2084e+06 );
		vec3 var = vec3( 4.3278e+09, 9.3046e+09, 6.6121e+09 );
		vec3 xyz = val * sqrt( 2.0 * PI * var ) * cos( pos * phase + shift ) * exp( - pow2( phase ) * var );
		xyz.x += 9.7470e-14 * sqrt( 2.0 * PI * 4.5282e+09 ) * cos( 2.2399e+06 * phase + shift[ 0 ] ) * exp( - 4.5282e+09 * pow2( phase ) );
		xyz /= 1.0685e-7;
		vec3 rgb = XYZ_TO_REC709 * xyz;
		return rgb;
	}
	vec3 evalIridescence( float outsideIOR, float eta2, float cosTheta1, float thinFilmThickness, vec3 baseF0 ) {
		vec3 I;
		float iridescenceIOR = mix( outsideIOR, eta2, smoothstep( 0.0, 0.03, thinFilmThickness ) );
		float sinTheta2Sq = pow2( outsideIOR / iridescenceIOR ) * ( 1.0 - pow2( cosTheta1 ) );
		float cosTheta2Sq = 1.0 - sinTheta2Sq;
		if ( cosTheta2Sq < 0.0 ) {
			 return vec3( 1.0 );
		}
		float cosTheta2 = sqrt( cosTheta2Sq );
		float R0 = IorToFresnel0( iridescenceIOR, outsideIOR );
		float R12 = F_Schlick( R0, 1.0, cosTheta1 );
		float R21 = R12;
		float T121 = 1.0 - R12;
		float phi12 = 0.0;
		if ( iridescenceIOR < outsideIOR ) phi12 = PI;
		float phi21 = PI - phi12;
		vec3 baseIOR = Fresnel0ToIor( clamp( baseF0, 0.0, 0.9999 ) );		vec3 R1 = IorToFresnel0( baseIOR, iridescenceIOR );
		vec3 R23 = F_Schlick( R1, 1.0, cosTheta2 );
		vec3 phi23 = vec3( 0.0 );
		if ( baseIOR[ 0 ] < iridescenceIOR ) phi23[ 0 ] = PI;
		if ( baseIOR[ 1 ] < iridescenceIOR ) phi23[ 1 ] = PI;
		if ( baseIOR[ 2 ] < iridescenceIOR ) phi23[ 2 ] = PI;
		float OPD = 2.0 * iridescenceIOR * thinFilmThickness * cosTheta2;
		vec3 phi = vec3( phi21 ) + phi23;
		vec3 R123 = clamp( R12 * R23, 1e-5, 0.9999 );
		vec3 r123 = sqrt( R123 );
		vec3 Rs = pow2( T121 ) * R23 / ( vec3( 1.0 ) - R123 );
		vec3 C0 = R12 + Rs;
		I = C0;
		vec3 Cm = Rs - T121;
		for ( int m = 1; m <= 2; ++ m ) {
			Cm *= r123;
			vec3 Sm = 2.0 * evalSensitivity( float( m ) * OPD, float( m ) * phi );
			I += Cm * Sm;
		}
		return max( I, vec3( 0.0 ) );
	}
#endif`,v3=`#ifdef USE_BUMPMAP
	uniform sampler2D bumpMap;
	uniform float bumpScale;
	vec2 dHdxy_fwd() {
		vec2 dSTdx = dFdx( vBumpMapUv );
		vec2 dSTdy = dFdy( vBumpMapUv );
		float Hll = bumpScale * texture2D( bumpMap, vBumpMapUv ).x;
		float dBx = bumpScale * texture2D( bumpMap, vBumpMapUv + dSTdx ).x - Hll;
		float dBy = bumpScale * texture2D( bumpMap, vBumpMapUv + dSTdy ).x - Hll;
		return vec2( dBx, dBy );
	}
	vec3 perturbNormalArb( vec3 surf_pos, vec3 surf_norm, vec2 dHdxy, float faceDirection ) {
		vec3 vSigmaX = dFdx( surf_pos.xyz );
		vec3 vSigmaY = dFdy( surf_pos.xyz );
		vec3 vN = surf_norm;
		vec3 R1 = cross( vSigmaY, vN );
		vec3 R2 = cross( vN, vSigmaX );
		float fDet = dot( vSigmaX, R1 ) * faceDirection;
		vec3 vGrad = sign( fDet ) * ( dHdxy.x * R1 + dHdxy.y * R2 );
		return normalize( abs( fDet ) * surf_norm - vGrad );
	}
#endif`,_3=`#if NUM_CLIPPING_PLANES > 0
	vec4 plane;
	#pragma unroll_loop_start
	for ( int i = 0; i < UNION_CLIPPING_PLANES; i ++ ) {
		plane = clippingPlanes[ i ];
		if ( dot( vClipPosition, plane.xyz ) > plane.w ) discard;
	}
	#pragma unroll_loop_end
	#if UNION_CLIPPING_PLANES < NUM_CLIPPING_PLANES
		bool clipped = true;
		#pragma unroll_loop_start
		for ( int i = UNION_CLIPPING_PLANES; i < NUM_CLIPPING_PLANES; i ++ ) {
			plane = clippingPlanes[ i ];
			clipped = ( dot( vClipPosition, plane.xyz ) > plane.w ) && clipped;
		}
		#pragma unroll_loop_end
		if ( clipped ) discard;
	#endif
#endif`,y3=`#if NUM_CLIPPING_PLANES > 0
	varying vec3 vClipPosition;
	uniform vec4 clippingPlanes[ NUM_CLIPPING_PLANES ];
#endif`,x3=`#if NUM_CLIPPING_PLANES > 0
	varying vec3 vClipPosition;
#endif`,b3=`#if NUM_CLIPPING_PLANES > 0
	vClipPosition = - mvPosition.xyz;
#endif`,w3=`#if defined( USE_COLOR_ALPHA )
	diffuseColor *= vColor;
#elif defined( USE_COLOR )
	diffuseColor.rgb *= vColor;
#endif`,M3=`#if defined( USE_COLOR_ALPHA )
	varying vec4 vColor;
#elif defined( USE_COLOR )
	varying vec3 vColor;
#endif`,S3=`#if defined( USE_COLOR_ALPHA )
	varying vec4 vColor;
#elif defined( USE_COLOR ) || defined( USE_INSTANCING_COLOR )
	varying vec3 vColor;
#endif`,A3=`#if defined( USE_COLOR_ALPHA )
	vColor = vec4( 1.0 );
#elif defined( USE_COLOR ) || defined( USE_INSTANCING_COLOR )
	vColor = vec3( 1.0 );
#endif
#ifdef USE_COLOR
	vColor *= color;
#endif
#ifdef USE_INSTANCING_COLOR
	vColor.xyz *= instanceColor.xyz;
#endif`,E3=`#define PI 3.141592653589793
#define PI2 6.283185307179586
#define PI_HALF 1.5707963267948966
#define RECIPROCAL_PI 0.3183098861837907
#define RECIPROCAL_PI2 0.15915494309189535
#define EPSILON 1e-6
#ifndef saturate
#define saturate( a ) clamp( a, 0.0, 1.0 )
#endif
#define whiteComplement( a ) ( 1.0 - saturate( a ) )
float pow2( const in float x ) { return x*x; }
vec3 pow2( const in vec3 x ) { return x*x; }
float pow3( const in float x ) { return x*x*x; }
float pow4( const in float x ) { float x2 = x*x; return x2*x2; }
float max3( const in vec3 v ) { return max( max( v.x, v.y ), v.z ); }
float average( const in vec3 v ) { return dot( v, vec3( 0.3333333 ) ); }
highp float rand( const in vec2 uv ) {
	const highp float a = 12.9898, b = 78.233, c = 43758.5453;
	highp float dt = dot( uv.xy, vec2( a,b ) ), sn = mod( dt, PI );
	return fract( sin( sn ) * c );
}
#ifdef HIGH_PRECISION
	float precisionSafeLength( vec3 v ) { return length( v ); }
#else
	float precisionSafeLength( vec3 v ) {
		float maxComponent = max3( abs( v ) );
		return length( v / maxComponent ) * maxComponent;
	}
#endif
struct IncidentLight {
	vec3 color;
	vec3 direction;
	bool visible;
};
struct ReflectedLight {
	vec3 directDiffuse;
	vec3 directSpecular;
	vec3 indirectDiffuse;
	vec3 indirectSpecular;
};
struct GeometricContext {
	vec3 position;
	vec3 normal;
	vec3 viewDir;
#ifdef USE_CLEARCOAT
	vec3 clearcoatNormal;
#endif
};
#ifdef USE_ALPHAHASH
	varying vec3 vPosition;
#endif
vec3 transformDirection( in vec3 dir, in mat4 matrix ) {
	return normalize( ( matrix * vec4( dir, 0.0 ) ).xyz );
}
vec3 inverseTransformDirection( in vec3 dir, in mat4 matrix ) {
	return normalize( ( vec4( dir, 0.0 ) * matrix ).xyz );
}
mat3 transposeMat3( const in mat3 m ) {
	mat3 tmp;
	tmp[ 0 ] = vec3( m[ 0 ].x, m[ 1 ].x, m[ 2 ].x );
	tmp[ 1 ] = vec3( m[ 0 ].y, m[ 1 ].y, m[ 2 ].y );
	tmp[ 2 ] = vec3( m[ 0 ].z, m[ 1 ].z, m[ 2 ].z );
	return tmp;
}
float luminance( const in vec3 rgb ) {
	const vec3 weights = vec3( 0.2126729, 0.7151522, 0.0721750 );
	return dot( weights, rgb );
}
bool isPerspectiveMatrix( mat4 m ) {
	return m[ 2 ][ 3 ] == - 1.0;
}
vec2 equirectUv( in vec3 dir ) {
	float u = atan( dir.z, dir.x ) * RECIPROCAL_PI2 + 0.5;
	float v = asin( clamp( dir.y, - 1.0, 1.0 ) ) * RECIPROCAL_PI + 0.5;
	return vec2( u, v );
}
vec3 BRDF_Lambert( const in vec3 diffuseColor ) {
	return RECIPROCAL_PI * diffuseColor;
}
vec3 F_Schlick( const in vec3 f0, const in float f90, const in float dotVH ) {
	float fresnel = exp2( ( - 5.55473 * dotVH - 6.98316 ) * dotVH );
	return f0 * ( 1.0 - fresnel ) + ( f90 * fresnel );
}
float F_Schlick( const in float f0, const in float f90, const in float dotVH ) {
	float fresnel = exp2( ( - 5.55473 * dotVH - 6.98316 ) * dotVH );
	return f0 * ( 1.0 - fresnel ) + ( f90 * fresnel );
} // validated`,T3=`#ifdef ENVMAP_TYPE_CUBE_UV
	#define cubeUV_minMipLevel 4.0
	#define cubeUV_minTileSize 16.0
	float getFace( vec3 direction ) {
		vec3 absDirection = abs( direction );
		float face = - 1.0;
		if ( absDirection.x > absDirection.z ) {
			if ( absDirection.x > absDirection.y )
				face = direction.x > 0.0 ? 0.0 : 3.0;
			else
				face = direction.y > 0.0 ? 1.0 : 4.0;
		} else {
			if ( absDirection.z > absDirection.y )
				face = direction.z > 0.0 ? 2.0 : 5.0;
			else
				face = direction.y > 0.0 ? 1.0 : 4.0;
		}
		return face;
	}
	vec2 getUV( vec3 direction, float face ) {
		vec2 uv;
		if ( face == 0.0 ) {
			uv = vec2( direction.z, direction.y ) / abs( direction.x );
		} else if ( face == 1.0 ) {
			uv = vec2( - direction.x, - direction.z ) / abs( direction.y );
		} else if ( face == 2.0 ) {
			uv = vec2( - direction.x, direction.y ) / abs( direction.z );
		} else if ( face == 3.0 ) {
			uv = vec2( - direction.z, direction.y ) / abs( direction.x );
		} else if ( face == 4.0 ) {
			uv = vec2( - direction.x, direction.z ) / abs( direction.y );
		} else {
			uv = vec2( direction.x, direction.y ) / abs( direction.z );
		}
		return 0.5 * ( uv + 1.0 );
	}
	vec3 bilinearCubeUV( sampler2D envMap, vec3 direction, float mipInt ) {
		float face = getFace( direction );
		float filterInt = max( cubeUV_minMipLevel - mipInt, 0.0 );
		mipInt = max( mipInt, cubeUV_minMipLevel );
		float faceSize = exp2( mipInt );
		highp vec2 uv = getUV( direction, face ) * ( faceSize - 2.0 ) + 1.0;
		if ( face > 2.0 ) {
			uv.y += faceSize;
			face -= 3.0;
		}
		uv.x += face * faceSize;
		uv.x += filterInt * 3.0 * cubeUV_minTileSize;
		uv.y += 4.0 * ( exp2( CUBEUV_MAX_MIP ) - faceSize );
		uv.x *= CUBEUV_TEXEL_WIDTH;
		uv.y *= CUBEUV_TEXEL_HEIGHT;
		#ifdef texture2DGradEXT
			return texture2DGradEXT( envMap, uv, vec2( 0.0 ), vec2( 0.0 ) ).rgb;
		#else
			return texture2D( envMap, uv ).rgb;
		#endif
	}
	#define cubeUV_r0 1.0
	#define cubeUV_v0 0.339
	#define cubeUV_m0 - 2.0
	#define cubeUV_r1 0.8
	#define cubeUV_v1 0.276
	#define cubeUV_m1 - 1.0
	#define cubeUV_r4 0.4
	#define cubeUV_v4 0.046
	#define cubeUV_m4 2.0
	#define cubeUV_r5 0.305
	#define cubeUV_v5 0.016
	#define cubeUV_m5 3.0
	#define cubeUV_r6 0.21
	#define cubeUV_v6 0.0038
	#define cubeUV_m6 4.0
	float roughnessToMip( float roughness ) {
		float mip = 0.0;
		if ( roughness >= cubeUV_r1 ) {
			mip = ( cubeUV_r0 - roughness ) * ( cubeUV_m1 - cubeUV_m0 ) / ( cubeUV_r0 - cubeUV_r1 ) + cubeUV_m0;
		} else if ( roughness >= cubeUV_r4 ) {
			mip = ( cubeUV_r1 - roughness ) * ( cubeUV_m4 - cubeUV_m1 ) / ( cubeUV_r1 - cubeUV_r4 ) + cubeUV_m1;
		} else if ( roughness >= cubeUV_r5 ) {
			mip = ( cubeUV_r4 - roughness ) * ( cubeUV_m5 - cubeUV_m4 ) / ( cubeUV_r4 - cubeUV_r5 ) + cubeUV_m4;
		} else if ( roughness >= cubeUV_r6 ) {
			mip = ( cubeUV_r5 - roughness ) * ( cubeUV_m6 - cubeUV_m5 ) / ( cubeUV_r5 - cubeUV_r6 ) + cubeUV_m5;
		} else {
			mip = - 2.0 * log2( 1.16 * roughness );		}
		return mip;
	}
	vec4 textureCubeUV( sampler2D envMap, vec3 sampleDir, float roughness ) {
		float mip = clamp( roughnessToMip( roughness ), cubeUV_m0, CUBEUV_MAX_MIP );
		float mipF = fract( mip );
		float mipInt = floor( mip );
		vec3 color0 = bilinearCubeUV( envMap, sampleDir, mipInt );
		if ( mipF == 0.0 ) {
			return vec4( color0, 1.0 );
		} else {
			vec3 color1 = bilinearCubeUV( envMap, sampleDir, mipInt + 1.0 );
			return vec4( mix( color0, color1, mipF ), 1.0 );
		}
	}
#endif`,C3=`vec3 transformedNormal = objectNormal;
#ifdef USE_INSTANCING
	mat3 m = mat3( instanceMatrix );
	transformedNormal /= vec3( dot( m[ 0 ], m[ 0 ] ), dot( m[ 1 ], m[ 1 ] ), dot( m[ 2 ], m[ 2 ] ) );
	transformedNormal = m * transformedNormal;
#endif
transformedNormal = normalMatrix * transformedNormal;
#ifdef FLIP_SIDED
	transformedNormal = - transformedNormal;
#endif
#ifdef USE_TANGENT
	vec3 transformedTangent = ( modelViewMatrix * vec4( objectTangent, 0.0 ) ).xyz;
	#ifdef FLIP_SIDED
		transformedTangent = - transformedTangent;
	#endif
#endif`,P3=`#ifdef USE_DISPLACEMENTMAP
	uniform sampler2D displacementMap;
	uniform float displacementScale;
	uniform float displacementBias;
#endif`,R3=`#ifdef USE_DISPLACEMENTMAP
	transformed += normalize( objectNormal ) * ( texture2D( displacementMap, vDisplacementMapUv ).x * displacementScale + displacementBias );
#endif`,L3=`#ifdef USE_EMISSIVEMAP
	vec4 emissiveColor = texture2D( emissiveMap, vEmissiveMapUv );
	totalEmissiveRadiance *= emissiveColor.rgb;
#endif`,D3=`#ifdef USE_EMISSIVEMAP
	uniform sampler2D emissiveMap;
#endif`,I3="gl_FragColor = linearToOutputTexel( gl_FragColor );",O3=`vec4 LinearToLinear( in vec4 value ) {
	return value;
}
vec4 LinearTosRGB( in vec4 value ) {
	return vec4( mix( pow( value.rgb, vec3( 0.41666 ) ) * 1.055 - vec3( 0.055 ), value.rgb * 12.92, vec3( lessThanEqual( value.rgb, vec3( 0.0031308 ) ) ) ), value.a );
}`,z3=`#ifdef USE_ENVMAP
	#ifdef ENV_WORLDPOS
		vec3 cameraToFrag;
		if ( isOrthographic ) {
			cameraToFrag = normalize( vec3( - viewMatrix[ 0 ][ 2 ], - viewMatrix[ 1 ][ 2 ], - viewMatrix[ 2 ][ 2 ] ) );
		} else {
			cameraToFrag = normalize( vWorldPosition - cameraPosition );
		}
		vec3 worldNormal = inverseTransformDirection( normal, viewMatrix );
		#ifdef ENVMAP_MODE_REFLECTION
			vec3 reflectVec = reflect( cameraToFrag, worldNormal );
		#else
			vec3 reflectVec = refract( cameraToFrag, worldNormal, refractionRatio );
		#endif
	#else
		vec3 reflectVec = vReflect;
	#endif
	#ifdef ENVMAP_TYPE_CUBE
		vec4 envColor = textureCube( envMap, vec3( flipEnvMap * reflectVec.x, reflectVec.yz ) );
	#else
		vec4 envColor = vec4( 0.0 );
	#endif
	#ifdef ENVMAP_BLENDING_MULTIPLY
		outgoingLight = mix( outgoingLight, outgoingLight * envColor.xyz, specularStrength * reflectivity );
	#elif defined( ENVMAP_BLENDING_MIX )
		outgoingLight = mix( outgoingLight, envColor.xyz, specularStrength * reflectivity );
	#elif defined( ENVMAP_BLENDING_ADD )
		outgoingLight += envColor.xyz * specularStrength * reflectivity;
	#endif
#endif`,k3=`#ifdef USE_ENVMAP
	uniform float envMapIntensity;
	uniform float flipEnvMap;
	#ifdef ENVMAP_TYPE_CUBE
		uniform samplerCube envMap;
	#else
		uniform sampler2D envMap;
	#endif
	
#endif`,U3=`#ifdef USE_ENVMAP
	uniform float reflectivity;
	#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( PHONG ) || defined( LAMBERT )
		#define ENV_WORLDPOS
	#endif
	#ifdef ENV_WORLDPOS
		varying vec3 vWorldPosition;
		uniform float refractionRatio;
	#else
		varying vec3 vReflect;
	#endif
#endif`,N3=`#ifdef USE_ENVMAP
	#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( PHONG ) || defined( LAMBERT )
		#define ENV_WORLDPOS
	#endif
	#ifdef ENV_WORLDPOS
		
		varying vec3 vWorldPosition;
	#else
		varying vec3 vReflect;
		uniform float refractionRatio;
	#endif
#endif`,F3=`#ifdef USE_ENVMAP
	#ifdef ENV_WORLDPOS
		vWorldPosition = worldPosition.xyz;
	#else
		vec3 cameraToVertex;
		if ( isOrthographic ) {
			cameraToVertex = normalize( vec3( - viewMatrix[ 0 ][ 2 ], - viewMatrix[ 1 ][ 2 ], - viewMatrix[ 2 ][ 2 ] ) );
		} else {
			cameraToVertex = normalize( worldPosition.xyz - cameraPosition );
		}
		vec3 worldNormal = inverseTransformDirection( transformedNormal, viewMatrix );
		#ifdef ENVMAP_MODE_REFLECTION
			vReflect = reflect( cameraToVertex, worldNormal );
		#else
			vReflect = refract( cameraToVertex, worldNormal, refractionRatio );
		#endif
	#endif
#endif`,B3=`#ifdef USE_FOG
	vFogDepth = - mvPosition.z;
#endif`,H3=`#ifdef USE_FOG
	varying float vFogDepth;
#endif`,V3=`#ifdef USE_FOG
	#ifdef FOG_EXP2
		float fogFactor = 1.0 - exp( - fogDensity * fogDensity * vFogDepth * vFogDepth );
	#else
		float fogFactor = smoothstep( fogNear, fogFar, vFogDepth );
	#endif
	gl_FragColor.rgb = mix( gl_FragColor.rgb, fogColor, fogFactor );
#endif`,G3=`#ifdef USE_FOG
	uniform vec3 fogColor;
	varying float vFogDepth;
	#ifdef FOG_EXP2
		uniform float fogDensity;
	#else
		uniform float fogNear;
		uniform float fogFar;
	#endif
#endif`,q3=`#ifdef USE_GRADIENTMAP
	uniform sampler2D gradientMap;
#endif
vec3 getGradientIrradiance( vec3 normal, vec3 lightDirection ) {
	float dotNL = dot( normal, lightDirection );
	vec2 coord = vec2( dotNL * 0.5 + 0.5, 0.0 );
	#ifdef USE_GRADIENTMAP
		return vec3( texture2D( gradientMap, coord ).r );
	#else
		vec2 fw = fwidth( coord ) * 0.5;
		return mix( vec3( 0.7 ), vec3( 1.0 ), smoothstep( 0.7 - fw.x, 0.7 + fw.x, coord.x ) );
	#endif
}`,W3=`#ifdef USE_LIGHTMAP
	vec4 lightMapTexel = texture2D( lightMap, vLightMapUv );
	vec3 lightMapIrradiance = lightMapTexel.rgb * lightMapIntensity;
	reflectedLight.indirectDiffuse += lightMapIrradiance;
#endif`,$3=`#ifdef USE_LIGHTMAP
	uniform sampler2D lightMap;
	uniform float lightMapIntensity;
#endif`,X3=`LambertMaterial material;
material.diffuseColor = diffuseColor.rgb;
material.specularStrength = specularStrength;`,j3=`varying vec3 vViewPosition;
struct LambertMaterial {
	vec3 diffuseColor;
	float specularStrength;
};
void RE_Direct_Lambert( const in IncidentLight directLight, const in GeometricContext geometry, const in LambertMaterial material, inout ReflectedLight reflectedLight ) {
	float dotNL = saturate( dot( geometry.normal, directLight.direction ) );
	vec3 irradiance = dotNL * directLight.color;
	reflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
}
void RE_IndirectDiffuse_Lambert( const in vec3 irradiance, const in GeometricContext geometry, const in LambertMaterial material, inout ReflectedLight reflectedLight ) {
	reflectedLight.indirectDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
}
#define RE_Direct				RE_Direct_Lambert
#define RE_IndirectDiffuse		RE_IndirectDiffuse_Lambert`,Y3=`uniform bool receiveShadow;
uniform vec3 ambientLightColor;
uniform vec3 lightProbe[ 9 ];
vec3 shGetIrradianceAt( in vec3 normal, in vec3 shCoefficients[ 9 ] ) {
	float x = normal.x, y = normal.y, z = normal.z;
	vec3 result = shCoefficients[ 0 ] * 0.886227;
	result += shCoefficients[ 1 ] * 2.0 * 0.511664 * y;
	result += shCoefficients[ 2 ] * 2.0 * 0.511664 * z;
	result += shCoefficients[ 3 ] * 2.0 * 0.511664 * x;
	result += shCoefficients[ 4 ] * 2.0 * 0.429043 * x * y;
	result += shCoefficients[ 5 ] * 2.0 * 0.429043 * y * z;
	result += shCoefficients[ 6 ] * ( 0.743125 * z * z - 0.247708 );
	result += shCoefficients[ 7 ] * 2.0 * 0.429043 * x * z;
	result += shCoefficients[ 8 ] * 0.429043 * ( x * x - y * y );
	return result;
}
vec3 getLightProbeIrradiance( const in vec3 lightProbe[ 9 ], const in vec3 normal ) {
	vec3 worldNormal = inverseTransformDirection( normal, viewMatrix );
	vec3 irradiance = shGetIrradianceAt( worldNormal, lightProbe );
	return irradiance;
}
vec3 getAmbientLightIrradiance( const in vec3 ambientLightColor ) {
	vec3 irradiance = ambientLightColor;
	return irradiance;
}
float getDistanceAttenuation( const in float lightDistance, const in float cutoffDistance, const in float decayExponent ) {
	#if defined ( LEGACY_LIGHTS )
		if ( cutoffDistance > 0.0 && decayExponent > 0.0 ) {
			return pow( saturate( - lightDistance / cutoffDistance + 1.0 ), decayExponent );
		}
		return 1.0;
	#else
		float distanceFalloff = 1.0 / max( pow( lightDistance, decayExponent ), 0.01 );
		if ( cutoffDistance > 0.0 ) {
			distanceFalloff *= pow2( saturate( 1.0 - pow4( lightDistance / cutoffDistance ) ) );
		}
		return distanceFalloff;
	#endif
}
float getSpotAttenuation( const in float coneCosine, const in float penumbraCosine, const in float angleCosine ) {
	return smoothstep( coneCosine, penumbraCosine, angleCosine );
}
#if NUM_DIR_LIGHTS > 0
	struct DirectionalLight {
		vec3 direction;
		vec3 color;
	};
	uniform DirectionalLight directionalLights[ NUM_DIR_LIGHTS ];
	void getDirectionalLightInfo( const in DirectionalLight directionalLight, const in GeometricContext geometry, out IncidentLight light ) {
		light.color = directionalLight.color;
		light.direction = directionalLight.direction;
		light.visible = true;
	}
#endif
#if NUM_POINT_LIGHTS > 0
	struct PointLight {
		vec3 position;
		vec3 color;
		float distance;
		float decay;
	};
	uniform PointLight pointLights[ NUM_POINT_LIGHTS ];
	void getPointLightInfo( const in PointLight pointLight, const in GeometricContext geometry, out IncidentLight light ) {
		vec3 lVector = pointLight.position - geometry.position;
		light.direction = normalize( lVector );
		float lightDistance = length( lVector );
		light.color = pointLight.color;
		light.color *= getDistanceAttenuation( lightDistance, pointLight.distance, pointLight.decay );
		light.visible = ( light.color != vec3( 0.0 ) );
	}
#endif
#if NUM_SPOT_LIGHTS > 0
	struct SpotLight {
		vec3 position;
		vec3 direction;
		vec3 color;
		float distance;
		float decay;
		float coneCos;
		float penumbraCos;
	};
	uniform SpotLight spotLights[ NUM_SPOT_LIGHTS ];
	void getSpotLightInfo( const in SpotLight spotLight, const in GeometricContext geometry, out IncidentLight light ) {
		vec3 lVector = spotLight.position - geometry.position;
		light.direction = normalize( lVector );
		float angleCos = dot( light.direction, spotLight.direction );
		float spotAttenuation = getSpotAttenuation( spotLight.coneCos, spotLight.penumbraCos, angleCos );
		if ( spotAttenuation > 0.0 ) {
			float lightDistance = length( lVector );
			light.color = spotLight.color * spotAttenuation;
			light.color *= getDistanceAttenuation( lightDistance, spotLight.distance, spotLight.decay );
			light.visible = ( light.color != vec3( 0.0 ) );
		} else {
			light.color = vec3( 0.0 );
			light.visible = false;
		}
	}
#endif
#if NUM_RECT_AREA_LIGHTS > 0
	struct RectAreaLight {
		vec3 color;
		vec3 position;
		vec3 halfWidth;
		vec3 halfHeight;
	};
	uniform sampler2D ltc_1;	uniform sampler2D ltc_2;
	uniform RectAreaLight rectAreaLights[ NUM_RECT_AREA_LIGHTS ];
#endif
#if NUM_HEMI_LIGHTS > 0
	struct HemisphereLight {
		vec3 direction;
		vec3 skyColor;
		vec3 groundColor;
	};
	uniform HemisphereLight hemisphereLights[ NUM_HEMI_LIGHTS ];
	vec3 getHemisphereLightIrradiance( const in HemisphereLight hemiLight, const in vec3 normal ) {
		float dotNL = dot( normal, hemiLight.direction );
		float hemiDiffuseWeight = 0.5 * dotNL + 0.5;
		vec3 irradiance = mix( hemiLight.groundColor, hemiLight.skyColor, hemiDiffuseWeight );
		return irradiance;
	}
#endif`,Z3=`#ifdef USE_ENVMAP
	vec3 getIBLIrradiance( const in vec3 normal ) {
		#ifdef ENVMAP_TYPE_CUBE_UV
			vec3 worldNormal = inverseTransformDirection( normal, viewMatrix );
			vec4 envMapColor = textureCubeUV( envMap, worldNormal, 1.0 );
			return PI * envMapColor.rgb * envMapIntensity;
		#else
			return vec3( 0.0 );
		#endif
	}
	vec3 getIBLRadiance( const in vec3 viewDir, const in vec3 normal, const in float roughness ) {
		#ifdef ENVMAP_TYPE_CUBE_UV
			vec3 reflectVec = reflect( - viewDir, normal );
			reflectVec = normalize( mix( reflectVec, normal, roughness * roughness) );
			reflectVec = inverseTransformDirection( reflectVec, viewMatrix );
			vec4 envMapColor = textureCubeUV( envMap, reflectVec, roughness );
			return envMapColor.rgb * envMapIntensity;
		#else
			return vec3( 0.0 );
		#endif
	}
	#ifdef USE_ANISOTROPY
		vec3 getIBLAnisotropyRadiance( const in vec3 viewDir, const in vec3 normal, const in float roughness, const in vec3 bitangent, const in float anisotropy ) {
			#ifdef ENVMAP_TYPE_CUBE_UV
				vec3 bentNormal = cross( bitangent, viewDir );
				bentNormal = normalize( cross( bentNormal, bitangent ) );
				bentNormal = normalize( mix( bentNormal, normal, pow2( pow2( 1.0 - anisotropy * ( 1.0 - roughness ) ) ) ) );
				return getIBLRadiance( viewDir, bentNormal, roughness );
			#else
				return vec3( 0.0 );
			#endif
		}
	#endif
#endif`,K3=`ToonMaterial material;
material.diffuseColor = diffuseColor.rgb;`,J3=`varying vec3 vViewPosition;
struct ToonMaterial {
	vec3 diffuseColor;
};
void RE_Direct_Toon( const in IncidentLight directLight, const in GeometricContext geometry, const in ToonMaterial material, inout ReflectedLight reflectedLight ) {
	vec3 irradiance = getGradientIrradiance( geometry.normal, directLight.direction ) * directLight.color;
	reflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
}
void RE_IndirectDiffuse_Toon( const in vec3 irradiance, const in GeometricContext geometry, const in ToonMaterial material, inout ReflectedLight reflectedLight ) {
	reflectedLight.indirectDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
}
#define RE_Direct				RE_Direct_Toon
#define RE_IndirectDiffuse		RE_IndirectDiffuse_Toon`,Q3=`BlinnPhongMaterial material;
material.diffuseColor = diffuseColor.rgb;
material.specularColor = specular;
material.specularShininess = shininess;
material.specularStrength = specularStrength;`,tU=`varying vec3 vViewPosition;
struct BlinnPhongMaterial {
	vec3 diffuseColor;
	vec3 specularColor;
	float specularShininess;
	float specularStrength;
};
void RE_Direct_BlinnPhong( const in IncidentLight directLight, const in GeometricContext geometry, const in BlinnPhongMaterial material, inout ReflectedLight reflectedLight ) {
	float dotNL = saturate( dot( geometry.normal, directLight.direction ) );
	vec3 irradiance = dotNL * directLight.color;
	reflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
	reflectedLight.directSpecular += irradiance * BRDF_BlinnPhong( directLight.direction, geometry.viewDir, geometry.normal, material.specularColor, material.specularShininess ) * material.specularStrength;
}
void RE_IndirectDiffuse_BlinnPhong( const in vec3 irradiance, const in GeometricContext geometry, const in BlinnPhongMaterial material, inout ReflectedLight reflectedLight ) {
	reflectedLight.indirectDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
}
#define RE_Direct				RE_Direct_BlinnPhong
#define RE_IndirectDiffuse		RE_IndirectDiffuse_BlinnPhong`,eU=`PhysicalMaterial material;
material.diffuseColor = diffuseColor.rgb * ( 1.0 - metalnessFactor );
vec3 dxy = max( abs( dFdx( geometryNormal ) ), abs( dFdy( geometryNormal ) ) );
float geometryRoughness = max( max( dxy.x, dxy.y ), dxy.z );
material.roughness = max( roughnessFactor, 0.0525 );material.roughness += geometryRoughness;
material.roughness = min( material.roughness, 1.0 );
#ifdef IOR
	material.ior = ior;
	#ifdef USE_SPECULAR
		float specularIntensityFactor = specularIntensity;
		vec3 specularColorFactor = specularColor;
		#ifdef USE_SPECULAR_COLORMAP
			specularColorFactor *= texture2D( specularColorMap, vSpecularColorMapUv ).rgb;
		#endif
		#ifdef USE_SPECULAR_INTENSITYMAP
			specularIntensityFactor *= texture2D( specularIntensityMap, vSpecularIntensityMapUv ).a;
		#endif
		material.specularF90 = mix( specularIntensityFactor, 1.0, metalnessFactor );
	#else
		float specularIntensityFactor = 1.0;
		vec3 specularColorFactor = vec3( 1.0 );
		material.specularF90 = 1.0;
	#endif
	material.specularColor = mix( min( pow2( ( material.ior - 1.0 ) / ( material.ior + 1.0 ) ) * specularColorFactor, vec3( 1.0 ) ) * specularIntensityFactor, diffuseColor.rgb, metalnessFactor );
#else
	material.specularColor = mix( vec3( 0.04 ), diffuseColor.rgb, metalnessFactor );
	material.specularF90 = 1.0;
#endif
#ifdef USE_CLEARCOAT
	material.clearcoat = clearcoat;
	material.clearcoatRoughness = clearcoatRoughness;
	material.clearcoatF0 = vec3( 0.04 );
	material.clearcoatF90 = 1.0;
	#ifdef USE_CLEARCOATMAP
		material.clearcoat *= texture2D( clearcoatMap, vClearcoatMapUv ).x;
	#endif
	#ifdef USE_CLEARCOAT_ROUGHNESSMAP
		material.clearcoatRoughness *= texture2D( clearcoatRoughnessMap, vClearcoatRoughnessMapUv ).y;
	#endif
	material.clearcoat = saturate( material.clearcoat );	material.clearcoatRoughness = max( material.clearcoatRoughness, 0.0525 );
	material.clearcoatRoughness += geometryRoughness;
	material.clearcoatRoughness = min( material.clearcoatRoughness, 1.0 );
#endif
#ifdef USE_IRIDESCENCE
	material.iridescence = iridescence;
	material.iridescenceIOR = iridescenceIOR;
	#ifdef USE_IRIDESCENCEMAP
		material.iridescence *= texture2D( iridescenceMap, vIridescenceMapUv ).r;
	#endif
	#ifdef USE_IRIDESCENCE_THICKNESSMAP
		material.iridescenceThickness = (iridescenceThicknessMaximum - iridescenceThicknessMinimum) * texture2D( iridescenceThicknessMap, vIridescenceThicknessMapUv ).g + iridescenceThicknessMinimum;
	#else
		material.iridescenceThickness = iridescenceThicknessMaximum;
	#endif
#endif
#ifdef USE_SHEEN
	material.sheenColor = sheenColor;
	#ifdef USE_SHEEN_COLORMAP
		material.sheenColor *= texture2D( sheenColorMap, vSheenColorMapUv ).rgb;
	#endif
	material.sheenRoughness = clamp( sheenRoughness, 0.07, 1.0 );
	#ifdef USE_SHEEN_ROUGHNESSMAP
		material.sheenRoughness *= texture2D( sheenRoughnessMap, vSheenRoughnessMapUv ).a;
	#endif
#endif
#ifdef USE_ANISOTROPY
	#ifdef USE_ANISOTROPYMAP
		mat2 anisotropyMat = mat2( anisotropyVector.x, anisotropyVector.y, - anisotropyVector.y, anisotropyVector.x );
		vec3 anisotropyPolar = texture2D( anisotropyMap, vAnisotropyMapUv ).rgb;
		vec2 anisotropyV = anisotropyMat * normalize( 2.0 * anisotropyPolar.rg - vec2( 1.0 ) ) * anisotropyPolar.b;
	#else
		vec2 anisotropyV = anisotropyVector;
	#endif
	material.anisotropy = length( anisotropyV );
	anisotropyV /= material.anisotropy;
	material.anisotropy = saturate( material.anisotropy );
	material.alphaT = mix( pow2( material.roughness ), 1.0, pow2( material.anisotropy ) );
	material.anisotropyT = tbn[ 0 ] * anisotropyV.x - tbn[ 1 ] * anisotropyV.y;
	material.anisotropyB = tbn[ 1 ] * anisotropyV.x + tbn[ 0 ] * anisotropyV.y;
#endif`,nU=`struct PhysicalMaterial {
	vec3 diffuseColor;
	float roughness;
	vec3 specularColor;
	float specularF90;
	#ifdef USE_CLEARCOAT
		float clearcoat;
		float clearcoatRoughness;
		vec3 clearcoatF0;
		float clearcoatF90;
	#endif
	#ifdef USE_IRIDESCENCE
		float iridescence;
		float iridescenceIOR;
		float iridescenceThickness;
		vec3 iridescenceFresnel;
		vec3 iridescenceF0;
	#endif
	#ifdef USE_SHEEN
		vec3 sheenColor;
		float sheenRoughness;
	#endif
	#ifdef IOR
		float ior;
	#endif
	#ifdef USE_TRANSMISSION
		float transmission;
		float transmissionAlpha;
		float thickness;
		float attenuationDistance;
		vec3 attenuationColor;
	#endif
	#ifdef USE_ANISOTROPY
		float anisotropy;
		float alphaT;
		vec3 anisotropyT;
		vec3 anisotropyB;
	#endif
};
vec3 clearcoatSpecular = vec3( 0.0 );
vec3 sheenSpecular = vec3( 0.0 );
vec3 Schlick_to_F0( const in vec3 f, const in float f90, const in float dotVH ) {
    float x = clamp( 1.0 - dotVH, 0.0, 1.0 );
    float x2 = x * x;
    float x5 = clamp( x * x2 * x2, 0.0, 0.9999 );
    return ( f - vec3( f90 ) * x5 ) / ( 1.0 - x5 );
}
float V_GGX_SmithCorrelated( const in float alpha, const in float dotNL, const in float dotNV ) {
	float a2 = pow2( alpha );
	float gv = dotNL * sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNV ) );
	float gl = dotNV * sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNL ) );
	return 0.5 / max( gv + gl, EPSILON );
}
float D_GGX( const in float alpha, const in float dotNH ) {
	float a2 = pow2( alpha );
	float denom = pow2( dotNH ) * ( a2 - 1.0 ) + 1.0;
	return RECIPROCAL_PI * a2 / pow2( denom );
}
#ifdef USE_ANISOTROPY
	float V_GGX_SmithCorrelated_Anisotropic( const in float alphaT, const in float alphaB, const in float dotTV, const in float dotBV, const in float dotTL, const in float dotBL, const in float dotNV, const in float dotNL ) {
		float gv = dotNL * length( vec3( alphaT * dotTV, alphaB * dotBV, dotNV ) );
		float gl = dotNV * length( vec3( alphaT * dotTL, alphaB * dotBL, dotNL ) );
		float v = 0.5 / ( gv + gl );
		return saturate(v);
	}
	float D_GGX_Anisotropic( const in float alphaT, const in float alphaB, const in float dotNH, const in float dotTH, const in float dotBH ) {
		float a2 = alphaT * alphaB;
		highp vec3 v = vec3( alphaB * dotTH, alphaT * dotBH, a2 * dotNH );
		highp float v2 = dot( v, v );
		float w2 = a2 / v2;
		return RECIPROCAL_PI * a2 * pow2 ( w2 );
	}
#endif
#ifdef USE_CLEARCOAT
	vec3 BRDF_GGX_Clearcoat( const in vec3 lightDir, const in vec3 viewDir, const in vec3 normal, const in PhysicalMaterial material) {
		vec3 f0 = material.clearcoatF0;
		float f90 = material.clearcoatF90;
		float roughness = material.clearcoatRoughness;
		float alpha = pow2( roughness );
		vec3 halfDir = normalize( lightDir + viewDir );
		float dotNL = saturate( dot( normal, lightDir ) );
		float dotNV = saturate( dot( normal, viewDir ) );
		float dotNH = saturate( dot( normal, halfDir ) );
		float dotVH = saturate( dot( viewDir, halfDir ) );
		vec3 F = F_Schlick( f0, f90, dotVH );
		float V = V_GGX_SmithCorrelated( alpha, dotNL, dotNV );
		float D = D_GGX( alpha, dotNH );
		return F * ( V * D );
	}
#endif
vec3 BRDF_GGX( const in vec3 lightDir, const in vec3 viewDir, const in vec3 normal, const in PhysicalMaterial material ) {
	vec3 f0 = material.specularColor;
	float f90 = material.specularF90;
	float roughness = material.roughness;
	float alpha = pow2( roughness );
	vec3 halfDir = normalize( lightDir + viewDir );
	float dotNL = saturate( dot( normal, lightDir ) );
	float dotNV = saturate( dot( normal, viewDir ) );
	float dotNH = saturate( dot( normal, halfDir ) );
	float dotVH = saturate( dot( viewDir, halfDir ) );
	vec3 F = F_Schlick( f0, f90, dotVH );
	#ifdef USE_IRIDESCENCE
		F = mix( F, material.iridescenceFresnel, material.iridescence );
	#endif
	#ifdef USE_ANISOTROPY
		float dotTL = dot( material.anisotropyT, lightDir );
		float dotTV = dot( material.anisotropyT, viewDir );
		float dotTH = dot( material.anisotropyT, halfDir );
		float dotBL = dot( material.anisotropyB, lightDir );
		float dotBV = dot( material.anisotropyB, viewDir );
		float dotBH = dot( material.anisotropyB, halfDir );
		float V = V_GGX_SmithCorrelated_Anisotropic( material.alphaT, alpha, dotTV, dotBV, dotTL, dotBL, dotNV, dotNL );
		float D = D_GGX_Anisotropic( material.alphaT, alpha, dotNH, dotTH, dotBH );
	#else
		float V = V_GGX_SmithCorrelated( alpha, dotNL, dotNV );
		float D = D_GGX( alpha, dotNH );
	#endif
	return F * ( V * D );
}
vec2 LTC_Uv( const in vec3 N, const in vec3 V, const in float roughness ) {
	const float LUT_SIZE = 64.0;
	const float LUT_SCALE = ( LUT_SIZE - 1.0 ) / LUT_SIZE;
	const float LUT_BIAS = 0.5 / LUT_SIZE;
	float dotNV = saturate( dot( N, V ) );
	vec2 uv = vec2( roughness, sqrt( 1.0 - dotNV ) );
	uv = uv * LUT_SCALE + LUT_BIAS;
	return uv;
}
float LTC_ClippedSphereFormFactor( const in vec3 f ) {
	float l = length( f );
	return max( ( l * l + f.z ) / ( l + 1.0 ), 0.0 );
}
vec3 LTC_EdgeVectorFormFactor( const in vec3 v1, const in vec3 v2 ) {
	float x = dot( v1, v2 );
	float y = abs( x );
	float a = 0.8543985 + ( 0.4965155 + 0.0145206 * y ) * y;
	float b = 3.4175940 + ( 4.1616724 + y ) * y;
	float v = a / b;
	float theta_sintheta = ( x > 0.0 ) ? v : 0.5 * inversesqrt( max( 1.0 - x * x, 1e-7 ) ) - v;
	return cross( v1, v2 ) * theta_sintheta;
}
vec3 LTC_Evaluate( const in vec3 N, const in vec3 V, const in vec3 P, const in mat3 mInv, const in vec3 rectCoords[ 4 ] ) {
	vec3 v1 = rectCoords[ 1 ] - rectCoords[ 0 ];
	vec3 v2 = rectCoords[ 3 ] - rectCoords[ 0 ];
	vec3 lightNormal = cross( v1, v2 );
	if( dot( lightNormal, P - rectCoords[ 0 ] ) < 0.0 ) return vec3( 0.0 );
	vec3 T1, T2;
	T1 = normalize( V - N * dot( V, N ) );
	T2 = - cross( N, T1 );
	mat3 mat = mInv * transposeMat3( mat3( T1, T2, N ) );
	vec3 coords[ 4 ];
	coords[ 0 ] = mat * ( rectCoords[ 0 ] - P );
	coords[ 1 ] = mat * ( rectCoords[ 1 ] - P );
	coords[ 2 ] = mat * ( rectCoords[ 2 ] - P );
	coords[ 3 ] = mat * ( rectCoords[ 3 ] - P );
	coords[ 0 ] = normalize( coords[ 0 ] );
	coords[ 1 ] = normalize( coords[ 1 ] );
	coords[ 2 ] = normalize( coords[ 2 ] );
	coords[ 3 ] = normalize( coords[ 3 ] );
	vec3 vectorFormFactor = vec3( 0.0 );
	vectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 0 ], coords[ 1 ] );
	vectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 1 ], coords[ 2 ] );
	vectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 2 ], coords[ 3 ] );
	vectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 3 ], coords[ 0 ] );
	float result = LTC_ClippedSphereFormFactor( vectorFormFactor );
	return vec3( result );
}
#if defined( USE_SHEEN )
float D_Charlie( float roughness, float dotNH ) {
	float alpha = pow2( roughness );
	float invAlpha = 1.0 / alpha;
	float cos2h = dotNH * dotNH;
	float sin2h = max( 1.0 - cos2h, 0.0078125 );
	return ( 2.0 + invAlpha ) * pow( sin2h, invAlpha * 0.5 ) / ( 2.0 * PI );
}
float V_Neubelt( float dotNV, float dotNL ) {
	return saturate( 1.0 / ( 4.0 * ( dotNL + dotNV - dotNL * dotNV ) ) );
}
vec3 BRDF_Sheen( const in vec3 lightDir, const in vec3 viewDir, const in vec3 normal, vec3 sheenColor, const in float sheenRoughness ) {
	vec3 halfDir = normalize( lightDir + viewDir );
	float dotNL = saturate( dot( normal, lightDir ) );
	float dotNV = saturate( dot( normal, viewDir ) );
	float dotNH = saturate( dot( normal, halfDir ) );
	float D = D_Charlie( sheenRoughness, dotNH );
	float V = V_Neubelt( dotNV, dotNL );
	return sheenColor * ( D * V );
}
#endif
float IBLSheenBRDF( const in vec3 normal, const in vec3 viewDir, const in float roughness ) {
	float dotNV = saturate( dot( normal, viewDir ) );
	float r2 = roughness * roughness;
	float a = roughness < 0.25 ? -339.2 * r2 + 161.4 * roughness - 25.9 : -8.48 * r2 + 14.3 * roughness - 9.95;
	float b = roughness < 0.25 ? 44.0 * r2 - 23.7 * roughness + 3.26 : 1.97 * r2 - 3.27 * roughness + 0.72;
	float DG = exp( a * dotNV + b ) + ( roughness < 0.25 ? 0.0 : 0.1 * ( roughness - 0.25 ) );
	return saturate( DG * RECIPROCAL_PI );
}
vec2 DFGApprox( const in vec3 normal, const in vec3 viewDir, const in float roughness ) {
	float dotNV = saturate( dot( normal, viewDir ) );
	const vec4 c0 = vec4( - 1, - 0.0275, - 0.572, 0.022 );
	const vec4 c1 = vec4( 1, 0.0425, 1.04, - 0.04 );
	vec4 r = roughness * c0 + c1;
	float a004 = min( r.x * r.x, exp2( - 9.28 * dotNV ) ) * r.x + r.y;
	vec2 fab = vec2( - 1.04, 1.04 ) * a004 + r.zw;
	return fab;
}
vec3 EnvironmentBRDF( const in vec3 normal, const in vec3 viewDir, const in vec3 specularColor, const in float specularF90, const in float roughness ) {
	vec2 fab = DFGApprox( normal, viewDir, roughness );
	return specularColor * fab.x + specularF90 * fab.y;
}
#ifdef USE_IRIDESCENCE
void computeMultiscatteringIridescence( const in vec3 normal, const in vec3 viewDir, const in vec3 specularColor, const in float specularF90, const in float iridescence, const in vec3 iridescenceF0, const in float roughness, inout vec3 singleScatter, inout vec3 multiScatter ) {
#else
void computeMultiscattering( const in vec3 normal, const in vec3 viewDir, const in vec3 specularColor, const in float specularF90, const in float roughness, inout vec3 singleScatter, inout vec3 multiScatter ) {
#endif
	vec2 fab = DFGApprox( normal, viewDir, roughness );
	#ifdef USE_IRIDESCENCE
		vec3 Fr = mix( specularColor, iridescenceF0, iridescence );
	#else
		vec3 Fr = specularColor;
	#endif
	vec3 FssEss = Fr * fab.x + specularF90 * fab.y;
	float Ess = fab.x + fab.y;
	float Ems = 1.0 - Ess;
	vec3 Favg = Fr + ( 1.0 - Fr ) * 0.047619;	vec3 Fms = FssEss * Favg / ( 1.0 - Ems * Favg );
	singleScatter += FssEss;
	multiScatter += Fms * Ems;
}
#if NUM_RECT_AREA_LIGHTS > 0
	void RE_Direct_RectArea_Physical( const in RectAreaLight rectAreaLight, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {
		vec3 normal = geometry.normal;
		vec3 viewDir = geometry.viewDir;
		vec3 position = geometry.position;
		vec3 lightPos = rectAreaLight.position;
		vec3 halfWidth = rectAreaLight.halfWidth;
		vec3 halfHeight = rectAreaLight.halfHeight;
		vec3 lightColor = rectAreaLight.color;
		float roughness = material.roughness;
		vec3 rectCoords[ 4 ];
		rectCoords[ 0 ] = lightPos + halfWidth - halfHeight;		rectCoords[ 1 ] = lightPos - halfWidth - halfHeight;
		rectCoords[ 2 ] = lightPos - halfWidth + halfHeight;
		rectCoords[ 3 ] = lightPos + halfWidth + halfHeight;
		vec2 uv = LTC_Uv( normal, viewDir, roughness );
		vec4 t1 = texture2D( ltc_1, uv );
		vec4 t2 = texture2D( ltc_2, uv );
		mat3 mInv = mat3(
			vec3( t1.x, 0, t1.y ),
			vec3(    0, 1,    0 ),
			vec3( t1.z, 0, t1.w )
		);
		vec3 fresnel = ( material.specularColor * t2.x + ( vec3( 1.0 ) - material.specularColor ) * t2.y );
		reflectedLight.directSpecular += lightColor * fresnel * LTC_Evaluate( normal, viewDir, position, mInv, rectCoords );
		reflectedLight.directDiffuse += lightColor * material.diffuseColor * LTC_Evaluate( normal, viewDir, position, mat3( 1.0 ), rectCoords );
	}
#endif
void RE_Direct_Physical( const in IncidentLight directLight, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {
	float dotNL = saturate( dot( geometry.normal, directLight.direction ) );
	vec3 irradiance = dotNL * directLight.color;
	#ifdef USE_CLEARCOAT
		float dotNLcc = saturate( dot( geometry.clearcoatNormal, directLight.direction ) );
		vec3 ccIrradiance = dotNLcc * directLight.color;
		clearcoatSpecular += ccIrradiance * BRDF_GGX_Clearcoat( directLight.direction, geometry.viewDir, geometry.clearcoatNormal, material );
	#endif
	#ifdef USE_SHEEN
		sheenSpecular += irradiance * BRDF_Sheen( directLight.direction, geometry.viewDir, geometry.normal, material.sheenColor, material.sheenRoughness );
	#endif
	reflectedLight.directSpecular += irradiance * BRDF_GGX( directLight.direction, geometry.viewDir, geometry.normal, material );
	reflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
}
void RE_IndirectDiffuse_Physical( const in vec3 irradiance, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {
	reflectedLight.indirectDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
}
void RE_IndirectSpecular_Physical( const in vec3 radiance, const in vec3 irradiance, const in vec3 clearcoatRadiance, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight) {
	#ifdef USE_CLEARCOAT
		clearcoatSpecular += clearcoatRadiance * EnvironmentBRDF( geometry.clearcoatNormal, geometry.viewDir, material.clearcoatF0, material.clearcoatF90, material.clearcoatRoughness );
	#endif
	#ifdef USE_SHEEN
		sheenSpecular += irradiance * material.sheenColor * IBLSheenBRDF( geometry.normal, geometry.viewDir, material.sheenRoughness );
	#endif
	vec3 singleScattering = vec3( 0.0 );
	vec3 multiScattering = vec3( 0.0 );
	vec3 cosineWeightedIrradiance = irradiance * RECIPROCAL_PI;
	#ifdef USE_IRIDESCENCE
		computeMultiscatteringIridescence( geometry.normal, geometry.viewDir, material.specularColor, material.specularF90, material.iridescence, material.iridescenceFresnel, material.roughness, singleScattering, multiScattering );
	#else
		computeMultiscattering( geometry.normal, geometry.viewDir, material.specularColor, material.specularF90, material.roughness, singleScattering, multiScattering );
	#endif
	vec3 totalScattering = singleScattering + multiScattering;
	vec3 diffuse = material.diffuseColor * ( 1.0 - max( max( totalScattering.r, totalScattering.g ), totalScattering.b ) );
	reflectedLight.indirectSpecular += radiance * singleScattering;
	reflectedLight.indirectSpecular += multiScattering * cosineWeightedIrradiance;
	reflectedLight.indirectDiffuse += diffuse * cosineWeightedIrradiance;
}
#define RE_Direct				RE_Direct_Physical
#define RE_Direct_RectArea		RE_Direct_RectArea_Physical
#define RE_IndirectDiffuse		RE_IndirectDiffuse_Physical
#define RE_IndirectSpecular		RE_IndirectSpecular_Physical
float computeSpecularOcclusion( const in float dotNV, const in float ambientOcclusion, const in float roughness ) {
	return saturate( pow( dotNV + ambientOcclusion, exp2( - 16.0 * roughness - 1.0 ) ) - 1.0 + ambientOcclusion );
}`,iU=`
GeometricContext geometry;
geometry.position = - vViewPosition;
geometry.normal = normal;
geometry.viewDir = ( isOrthographic ) ? vec3( 0, 0, 1 ) : normalize( vViewPosition );
#ifdef USE_CLEARCOAT
	geometry.clearcoatNormal = clearcoatNormal;
#endif
#ifdef USE_IRIDESCENCE
	float dotNVi = saturate( dot( normal, geometry.viewDir ) );
	if ( material.iridescenceThickness == 0.0 ) {
		material.iridescence = 0.0;
	} else {
		material.iridescence = saturate( material.iridescence );
	}
	if ( material.iridescence > 0.0 ) {
		material.iridescenceFresnel = evalIridescence( 1.0, material.iridescenceIOR, dotNVi, material.iridescenceThickness, material.specularColor );
		material.iridescenceF0 = Schlick_to_F0( material.iridescenceFresnel, 1.0, dotNVi );
	}
#endif
IncidentLight directLight;
#if ( NUM_POINT_LIGHTS > 0 ) && defined( RE_Direct )
	PointLight pointLight;
	#if defined( USE_SHADOWMAP ) && NUM_POINT_LIGHT_SHADOWS > 0
	PointLightShadow pointLightShadow;
	#endif
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_POINT_LIGHTS; i ++ ) {
		pointLight = pointLights[ i ];
		getPointLightInfo( pointLight, geometry, directLight );
		#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_POINT_LIGHT_SHADOWS )
		pointLightShadow = pointLightShadows[ i ];
		directLight.color *= ( directLight.visible && receiveShadow ) ? getPointShadow( pointShadowMap[ i ], pointLightShadow.shadowMapSize, pointLightShadow.shadowBias, pointLightShadow.shadowRadius, vPointShadowCoord[ i ], pointLightShadow.shadowCameraNear, pointLightShadow.shadowCameraFar ) : 1.0;
		#endif
		RE_Direct( directLight, geometry, material, reflectedLight );
	}
	#pragma unroll_loop_end
#endif
#if ( NUM_SPOT_LIGHTS > 0 ) && defined( RE_Direct )
	SpotLight spotLight;
	vec4 spotColor;
	vec3 spotLightCoord;
	bool inSpotLightMap;
	#if defined( USE_SHADOWMAP ) && NUM_SPOT_LIGHT_SHADOWS > 0
	SpotLightShadow spotLightShadow;
	#endif
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_SPOT_LIGHTS; i ++ ) {
		spotLight = spotLights[ i ];
		getSpotLightInfo( spotLight, geometry, directLight );
		#if ( UNROLLED_LOOP_INDEX < NUM_SPOT_LIGHT_SHADOWS_WITH_MAPS )
		#define SPOT_LIGHT_MAP_INDEX UNROLLED_LOOP_INDEX
		#elif ( UNROLLED_LOOP_INDEX < NUM_SPOT_LIGHT_SHADOWS )
		#define SPOT_LIGHT_MAP_INDEX NUM_SPOT_LIGHT_MAPS
		#else
		#define SPOT_LIGHT_MAP_INDEX ( UNROLLED_LOOP_INDEX - NUM_SPOT_LIGHT_SHADOWS + NUM_SPOT_LIGHT_SHADOWS_WITH_MAPS )
		#endif
		#if ( SPOT_LIGHT_MAP_INDEX < NUM_SPOT_LIGHT_MAPS )
			spotLightCoord = vSpotLightCoord[ i ].xyz / vSpotLightCoord[ i ].w;
			inSpotLightMap = all( lessThan( abs( spotLightCoord * 2. - 1. ), vec3( 1.0 ) ) );
			spotColor = texture2D( spotLightMap[ SPOT_LIGHT_MAP_INDEX ], spotLightCoord.xy );
			directLight.color = inSpotLightMap ? directLight.color * spotColor.rgb : directLight.color;
		#endif
		#undef SPOT_LIGHT_MAP_INDEX
		#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_SPOT_LIGHT_SHADOWS )
		spotLightShadow = spotLightShadows[ i ];
		directLight.color *= ( directLight.visible && receiveShadow ) ? getShadow( spotShadowMap[ i ], spotLightShadow.shadowMapSize, spotLightShadow.shadowBias, spotLightShadow.shadowRadius, vSpotLightCoord[ i ] ) : 1.0;
		#endif
		RE_Direct( directLight, geometry, material, reflectedLight );
	}
	#pragma unroll_loop_end
#endif
#if ( NUM_DIR_LIGHTS > 0 ) && defined( RE_Direct )
	DirectionalLight directionalLight;
	#if defined( USE_SHADOWMAP ) && NUM_DIR_LIGHT_SHADOWS > 0
	DirectionalLightShadow directionalLightShadow;
	#endif
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_DIR_LIGHTS; i ++ ) {
		directionalLight = directionalLights[ i ];
		getDirectionalLightInfo( directionalLight, geometry, directLight );
		#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_DIR_LIGHT_SHADOWS )
		directionalLightShadow = directionalLightShadows[ i ];
		directLight.color *= ( directLight.visible && receiveShadow ) ? getShadow( directionalShadowMap[ i ], directionalLightShadow.shadowMapSize, directionalLightShadow.shadowBias, directionalLightShadow.shadowRadius, vDirectionalShadowCoord[ i ] ) : 1.0;
		#endif
		RE_Direct( directLight, geometry, material, reflectedLight );
	}
	#pragma unroll_loop_end
#endif
#if ( NUM_RECT_AREA_LIGHTS > 0 ) && defined( RE_Direct_RectArea )
	RectAreaLight rectAreaLight;
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_RECT_AREA_LIGHTS; i ++ ) {
		rectAreaLight = rectAreaLights[ i ];
		RE_Direct_RectArea( rectAreaLight, geometry, material, reflectedLight );
	}
	#pragma unroll_loop_end
#endif
#if defined( RE_IndirectDiffuse )
	vec3 iblIrradiance = vec3( 0.0 );
	vec3 irradiance = getAmbientLightIrradiance( ambientLightColor );
	irradiance += getLightProbeIrradiance( lightProbe, geometry.normal );
	#if ( NUM_HEMI_LIGHTS > 0 )
		#pragma unroll_loop_start
		for ( int i = 0; i < NUM_HEMI_LIGHTS; i ++ ) {
			irradiance += getHemisphereLightIrradiance( hemisphereLights[ i ], geometry.normal );
		}
		#pragma unroll_loop_end
	#endif
#endif
#if defined( RE_IndirectSpecular )
	vec3 radiance = vec3( 0.0 );
	vec3 clearcoatRadiance = vec3( 0.0 );
#endif`,sU=`#if defined( RE_IndirectDiffuse )
	#ifdef USE_LIGHTMAP
		vec4 lightMapTexel = texture2D( lightMap, vLightMapUv );
		vec3 lightMapIrradiance = lightMapTexel.rgb * lightMapIntensity;
		irradiance += lightMapIrradiance;
	#endif
	#if defined( USE_ENVMAP ) && defined( STANDARD ) && defined( ENVMAP_TYPE_CUBE_UV )
		iblIrradiance += getIBLIrradiance( geometry.normal );
	#endif
#endif
#if defined( USE_ENVMAP ) && defined( RE_IndirectSpecular )
	#ifdef USE_ANISOTROPY
		radiance += getIBLAnisotropyRadiance( geometry.viewDir, geometry.normal, material.roughness, material.anisotropyB, material.anisotropy );
	#else
		radiance += getIBLRadiance( geometry.viewDir, geometry.normal, material.roughness );
	#endif
	#ifdef USE_CLEARCOAT
		clearcoatRadiance += getIBLRadiance( geometry.viewDir, geometry.clearcoatNormal, material.clearcoatRoughness );
	#endif
#endif`,rU=`#if defined( RE_IndirectDiffuse )
	RE_IndirectDiffuse( irradiance, geometry, material, reflectedLight );
#endif
#if defined( RE_IndirectSpecular )
	RE_IndirectSpecular( radiance, iblIrradiance, clearcoatRadiance, geometry, material, reflectedLight );
#endif`,oU=`#if defined( USE_LOGDEPTHBUF ) && defined( USE_LOGDEPTHBUF_EXT )
	gl_FragDepthEXT = vIsPerspective == 0.0 ? gl_FragCoord.z : log2( vFragDepth ) * logDepthBufFC * 0.5;
#endif`,aU=`#if defined( USE_LOGDEPTHBUF ) && defined( USE_LOGDEPTHBUF_EXT )
	uniform float logDepthBufFC;
	varying float vFragDepth;
	varying float vIsPerspective;
#endif`,lU=`#ifdef USE_LOGDEPTHBUF
	#ifdef USE_LOGDEPTHBUF_EXT
		varying float vFragDepth;
		varying float vIsPerspective;
	#else
		uniform float logDepthBufFC;
	#endif
#endif`,cU=`#ifdef USE_LOGDEPTHBUF
	#ifdef USE_LOGDEPTHBUF_EXT
		vFragDepth = 1.0 + gl_Position.w;
		vIsPerspective = float( isPerspectiveMatrix( projectionMatrix ) );
	#else
		if ( isPerspectiveMatrix( projectionMatrix ) ) {
			gl_Position.z = log2( max( EPSILON, gl_Position.w + 1.0 ) ) * logDepthBufFC - 1.0;
			gl_Position.z *= gl_Position.w;
		}
	#endif
#endif`,uU=`#ifdef USE_MAP
	diffuseColor *= texture2D( map, vMapUv );
#endif`,hU=`#ifdef USE_MAP
	uniform sampler2D map;
#endif`,fU=`#if defined( USE_MAP ) || defined( USE_ALPHAMAP )
	#if defined( USE_POINTS_UV )
		vec2 uv = vUv;
	#else
		vec2 uv = ( uvTransform * vec3( gl_PointCoord.x, 1.0 - gl_PointCoord.y, 1 ) ).xy;
	#endif
#endif
#ifdef USE_MAP
	diffuseColor *= texture2D( map, uv );
#endif
#ifdef USE_ALPHAMAP
	diffuseColor.a *= texture2D( alphaMap, uv ).g;
#endif`,dU=`#if defined( USE_POINTS_UV )
	varying vec2 vUv;
#else
	#if defined( USE_MAP ) || defined( USE_ALPHAMAP )
		uniform mat3 uvTransform;
	#endif
#endif
#ifdef USE_MAP
	uniform sampler2D map;
#endif
#ifdef USE_ALPHAMAP
	uniform sampler2D alphaMap;
#endif`,pU=`float metalnessFactor = metalness;
#ifdef USE_METALNESSMAP
	vec4 texelMetalness = texture2D( metalnessMap, vMetalnessMapUv );
	metalnessFactor *= texelMetalness.b;
#endif`,mU=`#ifdef USE_METALNESSMAP
	uniform sampler2D metalnessMap;
#endif`,gU=`#if defined( USE_MORPHCOLORS ) && defined( MORPHTARGETS_TEXTURE )
	vColor *= morphTargetBaseInfluence;
	for ( int i = 0; i < MORPHTARGETS_COUNT; i ++ ) {
		#if defined( USE_COLOR_ALPHA )
			if ( morphTargetInfluences[ i ] != 0.0 ) vColor += getMorph( gl_VertexID, i, 2 ) * morphTargetInfluences[ i ];
		#elif defined( USE_COLOR )
			if ( morphTargetInfluences[ i ] != 0.0 ) vColor += getMorph( gl_VertexID, i, 2 ).rgb * morphTargetInfluences[ i ];
		#endif
	}
#endif`,vU=`#ifdef USE_MORPHNORMALS
	objectNormal *= morphTargetBaseInfluence;
	#ifdef MORPHTARGETS_TEXTURE
		for ( int i = 0; i < MORPHTARGETS_COUNT; i ++ ) {
			if ( morphTargetInfluences[ i ] != 0.0 ) objectNormal += getMorph( gl_VertexID, i, 1 ).xyz * morphTargetInfluences[ i ];
		}
	#else
		objectNormal += morphNormal0 * morphTargetInfluences[ 0 ];
		objectNormal += morphNormal1 * morphTargetInfluences[ 1 ];
		objectNormal += morphNormal2 * morphTargetInfluences[ 2 ];
		objectNormal += morphNormal3 * morphTargetInfluences[ 3 ];
	#endif
#endif`,_U=`#ifdef USE_MORPHTARGETS
	uniform float morphTargetBaseInfluence;
	#ifdef MORPHTARGETS_TEXTURE
		uniform float morphTargetInfluences[ MORPHTARGETS_COUNT ];
		uniform sampler2DArray morphTargetsTexture;
		uniform ivec2 morphTargetsTextureSize;
		vec4 getMorph( const in int vertexIndex, const in int morphTargetIndex, const in int offset ) {
			int texelIndex = vertexIndex * MORPHTARGETS_TEXTURE_STRIDE + offset;
			int y = texelIndex / morphTargetsTextureSize.x;
			int x = texelIndex - y * morphTargetsTextureSize.x;
			ivec3 morphUV = ivec3( x, y, morphTargetIndex );
			return texelFetch( morphTargetsTexture, morphUV, 0 );
		}
	#else
		#ifndef USE_MORPHNORMALS
			uniform float morphTargetInfluences[ 8 ];
		#else
			uniform float morphTargetInfluences[ 4 ];
		#endif
	#endif
#endif`,yU=`#ifdef USE_MORPHTARGETS
	transformed *= morphTargetBaseInfluence;
	#ifdef MORPHTARGETS_TEXTURE
		for ( int i = 0; i < MORPHTARGETS_COUNT; i ++ ) {
			if ( morphTargetInfluences[ i ] != 0.0 ) transformed += getMorph( gl_VertexID, i, 0 ).xyz * morphTargetInfluences[ i ];
		}
	#else
		transformed += morphTarget0 * morphTargetInfluences[ 0 ];
		transformed += morphTarget1 * morphTargetInfluences[ 1 ];
		transformed += morphTarget2 * morphTargetInfluences[ 2 ];
		transformed += morphTarget3 * morphTargetInfluences[ 3 ];
		#ifndef USE_MORPHNORMALS
			transformed += morphTarget4 * morphTargetInfluences[ 4 ];
			transformed += morphTarget5 * morphTargetInfluences[ 5 ];
			transformed += morphTarget6 * morphTargetInfluences[ 6 ];
			transformed += morphTarget7 * morphTargetInfluences[ 7 ];
		#endif
	#endif
#endif`,xU=`float faceDirection = gl_FrontFacing ? 1.0 : - 1.0;
#ifdef FLAT_SHADED
	vec3 fdx = dFdx( vViewPosition );
	vec3 fdy = dFdy( vViewPosition );
	vec3 normal = normalize( cross( fdx, fdy ) );
#else
	vec3 normal = normalize( vNormal );
	#ifdef DOUBLE_SIDED
		normal *= faceDirection;
	#endif
#endif
#if defined( USE_NORMALMAP_TANGENTSPACE ) || defined( USE_CLEARCOAT_NORMALMAP ) || defined( USE_ANISOTROPY )
	#ifdef USE_TANGENT
		mat3 tbn = mat3( normalize( vTangent ), normalize( vBitangent ), normal );
	#else
		mat3 tbn = getTangentFrame( - vViewPosition, normal,
		#if defined( USE_NORMALMAP )
			vNormalMapUv
		#elif defined( USE_CLEARCOAT_NORMALMAP )
			vClearcoatNormalMapUv
		#else
			vUv
		#endif
		);
	#endif
	#if defined( DOUBLE_SIDED ) && ! defined( FLAT_SHADED )
		tbn[0] *= faceDirection;
		tbn[1] *= faceDirection;
	#endif
#endif
#ifdef USE_CLEARCOAT_NORMALMAP
	#ifdef USE_TANGENT
		mat3 tbn2 = mat3( normalize( vTangent ), normalize( vBitangent ), normal );
	#else
		mat3 tbn2 = getTangentFrame( - vViewPosition, normal, vClearcoatNormalMapUv );
	#endif
	#if defined( DOUBLE_SIDED ) && ! defined( FLAT_SHADED )
		tbn2[0] *= faceDirection;
		tbn2[1] *= faceDirection;
	#endif
#endif
vec3 geometryNormal = normal;`,bU=`#ifdef USE_NORMALMAP_OBJECTSPACE
	normal = texture2D( normalMap, vNormalMapUv ).xyz * 2.0 - 1.0;
	#ifdef FLIP_SIDED
		normal = - normal;
	#endif
	#ifdef DOUBLE_SIDED
		normal = normal * faceDirection;
	#endif
	normal = normalize( normalMatrix * normal );
#elif defined( USE_NORMALMAP_TANGENTSPACE )
	vec3 mapN = texture2D( normalMap, vNormalMapUv ).xyz * 2.0 - 1.0;
	mapN.xy *= normalScale;
	normal = normalize( tbn * mapN );
#elif defined( USE_BUMPMAP )
	normal = perturbNormalArb( - vViewPosition, normal, dHdxy_fwd(), faceDirection );
#endif`,wU=`#ifndef FLAT_SHADED
	varying vec3 vNormal;
	#ifdef USE_TANGENT
		varying vec3 vTangent;
		varying vec3 vBitangent;
	#endif
#endif`,MU=`#ifndef FLAT_SHADED
	varying vec3 vNormal;
	#ifdef USE_TANGENT
		varying vec3 vTangent;
		varying vec3 vBitangent;
	#endif
#endif`,SU=`#ifndef FLAT_SHADED
	vNormal = normalize( transformedNormal );
	#ifdef USE_TANGENT
		vTangent = normalize( transformedTangent );
		vBitangent = normalize( cross( vNormal, vTangent ) * tangent.w );
	#endif
#endif`,AU=`#ifdef USE_NORMALMAP
	uniform sampler2D normalMap;
	uniform vec2 normalScale;
#endif
#ifdef USE_NORMALMAP_OBJECTSPACE
	uniform mat3 normalMatrix;
#endif
#if ! defined ( USE_TANGENT ) && ( defined ( USE_NORMALMAP_TANGENTSPACE ) || defined ( USE_CLEARCOAT_NORMALMAP ) || defined( USE_ANISOTROPY ) )
	mat3 getTangentFrame( vec3 eye_pos, vec3 surf_norm, vec2 uv ) {
		vec3 q0 = dFdx( eye_pos.xyz );
		vec3 q1 = dFdy( eye_pos.xyz );
		vec2 st0 = dFdx( uv.st );
		vec2 st1 = dFdy( uv.st );
		vec3 N = surf_norm;
		vec3 q1perp = cross( q1, N );
		vec3 q0perp = cross( N, q0 );
		vec3 T = q1perp * st0.x + q0perp * st1.x;
		vec3 B = q1perp * st0.y + q0perp * st1.y;
		float det = max( dot( T, T ), dot( B, B ) );
		float scale = ( det == 0.0 ) ? 0.0 : inversesqrt( det );
		return mat3( T * scale, B * scale, N );
	}
#endif`,EU=`#ifdef USE_CLEARCOAT
	vec3 clearcoatNormal = geometryNormal;
#endif`,TU=`#ifdef USE_CLEARCOAT_NORMALMAP
	vec3 clearcoatMapN = texture2D( clearcoatNormalMap, vClearcoatNormalMapUv ).xyz * 2.0 - 1.0;
	clearcoatMapN.xy *= clearcoatNormalScale;
	clearcoatNormal = normalize( tbn2 * clearcoatMapN );
#endif`,CU=`#ifdef USE_CLEARCOATMAP
	uniform sampler2D clearcoatMap;
#endif
#ifdef USE_CLEARCOAT_NORMALMAP
	uniform sampler2D clearcoatNormalMap;
	uniform vec2 clearcoatNormalScale;
#endif
#ifdef USE_CLEARCOAT_ROUGHNESSMAP
	uniform sampler2D clearcoatRoughnessMap;
#endif`,PU=`#ifdef USE_IRIDESCENCEMAP
	uniform sampler2D iridescenceMap;
#endif
#ifdef USE_IRIDESCENCE_THICKNESSMAP
	uniform sampler2D iridescenceThicknessMap;
#endif`,RU=`#ifdef OPAQUE
diffuseColor.a = 1.0;
#endif
#ifdef USE_TRANSMISSION
diffuseColor.a *= material.transmissionAlpha;
#endif
gl_FragColor = vec4( outgoingLight, diffuseColor.a );`,LU=`vec3 packNormalToRGB( const in vec3 normal ) {
	return normalize( normal ) * 0.5 + 0.5;
}
vec3 unpackRGBToNormal( const in vec3 rgb ) {
	return 2.0 * rgb.xyz - 1.0;
}
const float PackUpscale = 256. / 255.;const float UnpackDownscale = 255. / 256.;
const vec3 PackFactors = vec3( 256. * 256. * 256., 256. * 256., 256. );
const vec4 UnpackFactors = UnpackDownscale / vec4( PackFactors, 1. );
const float ShiftRight8 = 1. / 256.;
vec4 packDepthToRGBA( const in float v ) {
	vec4 r = vec4( fract( v * PackFactors ), v );
	r.yzw -= r.xyz * ShiftRight8;	return r * PackUpscale;
}
float unpackRGBAToDepth( const in vec4 v ) {
	return dot( v, UnpackFactors );
}
vec2 packDepthToRG( in highp float v ) {
	return packDepthToRGBA( v ).yx;
}
float unpackRGToDepth( const in highp vec2 v ) {
	return unpackRGBAToDepth( vec4( v.xy, 0.0, 0.0 ) );
}
vec4 pack2HalfToRGBA( vec2 v ) {
	vec4 r = vec4( v.x, fract( v.x * 255.0 ), v.y, fract( v.y * 255.0 ) );
	return vec4( r.x - r.y / 255.0, r.y, r.z - r.w / 255.0, r.w );
}
vec2 unpackRGBATo2Half( vec4 v ) {
	return vec2( v.x + ( v.y / 255.0 ), v.z + ( v.w / 255.0 ) );
}
float viewZToOrthographicDepth( const in float viewZ, const in float near, const in float far ) {
	return ( viewZ + near ) / ( near - far );
}
float orthographicDepthToViewZ( const in float depth, const in float near, const in float far ) {
	return depth * ( near - far ) - near;
}
float viewZToPerspectiveDepth( const in float viewZ, const in float near, const in float far ) {
	return ( ( near + viewZ ) * far ) / ( ( far - near ) * viewZ );
}
float perspectiveDepthToViewZ( const in float depth, const in float near, const in float far ) {
	return ( near * far ) / ( ( far - near ) * depth - far );
}`,DU=`#ifdef PREMULTIPLIED_ALPHA
	gl_FragColor.rgb *= gl_FragColor.a;
#endif`,IU=`vec4 mvPosition = vec4( transformed, 1.0 );
#ifdef USE_INSTANCING
	mvPosition = instanceMatrix * mvPosition;
#endif
mvPosition = modelViewMatrix * mvPosition;
gl_Position = projectionMatrix * mvPosition;`,OU=`#ifdef DITHERING
	gl_FragColor.rgb = dithering( gl_FragColor.rgb );
#endif`,zU=`#ifdef DITHERING
	vec3 dithering( vec3 color ) {
		float grid_position = rand( gl_FragCoord.xy );
		vec3 dither_shift_RGB = vec3( 0.25 / 255.0, -0.25 / 255.0, 0.25 / 255.0 );
		dither_shift_RGB = mix( 2.0 * dither_shift_RGB, -2.0 * dither_shift_RGB, grid_position );
		return color + dither_shift_RGB;
	}
#endif`,kU=`float roughnessFactor = roughness;
#ifdef USE_ROUGHNESSMAP
	vec4 texelRoughness = texture2D( roughnessMap, vRoughnessMapUv );
	roughnessFactor *= texelRoughness.g;
#endif`,UU=`#ifdef USE_ROUGHNESSMAP
	uniform sampler2D roughnessMap;
#endif`,NU=`#if NUM_SPOT_LIGHT_COORDS > 0
	varying vec4 vSpotLightCoord[ NUM_SPOT_LIGHT_COORDS ];
#endif
#if NUM_SPOT_LIGHT_MAPS > 0
	uniform sampler2D spotLightMap[ NUM_SPOT_LIGHT_MAPS ];
#endif
#ifdef USE_SHADOWMAP
	#if NUM_DIR_LIGHT_SHADOWS > 0
		uniform sampler2D directionalShadowMap[ NUM_DIR_LIGHT_SHADOWS ];
		varying vec4 vDirectionalShadowCoord[ NUM_DIR_LIGHT_SHADOWS ];
		struct DirectionalLightShadow {
			float shadowBias;
			float shadowNormalBias;
			float shadowRadius;
			vec2 shadowMapSize;
		};
		uniform DirectionalLightShadow directionalLightShadows[ NUM_DIR_LIGHT_SHADOWS ];
	#endif
	#if NUM_SPOT_LIGHT_SHADOWS > 0
		uniform sampler2D spotShadowMap[ NUM_SPOT_LIGHT_SHADOWS ];
		struct SpotLightShadow {
			float shadowBias;
			float shadowNormalBias;
			float shadowRadius;
			vec2 shadowMapSize;
		};
		uniform SpotLightShadow spotLightShadows[ NUM_SPOT_LIGHT_SHADOWS ];
	#endif
	#if NUM_POINT_LIGHT_SHADOWS > 0
		uniform sampler2D pointShadowMap[ NUM_POINT_LIGHT_SHADOWS ];
		varying vec4 vPointShadowCoord[ NUM_POINT_LIGHT_SHADOWS ];
		struct PointLightShadow {
			float shadowBias;
			float shadowNormalBias;
			float shadowRadius;
			vec2 shadowMapSize;
			float shadowCameraNear;
			float shadowCameraFar;
		};
		uniform PointLightShadow pointLightShadows[ NUM_POINT_LIGHT_SHADOWS ];
	#endif
	float texture2DCompare( sampler2D depths, vec2 uv, float compare ) {
		return step( compare, unpackRGBAToDepth( texture2D( depths, uv ) ) );
	}
	vec2 texture2DDistribution( sampler2D shadow, vec2 uv ) {
		return unpackRGBATo2Half( texture2D( shadow, uv ) );
	}
	float VSMShadow (sampler2D shadow, vec2 uv, float compare ){
		float occlusion = 1.0;
		vec2 distribution = texture2DDistribution( shadow, uv );
		float hard_shadow = step( compare , distribution.x );
		if (hard_shadow != 1.0 ) {
			float distance = compare - distribution.x ;
			float variance = max( 0.00000, distribution.y * distribution.y );
			float softness_probability = variance / (variance + distance * distance );			softness_probability = clamp( ( softness_probability - 0.3 ) / ( 0.95 - 0.3 ), 0.0, 1.0 );			occlusion = clamp( max( hard_shadow, softness_probability ), 0.0, 1.0 );
		}
		return occlusion;
	}
	float getShadow( sampler2D shadowMap, vec2 shadowMapSize, float shadowBias, float shadowRadius, vec4 shadowCoord ) {
		float shadow = 1.0;
		shadowCoord.xyz /= shadowCoord.w;
		shadowCoord.z += shadowBias;
		bool inFrustum = shadowCoord.x >= 0.0 && shadowCoord.x <= 1.0 && shadowCoord.y >= 0.0 && shadowCoord.y <= 1.0;
		bool frustumTest = inFrustum && shadowCoord.z <= 1.0;
		if ( frustumTest ) {
		#if defined( SHADOWMAP_TYPE_PCF )
			vec2 texelSize = vec2( 1.0 ) / shadowMapSize;
			float dx0 = - texelSize.x * shadowRadius;
			float dy0 = - texelSize.y * shadowRadius;
			float dx1 = + texelSize.x * shadowRadius;
			float dy1 = + texelSize.y * shadowRadius;
			float dx2 = dx0 / 2.0;
			float dy2 = dy0 / 2.0;
			float dx3 = dx1 / 2.0;
			float dy3 = dy1 / 2.0;
			shadow = (
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, dy0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, dy0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx2, dy2 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy2 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx3, dy2 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, 0.0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx2, 0.0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy, shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx3, 0.0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, 0.0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx2, dy3 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy3 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx3, dy3 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, dy1 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy1 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, dy1 ), shadowCoord.z )
			) * ( 1.0 / 17.0 );
		#elif defined( SHADOWMAP_TYPE_PCF_SOFT )
			vec2 texelSize = vec2( 1.0 ) / shadowMapSize;
			float dx = texelSize.x;
			float dy = texelSize.y;
			vec2 uv = shadowCoord.xy;
			vec2 f = fract( uv * shadowMapSize + 0.5 );
			uv -= f * texelSize;
			shadow = (
				texture2DCompare( shadowMap, uv, shadowCoord.z ) +
				texture2DCompare( shadowMap, uv + vec2( dx, 0.0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, uv + vec2( 0.0, dy ), shadowCoord.z ) +
				texture2DCompare( shadowMap, uv + texelSize, shadowCoord.z ) +
				mix( texture2DCompare( shadowMap, uv + vec2( -dx, 0.0 ), shadowCoord.z ),
					 texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, 0.0 ), shadowCoord.z ),
					 f.x ) +
				mix( texture2DCompare( shadowMap, uv + vec2( -dx, dy ), shadowCoord.z ),
					 texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, dy ), shadowCoord.z ),
					 f.x ) +
				mix( texture2DCompare( shadowMap, uv + vec2( 0.0, -dy ), shadowCoord.z ),
					 texture2DCompare( shadowMap, uv + vec2( 0.0, 2.0 * dy ), shadowCoord.z ),
					 f.y ) +
				mix( texture2DCompare( shadowMap, uv + vec2( dx, -dy ), shadowCoord.z ),
					 texture2DCompare( shadowMap, uv + vec2( dx, 2.0 * dy ), shadowCoord.z ),
					 f.y ) +
				mix( mix( texture2DCompare( shadowMap, uv + vec2( -dx, -dy ), shadowCoord.z ),
						  texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, -dy ), shadowCoord.z ),
						  f.x ),
					 mix( texture2DCompare( shadowMap, uv + vec2( -dx, 2.0 * dy ), shadowCoord.z ),
						  texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, 2.0 * dy ), shadowCoord.z ),
						  f.x ),
					 f.y )
			) * ( 1.0 / 9.0 );
		#elif defined( SHADOWMAP_TYPE_VSM )
			shadow = VSMShadow( shadowMap, shadowCoord.xy, shadowCoord.z );
		#else
			shadow = texture2DCompare( shadowMap, shadowCoord.xy, shadowCoord.z );
		#endif
		}
		return shadow;
	}
	vec2 cubeToUV( vec3 v, float texelSizeY ) {
		vec3 absV = abs( v );
		float scaleToCube = 1.0 / max( absV.x, max( absV.y, absV.z ) );
		absV *= scaleToCube;
		v *= scaleToCube * ( 1.0 - 2.0 * texelSizeY );
		vec2 planar = v.xy;
		float almostATexel = 1.5 * texelSizeY;
		float almostOne = 1.0 - almostATexel;
		if ( absV.z >= almostOne ) {
			if ( v.z > 0.0 )
				planar.x = 4.0 - v.x;
		} else if ( absV.x >= almostOne ) {
			float signX = sign( v.x );
			planar.x = v.z * signX + 2.0 * signX;
		} else if ( absV.y >= almostOne ) {
			float signY = sign( v.y );
			planar.x = v.x + 2.0 * signY + 2.0;
			planar.y = v.z * signY - 2.0;
		}
		return vec2( 0.125, 0.25 ) * planar + vec2( 0.375, 0.75 );
	}
	float getPointShadow( sampler2D shadowMap, vec2 shadowMapSize, float shadowBias, float shadowRadius, vec4 shadowCoord, float shadowCameraNear, float shadowCameraFar ) {
		vec2 texelSize = vec2( 1.0 ) / ( shadowMapSize * vec2( 4.0, 2.0 ) );
		vec3 lightToPosition = shadowCoord.xyz;
		float dp = ( length( lightToPosition ) - shadowCameraNear ) / ( shadowCameraFar - shadowCameraNear );		dp += shadowBias;
		vec3 bd3D = normalize( lightToPosition );
		#if defined( SHADOWMAP_TYPE_PCF ) || defined( SHADOWMAP_TYPE_PCF_SOFT ) || defined( SHADOWMAP_TYPE_VSM )
			vec2 offset = vec2( - 1, 1 ) * shadowRadius * texelSize.y;
			return (
				texture2DCompare( shadowMap, cubeToUV( bd3D + offset.xyy, texelSize.y ), dp ) +
				texture2DCompare( shadowMap, cubeToUV( bd3D + offset.yyy, texelSize.y ), dp ) +
				texture2DCompare( shadowMap, cubeToUV( bd3D + offset.xyx, texelSize.y ), dp ) +
				texture2DCompare( shadowMap, cubeToUV( bd3D + offset.yyx, texelSize.y ), dp ) +
				texture2DCompare( shadowMap, cubeToUV( bd3D, texelSize.y ), dp ) +
				texture2DCompare( shadowMap, cubeToUV( bd3D + offset.xxy, texelSize.y ), dp ) +
				texture2DCompare( shadowMap, cubeToUV( bd3D + offset.yxy, texelSize.y ), dp ) +
				texture2DCompare( shadowMap, cubeToUV( bd3D + offset.xxx, texelSize.y ), dp ) +
				texture2DCompare( shadowMap, cubeToUV( bd3D + offset.yxx, texelSize.y ), dp )
			) * ( 1.0 / 9.0 );
		#else
			return texture2DCompare( shadowMap, cubeToUV( bd3D, texelSize.y ), dp );
		#endif
	}
#endif`,FU=`#if NUM_SPOT_LIGHT_COORDS > 0
	uniform mat4 spotLightMatrix[ NUM_SPOT_LIGHT_COORDS ];
	varying vec4 vSpotLightCoord[ NUM_SPOT_LIGHT_COORDS ];
#endif
#ifdef USE_SHADOWMAP
	#if NUM_DIR_LIGHT_SHADOWS > 0
		uniform mat4 directionalShadowMatrix[ NUM_DIR_LIGHT_SHADOWS ];
		varying vec4 vDirectionalShadowCoord[ NUM_DIR_LIGHT_SHADOWS ];
		struct DirectionalLightShadow {
			float shadowBias;
			float shadowNormalBias;
			float shadowRadius;
			vec2 shadowMapSize;
		};
		uniform DirectionalLightShadow directionalLightShadows[ NUM_DIR_LIGHT_SHADOWS ];
	#endif
	#if NUM_SPOT_LIGHT_SHADOWS > 0
		struct SpotLightShadow {
			float shadowBias;
			float shadowNormalBias;
			float shadowRadius;
			vec2 shadowMapSize;
		};
		uniform SpotLightShadow spotLightShadows[ NUM_SPOT_LIGHT_SHADOWS ];
	#endif
	#if NUM_POINT_LIGHT_SHADOWS > 0
		uniform mat4 pointShadowMatrix[ NUM_POINT_LIGHT_SHADOWS ];
		varying vec4 vPointShadowCoord[ NUM_POINT_LIGHT_SHADOWS ];
		struct PointLightShadow {
			float shadowBias;
			float shadowNormalBias;
			float shadowRadius;
			vec2 shadowMapSize;
			float shadowCameraNear;
			float shadowCameraFar;
		};
		uniform PointLightShadow pointLightShadows[ NUM_POINT_LIGHT_SHADOWS ];
	#endif
#endif`,BU=`#if ( defined( USE_SHADOWMAP ) && ( NUM_DIR_LIGHT_SHADOWS > 0 || NUM_POINT_LIGHT_SHADOWS > 0 ) ) || ( NUM_SPOT_LIGHT_COORDS > 0 )
	vec3 shadowWorldNormal = inverseTransformDirection( transformedNormal, viewMatrix );
	vec4 shadowWorldPosition;
#endif
#if defined( USE_SHADOWMAP )
	#if NUM_DIR_LIGHT_SHADOWS > 0
		#pragma unroll_loop_start
		for ( int i = 0; i < NUM_DIR_LIGHT_SHADOWS; i ++ ) {
			shadowWorldPosition = worldPosition + vec4( shadowWorldNormal * directionalLightShadows[ i ].shadowNormalBias, 0 );
			vDirectionalShadowCoord[ i ] = directionalShadowMatrix[ i ] * shadowWorldPosition;
		}
		#pragma unroll_loop_end
	#endif
	#if NUM_POINT_LIGHT_SHADOWS > 0
		#pragma unroll_loop_start
		for ( int i = 0; i < NUM_POINT_LIGHT_SHADOWS; i ++ ) {
			shadowWorldPosition = worldPosition + vec4( shadowWorldNormal * pointLightShadows[ i ].shadowNormalBias, 0 );
			vPointShadowCoord[ i ] = pointShadowMatrix[ i ] * shadowWorldPosition;
		}
		#pragma unroll_loop_end
	#endif
#endif
#if NUM_SPOT_LIGHT_COORDS > 0
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_SPOT_LIGHT_COORDS; i ++ ) {
		shadowWorldPosition = worldPosition;
		#if ( defined( USE_SHADOWMAP ) && UNROLLED_LOOP_INDEX < NUM_SPOT_LIGHT_SHADOWS )
			shadowWorldPosition.xyz += shadowWorldNormal * spotLightShadows[ i ].shadowNormalBias;
		#endif
		vSpotLightCoord[ i ] = spotLightMatrix[ i ] * shadowWorldPosition;
	}
	#pragma unroll_loop_end
#endif`,HU=`float getShadowMask() {
	float shadow = 1.0;
	#ifdef USE_SHADOWMAP
	#if NUM_DIR_LIGHT_SHADOWS > 0
	DirectionalLightShadow directionalLight;
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_DIR_LIGHT_SHADOWS; i ++ ) {
		directionalLight = directionalLightShadows[ i ];
		shadow *= receiveShadow ? getShadow( directionalShadowMap[ i ], directionalLight.shadowMapSize, directionalLight.shadowBias, directionalLight.shadowRadius, vDirectionalShadowCoord[ i ] ) : 1.0;
	}
	#pragma unroll_loop_end
	#endif
	#if NUM_SPOT_LIGHT_SHADOWS > 0
	SpotLightShadow spotLight;
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_SPOT_LIGHT_SHADOWS; i ++ ) {
		spotLight = spotLightShadows[ i ];
		shadow *= receiveShadow ? getShadow( spotShadowMap[ i ], spotLight.shadowMapSize, spotLight.shadowBias, spotLight.shadowRadius, vSpotLightCoord[ i ] ) : 1.0;
	}
	#pragma unroll_loop_end
	#endif
	#if NUM_POINT_LIGHT_SHADOWS > 0
	PointLightShadow pointLight;
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_POINT_LIGHT_SHADOWS; i ++ ) {
		pointLight = pointLightShadows[ i ];
		shadow *= receiveShadow ? getPointShadow( pointShadowMap[ i ], pointLight.shadowMapSize, pointLight.shadowBias, pointLight.shadowRadius, vPointShadowCoord[ i ], pointLight.shadowCameraNear, pointLight.shadowCameraFar ) : 1.0;
	}
	#pragma unroll_loop_end
	#endif
	#endif
	return shadow;
}`,VU=`#ifdef USE_SKINNING
	mat4 boneMatX = getBoneMatrix( skinIndex.x );
	mat4 boneMatY = getBoneMatrix( skinIndex.y );
	mat4 boneMatZ = getBoneMatrix( skinIndex.z );
	mat4 boneMatW = getBoneMatrix( skinIndex.w );
#endif`,GU=`#ifdef USE_SKINNING
	uniform mat4 bindMatrix;
	uniform mat4 bindMatrixInverse;
	uniform highp sampler2D boneTexture;
	uniform int boneTextureSize;
	mat4 getBoneMatrix( const in float i ) {
		float j = i * 4.0;
		float x = mod( j, float( boneTextureSize ) );
		float y = floor( j / float( boneTextureSize ) );
		float dx = 1.0 / float( boneTextureSize );
		float dy = 1.0 / float( boneTextureSize );
		y = dy * ( y + 0.5 );
		vec4 v1 = texture2D( boneTexture, vec2( dx * ( x + 0.5 ), y ) );
		vec4 v2 = texture2D( boneTexture, vec2( dx * ( x + 1.5 ), y ) );
		vec4 v3 = texture2D( boneTexture, vec2( dx * ( x + 2.5 ), y ) );
		vec4 v4 = texture2D( boneTexture, vec2( dx * ( x + 3.5 ), y ) );
		mat4 bone = mat4( v1, v2, v3, v4 );
		return bone;
	}
#endif`,qU=`#ifdef USE_SKINNING
	vec4 skinVertex = bindMatrix * vec4( transformed, 1.0 );
	vec4 skinned = vec4( 0.0 );
	skinned += boneMatX * skinVertex * skinWeight.x;
	skinned += boneMatY * skinVertex * skinWeight.y;
	skinned += boneMatZ * skinVertex * skinWeight.z;
	skinned += boneMatW * skinVertex * skinWeight.w;
	transformed = ( bindMatrixInverse * skinned ).xyz;
#endif`,WU=`#ifdef USE_SKINNING
	mat4 skinMatrix = mat4( 0.0 );
	skinMatrix += skinWeight.x * boneMatX;
	skinMatrix += skinWeight.y * boneMatY;
	skinMatrix += skinWeight.z * boneMatZ;
	skinMatrix += skinWeight.w * boneMatW;
	skinMatrix = bindMatrixInverse * skinMatrix * bindMatrix;
	objectNormal = vec4( skinMatrix * vec4( objectNormal, 0.0 ) ).xyz;
	#ifdef USE_TANGENT
		objectTangent = vec4( skinMatrix * vec4( objectTangent, 0.0 ) ).xyz;
	#endif
#endif`,$U=`float specularStrength;
#ifdef USE_SPECULARMAP
	vec4 texelSpecular = texture2D( specularMap, vSpecularMapUv );
	specularStrength = texelSpecular.r;
#else
	specularStrength = 1.0;
#endif`,XU=`#ifdef USE_SPECULARMAP
	uniform sampler2D specularMap;
#endif`,jU=`#if defined( TONE_MAPPING )
	gl_FragColor.rgb = toneMapping( gl_FragColor.rgb );
#endif`,YU=`#ifndef saturate
#define saturate( a ) clamp( a, 0.0, 1.0 )
#endif
uniform float toneMappingExposure;
vec3 LinearToneMapping( vec3 color ) {
	return saturate( toneMappingExposure * color );
}
vec3 ReinhardToneMapping( vec3 color ) {
	color *= toneMappingExposure;
	return saturate( color / ( vec3( 1.0 ) + color ) );
}
vec3 OptimizedCineonToneMapping( vec3 color ) {
	color *= toneMappingExposure;
	color = max( vec3( 0.0 ), color - 0.004 );
	return pow( ( color * ( 6.2 * color + 0.5 ) ) / ( color * ( 6.2 * color + 1.7 ) + 0.06 ), vec3( 2.2 ) );
}
vec3 RRTAndODTFit( vec3 v ) {
	vec3 a = v * ( v + 0.0245786 ) - 0.000090537;
	vec3 b = v * ( 0.983729 * v + 0.4329510 ) + 0.238081;
	return a / b;
}
vec3 ACESFilmicToneMapping( vec3 color ) {
	const mat3 ACESInputMat = mat3(
		vec3( 0.59719, 0.07600, 0.02840 ),		vec3( 0.35458, 0.90834, 0.13383 ),
		vec3( 0.04823, 0.01566, 0.83777 )
	);
	const mat3 ACESOutputMat = mat3(
		vec3(  1.60475, -0.10208, -0.00327 ),		vec3( -0.53108,  1.10813, -0.07276 ),
		vec3( -0.07367, -0.00605,  1.07602 )
	);
	color *= toneMappingExposure / 0.6;
	color = ACESInputMat * color;
	color = RRTAndODTFit( color );
	color = ACESOutputMat * color;
	return saturate( color );
}
vec3 CustomToneMapping( vec3 color ) { return color; }`,ZU=`#ifdef USE_TRANSMISSION
	material.transmission = transmission;
	material.transmissionAlpha = 1.0;
	material.thickness = thickness;
	material.attenuationDistance = attenuationDistance;
	material.attenuationColor = attenuationColor;
	#ifdef USE_TRANSMISSIONMAP
		material.transmission *= texture2D( transmissionMap, vTransmissionMapUv ).r;
	#endif
	#ifdef USE_THICKNESSMAP
		material.thickness *= texture2D( thicknessMap, vThicknessMapUv ).g;
	#endif
	vec3 pos = vWorldPosition;
	vec3 v = normalize( cameraPosition - pos );
	vec3 n = inverseTransformDirection( normal, viewMatrix );
	vec4 transmitted = getIBLVolumeRefraction(
		n, v, material.roughness, material.diffuseColor, material.specularColor, material.specularF90,
		pos, modelMatrix, viewMatrix, projectionMatrix, material.ior, material.thickness,
		material.attenuationColor, material.attenuationDistance );
	material.transmissionAlpha = mix( material.transmissionAlpha, transmitted.a, material.transmission );
	totalDiffuse = mix( totalDiffuse, transmitted.rgb, material.transmission );
#endif`,KU=`#ifdef USE_TRANSMISSION
	uniform float transmission;
	uniform float thickness;
	uniform float attenuationDistance;
	uniform vec3 attenuationColor;
	#ifdef USE_TRANSMISSIONMAP
		uniform sampler2D transmissionMap;
	#endif
	#ifdef USE_THICKNESSMAP
		uniform sampler2D thicknessMap;
	#endif
	uniform vec2 transmissionSamplerSize;
	uniform sampler2D transmissionSamplerMap;
	uniform mat4 modelMatrix;
	uniform mat4 projectionMatrix;
	varying vec3 vWorldPosition;
	float w0( float a ) {
		return ( 1.0 / 6.0 ) * ( a * ( a * ( - a + 3.0 ) - 3.0 ) + 1.0 );
	}
	float w1( float a ) {
		return ( 1.0 / 6.0 ) * ( a *  a * ( 3.0 * a - 6.0 ) + 4.0 );
	}
	float w2( float a ){
		return ( 1.0 / 6.0 ) * ( a * ( a * ( - 3.0 * a + 3.0 ) + 3.0 ) + 1.0 );
	}
	float w3( float a ) {
		return ( 1.0 / 6.0 ) * ( a * a * a );
	}
	float g0( float a ) {
		return w0( a ) + w1( a );
	}
	float g1( float a ) {
		return w2( a ) + w3( a );
	}
	float h0( float a ) {
		return - 1.0 + w1( a ) / ( w0( a ) + w1( a ) );
	}
	float h1( float a ) {
		return 1.0 + w3( a ) / ( w2( a ) + w3( a ) );
	}
	vec4 bicubic( sampler2D tex, vec2 uv, vec4 texelSize, float lod ) {
		uv = uv * texelSize.zw + 0.5;
		vec2 iuv = floor( uv );
		vec2 fuv = fract( uv );
		float g0x = g0( fuv.x );
		float g1x = g1( fuv.x );
		float h0x = h0( fuv.x );
		float h1x = h1( fuv.x );
		float h0y = h0( fuv.y );
		float h1y = h1( fuv.y );
		vec2 p0 = ( vec2( iuv.x + h0x, iuv.y + h0y ) - 0.5 ) * texelSize.xy;
		vec2 p1 = ( vec2( iuv.x + h1x, iuv.y + h0y ) - 0.5 ) * texelSize.xy;
		vec2 p2 = ( vec2( iuv.x + h0x, iuv.y + h1y ) - 0.5 ) * texelSize.xy;
		vec2 p3 = ( vec2( iuv.x + h1x, iuv.y + h1y ) - 0.5 ) * texelSize.xy;
		return g0( fuv.y ) * ( g0x * textureLod( tex, p0, lod ) + g1x * textureLod( tex, p1, lod ) ) +
			g1( fuv.y ) * ( g0x * textureLod( tex, p2, lod ) + g1x * textureLod( tex, p3, lod ) );
	}
	vec4 textureBicubic( sampler2D sampler, vec2 uv, float lod ) {
		vec2 fLodSize = vec2( textureSize( sampler, int( lod ) ) );
		vec2 cLodSize = vec2( textureSize( sampler, int( lod + 1.0 ) ) );
		vec2 fLodSizeInv = 1.0 / fLodSize;
		vec2 cLodSizeInv = 1.0 / cLodSize;
		vec4 fSample = bicubic( sampler, uv, vec4( fLodSizeInv, fLodSize ), floor( lod ) );
		vec4 cSample = bicubic( sampler, uv, vec4( cLodSizeInv, cLodSize ), ceil( lod ) );
		return mix( fSample, cSample, fract( lod ) );
	}
	vec3 getVolumeTransmissionRay( const in vec3 n, const in vec3 v, const in float thickness, const in float ior, const in mat4 modelMatrix ) {
		vec3 refractionVector = refract( - v, normalize( n ), 1.0 / ior );
		vec3 modelScale;
		modelScale.x = length( vec3( modelMatrix[ 0 ].xyz ) );
		modelScale.y = length( vec3( modelMatrix[ 1 ].xyz ) );
		modelScale.z = length( vec3( modelMatrix[ 2 ].xyz ) );
		return normalize( refractionVector ) * thickness * modelScale;
	}
	float applyIorToRoughness( const in float roughness, const in float ior ) {
		return roughness * clamp( ior * 2.0 - 2.0, 0.0, 1.0 );
	}
	vec4 getTransmissionSample( const in vec2 fragCoord, const in float roughness, const in float ior ) {
		float lod = log2( transmissionSamplerSize.x ) * applyIorToRoughness( roughness, ior );
		return textureBicubic( transmissionSamplerMap, fragCoord.xy, lod );
	}
	vec3 volumeAttenuation( const in float transmissionDistance, const in vec3 attenuationColor, const in float attenuationDistance ) {
		if ( isinf( attenuationDistance ) ) {
			return vec3( 1.0 );
		} else {
			vec3 attenuationCoefficient = -log( attenuationColor ) / attenuationDistance;
			vec3 transmittance = exp( - attenuationCoefficient * transmissionDistance );			return transmittance;
		}
	}
	vec4 getIBLVolumeRefraction( const in vec3 n, const in vec3 v, const in float roughness, const in vec3 diffuseColor,
		const in vec3 specularColor, const in float specularF90, const in vec3 position, const in mat4 modelMatrix,
		const in mat4 viewMatrix, const in mat4 projMatrix, const in float ior, const in float thickness,
		const in vec3 attenuationColor, const in float attenuationDistance ) {
		vec3 transmissionRay = getVolumeTransmissionRay( n, v, thickness, ior, modelMatrix );
		vec3 refractedRayExit = position + transmissionRay;
		vec4 ndcPos = projMatrix * viewMatrix * vec4( refractedRayExit, 1.0 );
		vec2 refractionCoords = ndcPos.xy / ndcPos.w;
		refractionCoords += 1.0;
		refractionCoords /= 2.0;
		vec4 transmittedLight = getTransmissionSample( refractionCoords, roughness, ior );
		vec3 transmittance = diffuseColor * volumeAttenuation( length( transmissionRay ), attenuationColor, attenuationDistance );
		vec3 attenuatedColor = transmittance * transmittedLight.rgb;
		vec3 F = EnvironmentBRDF( n, v, specularColor, specularF90, roughness );
		float transmittanceFactor = ( transmittance.r + transmittance.g + transmittance.b ) / 3.0;
		return vec4( ( 1.0 - F ) * attenuatedColor, 1.0 - ( 1.0 - transmittedLight.a ) * transmittanceFactor );
	}
#endif`,JU=`#if defined( USE_UV ) || defined( USE_ANISOTROPY )
	varying vec2 vUv;
#endif
#ifdef USE_MAP
	varying vec2 vMapUv;
#endif
#ifdef USE_ALPHAMAP
	varying vec2 vAlphaMapUv;
#endif
#ifdef USE_LIGHTMAP
	varying vec2 vLightMapUv;
#endif
#ifdef USE_AOMAP
	varying vec2 vAoMapUv;
#endif
#ifdef USE_BUMPMAP
	varying vec2 vBumpMapUv;
#endif
#ifdef USE_NORMALMAP
	varying vec2 vNormalMapUv;
#endif
#ifdef USE_EMISSIVEMAP
	varying vec2 vEmissiveMapUv;
#endif
#ifdef USE_METALNESSMAP
	varying vec2 vMetalnessMapUv;
#endif
#ifdef USE_ROUGHNESSMAP
	varying vec2 vRoughnessMapUv;
#endif
#ifdef USE_ANISOTROPYMAP
	varying vec2 vAnisotropyMapUv;
#endif
#ifdef USE_CLEARCOATMAP
	varying vec2 vClearcoatMapUv;
#endif
#ifdef USE_CLEARCOAT_NORMALMAP
	varying vec2 vClearcoatNormalMapUv;
#endif
#ifdef USE_CLEARCOAT_ROUGHNESSMAP
	varying vec2 vClearcoatRoughnessMapUv;
#endif
#ifdef USE_IRIDESCENCEMAP
	varying vec2 vIridescenceMapUv;
#endif
#ifdef USE_IRIDESCENCE_THICKNESSMAP
	varying vec2 vIridescenceThicknessMapUv;
#endif
#ifdef USE_SHEEN_COLORMAP
	varying vec2 vSheenColorMapUv;
#endif
#ifdef USE_SHEEN_ROUGHNESSMAP
	varying vec2 vSheenRoughnessMapUv;
#endif
#ifdef USE_SPECULARMAP
	varying vec2 vSpecularMapUv;
#endif
#ifdef USE_SPECULAR_COLORMAP
	varying vec2 vSpecularColorMapUv;
#endif
#ifdef USE_SPECULAR_INTENSITYMAP
	varying vec2 vSpecularIntensityMapUv;
#endif
#ifdef USE_TRANSMISSIONMAP
	uniform mat3 transmissionMapTransform;
	varying vec2 vTransmissionMapUv;
#endif
#ifdef USE_THICKNESSMAP
	uniform mat3 thicknessMapTransform;
	varying vec2 vThicknessMapUv;
#endif`,QU=`#if defined( USE_UV ) || defined( USE_ANISOTROPY )
	varying vec2 vUv;
#endif
#ifdef USE_MAP
	uniform mat3 mapTransform;
	varying vec2 vMapUv;
#endif
#ifdef USE_ALPHAMAP
	uniform mat3 alphaMapTransform;
	varying vec2 vAlphaMapUv;
#endif
#ifdef USE_LIGHTMAP
	uniform mat3 lightMapTransform;
	varying vec2 vLightMapUv;
#endif
#ifdef USE_AOMAP
	uniform mat3 aoMapTransform;
	varying vec2 vAoMapUv;
#endif
#ifdef USE_BUMPMAP
	uniform mat3 bumpMapTransform;
	varying vec2 vBumpMapUv;
#endif
#ifdef USE_NORMALMAP
	uniform mat3 normalMapTransform;
	varying vec2 vNormalMapUv;
#endif
#ifdef USE_DISPLACEMENTMAP
	uniform mat3 displacementMapTransform;
	varying vec2 vDisplacementMapUv;
#endif
#ifdef USE_EMISSIVEMAP
	uniform mat3 emissiveMapTransform;
	varying vec2 vEmissiveMapUv;
#endif
#ifdef USE_METALNESSMAP
	uniform mat3 metalnessMapTransform;
	varying vec2 vMetalnessMapUv;
#endif
#ifdef USE_ROUGHNESSMAP
	uniform mat3 roughnessMapTransform;
	varying vec2 vRoughnessMapUv;
#endif
#ifdef USE_ANISOTROPYMAP
	uniform mat3 anisotropyMapTransform;
	varying vec2 vAnisotropyMapUv;
#endif
#ifdef USE_CLEARCOATMAP
	uniform mat3 clearcoatMapTransform;
	varying vec2 vClearcoatMapUv;
#endif
#ifdef USE_CLEARCOAT_NORMALMAP
	uniform mat3 clearcoatNormalMapTransform;
	varying vec2 vClearcoatNormalMapUv;
#endif
#ifdef USE_CLEARCOAT_ROUGHNESSMAP
	uniform mat3 clearcoatRoughnessMapTransform;
	varying vec2 vClearcoatRoughnessMapUv;
#endif
#ifdef USE_SHEEN_COLORMAP
	uniform mat3 sheenColorMapTransform;
	varying vec2 vSheenColorMapUv;
#endif
#ifdef USE_SHEEN_ROUGHNESSMAP
	uniform mat3 sheenRoughnessMapTransform;
	varying vec2 vSheenRoughnessMapUv;
#endif
#ifdef USE_IRIDESCENCEMAP
	uniform mat3 iridescenceMapTransform;
	varying vec2 vIridescenceMapUv;
#endif
#ifdef USE_IRIDESCENCE_THICKNESSMAP
	uniform mat3 iridescenceThicknessMapTransform;
	varying vec2 vIridescenceThicknessMapUv;
#endif
#ifdef USE_SPECULARMAP
	uniform mat3 specularMapTransform;
	varying vec2 vSpecularMapUv;
#endif
#ifdef USE_SPECULAR_COLORMAP
	uniform mat3 specularColorMapTransform;
	varying vec2 vSpecularColorMapUv;
#endif
#ifdef USE_SPECULAR_INTENSITYMAP
	uniform mat3 specularIntensityMapTransform;
	varying vec2 vSpecularIntensityMapUv;
#endif
#ifdef USE_TRANSMISSIONMAP
	uniform mat3 transmissionMapTransform;
	varying vec2 vTransmissionMapUv;
#endif
#ifdef USE_THICKNESSMAP
	uniform mat3 thicknessMapTransform;
	varying vec2 vThicknessMapUv;
#endif`,tN=`#if defined( USE_UV ) || defined( USE_ANISOTROPY )
	vUv = vec3( uv, 1 ).xy;
#endif
#ifdef USE_MAP
	vMapUv = ( mapTransform * vec3( MAP_UV, 1 ) ).xy;
#endif
#ifdef USE_ALPHAMAP
	vAlphaMapUv = ( alphaMapTransform * vec3( ALPHAMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_LIGHTMAP
	vLightMapUv = ( lightMapTransform * vec3( LIGHTMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_AOMAP
	vAoMapUv = ( aoMapTransform * vec3( AOMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_BUMPMAP
	vBumpMapUv = ( bumpMapTransform * vec3( BUMPMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_NORMALMAP
	vNormalMapUv = ( normalMapTransform * vec3( NORMALMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_DISPLACEMENTMAP
	vDisplacementMapUv = ( displacementMapTransform * vec3( DISPLACEMENTMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_EMISSIVEMAP
	vEmissiveMapUv = ( emissiveMapTransform * vec3( EMISSIVEMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_METALNESSMAP
	vMetalnessMapUv = ( metalnessMapTransform * vec3( METALNESSMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_ROUGHNESSMAP
	vRoughnessMapUv = ( roughnessMapTransform * vec3( ROUGHNESSMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_ANISOTROPYMAP
	vAnisotropyMapUv = ( anisotropyMapTransform * vec3( ANISOTROPYMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_CLEARCOATMAP
	vClearcoatMapUv = ( clearcoatMapTransform * vec3( CLEARCOATMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_CLEARCOAT_NORMALMAP
	vClearcoatNormalMapUv = ( clearcoatNormalMapTransform * vec3( CLEARCOAT_NORMALMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_CLEARCOAT_ROUGHNESSMAP
	vClearcoatRoughnessMapUv = ( clearcoatRoughnessMapTransform * vec3( CLEARCOAT_ROUGHNESSMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_IRIDESCENCEMAP
	vIridescenceMapUv = ( iridescenceMapTransform * vec3( IRIDESCENCEMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_IRIDESCENCE_THICKNESSMAP
	vIridescenceThicknessMapUv = ( iridescenceThicknessMapTransform * vec3( IRIDESCENCE_THICKNESSMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_SHEEN_COLORMAP
	vSheenColorMapUv = ( sheenColorMapTransform * vec3( SHEEN_COLORMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_SHEEN_ROUGHNESSMAP
	vSheenRoughnessMapUv = ( sheenRoughnessMapTransform * vec3( SHEEN_ROUGHNESSMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_SPECULARMAP
	vSpecularMapUv = ( specularMapTransform * vec3( SPECULARMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_SPECULAR_COLORMAP
	vSpecularColorMapUv = ( specularColorMapTransform * vec3( SPECULAR_COLORMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_SPECULAR_INTENSITYMAP
	vSpecularIntensityMapUv = ( specularIntensityMapTransform * vec3( SPECULAR_INTENSITYMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_TRANSMISSIONMAP
	vTransmissionMapUv = ( transmissionMapTransform * vec3( TRANSMISSIONMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_THICKNESSMAP
	vThicknessMapUv = ( thicknessMapTransform * vec3( THICKNESSMAP_UV, 1 ) ).xy;
#endif`,eN=`#if defined( USE_ENVMAP ) || defined( DISTANCE ) || defined ( USE_SHADOWMAP ) || defined ( USE_TRANSMISSION ) || NUM_SPOT_LIGHT_COORDS > 0
	vec4 worldPosition = vec4( transformed, 1.0 );
	#ifdef USE_INSTANCING
		worldPosition = instanceMatrix * worldPosition;
	#endif
	worldPosition = modelMatrix * worldPosition;
#endif`;const nN=`varying vec2 vUv;
uniform mat3 uvTransform;
void main() {
	vUv = ( uvTransform * vec3( uv, 1 ) ).xy;
	gl_Position = vec4( position.xy, 1.0, 1.0 );
}`,iN=`uniform sampler2D t2D;
uniform float backgroundIntensity;
varying vec2 vUv;
void main() {
	vec4 texColor = texture2D( t2D, vUv );
	texColor.rgb *= backgroundIntensity;
	gl_FragColor = texColor;
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
}`,sN=`varying vec3 vWorldDirection;
#include <common>
void main() {
	vWorldDirection = transformDirection( position, modelMatrix );
	#include <begin_vertex>
	#include <project_vertex>
	gl_Position.z = gl_Position.w;
}`,rN=`#ifdef ENVMAP_TYPE_CUBE
	uniform samplerCube envMap;
#elif defined( ENVMAP_TYPE_CUBE_UV )
	uniform sampler2D envMap;
#endif
uniform float flipEnvMap;
uniform float backgroundBlurriness;
uniform float backgroundIntensity;
varying vec3 vWorldDirection;
#include <cube_uv_reflection_fragment>
void main() {
	#ifdef ENVMAP_TYPE_CUBE
		vec4 texColor = textureCube( envMap, vec3( flipEnvMap * vWorldDirection.x, vWorldDirection.yz ) );
	#elif defined( ENVMAP_TYPE_CUBE_UV )
		vec4 texColor = textureCubeUV( envMap, vWorldDirection, backgroundBlurriness );
	#else
		vec4 texColor = vec4( 0.0, 0.0, 0.0, 1.0 );
	#endif
	texColor.rgb *= backgroundIntensity;
	gl_FragColor = texColor;
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
}`,oN=`varying vec3 vWorldDirection;
#include <common>
void main() {
	vWorldDirection = transformDirection( position, modelMatrix );
	#include <begin_vertex>
	#include <project_vertex>
	gl_Position.z = gl_Position.w;
}`,aN=`uniform samplerCube tCube;
uniform float tFlip;
uniform float opacity;
varying vec3 vWorldDirection;
void main() {
	vec4 texColor = textureCube( tCube, vec3( tFlip * vWorldDirection.x, vWorldDirection.yz ) );
	gl_FragColor = texColor;
	gl_FragColor.a *= opacity;
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
}`,lN=`#include <common>
#include <uv_pars_vertex>
#include <displacementmap_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
varying vec2 vHighPrecisionZW;
void main() {
	#include <uv_vertex>
	#include <skinbase_vertex>
	#ifdef USE_DISPLACEMENTMAP
		#include <beginnormal_vertex>
		#include <morphnormal_vertex>
		#include <skinnormal_vertex>
	#endif
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	vHighPrecisionZW = gl_Position.zw;
}`,cN=`#if DEPTH_PACKING == 3200
	uniform float opacity;
#endif
#include <common>
#include <packing>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <alphahash_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
varying vec2 vHighPrecisionZW;
void main() {
	#include <clipping_planes_fragment>
	vec4 diffuseColor = vec4( 1.0 );
	#if DEPTH_PACKING == 3200
		diffuseColor.a = opacity;
	#endif
	#include <map_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <alphahash_fragment>
	#include <logdepthbuf_fragment>
	float fragCoordZ = 0.5 * vHighPrecisionZW[0] / vHighPrecisionZW[1] + 0.5;
	#if DEPTH_PACKING == 3200
		gl_FragColor = vec4( vec3( 1.0 - fragCoordZ ), opacity );
	#elif DEPTH_PACKING == 3201
		gl_FragColor = packDepthToRGBA( fragCoordZ );
	#endif
}`,uN=`#define DISTANCE
varying vec3 vWorldPosition;
#include <common>
#include <uv_pars_vertex>
#include <displacementmap_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <skinbase_vertex>
	#ifdef USE_DISPLACEMENTMAP
		#include <beginnormal_vertex>
		#include <morphnormal_vertex>
		#include <skinnormal_vertex>
	#endif
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <worldpos_vertex>
	#include <clipping_planes_vertex>
	vWorldPosition = worldPosition.xyz;
}`,hN=`#define DISTANCE
uniform vec3 referencePosition;
uniform float nearDistance;
uniform float farDistance;
varying vec3 vWorldPosition;
#include <common>
#include <packing>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <alphahash_pars_fragment>
#include <clipping_planes_pars_fragment>
void main () {
	#include <clipping_planes_fragment>
	vec4 diffuseColor = vec4( 1.0 );
	#include <map_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <alphahash_fragment>
	float dist = length( vWorldPosition - referencePosition );
	dist = ( dist - nearDistance ) / ( farDistance - nearDistance );
	dist = saturate( dist );
	gl_FragColor = packDepthToRGBA( dist );
}`,fN=`varying vec3 vWorldDirection;
#include <common>
void main() {
	vWorldDirection = transformDirection( position, modelMatrix );
	#include <begin_vertex>
	#include <project_vertex>
}`,dN=`uniform sampler2D tEquirect;
varying vec3 vWorldDirection;
#include <common>
void main() {
	vec3 direction = normalize( vWorldDirection );
	vec2 sampleUV = equirectUv( direction );
	gl_FragColor = texture2D( tEquirect, sampleUV );
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
}`,pN=`uniform float scale;
attribute float lineDistance;
varying float vLineDistance;
#include <common>
#include <uv_pars_vertex>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <morphtarget_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	vLineDistance = scale * lineDistance;
	#include <uv_vertex>
	#include <color_vertex>
	#include <morphcolor_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	#include <fog_vertex>
}`,mN=`uniform vec3 diffuse;
uniform float opacity;
uniform float dashSize;
uniform float totalSize;
varying float vLineDistance;
#include <common>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <fog_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	#include <clipping_planes_fragment>
	if ( mod( vLineDistance, totalSize ) > dashSize ) {
		discard;
	}
	vec3 outgoingLight = vec3( 0.0 );
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	outgoingLight = diffuseColor.rgb;
	#include <opaque_fragment>
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
}`,gN=`#include <common>
#include <uv_pars_vertex>
#include <envmap_pars_vertex>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <color_vertex>
	#include <morphcolor_vertex>
	#if defined ( USE_ENVMAP ) || defined ( USE_SKINNING )
		#include <beginnormal_vertex>
		#include <morphnormal_vertex>
		#include <skinbase_vertex>
		#include <skinnormal_vertex>
		#include <defaultnormal_vertex>
	#endif
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	#include <worldpos_vertex>
	#include <envmap_vertex>
	#include <fog_vertex>
}`,vN=`uniform vec3 diffuse;
uniform float opacity;
#ifndef FLAT_SHADED
	varying vec3 vNormal;
#endif
#include <common>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <alphahash_pars_fragment>
#include <aomap_pars_fragment>
#include <lightmap_pars_fragment>
#include <envmap_common_pars_fragment>
#include <envmap_pars_fragment>
#include <fog_pars_fragment>
#include <specularmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	#include <clipping_planes_fragment>
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <alphahash_fragment>
	#include <specularmap_fragment>
	ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );
	#ifdef USE_LIGHTMAP
		vec4 lightMapTexel = texture2D( lightMap, vLightMapUv );
		reflectedLight.indirectDiffuse += lightMapTexel.rgb * lightMapIntensity * RECIPROCAL_PI;
	#else
		reflectedLight.indirectDiffuse += vec3( 1.0 );
	#endif
	#include <aomap_fragment>
	reflectedLight.indirectDiffuse *= diffuseColor.rgb;
	vec3 outgoingLight = reflectedLight.indirectDiffuse;
	#include <envmap_fragment>
	#include <opaque_fragment>
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
	#include <dithering_fragment>
}`,_N=`#define LAMBERT
varying vec3 vViewPosition;
#include <common>
#include <uv_pars_vertex>
#include <displacementmap_pars_vertex>
#include <envmap_pars_vertex>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <normal_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <shadowmap_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <color_vertex>
	#include <morphcolor_vertex>
	#include <beginnormal_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <normal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	vViewPosition = - mvPosition.xyz;
	#include <worldpos_vertex>
	#include <envmap_vertex>
	#include <shadowmap_vertex>
	#include <fog_vertex>
}`,yN=`#define LAMBERT
uniform vec3 diffuse;
uniform vec3 emissive;
uniform float opacity;
#include <common>
#include <packing>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <alphahash_pars_fragment>
#include <aomap_pars_fragment>
#include <lightmap_pars_fragment>
#include <emissivemap_pars_fragment>
#include <envmap_common_pars_fragment>
#include <envmap_pars_fragment>
#include <fog_pars_fragment>
#include <bsdfs>
#include <lights_pars_begin>
#include <normal_pars_fragment>
#include <lights_lambert_pars_fragment>
#include <shadowmap_pars_fragment>
#include <bumpmap_pars_fragment>
#include <normalmap_pars_fragment>
#include <specularmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	#include <clipping_planes_fragment>
	vec4 diffuseColor = vec4( diffuse, opacity );
	ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );
	vec3 totalEmissiveRadiance = emissive;
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <alphahash_fragment>
	#include <specularmap_fragment>
	#include <normal_fragment_begin>
	#include <normal_fragment_maps>
	#include <emissivemap_fragment>
	#include <lights_lambert_fragment>
	#include <lights_fragment_begin>
	#include <lights_fragment_maps>
	#include <lights_fragment_end>
	#include <aomap_fragment>
	vec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + totalEmissiveRadiance;
	#include <envmap_fragment>
	#include <opaque_fragment>
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
	#include <dithering_fragment>
}`,xN=`#define MATCAP
varying vec3 vViewPosition;
#include <common>
#include <uv_pars_vertex>
#include <color_pars_vertex>
#include <displacementmap_pars_vertex>
#include <fog_pars_vertex>
#include <normal_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <color_vertex>
	#include <morphcolor_vertex>
	#include <beginnormal_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <normal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	#include <fog_vertex>
	vViewPosition = - mvPosition.xyz;
}`,bN=`#define MATCAP
uniform vec3 diffuse;
uniform float opacity;
uniform sampler2D matcap;
varying vec3 vViewPosition;
#include <common>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <alphahash_pars_fragment>
#include <fog_pars_fragment>
#include <normal_pars_fragment>
#include <bumpmap_pars_fragment>
#include <normalmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	#include <clipping_planes_fragment>
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <alphahash_fragment>
	#include <normal_fragment_begin>
	#include <normal_fragment_maps>
	vec3 viewDir = normalize( vViewPosition );
	vec3 x = normalize( vec3( viewDir.z, 0.0, - viewDir.x ) );
	vec3 y = cross( viewDir, x );
	vec2 uv = vec2( dot( x, normal ), dot( y, normal ) ) * 0.495 + 0.5;
	#ifdef USE_MATCAP
		vec4 matcapColor = texture2D( matcap, uv );
	#else
		vec4 matcapColor = vec4( vec3( mix( 0.2, 0.8, uv.y ) ), 1.0 );
	#endif
	vec3 outgoingLight = diffuseColor.rgb * matcapColor.rgb;
	#include <opaque_fragment>
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
	#include <dithering_fragment>
}`,wN=`#define NORMAL
#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( USE_NORMALMAP_TANGENTSPACE )
	varying vec3 vViewPosition;
#endif
#include <common>
#include <uv_pars_vertex>
#include <displacementmap_pars_vertex>
#include <normal_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <beginnormal_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <normal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( USE_NORMALMAP_TANGENTSPACE )
	vViewPosition = - mvPosition.xyz;
#endif
}`,MN=`#define NORMAL
uniform float opacity;
#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( USE_NORMALMAP_TANGENTSPACE )
	varying vec3 vViewPosition;
#endif
#include <packing>
#include <uv_pars_fragment>
#include <normal_pars_fragment>
#include <bumpmap_pars_fragment>
#include <normalmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	#include <clipping_planes_fragment>
	#include <logdepthbuf_fragment>
	#include <normal_fragment_begin>
	#include <normal_fragment_maps>
	gl_FragColor = vec4( packNormalToRGB( normal ), opacity );
	#ifdef OPAQUE
		gl_FragColor.a = 1.0;
	#endif
}`,SN=`#define PHONG
varying vec3 vViewPosition;
#include <common>
#include <uv_pars_vertex>
#include <displacementmap_pars_vertex>
#include <envmap_pars_vertex>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <normal_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <shadowmap_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <color_vertex>
	#include <morphcolor_vertex>
	#include <beginnormal_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <normal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	vViewPosition = - mvPosition.xyz;
	#include <worldpos_vertex>
	#include <envmap_vertex>
	#include <shadowmap_vertex>
	#include <fog_vertex>
}`,AN=`#define PHONG
uniform vec3 diffuse;
uniform vec3 emissive;
uniform vec3 specular;
uniform float shininess;
uniform float opacity;
#include <common>
#include <packing>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <alphahash_pars_fragment>
#include <aomap_pars_fragment>
#include <lightmap_pars_fragment>
#include <emissivemap_pars_fragment>
#include <envmap_common_pars_fragment>
#include <envmap_pars_fragment>
#include <fog_pars_fragment>
#include <bsdfs>
#include <lights_pars_begin>
#include <normal_pars_fragment>
#include <lights_phong_pars_fragment>
#include <shadowmap_pars_fragment>
#include <bumpmap_pars_fragment>
#include <normalmap_pars_fragment>
#include <specularmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	#include <clipping_planes_fragment>
	vec4 diffuseColor = vec4( diffuse, opacity );
	ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );
	vec3 totalEmissiveRadiance = emissive;
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <alphahash_fragment>
	#include <specularmap_fragment>
	#include <normal_fragment_begin>
	#include <normal_fragment_maps>
	#include <emissivemap_fragment>
	#include <lights_phong_fragment>
	#include <lights_fragment_begin>
	#include <lights_fragment_maps>
	#include <lights_fragment_end>
	#include <aomap_fragment>
	vec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + reflectedLight.directSpecular + reflectedLight.indirectSpecular + totalEmissiveRadiance;
	#include <envmap_fragment>
	#include <opaque_fragment>
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
	#include <dithering_fragment>
}`,EN=`#define STANDARD
varying vec3 vViewPosition;
#ifdef USE_TRANSMISSION
	varying vec3 vWorldPosition;
#endif
#include <common>
#include <uv_pars_vertex>
#include <displacementmap_pars_vertex>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <normal_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <shadowmap_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <color_vertex>
	#include <morphcolor_vertex>
	#include <beginnormal_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <normal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	vViewPosition = - mvPosition.xyz;
	#include <worldpos_vertex>
	#include <shadowmap_vertex>
	#include <fog_vertex>
#ifdef USE_TRANSMISSION
	vWorldPosition = worldPosition.xyz;
#endif
}`,TN=`#define STANDARD
#ifdef PHYSICAL
	#define IOR
	#define USE_SPECULAR
#endif
uniform vec3 diffuse;
uniform vec3 emissive;
uniform float roughness;
uniform float metalness;
uniform float opacity;
#ifdef IOR
	uniform float ior;
#endif
#ifdef USE_SPECULAR
	uniform float specularIntensity;
	uniform vec3 specularColor;
	#ifdef USE_SPECULAR_COLORMAP
		uniform sampler2D specularColorMap;
	#endif
	#ifdef USE_SPECULAR_INTENSITYMAP
		uniform sampler2D specularIntensityMap;
	#endif
#endif
#ifdef USE_CLEARCOAT
	uniform float clearcoat;
	uniform float clearcoatRoughness;
#endif
#ifdef USE_IRIDESCENCE
	uniform float iridescence;
	uniform float iridescenceIOR;
	uniform float iridescenceThicknessMinimum;
	uniform float iridescenceThicknessMaximum;
#endif
#ifdef USE_SHEEN
	uniform vec3 sheenColor;
	uniform float sheenRoughness;
	#ifdef USE_SHEEN_COLORMAP
		uniform sampler2D sheenColorMap;
	#endif
	#ifdef USE_SHEEN_ROUGHNESSMAP
		uniform sampler2D sheenRoughnessMap;
	#endif
#endif
#ifdef USE_ANISOTROPY
	uniform vec2 anisotropyVector;
	#ifdef USE_ANISOTROPYMAP
		uniform sampler2D anisotropyMap;
	#endif
#endif
varying vec3 vViewPosition;
#include <common>
#include <packing>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <alphahash_pars_fragment>
#include <aomap_pars_fragment>
#include <lightmap_pars_fragment>
#include <emissivemap_pars_fragment>
#include <iridescence_fragment>
#include <cube_uv_reflection_fragment>
#include <envmap_common_pars_fragment>
#include <envmap_physical_pars_fragment>
#include <fog_pars_fragment>
#include <lights_pars_begin>
#include <normal_pars_fragment>
#include <lights_physical_pars_fragment>
#include <transmission_pars_fragment>
#include <shadowmap_pars_fragment>
#include <bumpmap_pars_fragment>
#include <normalmap_pars_fragment>
#include <clearcoat_pars_fragment>
#include <iridescence_pars_fragment>
#include <roughnessmap_pars_fragment>
#include <metalnessmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	#include <clipping_planes_fragment>
	vec4 diffuseColor = vec4( diffuse, opacity );
	ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );
	vec3 totalEmissiveRadiance = emissive;
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <alphahash_fragment>
	#include <roughnessmap_fragment>
	#include <metalnessmap_fragment>
	#include <normal_fragment_begin>
	#include <normal_fragment_maps>
	#include <clearcoat_normal_fragment_begin>
	#include <clearcoat_normal_fragment_maps>
	#include <emissivemap_fragment>
	#include <lights_physical_fragment>
	#include <lights_fragment_begin>
	#include <lights_fragment_maps>
	#include <lights_fragment_end>
	#include <aomap_fragment>
	vec3 totalDiffuse = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse;
	vec3 totalSpecular = reflectedLight.directSpecular + reflectedLight.indirectSpecular;
	#include <transmission_fragment>
	vec3 outgoingLight = totalDiffuse + totalSpecular + totalEmissiveRadiance;
	#ifdef USE_SHEEN
		float sheenEnergyComp = 1.0 - 0.157 * max3( material.sheenColor );
		outgoingLight = outgoingLight * sheenEnergyComp + sheenSpecular;
	#endif
	#ifdef USE_CLEARCOAT
		float dotNVcc = saturate( dot( geometry.clearcoatNormal, geometry.viewDir ) );
		vec3 Fcc = F_Schlick( material.clearcoatF0, material.clearcoatF90, dotNVcc );
		outgoingLight = outgoingLight * ( 1.0 - material.clearcoat * Fcc ) + clearcoatSpecular * material.clearcoat;
	#endif
	#include <opaque_fragment>
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
	#include <dithering_fragment>
}`,CN=`#define TOON
varying vec3 vViewPosition;
#include <common>
#include <uv_pars_vertex>
#include <displacementmap_pars_vertex>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <normal_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <shadowmap_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <color_vertex>
	#include <morphcolor_vertex>
	#include <beginnormal_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <normal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	vViewPosition = - mvPosition.xyz;
	#include <worldpos_vertex>
	#include <shadowmap_vertex>
	#include <fog_vertex>
}`,PN=`#define TOON
uniform vec3 diffuse;
uniform vec3 emissive;
uniform float opacity;
#include <common>
#include <packing>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <alphahash_pars_fragment>
#include <aomap_pars_fragment>
#include <lightmap_pars_fragment>
#include <emissivemap_pars_fragment>
#include <gradientmap_pars_fragment>
#include <fog_pars_fragment>
#include <bsdfs>
#include <lights_pars_begin>
#include <normal_pars_fragment>
#include <lights_toon_pars_fragment>
#include <shadowmap_pars_fragment>
#include <bumpmap_pars_fragment>
#include <normalmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	#include <clipping_planes_fragment>
	vec4 diffuseColor = vec4( diffuse, opacity );
	ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );
	vec3 totalEmissiveRadiance = emissive;
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <alphahash_fragment>
	#include <normal_fragment_begin>
	#include <normal_fragment_maps>
	#include <emissivemap_fragment>
	#include <lights_toon_fragment>
	#include <lights_fragment_begin>
	#include <lights_fragment_maps>
	#include <lights_fragment_end>
	#include <aomap_fragment>
	vec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + totalEmissiveRadiance;
	#include <opaque_fragment>
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
	#include <dithering_fragment>
}`,RN=`uniform float size;
uniform float scale;
#include <common>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <morphtarget_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
#ifdef USE_POINTS_UV
	varying vec2 vUv;
	uniform mat3 uvTransform;
#endif
void main() {
	#ifdef USE_POINTS_UV
		vUv = ( uvTransform * vec3( uv, 1 ) ).xy;
	#endif
	#include <color_vertex>
	#include <morphcolor_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <project_vertex>
	gl_PointSize = size;
	#ifdef USE_SIZEATTENUATION
		bool isPerspective = isPerspectiveMatrix( projectionMatrix );
		if ( isPerspective ) gl_PointSize *= ( scale / - mvPosition.z );
	#endif
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	#include <worldpos_vertex>
	#include <fog_vertex>
}`,LN=`uniform vec3 diffuse;
uniform float opacity;
#include <common>
#include <color_pars_fragment>
#include <map_particle_pars_fragment>
#include <alphatest_pars_fragment>
#include <alphahash_pars_fragment>
#include <fog_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	#include <clipping_planes_fragment>
	vec3 outgoingLight = vec3( 0.0 );
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <logdepthbuf_fragment>
	#include <map_particle_fragment>
	#include <color_fragment>
	#include <alphatest_fragment>
	#include <alphahash_fragment>
	outgoingLight = diffuseColor.rgb;
	#include <opaque_fragment>
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
}`,DN=`#include <common>
#include <fog_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <shadowmap_pars_vertex>
void main() {
	#include <beginnormal_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <worldpos_vertex>
	#include <shadowmap_vertex>
	#include <fog_vertex>
}`,IN=`uniform vec3 color;
uniform float opacity;
#include <common>
#include <packing>
#include <fog_pars_fragment>
#include <bsdfs>
#include <lights_pars_begin>
#include <logdepthbuf_pars_fragment>
#include <shadowmap_pars_fragment>
#include <shadowmask_pars_fragment>
void main() {
	#include <logdepthbuf_fragment>
	gl_FragColor = vec4( color, opacity * ( 1.0 - getShadowMask() ) );
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
	#include <fog_fragment>
}`,ON=`uniform float rotation;
uniform vec2 center;
#include <common>
#include <uv_pars_vertex>
#include <fog_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	vec4 mvPosition = modelViewMatrix * vec4( 0.0, 0.0, 0.0, 1.0 );
	vec2 scale;
	scale.x = length( vec3( modelMatrix[ 0 ].x, modelMatrix[ 0 ].y, modelMatrix[ 0 ].z ) );
	scale.y = length( vec3( modelMatrix[ 1 ].x, modelMatrix[ 1 ].y, modelMatrix[ 1 ].z ) );
	#ifndef USE_SIZEATTENUATION
		bool isPerspective = isPerspectiveMatrix( projectionMatrix );
		if ( isPerspective ) scale *= - mvPosition.z;
	#endif
	vec2 alignedPosition = ( position.xy - ( center - vec2( 0.5 ) ) ) * scale;
	vec2 rotatedPosition;
	rotatedPosition.x = cos( rotation ) * alignedPosition.x - sin( rotation ) * alignedPosition.y;
	rotatedPosition.y = sin( rotation ) * alignedPosition.x + cos( rotation ) * alignedPosition.y;
	mvPosition.xy += rotatedPosition;
	gl_Position = projectionMatrix * mvPosition;
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	#include <fog_vertex>
}`,zN=`uniform vec3 diffuse;
uniform float opacity;
#include <common>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <alphahash_pars_fragment>
#include <fog_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	#include <clipping_planes_fragment>
	vec3 outgoingLight = vec3( 0.0 );
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <alphahash_fragment>
	outgoingLight = diffuseColor.rgb;
	#include <opaque_fragment>
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
	#include <fog_fragment>
}`,be={alphahash_fragment:r3,alphahash_pars_fragment:o3,alphamap_fragment:a3,alphamap_pars_fragment:l3,alphatest_fragment:c3,alphatest_pars_fragment:u3,aomap_fragment:h3,aomap_pars_fragment:f3,begin_vertex:d3,beginnormal_vertex:p3,bsdfs:m3,iridescence_fragment:g3,bumpmap_pars_fragment:v3,clipping_planes_fragment:_3,clipping_planes_pars_fragment:y3,clipping_planes_pars_vertex:x3,clipping_planes_vertex:b3,color_fragment:w3,color_pars_fragment:M3,color_pars_vertex:S3,color_vertex:A3,common:E3,cube_uv_reflection_fragment:T3,defaultnormal_vertex:C3,displacementmap_pars_vertex:P3,displacementmap_vertex:R3,emissivemap_fragment:L3,emissivemap_pars_fragment:D3,colorspace_fragment:I3,colorspace_pars_fragment:O3,envmap_fragment:z3,envmap_common_pars_fragment:k3,envmap_pars_fragment:U3,envmap_pars_vertex:N3,envmap_physical_pars_fragment:Z3,envmap_vertex:F3,fog_vertex:B3,fog_pars_vertex:H3,fog_fragment:V3,fog_pars_fragment:G3,gradientmap_pars_fragment:q3,lightmap_fragment:W3,lightmap_pars_fragment:$3,lights_lambert_fragment:X3,lights_lambert_pars_fragment:j3,lights_pars_begin:Y3,lights_toon_fragment:K3,lights_toon_pars_fragment:J3,lights_phong_fragment:Q3,lights_phong_pars_fragment:tU,lights_physical_fragment:eU,lights_physical_pars_fragment:nU,lights_fragment_begin:iU,lights_fragment_maps:sU,lights_fragment_end:rU,logdepthbuf_fragment:oU,logdepthbuf_pars_fragment:aU,logdepthbuf_pars_vertex:lU,logdepthbuf_vertex:cU,map_fragment:uU,map_pars_fragment:hU,map_particle_fragment:fU,map_particle_pars_fragment:dU,metalnessmap_fragment:pU,metalnessmap_pars_fragment:mU,morphcolor_vertex:gU,morphnormal_vertex:vU,morphtarget_pars_vertex:_U,morphtarget_vertex:yU,normal_fragment_begin:xU,normal_fragment_maps:bU,normal_pars_fragment:wU,normal_pars_vertex:MU,normal_vertex:SU,normalmap_pars_fragment:AU,clearcoat_normal_fragment_begin:EU,clearcoat_normal_fragment_maps:TU,clearcoat_pars_fragment:CU,iridescence_pars_fragment:PU,opaque_fragment:RU,packing:LU,premultiplied_alpha_fragment:DU,project_vertex:IU,dithering_fragment:OU,dithering_pars_fragment:zU,roughnessmap_fragment:kU,roughnessmap_pars_fragment:UU,shadowmap_pars_fragment:NU,shadowmap_pars_vertex:FU,shadowmap_vertex:BU,shadowmask_pars_fragment:HU,skinbase_vertex:VU,skinning_pars_vertex:GU,skinning_vertex:qU,skinnormal_vertex:WU,specularmap_fragment:$U,specularmap_pars_fragment:XU,tonemapping_fragment:jU,tonemapping_pars_fragment:YU,transmission_fragment:ZU,transmission_pars_fragment:KU,uv_pars_fragment:JU,uv_pars_vertex:QU,uv_vertex:tN,worldpos_vertex:eN,background_vert:nN,background_frag:iN,backgroundCube_vert:sN,backgroundCube_frag:rN,cube_vert:oN,cube_frag:aN,depth_vert:lN,depth_frag:cN,distanceRGBA_vert:uN,distanceRGBA_frag:hN,equirect_vert:fN,equirect_frag:dN,linedashed_vert:pN,linedashed_frag:mN,meshbasic_vert:gN,meshbasic_frag:vN,meshlambert_vert:_N,meshlambert_frag:yN,meshmatcap_vert:xN,meshmatcap_frag:bN,meshnormal_vert:wN,meshnormal_frag:MN,meshphong_vert:SN,meshphong_frag:AN,meshphysical_vert:EN,meshphysical_frag:TN,meshtoon_vert:CN,meshtoon_frag:PN,points_vert:RN,points_frag:LN,shadow_vert:DN,shadow_frag:IN,sprite_vert:ON,sprite_frag:zN},Ft={common:{diffuse:{value:new Vt(16777215)},opacity:{value:1},map:{value:null},mapTransform:{value:new Te},alphaMap:{value:null},alphaMapTransform:{value:new Te},alphaTest:{value:0}},specularmap:{specularMap:{value:null},specularMapTransform:{value:new Te}},envmap:{envMap:{value:null},flipEnvMap:{value:-1},reflectivity:{value:1},ior:{value:1.5},refractionRatio:{value:.98}},aomap:{aoMap:{value:null},aoMapIntensity:{value:1},aoMapTransform:{value:new Te}},lightmap:{lightMap:{value:null},lightMapIntensity:{value:1},lightMapTransform:{value:new Te}},bumpmap:{bumpMap:{value:null},bumpMapTransform:{value:new Te},bumpScale:{value:1}},normalmap:{normalMap:{value:null},normalMapTransform:{value:new Te},normalScale:{value:new pt(1,1)}},displacementmap:{displacementMap:{value:null},displacementMapTransform:{value:new Te},displacementScale:{value:1},displacementBias:{value:0}},emissivemap:{emissiveMap:{value:null},emissiveMapTransform:{value:new Te}},metalnessmap:{metalnessMap:{value:null},metalnessMapTransform:{value:new Te}},roughnessmap:{roughnessMap:{value:null},roughnessMapTransform:{value:new Te}},gradientmap:{gradientMap:{value:null}},fog:{fogDensity:{value:25e-5},fogNear:{value:1},fogFar:{value:2e3},fogColor:{value:new Vt(16777215)}},lights:{ambientLightColor:{value:[]},lightProbe:{value:[]},directionalLights:{value:[],properties:{direction:{},color:{}}},directionalLightShadows:{value:[],properties:{shadowBias:{},shadowNormalBias:{},shadowRadius:{},shadowMapSize:{}}},directionalShadowMap:{value:[]},directionalShadowMatrix:{value:[]},spotLights:{value:[],properties:{color:{},position:{},direction:{},distance:{},coneCos:{},penumbraCos:{},decay:{}}},spotLightShadows:{value:[],properties:{shadowBias:{},shadowNormalBias:{},shadowRadius:{},shadowMapSize:{}}},spotLightMap:{value:[]},spotShadowMap:{value:[]},spotLightMatrix:{value:[]},pointLights:{value:[],properties:{color:{},position:{},decay:{},distance:{}}},pointLightShadows:{value:[],properties:{shadowBias:{},shadowNormalBias:{},shadowRadius:{},shadowMapSize:{},shadowCameraNear:{},shadowCameraFar:{}}},pointShadowMap:{value:[]},pointShadowMatrix:{value:[]},hemisphereLights:{value:[],properties:{direction:{},skyColor:{},groundColor:{}}},rectAreaLights:{value:[],properties:{color:{},position:{},width:{},height:{}}},ltc_1:{value:null},ltc_2:{value:null}},points:{diffuse:{value:new Vt(16777215)},opacity:{value:1},size:{value:1},scale:{value:1},map:{value:null},alphaMap:{value:null},alphaMapTransform:{value:new Te},alphaTest:{value:0},uvTransform:{value:new Te}},sprite:{diffuse:{value:new Vt(16777215)},opacity:{value:1},center:{value:new pt(.5,.5)},rotation:{value:0},map:{value:null},mapTransform:{value:new Te},alphaMap:{value:null},alphaMapTransform:{value:new Te},alphaTest:{value:0}}},ws={basic:{uniforms:si([Ft.common,Ft.specularmap,Ft.envmap,Ft.aomap,Ft.lightmap,Ft.fog]),vertexShader:be.meshbasic_vert,fragmentShader:be.meshbasic_frag},lambert:{uniforms:si([Ft.common,Ft.specularmap,Ft.envmap,Ft.aomap,Ft.lightmap,Ft.emissivemap,Ft.bumpmap,Ft.normalmap,Ft.displacementmap,Ft.fog,Ft.lights,{emissive:{value:new Vt(0)}}]),vertexShader:be.meshlambert_vert,fragmentShader:be.meshlambert_frag},phong:{uniforms:si([Ft.common,Ft.specularmap,Ft.envmap,Ft.aomap,Ft.lightmap,Ft.emissivemap,Ft.bumpmap,Ft.normalmap,Ft.displacementmap,Ft.fog,Ft.lights,{emissive:{value:new Vt(0)},specular:{value:new Vt(1118481)},shininess:{value:30}}]),vertexShader:be.meshphong_vert,fragmentShader:be.meshphong_frag},standard:{uniforms:si([Ft.common,Ft.envmap,Ft.aomap,Ft.lightmap,Ft.emissivemap,Ft.bumpmap,Ft.normalmap,Ft.displacementmap,Ft.roughnessmap,Ft.metalnessmap,Ft.fog,Ft.lights,{emissive:{value:new Vt(0)},roughness:{value:1},metalness:{value:0},envMapIntensity:{value:1}}]),vertexShader:be.meshphysical_vert,fragmentShader:be.meshphysical_frag},toon:{uniforms:si([Ft.common,Ft.aomap,Ft.lightmap,Ft.emissivemap,Ft.bumpmap,Ft.normalmap,Ft.displacementmap,Ft.gradientmap,Ft.fog,Ft.lights,{emissive:{value:new Vt(0)}}]),vertexShader:be.meshtoon_vert,fragmentShader:be.meshtoon_frag},matcap:{uniforms:si([Ft.common,Ft.bumpmap,Ft.normalmap,Ft.displacementmap,Ft.fog,{matcap:{value:null}}]),vertexShader:be.meshmatcap_vert,fragmentShader:be.meshmatcap_frag},points:{uniforms:si([Ft.points,Ft.fog]),vertexShader:be.points_vert,fragmentShader:be.points_frag},dashed:{uniforms:si([Ft.common,Ft.fog,{scale:{value:1},dashSize:{value:1},totalSize:{value:2}}]),vertexShader:be.linedashed_vert,fragmentShader:be.linedashed_frag},depth:{uniforms:si([Ft.common,Ft.displacementmap]),vertexShader:be.depth_vert,fragmentShader:be.depth_frag},normal:{uniforms:si([Ft.common,Ft.bumpmap,Ft.normalmap,Ft.displacementmap,{opacity:{value:1}}]),vertexShader:be.meshnormal_vert,fragmentShader:be.meshnormal_frag},sprite:{uniforms:si([Ft.sprite,Ft.fog]),vertexShader:be.sprite_vert,fragmentShader:be.sprite_frag},background:{uniforms:{uvTransform:{value:new Te},t2D:{value:null},backgroundIntensity:{value:1}},vertexShader:be.background_vert,fragmentShader:be.background_frag},backgroundCube:{uniforms:{envMap:{value:null},flipEnvMap:{value:-1},backgroundBlurriness:{value:0},backgroundIntensity:{value:1}},vertexShader:be.backgroundCube_vert,fragmentShader:be.backgroundCube_frag},cube:{uniforms:{tCube:{value:null},tFlip:{value:-1},opacity:{value:1}},vertexShader:be.cube_vert,fragmentShader:be.cube_frag},equirect:{uniforms:{tEquirect:{value:null}},vertexShader:be.equirect_vert,fragmentShader:be.equirect_frag},distanceRGBA:{uniforms:si([Ft.common,Ft.displacementmap,{referencePosition:{value:new N},nearDistance:{value:1},farDistance:{value:1e3}}]),vertexShader:be.distanceRGBA_vert,fragmentShader:be.distanceRGBA_frag},shadow:{uniforms:si([Ft.lights,Ft.fog,{color:{value:new Vt(0)},opacity:{value:1}}]),vertexShader:be.shadow_vert,fragmentShader:be.shadow_frag}};ws.physical={uniforms:si([ws.standard.uniforms,{clearcoat:{value:0},clearcoatMap:{value:null},clearcoatMapTransform:{value:new Te},clearcoatNormalMap:{value:null},clearcoatNormalMapTransform:{value:new Te},clearcoatNormalScale:{value:new pt(1,1)},clearcoatRoughness:{value:0},clearcoatRoughnessMap:{value:null},clearcoatRoughnessMapTransform:{value:new Te},iridescence:{value:0},iridescenceMap:{value:null},iridescenceMapTransform:{value:new Te},iridescenceIOR:{value:1.3},iridescenceThicknessMinimum:{value:100},iridescenceThicknessMaximum:{value:400},iridescenceThicknessMap:{value:null},iridescenceThicknessMapTransform:{value:new Te},sheen:{value:0},sheenColor:{value:new Vt(0)},sheenColorMap:{value:null},sheenColorMapTransform:{value:new Te},sheenRoughness:{value:1},sheenRoughnessMap:{value:null},sheenRoughnessMapTransform:{value:new Te},transmission:{value:0},transmissionMap:{value:null},transmissionMapTransform:{value:new Te},transmissionSamplerSize:{value:new pt},transmissionSamplerMap:{value:null},thickness:{value:0},thicknessMap:{value:null},thicknessMapTransform:{value:new Te},attenuationDistance:{value:0},attenuationColor:{value:new Vt(0)},specularColor:{value:new Vt(1,1,1)},specularColorMap:{value:null},specularColorMapTransform:{value:new Te},specularIntensity:{value:1},specularIntensityMap:{value:null},specularIntensityMapTransform:{value:new Te},anisotropyVector:{value:new pt},anisotropyMap:{value:null},anisotropyMapTransform:{value:new Te}}]),vertexShader:be.meshphysical_vert,fragmentShader:be.meshphysical_frag};const Vh={r:0,b:0,g:0};function kN(s,t,e,n,i,r,o){const a=new Vt(0);let l=r===!0?0:1,c,h,f=null,d=0,m=null;function g(_,v){let w=!1,b=v.isScene===!0?v.background:null;switch(b&&b.isTexture&&(b=(v.backgroundBlurriness>0?e:t).get(b)),b===null?y(a,l):b&&b.isColor&&(y(b,1),w=!0),s.xr.getEnvironmentBlendMode()){case"opaque":w=!0;break;case"additive":n.buffers.color.setClear(0,0,0,1,o),w=!0;break;case"alpha-blend":n.buffers.color.setClear(0,0,0,0,o),w=!0;break}(s.autoClear||w)&&s.clear(s.autoClearColor,s.autoClearDepth,s.autoClearStencil),b&&(b.isCubeTexture||b.mapping===Rl)?(h===void 0&&(h=new Xe(new ua(1,1,1),new qs({name:"BackgroundCubeMaterial",uniforms:bl(ws.backgroundCube.uniforms),vertexShader:ws.backgroundCube.vertexShader,fragmentShader:ws.backgroundCube.fragmentShader,side:oi,depthTest:!1,depthWrite:!1,fog:!1})),h.geometry.deleteAttribute("normal"),h.geometry.deleteAttribute("uv"),h.onBeforeRender=function(T,P,C){this.matrixWorld.copyPosition(C.matrixWorld)},Object.defineProperty(h.material,"envMap",{get:function(){return this.uniforms.envMap.value}}),i.update(h)),h.material.uniforms.envMap.value=b,h.material.uniforms.flipEnvMap.value=b.isCubeTexture&&b.isRenderTargetTexture===!1?-1:1,h.material.uniforms.backgroundBlurriness.value=v.backgroundBlurriness,h.material.uniforms.backgroundIntensity.value=v.backgroundIntensity,h.material.toneMapped=b.colorSpace!==ve,(f!==b||d!==b.version||m!==s.toneMapping)&&(h.material.needsUpdate=!0,f=b,d=b.version,m=s.toneMapping),h.layers.enableAll(),_.unshift(h,h.geometry,h.material,0,0,null)):b&&b.isTexture&&(c===void 0&&(c=new Xe(new Il(2,2),new qs({name:"BackgroundMaterial",uniforms:bl(ws.background.uniforms),vertexShader:ws.background.vertexShader,fragmentShader:ws.background.fragmentShader,side:Mr,depthTest:!1,depthWrite:!1,fog:!1})),c.geometry.deleteAttribute("normal"),Object.defineProperty(c.material,"map",{get:function(){return this.uniforms.t2D.value}}),i.update(c)),c.material.uniforms.t2D.value=b,c.material.uniforms.backgroundIntensity.value=v.backgroundIntensity,c.material.toneMapped=b.colorSpace!==ve,b.matrixAutoUpdate===!0&&b.updateMatrix(),c.material.uniforms.uvTransform.value.copy(b.matrix),(f!==b||d!==b.version||m!==s.toneMapping)&&(c.material.needsUpdate=!0,f=b,d=b.version,m=s.toneMapping),c.layers.enableAll(),_.unshift(c,c.geometry,c.material,0,0,null))}function y(_,v){_.getRGB(Vh,MS(s)),n.buffers.color.setClear(Vh.r,Vh.g,Vh.b,v,o)}return{getClearColor:function(){return a},setClearColor:function(_,v=1){a.set(_),l=v,y(a,l)},getClearAlpha:function(){return l},setClearAlpha:function(_){l=_,y(a,l)},render:g}}function UN(s,t,e,n){const i=s.getParameter(s.MAX_VERTEX_ATTRIBS),r=n.isWebGL2?null:t.get("OES_vertex_array_object"),o=n.isWebGL2||r!==null,a={},l=_(null);let c=l,h=!1;function f(G,I,et,Y,J){let ut=!1;if(o){const dt=y(Y,et,I);c!==dt&&(c=dt,m(c.object)),ut=v(G,Y,et,J),ut&&w(G,Y,et,J)}else{const dt=I.wireframe===!0;(c.geometry!==Y.id||c.program!==et.id||c.wireframe!==dt)&&(c.geometry=Y.id,c.program=et.id,c.wireframe=dt,ut=!0)}J!==null&&e.update(J,s.ELEMENT_ARRAY_BUFFER),(ut||h)&&(h=!1,C(G,I,et,Y),J!==null&&s.bindBuffer(s.ELEMENT_ARRAY_BUFFER,e.get(J).buffer))}function d(){return n.isWebGL2?s.createVertexArray():r.createVertexArrayOES()}function m(G){return n.isWebGL2?s.bindVertexArray(G):r.bindVertexArrayOES(G)}function g(G){return n.isWebGL2?s.deleteVertexArray(G):r.deleteVertexArrayOES(G)}function y(G,I,et){const Y=et.wireframe===!0;let J=a[G.id];J===void 0&&(J={},a[G.id]=J);let ut=J[I.id];ut===void 0&&(ut={},J[I.id]=ut);let dt=ut[Y];return dt===void 0&&(dt=_(d()),ut[Y]=dt),dt}function _(G){const I=[],et=[],Y=[];for(let J=0;J<i;J++)I[J]=0,et[J]=0,Y[J]=0;return{geometry:null,program:null,wireframe:!1,newAttributes:I,enabledAttributes:et,attributeDivisors:Y,object:G,attributes:{},index:null}}function v(G,I,et,Y){const J=c.attributes,ut=I.attributes;let dt=0;const nt=et.getAttributes();for(const ft in nt)if(nt[ft].location>=0){const Ot=J[ft];let It=ut[ft];if(It===void 0&&(ft==="instanceMatrix"&&G.instanceMatrix&&(It=G.instanceMatrix),ft==="instanceColor"&&G.instanceColor&&(It=G.instanceColor)),Ot===void 0||Ot.attribute!==It||It&&Ot.data!==It.data)return!0;dt++}return c.attributesNum!==dt||c.index!==Y}function w(G,I,et,Y){const J={},ut=I.attributes;let dt=0;const nt=et.getAttributes();for(const ft in nt)if(nt[ft].location>=0){let Ot=ut[ft];Ot===void 0&&(ft==="instanceMatrix"&&G.instanceMatrix&&(Ot=G.instanceMatrix),ft==="instanceColor"&&G.instanceColor&&(Ot=G.instanceColor));const It={};It.attribute=Ot,Ot&&Ot.data&&(It.data=Ot.data),J[ft]=It,dt++}c.attributes=J,c.attributesNum=dt,c.index=Y}function b(){const G=c.newAttributes;for(let I=0,et=G.length;I<et;I++)G[I]=0}function M(G){A(G,0)}function A(G,I){const et=c.newAttributes,Y=c.enabledAttributes,J=c.attributeDivisors;et[G]=1,Y[G]===0&&(s.enableVertexAttribArray(G),Y[G]=1),J[G]!==I&&((n.isWebGL2?s:t.get("ANGLE_instanced_arrays"))[n.isWebGL2?"vertexAttribDivisor":"vertexAttribDivisorANGLE"](G,I),J[G]=I)}function T(){const G=c.newAttributes,I=c.enabledAttributes;for(let et=0,Y=I.length;et<Y;et++)I[et]!==G[et]&&(s.disableVertexAttribArray(et),I[et]=0)}function P(G,I,et,Y,J,ut,dt){dt===!0?s.vertexAttribIPointer(G,I,et,J,ut):s.vertexAttribPointer(G,I,et,Y,J,ut)}function C(G,I,et,Y){if(n.isWebGL2===!1&&(G.isInstancedMesh||Y.isInstancedBufferGeometry)&&t.get("ANGLE_instanced_arrays")===null)return;b();const J=Y.attributes,ut=et.getAttributes(),dt=I.defaultAttributeValues;for(const nt in ut){const ft=ut[nt];if(ft.location>=0){let Lt=J[nt];if(Lt===void 0&&(nt==="instanceMatrix"&&G.instanceMatrix&&(Lt=G.instanceMatrix),nt==="instanceColor"&&G.instanceColor&&(Lt=G.instanceColor)),Lt!==void 0){const Ot=Lt.normalized,It=Lt.itemSize,Kt=e.get(Lt);if(Kt===void 0)continue;const Ht=Kt.buffer,qt=Kt.type,ee=Kt.bytesPerElement,le=n.isWebGL2===!0&&(qt===s.INT||qt===s.UNSIGNED_INT||Lt.gpuType===Ll);if(Lt.isInterleavedBufferAttribute){const $t=Lt.data,Mt=$t.stride,X=Lt.offset;if($t.isInstancedInterleavedBuffer){for(let bt=0;bt<ft.locationSize;bt++)A(ft.location+bt,$t.meshPerAttribute);G.isInstancedMesh!==!0&&Y._maxInstanceCount===void 0&&(Y._maxInstanceCount=$t.meshPerAttribute*$t.count)}else for(let bt=0;bt<ft.locationSize;bt++)M(ft.location+bt);s.bindBuffer(s.ARRAY_BUFFER,Ht);for(let bt=0;bt<ft.locationSize;bt++)P(ft.location+bt,It/ft.locationSize,qt,Ot,Mt*ee,(X+It/ft.locationSize*bt)*ee,le)}else{if(Lt.isInstancedBufferAttribute){for(let $t=0;$t<ft.locationSize;$t++)A(ft.location+$t,Lt.meshPerAttribute);G.isInstancedMesh!==!0&&Y._maxInstanceCount===void 0&&(Y._maxInstanceCount=Lt.meshPerAttribute*Lt.count)}else for(let $t=0;$t<ft.locationSize;$t++)M(ft.location+$t);s.bindBuffer(s.ARRAY_BUFFER,Ht);for(let $t=0;$t<ft.locationSize;$t++)P(ft.location+$t,It/ft.locationSize,qt,Ot,It*ee,It/ft.locationSize*$t*ee,le)}}else if(dt!==void 0){const Ot=dt[nt];if(Ot!==void 0)switch(Ot.length){case 2:s.vertexAttrib2fv(ft.location,Ot);break;case 3:s.vertexAttrib3fv(ft.location,Ot);break;case 4:s.vertexAttrib4fv(ft.location,Ot);break;default:s.vertexAttrib1fv(ft.location,Ot)}}}}T()}function S(){$();for(const G in a){const I=a[G];for(const et in I){const Y=I[et];for(const J in Y)g(Y[J].object),delete Y[J];delete I[et]}delete a[G]}}function L(G){if(a[G.id]===void 0)return;const I=a[G.id];for(const et in I){const Y=I[et];for(const J in Y)g(Y[J].object),delete Y[J];delete I[et]}delete a[G.id]}function H(G){for(const I in a){const et=a[I];if(et[G.id]===void 0)continue;const Y=et[G.id];for(const J in Y)g(Y[J].object),delete Y[J];delete et[G.id]}}function $(){B(),h=!0,c!==l&&(c=l,m(c.object))}function B(){l.geometry=null,l.program=null,l.wireframe=!1}return{setup:f,reset:$,resetDefaultState:B,dispose:S,releaseStatesOfGeometry:L,releaseStatesOfProgram:H,initAttributes:b,enableAttribute:M,disableUnusedAttributes:T}}function NN(s,t,e,n){const i=n.isWebGL2;let r;function o(c){r=c}function a(c,h){s.drawArrays(r,c,h),e.update(h,r,1)}function l(c,h,f){if(f===0)return;let d,m;if(i)d=s,m="drawArraysInstanced";else if(d=t.get("ANGLE_instanced_arrays"),m="drawArraysInstancedANGLE",d===null){console.error("THREE.WebGLBufferRenderer: using THREE.InstancedBufferGeometry but hardware does not support extension ANGLE_instanced_arrays.");return}d[m](r,c,h,f),e.update(h,r,f)}this.setMode=o,this.render=a,this.renderInstances=l}function FN(s,t,e){let n;function i(){if(n!==void 0)return n;if(t.has("EXT_texture_filter_anisotropic")===!0){const P=t.get("EXT_texture_filter_anisotropic");n=s.getParameter(P.MAX_TEXTURE_MAX_ANISOTROPY_EXT)}else n=0;return n}function r(P){if(P==="highp"){if(s.getShaderPrecisionFormat(s.VERTEX_SHADER,s.HIGH_FLOAT).precision>0&&s.getShaderPrecisionFormat(s.FRAGMENT_SHADER,s.HIGH_FLOAT).precision>0)return"highp";P="mediump"}return P==="mediump"&&s.getShaderPrecisionFormat(s.VERTEX_SHADER,s.MEDIUM_FLOAT).precision>0&&s.getShaderPrecisionFormat(s.FRAGMENT_SHADER,s.MEDIUM_FLOAT).precision>0?"mediump":"lowp"}const o=typeof WebGL2RenderingContext<"u"&&s.constructor.name==="WebGL2RenderingContext";let a=e.precision!==void 0?e.precision:"highp";const l=r(a);l!==a&&(console.warn("THREE.WebGLRenderer:",a,"not supported, using",l,"instead."),a=l);const c=o||t.has("WEBGL_draw_buffers"),h=e.logarithmicDepthBuffer===!0,f=s.getParameter(s.MAX_TEXTURE_IMAGE_UNITS),d=s.getParameter(s.MAX_VERTEX_TEXTURE_IMAGE_UNITS),m=s.getParameter(s.MAX_TEXTURE_SIZE),g=s.getParameter(s.MAX_CUBE_MAP_TEXTURE_SIZE),y=s.getParameter(s.MAX_VERTEX_ATTRIBS),_=s.getParameter(s.MAX_VERTEX_UNIFORM_VECTORS),v=s.getParameter(s.MAX_VARYING_VECTORS),w=s.getParameter(s.MAX_FRAGMENT_UNIFORM_VECTORS),b=d>0,M=o||t.has("OES_texture_float"),A=b&&M,T=o?s.getParameter(s.MAX_SAMPLES):0;return{isWebGL2:o,drawBuffers:c,getMaxAnisotropy:i,getMaxPrecision:r,precision:a,logarithmicDepthBuffer:h,maxTextures:f,maxVertexTextures:d,maxTextureSize:m,maxCubemapSize:g,maxAttributes:y,maxVertexUniforms:_,maxVaryings:v,maxFragmentUniforms:w,vertexTextures:b,floatFragmentTextures:M,floatVertexTextures:A,maxSamples:T}}function BN(s){const t=this;let e=null,n=0,i=!1,r=!1;const o=new vr,a=new Te,l={value:null,needsUpdate:!1};this.uniform=l,this.numPlanes=0,this.numIntersection=0,this.init=function(f,d){const m=f.length!==0||d||n!==0||i;return i=d,n=f.length,m},this.beginShadows=function(){r=!0,h(null)},this.endShadows=function(){r=!1},this.setGlobalState=function(f,d){e=h(f,d,0)},this.setState=function(f,d,m){const g=f.clippingPlanes,y=f.clipIntersection,_=f.clipShadows,v=s.get(f);if(!i||g===null||g.length===0||r&&!_)r?h(null):c();else{const w=r?0:n,b=w*4;let M=v.clippingState||null;l.value=M,M=h(g,d,b,m);for(let A=0;A!==b;++A)M[A]=e[A];v.clippingState=M,this.numIntersection=y?this.numPlanes:0,this.numPlanes+=w}};function c(){l.value!==e&&(l.value=e,l.needsUpdate=n>0),t.numPlanes=n,t.numIntersection=0}function h(f,d,m,g){const y=f!==null?f.length:0;let _=null;if(y!==0){if(_=l.value,g!==!0||_===null){const v=m+y*4,w=d.matrixWorldInverse;a.getNormalMatrix(w),(_===null||_.length<v)&&(_=new Float32Array(v));for(let b=0,M=m;b!==y;++b,M+=4)o.copy(f[b]).applyMatrix4(w,a),o.normal.toArray(_,M),_[M+3]=o.constant}l.value=_,l.needsUpdate=!0}return t.numPlanes=y,t.numIntersection=0,_}}function HN(s){let t=new WeakMap;function e(o,a){return a===Vc?o.mapping=Sr:a===Gc&&(o.mapping=io),o}function n(o){if(o&&o.isTexture&&o.isRenderTargetTexture===!1){const a=o.mapping;if(a===Vc||a===Gc)if(t.has(o)){const l=t.get(o).texture;return e(l,o.mapping)}else{const l=o.image;if(l&&l.height>0){const c=new ES(l.height/2);return c.fromEquirectangularTexture(s,o),t.set(o,c),o.addEventListener("dispose",i),e(c.texture,o.mapping)}else return null}}return o}function i(o){const a=o.target;a.removeEventListener("dispose",i);const l=t.get(a);l!==void 0&&(t.delete(a),l.dispose())}function r(){t=new WeakMap}return{get:n,dispose:r}}class bu extends Dl{constructor(t=-1,e=1,n=1,i=-1,r=.1,o=2e3){super(),this.isOrthographicCamera=!0,this.type="OrthographicCamera",this.zoom=1,this.view=null,this.left=t,this.right=e,this.top=n,this.bottom=i,this.near=r,this.far=o,this.updateProjectionMatrix()}copy(t,e){return super.copy(t,e),this.left=t.left,this.right=t.right,this.top=t.top,this.bottom=t.bottom,this.near=t.near,this.far=t.far,this.zoom=t.zoom,this.view=t.view===null?null:Object.assign({},t.view),this}setViewOffset(t,e,n,i,r,o){this.view===null&&(this.view={enabled:!0,fullWidth:1,fullHeight:1,offsetX:0,offsetY:0,width:1,height:1}),this.view.enabled=!0,this.view.fullWidth=t,this.view.fullHeight=e,this.view.offsetX=n,this.view.offsetY=i,this.view.width=r,this.view.height=o,this.updateProjectionMatrix()}clearViewOffset(){this.view!==null&&(this.view.enabled=!1),this.updateProjectionMatrix()}updateProjectionMatrix(){const t=(this.right-this.left)/(2*this.zoom),e=(this.top-this.bottom)/(2*this.zoom),n=(this.right+this.left)/2,i=(this.top+this.bottom)/2;let r=n-t,o=n+t,a=i+e,l=i-e;if(this.view!==null&&this.view.enabled){const c=(this.right-this.left)/this.view.fullWidth/this.zoom,h=(this.top-this.bottom)/this.view.fullHeight/this.zoom;r+=c*this.view.offsetX,o=r+c*this.view.width,a-=h*this.view.offsetY,l=a-h*this.view.height}this.projectionMatrix.makeOrthographic(r,o,a,l,this.near,this.far,this.coordinateSystem),this.projectionMatrixInverse.copy(this.projectionMatrix).invert()}toJSON(t){const e=super.toJSON(t);return e.object.zoom=this.zoom,e.object.left=this.left,e.object.right=this.right,e.object.top=this.top,e.object.bottom=this.bottom,e.object.near=this.near,e.object.far=this.far,this.view!==null&&(e.object.view=Object.assign({},this.view)),e}}const ol=4,Ab=[.125,.215,.35,.446,.526,.582],No=20,$m=new bu,Eb=new Vt;let Xm=null;const ko=(1+Math.sqrt(5))/2,Za=1/ko,Tb=[new N(1,1,1),new N(-1,1,1),new N(1,1,-1),new N(-1,1,-1),new N(0,ko,Za),new N(0,ko,-Za),new N(Za,0,ko),new N(-Za,0,ko),new N(ko,Za,0),new N(-ko,Za,0)];class sv{constructor(t){this._renderer=t,this._pingPongRenderTarget=null,this._lodMax=0,this._cubeSize=0,this._lodPlanes=[],this._sizeLods=[],this._sigmas=[],this._blurMaterial=null,this._cubemapMaterial=null,this._equirectMaterial=null,this._compileMaterial(this._blurMaterial)}fromScene(t,e=0,n=.1,i=100){Xm=this._renderer.getRenderTarget(),this._setSize(256);const r=this._allocateTargets();return r.depthBuffer=!0,this._sceneToCubeUV(t,n,i,r),e>0&&this._blur(r,0,0,e),this._applyPMREM(r),this._cleanup(r),r}fromEquirectangular(t,e=null){return this._fromTexture(t,e)}fromCubemap(t,e=null){return this._fromTexture(t,e)}compileCubemapShader(){this._cubemapMaterial===null&&(this._cubemapMaterial=Rb(),this._compileMaterial(this._cubemapMaterial))}compileEquirectangularShader(){this._equirectMaterial===null&&(this._equirectMaterial=Pb(),this._compileMaterial(this._equirectMaterial))}dispose(){this._dispose(),this._cubemapMaterial!==null&&this._cubemapMaterial.dispose(),this._equirectMaterial!==null&&this._equirectMaterial.dispose()}_setSize(t){this._lodMax=Math.floor(Math.log2(t)),this._cubeSize=Math.pow(2,this._lodMax)}_dispose(){this._blurMaterial!==null&&this._blurMaterial.dispose(),this._pingPongRenderTarget!==null&&this._pingPongRenderTarget.dispose();for(let t=0;t<this._lodPlanes.length;t++)this._lodPlanes[t].dispose()}_cleanup(t){this._renderer.setRenderTarget(Xm),t.scissorTest=!1,Gh(t,0,0,t.width,t.height)}_fromTexture(t,e){t.mapping===Sr||t.mapping===io?this._setSize(t.image.length===0?16:t.image[0].width||t.image[0].image.width):this._setSize(t.image.width/4),Xm=this._renderer.getRenderTarget();const n=e||this._allocateTargets();return this._textureToCubeUV(t,n),this._applyPMREM(n),this._cleanup(n),n}_allocateTargets(){const t=3*Math.max(this._cubeSize,112),e=4*this._cubeSize,n={magFilter:fn,minFilter:fn,generateMipmaps:!1,type:yl,format:Vn,colorSpace:Es,depthBuffer:!1},i=Cb(t,e,n);if(this._pingPongRenderTarget===null||this._pingPongRenderTarget.width!==t||this._pingPongRenderTarget.height!==e){this._pingPongRenderTarget!==null&&this._dispose(),this._pingPongRenderTarget=Cb(t,e,n);const{_lodMax:r}=this;({sizeLods:this._sizeLods,lodPlanes:this._lodPlanes,sigmas:this._sigmas}=VN(r)),this._blurMaterial=GN(r,t,e)}return i}_compileMaterial(t){const e=new Xe(this._lodPlanes[0],t);this._renderer.compile(e,$m)}_sceneToCubeUV(t,e,n,i){const a=new nn(90,1,e,n),l=[1,-1,1,1,1,1],c=[1,1,1,-1,-1,-1],h=this._renderer,f=h.autoClear,d=h.toneMapping;h.getClearColor(Eb),h.toneMapping=xr,h.autoClear=!1;const m=new Tr({name:"PMREM.Background",side:oi,depthWrite:!1,depthTest:!1}),g=new Xe(new ua,m);let y=!1;const _=t.background;_?_.isColor&&(m.color.copy(_),t.background=null,y=!0):(m.color.copy(Eb),y=!0);for(let v=0;v<6;v++){const w=v%3;w===0?(a.up.set(0,l[v],0),a.lookAt(c[v],0,0)):w===1?(a.up.set(0,0,l[v]),a.lookAt(0,c[v],0)):(a.up.set(0,l[v],0),a.lookAt(0,0,c[v]));const b=this._cubeSize;Gh(i,w*b,v>2?b:0,b,b),h.setRenderTarget(i),y&&h.render(g,a),h.render(t,a)}g.geometry.dispose(),g.material.dispose(),h.toneMapping=d,h.autoClear=f,t.background=_}_textureToCubeUV(t,e){const n=this._renderer,i=t.mapping===Sr||t.mapping===io;i?(this._cubemapMaterial===null&&(this._cubemapMaterial=Rb()),this._cubemapMaterial.uniforms.flipEnvMap.value=t.isRenderTargetTexture===!1?-1:1):this._equirectMaterial===null&&(this._equirectMaterial=Pb());const r=i?this._cubemapMaterial:this._equirectMaterial,o=new Xe(this._lodPlanes[0],r),a=r.uniforms;a.envMap.value=t;const l=this._cubeSize;Gh(e,0,0,3*l,2*l),n.setRenderTarget(e),n.render(o,$m)}_applyPMREM(t){const e=this._renderer,n=e.autoClear;e.autoClear=!1;for(let i=1;i<this._lodPlanes.length;i++){const r=Math.sqrt(this._sigmas[i]*this._sigmas[i]-this._sigmas[i-1]*this._sigmas[i-1]),o=Tb[(i-1)%Tb.length];this._blur(t,i-1,i,r,o)}e.autoClear=n}_blur(t,e,n,i,r){const o=this._pingPongRenderTarget;this._halfBlur(t,o,e,n,i,"latitudinal",r),this._halfBlur(o,t,n,n,i,"longitudinal",r)}_halfBlur(t,e,n,i,r,o,a){const l=this._renderer,c=this._blurMaterial;o!=="latitudinal"&&o!=="longitudinal"&&console.error("blur direction must be either latitudinal or longitudinal!");const h=3,f=new Xe(this._lodPlanes[i],c),d=c.uniforms,m=this._sizeLods[n]-1,g=isFinite(r)?Math.PI/(2*m):2*Math.PI/(2*No-1),y=r/g,_=isFinite(r)?1+Math.floor(h*y):No;_>No&&console.warn(`sigmaRadians, ${r}, is too large and will clip, as it requested ${_} samples when the maximum is set to ${No}`);const v=[];let w=0;for(let P=0;P<No;++P){const C=P/y,S=Math.exp(-C*C/2);v.push(S),P===0?w+=S:P<_&&(w+=2*S)}for(let P=0;P<v.length;P++)v[P]=v[P]/w;d.envMap.value=t.texture,d.samples.value=_,d.weights.value=v,d.latitudinal.value=o==="latitudinal",a&&(d.poleAxis.value=a);const{_lodMax:b}=this;d.dTheta.value=g,d.mipInt.value=b-n;const M=this._sizeLods[i],A=3*M*(i>b-ol?i-b+ol:0),T=4*(this._cubeSize-M);Gh(e,A,T,3*M,2*M),l.setRenderTarget(e),l.render(f,$m)}}function VN(s){const t=[],e=[],n=[];let i=s;const r=s-ol+1+Ab.length;for(let o=0;o<r;o++){const a=Math.pow(2,i);e.push(a);let l=1/a;o>s-ol?l=Ab[o-s+ol-1]:o===0&&(l=0),n.push(l);const c=1/(a-2),h=-c,f=1+c,d=[h,h,f,h,f,f,h,h,f,f,h,f],m=6,g=6,y=3,_=2,v=1,w=new Float32Array(y*g*m),b=new Float32Array(_*g*m),M=new Float32Array(v*g*m);for(let T=0;T<m;T++){const P=T%3*2/3-1,C=T>2?0:-1,S=[P,C,0,P+2/3,C,0,P+2/3,C+1,0,P,C,0,P+2/3,C+1,0,P,C+1,0];w.set(S,y*g*T),b.set(d,_*g*T);const L=[T,T,T,T,T,T];M.set(L,v*g*T)}const A=new we;A.setAttribute("position",new ue(w,y)),A.setAttribute("uv",new ue(b,_)),A.setAttribute("faceIndex",new ue(M,v)),t.push(A),i>ol&&i--}return{lodPlanes:t,sizeLods:e,sigmas:n}}function Cb(s,t,e){const n=new Wi(s,t,e);return n.texture.mapping=Rl,n.texture.name="PMREM.cubeUv",n.scissorTest=!0,n}function Gh(s,t,e,n,i){s.viewport.set(t,e,n,i),s.scissor.set(t,e,n,i)}function GN(s,t,e){const n=new Float32Array(No),i=new N(0,1,0);return new qs({name:"SphericalGaussianBlur",defines:{n:No,CUBEUV_TEXEL_WIDTH:1/t,CUBEUV_TEXEL_HEIGHT:1/e,CUBEUV_MAX_MIP:`${s}.0`},uniforms:{envMap:{value:null},samples:{value:1},weights:{value:n},latitudinal:{value:!1},dTheta:{value:0},mipInt:{value:0},poleAxis:{value:i}},vertexShader:m_(),fragmentShader:`

			precision mediump float;
			precision mediump int;

			varying vec3 vOutputDirection;

			uniform sampler2D envMap;
			uniform int samples;
			uniform float weights[ n ];
			uniform bool latitudinal;
			uniform float dTheta;
			uniform float mipInt;
			uniform vec3 poleAxis;

			#define ENVMAP_TYPE_CUBE_UV
			#include <cube_uv_reflection_fragment>

			vec3 getSample( float theta, vec3 axis ) {

				float cosTheta = cos( theta );
				// Rodrigues' axis-angle rotation
				vec3 sampleDirection = vOutputDirection * cosTheta
					+ cross( axis, vOutputDirection ) * sin( theta )
					+ axis * dot( axis, vOutputDirection ) * ( 1.0 - cosTheta );

				return bilinearCubeUV( envMap, sampleDirection, mipInt );

			}

			void main() {

				vec3 axis = latitudinal ? poleAxis : cross( poleAxis, vOutputDirection );

				if ( all( equal( axis, vec3( 0.0 ) ) ) ) {

					axis = vec3( vOutputDirection.z, 0.0, - vOutputDirection.x );

				}

				axis = normalize( axis );

				gl_FragColor = vec4( 0.0, 0.0, 0.0, 1.0 );
				gl_FragColor.rgb += weights[ 0 ] * getSample( 0.0, axis );

				for ( int i = 1; i < n; i++ ) {

					if ( i >= samples ) {

						break;

					}

					float theta = dTheta * float( i );
					gl_FragColor.rgb += weights[ i ] * getSample( -1.0 * theta, axis );
					gl_FragColor.rgb += weights[ i ] * getSample( theta, axis );

				}

			}
		`,blending:yr,depthTest:!1,depthWrite:!1})}function Pb(){return new qs({name:"EquirectangularToCubeUV",uniforms:{envMap:{value:null}},vertexShader:m_(),fragmentShader:`

			precision mediump float;
			precision mediump int;

			varying vec3 vOutputDirection;

			uniform sampler2D envMap;

			#include <common>

			void main() {

				vec3 outputDirection = normalize( vOutputDirection );
				vec2 uv = equirectUv( outputDirection );

				gl_FragColor = vec4( texture2D ( envMap, uv ).rgb, 1.0 );

			}
		`,blending:yr,depthTest:!1,depthWrite:!1})}function Rb(){return new qs({name:"CubemapToCubeUV",uniforms:{envMap:{value:null},flipEnvMap:{value:-1}},vertexShader:m_(),fragmentShader:`

			precision mediump float;
			precision mediump int;

			uniform float flipEnvMap;

			varying vec3 vOutputDirection;

			uniform samplerCube envMap;

			void main() {

				gl_FragColor = textureCube( envMap, vec3( flipEnvMap * vOutputDirection.x, vOutputDirection.yz ) );

			}
		`,blending:yr,depthTest:!1,depthWrite:!1})}function m_(){return`

		precision mediump float;
		precision mediump int;

		attribute float faceIndex;

		varying vec3 vOutputDirection;

		// RH coordinate system; PMREM face-indexing convention
		vec3 getDirection( vec2 uv, float face ) {

			uv = 2.0 * uv - 1.0;

			vec3 direction = vec3( uv, 1.0 );

			if ( face == 0.0 ) {

				direction = direction.zyx; // ( 1, v, u ) pos x

			} else if ( face == 1.0 ) {

				direction = direction.xzy;
				direction.xz *= -1.0; // ( -u, 1, -v ) pos y

			} else if ( face == 2.0 ) {

				direction.x *= -1.0; // ( -u, v, 1 ) pos z

			} else if ( face == 3.0 ) {

				direction = direction.zyx;
				direction.xz *= -1.0; // ( -1, v, -u ) neg x

			} else if ( face == 4.0 ) {

				direction = direction.xzy;
				direction.xy *= -1.0; // ( -u, -1, v ) neg y

			} else if ( face == 5.0 ) {

				direction.z *= -1.0; // ( u, v, -1 ) neg z

			}

			return direction;

		}

		void main() {

			vOutputDirection = getDirection( uv, faceIndex );
			gl_Position = vec4( position, 1.0 );

		}
	`}function qN(s){let t=new WeakMap,e=null;function n(a){if(a&&a.isTexture){const l=a.mapping,c=l===Vc||l===Gc,h=l===Sr||l===io;if(c||h)if(a.isRenderTargetTexture&&a.needsPMREMUpdate===!0){a.needsPMREMUpdate=!1;let f=t.get(a);return e===null&&(e=new sv(s)),f=c?e.fromEquirectangular(a,f):e.fromCubemap(a,f),t.set(a,f),f.texture}else{if(t.has(a))return t.get(a).texture;{const f=a.image;if(c&&f&&f.height>0||h&&f&&i(f)){e===null&&(e=new sv(s));const d=c?e.fromEquirectangular(a):e.fromCubemap(a);return t.set(a,d),a.addEventListener("dispose",r),d.texture}else return null}}}return a}function i(a){let l=0;const c=6;for(let h=0;h<c;h++)a[h]!==void 0&&l++;return l===c}function r(a){const l=a.target;l.removeEventListener("dispose",r);const c=t.get(l);c!==void 0&&(t.delete(l),c.dispose())}function o(){t=new WeakMap,e!==null&&(e.dispose(),e=null)}return{get:n,dispose:o}}function WN(s){const t={};function e(n){if(t[n]!==void 0)return t[n];let i;switch(n){case"WEBGL_depth_texture":i=s.getExtension("WEBGL_depth_texture")||s.getExtension("MOZ_WEBGL_depth_texture")||s.getExtension("WEBKIT_WEBGL_depth_texture");break;case"EXT_texture_filter_anisotropic":i=s.getExtension("EXT_texture_filter_anisotropic")||s.getExtension("MOZ_EXT_texture_filter_anisotropic")||s.getExtension("WEBKIT_EXT_texture_filter_anisotropic");break;case"WEBGL_compressed_texture_s3tc":i=s.getExtension("WEBGL_compressed_texture_s3tc")||s.getExtension("MOZ_WEBGL_compressed_texture_s3tc")||s.getExtension("WEBKIT_WEBGL_compressed_texture_s3tc");break;case"WEBGL_compressed_texture_pvrtc":i=s.getExtension("WEBGL_compressed_texture_pvrtc")||s.getExtension("WEBKIT_WEBGL_compressed_texture_pvrtc");break;default:i=s.getExtension(n)}return t[n]=i,i}return{has:function(n){return e(n)!==null},init:function(n){n.isWebGL2?e("EXT_color_buffer_float"):(e("WEBGL_depth_texture"),e("OES_texture_float"),e("OES_texture_half_float"),e("OES_texture_half_float_linear"),e("OES_standard_derivatives"),e("OES_element_index_uint"),e("OES_vertex_array_object"),e("ANGLE_instanced_arrays")),e("OES_texture_float_linear"),e("EXT_color_buffer_half_float"),e("WEBGL_multisampled_render_to_texture")},get:function(n){const i=e(n);return i===null&&console.warn("THREE.WebGLRenderer: "+n+" extension not supported."),i}}}function $N(s,t,e,n){const i={},r=new WeakMap;function o(f){const d=f.target;d.index!==null&&t.remove(d.index);for(const g in d.attributes)t.remove(d.attributes[g]);for(const g in d.morphAttributes){const y=d.morphAttributes[g];for(let _=0,v=y.length;_<v;_++)t.remove(y[_])}d.removeEventListener("dispose",o),delete i[d.id];const m=r.get(d);m&&(t.remove(m),r.delete(d)),n.releaseStatesOfGeometry(d),d.isInstancedBufferGeometry===!0&&delete d._maxInstanceCount,e.memory.geometries--}function a(f,d){return i[d.id]===!0||(d.addEventListener("dispose",o),i[d.id]=!0,e.memory.geometries++),d}function l(f){const d=f.attributes;for(const g in d)t.update(d[g],s.ARRAY_BUFFER);const m=f.morphAttributes;for(const g in m){const y=m[g];for(let _=0,v=y.length;_<v;_++)t.update(y[_],s.ARRAY_BUFFER)}}function c(f){const d=[],m=f.index,g=f.attributes.position;let y=0;if(m!==null){const w=m.array;y=m.version;for(let b=0,M=w.length;b<M;b+=3){const A=w[b+0],T=w[b+1],P=w[b+2];d.push(A,T,T,P,P,A)}}else{const w=g.array;y=g.version;for(let b=0,M=w.length/3-1;b<M;b+=3){const A=b+0,T=b+1,P=b+2;d.push(A,T,T,P,P,A)}}const _=new(yS(d)?p_:d_)(d,1);_.version=y;const v=r.get(f);v&&t.remove(v),r.set(f,_)}function h(f){const d=r.get(f);if(d){const m=f.index;m!==null&&d.version<m.version&&c(f)}else c(f);return r.get(f)}return{get:a,update:l,getWireframeAttribute:h}}function XN(s,t,e,n){const i=n.isWebGL2;let r;function o(d){r=d}let a,l;function c(d){a=d.type,l=d.bytesPerElement}function h(d,m){s.drawElements(r,m,a,d*l),e.update(m,r,1)}function f(d,m,g){if(g===0)return;let y,_;if(i)y=s,_="drawElementsInstanced";else if(y=t.get("ANGLE_instanced_arrays"),_="drawElementsInstancedANGLE",y===null){console.error("THREE.WebGLIndexedBufferRenderer: using THREE.InstancedBufferGeometry but hardware does not support extension ANGLE_instanced_arrays.");return}y[_](r,m,a,d*l,g),e.update(m,r,g)}this.setMode=o,this.setIndex=c,this.render=h,this.renderInstances=f}function jN(s){const t={geometries:0,textures:0},e={frame:0,calls:0,triangles:0,points:0,lines:0};function n(r,o,a){switch(e.calls++,o){case s.TRIANGLES:e.triangles+=a*(r/3);break;case s.LINES:e.lines+=a*(r/2);break;case s.LINE_STRIP:e.lines+=a*(r-1);break;case s.LINE_LOOP:e.lines+=a*r;break;case s.POINTS:e.points+=a*r;break;default:console.error("THREE.WebGLInfo: Unknown draw mode:",o);break}}function i(){e.calls=0,e.triangles=0,e.points=0,e.lines=0}return{memory:t,render:e,programs:null,autoReset:!0,reset:i,update:n}}function YN(s,t){return s[0]-t[0]}function ZN(s,t){return Math.abs(t[1])-Math.abs(s[1])}function KN(s,t,e){const n={},i=new Float32Array(8),r=new WeakMap,o=new Oe,a=[];for(let c=0;c<8;c++)a[c]=[c,0];function l(c,h,f){const d=c.morphTargetInfluences;if(t.isWebGL2===!0){const m=h.morphAttributes.position||h.morphAttributes.normal||h.morphAttributes.color,g=m!==void 0?m.length:0;let y=r.get(h);if(y===void 0||y.count!==g){let G=function(){$.dispose(),r.delete(h),h.removeEventListener("dispose",G)};y!==void 0&&y.texture.dispose();const w=h.morphAttributes.position!==void 0,b=h.morphAttributes.normal!==void 0,M=h.morphAttributes.color!==void 0,A=h.morphAttributes.position||[],T=h.morphAttributes.normal||[],P=h.morphAttributes.color||[];let C=0;w===!0&&(C=1),b===!0&&(C=2),M===!0&&(C=3);let S=h.attributes.position.count*C,L=1;S>t.maxTextureSize&&(L=Math.ceil(S/t.maxTextureSize),S=t.maxTextureSize);const H=new Float32Array(S*L*4*g),$=new fd(H,S,L,g);$.type=Cn,$.needsUpdate=!0;const B=C*4;for(let I=0;I<g;I++){const et=A[I],Y=T[I],J=P[I],ut=S*L*4*I;for(let dt=0;dt<et.count;dt++){const nt=dt*B;w===!0&&(o.fromBufferAttribute(et,dt),H[ut+nt+0]=o.x,H[ut+nt+1]=o.y,H[ut+nt+2]=o.z,H[ut+nt+3]=0),b===!0&&(o.fromBufferAttribute(Y,dt),H[ut+nt+4]=o.x,H[ut+nt+5]=o.y,H[ut+nt+6]=o.z,H[ut+nt+7]=0),M===!0&&(o.fromBufferAttribute(J,dt),H[ut+nt+8]=o.x,H[ut+nt+9]=o.y,H[ut+nt+10]=o.z,H[ut+nt+11]=J.itemSize===4?o.w:1)}}y={count:g,texture:$,size:new pt(S,L)},r.set(h,y),h.addEventListener("dispose",G)}let _=0;for(let w=0;w<d.length;w++)_+=d[w];const v=h.morphTargetsRelative?1:1-_;f.getUniforms().setValue(s,"morphTargetBaseInfluence",v),f.getUniforms().setValue(s,"morphTargetInfluences",d),f.getUniforms().setValue(s,"morphTargetsTexture",y.texture,e),f.getUniforms().setValue(s,"morphTargetsTextureSize",y.size)}else{const m=d===void 0?0:d.length;let g=n[h.id];if(g===void 0||g.length!==m){g=[];for(let b=0;b<m;b++)g[b]=[b,0];n[h.id]=g}for(let b=0;b<m;b++){const M=g[b];M[0]=b,M[1]=d[b]}g.sort(ZN);for(let b=0;b<8;b++)b<m&&g[b][1]?(a[b][0]=g[b][0],a[b][1]=g[b][1]):(a[b][0]=Number.MAX_SAFE_INTEGER,a[b][1]=0);a.sort(YN);const y=h.morphAttributes.position,_=h.morphAttributes.normal;let v=0;for(let b=0;b<8;b++){const M=a[b],A=M[0],T=M[1];A!==Number.MAX_SAFE_INTEGER&&T?(y&&h.getAttribute("morphTarget"+b)!==y[A]&&h.setAttribute("morphTarget"+b,y[A]),_&&h.getAttribute("morphNormal"+b)!==_[A]&&h.setAttribute("morphNormal"+b,_[A]),i[b]=T,v+=T):(y&&h.hasAttribute("morphTarget"+b)===!0&&h.deleteAttribute("morphTarget"+b),_&&h.hasAttribute("morphNormal"+b)===!0&&h.deleteAttribute("morphNormal"+b),i[b]=0)}const w=h.morphTargetsRelative?1:1-v;f.getUniforms().setValue(s,"morphTargetBaseInfluence",w),f.getUniforms().setValue(s,"morphTargetInfluences",i)}}return{update:l}}function JN(s,t,e,n){let i=new WeakMap;function r(l){const c=n.render.frame,h=l.geometry,f=t.get(l,h);if(i.get(f)!==c&&(t.update(f),i.set(f,c)),l.isInstancedMesh&&(l.hasEventListener("dispose",a)===!1&&l.addEventListener("dispose",a),i.get(l)!==c&&(e.update(l.instanceMatrix,s.ARRAY_BUFFER),l.instanceColor!==null&&e.update(l.instanceColor,s.ARRAY_BUFFER),i.set(l,c))),l.isSkinnedMesh){const d=l.skeleton;i.get(d)!==c&&(d.update(),i.set(d,c))}return f}function o(){i=new WeakMap}function a(l){const c=l.target;c.removeEventListener("dispose",a),e.remove(c.instanceMatrix),c.instanceColor!==null&&e.remove(c.instanceColor)}return{update:r,dispose:o}}const CS=new xn,PS=new fd,RS=new f_,LS=new xu,Lb=[],Db=[],Ib=new Float32Array(16),Ob=new Float32Array(9),zb=new Float32Array(4);function Ol(s,t,e){const n=s[0];if(n<=0||n>0)return s;const i=t*e;let r=Lb[i];if(r===void 0&&(r=new Float32Array(i),Lb[i]=r),t!==0){n.toArray(r,0);for(let o=1,a=0;o!==t;++o)a+=e,s[o].toArray(r,a)}return r}function On(s,t){if(s.length!==t.length)return!1;for(let e=0,n=s.length;e<n;e++)if(s[e]!==t[e])return!1;return!0}function zn(s,t){for(let e=0,n=t.length;e<n;e++)s[e]=t[e]}function md(s,t){let e=Db[t];e===void 0&&(e=new Int32Array(t),Db[t]=e);for(let n=0;n!==t;++n)e[n]=s.allocateTextureUnit();return e}function QN(s,t){const e=this.cache;e[0]!==t&&(s.uniform1f(this.addr,t),e[0]=t)}function tF(s,t){const e=this.cache;if(t.x!==void 0)(e[0]!==t.x||e[1]!==t.y)&&(s.uniform2f(this.addr,t.x,t.y),e[0]=t.x,e[1]=t.y);else{if(On(e,t))return;s.uniform2fv(this.addr,t),zn(e,t)}}function eF(s,t){const e=this.cache;if(t.x!==void 0)(e[0]!==t.x||e[1]!==t.y||e[2]!==t.z)&&(s.uniform3f(this.addr,t.x,t.y,t.z),e[0]=t.x,e[1]=t.y,e[2]=t.z);else if(t.r!==void 0)(e[0]!==t.r||e[1]!==t.g||e[2]!==t.b)&&(s.uniform3f(this.addr,t.r,t.g,t.b),e[0]=t.r,e[1]=t.g,e[2]=t.b);else{if(On(e,t))return;s.uniform3fv(this.addr,t),zn(e,t)}}function nF(s,t){const e=this.cache;if(t.x!==void 0)(e[0]!==t.x||e[1]!==t.y||e[2]!==t.z||e[3]!==t.w)&&(s.uniform4f(this.addr,t.x,t.y,t.z,t.w),e[0]=t.x,e[1]=t.y,e[2]=t.z,e[3]=t.w);else{if(On(e,t))return;s.uniform4fv(this.addr,t),zn(e,t)}}function iF(s,t){const e=this.cache,n=t.elements;if(n===void 0){if(On(e,t))return;s.uniformMatrix2fv(this.addr,!1,t),zn(e,t)}else{if(On(e,n))return;zb.set(n),s.uniformMatrix2fv(this.addr,!1,zb),zn(e,n)}}function sF(s,t){const e=this.cache,n=t.elements;if(n===void 0){if(On(e,t))return;s.uniformMatrix3fv(this.addr,!1,t),zn(e,t)}else{if(On(e,n))return;Ob.set(n),s.uniformMatrix3fv(this.addr,!1,Ob),zn(e,n)}}function rF(s,t){const e=this.cache,n=t.elements;if(n===void 0){if(On(e,t))return;s.uniformMatrix4fv(this.addr,!1,t),zn(e,t)}else{if(On(e,n))return;Ib.set(n),s.uniformMatrix4fv(this.addr,!1,Ib),zn(e,n)}}function oF(s,t){const e=this.cache;e[0]!==t&&(s.uniform1i(this.addr,t),e[0]=t)}function aF(s,t){const e=this.cache;if(t.x!==void 0)(e[0]!==t.x||e[1]!==t.y)&&(s.uniform2i(this.addr,t.x,t.y),e[0]=t.x,e[1]=t.y);else{if(On(e,t))return;s.uniform2iv(this.addr,t),zn(e,t)}}function lF(s,t){const e=this.cache;if(t.x!==void 0)(e[0]!==t.x||e[1]!==t.y||e[2]!==t.z)&&(s.uniform3i(this.addr,t.x,t.y,t.z),e[0]=t.x,e[1]=t.y,e[2]=t.z);else{if(On(e,t))return;s.uniform3iv(this.addr,t),zn(e,t)}}function cF(s,t){const e=this.cache;if(t.x!==void 0)(e[0]!==t.x||e[1]!==t.y||e[2]!==t.z||e[3]!==t.w)&&(s.uniform4i(this.addr,t.x,t.y,t.z,t.w),e[0]=t.x,e[1]=t.y,e[2]=t.z,e[3]=t.w);else{if(On(e,t))return;s.uniform4iv(this.addr,t),zn(e,t)}}function uF(s,t){const e=this.cache;e[0]!==t&&(s.uniform1ui(this.addr,t),e[0]=t)}function hF(s,t){const e=this.cache;if(t.x!==void 0)(e[0]!==t.x||e[1]!==t.y)&&(s.uniform2ui(this.addr,t.x,t.y),e[0]=t.x,e[1]=t.y);else{if(On(e,t))return;s.uniform2uiv(this.addr,t),zn(e,t)}}function fF(s,t){const e=this.cache;if(t.x!==void 0)(e[0]!==t.x||e[1]!==t.y||e[2]!==t.z)&&(s.uniform3ui(this.addr,t.x,t.y,t.z),e[0]=t.x,e[1]=t.y,e[2]=t.z);else{if(On(e,t))return;s.uniform3uiv(this.addr,t),zn(e,t)}}function dF(s,t){const e=this.cache;if(t.x!==void 0)(e[0]!==t.x||e[1]!==t.y||e[2]!==t.z||e[3]!==t.w)&&(s.uniform4ui(this.addr,t.x,t.y,t.z,t.w),e[0]=t.x,e[1]=t.y,e[2]=t.z,e[3]=t.w);else{if(On(e,t))return;s.uniform4uiv(this.addr,t),zn(e,t)}}function pF(s,t,e){const n=this.cache,i=e.allocateTextureUnit();n[0]!==i&&(s.uniform1i(this.addr,i),n[0]=i),e.setTexture2D(t||CS,i)}function mF(s,t,e){const n=this.cache,i=e.allocateTextureUnit();n[0]!==i&&(s.uniform1i(this.addr,i),n[0]=i),e.setTexture3D(t||RS,i)}function gF(s,t,e){const n=this.cache,i=e.allocateTextureUnit();n[0]!==i&&(s.uniform1i(this.addr,i),n[0]=i),e.setTextureCube(t||LS,i)}function vF(s,t,e){const n=this.cache,i=e.allocateTextureUnit();n[0]!==i&&(s.uniform1i(this.addr,i),n[0]=i),e.setTexture2DArray(t||PS,i)}function _F(s){switch(s){case 5126:return QN;case 35664:return tF;case 35665:return eF;case 35666:return nF;case 35674:return iF;case 35675:return sF;case 35676:return rF;case 5124:case 35670:return oF;case 35667:case 35671:return aF;case 35668:case 35672:return lF;case 35669:case 35673:return cF;case 5125:return uF;case 36294:return hF;case 36295:return fF;case 36296:return dF;case 35678:case 36198:case 36298:case 36306:case 35682:return pF;case 35679:case 36299:case 36307:return mF;case 35680:case 36300:case 36308:case 36293:return gF;case 36289:case 36303:case 36311:case 36292:return vF}}function yF(s,t){s.uniform1fv(this.addr,t)}function xF(s,t){const e=Ol(t,this.size,2);s.uniform2fv(this.addr,e)}function bF(s,t){const e=Ol(t,this.size,3);s.uniform3fv(this.addr,e)}function wF(s,t){const e=Ol(t,this.size,4);s.uniform4fv(this.addr,e)}function MF(s,t){const e=Ol(t,this.size,4);s.uniformMatrix2fv(this.addr,!1,e)}function SF(s,t){const e=Ol(t,this.size,9);s.uniformMatrix3fv(this.addr,!1,e)}function AF(s,t){const e=Ol(t,this.size,16);s.uniformMatrix4fv(this.addr,!1,e)}function EF(s,t){s.uniform1iv(this.addr,t)}function TF(s,t){s.uniform2iv(this.addr,t)}function CF(s,t){s.uniform3iv(this.addr,t)}function PF(s,t){s.uniform4iv(this.addr,t)}function RF(s,t){s.uniform1uiv(this.addr,t)}function LF(s,t){s.uniform2uiv(this.addr,t)}function DF(s,t){s.uniform3uiv(this.addr,t)}function IF(s,t){s.uniform4uiv(this.addr,t)}function OF(s,t,e){const n=this.cache,i=t.length,r=md(e,i);On(n,r)||(s.uniform1iv(this.addr,r),zn(n,r));for(let o=0;o!==i;++o)e.setTexture2D(t[o]||CS,r[o])}function zF(s,t,e){const n=this.cache,i=t.length,r=md(e,i);On(n,r)||(s.uniform1iv(this.addr,r),zn(n,r));for(let o=0;o!==i;++o)e.setTexture3D(t[o]||RS,r[o])}function kF(s,t,e){const n=this.cache,i=t.length,r=md(e,i);On(n,r)||(s.uniform1iv(this.addr,r),zn(n,r));for(let o=0;o!==i;++o)e.setTextureCube(t[o]||LS,r[o])}function UF(s,t,e){const n=this.cache,i=t.length,r=md(e,i);On(n,r)||(s.uniform1iv(this.addr,r),zn(n,r));for(let o=0;o!==i;++o)e.setTexture2DArray(t[o]||PS,r[o])}function NF(s){switch(s){case 5126:return yF;case 35664:return xF;case 35665:return bF;case 35666:return wF;case 35674:return MF;case 35675:return SF;case 35676:return AF;case 5124:case 35670:return EF;case 35667:case 35671:return TF;case 35668:case 35672:return CF;case 35669:case 35673:return PF;case 5125:return RF;case 36294:return LF;case 36295:return DF;case 36296:return IF;case 35678:case 36198:case 36298:case 36306:case 35682:return OF;case 35679:case 36299:case 36307:return zF;case 35680:case 36300:case 36308:case 36293:return kF;case 36289:case 36303:case 36311:case 36292:return UF}}class FF{constructor(t,e,n){this.id=t,this.addr=n,this.cache=[],this.setValue=_F(e.type)}}class BF{constructor(t,e,n){this.id=t,this.addr=n,this.cache=[],this.size=e.size,this.setValue=NF(e.type)}}class HF{constructor(t){this.id=t,this.seq=[],this.map={}}setValue(t,e,n){const i=this.seq;for(let r=0,o=i.length;r!==o;++r){const a=i[r];a.setValue(t,e[a.id],n)}}}const jm=/(\w+)(\])?(\[|\.)?/g;function kb(s,t){s.seq.push(t),s.map[t.id]=t}function VF(s,t,e){const n=s.name,i=n.length;for(jm.lastIndex=0;;){const r=jm.exec(n),o=jm.lastIndex;let a=r[1];const l=r[2]==="]",c=r[3];if(l&&(a=a|0),c===void 0||c==="["&&o+2===i){kb(e,c===void 0?new FF(a,s,t):new BF(a,s,t));break}else{let f=e.map[a];f===void 0&&(f=new HF(a),kb(e,f)),e=f}}}class Pf{constructor(t,e){this.seq=[],this.map={};const n=t.getProgramParameter(e,t.ACTIVE_UNIFORMS);for(let i=0;i<n;++i){const r=t.getActiveUniform(e,i),o=t.getUniformLocation(e,r.name);VF(r,o,this)}}setValue(t,e,n,i){const r=this.map[e];r!==void 0&&r.setValue(t,n,i)}setOptional(t,e,n){const i=e[n];i!==void 0&&this.setValue(t,n,i)}static upload(t,e,n,i){for(let r=0,o=e.length;r!==o;++r){const a=e[r],l=n[a.id];l.needsUpdate!==!1&&a.setValue(t,l.value,i)}}static seqWithValue(t,e){const n=[];for(let i=0,r=t.length;i!==r;++i){const o=t[i];o.id in e&&n.push(o)}return n}}function Ub(s,t,e){const n=s.createShader(t);return s.shaderSource(n,e),s.compileShader(n),n}let GF=0;function qF(s,t){const e=s.split(`
`),n=[],i=Math.max(t-6,0),r=Math.min(t+6,e.length);for(let o=i;o<r;o++){const a=o+1;n.push(`${a===t?">":" "} ${a}: ${e[o]}`)}return n.join(`
`)}function WF(s){switch(s){case Es:return["Linear","( value )"];case ve:return["sRGB","( value )"];default:return console.warn("THREE.WebGLProgram: Unsupported color space:",s),["Linear","( value )"]}}function Nb(s,t,e){const n=s.getShaderParameter(t,s.COMPILE_STATUS),i=s.getShaderInfoLog(t).trim();if(n&&i==="")return"";const r=/ERROR: 0:(\d+)/.exec(i);if(r){const o=parseInt(r[1]);return e.toUpperCase()+`

`+i+`

`+qF(s.getShaderSource(t),o)}else return i}function $F(s,t){const e=WF(t);return"vec4 "+s+"( vec4 value ) { return LinearTo"+e[0]+e[1]+"; }"}function XF(s,t){let e;switch(t){case $M:e="Linear";break;case XM:e="Reinhard";break;case jM:e="OptimizedCineon";break;case Jv:e="ACESFilmic";break;case YM:e="Custom";break;default:console.warn("THREE.WebGLProgram: Unsupported toneMapping:",t),e="Linear"}return"vec3 "+s+"( vec3 color ) { return "+e+"ToneMapping( color ); }"}function jF(s){return[s.extensionDerivatives||s.envMapCubeUVHeight||s.bumpMap||s.normalMapTangentSpace||s.clearcoatNormalMap||s.flatShading||s.shaderID==="physical"?"#extension GL_OES_standard_derivatives : enable":"",(s.extensionFragDepth||s.logarithmicDepthBuffer)&&s.rendererExtensionFragDepth?"#extension GL_EXT_frag_depth : enable":"",s.extensionDrawBuffers&&s.rendererExtensionDrawBuffers?"#extension GL_EXT_draw_buffers : require":"",(s.extensionShaderTextureLOD||s.envMap||s.transmission)&&s.rendererExtensionShaderTextureLod?"#extension GL_EXT_shader_texture_lod : enable":""].filter(Rc).join(`
`)}function YF(s){const t=[];for(const e in s){const n=s[e];n!==!1&&t.push("#define "+e+" "+n)}return t.join(`
`)}function ZF(s,t){const e={},n=s.getProgramParameter(t,s.ACTIVE_ATTRIBUTES);for(let i=0;i<n;i++){const r=s.getActiveAttrib(t,i),o=r.name;let a=1;r.type===s.FLOAT_MAT2&&(a=2),r.type===s.FLOAT_MAT3&&(a=3),r.type===s.FLOAT_MAT4&&(a=4),e[o]={type:r.type,location:s.getAttribLocation(t,o),locationSize:a}}return e}function Rc(s){return s!==""}function Fb(s,t){const e=t.numSpotLightShadows+t.numSpotLightMaps-t.numSpotLightShadowsWithMaps;return s.replace(/NUM_DIR_LIGHTS/g,t.numDirLights).replace(/NUM_SPOT_LIGHTS/g,t.numSpotLights).replace(/NUM_SPOT_LIGHT_MAPS/g,t.numSpotLightMaps).replace(/NUM_SPOT_LIGHT_COORDS/g,e).replace(/NUM_RECT_AREA_LIGHTS/g,t.numRectAreaLights).replace(/NUM_POINT_LIGHTS/g,t.numPointLights).replace(/NUM_HEMI_LIGHTS/g,t.numHemiLights).replace(/NUM_DIR_LIGHT_SHADOWS/g,t.numDirLightShadows).replace(/NUM_SPOT_LIGHT_SHADOWS_WITH_MAPS/g,t.numSpotLightShadowsWithMaps).replace(/NUM_SPOT_LIGHT_SHADOWS/g,t.numSpotLightShadows).replace(/NUM_POINT_LIGHT_SHADOWS/g,t.numPointLightShadows)}function Bb(s,t){return s.replace(/NUM_CLIPPING_PLANES/g,t.numClippingPlanes).replace(/UNION_CLIPPING_PLANES/g,t.numClippingPlanes-t.numClipIntersection)}const KF=/^[ \t]*#include +<([\w\d./]+)>/gm;function rv(s){return s.replace(KF,QF)}const JF=new Map([["encodings_fragment","colorspace_fragment"],["encodings_pars_fragment","colorspace_pars_fragment"],["output_fragment","opaque_fragment"]]);function QF(s,t){let e=be[t];if(e===void 0){const n=JF.get(t);if(n!==void 0)e=be[n],console.warn('THREE.WebGLRenderer: Shader chunk "%s" has been deprecated. Use "%s" instead.',t,n);else throw new Error("Can not resolve #include <"+t+">")}return rv(e)}const t4=/#pragma unroll_loop_start\s+for\s*\(\s*int\s+i\s*=\s*(\d+)\s*;\s*i\s*<\s*(\d+)\s*;\s*i\s*\+\+\s*\)\s*{([\s\S]+?)}\s+#pragma unroll_loop_end/g;function Hb(s){return s.replace(t4,e4)}function e4(s,t,e,n){let i="";for(let r=parseInt(t);r<parseInt(e);r++)i+=n.replace(/\[\s*i\s*\]/g,"[ "+r+" ]").replace(/UNROLLED_LOOP_INDEX/g,r);return i}function Vb(s){let t="precision "+s.precision+` float;
precision `+s.precision+" int;";return s.precision==="highp"?t+=`
#define HIGH_PRECISION`:s.precision==="mediump"?t+=`
#define MEDIUM_PRECISION`:s.precision==="lowp"&&(t+=`
#define LOW_PRECISION`),t}function n4(s){let t="SHADOWMAP_TYPE_BASIC";return s.shadowMapType===Bv?t="SHADOWMAP_TYPE_PCF":s.shadowMapType===sd?t="SHADOWMAP_TYPE_PCF_SOFT":s.shadowMapType===ks&&(t="SHADOWMAP_TYPE_VSM"),t}function i4(s){let t="ENVMAP_TYPE_CUBE";if(s.envMap)switch(s.envMapMode){case Sr:case io:t="ENVMAP_TYPE_CUBE";break;case Rl:t="ENVMAP_TYPE_CUBE_UV";break}return t}function s4(s){let t="ENVMAP_MODE_REFLECTION";if(s.envMap)switch(s.envMapMode){case io:t="ENVMAP_MODE_REFRACTION";break}return t}function r4(s){let t="ENVMAP_BLENDING_NONE";if(s.envMap)switch(s.combine){case gu:t="ENVMAP_BLENDING_MULTIPLY";break;case qM:t="ENVMAP_BLENDING_MIX";break;case WM:t="ENVMAP_BLENDING_ADD";break}return t}function o4(s){const t=s.envMapCubeUVHeight;if(t===null)return null;const e=Math.log2(t)-2,n=1/t;return{texelWidth:1/(3*Math.max(Math.pow(2,e),7*16)),texelHeight:n,maxMip:e}}function a4(s,t,e,n){const i=s.getContext(),r=e.defines;let o=e.vertexShader,a=e.fragmentShader;const l=n4(e),c=i4(e),h=s4(e),f=r4(e),d=o4(e),m=e.isWebGL2?"":jF(e),g=YF(r),y=i.createProgram();let _,v,w=e.glslVersion?"#version "+e.glslVersion+`
`:"";e.isRawShaderMaterial?(_=["#define SHADER_TYPE "+e.shaderType,"#define SHADER_NAME "+e.shaderName,g].filter(Rc).join(`
`),_.length>0&&(_+=`
`),v=[m,"#define SHADER_TYPE "+e.shaderType,"#define SHADER_NAME "+e.shaderName,g].filter(Rc).join(`
`),v.length>0&&(v+=`
`)):(_=[Vb(e),"#define SHADER_TYPE "+e.shaderType,"#define SHADER_NAME "+e.shaderName,g,e.instancing?"#define USE_INSTANCING":"",e.instancingColor?"#define USE_INSTANCING_COLOR":"",e.useFog&&e.fog?"#define USE_FOG":"",e.useFog&&e.fogExp2?"#define FOG_EXP2":"",e.map?"#define USE_MAP":"",e.envMap?"#define USE_ENVMAP":"",e.envMap?"#define "+h:"",e.lightMap?"#define USE_LIGHTMAP":"",e.aoMap?"#define USE_AOMAP":"",e.bumpMap?"#define USE_BUMPMAP":"",e.normalMap?"#define USE_NORMALMAP":"",e.normalMapObjectSpace?"#define USE_NORMALMAP_OBJECTSPACE":"",e.normalMapTangentSpace?"#define USE_NORMALMAP_TANGENTSPACE":"",e.displacementMap?"#define USE_DISPLACEMENTMAP":"",e.emissiveMap?"#define USE_EMISSIVEMAP":"",e.anisotropyMap?"#define USE_ANISOTROPYMAP":"",e.clearcoatMap?"#define USE_CLEARCOATMAP":"",e.clearcoatRoughnessMap?"#define USE_CLEARCOAT_ROUGHNESSMAP":"",e.clearcoatNormalMap?"#define USE_CLEARCOAT_NORMALMAP":"",e.iridescenceMap?"#define USE_IRIDESCENCEMAP":"",e.iridescenceThicknessMap?"#define USE_IRIDESCENCE_THICKNESSMAP":"",e.specularMap?"#define USE_SPECULARMAP":"",e.specularColorMap?"#define USE_SPECULAR_COLORMAP":"",e.specularIntensityMap?"#define USE_SPECULAR_INTENSITYMAP":"",e.roughnessMap?"#define USE_ROUGHNESSMAP":"",e.metalnessMap?"#define USE_METALNESSMAP":"",e.alphaMap?"#define USE_ALPHAMAP":"",e.alphaHash?"#define USE_ALPHAHASH":"",e.transmission?"#define USE_TRANSMISSION":"",e.transmissionMap?"#define USE_TRANSMISSIONMAP":"",e.thicknessMap?"#define USE_THICKNESSMAP":"",e.sheenColorMap?"#define USE_SHEEN_COLORMAP":"",e.sheenRoughnessMap?"#define USE_SHEEN_ROUGHNESSMAP":"",e.mapUv?"#define MAP_UV "+e.mapUv:"",e.alphaMapUv?"#define ALPHAMAP_UV "+e.alphaMapUv:"",e.lightMapUv?"#define LIGHTMAP_UV "+e.lightMapUv:"",e.aoMapUv?"#define AOMAP_UV "+e.aoMapUv:"",e.emissiveMapUv?"#define EMISSIVEMAP_UV "+e.emissiveMapUv:"",e.bumpMapUv?"#define BUMPMAP_UV "+e.bumpMapUv:"",e.normalMapUv?"#define NORMALMAP_UV "+e.normalMapUv:"",e.displacementMapUv?"#define DISPLACEMENTMAP_UV "+e.displacementMapUv:"",e.metalnessMapUv?"#define METALNESSMAP_UV "+e.metalnessMapUv:"",e.roughnessMapUv?"#define ROUGHNESSMAP_UV "+e.roughnessMapUv:"",e.anisotropyMapUv?"#define ANISOTROPYMAP_UV "+e.anisotropyMapUv:"",e.clearcoatMapUv?"#define CLEARCOATMAP_UV "+e.clearcoatMapUv:"",e.clearcoatNormalMapUv?"#define CLEARCOAT_NORMALMAP_UV "+e.clearcoatNormalMapUv:"",e.clearcoatRoughnessMapUv?"#define CLEARCOAT_ROUGHNESSMAP_UV "+e.clearcoatRoughnessMapUv:"",e.iridescenceMapUv?"#define IRIDESCENCEMAP_UV "+e.iridescenceMapUv:"",e.iridescenceThicknessMapUv?"#define IRIDESCENCE_THICKNESSMAP_UV "+e.iridescenceThicknessMapUv:"",e.sheenColorMapUv?"#define SHEEN_COLORMAP_UV "+e.sheenColorMapUv:"",e.sheenRoughnessMapUv?"#define SHEEN_ROUGHNESSMAP_UV "+e.sheenRoughnessMapUv:"",e.specularMapUv?"#define SPECULARMAP_UV "+e.specularMapUv:"",e.specularColorMapUv?"#define SPECULAR_COLORMAP_UV "+e.specularColorMapUv:"",e.specularIntensityMapUv?"#define SPECULAR_INTENSITYMAP_UV "+e.specularIntensityMapUv:"",e.transmissionMapUv?"#define TRANSMISSIONMAP_UV "+e.transmissionMapUv:"",e.thicknessMapUv?"#define THICKNESSMAP_UV "+e.thicknessMapUv:"",e.vertexTangents&&e.flatShading===!1?"#define USE_TANGENT":"",e.vertexColors?"#define USE_COLOR":"",e.vertexAlphas?"#define USE_COLOR_ALPHA":"",e.vertexUv1s?"#define USE_UV1":"",e.vertexUv2s?"#define USE_UV2":"",e.vertexUv3s?"#define USE_UV3":"",e.pointsUvs?"#define USE_POINTS_UV":"",e.flatShading?"#define FLAT_SHADED":"",e.skinning?"#define USE_SKINNING":"",e.morphTargets?"#define USE_MORPHTARGETS":"",e.morphNormals&&e.flatShading===!1?"#define USE_MORPHNORMALS":"",e.morphColors&&e.isWebGL2?"#define USE_MORPHCOLORS":"",e.morphTargetsCount>0&&e.isWebGL2?"#define MORPHTARGETS_TEXTURE":"",e.morphTargetsCount>0&&e.isWebGL2?"#define MORPHTARGETS_TEXTURE_STRIDE "+e.morphTextureStride:"",e.morphTargetsCount>0&&e.isWebGL2?"#define MORPHTARGETS_COUNT "+e.morphTargetsCount:"",e.doubleSided?"#define DOUBLE_SIDED":"",e.flipSided?"#define FLIP_SIDED":"",e.shadowMapEnabled?"#define USE_SHADOWMAP":"",e.shadowMapEnabled?"#define "+l:"",e.sizeAttenuation?"#define USE_SIZEATTENUATION":"",e.useLegacyLights?"#define LEGACY_LIGHTS":"",e.logarithmicDepthBuffer?"#define USE_LOGDEPTHBUF":"",e.logarithmicDepthBuffer&&e.rendererExtensionFragDepth?"#define USE_LOGDEPTHBUF_EXT":"","uniform mat4 modelMatrix;","uniform mat4 modelViewMatrix;","uniform mat4 projectionMatrix;","uniform mat4 viewMatrix;","uniform mat3 normalMatrix;","uniform vec3 cameraPosition;","uniform bool isOrthographic;","#ifdef USE_INSTANCING","	attribute mat4 instanceMatrix;","#endif","#ifdef USE_INSTANCING_COLOR","	attribute vec3 instanceColor;","#endif","attribute vec3 position;","attribute vec3 normal;","attribute vec2 uv;","#ifdef USE_UV1","	attribute vec2 uv1;","#endif","#ifdef USE_UV2","	attribute vec2 uv2;","#endif","#ifdef USE_UV3","	attribute vec2 uv3;","#endif","#ifdef USE_TANGENT","	attribute vec4 tangent;","#endif","#if defined( USE_COLOR_ALPHA )","	attribute vec4 color;","#elif defined( USE_COLOR )","	attribute vec3 color;","#endif","#if ( defined( USE_MORPHTARGETS ) && ! defined( MORPHTARGETS_TEXTURE ) )","	attribute vec3 morphTarget0;","	attribute vec3 morphTarget1;","	attribute vec3 morphTarget2;","	attribute vec3 morphTarget3;","	#ifdef USE_MORPHNORMALS","		attribute vec3 morphNormal0;","		attribute vec3 morphNormal1;","		attribute vec3 morphNormal2;","		attribute vec3 morphNormal3;","	#else","		attribute vec3 morphTarget4;","		attribute vec3 morphTarget5;","		attribute vec3 morphTarget6;","		attribute vec3 morphTarget7;","	#endif","#endif","#ifdef USE_SKINNING","	attribute vec4 skinIndex;","	attribute vec4 skinWeight;","#endif",`
`].filter(Rc).join(`
`),v=[m,Vb(e),"#define SHADER_TYPE "+e.shaderType,"#define SHADER_NAME "+e.shaderName,g,e.useFog&&e.fog?"#define USE_FOG":"",e.useFog&&e.fogExp2?"#define FOG_EXP2":"",e.map?"#define USE_MAP":"",e.matcap?"#define USE_MATCAP":"",e.envMap?"#define USE_ENVMAP":"",e.envMap?"#define "+c:"",e.envMap?"#define "+h:"",e.envMap?"#define "+f:"",d?"#define CUBEUV_TEXEL_WIDTH "+d.texelWidth:"",d?"#define CUBEUV_TEXEL_HEIGHT "+d.texelHeight:"",d?"#define CUBEUV_MAX_MIP "+d.maxMip+".0":"",e.lightMap?"#define USE_LIGHTMAP":"",e.aoMap?"#define USE_AOMAP":"",e.bumpMap?"#define USE_BUMPMAP":"",e.normalMap?"#define USE_NORMALMAP":"",e.normalMapObjectSpace?"#define USE_NORMALMAP_OBJECTSPACE":"",e.normalMapTangentSpace?"#define USE_NORMALMAP_TANGENTSPACE":"",e.emissiveMap?"#define USE_EMISSIVEMAP":"",e.anisotropy?"#define USE_ANISOTROPY":"",e.anisotropyMap?"#define USE_ANISOTROPYMAP":"",e.clearcoat?"#define USE_CLEARCOAT":"",e.clearcoatMap?"#define USE_CLEARCOATMAP":"",e.clearcoatRoughnessMap?"#define USE_CLEARCOAT_ROUGHNESSMAP":"",e.clearcoatNormalMap?"#define USE_CLEARCOAT_NORMALMAP":"",e.iridescence?"#define USE_IRIDESCENCE":"",e.iridescenceMap?"#define USE_IRIDESCENCEMAP":"",e.iridescenceThicknessMap?"#define USE_IRIDESCENCE_THICKNESSMAP":"",e.specularMap?"#define USE_SPECULARMAP":"",e.specularColorMap?"#define USE_SPECULAR_COLORMAP":"",e.specularIntensityMap?"#define USE_SPECULAR_INTENSITYMAP":"",e.roughnessMap?"#define USE_ROUGHNESSMAP":"",e.metalnessMap?"#define USE_METALNESSMAP":"",e.alphaMap?"#define USE_ALPHAMAP":"",e.alphaTest?"#define USE_ALPHATEST":"",e.alphaHash?"#define USE_ALPHAHASH":"",e.sheen?"#define USE_SHEEN":"",e.sheenColorMap?"#define USE_SHEEN_COLORMAP":"",e.sheenRoughnessMap?"#define USE_SHEEN_ROUGHNESSMAP":"",e.transmission?"#define USE_TRANSMISSION":"",e.transmissionMap?"#define USE_TRANSMISSIONMAP":"",e.thicknessMap?"#define USE_THICKNESSMAP":"",e.vertexTangents&&e.flatShading===!1?"#define USE_TANGENT":"",e.vertexColors||e.instancingColor?"#define USE_COLOR":"",e.vertexAlphas?"#define USE_COLOR_ALPHA":"",e.vertexUv1s?"#define USE_UV1":"",e.vertexUv2s?"#define USE_UV2":"",e.vertexUv3s?"#define USE_UV3":"",e.pointsUvs?"#define USE_POINTS_UV":"",e.gradientMap?"#define USE_GRADIENTMAP":"",e.flatShading?"#define FLAT_SHADED":"",e.doubleSided?"#define DOUBLE_SIDED":"",e.flipSided?"#define FLIP_SIDED":"",e.shadowMapEnabled?"#define USE_SHADOWMAP":"",e.shadowMapEnabled?"#define "+l:"",e.premultipliedAlpha?"#define PREMULTIPLIED_ALPHA":"",e.useLegacyLights?"#define LEGACY_LIGHTS":"",e.logarithmicDepthBuffer?"#define USE_LOGDEPTHBUF":"",e.logarithmicDepthBuffer&&e.rendererExtensionFragDepth?"#define USE_LOGDEPTHBUF_EXT":"","uniform mat4 viewMatrix;","uniform vec3 cameraPosition;","uniform bool isOrthographic;",e.toneMapping!==xr?"#define TONE_MAPPING":"",e.toneMapping!==xr?be.tonemapping_pars_fragment:"",e.toneMapping!==xr?XF("toneMapping",e.toneMapping):"",e.dithering?"#define DITHERING":"",e.opaque?"#define OPAQUE":"",be.colorspace_pars_fragment,$F("linearToOutputTexel",e.outputColorSpace),e.useDepthPacking?"#define DEPTH_PACKING "+e.depthPacking:"",`
`].filter(Rc).join(`
`)),o=rv(o),o=Fb(o,e),o=Bb(o,e),a=rv(a),a=Fb(a,e),a=Bb(a,e),o=Hb(o),a=Hb(a),e.isWebGL2&&e.isRawShaderMaterial!==!0&&(w=`#version 300 es
`,_=["precision mediump sampler2DArray;","#define attribute in","#define varying out","#define texture2D texture"].join(`
`)+`
`+_,v=["#define varying in",e.glslVersion===ev?"":"layout(location = 0) out highp vec4 pc_fragColor;",e.glslVersion===ev?"":"#define gl_FragColor pc_fragColor","#define gl_FragDepthEXT gl_FragDepth","#define texture2D texture","#define textureCube texture","#define texture2DProj textureProj","#define texture2DLodEXT textureLod","#define texture2DProjLodEXT textureProjLod","#define textureCubeLodEXT textureLod","#define texture2DGradEXT textureGrad","#define texture2DProjGradEXT textureProjGrad","#define textureCubeGradEXT textureGrad"].join(`
`)+`
`+v);const b=w+_+o,M=w+v+a,A=Ub(i,i.VERTEX_SHADER,b),T=Ub(i,i.FRAGMENT_SHADER,M);if(i.attachShader(y,A),i.attachShader(y,T),e.index0AttributeName!==void 0?i.bindAttribLocation(y,0,e.index0AttributeName):e.morphTargets===!0&&i.bindAttribLocation(y,0,"position"),i.linkProgram(y),s.debug.checkShaderErrors){const S=i.getProgramInfoLog(y).trim(),L=i.getShaderInfoLog(A).trim(),H=i.getShaderInfoLog(T).trim();let $=!0,B=!0;if(i.getProgramParameter(y,i.LINK_STATUS)===!1)if($=!1,typeof s.debug.onShaderError=="function")s.debug.onShaderError(i,y,A,T);else{const G=Nb(i,A,"vertex"),I=Nb(i,T,"fragment");console.error("THREE.WebGLProgram: Shader Error "+i.getError()+" - VALIDATE_STATUS "+i.getProgramParameter(y,i.VALIDATE_STATUS)+`

Program Info Log: `+S+`
`+G+`
`+I)}else S!==""?console.warn("THREE.WebGLProgram: Program Info Log:",S):(L===""||H==="")&&(B=!1);B&&(this.diagnostics={runnable:$,programLog:S,vertexShader:{log:L,prefix:_},fragmentShader:{log:H,prefix:v}})}i.deleteShader(A),i.deleteShader(T);let P;this.getUniforms=function(){return P===void 0&&(P=new Pf(i,y)),P};let C;return this.getAttributes=function(){return C===void 0&&(C=ZF(i,y)),C},this.destroy=function(){n.releaseStatesOfProgram(this),i.deleteProgram(y),this.program=void 0},this.type=e.shaderType,this.name=e.shaderName,this.id=GF++,this.cacheKey=t,this.usedTimes=1,this.program=y,this.vertexShader=A,this.fragmentShader=T,this}let l4=0;class c4{constructor(){this.shaderCache=new Map,this.materialCache=new Map}update(t){const e=t.vertexShader,n=t.fragmentShader,i=this._getShaderStage(e),r=this._getShaderStage(n),o=this._getShaderCacheForMaterial(t);return o.has(i)===!1&&(o.add(i),i.usedTimes++),o.has(r)===!1&&(o.add(r),r.usedTimes++),this}remove(t){const e=this.materialCache.get(t);for(const n of e)n.usedTimes--,n.usedTimes===0&&this.shaderCache.delete(n.code);return this.materialCache.delete(t),this}getVertexShaderID(t){return this._getShaderStage(t.vertexShader).id}getFragmentShaderID(t){return this._getShaderStage(t.fragmentShader).id}dispose(){this.shaderCache.clear(),this.materialCache.clear()}_getShaderCacheForMaterial(t){const e=this.materialCache;let n=e.get(t);return n===void 0&&(n=new Set,e.set(t,n)),n}_getShaderStage(t){const e=this.shaderCache;let n=e.get(t);return n===void 0&&(n=new u4(t),e.set(t,n)),n}}class u4{constructor(t){this.id=l4++,this.code=t,this.usedTimes=0}}function h4(s,t,e,n,i,r,o){const a=new dd,l=new c4,c=[],h=i.isWebGL2,f=i.logarithmicDepthBuffer,d=i.vertexTextures;let m=i.precision;const g={MeshDepthMaterial:"depth",MeshDistanceMaterial:"distanceRGBA",MeshNormalMaterial:"normal",MeshBasicMaterial:"basic",MeshLambertMaterial:"lambert",MeshPhongMaterial:"phong",MeshToonMaterial:"toon",MeshStandardMaterial:"physical",MeshPhysicalMaterial:"physical",MeshMatcapMaterial:"matcap",LineBasicMaterial:"basic",LineDashedMaterial:"dashed",PointsMaterial:"points",ShadowMaterial:"shadow",SpriteMaterial:"sprite"};function y(S){return S===0?"uv":`uv${S}`}function _(S,L,H,$,B){const G=$.fog,I=B.geometry,et=S.isMeshStandardMaterial?$.environment:null,Y=(S.isMeshStandardMaterial?e:t).get(S.envMap||et),J=Y&&Y.mapping===Rl?Y.image.height:null,ut=g[S.type];S.precision!==null&&(m=i.getMaxPrecision(S.precision),m!==S.precision&&console.warn("THREE.WebGLProgram.getParameters:",S.precision,"not supported, using",m,"instead."));const dt=I.morphAttributes.position||I.morphAttributes.normal||I.morphAttributes.color,nt=dt!==void 0?dt.length:0;let ft=0;I.morphAttributes.position!==void 0&&(ft=1),I.morphAttributes.normal!==void 0&&(ft=2),I.morphAttributes.color!==void 0&&(ft=3);let Lt,Ot,It,Kt;if(ut){const Ze=ws[ut];Lt=Ze.vertexShader,Ot=Ze.fragmentShader}else Lt=S.vertexShader,Ot=S.fragmentShader,l.update(S),It=l.getVertexShaderID(S),Kt=l.getFragmentShaderID(S);const Ht=s.getRenderTarget(),qt=B.isInstancedMesh===!0,ee=!!S.map,le=!!S.matcap,$t=!!Y,Mt=!!S.aoMap,X=!!S.lightMap,bt=!!S.bumpMap,W=!!S.normalMap,st=!!S.displacementMap,ct=!!S.emissiveMap,Ct=!!S.metalnessMap,wt=!!S.roughnessMap,Tt=S.anisotropy>0,Xt=S.clearcoat>0,Qt=S.iridescence>0,U=S.sheen>0,k=S.transmission>0,ht=Tt&&!!S.anisotropyMap,St=Xt&&!!S.clearcoatMap,Et=Xt&&!!S.clearcoatNormalMap,Dt=Xt&&!!S.clearcoatRoughnessMap,Jt=Qt&&!!S.iridescenceMap,tt=Qt&&!!S.iridescenceThicknessMap,Q=U&&!!S.sheenColorMap,V=U&&!!S.sheenRoughnessMap,_t=!!S.specularMap,zt=!!S.specularColorMap,Ut=!!S.specularIntensityMap,kt=k&&!!S.transmissionMap,ne=k&&!!S.thicknessMap,_e=!!S.gradientMap,Z=!!S.alphaMap,Rt=S.alphaTest>0,at=!!S.alphaHash,Pt=!!S.extensions,Nt=!!I.attributes.uv1,ye=!!I.attributes.uv2,Be=!!I.attributes.uv3;let Qe=xr;return S.toneMapped&&(Ht===null||Ht.isXRRenderTarget===!0)&&(Qe=s.toneMapping),{isWebGL2:h,shaderID:ut,shaderType:S.type,shaderName:S.name,vertexShader:Lt,fragmentShader:Ot,defines:S.defines,customVertexShaderID:It,customFragmentShaderID:Kt,isRawShaderMaterial:S.isRawShaderMaterial===!0,glslVersion:S.glslVersion,precision:m,instancing:qt,instancingColor:qt&&B.instanceColor!==null,supportsVertexTextures:d,outputColorSpace:Ht===null?s.outputColorSpace:Ht.isXRRenderTarget===!0?Ht.texture.colorSpace:Es,map:ee,matcap:le,envMap:$t,envMapMode:$t&&Y.mapping,envMapCubeUVHeight:J,aoMap:Mt,lightMap:X,bumpMap:bt,normalMap:W,displacementMap:d&&st,emissiveMap:ct,normalMapObjectSpace:W&&S.normalMapType===rS,normalMapTangentSpace:W&&S.normalMapType===lo,metalnessMap:Ct,roughnessMap:wt,anisotropy:Tt,anisotropyMap:ht,clearcoat:Xt,clearcoatMap:St,clearcoatNormalMap:Et,clearcoatRoughnessMap:Dt,iridescence:Qt,iridescenceMap:Jt,iridescenceThicknessMap:tt,sheen:U,sheenColorMap:Q,sheenRoughnessMap:V,specularMap:_t,specularColorMap:zt,specularIntensityMap:Ut,transmission:k,transmissionMap:kt,thicknessMap:ne,gradientMap:_e,opaque:S.transparent===!1&&S.blending===Yr,alphaMap:Z,alphaTest:Rt,alphaHash:at,combine:S.combine,mapUv:ee&&y(S.map.channel),aoMapUv:Mt&&y(S.aoMap.channel),lightMapUv:X&&y(S.lightMap.channel),bumpMapUv:bt&&y(S.bumpMap.channel),normalMapUv:W&&y(S.normalMap.channel),displacementMapUv:st&&y(S.displacementMap.channel),emissiveMapUv:ct&&y(S.emissiveMap.channel),metalnessMapUv:Ct&&y(S.metalnessMap.channel),roughnessMapUv:wt&&y(S.roughnessMap.channel),anisotropyMapUv:ht&&y(S.anisotropyMap.channel),clearcoatMapUv:St&&y(S.clearcoatMap.channel),clearcoatNormalMapUv:Et&&y(S.clearcoatNormalMap.channel),clearcoatRoughnessMapUv:Dt&&y(S.clearcoatRoughnessMap.channel),iridescenceMapUv:Jt&&y(S.iridescenceMap.channel),iridescenceThicknessMapUv:tt&&y(S.iridescenceThicknessMap.channel),sheenColorMapUv:Q&&y(S.sheenColorMap.channel),sheenRoughnessMapUv:V&&y(S.sheenRoughnessMap.channel),specularMapUv:_t&&y(S.specularMap.channel),specularColorMapUv:zt&&y(S.specularColorMap.channel),specularIntensityMapUv:Ut&&y(S.specularIntensityMap.channel),transmissionMapUv:kt&&y(S.transmissionMap.channel),thicknessMapUv:ne&&y(S.thicknessMap.channel),alphaMapUv:Z&&y(S.alphaMap.channel),vertexTangents:!!I.attributes.tangent&&(W||Tt),vertexColors:S.vertexColors,vertexAlphas:S.vertexColors===!0&&!!I.attributes.color&&I.attributes.color.itemSize===4,vertexUv1s:Nt,vertexUv2s:ye,vertexUv3s:Be,pointsUvs:B.isPoints===!0&&!!I.attributes.uv&&(ee||Z),fog:!!G,useFog:S.fog===!0,fogExp2:G&&G.isFogExp2,flatShading:S.flatShading===!0,sizeAttenuation:S.sizeAttenuation===!0,logarithmicDepthBuffer:f,skinning:B.isSkinnedMesh===!0,morphTargets:I.morphAttributes.position!==void 0,morphNormals:I.morphAttributes.normal!==void 0,morphColors:I.morphAttributes.color!==void 0,morphTargetsCount:nt,morphTextureStride:ft,numDirLights:L.directional.length,numPointLights:L.point.length,numSpotLights:L.spot.length,numSpotLightMaps:L.spotLightMap.length,numRectAreaLights:L.rectArea.length,numHemiLights:L.hemi.length,numDirLightShadows:L.directionalShadowMap.length,numPointLightShadows:L.pointShadowMap.length,numSpotLightShadows:L.spotShadowMap.length,numSpotLightShadowsWithMaps:L.numSpotLightShadowsWithMaps,numClippingPlanes:o.numPlanes,numClipIntersection:o.numIntersection,dithering:S.dithering,shadowMapEnabled:s.shadowMap.enabled&&H.length>0,shadowMapType:s.shadowMap.type,toneMapping:Qe,useLegacyLights:s._useLegacyLights,premultipliedAlpha:S.premultipliedAlpha,doubleSided:S.side===An,flipSided:S.side===oi,useDepthPacking:S.depthPacking>=0,depthPacking:S.depthPacking||0,index0AttributeName:S.index0AttributeName,extensionDerivatives:Pt&&S.extensions.derivatives===!0,extensionFragDepth:Pt&&S.extensions.fragDepth===!0,extensionDrawBuffers:Pt&&S.extensions.drawBuffers===!0,extensionShaderTextureLOD:Pt&&S.extensions.shaderTextureLOD===!0,rendererExtensionFragDepth:h||n.has("EXT_frag_depth"),rendererExtensionDrawBuffers:h||n.has("WEBGL_draw_buffers"),rendererExtensionShaderTextureLod:h||n.has("EXT_shader_texture_lod"),customProgramCacheKey:S.customProgramCacheKey()}}function v(S){const L=[];if(S.shaderID?L.push(S.shaderID):(L.push(S.customVertexShaderID),L.push(S.customFragmentShaderID)),S.defines!==void 0)for(const H in S.defines)L.push(H),L.push(S.defines[H]);return S.isRawShaderMaterial===!1&&(w(L,S),b(L,S),L.push(s.outputColorSpace)),L.push(S.customProgramCacheKey),L.join()}function w(S,L){S.push(L.precision),S.push(L.outputColorSpace),S.push(L.envMapMode),S.push(L.envMapCubeUVHeight),S.push(L.mapUv),S.push(L.alphaMapUv),S.push(L.lightMapUv),S.push(L.aoMapUv),S.push(L.bumpMapUv),S.push(L.normalMapUv),S.push(L.displacementMapUv),S.push(L.emissiveMapUv),S.push(L.metalnessMapUv),S.push(L.roughnessMapUv),S.push(L.anisotropyMapUv),S.push(L.clearcoatMapUv),S.push(L.clearcoatNormalMapUv),S.push(L.clearcoatRoughnessMapUv),S.push(L.iridescenceMapUv),S.push(L.iridescenceThicknessMapUv),S.push(L.sheenColorMapUv),S.push(L.sheenRoughnessMapUv),S.push(L.specularMapUv),S.push(L.specularColorMapUv),S.push(L.specularIntensityMapUv),S.push(L.transmissionMapUv),S.push(L.thicknessMapUv),S.push(L.combine),S.push(L.fogExp2),S.push(L.sizeAttenuation),S.push(L.morphTargetsCount),S.push(L.morphAttributeCount),S.push(L.numDirLights),S.push(L.numPointLights),S.push(L.numSpotLights),S.push(L.numSpotLightMaps),S.push(L.numHemiLights),S.push(L.numRectAreaLights),S.push(L.numDirLightShadows),S.push(L.numPointLightShadows),S.push(L.numSpotLightShadows),S.push(L.numSpotLightShadowsWithMaps),S.push(L.shadowMapType),S.push(L.toneMapping),S.push(L.numClippingPlanes),S.push(L.numClipIntersection),S.push(L.depthPacking)}function b(S,L){a.disableAll(),L.isWebGL2&&a.enable(0),L.supportsVertexTextures&&a.enable(1),L.instancing&&a.enable(2),L.instancingColor&&a.enable(3),L.matcap&&a.enable(4),L.envMap&&a.enable(5),L.normalMapObjectSpace&&a.enable(6),L.normalMapTangentSpace&&a.enable(7),L.clearcoat&&a.enable(8),L.iridescence&&a.enable(9),L.alphaTest&&a.enable(10),L.vertexColors&&a.enable(11),L.vertexAlphas&&a.enable(12),L.vertexUv1s&&a.enable(13),L.vertexUv2s&&a.enable(14),L.vertexUv3s&&a.enable(15),L.vertexTangents&&a.enable(16),L.anisotropy&&a.enable(17),S.push(a.mask),a.disableAll(),L.fog&&a.enable(0),L.useFog&&a.enable(1),L.flatShading&&a.enable(2),L.logarithmicDepthBuffer&&a.enable(3),L.skinning&&a.enable(4),L.morphTargets&&a.enable(5),L.morphNormals&&a.enable(6),L.morphColors&&a.enable(7),L.premultipliedAlpha&&a.enable(8),L.shadowMapEnabled&&a.enable(9),L.useLegacyLights&&a.enable(10),L.doubleSided&&a.enable(11),L.flipSided&&a.enable(12),L.useDepthPacking&&a.enable(13),L.dithering&&a.enable(14),L.transmission&&a.enable(15),L.sheen&&a.enable(16),L.opaque&&a.enable(17),L.pointsUvs&&a.enable(18),S.push(a.mask)}function M(S){const L=g[S.type];let H;if(L){const $=ws[L];H=SS.clone($.uniforms)}else H=S.uniforms;return H}function A(S,L){let H;for(let $=0,B=c.length;$<B;$++){const G=c[$];if(G.cacheKey===L){H=G,++H.usedTimes;break}}return H===void 0&&(H=new a4(s,L,S,r),c.push(H)),H}function T(S){if(--S.usedTimes===0){const L=c.indexOf(S);c[L]=c[c.length-1],c.pop(),S.destroy()}}function P(S){l.remove(S)}function C(){l.dispose()}return{getParameters:_,getProgramCacheKey:v,getUniforms:M,acquireProgram:A,releaseProgram:T,releaseShaderCache:P,programs:c,dispose:C}}function f4(){let s=new WeakMap;function t(r){let o=s.get(r);return o===void 0&&(o={},s.set(r,o)),o}function e(r){s.delete(r)}function n(r,o,a){s.get(r)[o]=a}function i(){s=new WeakMap}return{get:t,remove:e,update:n,dispose:i}}function d4(s,t){return s.groupOrder!==t.groupOrder?s.groupOrder-t.groupOrder:s.renderOrder!==t.renderOrder?s.renderOrder-t.renderOrder:s.material.id!==t.material.id?s.material.id-t.material.id:s.z!==t.z?s.z-t.z:s.id-t.id}function Gb(s,t){return s.groupOrder!==t.groupOrder?s.groupOrder-t.groupOrder:s.renderOrder!==t.renderOrder?s.renderOrder-t.renderOrder:s.z!==t.z?t.z-s.z:s.id-t.id}function qb(){const s=[];let t=0;const e=[],n=[],i=[];function r(){t=0,e.length=0,n.length=0,i.length=0}function o(f,d,m,g,y,_){let v=s[t];return v===void 0?(v={id:f.id,object:f,geometry:d,material:m,groupOrder:g,renderOrder:f.renderOrder,z:y,group:_},s[t]=v):(v.id=f.id,v.object=f,v.geometry=d,v.material=m,v.groupOrder=g,v.renderOrder=f.renderOrder,v.z=y,v.group=_),t++,v}function a(f,d,m,g,y,_){const v=o(f,d,m,g,y,_);m.transmission>0?n.push(v):m.transparent===!0?i.push(v):e.push(v)}function l(f,d,m,g,y,_){const v=o(f,d,m,g,y,_);m.transmission>0?n.unshift(v):m.transparent===!0?i.unshift(v):e.unshift(v)}function c(f,d){e.length>1&&e.sort(f||d4),n.length>1&&n.sort(d||Gb),i.length>1&&i.sort(d||Gb)}function h(){for(let f=t,d=s.length;f<d;f++){const m=s[f];if(m.id===null)break;m.id=null,m.object=null,m.geometry=null,m.material=null,m.group=null}}return{opaque:e,transmissive:n,transparent:i,init:r,push:a,unshift:l,finish:h,sort:c}}function p4(){let s=new WeakMap;function t(n,i){const r=s.get(n);let o;return r===void 0?(o=new qb,s.set(n,[o])):i>=r.length?(o=new qb,r.push(o)):o=r[i],o}function e(){s=new WeakMap}return{get:t,dispose:e}}function m4(){const s={};return{get:function(t){if(s[t.id]!==void 0)return s[t.id];let e;switch(t.type){case"DirectionalLight":e={direction:new N,color:new Vt};break;case"SpotLight":e={position:new N,direction:new N,color:new Vt,distance:0,coneCos:0,penumbraCos:0,decay:0};break;case"PointLight":e={position:new N,color:new Vt,distance:0,decay:0};break;case"HemisphereLight":e={direction:new N,skyColor:new Vt,groundColor:new Vt};break;case"RectAreaLight":e={color:new Vt,position:new N,halfWidth:new N,halfHeight:new N};break}return s[t.id]=e,e}}}function g4(){const s={};return{get:function(t){if(s[t.id]!==void 0)return s[t.id];let e;switch(t.type){case"DirectionalLight":e={shadowBias:0,shadowNormalBias:0,shadowRadius:1,shadowMapSize:new pt};break;case"SpotLight":e={shadowBias:0,shadowNormalBias:0,shadowRadius:1,shadowMapSize:new pt};break;case"PointLight":e={shadowBias:0,shadowNormalBias:0,shadowRadius:1,shadowMapSize:new pt,shadowCameraNear:1,shadowCameraFar:1e3};break}return s[t.id]=e,e}}}let v4=0;function _4(s,t){return(t.castShadow?2:0)-(s.castShadow?2:0)+(t.map?1:0)-(s.map?1:0)}function y4(s,t){const e=new m4,n=g4(),i={version:0,hash:{directionalLength:-1,pointLength:-1,spotLength:-1,rectAreaLength:-1,hemiLength:-1,numDirectionalShadows:-1,numPointShadows:-1,numSpotShadows:-1,numSpotMaps:-1},ambient:[0,0,0],probe:[],directional:[],directionalShadow:[],directionalShadowMap:[],directionalShadowMatrix:[],spot:[],spotLightMap:[],spotShadow:[],spotShadowMap:[],spotLightMatrix:[],rectArea:[],rectAreaLTC1:null,rectAreaLTC2:null,point:[],pointShadow:[],pointShadowMap:[],pointShadowMatrix:[],hemi:[],numSpotLightShadowsWithMaps:0};for(let h=0;h<9;h++)i.probe.push(new N);const r=new N,o=new de,a=new de;function l(h,f){let d=0,m=0,g=0;for(let H=0;H<9;H++)i.probe[H].set(0,0,0);let y=0,_=0,v=0,w=0,b=0,M=0,A=0,T=0,P=0,C=0;h.sort(_4);const S=f===!0?Math.PI:1;for(let H=0,$=h.length;H<$;H++){const B=h[H],G=B.color,I=B.intensity,et=B.distance,Y=B.shadow&&B.shadow.map?B.shadow.map.texture:null;if(B.isAmbientLight)d+=G.r*I*S,m+=G.g*I*S,g+=G.b*I*S;else if(B.isLightProbe)for(let J=0;J<9;J++)i.probe[J].addScaledVector(B.sh.coefficients[J],I);else if(B.isDirectionalLight){const J=e.get(B);if(J.color.copy(B.color).multiplyScalar(B.intensity*S),B.castShadow){const ut=B.shadow,dt=n.get(B);dt.shadowBias=ut.bias,dt.shadowNormalBias=ut.normalBias,dt.shadowRadius=ut.radius,dt.shadowMapSize=ut.mapSize,i.directionalShadow[y]=dt,i.directionalShadowMap[y]=Y,i.directionalShadowMatrix[y]=B.shadow.matrix,M++}i.directional[y]=J,y++}else if(B.isSpotLight){const J=e.get(B);J.position.setFromMatrixPosition(B.matrixWorld),J.color.copy(G).multiplyScalar(I*S),J.distance=et,J.coneCos=Math.cos(B.angle),J.penumbraCos=Math.cos(B.angle*(1-B.penumbra)),J.decay=B.decay,i.spot[v]=J;const ut=B.shadow;if(B.map&&(i.spotLightMap[P]=B.map,P++,ut.updateMatrices(B),B.castShadow&&C++),i.spotLightMatrix[v]=ut.matrix,B.castShadow){const dt=n.get(B);dt.shadowBias=ut.bias,dt.shadowNormalBias=ut.normalBias,dt.shadowRadius=ut.radius,dt.shadowMapSize=ut.mapSize,i.spotShadow[v]=dt,i.spotShadowMap[v]=Y,T++}v++}else if(B.isRectAreaLight){const J=e.get(B);J.color.copy(G).multiplyScalar(I),J.halfWidth.set(B.width*.5,0,0),J.halfHeight.set(0,B.height*.5,0),i.rectArea[w]=J,w++}else if(B.isPointLight){const J=e.get(B);if(J.color.copy(B.color).multiplyScalar(B.intensity*S),J.distance=B.distance,J.decay=B.decay,B.castShadow){const ut=B.shadow,dt=n.get(B);dt.shadowBias=ut.bias,dt.shadowNormalBias=ut.normalBias,dt.shadowRadius=ut.radius,dt.shadowMapSize=ut.mapSize,dt.shadowCameraNear=ut.camera.near,dt.shadowCameraFar=ut.camera.far,i.pointShadow[_]=dt,i.pointShadowMap[_]=Y,i.pointShadowMatrix[_]=B.shadow.matrix,A++}i.point[_]=J,_++}else if(B.isHemisphereLight){const J=e.get(B);J.skyColor.copy(B.color).multiplyScalar(I*S),J.groundColor.copy(B.groundColor).multiplyScalar(I*S),i.hemi[b]=J,b++}}w>0&&(t.isWebGL2||s.has("OES_texture_float_linear")===!0?(i.rectAreaLTC1=Ft.LTC_FLOAT_1,i.rectAreaLTC2=Ft.LTC_FLOAT_2):s.has("OES_texture_half_float_linear")===!0?(i.rectAreaLTC1=Ft.LTC_HALF_1,i.rectAreaLTC2=Ft.LTC_HALF_2):console.error("THREE.WebGLRenderer: Unable to use RectAreaLight. Missing WebGL extensions.")),i.ambient[0]=d,i.ambient[1]=m,i.ambient[2]=g;const L=i.hash;(L.directionalLength!==y||L.pointLength!==_||L.spotLength!==v||L.rectAreaLength!==w||L.hemiLength!==b||L.numDirectionalShadows!==M||L.numPointShadows!==A||L.numSpotShadows!==T||L.numSpotMaps!==P)&&(i.directional.length=y,i.spot.length=v,i.rectArea.length=w,i.point.length=_,i.hemi.length=b,i.directionalShadow.length=M,i.directionalShadowMap.length=M,i.pointShadow.length=A,i.pointShadowMap.length=A,i.spotShadow.length=T,i.spotShadowMap.length=T,i.directionalShadowMatrix.length=M,i.pointShadowMatrix.length=A,i.spotLightMatrix.length=T+P-C,i.spotLightMap.length=P,i.numSpotLightShadowsWithMaps=C,L.directionalLength=y,L.pointLength=_,L.spotLength=v,L.rectAreaLength=w,L.hemiLength=b,L.numDirectionalShadows=M,L.numPointShadows=A,L.numSpotShadows=T,L.numSpotMaps=P,i.version=v4++)}function c(h,f){let d=0,m=0,g=0,y=0,_=0;const v=f.matrixWorldInverse;for(let w=0,b=h.length;w<b;w++){const M=h[w];if(M.isDirectionalLight){const A=i.directional[d];A.direction.setFromMatrixPosition(M.matrixWorld),r.setFromMatrixPosition(M.target.matrixWorld),A.direction.sub(r),A.direction.transformDirection(v),d++}else if(M.isSpotLight){const A=i.spot[g];A.position.setFromMatrixPosition(M.matrixWorld),A.position.applyMatrix4(v),A.direction.setFromMatrixPosition(M.matrixWorld),r.setFromMatrixPosition(M.target.matrixWorld),A.direction.sub(r),A.direction.transformDirection(v),g++}else if(M.isRectAreaLight){const A=i.rectArea[y];A.position.setFromMatrixPosition(M.matrixWorld),A.position.applyMatrix4(v),a.identity(),o.copy(M.matrixWorld),o.premultiply(v),a.extractRotation(o),A.halfWidth.set(M.width*.5,0,0),A.halfHeight.set(0,M.height*.5,0),A.halfWidth.applyMatrix4(a),A.halfHeight.applyMatrix4(a),y++}else if(M.isPointLight){const A=i.point[m];A.position.setFromMatrixPosition(M.matrixWorld),A.position.applyMatrix4(v),m++}else if(M.isHemisphereLight){const A=i.hemi[_];A.direction.setFromMatrixPosition(M.matrixWorld),A.direction.transformDirection(v),_++}}}return{setup:l,setupView:c,state:i}}function Wb(s,t){const e=new y4(s,t),n=[],i=[];function r(){n.length=0,i.length=0}function o(f){n.push(f)}function a(f){i.push(f)}function l(f){e.setup(n,f)}function c(f){e.setupView(n,f)}return{init:r,state:{lightsArray:n,shadowsArray:i,lights:e},setupLights:l,setupLightsView:c,pushLight:o,pushShadow:a}}function x4(s,t){let e=new WeakMap;function n(r,o=0){const a=e.get(r);let l;return a===void 0?(l=new Wb(s,t),e.set(r,[l])):o>=a.length?(l=new Wb(s,t),a.push(l)):l=a[o],l}function i(){e=new WeakMap}return{get:n,dispose:i}}class g_ extends Zn{constructor(t){super(),this.isMeshDepthMaterial=!0,this.type="MeshDepthMaterial",this.depthPacking=iS,this.map=null,this.alphaMap=null,this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.wireframe=!1,this.wireframeLinewidth=1,this.setValues(t)}copy(t){return super.copy(t),this.depthPacking=t.depthPacking,this.map=t.map,this.alphaMap=t.alphaMap,this.displacementMap=t.displacementMap,this.displacementScale=t.displacementScale,this.displacementBias=t.displacementBias,this.wireframe=t.wireframe,this.wireframeLinewidth=t.wireframeLinewidth,this}}class v_ extends Zn{constructor(t){super(),this.isMeshDistanceMaterial=!0,this.type="MeshDistanceMaterial",this.map=null,this.alphaMap=null,this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.setValues(t)}copy(t){return super.copy(t),this.map=t.map,this.alphaMap=t.alphaMap,this.displacementMap=t.displacementMap,this.displacementScale=t.displacementScale,this.displacementBias=t.displacementBias,this}}const b4=`void main() {
	gl_Position = vec4( position, 1.0 );
}`,w4=`uniform sampler2D shadow_pass;
uniform vec2 resolution;
uniform float radius;
#include <packing>
void main() {
	const float samples = float( VSM_SAMPLES );
	float mean = 0.0;
	float squared_mean = 0.0;
	float uvStride = samples <= 1.0 ? 0.0 : 2.0 / ( samples - 1.0 );
	float uvStart = samples <= 1.0 ? 0.0 : - 1.0;
	for ( float i = 0.0; i < samples; i ++ ) {
		float uvOffset = uvStart + i * uvStride;
		#ifdef HORIZONTAL_PASS
			vec2 distribution = unpackRGBATo2Half( texture2D( shadow_pass, ( gl_FragCoord.xy + vec2( uvOffset, 0.0 ) * radius ) / resolution ) );
			mean += distribution.x;
			squared_mean += distribution.y * distribution.y + distribution.x * distribution.x;
		#else
			float depth = unpackRGBAToDepth( texture2D( shadow_pass, ( gl_FragCoord.xy + vec2( 0.0, uvOffset ) * radius ) / resolution ) );
			mean += depth;
			squared_mean += depth * depth;
		#endif
	}
	mean = mean / samples;
	squared_mean = squared_mean / samples;
	float std_dev = sqrt( squared_mean - mean * mean );
	gl_FragColor = pack2HalfToRGBA( vec2( mean, std_dev ) );
}`;function M4(s,t,e){let n=new pd;const i=new pt,r=new pt,o=new Oe,a=new g_({depthPacking:sS}),l=new v_,c={},h=e.maxTextureSize,f={[Mr]:oi,[oi]:Mr,[An]:An},d=new qs({defines:{VSM_SAMPLES:8},uniforms:{shadow_pass:{value:null},resolution:{value:new pt},radius:{value:4}},vertexShader:b4,fragmentShader:w4}),m=d.clone();m.defines.HORIZONTAL_PASS=1;const g=new we;g.setAttribute("position",new ue(new Float32Array([-1,-1,.5,3,-1,.5,-1,3,.5]),3));const y=new Xe(g,d),_=this;this.enabled=!1,this.autoUpdate=!0,this.needsUpdate=!1,this.type=Bv;let v=this.type;this.render=function(A,T,P){if(_.enabled===!1||_.autoUpdate===!1&&_.needsUpdate===!1||A.length===0)return;const C=s.getRenderTarget(),S=s.getActiveCubeFace(),L=s.getActiveMipmapLevel(),H=s.state;H.setBlending(yr),H.buffers.color.setClear(1,1,1,1),H.buffers.depth.setTest(!0),H.setScissorTest(!1);const $=v!==ks&&this.type===ks,B=v===ks&&this.type!==ks;for(let G=0,I=A.length;G<I;G++){const et=A[G],Y=et.shadow;if(Y===void 0){console.warn("THREE.WebGLShadowMap:",et,"has no shadow.");continue}if(Y.autoUpdate===!1&&Y.needsUpdate===!1)continue;i.copy(Y.mapSize);const J=Y.getFrameExtents();if(i.multiply(J),r.copy(Y.mapSize),(i.x>h||i.y>h)&&(i.x>h&&(r.x=Math.floor(h/J.x),i.x=r.x*J.x,Y.mapSize.x=r.x),i.y>h&&(r.y=Math.floor(h/J.y),i.y=r.y*J.y,Y.mapSize.y=r.y)),Y.map===null||$===!0||B===!0){const dt=this.type!==ks?{minFilter:Ve,magFilter:Ve}:{};Y.map!==null&&Y.map.dispose(),Y.map=new Wi(i.x,i.y,dt),Y.map.texture.name=et.name+".shadowMap",Y.camera.updateProjectionMatrix()}s.setRenderTarget(Y.map),s.clear();const ut=Y.getViewportCount();for(let dt=0;dt<ut;dt++){const nt=Y.getViewport(dt);o.set(r.x*nt.x,r.y*nt.y,r.x*nt.z,r.y*nt.w),H.viewport(o),Y.updateMatrices(et,dt),n=Y.getFrustum(),M(T,P,Y.camera,et,this.type)}Y.isPointLightShadow!==!0&&this.type===ks&&w(Y,P),Y.needsUpdate=!1}v=this.type,_.needsUpdate=!1,s.setRenderTarget(C,S,L)};function w(A,T){const P=t.update(y);d.defines.VSM_SAMPLES!==A.blurSamples&&(d.defines.VSM_SAMPLES=A.blurSamples,m.defines.VSM_SAMPLES=A.blurSamples,d.needsUpdate=!0,m.needsUpdate=!0),A.mapPass===null&&(A.mapPass=new Wi(i.x,i.y)),d.uniforms.shadow_pass.value=A.map.texture,d.uniforms.resolution.value=A.mapSize,d.uniforms.radius.value=A.radius,s.setRenderTarget(A.mapPass),s.clear(),s.renderBufferDirect(T,null,P,d,y,null),m.uniforms.shadow_pass.value=A.mapPass.texture,m.uniforms.resolution.value=A.mapSize,m.uniforms.radius.value=A.radius,s.setRenderTarget(A.map),s.clear(),s.renderBufferDirect(T,null,P,m,y,null)}function b(A,T,P,C){let S=null;const L=P.isPointLight===!0?A.customDistanceMaterial:A.customDepthMaterial;if(L!==void 0)S=L;else if(S=P.isPointLight===!0?l:a,s.localClippingEnabled&&T.clipShadows===!0&&Array.isArray(T.clippingPlanes)&&T.clippingPlanes.length!==0||T.displacementMap&&T.displacementScale!==0||T.alphaMap&&T.alphaTest>0||T.map&&T.alphaTest>0){const H=S.uuid,$=T.uuid;let B=c[H];B===void 0&&(B={},c[H]=B);let G=B[$];G===void 0&&(G=S.clone(),B[$]=G),S=G}if(S.visible=T.visible,S.wireframe=T.wireframe,C===ks?S.side=T.shadowSide!==null?T.shadowSide:T.side:S.side=T.shadowSide!==null?T.shadowSide:f[T.side],S.alphaMap=T.alphaMap,S.alphaTest=T.alphaTest,S.map=T.map,S.clipShadows=T.clipShadows,S.clippingPlanes=T.clippingPlanes,S.clipIntersection=T.clipIntersection,S.displacementMap=T.displacementMap,S.displacementScale=T.displacementScale,S.displacementBias=T.displacementBias,S.wireframeLinewidth=T.wireframeLinewidth,S.linewidth=T.linewidth,P.isPointLight===!0&&S.isMeshDistanceMaterial===!0){const H=s.properties.get(S);H.light=P}return S}function M(A,T,P,C,S){if(A.visible===!1)return;if(A.layers.test(T.layers)&&(A.isMesh||A.isLine||A.isPoints)&&(A.castShadow||A.receiveShadow&&S===ks)&&(!A.frustumCulled||n.intersectsObject(A))){A.modelViewMatrix.multiplyMatrices(P.matrixWorldInverse,A.matrixWorld);const $=t.update(A),B=A.material;if(Array.isArray(B)){const G=$.groups;for(let I=0,et=G.length;I<et;I++){const Y=G[I],J=B[Y.materialIndex];if(J&&J.visible){const ut=b(A,J,C,S);s.renderBufferDirect(P,null,$,ut,A,Y)}}}else if(B.visible){const G=b(A,B,C,S);s.renderBufferDirect(P,null,$,G,A,null)}}const H=A.children;for(let $=0,B=H.length;$<B;$++)M(H[$],T,P,C,S)}}function S4(s,t,e){const n=e.isWebGL2;function i(){let Z=!1;const Rt=new Oe;let at=null;const Pt=new Oe(0,0,0,0);return{setMask:function(Nt){at!==Nt&&!Z&&(s.colorMask(Nt,Nt,Nt,Nt),at=Nt)},setLocked:function(Nt){Z=Nt},setClear:function(Nt,ye,Be,Qe,Ti){Ti===!0&&(Nt*=Qe,ye*=Qe,Be*=Qe),Rt.set(Nt,ye,Be,Qe),Pt.equals(Rt)===!1&&(s.clearColor(Nt,ye,Be,Qe),Pt.copy(Rt))},reset:function(){Z=!1,at=null,Pt.set(-1,0,0,0)}}}function r(){let Z=!1,Rt=null,at=null,Pt=null;return{setTest:function(Nt){Nt?Ht(s.DEPTH_TEST):qt(s.DEPTH_TEST)},setMask:function(Nt){Rt!==Nt&&!Z&&(s.depthMask(Nt),Rt=Nt)},setFunc:function(Nt){if(at!==Nt){switch(Nt){case UM:s.depthFunc(s.NEVER);break;case NM:s.depthFunc(s.ALWAYS);break;case FM:s.depthFunc(s.LESS);break;case Nf:s.depthFunc(s.LEQUAL);break;case BM:s.depthFunc(s.EQUAL);break;case HM:s.depthFunc(s.GEQUAL);break;case VM:s.depthFunc(s.GREATER);break;case GM:s.depthFunc(s.NOTEQUAL);break;default:s.depthFunc(s.LEQUAL)}at=Nt}},setLocked:function(Nt){Z=Nt},setClear:function(Nt){Pt!==Nt&&(s.clearDepth(Nt),Pt=Nt)},reset:function(){Z=!1,Rt=null,at=null,Pt=null}}}function o(){let Z=!1,Rt=null,at=null,Pt=null,Nt=null,ye=null,Be=null,Qe=null,Ti=null;return{setTest:function(Ze){Z||(Ze?Ht(s.STENCIL_TEST):qt(s.STENCIL_TEST))},setMask:function(Ze){Rt!==Ze&&!Z&&(s.stencilMask(Ze),Rt=Ze)},setFunc:function(Ze,Yi,Zi){(at!==Ze||Pt!==Yi||Nt!==Zi)&&(s.stencilFunc(Ze,Yi,Zi),at=Ze,Pt=Yi,Nt=Zi)},setOp:function(Ze,Yi,Zi){(ye!==Ze||Be!==Yi||Qe!==Zi)&&(s.stencilOp(Ze,Yi,Zi),ye=Ze,Be=Yi,Qe=Zi)},setLocked:function(Ze){Z=Ze},setClear:function(Ze){Ti!==Ze&&(s.clearStencil(Ze),Ti=Ze)},reset:function(){Z=!1,Rt=null,at=null,Pt=null,Nt=null,ye=null,Be=null,Qe=null,Ti=null}}}const a=new i,l=new r,c=new o,h=new WeakMap,f=new WeakMap;let d={},m={},g=new WeakMap,y=[],_=null,v=!1,w=null,b=null,M=null,A=null,T=null,P=null,C=null,S=!1,L=null,H=null,$=null,B=null,G=null;const I=s.getParameter(s.MAX_COMBINED_TEXTURE_IMAGE_UNITS);let et=!1,Y=0;const J=s.getParameter(s.VERSION);J.indexOf("WebGL")!==-1?(Y=parseFloat(/^WebGL (\d)/.exec(J)[1]),et=Y>=1):J.indexOf("OpenGL ES")!==-1&&(Y=parseFloat(/^OpenGL ES (\d)/.exec(J)[1]),et=Y>=2);let ut=null,dt={};const nt=s.getParameter(s.SCISSOR_BOX),ft=s.getParameter(s.VIEWPORT),Lt=new Oe().fromArray(nt),Ot=new Oe().fromArray(ft);function It(Z,Rt,at,Pt){const Nt=new Uint8Array(4),ye=s.createTexture();s.bindTexture(Z,ye),s.texParameteri(Z,s.TEXTURE_MIN_FILTER,s.NEAREST),s.texParameteri(Z,s.TEXTURE_MAG_FILTER,s.NEAREST);for(let Be=0;Be<at;Be++)n&&(Z===s.TEXTURE_3D||Z===s.TEXTURE_2D_ARRAY)?s.texImage3D(Rt,0,s.RGBA,1,1,Pt,0,s.RGBA,s.UNSIGNED_BYTE,Nt):s.texImage2D(Rt+Be,0,s.RGBA,1,1,0,s.RGBA,s.UNSIGNED_BYTE,Nt);return ye}const Kt={};Kt[s.TEXTURE_2D]=It(s.TEXTURE_2D,s.TEXTURE_2D,1),Kt[s.TEXTURE_CUBE_MAP]=It(s.TEXTURE_CUBE_MAP,s.TEXTURE_CUBE_MAP_POSITIVE_X,6),n&&(Kt[s.TEXTURE_2D_ARRAY]=It(s.TEXTURE_2D_ARRAY,s.TEXTURE_2D_ARRAY,1,1),Kt[s.TEXTURE_3D]=It(s.TEXTURE_3D,s.TEXTURE_3D,1,1)),a.setClear(0,0,0,1),l.setClear(1),c.setClear(0),Ht(s.DEPTH_TEST),l.setFunc(Nf),st(!1),ct(Eg),Ht(s.CULL_FACE),bt(yr);function Ht(Z){d[Z]!==!0&&(s.enable(Z),d[Z]=!0)}function qt(Z){d[Z]!==!1&&(s.disable(Z),d[Z]=!1)}function ee(Z,Rt){return m[Z]!==Rt?(s.bindFramebuffer(Z,Rt),m[Z]=Rt,n&&(Z===s.DRAW_FRAMEBUFFER&&(m[s.FRAMEBUFFER]=Rt),Z===s.FRAMEBUFFER&&(m[s.DRAW_FRAMEBUFFER]=Rt)),!0):!1}function le(Z,Rt){let at=y,Pt=!1;if(Z)if(at=g.get(Rt),at===void 0&&(at=[],g.set(Rt,at)),Z.isWebGLMultipleRenderTargets){const Nt=Z.texture;if(at.length!==Nt.length||at[0]!==s.COLOR_ATTACHMENT0){for(let ye=0,Be=Nt.length;ye<Be;ye++)at[ye]=s.COLOR_ATTACHMENT0+ye;at.length=Nt.length,Pt=!0}}else at[0]!==s.COLOR_ATTACHMENT0&&(at[0]=s.COLOR_ATTACHMENT0,Pt=!0);else at[0]!==s.BACK&&(at[0]=s.BACK,Pt=!0);Pt&&(e.isWebGL2?s.drawBuffers(at):t.get("WEBGL_draw_buffers").drawBuffersWEBGL(at))}function $t(Z){return _!==Z?(s.useProgram(Z),_=Z,!0):!1}const Mt={[$r]:s.FUNC_ADD,[Hv]:s.FUNC_SUBTRACT,[Vv]:s.FUNC_REVERSE_SUBTRACT};if(n)Mt[Rg]=s.MIN,Mt[Lg]=s.MAX;else{const Z=t.get("EXT_blend_minmax");Z!==null&&(Mt[Rg]=Z.MIN_EXT,Mt[Lg]=Z.MAX_EXT)}const X={[Gv]:s.ZERO,[qv]:s.ONE,[Wv]:s.SRC_COLOR,[rd]:s.SRC_ALPHA,[Kv]:s.SRC_ALPHA_SATURATE,[Yv]:s.DST_COLOR,[Xv]:s.DST_ALPHA,[$v]:s.ONE_MINUS_SRC_COLOR,[od]:s.ONE_MINUS_SRC_ALPHA,[Zv]:s.ONE_MINUS_DST_COLOR,[jv]:s.ONE_MINUS_DST_ALPHA};function bt(Z,Rt,at,Pt,Nt,ye,Be,Qe){if(Z===yr){v===!0&&(qt(s.BLEND),v=!1);return}if(v===!1&&(Ht(s.BLEND),v=!0),Z!==kM){if(Z!==w||Qe!==S){if((b!==$r||T!==$r)&&(s.blendEquation(s.FUNC_ADD),b=$r,T=$r),Qe)switch(Z){case Yr:s.blendFuncSeparate(s.ONE,s.ONE_MINUS_SRC_ALPHA,s.ONE,s.ONE_MINUS_SRC_ALPHA);break;case Tg:s.blendFunc(s.ONE,s.ONE);break;case Cg:s.blendFuncSeparate(s.ZERO,s.ONE_MINUS_SRC_COLOR,s.ZERO,s.ONE);break;case Pg:s.blendFuncSeparate(s.ZERO,s.SRC_COLOR,s.ZERO,s.SRC_ALPHA);break;default:console.error("THREE.WebGLState: Invalid blending: ",Z);break}else switch(Z){case Yr:s.blendFuncSeparate(s.SRC_ALPHA,s.ONE_MINUS_SRC_ALPHA,s.ONE,s.ONE_MINUS_SRC_ALPHA);break;case Tg:s.blendFunc(s.SRC_ALPHA,s.ONE);break;case Cg:s.blendFuncSeparate(s.ZERO,s.ONE_MINUS_SRC_COLOR,s.ZERO,s.ONE);break;case Pg:s.blendFunc(s.ZERO,s.SRC_COLOR);break;default:console.error("THREE.WebGLState: Invalid blending: ",Z);break}M=null,A=null,P=null,C=null,w=Z,S=Qe}return}Nt=Nt||Rt,ye=ye||at,Be=Be||Pt,(Rt!==b||Nt!==T)&&(s.blendEquationSeparate(Mt[Rt],Mt[Nt]),b=Rt,T=Nt),(at!==M||Pt!==A||ye!==P||Be!==C)&&(s.blendFuncSeparate(X[at],X[Pt],X[ye],X[Be]),M=at,A=Pt,P=ye,C=Be),w=Z,S=!1}function W(Z,Rt){Z.side===An?qt(s.CULL_FACE):Ht(s.CULL_FACE);let at=Z.side===oi;Rt&&(at=!at),st(at),Z.blending===Yr&&Z.transparent===!1?bt(yr):bt(Z.blending,Z.blendEquation,Z.blendSrc,Z.blendDst,Z.blendEquationAlpha,Z.blendSrcAlpha,Z.blendDstAlpha,Z.premultipliedAlpha),l.setFunc(Z.depthFunc),l.setTest(Z.depthTest),l.setMask(Z.depthWrite),a.setMask(Z.colorWrite);const Pt=Z.stencilWrite;c.setTest(Pt),Pt&&(c.setMask(Z.stencilWriteMask),c.setFunc(Z.stencilFunc,Z.stencilRef,Z.stencilFuncMask),c.setOp(Z.stencilFail,Z.stencilZFail,Z.stencilZPass)),wt(Z.polygonOffset,Z.polygonOffsetFactor,Z.polygonOffsetUnits),Z.alphaToCoverage===!0?Ht(s.SAMPLE_ALPHA_TO_COVERAGE):qt(s.SAMPLE_ALPHA_TO_COVERAGE)}function st(Z){L!==Z&&(Z?s.frontFace(s.CW):s.frontFace(s.CCW),L=Z)}function ct(Z){Z!==OM?(Ht(s.CULL_FACE),Z!==H&&(Z===Eg?s.cullFace(s.BACK):Z===zM?s.cullFace(s.FRONT):s.cullFace(s.FRONT_AND_BACK))):qt(s.CULL_FACE),H=Z}function Ct(Z){Z!==$&&(et&&s.lineWidth(Z),$=Z)}function wt(Z,Rt,at){Z?(Ht(s.POLYGON_OFFSET_FILL),(B!==Rt||G!==at)&&(s.polygonOffset(Rt,at),B=Rt,G=at)):qt(s.POLYGON_OFFSET_FILL)}function Tt(Z){Z?Ht(s.SCISSOR_TEST):qt(s.SCISSOR_TEST)}function Xt(Z){Z===void 0&&(Z=s.TEXTURE0+I-1),ut!==Z&&(s.activeTexture(Z),ut=Z)}function Qt(Z,Rt,at){at===void 0&&(ut===null?at=s.TEXTURE0+I-1:at=ut);let Pt=dt[at];Pt===void 0&&(Pt={type:void 0,texture:void 0},dt[at]=Pt),(Pt.type!==Z||Pt.texture!==Rt)&&(ut!==at&&(s.activeTexture(at),ut=at),s.bindTexture(Z,Rt||Kt[Z]),Pt.type=Z,Pt.texture=Rt)}function U(){const Z=dt[ut];Z!==void 0&&Z.type!==void 0&&(s.bindTexture(Z.type,null),Z.type=void 0,Z.texture=void 0)}function k(){try{s.compressedTexImage2D.apply(s,arguments)}catch(Z){console.error("THREE.WebGLState:",Z)}}function ht(){try{s.compressedTexImage3D.apply(s,arguments)}catch(Z){console.error("THREE.WebGLState:",Z)}}function St(){try{s.texSubImage2D.apply(s,arguments)}catch(Z){console.error("THREE.WebGLState:",Z)}}function Et(){try{s.texSubImage3D.apply(s,arguments)}catch(Z){console.error("THREE.WebGLState:",Z)}}function Dt(){try{s.compressedTexSubImage2D.apply(s,arguments)}catch(Z){console.error("THREE.WebGLState:",Z)}}function Jt(){try{s.compressedTexSubImage3D.apply(s,arguments)}catch(Z){console.error("THREE.WebGLState:",Z)}}function tt(){try{s.texStorage2D.apply(s,arguments)}catch(Z){console.error("THREE.WebGLState:",Z)}}function Q(){try{s.texStorage3D.apply(s,arguments)}catch(Z){console.error("THREE.WebGLState:",Z)}}function V(){try{s.texImage2D.apply(s,arguments)}catch(Z){console.error("THREE.WebGLState:",Z)}}function _t(){try{s.texImage3D.apply(s,arguments)}catch(Z){console.error("THREE.WebGLState:",Z)}}function zt(Z){Lt.equals(Z)===!1&&(s.scissor(Z.x,Z.y,Z.z,Z.w),Lt.copy(Z))}function Ut(Z){Ot.equals(Z)===!1&&(s.viewport(Z.x,Z.y,Z.z,Z.w),Ot.copy(Z))}function kt(Z,Rt){let at=f.get(Rt);at===void 0&&(at=new WeakMap,f.set(Rt,at));let Pt=at.get(Z);Pt===void 0&&(Pt=s.getUniformBlockIndex(Rt,Z.name),at.set(Z,Pt))}function ne(Z,Rt){const Pt=f.get(Rt).get(Z);h.get(Rt)!==Pt&&(s.uniformBlockBinding(Rt,Pt,Z.__bindingPointIndex),h.set(Rt,Pt))}function _e(){s.disable(s.BLEND),s.disable(s.CULL_FACE),s.disable(s.DEPTH_TEST),s.disable(s.POLYGON_OFFSET_FILL),s.disable(s.SCISSOR_TEST),s.disable(s.STENCIL_TEST),s.disable(s.SAMPLE_ALPHA_TO_COVERAGE),s.blendEquation(s.FUNC_ADD),s.blendFunc(s.ONE,s.ZERO),s.blendFuncSeparate(s.ONE,s.ZERO,s.ONE,s.ZERO),s.colorMask(!0,!0,!0,!0),s.clearColor(0,0,0,0),s.depthMask(!0),s.depthFunc(s.LESS),s.clearDepth(1),s.stencilMask(4294967295),s.stencilFunc(s.ALWAYS,0,4294967295),s.stencilOp(s.KEEP,s.KEEP,s.KEEP),s.clearStencil(0),s.cullFace(s.BACK),s.frontFace(s.CCW),s.polygonOffset(0,0),s.activeTexture(s.TEXTURE0),s.bindFramebuffer(s.FRAMEBUFFER,null),n===!0&&(s.bindFramebuffer(s.DRAW_FRAMEBUFFER,null),s.bindFramebuffer(s.READ_FRAMEBUFFER,null)),s.useProgram(null),s.lineWidth(1),s.scissor(0,0,s.canvas.width,s.canvas.height),s.viewport(0,0,s.canvas.width,s.canvas.height),d={},ut=null,dt={},m={},g=new WeakMap,y=[],_=null,v=!1,w=null,b=null,M=null,A=null,T=null,P=null,C=null,S=!1,L=null,H=null,$=null,B=null,G=null,Lt.set(0,0,s.canvas.width,s.canvas.height),Ot.set(0,0,s.canvas.width,s.canvas.height),a.reset(),l.reset(),c.reset()}return{buffers:{color:a,depth:l,stencil:c},enable:Ht,disable:qt,bindFramebuffer:ee,drawBuffers:le,useProgram:$t,setBlending:bt,setMaterial:W,setFlipSided:st,setCullFace:ct,setLineWidth:Ct,setPolygonOffset:wt,setScissorTest:Tt,activeTexture:Xt,bindTexture:Qt,unbindTexture:U,compressedTexImage2D:k,compressedTexImage3D:ht,texImage2D:V,texImage3D:_t,updateUBOMapping:kt,uniformBlockBinding:ne,texStorage2D:tt,texStorage3D:Q,texSubImage2D:St,texSubImage3D:Et,compressedTexSubImage2D:Dt,compressedTexSubImage3D:Jt,scissor:zt,viewport:Ut,reset:_e}}function A4(s,t,e,n,i,r,o){const a=i.isWebGL2,l=i.maxTextures,c=i.maxCubemapSize,h=i.maxTextureSize,f=i.maxSamples,d=t.has("WEBGL_multisampled_render_to_texture")?t.get("WEBGL_multisampled_render_to_texture"):null,m=typeof navigator>"u"?!1:/OculusBrowser/g.test(navigator.userAgent),g=new WeakMap;let y;const _=new WeakMap;let v=!1;try{v=typeof OffscreenCanvas<"u"&&new OffscreenCanvas(1,1).getContext("2d")!==null}catch{}function w(U,k){return v?new OffscreenCanvas(U,k):Zc("canvas")}function b(U,k,ht,St){let Et=1;if((U.width>St||U.height>St)&&(Et=St/Math.max(U.width,U.height)),Et<1||k===!0)if(typeof HTMLImageElement<"u"&&U instanceof HTMLImageElement||typeof HTMLCanvasElement<"u"&&U instanceof HTMLCanvasElement||typeof ImageBitmap<"u"&&U instanceof ImageBitmap){const Dt=k?Hf:Math.floor,Jt=Dt(Et*U.width),tt=Dt(Et*U.height);y===void 0&&(y=w(Jt,tt));const Q=ht?w(Jt,tt):y;return Q.width=Jt,Q.height=tt,Q.getContext("2d").drawImage(U,0,0,Jt,tt),console.warn("THREE.WebGLRenderer: Texture has been resized from ("+U.width+"x"+U.height+") to ("+Jt+"x"+tt+")."),Q}else return"data"in U&&console.warn("THREE.WebGLRenderer: Image in DataTexture is too big ("+U.width+"x"+U.height+")."),U;return U}function M(U){return nv(U.width)&&nv(U.height)}function A(U){return a?!1:U.wrapS!==In||U.wrapT!==In||U.minFilter!==Ve&&U.minFilter!==fn}function T(U,k){return U.generateMipmaps&&k&&U.minFilter!==Ve&&U.minFilter!==fn}function P(U){s.generateMipmap(U)}function C(U,k,ht,St,Et=!1){if(a===!1)return k;if(U!==null){if(s[U]!==void 0)return s[U];console.warn("THREE.WebGLRenderer: Attempt to use non-existing WebGL internal format '"+U+"'")}let Dt=k;return k===s.RED&&(ht===s.FLOAT&&(Dt=s.R32F),ht===s.HALF_FLOAT&&(Dt=s.R16F),ht===s.UNSIGNED_BYTE&&(Dt=s.R8)),k===s.RG&&(ht===s.FLOAT&&(Dt=s.RG32F),ht===s.HALF_FLOAT&&(Dt=s.RG16F),ht===s.UNSIGNED_BYTE&&(Dt=s.RG8)),k===s.RGBA&&(ht===s.FLOAT&&(Dt=s.RGBA32F),ht===s.HALF_FLOAT&&(Dt=s.RGBA16F),ht===s.UNSIGNED_BYTE&&(Dt=St===ve&&Et===!1?s.SRGB8_ALPHA8:s.RGBA8),ht===s.UNSIGNED_SHORT_4_4_4_4&&(Dt=s.RGBA4),ht===s.UNSIGNED_SHORT_5_5_5_1&&(Dt=s.RGB5_A1)),(Dt===s.R16F||Dt===s.R32F||Dt===s.RG16F||Dt===s.RG32F||Dt===s.RGBA16F||Dt===s.RGBA32F)&&t.get("EXT_color_buffer_float"),Dt}function S(U,k,ht){return T(U,ht)===!0||U.isFramebufferTexture&&U.minFilter!==Ve&&U.minFilter!==fn?Math.log2(Math.max(k.width,k.height))+1:U.mipmaps!==void 0&&U.mipmaps.length>0?U.mipmaps.length:U.isCompressedTexture&&Array.isArray(U.image)?k.mipmaps.length:1}function L(U){return U===Ve||U===Ff||U===Oc?s.NEAREST:s.LINEAR}function H(U){const k=U.target;k.removeEventListener("dispose",H),B(k),k.isVideoTexture&&g.delete(k)}function $(U){const k=U.target;k.removeEventListener("dispose",$),I(k)}function B(U){const k=n.get(U);if(k.__webglInit===void 0)return;const ht=U.source,St=_.get(ht);if(St){const Et=St[k.__cacheKey];Et.usedTimes--,Et.usedTimes===0&&G(U),Object.keys(St).length===0&&_.delete(ht)}n.remove(U)}function G(U){const k=n.get(U);s.deleteTexture(k.__webglTexture);const ht=U.source,St=_.get(ht);delete St[k.__cacheKey],o.memory.textures--}function I(U){const k=U.texture,ht=n.get(U),St=n.get(k);if(St.__webglTexture!==void 0&&(s.deleteTexture(St.__webglTexture),o.memory.textures--),U.depthTexture&&U.depthTexture.dispose(),U.isWebGLCubeRenderTarget)for(let Et=0;Et<6;Et++)s.deleteFramebuffer(ht.__webglFramebuffer[Et]),ht.__webglDepthbuffer&&s.deleteRenderbuffer(ht.__webglDepthbuffer[Et]);else{if(s.deleteFramebuffer(ht.__webglFramebuffer),ht.__webglDepthbuffer&&s.deleteRenderbuffer(ht.__webglDepthbuffer),ht.__webglMultisampledFramebuffer&&s.deleteFramebuffer(ht.__webglMultisampledFramebuffer),ht.__webglColorRenderbuffer)for(let Et=0;Et<ht.__webglColorRenderbuffer.length;Et++)ht.__webglColorRenderbuffer[Et]&&s.deleteRenderbuffer(ht.__webglColorRenderbuffer[Et]);ht.__webglDepthRenderbuffer&&s.deleteRenderbuffer(ht.__webglDepthRenderbuffer)}if(U.isWebGLMultipleRenderTargets)for(let Et=0,Dt=k.length;Et<Dt;Et++){const Jt=n.get(k[Et]);Jt.__webglTexture&&(s.deleteTexture(Jt.__webglTexture),o.memory.textures--),n.remove(k[Et])}n.remove(k),n.remove(U)}let et=0;function Y(){et=0}function J(){const U=et;return U>=l&&console.warn("THREE.WebGLTextures: Trying to use "+U+" texture units while this GPU supports only "+l),et+=1,U}function ut(U){const k=[];return k.push(U.wrapS),k.push(U.wrapT),k.push(U.wrapR||0),k.push(U.magFilter),k.push(U.minFilter),k.push(U.anisotropy),k.push(U.internalFormat),k.push(U.format),k.push(U.type),k.push(U.generateMipmaps),k.push(U.premultiplyAlpha),k.push(U.flipY),k.push(U.unpackAlignment),k.push(U.colorSpace),k.join()}function dt(U,k){const ht=n.get(U);if(U.isVideoTexture&&Xt(U),U.isRenderTargetTexture===!1&&U.version>0&&ht.__version!==U.version){const St=U.image;if(St===null)console.warn("THREE.WebGLRenderer: Texture marked for update but no image data found.");else if(St.complete===!1)console.warn("THREE.WebGLRenderer: Texture marked for update but image is incomplete");else{ee(ht,U,k);return}}e.bindTexture(s.TEXTURE_2D,ht.__webglTexture,s.TEXTURE0+k)}function nt(U,k){const ht=n.get(U);if(U.version>0&&ht.__version!==U.version){ee(ht,U,k);return}e.bindTexture(s.TEXTURE_2D_ARRAY,ht.__webglTexture,s.TEXTURE0+k)}function ft(U,k){const ht=n.get(U);if(U.version>0&&ht.__version!==U.version){ee(ht,U,k);return}e.bindTexture(s.TEXTURE_3D,ht.__webglTexture,s.TEXTURE0+k)}function Lt(U,k){const ht=n.get(U);if(U.version>0&&ht.__version!==U.version){le(ht,U,k);return}e.bindTexture(s.TEXTURE_CUBE_MAP,ht.__webglTexture,s.TEXTURE0+k)}const Ot={[vl]:s.REPEAT,[In]:s.CLAMP_TO_EDGE,[_l]:s.MIRRORED_REPEAT},It={[Ve]:s.NEAREST,[Ff]:s.NEAREST_MIPMAP_NEAREST,[Oc]:s.NEAREST_MIPMAP_LINEAR,[fn]:s.LINEAR,[e_]:s.LINEAR_MIPMAP_NEAREST,[so]:s.LINEAR_MIPMAP_LINEAR},Kt={[aS]:s.NEVER,[pS]:s.ALWAYS,[lS]:s.LESS,[uS]:s.LEQUAL,[cS]:s.EQUAL,[dS]:s.GEQUAL,[hS]:s.GREATER,[fS]:s.NOTEQUAL};function Ht(U,k,ht){if(ht?(s.texParameteri(U,s.TEXTURE_WRAP_S,Ot[k.wrapS]),s.texParameteri(U,s.TEXTURE_WRAP_T,Ot[k.wrapT]),(U===s.TEXTURE_3D||U===s.TEXTURE_2D_ARRAY)&&s.texParameteri(U,s.TEXTURE_WRAP_R,Ot[k.wrapR]),s.texParameteri(U,s.TEXTURE_MAG_FILTER,It[k.magFilter]),s.texParameteri(U,s.TEXTURE_MIN_FILTER,It[k.minFilter])):(s.texParameteri(U,s.TEXTURE_WRAP_S,s.CLAMP_TO_EDGE),s.texParameteri(U,s.TEXTURE_WRAP_T,s.CLAMP_TO_EDGE),(U===s.TEXTURE_3D||U===s.TEXTURE_2D_ARRAY)&&s.texParameteri(U,s.TEXTURE_WRAP_R,s.CLAMP_TO_EDGE),(k.wrapS!==In||k.wrapT!==In)&&console.warn("THREE.WebGLRenderer: Texture is not power of two. Texture.wrapS and Texture.wrapT should be set to THREE.ClampToEdgeWrapping."),s.texParameteri(U,s.TEXTURE_MAG_FILTER,L(k.magFilter)),s.texParameteri(U,s.TEXTURE_MIN_FILTER,L(k.minFilter)),k.minFilter!==Ve&&k.minFilter!==fn&&console.warn("THREE.WebGLRenderer: Texture is not power of two. Texture.minFilter should be set to THREE.NearestFilter or THREE.LinearFilter.")),k.compareFunction&&(s.texParameteri(U,s.TEXTURE_COMPARE_MODE,s.COMPARE_REF_TO_TEXTURE),s.texParameteri(U,s.TEXTURE_COMPARE_FUNC,Kt[k.compareFunction])),t.has("EXT_texture_filter_anisotropic")===!0){const St=t.get("EXT_texture_filter_anisotropic");if(k.magFilter===Ve||k.minFilter!==Oc&&k.minFilter!==so||k.type===Cn&&t.has("OES_texture_float_linear")===!1||a===!1&&k.type===yl&&t.has("OES_texture_half_float_linear")===!1)return;(k.anisotropy>1||n.get(k).__currentAnisotropy)&&(s.texParameterf(U,St.TEXTURE_MAX_ANISOTROPY_EXT,Math.min(k.anisotropy,i.getMaxAnisotropy())),n.get(k).__currentAnisotropy=k.anisotropy)}}function qt(U,k){let ht=!1;U.__webglInit===void 0&&(U.__webglInit=!0,k.addEventListener("dispose",H));const St=k.source;let Et=_.get(St);Et===void 0&&(Et={},_.set(St,Et));const Dt=ut(k);if(Dt!==U.__cacheKey){Et[Dt]===void 0&&(Et[Dt]={texture:s.createTexture(),usedTimes:0},o.memory.textures++,ht=!0),Et[Dt].usedTimes++;const Jt=Et[U.__cacheKey];Jt!==void 0&&(Et[U.__cacheKey].usedTimes--,Jt.usedTimes===0&&G(k)),U.__cacheKey=Dt,U.__webglTexture=Et[Dt].texture}return ht}function ee(U,k,ht){let St=s.TEXTURE_2D;(k.isDataArrayTexture||k.isCompressedArrayTexture)&&(St=s.TEXTURE_2D_ARRAY),k.isData3DTexture&&(St=s.TEXTURE_3D);const Et=qt(U,k),Dt=k.source;e.bindTexture(St,U.__webglTexture,s.TEXTURE0+ht);const Jt=n.get(Dt);if(Dt.version!==Jt.__version||Et===!0){e.activeTexture(s.TEXTURE0+ht),s.pixelStorei(s.UNPACK_FLIP_Y_WEBGL,k.flipY),s.pixelStorei(s.UNPACK_PREMULTIPLY_ALPHA_WEBGL,k.premultiplyAlpha),s.pixelStorei(s.UNPACK_ALIGNMENT,k.unpackAlignment),s.pixelStorei(s.UNPACK_COLORSPACE_CONVERSION_WEBGL,s.NONE);const tt=A(k)&&M(k.image)===!1;let Q=b(k.image,tt,!1,h);Q=Qt(k,Q);const V=M(Q)||a,_t=r.convert(k.format,k.colorSpace);let zt=r.convert(k.type),Ut=C(k.internalFormat,_t,zt,k.colorSpace);Ht(St,k,V);let kt;const ne=k.mipmaps,_e=a&&k.isVideoTexture!==!0,Z=Jt.__version===void 0||Et===!0,Rt=S(k,Q,V);if(k.isDepthTexture)Ut=s.DEPTH_COMPONENT,a?k.type===Cn?Ut=s.DEPTH_COMPONENT32F:k.type===ls?Ut=s.DEPTH_COMPONENT24:k.type===Zr?Ut=s.DEPTH24_STENCIL8:Ut=s.DEPTH_COMPONENT16:k.type===Cn&&console.error("WebGLRenderer: Floating point depth texture requires WebGL2."),k.format===Kr&&Ut===s.DEPTH_COMPONENT&&k.type!==aa&&k.type!==ls&&(console.warn("THREE.WebGLRenderer: Use UnsignedShortType or UnsignedIntType for DepthFormat DepthTexture."),k.type=ls,zt=r.convert(k.type)),k.format===Zo&&Ut===s.DEPTH_COMPONENT&&(Ut=s.DEPTH_STENCIL,k.type!==Zr&&(console.warn("THREE.WebGLRenderer: Use UnsignedInt248Type for DepthStencilFormat DepthTexture."),k.type=Zr,zt=r.convert(k.type))),Z&&(_e?e.texStorage2D(s.TEXTURE_2D,1,Ut,Q.width,Q.height):e.texImage2D(s.TEXTURE_2D,0,Ut,Q.width,Q.height,0,_t,zt,null));else if(k.isDataTexture)if(ne.length>0&&V){_e&&Z&&e.texStorage2D(s.TEXTURE_2D,Rt,Ut,ne[0].width,ne[0].height);for(let at=0,Pt=ne.length;at<Pt;at++)kt=ne[at],_e?e.texSubImage2D(s.TEXTURE_2D,at,0,0,kt.width,kt.height,_t,zt,kt.data):e.texImage2D(s.TEXTURE_2D,at,Ut,kt.width,kt.height,0,_t,zt,kt.data);k.generateMipmaps=!1}else _e?(Z&&e.texStorage2D(s.TEXTURE_2D,Rt,Ut,Q.width,Q.height),e.texSubImage2D(s.TEXTURE_2D,0,0,0,Q.width,Q.height,_t,zt,Q.data)):e.texImage2D(s.TEXTURE_2D,0,Ut,Q.width,Q.height,0,_t,zt,Q.data);else if(k.isCompressedTexture)if(k.isCompressedArrayTexture){_e&&Z&&e.texStorage3D(s.TEXTURE_2D_ARRAY,Rt,Ut,ne[0].width,ne[0].height,Q.depth);for(let at=0,Pt=ne.length;at<Pt;at++)kt=ne[at],k.format!==Vn?_t!==null?_e?e.compressedTexSubImage3D(s.TEXTURE_2D_ARRAY,at,0,0,0,kt.width,kt.height,Q.depth,_t,kt.data,0,0):e.compressedTexImage3D(s.TEXTURE_2D_ARRAY,at,Ut,kt.width,kt.height,Q.depth,0,kt.data,0,0):console.warn("THREE.WebGLRenderer: Attempt to load unsupported compressed texture format in .uploadTexture()"):_e?e.texSubImage3D(s.TEXTURE_2D_ARRAY,at,0,0,0,kt.width,kt.height,Q.depth,_t,zt,kt.data):e.texImage3D(s.TEXTURE_2D_ARRAY,at,Ut,kt.width,kt.height,Q.depth,0,_t,zt,kt.data)}else{_e&&Z&&e.texStorage2D(s.TEXTURE_2D,Rt,Ut,ne[0].width,ne[0].height);for(let at=0,Pt=ne.length;at<Pt;at++)kt=ne[at],k.format!==Vn?_t!==null?_e?e.compressedTexSubImage2D(s.TEXTURE_2D,at,0,0,kt.width,kt.height,_t,kt.data):e.compressedTexImage2D(s.TEXTURE_2D,at,Ut,kt.width,kt.height,0,kt.data):console.warn("THREE.WebGLRenderer: Attempt to load unsupported compressed texture format in .uploadTexture()"):_e?e.texSubImage2D(s.TEXTURE_2D,at,0,0,kt.width,kt.height,_t,zt,kt.data):e.texImage2D(s.TEXTURE_2D,at,Ut,kt.width,kt.height,0,_t,zt,kt.data)}else if(k.isDataArrayTexture)_e?(Z&&e.texStorage3D(s.TEXTURE_2D_ARRAY,Rt,Ut,Q.width,Q.height,Q.depth),e.texSubImage3D(s.TEXTURE_2D_ARRAY,0,0,0,0,Q.width,Q.height,Q.depth,_t,zt,Q.data)):e.texImage3D(s.TEXTURE_2D_ARRAY,0,Ut,Q.width,Q.height,Q.depth,0,_t,zt,Q.data);else if(k.isData3DTexture)_e?(Z&&e.texStorage3D(s.TEXTURE_3D,Rt,Ut,Q.width,Q.height,Q.depth),e.texSubImage3D(s.TEXTURE_3D,0,0,0,0,Q.width,Q.height,Q.depth,_t,zt,Q.data)):e.texImage3D(s.TEXTURE_3D,0,Ut,Q.width,Q.height,Q.depth,0,_t,zt,Q.data);else if(k.isFramebufferTexture){if(Z)if(_e)e.texStorage2D(s.TEXTURE_2D,Rt,Ut,Q.width,Q.height);else{let at=Q.width,Pt=Q.height;for(let Nt=0;Nt<Rt;Nt++)e.texImage2D(s.TEXTURE_2D,Nt,Ut,at,Pt,0,_t,zt,null),at>>=1,Pt>>=1}}else if(ne.length>0&&V){_e&&Z&&e.texStorage2D(s.TEXTURE_2D,Rt,Ut,ne[0].width,ne[0].height);for(let at=0,Pt=ne.length;at<Pt;at++)kt=ne[at],_e?e.texSubImage2D(s.TEXTURE_2D,at,0,0,_t,zt,kt):e.texImage2D(s.TEXTURE_2D,at,Ut,_t,zt,kt);k.generateMipmaps=!1}else _e?(Z&&e.texStorage2D(s.TEXTURE_2D,Rt,Ut,Q.width,Q.height),e.texSubImage2D(s.TEXTURE_2D,0,0,0,_t,zt,Q)):e.texImage2D(s.TEXTURE_2D,0,Ut,_t,zt,Q);T(k,V)&&P(St),Jt.__version=Dt.version,k.onUpdate&&k.onUpdate(k)}U.__version=k.version}function le(U,k,ht){if(k.image.length!==6)return;const St=qt(U,k),Et=k.source;e.bindTexture(s.TEXTURE_CUBE_MAP,U.__webglTexture,s.TEXTURE0+ht);const Dt=n.get(Et);if(Et.version!==Dt.__version||St===!0){e.activeTexture(s.TEXTURE0+ht),s.pixelStorei(s.UNPACK_FLIP_Y_WEBGL,k.flipY),s.pixelStorei(s.UNPACK_PREMULTIPLY_ALPHA_WEBGL,k.premultiplyAlpha),s.pixelStorei(s.UNPACK_ALIGNMENT,k.unpackAlignment),s.pixelStorei(s.UNPACK_COLORSPACE_CONVERSION_WEBGL,s.NONE);const Jt=k.isCompressedTexture||k.image[0].isCompressedTexture,tt=k.image[0]&&k.image[0].isDataTexture,Q=[];for(let at=0;at<6;at++)!Jt&&!tt?Q[at]=b(k.image[at],!1,!0,c):Q[at]=tt?k.image[at].image:k.image[at],Q[at]=Qt(k,Q[at]);const V=Q[0],_t=M(V)||a,zt=r.convert(k.format,k.colorSpace),Ut=r.convert(k.type),kt=C(k.internalFormat,zt,Ut,k.colorSpace),ne=a&&k.isVideoTexture!==!0,_e=Dt.__version===void 0||St===!0;let Z=S(k,V,_t);Ht(s.TEXTURE_CUBE_MAP,k,_t);let Rt;if(Jt){ne&&_e&&e.texStorage2D(s.TEXTURE_CUBE_MAP,Z,kt,V.width,V.height);for(let at=0;at<6;at++){Rt=Q[at].mipmaps;for(let Pt=0;Pt<Rt.length;Pt++){const Nt=Rt[Pt];k.format!==Vn?zt!==null?ne?e.compressedTexSubImage2D(s.TEXTURE_CUBE_MAP_POSITIVE_X+at,Pt,0,0,Nt.width,Nt.height,zt,Nt.data):e.compressedTexImage2D(s.TEXTURE_CUBE_MAP_POSITIVE_X+at,Pt,kt,Nt.width,Nt.height,0,Nt.data):console.warn("THREE.WebGLRenderer: Attempt to load unsupported compressed texture format in .setTextureCube()"):ne?e.texSubImage2D(s.TEXTURE_CUBE_MAP_POSITIVE_X+at,Pt,0,0,Nt.width,Nt.height,zt,Ut,Nt.data):e.texImage2D(s.TEXTURE_CUBE_MAP_POSITIVE_X+at,Pt,kt,Nt.width,Nt.height,0,zt,Ut,Nt.data)}}}else{Rt=k.mipmaps,ne&&_e&&(Rt.length>0&&Z++,e.texStorage2D(s.TEXTURE_CUBE_MAP,Z,kt,Q[0].width,Q[0].height));for(let at=0;at<6;at++)if(tt){ne?e.texSubImage2D(s.TEXTURE_CUBE_MAP_POSITIVE_X+at,0,0,0,Q[at].width,Q[at].height,zt,Ut,Q[at].data):e.texImage2D(s.TEXTURE_CUBE_MAP_POSITIVE_X+at,0,kt,Q[at].width,Q[at].height,0,zt,Ut,Q[at].data);for(let Pt=0;Pt<Rt.length;Pt++){const ye=Rt[Pt].image[at].image;ne?e.texSubImage2D(s.TEXTURE_CUBE_MAP_POSITIVE_X+at,Pt+1,0,0,ye.width,ye.height,zt,Ut,ye.data):e.texImage2D(s.TEXTURE_CUBE_MAP_POSITIVE_X+at,Pt+1,kt,ye.width,ye.height,0,zt,Ut,ye.data)}}else{ne?e.texSubImage2D(s.TEXTURE_CUBE_MAP_POSITIVE_X+at,0,0,0,zt,Ut,Q[at]):e.texImage2D(s.TEXTURE_CUBE_MAP_POSITIVE_X+at,0,kt,zt,Ut,Q[at]);for(let Pt=0;Pt<Rt.length;Pt++){const Nt=Rt[Pt];ne?e.texSubImage2D(s.TEXTURE_CUBE_MAP_POSITIVE_X+at,Pt+1,0,0,zt,Ut,Nt.image[at]):e.texImage2D(s.TEXTURE_CUBE_MAP_POSITIVE_X+at,Pt+1,kt,zt,Ut,Nt.image[at])}}}T(k,_t)&&P(s.TEXTURE_CUBE_MAP),Dt.__version=Et.version,k.onUpdate&&k.onUpdate(k)}U.__version=k.version}function $t(U,k,ht,St,Et){const Dt=r.convert(ht.format,ht.colorSpace),Jt=r.convert(ht.type),tt=C(ht.internalFormat,Dt,Jt,ht.colorSpace);n.get(k).__hasExternalTextures||(Et===s.TEXTURE_3D||Et===s.TEXTURE_2D_ARRAY?e.texImage3D(Et,0,tt,k.width,k.height,k.depth,0,Dt,Jt,null):e.texImage2D(Et,0,tt,k.width,k.height,0,Dt,Jt,null)),e.bindFramebuffer(s.FRAMEBUFFER,U),Tt(k)?d.framebufferTexture2DMultisampleEXT(s.FRAMEBUFFER,St,Et,n.get(ht).__webglTexture,0,wt(k)):(Et===s.TEXTURE_2D||Et>=s.TEXTURE_CUBE_MAP_POSITIVE_X&&Et<=s.TEXTURE_CUBE_MAP_NEGATIVE_Z)&&s.framebufferTexture2D(s.FRAMEBUFFER,St,Et,n.get(ht).__webglTexture,0),e.bindFramebuffer(s.FRAMEBUFFER,null)}function Mt(U,k,ht){if(s.bindRenderbuffer(s.RENDERBUFFER,U),k.depthBuffer&&!k.stencilBuffer){let St=s.DEPTH_COMPONENT16;if(ht||Tt(k)){const Et=k.depthTexture;Et&&Et.isDepthTexture&&(Et.type===Cn?St=s.DEPTH_COMPONENT32F:Et.type===ls&&(St=s.DEPTH_COMPONENT24));const Dt=wt(k);Tt(k)?d.renderbufferStorageMultisampleEXT(s.RENDERBUFFER,Dt,St,k.width,k.height):s.renderbufferStorageMultisample(s.RENDERBUFFER,Dt,St,k.width,k.height)}else s.renderbufferStorage(s.RENDERBUFFER,St,k.width,k.height);s.framebufferRenderbuffer(s.FRAMEBUFFER,s.DEPTH_ATTACHMENT,s.RENDERBUFFER,U)}else if(k.depthBuffer&&k.stencilBuffer){const St=wt(k);ht&&Tt(k)===!1?s.renderbufferStorageMultisample(s.RENDERBUFFER,St,s.DEPTH24_STENCIL8,k.width,k.height):Tt(k)?d.renderbufferStorageMultisampleEXT(s.RENDERBUFFER,St,s.DEPTH24_STENCIL8,k.width,k.height):s.renderbufferStorage(s.RENDERBUFFER,s.DEPTH_STENCIL,k.width,k.height),s.framebufferRenderbuffer(s.FRAMEBUFFER,s.DEPTH_STENCIL_ATTACHMENT,s.RENDERBUFFER,U)}else{const St=k.isWebGLMultipleRenderTargets===!0?k.texture:[k.texture];for(let Et=0;Et<St.length;Et++){const Dt=St[Et],Jt=r.convert(Dt.format,Dt.colorSpace),tt=r.convert(Dt.type),Q=C(Dt.internalFormat,Jt,tt,Dt.colorSpace),V=wt(k);ht&&Tt(k)===!1?s.renderbufferStorageMultisample(s.RENDERBUFFER,V,Q,k.width,k.height):Tt(k)?d.renderbufferStorageMultisampleEXT(s.RENDERBUFFER,V,Q,k.width,k.height):s.renderbufferStorage(s.RENDERBUFFER,Q,k.width,k.height)}}s.bindRenderbuffer(s.RENDERBUFFER,null)}function X(U,k){if(k&&k.isWebGLCubeRenderTarget)throw new Error("Depth Texture with cube render targets is not supported");if(e.bindFramebuffer(s.FRAMEBUFFER,U),!(k.depthTexture&&k.depthTexture.isDepthTexture))throw new Error("renderTarget.depthTexture must be an instance of THREE.DepthTexture");(!n.get(k.depthTexture).__webglTexture||k.depthTexture.image.width!==k.width||k.depthTexture.image.height!==k.height)&&(k.depthTexture.image.width=k.width,k.depthTexture.image.height=k.height,k.depthTexture.needsUpdate=!0),dt(k.depthTexture,0);const St=n.get(k.depthTexture).__webglTexture,Et=wt(k);if(k.depthTexture.format===Kr)Tt(k)?d.framebufferTexture2DMultisampleEXT(s.FRAMEBUFFER,s.DEPTH_ATTACHMENT,s.TEXTURE_2D,St,0,Et):s.framebufferTexture2D(s.FRAMEBUFFER,s.DEPTH_ATTACHMENT,s.TEXTURE_2D,St,0);else if(k.depthTexture.format===Zo)Tt(k)?d.framebufferTexture2DMultisampleEXT(s.FRAMEBUFFER,s.DEPTH_STENCIL_ATTACHMENT,s.TEXTURE_2D,St,0,Et):s.framebufferTexture2D(s.FRAMEBUFFER,s.DEPTH_STENCIL_ATTACHMENT,s.TEXTURE_2D,St,0);else throw new Error("Unknown depthTexture format")}function bt(U){const k=n.get(U),ht=U.isWebGLCubeRenderTarget===!0;if(U.depthTexture&&!k.__autoAllocateDepthBuffer){if(ht)throw new Error("target.depthTexture not supported in Cube render targets");X(k.__webglFramebuffer,U)}else if(ht){k.__webglDepthbuffer=[];for(let St=0;St<6;St++)e.bindFramebuffer(s.FRAMEBUFFER,k.__webglFramebuffer[St]),k.__webglDepthbuffer[St]=s.createRenderbuffer(),Mt(k.__webglDepthbuffer[St],U,!1)}else e.bindFramebuffer(s.FRAMEBUFFER,k.__webglFramebuffer),k.__webglDepthbuffer=s.createRenderbuffer(),Mt(k.__webglDepthbuffer,U,!1);e.bindFramebuffer(s.FRAMEBUFFER,null)}function W(U,k,ht){const St=n.get(U);k!==void 0&&$t(St.__webglFramebuffer,U,U.texture,s.COLOR_ATTACHMENT0,s.TEXTURE_2D),ht!==void 0&&bt(U)}function st(U){const k=U.texture,ht=n.get(U),St=n.get(k);U.addEventListener("dispose",$),U.isWebGLMultipleRenderTargets!==!0&&(St.__webglTexture===void 0&&(St.__webglTexture=s.createTexture()),St.__version=k.version,o.memory.textures++);const Et=U.isWebGLCubeRenderTarget===!0,Dt=U.isWebGLMultipleRenderTargets===!0,Jt=M(U)||a;if(Et){ht.__webglFramebuffer=[];for(let tt=0;tt<6;tt++)ht.__webglFramebuffer[tt]=s.createFramebuffer()}else{if(ht.__webglFramebuffer=s.createFramebuffer(),Dt)if(i.drawBuffers){const tt=U.texture;for(let Q=0,V=tt.length;Q<V;Q++){const _t=n.get(tt[Q]);_t.__webglTexture===void 0&&(_t.__webglTexture=s.createTexture(),o.memory.textures++)}}else console.warn("THREE.WebGLRenderer: WebGLMultipleRenderTargets can only be used with WebGL2 or WEBGL_draw_buffers extension.");if(a&&U.samples>0&&Tt(U)===!1){const tt=Dt?k:[k];ht.__webglMultisampledFramebuffer=s.createFramebuffer(),ht.__webglColorRenderbuffer=[],e.bindFramebuffer(s.FRAMEBUFFER,ht.__webglMultisampledFramebuffer);for(let Q=0;Q<tt.length;Q++){const V=tt[Q];ht.__webglColorRenderbuffer[Q]=s.createRenderbuffer(),s.bindRenderbuffer(s.RENDERBUFFER,ht.__webglColorRenderbuffer[Q]);const _t=r.convert(V.format,V.colorSpace),zt=r.convert(V.type),Ut=C(V.internalFormat,_t,zt,V.colorSpace,U.isXRRenderTarget===!0),kt=wt(U);s.renderbufferStorageMultisample(s.RENDERBUFFER,kt,Ut,U.width,U.height),s.framebufferRenderbuffer(s.FRAMEBUFFER,s.COLOR_ATTACHMENT0+Q,s.RENDERBUFFER,ht.__webglColorRenderbuffer[Q])}s.bindRenderbuffer(s.RENDERBUFFER,null),U.depthBuffer&&(ht.__webglDepthRenderbuffer=s.createRenderbuffer(),Mt(ht.__webglDepthRenderbuffer,U,!0)),e.bindFramebuffer(s.FRAMEBUFFER,null)}}if(Et){e.bindTexture(s.TEXTURE_CUBE_MAP,St.__webglTexture),Ht(s.TEXTURE_CUBE_MAP,k,Jt);for(let tt=0;tt<6;tt++)$t(ht.__webglFramebuffer[tt],U,k,s.COLOR_ATTACHMENT0,s.TEXTURE_CUBE_MAP_POSITIVE_X+tt);T(k,Jt)&&P(s.TEXTURE_CUBE_MAP),e.unbindTexture()}else if(Dt){const tt=U.texture;for(let Q=0,V=tt.length;Q<V;Q++){const _t=tt[Q],zt=n.get(_t);e.bindTexture(s.TEXTURE_2D,zt.__webglTexture),Ht(s.TEXTURE_2D,_t,Jt),$t(ht.__webglFramebuffer,U,_t,s.COLOR_ATTACHMENT0+Q,s.TEXTURE_2D),T(_t,Jt)&&P(s.TEXTURE_2D)}e.unbindTexture()}else{let tt=s.TEXTURE_2D;(U.isWebGL3DRenderTarget||U.isWebGLArrayRenderTarget)&&(a?tt=U.isWebGL3DRenderTarget?s.TEXTURE_3D:s.TEXTURE_2D_ARRAY:console.error("THREE.WebGLTextures: THREE.Data3DTexture and THREE.DataArrayTexture only supported with WebGL2.")),e.bindTexture(tt,St.__webglTexture),Ht(tt,k,Jt),$t(ht.__webglFramebuffer,U,k,s.COLOR_ATTACHMENT0,tt),T(k,Jt)&&P(tt),e.unbindTexture()}U.depthBuffer&&bt(U)}function ct(U){const k=M(U)||a,ht=U.isWebGLMultipleRenderTargets===!0?U.texture:[U.texture];for(let St=0,Et=ht.length;St<Et;St++){const Dt=ht[St];if(T(Dt,k)){const Jt=U.isWebGLCubeRenderTarget?s.TEXTURE_CUBE_MAP:s.TEXTURE_2D,tt=n.get(Dt).__webglTexture;e.bindTexture(Jt,tt),P(Jt),e.unbindTexture()}}}function Ct(U){if(a&&U.samples>0&&Tt(U)===!1){const k=U.isWebGLMultipleRenderTargets?U.texture:[U.texture],ht=U.width,St=U.height;let Et=s.COLOR_BUFFER_BIT;const Dt=[],Jt=U.stencilBuffer?s.DEPTH_STENCIL_ATTACHMENT:s.DEPTH_ATTACHMENT,tt=n.get(U),Q=U.isWebGLMultipleRenderTargets===!0;if(Q)for(let V=0;V<k.length;V++)e.bindFramebuffer(s.FRAMEBUFFER,tt.__webglMultisampledFramebuffer),s.framebufferRenderbuffer(s.FRAMEBUFFER,s.COLOR_ATTACHMENT0+V,s.RENDERBUFFER,null),e.bindFramebuffer(s.FRAMEBUFFER,tt.__webglFramebuffer),s.framebufferTexture2D(s.DRAW_FRAMEBUFFER,s.COLOR_ATTACHMENT0+V,s.TEXTURE_2D,null,0);e.bindFramebuffer(s.READ_FRAMEBUFFER,tt.__webglMultisampledFramebuffer),e.bindFramebuffer(s.DRAW_FRAMEBUFFER,tt.__webglFramebuffer);for(let V=0;V<k.length;V++){Dt.push(s.COLOR_ATTACHMENT0+V),U.depthBuffer&&Dt.push(Jt);const _t=tt.__ignoreDepthValues!==void 0?tt.__ignoreDepthValues:!1;if(_t===!1&&(U.depthBuffer&&(Et|=s.DEPTH_BUFFER_BIT),U.stencilBuffer&&(Et|=s.STENCIL_BUFFER_BIT)),Q&&s.framebufferRenderbuffer(s.READ_FRAMEBUFFER,s.COLOR_ATTACHMENT0,s.RENDERBUFFER,tt.__webglColorRenderbuffer[V]),_t===!0&&(s.invalidateFramebuffer(s.READ_FRAMEBUFFER,[Jt]),s.invalidateFramebuffer(s.DRAW_FRAMEBUFFER,[Jt])),Q){const zt=n.get(k[V]).__webglTexture;s.framebufferTexture2D(s.DRAW_FRAMEBUFFER,s.COLOR_ATTACHMENT0,s.TEXTURE_2D,zt,0)}s.blitFramebuffer(0,0,ht,St,0,0,ht,St,Et,s.NEAREST),m&&s.invalidateFramebuffer(s.READ_FRAMEBUFFER,Dt)}if(e.bindFramebuffer(s.READ_FRAMEBUFFER,null),e.bindFramebuffer(s.DRAW_FRAMEBUFFER,null),Q)for(let V=0;V<k.length;V++){e.bindFramebuffer(s.FRAMEBUFFER,tt.__webglMultisampledFramebuffer),s.framebufferRenderbuffer(s.FRAMEBUFFER,s.COLOR_ATTACHMENT0+V,s.RENDERBUFFER,tt.__webglColorRenderbuffer[V]);const _t=n.get(k[V]).__webglTexture;e.bindFramebuffer(s.FRAMEBUFFER,tt.__webglFramebuffer),s.framebufferTexture2D(s.DRAW_FRAMEBUFFER,s.COLOR_ATTACHMENT0+V,s.TEXTURE_2D,_t,0)}e.bindFramebuffer(s.DRAW_FRAMEBUFFER,tt.__webglMultisampledFramebuffer)}}function wt(U){return Math.min(f,U.samples)}function Tt(U){const k=n.get(U);return a&&U.samples>0&&t.has("WEBGL_multisampled_render_to_texture")===!0&&k.__useRenderToTexture!==!1}function Xt(U){const k=o.render.frame;g.get(U)!==k&&(g.set(U,k),U.update())}function Qt(U,k){const ht=U.colorSpace,St=U.format,Et=U.type;return U.isCompressedTexture===!0||U.format===Bf||ht!==Es&&ht!==Jr&&(ht===ve?a===!1?t.has("EXT_sRGB")===!0&&St===Vn?(U.format=Bf,U.minFilter=fn,U.generateMipmaps=!1):k=h_.sRGBToLinear(k):(St!==Vn||Et!==ai)&&console.warn("THREE.WebGLTextures: sRGB encoded textures have to use RGBAFormat and UnsignedByteType."):console.error("THREE.WebGLTextures: Unsupported texture color space:",ht)),k}this.allocateTextureUnit=J,this.resetTextureUnits=Y,this.setTexture2D=dt,this.setTexture2DArray=nt,this.setTexture3D=ft,this.setTextureCube=Lt,this.rebindTextures=W,this.setupRenderTarget=st,this.updateRenderTargetMipmap=ct,this.updateMultisampleRenderTarget=Ct,this.setupDepthRenderbuffer=bt,this.setupFrameBufferTexture=$t,this.useMultisampledRTT=Tt}function DS(s,t,e){const n=e.isWebGL2;function i(r,o=Jr){let a;if(r===ai)return s.UNSIGNED_BYTE;if(r===ad)return s.UNSIGNED_SHORT_4_4_4_4;if(r===ld)return s.UNSIGNED_SHORT_5_5_5_1;if(r===_u)return s.BYTE;if(r===yu)return s.SHORT;if(r===aa)return s.UNSIGNED_SHORT;if(r===Ll)return s.INT;if(r===ls)return s.UNSIGNED_INT;if(r===Cn)return s.FLOAT;if(r===yl)return n?s.HALF_FLOAT:(a=t.get("OES_texture_half_float"),a!==null?a.HALF_FLOAT_OES:null);if(r===s_)return s.ALPHA;if(r===Vn)return s.RGBA;if(r===cd)return s.LUMINANCE;if(r===ud)return s.LUMINANCE_ALPHA;if(r===Kr)return s.DEPTH_COMPONENT;if(r===Zo)return s.DEPTH_STENCIL;if(r===Bf)return a=t.get("EXT_sRGB"),a!==null?a.SRGB_ALPHA_EXT:null;if(r===ZM)return s.RED;if(r===r_)return s.RED_INTEGER;if(r===KM)return s.RG;if(r===o_)return s.RG_INTEGER;if(r===a_)return s.RGBA_INTEGER;if(r===wf||r===Mf||r===Sf||r===Af)if(o===ve)if(a=t.get("WEBGL_compressed_texture_s3tc_srgb"),a!==null){if(r===wf)return a.COMPRESSED_SRGB_S3TC_DXT1_EXT;if(r===Mf)return a.COMPRESSED_SRGB_ALPHA_S3TC_DXT1_EXT;if(r===Sf)return a.COMPRESSED_SRGB_ALPHA_S3TC_DXT3_EXT;if(r===Af)return a.COMPRESSED_SRGB_ALPHA_S3TC_DXT5_EXT}else return null;else if(a=t.get("WEBGL_compressed_texture_s3tc"),a!==null){if(r===wf)return a.COMPRESSED_RGB_S3TC_DXT1_EXT;if(r===Mf)return a.COMPRESSED_RGBA_S3TC_DXT1_EXT;if(r===Sf)return a.COMPRESSED_RGBA_S3TC_DXT3_EXT;if(r===Af)return a.COMPRESSED_RGBA_S3TC_DXT5_EXT}else return null;if(r===Dg||r===Ig||r===Og||r===zg)if(a=t.get("WEBGL_compressed_texture_pvrtc"),a!==null){if(r===Dg)return a.COMPRESSED_RGB_PVRTC_4BPPV1_IMG;if(r===Ig)return a.COMPRESSED_RGB_PVRTC_2BPPV1_IMG;if(r===Og)return a.COMPRESSED_RGBA_PVRTC_4BPPV1_IMG;if(r===zg)return a.COMPRESSED_RGBA_PVRTC_2BPPV1_IMG}else return null;if(r===JM)return a=t.get("WEBGL_compressed_texture_etc1"),a!==null?a.COMPRESSED_RGB_ETC1_WEBGL:null;if(r===kg||r===Ug)if(a=t.get("WEBGL_compressed_texture_etc"),a!==null){if(r===kg)return o===ve?a.COMPRESSED_SRGB8_ETC2:a.COMPRESSED_RGB8_ETC2;if(r===Ug)return o===ve?a.COMPRESSED_SRGB8_ALPHA8_ETC2_EAC:a.COMPRESSED_RGBA8_ETC2_EAC}else return null;if(r===Ng||r===Fg||r===Bg||r===Hg||r===Vg||r===Gg||r===qg||r===Wg||r===$g||r===Xg||r===jg||r===Yg||r===Zg||r===Kg)if(a=t.get("WEBGL_compressed_texture_astc"),a!==null){if(r===Ng)return o===ve?a.COMPRESSED_SRGB8_ALPHA8_ASTC_4x4_KHR:a.COMPRESSED_RGBA_ASTC_4x4_KHR;if(r===Fg)return o===ve?a.COMPRESSED_SRGB8_ALPHA8_ASTC_5x4_KHR:a.COMPRESSED_RGBA_ASTC_5x4_KHR;if(r===Bg)return o===ve?a.COMPRESSED_SRGB8_ALPHA8_ASTC_5x5_KHR:a.COMPRESSED_RGBA_ASTC_5x5_KHR;if(r===Hg)return o===ve?a.COMPRESSED_SRGB8_ALPHA8_ASTC_6x5_KHR:a.COMPRESSED_RGBA_ASTC_6x5_KHR;if(r===Vg)return o===ve?a.COMPRESSED_SRGB8_ALPHA8_ASTC_6x6_KHR:a.COMPRESSED_RGBA_ASTC_6x6_KHR;if(r===Gg)return o===ve?a.COMPRESSED_SRGB8_ALPHA8_ASTC_8x5_KHR:a.COMPRESSED_RGBA_ASTC_8x5_KHR;if(r===qg)return o===ve?a.COMPRESSED_SRGB8_ALPHA8_ASTC_8x6_KHR:a.COMPRESSED_RGBA_ASTC_8x6_KHR;if(r===Wg)return o===ve?a.COMPRESSED_SRGB8_ALPHA8_ASTC_8x8_KHR:a.COMPRESSED_RGBA_ASTC_8x8_KHR;if(r===$g)return o===ve?a.COMPRESSED_SRGB8_ALPHA8_ASTC_10x5_KHR:a.COMPRESSED_RGBA_ASTC_10x5_KHR;if(r===Xg)return o===ve?a.COMPRESSED_SRGB8_ALPHA8_ASTC_10x6_KHR:a.COMPRESSED_RGBA_ASTC_10x6_KHR;if(r===jg)return o===ve?a.COMPRESSED_SRGB8_ALPHA8_ASTC_10x8_KHR:a.COMPRESSED_RGBA_ASTC_10x8_KHR;if(r===Yg)return o===ve?a.COMPRESSED_SRGB8_ALPHA8_ASTC_10x10_KHR:a.COMPRESSED_RGBA_ASTC_10x10_KHR;if(r===Zg)return o===ve?a.COMPRESSED_SRGB8_ALPHA8_ASTC_12x10_KHR:a.COMPRESSED_RGBA_ASTC_12x10_KHR;if(r===Kg)return o===ve?a.COMPRESSED_SRGB8_ALPHA8_ASTC_12x12_KHR:a.COMPRESSED_RGBA_ASTC_12x12_KHR}else return null;if(r===Ef)if(a=t.get("EXT_texture_compression_bptc"),a!==null){if(r===Ef)return o===ve?a.COMPRESSED_SRGB_ALPHA_BPTC_UNORM_EXT:a.COMPRESSED_RGBA_BPTC_UNORM_EXT}else return null;if(r===QM||r===Jg||r===Qg||r===tv)if(a=t.get("EXT_texture_compression_rgtc"),a!==null){if(r===Ef)return a.COMPRESSED_RED_RGTC1_EXT;if(r===Jg)return a.COMPRESSED_SIGNED_RED_RGTC1_EXT;if(r===Qg)return a.COMPRESSED_RED_GREEN_RGTC2_EXT;if(r===tv)return a.COMPRESSED_SIGNED_RED_GREEN_RGTC2_EXT}else return null;return r===Zr?n?s.UNSIGNED_INT_24_8:(a=t.get("WEBGL_depth_texture"),a!==null?a.UNSIGNED_INT_24_8_WEBGL:null):s[r]!==void 0?s[r]:null}return{convert:i}}class IS extends nn{constructor(t=[]){super(),this.isArrayCamera=!0,this.cameras=t}}let al=class extends Ne{constructor(){super(),this.isGroup=!0,this.type="Group"}};const E4={type:"move"};class Ym{constructor(){this._targetRay=null,this._grip=null,this._hand=null}getHandSpace(){return this._hand===null&&(this._hand=new al,this._hand.matrixAutoUpdate=!1,this._hand.visible=!1,this._hand.joints={},this._hand.inputState={pinching:!1}),this._hand}getTargetRaySpace(){return this._targetRay===null&&(this._targetRay=new al,this._targetRay.matrixAutoUpdate=!1,this._targetRay.visible=!1,this._targetRay.hasLinearVelocity=!1,this._targetRay.linearVelocity=new N,this._targetRay.hasAngularVelocity=!1,this._targetRay.angularVelocity=new N),this._targetRay}getGripSpace(){return this._grip===null&&(this._grip=new al,this._grip.matrixAutoUpdate=!1,this._grip.visible=!1,this._grip.hasLinearVelocity=!1,this._grip.linearVelocity=new N,this._grip.hasAngularVelocity=!1,this._grip.angularVelocity=new N),this._grip}dispatchEvent(t){return this._targetRay!==null&&this._targetRay.dispatchEvent(t),this._grip!==null&&this._grip.dispatchEvent(t),this._hand!==null&&this._hand.dispatchEvent(t),this}connect(t){if(t&&t.hand){const e=this._hand;if(e)for(const n of t.hand.values())this._getHandJoint(e,n)}return this.dispatchEvent({type:"connected",data:t}),this}disconnect(t){return this.dispatchEvent({type:"disconnected",data:t}),this._targetRay!==null&&(this._targetRay.visible=!1),this._grip!==null&&(this._grip.visible=!1),this._hand!==null&&(this._hand.visible=!1),this}update(t,e,n){let i=null,r=null,o=null;const a=this._targetRay,l=this._grip,c=this._hand;if(t&&e.session.visibilityState!=="visible-blurred"){if(c&&t.hand){o=!0;for(const y of t.hand.values()){const _=e.getJointPose(y,n),v=this._getHandJoint(c,y);_!==null&&(v.matrix.fromArray(_.transform.matrix),v.matrix.decompose(v.position,v.rotation,v.scale),v.matrixWorldNeedsUpdate=!0,v.jointRadius=_.radius),v.visible=_!==null}const h=c.joints["index-finger-tip"],f=c.joints["thumb-tip"],d=h.position.distanceTo(f.position),m=.02,g=.005;c.inputState.pinching&&d>m+g?(c.inputState.pinching=!1,this.dispatchEvent({type:"pinchend",handedness:t.handedness,target:this})):!c.inputState.pinching&&d<=m-g&&(c.inputState.pinching=!0,this.dispatchEvent({type:"pinchstart",handedness:t.handedness,target:this}))}else l!==null&&t.gripSpace&&(r=e.getPose(t.gripSpace,n),r!==null&&(l.matrix.fromArray(r.transform.matrix),l.matrix.decompose(l.position,l.rotation,l.scale),l.matrixWorldNeedsUpdate=!0,r.linearVelocity?(l.hasLinearVelocity=!0,l.linearVelocity.copy(r.linearVelocity)):l.hasLinearVelocity=!1,r.angularVelocity?(l.hasAngularVelocity=!0,l.angularVelocity.copy(r.angularVelocity)):l.hasAngularVelocity=!1));a!==null&&(i=e.getPose(t.targetRaySpace,n),i===null&&r!==null&&(i=r),i!==null&&(a.matrix.fromArray(i.transform.matrix),a.matrix.decompose(a.position,a.rotation,a.scale),a.matrixWorldNeedsUpdate=!0,i.linearVelocity?(a.hasLinearVelocity=!0,a.linearVelocity.copy(i.linearVelocity)):a.hasLinearVelocity=!1,i.angularVelocity?(a.hasAngularVelocity=!0,a.angularVelocity.copy(i.angularVelocity)):a.hasAngularVelocity=!1,this.dispatchEvent(E4)))}return a!==null&&(a.visible=i!==null),l!==null&&(l.visible=r!==null),c!==null&&(c.visible=o!==null),this}_getHandJoint(t,e){if(t.joints[e.jointName]===void 0){const n=new al;n.matrixAutoUpdate=!1,n.visible=!1,t.joints[e.jointName]=n,t.add(n)}return t.joints[e.jointName]}}class OS extends xn{constructor(t,e,n,i,r,o,a,l,c,h){if(h=h!==void 0?h:Kr,h!==Kr&&h!==Zo)throw new Error("DepthTexture format must be either THREE.DepthFormat or THREE.DepthStencilFormat");n===void 0&&h===Kr&&(n=ls),n===void 0&&h===Zo&&(n=Zr),super(null,i,r,o,a,l,h,n,c),this.isDepthTexture=!0,this.image={width:t,height:e},this.magFilter=a!==void 0?a:Ve,this.minFilter=l!==void 0?l:Ve,this.flipY=!1,this.generateMipmaps=!1,this.compareFunction=null}copy(t){return super.copy(t),this.compareFunction=t.compareFunction,this}toJSON(t){const e=super.toJSON(t);return this.compareFunction!==null&&(e.compareFunction=this.compareFunction),e}}class T4 extends Gi{constructor(t,e){super();const n=this;let i=null,r=1,o=null,a="local-floor",l=1,c=null,h=null,f=null,d=null,m=null,g=null;const y=e.getContextAttributes();let _=null,v=null;const w=[],b=[],M=new nn;M.layers.enable(1),M.viewport=new Oe;const A=new nn;A.layers.enable(2),A.viewport=new Oe;const T=[M,A],P=new IS;P.layers.enable(1),P.layers.enable(2);let C=null,S=null;this.cameraAutoUpdate=!0,this.enabled=!1,this.isPresenting=!1,this.getController=function(nt){let ft=w[nt];return ft===void 0&&(ft=new Ym,w[nt]=ft),ft.getTargetRaySpace()},this.getControllerGrip=function(nt){let ft=w[nt];return ft===void 0&&(ft=new Ym,w[nt]=ft),ft.getGripSpace()},this.getHand=function(nt){let ft=w[nt];return ft===void 0&&(ft=new Ym,w[nt]=ft),ft.getHandSpace()};function L(nt){const ft=b.indexOf(nt.inputSource);if(ft===-1)return;const Lt=w[ft];Lt!==void 0&&(Lt.update(nt.inputSource,nt.frame,c||o),Lt.dispatchEvent({type:nt.type,data:nt.inputSource}))}function H(){i.removeEventListener("select",L),i.removeEventListener("selectstart",L),i.removeEventListener("selectend",L),i.removeEventListener("squeeze",L),i.removeEventListener("squeezestart",L),i.removeEventListener("squeezeend",L),i.removeEventListener("end",H),i.removeEventListener("inputsourceschange",$);for(let nt=0;nt<w.length;nt++){const ft=b[nt];ft!==null&&(b[nt]=null,w[nt].disconnect(ft))}C=null,S=null,t.setRenderTarget(_),m=null,d=null,f=null,i=null,v=null,dt.stop(),n.isPresenting=!1,n.dispatchEvent({type:"sessionend"})}this.setFramebufferScaleFactor=function(nt){r=nt,n.isPresenting===!0&&console.warn("THREE.WebXRManager: Cannot change framebuffer scale while presenting.")},this.setReferenceSpaceType=function(nt){a=nt,n.isPresenting===!0&&console.warn("THREE.WebXRManager: Cannot change reference space type while presenting.")},this.getReferenceSpace=function(){return c||o},this.setReferenceSpace=function(nt){c=nt},this.getBaseLayer=function(){return d!==null?d:m},this.getBinding=function(){return f},this.getFrame=function(){return g},this.getSession=function(){return i},this.setSession=async function(nt){if(i=nt,i!==null){if(_=t.getRenderTarget(),i.addEventListener("select",L),i.addEventListener("selectstart",L),i.addEventListener("selectend",L),i.addEventListener("squeeze",L),i.addEventListener("squeezestart",L),i.addEventListener("squeezeend",L),i.addEventListener("end",H),i.addEventListener("inputsourceschange",$),y.xrCompatible!==!0&&await e.makeXRCompatible(),i.renderState.layers===void 0||t.capabilities.isWebGL2===!1){const ft={antialias:i.renderState.layers===void 0?y.antialias:!0,alpha:!0,depth:y.depth,stencil:y.stencil,framebufferScaleFactor:r};m=new XRWebGLLayer(i,e,ft),i.updateRenderState({baseLayer:m}),v=new Wi(m.framebufferWidth,m.framebufferHeight,{format:Vn,type:ai,colorSpace:t.outputColorSpace,stencilBuffer:y.stencil})}else{let ft=null,Lt=null,Ot=null;y.depth&&(Ot=y.stencil?e.DEPTH24_STENCIL8:e.DEPTH_COMPONENT24,ft=y.stencil?Zo:Kr,Lt=y.stencil?Zr:ls);const It={colorFormat:e.RGBA8,depthFormat:Ot,scaleFactor:r};f=new XRWebGLBinding(i,e),d=f.createProjectionLayer(It),i.updateRenderState({layers:[d]}),v=new Wi(d.textureWidth,d.textureHeight,{format:Vn,type:ai,depthTexture:new OS(d.textureWidth,d.textureHeight,Lt,void 0,void 0,void 0,void 0,void 0,void 0,ft),stencilBuffer:y.stencil,colorSpace:t.outputColorSpace,samples:y.antialias?4:0});const Kt=t.properties.get(v);Kt.__ignoreDepthValues=d.ignoreDepthValues}v.isXRRenderTarget=!0,this.setFoveation(l),c=null,o=await i.requestReferenceSpace(a),dt.setContext(i),dt.start(),n.isPresenting=!0,n.dispatchEvent({type:"sessionstart"})}},this.getEnvironmentBlendMode=function(){if(i!==null)return i.environmentBlendMode};function $(nt){for(let ft=0;ft<nt.removed.length;ft++){const Lt=nt.removed[ft],Ot=b.indexOf(Lt);Ot>=0&&(b[Ot]=null,w[Ot].disconnect(Lt))}for(let ft=0;ft<nt.added.length;ft++){const Lt=nt.added[ft];let Ot=b.indexOf(Lt);if(Ot===-1){for(let Kt=0;Kt<w.length;Kt++)if(Kt>=b.length){b.push(Lt),Ot=Kt;break}else if(b[Kt]===null){b[Kt]=Lt,Ot=Kt;break}if(Ot===-1)break}const It=w[Ot];It&&It.connect(Lt)}}const B=new N,G=new N;function I(nt,ft,Lt){B.setFromMatrixPosition(ft.matrixWorld),G.setFromMatrixPosition(Lt.matrixWorld);const Ot=B.distanceTo(G),It=ft.projectionMatrix.elements,Kt=Lt.projectionMatrix.elements,Ht=It[14]/(It[10]-1),qt=It[14]/(It[10]+1),ee=(It[9]+1)/It[5],le=(It[9]-1)/It[5],$t=(It[8]-1)/It[0],Mt=(Kt[8]+1)/Kt[0],X=Ht*$t,bt=Ht*Mt,W=Ot/(-$t+Mt),st=W*-$t;ft.matrixWorld.decompose(nt.position,nt.quaternion,nt.scale),nt.translateX(st),nt.translateZ(W),nt.matrixWorld.compose(nt.position,nt.quaternion,nt.scale),nt.matrixWorldInverse.copy(nt.matrixWorld).invert();const ct=Ht+W,Ct=qt+W,wt=X-st,Tt=bt+(Ot-st),Xt=ee*qt/Ct*ct,Qt=le*qt/Ct*ct;nt.projectionMatrix.makePerspective(wt,Tt,Xt,Qt,ct,Ct),nt.projectionMatrixInverse.copy(nt.projectionMatrix).invert()}function et(nt,ft){ft===null?nt.matrixWorld.copy(nt.matrix):nt.matrixWorld.multiplyMatrices(ft.matrixWorld,nt.matrix),nt.matrixWorldInverse.copy(nt.matrixWorld).invert()}this.updateCamera=function(nt){if(i===null)return;P.near=A.near=M.near=nt.near,P.far=A.far=M.far=nt.far,(C!==P.near||S!==P.far)&&(i.updateRenderState({depthNear:P.near,depthFar:P.far}),C=P.near,S=P.far);const ft=nt.parent,Lt=P.cameras;et(P,ft);for(let Ot=0;Ot<Lt.length;Ot++)et(Lt[Ot],ft);Lt.length===2?I(P,M,A):P.projectionMatrix.copy(M.projectionMatrix),Y(nt,P,ft)};function Y(nt,ft,Lt){Lt===null?nt.matrix.copy(ft.matrixWorld):(nt.matrix.copy(Lt.matrixWorld),nt.matrix.invert(),nt.matrix.multiply(ft.matrixWorld)),nt.matrix.decompose(nt.position,nt.quaternion,nt.scale),nt.updateMatrixWorld(!0);const Ot=nt.children;for(let It=0,Kt=Ot.length;It<Kt;It++)Ot[It].updateMatrixWorld(!0);nt.projectionMatrix.copy(ft.projectionMatrix),nt.projectionMatrixInverse.copy(ft.projectionMatrixInverse),nt.isPerspectiveCamera&&(nt.fov=xl*2*Math.atan(1/nt.projectionMatrix.elements[5]),nt.zoom=1)}this.getCamera=function(){return P},this.getFoveation=function(){if(!(d===null&&m===null))return l},this.setFoveation=function(nt){l=nt,d!==null&&(d.fixedFoveation=nt),m!==null&&m.fixedFoveation!==void 0&&(m.fixedFoveation=nt)};let J=null;function ut(nt,ft){if(h=ft.getViewerPose(c||o),g=ft,h!==null){const Lt=h.views;m!==null&&(t.setRenderTargetFramebuffer(v,m.framebuffer),t.setRenderTarget(v));let Ot=!1;Lt.length!==P.cameras.length&&(P.cameras.length=0,Ot=!0);for(let It=0;It<Lt.length;It++){const Kt=Lt[It];let Ht=null;if(m!==null)Ht=m.getViewport(Kt);else{const ee=f.getViewSubImage(d,Kt);Ht=ee.viewport,It===0&&(t.setRenderTargetTextures(v,ee.colorTexture,d.ignoreDepthValues?void 0:ee.depthStencilTexture),t.setRenderTarget(v))}let qt=T[It];qt===void 0&&(qt=new nn,qt.layers.enable(It),qt.viewport=new Oe,T[It]=qt),qt.matrix.fromArray(Kt.transform.matrix),qt.matrix.decompose(qt.position,qt.quaternion,qt.scale),qt.projectionMatrix.fromArray(Kt.projectionMatrix),qt.projectionMatrixInverse.copy(qt.projectionMatrix).invert(),qt.viewport.set(Ht.x,Ht.y,Ht.width,Ht.height),It===0&&(P.matrix.copy(qt.matrix),P.matrix.decompose(P.position,P.quaternion,P.scale)),Ot===!0&&P.cameras.push(qt)}}for(let Lt=0;Lt<w.length;Lt++){const Ot=b[Lt],It=w[Lt];Ot!==null&&It!==void 0&&It.update(Ot,ft,c||o)}J&&J(nt,ft),ft.detectedPlanes&&n.dispatchEvent({type:"planesdetected",data:ft}),g=null}const dt=new TS;dt.setAnimationLoop(ut),this.setAnimationLoop=function(nt){J=nt},this.dispose=function(){}}}function C4(s,t){function e(_,v){_.matrixAutoUpdate===!0&&_.updateMatrix(),v.value.copy(_.matrix)}function n(_,v){v.color.getRGB(_.fogColor.value,MS(s)),v.isFog?(_.fogNear.value=v.near,_.fogFar.value=v.far):v.isFogExp2&&(_.fogDensity.value=v.density)}function i(_,v,w,b,M){v.isMeshBasicMaterial||v.isMeshLambertMaterial?r(_,v):v.isMeshToonMaterial?(r(_,v),f(_,v)):v.isMeshPhongMaterial?(r(_,v),h(_,v)):v.isMeshStandardMaterial?(r(_,v),d(_,v),v.isMeshPhysicalMaterial&&m(_,v,M)):v.isMeshMatcapMaterial?(r(_,v),g(_,v)):v.isMeshDepthMaterial?r(_,v):v.isMeshDistanceMaterial?(r(_,v),y(_,v)):v.isMeshNormalMaterial?r(_,v):v.isLineBasicMaterial?(o(_,v),v.isLineDashedMaterial&&a(_,v)):v.isPointsMaterial?l(_,v,w,b):v.isSpriteMaterial?c(_,v):v.isShadowMaterial?(_.color.value.copy(v.color),_.opacity.value=v.opacity):v.isShaderMaterial&&(v.uniformsNeedUpdate=!1)}function r(_,v){_.opacity.value=v.opacity,v.color&&_.diffuse.value.copy(v.color),v.emissive&&_.emissive.value.copy(v.emissive).multiplyScalar(v.emissiveIntensity),v.map&&(_.map.value=v.map,e(v.map,_.mapTransform)),v.alphaMap&&(_.alphaMap.value=v.alphaMap,e(v.alphaMap,_.alphaMapTransform)),v.bumpMap&&(_.bumpMap.value=v.bumpMap,e(v.bumpMap,_.bumpMapTransform),_.bumpScale.value=v.bumpScale,v.side===oi&&(_.bumpScale.value*=-1)),v.normalMap&&(_.normalMap.value=v.normalMap,e(v.normalMap,_.normalMapTransform),_.normalScale.value.copy(v.normalScale),v.side===oi&&_.normalScale.value.negate()),v.displacementMap&&(_.displacementMap.value=v.displacementMap,e(v.displacementMap,_.displacementMapTransform),_.displacementScale.value=v.displacementScale,_.displacementBias.value=v.displacementBias),v.emissiveMap&&(_.emissiveMap.value=v.emissiveMap,e(v.emissiveMap,_.emissiveMapTransform)),v.specularMap&&(_.specularMap.value=v.specularMap,e(v.specularMap,_.specularMapTransform)),v.alphaTest>0&&(_.alphaTest.value=v.alphaTest);const w=t.get(v).envMap;if(w&&(_.envMap.value=w,_.flipEnvMap.value=w.isCubeTexture&&w.isRenderTargetTexture===!1?-1:1,_.reflectivity.value=v.reflectivity,_.ior.value=v.ior,_.refractionRatio.value=v.refractionRatio),v.lightMap){_.lightMap.value=v.lightMap;const b=s._useLegacyLights===!0?Math.PI:1;_.lightMapIntensity.value=v.lightMapIntensity*b,e(v.lightMap,_.lightMapTransform)}v.aoMap&&(_.aoMap.value=v.aoMap,_.aoMapIntensity.value=v.aoMapIntensity,e(v.aoMap,_.aoMapTransform))}function o(_,v){_.diffuse.value.copy(v.color),_.opacity.value=v.opacity,v.map&&(_.map.value=v.map,e(v.map,_.mapTransform))}function a(_,v){_.dashSize.value=v.dashSize,_.totalSize.value=v.dashSize+v.gapSize,_.scale.value=v.scale}function l(_,v,w,b){_.diffuse.value.copy(v.color),_.opacity.value=v.opacity,_.size.value=v.size*w,_.scale.value=b*.5,v.map&&(_.map.value=v.map,e(v.map,_.uvTransform)),v.alphaMap&&(_.alphaMap.value=v.alphaMap,e(v.alphaMap,_.alphaMapTransform)),v.alphaTest>0&&(_.alphaTest.value=v.alphaTest)}function c(_,v){_.diffuse.value.copy(v.color),_.opacity.value=v.opacity,_.rotation.value=v.rotation,v.map&&(_.map.value=v.map,e(v.map,_.mapTransform)),v.alphaMap&&(_.alphaMap.value=v.alphaMap,e(v.alphaMap,_.alphaMapTransform)),v.alphaTest>0&&(_.alphaTest.value=v.alphaTest)}function h(_,v){_.specular.value.copy(v.specular),_.shininess.value=Math.max(v.shininess,1e-4)}function f(_,v){v.gradientMap&&(_.gradientMap.value=v.gradientMap)}function d(_,v){_.metalness.value=v.metalness,v.metalnessMap&&(_.metalnessMap.value=v.metalnessMap,e(v.metalnessMap,_.metalnessMapTransform)),_.roughness.value=v.roughness,v.roughnessMap&&(_.roughnessMap.value=v.roughnessMap,e(v.roughnessMap,_.roughnessMapTransform)),t.get(v).envMap&&(_.envMapIntensity.value=v.envMapIntensity)}function m(_,v,w){_.ior.value=v.ior,v.sheen>0&&(_.sheenColor.value.copy(v.sheenColor).multiplyScalar(v.sheen),_.sheenRoughness.value=v.sheenRoughness,v.sheenColorMap&&(_.sheenColorMap.value=v.sheenColorMap,e(v.sheenColorMap,_.sheenColorMapTransform)),v.sheenRoughnessMap&&(_.sheenRoughnessMap.value=v.sheenRoughnessMap,e(v.sheenRoughnessMap,_.sheenRoughnessMapTransform))),v.clearcoat>0&&(_.clearcoat.value=v.clearcoat,_.clearcoatRoughness.value=v.clearcoatRoughness,v.clearcoatMap&&(_.clearcoatMap.value=v.clearcoatMap,e(v.clearcoatMap,_.clearcoatMapTransform)),v.clearcoatRoughnessMap&&(_.clearcoatRoughnessMap.value=v.clearcoatRoughnessMap,e(v.clearcoatRoughnessMap,_.clearcoatRoughnessMapTransform)),v.clearcoatNormalMap&&(_.clearcoatNormalMap.value=v.clearcoatNormalMap,e(v.clearcoatNormalMap,_.clearcoatNormalMapTransform),_.clearcoatNormalScale.value.copy(v.clearcoatNormalScale),v.side===oi&&_.clearcoatNormalScale.value.negate())),v.iridescence>0&&(_.iridescence.value=v.iridescence,_.iridescenceIOR.value=v.iridescenceIOR,_.iridescenceThicknessMinimum.value=v.iridescenceThicknessRange[0],_.iridescenceThicknessMaximum.value=v.iridescenceThicknessRange[1],v.iridescenceMap&&(_.iridescenceMap.value=v.iridescenceMap,e(v.iridescenceMap,_.iridescenceMapTransform)),v.iridescenceThicknessMap&&(_.iridescenceThicknessMap.value=v.iridescenceThicknessMap,e(v.iridescenceThicknessMap,_.iridescenceThicknessMapTransform))),v.transmission>0&&(_.transmission.value=v.transmission,_.transmissionSamplerMap.value=w.texture,_.transmissionSamplerSize.value.set(w.width,w.height),v.transmissionMap&&(_.transmissionMap.value=v.transmissionMap,e(v.transmissionMap,_.transmissionMapTransform)),_.thickness.value=v.thickness,v.thicknessMap&&(_.thicknessMap.value=v.thicknessMap,e(v.thicknessMap,_.thicknessMapTransform)),_.attenuationDistance.value=v.attenuationDistance,_.attenuationColor.value.copy(v.attenuationColor)),v.anisotropy>0&&(_.anisotropyVector.value.set(v.anisotropy*Math.cos(v.anisotropyRotation),v.anisotropy*Math.sin(v.anisotropyRotation)),v.anisotropyMap&&(_.anisotropyMap.value=v.anisotropyMap,e(v.anisotropyMap,_.anisotropyMapTransform))),_.specularIntensity.value=v.specularIntensity,_.specularColor.value.copy(v.specularColor),v.specularColorMap&&(_.specularColorMap.value=v.specularColorMap,e(v.specularColorMap,_.specularColorMapTransform)),v.specularIntensityMap&&(_.specularIntensityMap.value=v.specularIntensityMap,e(v.specularIntensityMap,_.specularIntensityMapTransform))}function g(_,v){v.matcap&&(_.matcap.value=v.matcap)}function y(_,v){const w=t.get(v).light;_.referencePosition.value.setFromMatrixPosition(w.matrixWorld),_.nearDistance.value=w.shadow.camera.near,_.farDistance.value=w.shadow.camera.far}return{refreshFogUniforms:n,refreshMaterialUniforms:i}}function P4(s,t,e,n){let i={},r={},o=[];const a=e.isWebGL2?s.getParameter(s.MAX_UNIFORM_BUFFER_BINDINGS):0;function l(w,b){const M=b.program;n.uniformBlockBinding(w,M)}function c(w,b){let M=i[w.id];M===void 0&&(g(w),M=h(w),i[w.id]=M,w.addEventListener("dispose",_));const A=b.program;n.updateUBOMapping(w,A);const T=t.render.frame;r[w.id]!==T&&(d(w),r[w.id]=T)}function h(w){const b=f();w.__bindingPointIndex=b;const M=s.createBuffer(),A=w.__size,T=w.usage;return s.bindBuffer(s.UNIFORM_BUFFER,M),s.bufferData(s.UNIFORM_BUFFER,A,T),s.bindBuffer(s.UNIFORM_BUFFER,null),s.bindBufferBase(s.UNIFORM_BUFFER,b,M),M}function f(){for(let w=0;w<a;w++)if(o.indexOf(w)===-1)return o.push(w),w;return console.error("THREE.WebGLRenderer: Maximum number of simultaneously usable uniforms groups reached."),0}function d(w){const b=i[w.id],M=w.uniforms,A=w.__cache;s.bindBuffer(s.UNIFORM_BUFFER,b);for(let T=0,P=M.length;T<P;T++){const C=M[T];if(m(C,T,A)===!0){const S=C.__offset,L=Array.isArray(C.value)?C.value:[C.value];let H=0;for(let $=0;$<L.length;$++){const B=L[$],G=y(B);typeof B=="number"?(C.__data[0]=B,s.bufferSubData(s.UNIFORM_BUFFER,S+H,C.__data)):B.isMatrix3?(C.__data[0]=B.elements[0],C.__data[1]=B.elements[1],C.__data[2]=B.elements[2],C.__data[3]=B.elements[0],C.__data[4]=B.elements[3],C.__data[5]=B.elements[4],C.__data[6]=B.elements[5],C.__data[7]=B.elements[0],C.__data[8]=B.elements[6],C.__data[9]=B.elements[7],C.__data[10]=B.elements[8],C.__data[11]=B.elements[0]):(B.toArray(C.__data,H),H+=G.storage/Float32Array.BYTES_PER_ELEMENT)}s.bufferSubData(s.UNIFORM_BUFFER,S,C.__data)}}s.bindBuffer(s.UNIFORM_BUFFER,null)}function m(w,b,M){const A=w.value;if(M[b]===void 0){if(typeof A=="number")M[b]=A;else{const T=Array.isArray(A)?A:[A],P=[];for(let C=0;C<T.length;C++)P.push(T[C].clone());M[b]=P}return!0}else if(typeof A=="number"){if(M[b]!==A)return M[b]=A,!0}else{const T=Array.isArray(M[b])?M[b]:[M[b]],P=Array.isArray(A)?A:[A];for(let C=0;C<T.length;C++){const S=T[C];if(S.equals(P[C])===!1)return S.copy(P[C]),!0}}return!1}function g(w){const b=w.uniforms;let M=0;const A=16;let T=0;for(let P=0,C=b.length;P<C;P++){const S=b[P],L={boundary:0,storage:0},H=Array.isArray(S.value)?S.value:[S.value];for(let $=0,B=H.length;$<B;$++){const G=H[$],I=y(G);L.boundary+=I.boundary,L.storage+=I.storage}if(S.__data=new Float32Array(L.storage/Float32Array.BYTES_PER_ELEMENT),S.__offset=M,P>0){T=M%A;const $=A-T;T!==0&&$-L.boundary<0&&(M+=A-T,S.__offset=M)}M+=L.storage}return T=M%A,T>0&&(M+=A-T),w.__size=M,w.__cache={},this}function y(w){const b={boundary:0,storage:0};return typeof w=="number"?(b.boundary=4,b.storage=4):w.isVector2?(b.boundary=8,b.storage=8):w.isVector3||w.isColor?(b.boundary=16,b.storage=12):w.isVector4?(b.boundary=16,b.storage=16):w.isMatrix3?(b.boundary=48,b.storage=48):w.isMatrix4?(b.boundary=64,b.storage=64):w.isTexture?console.warn("THREE.WebGLRenderer: Texture samplers can not be part of an uniforms group."):console.warn("THREE.WebGLRenderer: Unsupported uniform value type.",w),b}function _(w){const b=w.target;b.removeEventListener("dispose",_);const M=o.indexOf(b.__bindingPointIndex);o.splice(M,1),s.deleteBuffer(i[b.id]),delete i[b.id],delete r[b.id]}function v(){for(const w in i)s.deleteBuffer(i[w]);o=[],i={},r={}}return{bind:l,update:c,dispose:v}}function R4(){const s=Zc("canvas");return s.style.display="block",s}class __{constructor(t={}){const{canvas:e=R4(),context:n=null,depth:i=!0,stencil:r=!0,alpha:o=!1,antialias:a=!1,premultipliedAlpha:l=!0,preserveDrawingBuffer:c=!1,powerPreference:h="default",failIfMajorPerformanceCaveat:f=!1,webgl1:d=!1}=t;this.isWebGLRenderer=!0,d&&(this.isWebGL1Renderer=!0);let m;n!==null?m=n.getContextAttributes().alpha:m=o;const g=new Uint32Array(4),y=new Int32Array(4);let _=null,v=null;const w=[],b=[];this.domElement=e,this.debug={checkShaderErrors:!0,onShaderError:null},this.autoClear=!0,this.autoClearColor=!0,this.autoClearDepth=!0,this.autoClearStencil=!0,this.sortObjects=!0,this.clippingPlanes=[],this.localClippingEnabled=!1,this.outputColorSpace=ve,this._useLegacyLights=!1,this.toneMapping=xr,this.toneMappingExposure=1;const M=this;let A=!1,T=0,P=0,C=null,S=-1,L=null;const H=new Oe,$=new Oe;let B=null;const G=new Vt(0);let I=0,et=e.width,Y=e.height,J=1,ut=null,dt=null;const nt=new Oe(0,0,et,Y),ft=new Oe(0,0,et,Y);let Lt=!1;const Ot=new pd;let It=!1,Kt=!1,Ht=null;const qt=new de,ee=new pt,le=new N,$t={background:null,fog:null,environment:null,overrideMaterial:null,isScene:!0};function Mt(){return C===null?J:1}let X=n;function bt(F,ot){for(let mt=0;mt<F.length;mt++){const rt=F[mt],vt=e.getContext(rt,ot);if(vt!==null)return vt}return null}try{const F={alpha:!0,depth:i,stencil:r,antialias:a,premultipliedAlpha:l,preserveDrawingBuffer:c,powerPreference:h,failIfMajorPerformanceCaveat:f};if("setAttribute"in e&&e.setAttribute("data-engine",`three.js r${id}`),e.addEventListener("webglcontextlost",at,!1),e.addEventListener("webglcontextrestored",Pt,!1),e.addEventListener("webglcontextcreationerror",Nt,!1),X===null){const ot=["webgl2","webgl","experimental-webgl"];if(M.isWebGL1Renderer===!0&&ot.shift(),X=bt(ot,F),X===null)throw bt(ot)?new Error("Error creating WebGL context with your selected attributes."):new Error("Error creating WebGL context.")}typeof WebGLRenderingContext<"u"&&X instanceof WebGLRenderingContext&&console.warn("THREE.WebGLRenderer: WebGL 1 support was deprecated in r153 and will be removed in r163."),X.getShaderPrecisionFormat===void 0&&(X.getShaderPrecisionFormat=function(){return{rangeMin:1,rangeMax:1,precision:1}})}catch(F){throw console.error("THREE.WebGLRenderer: "+F.message),F}let W,st,ct,Ct,wt,Tt,Xt,Qt,U,k,ht,St,Et,Dt,Jt,tt,Q,V,_t,zt,Ut,kt,ne,_e;function Z(){W=new WN(X),st=new FN(X,W,t),W.init(st),kt=new DS(X,W,st),ct=new S4(X,W,st),Ct=new jN(X),wt=new f4,Tt=new A4(X,W,ct,wt,st,kt,Ct),Xt=new HN(M),Qt=new qN(M),U=new s3(X,st),ne=new UN(X,W,U,st),k=new $N(X,U,Ct,ne),ht=new JN(X,k,U,Ct),_t=new KN(X,st,Tt),tt=new BN(wt),St=new h4(M,Xt,Qt,W,st,ne,tt),Et=new C4(M,wt),Dt=new p4,Jt=new x4(W,st),V=new kN(M,Xt,Qt,ct,ht,m,l),Q=new M4(M,ht,st),_e=new P4(X,Ct,st,ct),zt=new NN(X,W,Ct,st),Ut=new XN(X,W,Ct,st),Ct.programs=St.programs,M.capabilities=st,M.extensions=W,M.properties=wt,M.renderLists=Dt,M.shadowMap=Q,M.state=ct,M.info=Ct}Z();const Rt=new T4(M,X);this.xr=Rt,this.getContext=function(){return X},this.getContextAttributes=function(){return X.getContextAttributes()},this.forceContextLoss=function(){const F=W.get("WEBGL_lose_context");F&&F.loseContext()},this.forceContextRestore=function(){const F=W.get("WEBGL_lose_context");F&&F.restoreContext()},this.getPixelRatio=function(){return J},this.setPixelRatio=function(F){F!==void 0&&(J=F,this.setSize(et,Y,!1))},this.getSize=function(F){return F.set(et,Y)},this.setSize=function(F,ot,mt=!0){if(Rt.isPresenting){console.warn("THREE.WebGLRenderer: Can't change size while VR device is presenting.");return}et=F,Y=ot,e.width=Math.floor(F*J),e.height=Math.floor(ot*J),mt===!0&&(e.style.width=F+"px",e.style.height=ot+"px"),this.setViewport(0,0,F,ot)},this.getDrawingBufferSize=function(F){return F.set(et*J,Y*J).floor()},this.setDrawingBufferSize=function(F,ot,mt){et=F,Y=ot,J=mt,e.width=Math.floor(F*mt),e.height=Math.floor(ot*mt),this.setViewport(0,0,F,ot)},this.getCurrentViewport=function(F){return F.copy(H)},this.getViewport=function(F){return F.copy(nt)},this.setViewport=function(F,ot,mt,rt){F.isVector4?nt.set(F.x,F.y,F.z,F.w):nt.set(F,ot,mt,rt),ct.viewport(H.copy(nt).multiplyScalar(J).floor())},this.getScissor=function(F){return F.copy(ft)},this.setScissor=function(F,ot,mt,rt){F.isVector4?ft.set(F.x,F.y,F.z,F.w):ft.set(F,ot,mt,rt),ct.scissor($.copy(ft).multiplyScalar(J).floor())},this.getScissorTest=function(){return Lt},this.setScissorTest=function(F){ct.setScissorTest(Lt=F)},this.setOpaqueSort=function(F){ut=F},this.setTransparentSort=function(F){dt=F},this.getClearColor=function(F){return F.copy(V.getClearColor())},this.setClearColor=function(){V.setClearColor.apply(V,arguments)},this.getClearAlpha=function(){return V.getClearAlpha()},this.setClearAlpha=function(){V.setClearAlpha.apply(V,arguments)},this.clear=function(F=!0,ot=!0,mt=!0){let rt=0;if(F){let vt=!1;if(C!==null){const Wt=C.texture.format;vt=Wt===a_||Wt===o_||Wt===r_}if(vt){const Wt=C.texture.type,ie=Wt===ai||Wt===ls||Wt===aa||Wt===Zr||Wt===ad||Wt===ld,re=V.getClearColor(),ce=V.getClearAlpha(),me=re.r,he=re.g,ge=re.b;ie?(g[0]=me,g[1]=he,g[2]=ge,g[3]=ce,X.clearBufferuiv(X.COLOR,0,g)):(y[0]=me,y[1]=he,y[2]=ge,y[3]=ce,X.clearBufferiv(X.COLOR,0,y))}else rt|=X.COLOR_BUFFER_BIT}ot&&(rt|=X.DEPTH_BUFFER_BIT),mt&&(rt|=X.STENCIL_BUFFER_BIT),X.clear(rt)},this.clearColor=function(){this.clear(!0,!1,!1)},this.clearDepth=function(){this.clear(!1,!0,!1)},this.clearStencil=function(){this.clear(!1,!1,!0)},this.dispose=function(){e.removeEventListener("webglcontextlost",at,!1),e.removeEventListener("webglcontextrestored",Pt,!1),e.removeEventListener("webglcontextcreationerror",Nt,!1),Dt.dispose(),Jt.dispose(),wt.dispose(),Xt.dispose(),Qt.dispose(),ht.dispose(),ne.dispose(),_e.dispose(),St.dispose(),Rt.dispose(),Rt.removeEventListener("sessionstart",Yi),Rt.removeEventListener("sessionend",Zi),Ht&&(Ht.dispose(),Ht=null),hs.stop()};function at(F){F.preventDefault(),console.log("THREE.WebGLRenderer: Context Lost."),A=!0}function Pt(){console.log("THREE.WebGLRenderer: Context Restored."),A=!1;const F=Ct.autoReset,ot=Q.enabled,mt=Q.autoUpdate,rt=Q.needsUpdate,vt=Q.type;Z(),Ct.autoReset=F,Q.enabled=ot,Q.autoUpdate=mt,Q.needsUpdate=rt,Q.type=vt}function Nt(F){console.error("THREE.WebGLRenderer: A WebGL context could not be created. Reason: ",F.statusMessage)}function ye(F){const ot=F.target;ot.removeEventListener("dispose",ye),Be(ot)}function Be(F){Qe(F),wt.remove(F)}function Qe(F){const ot=wt.get(F).programs;ot!==void 0&&(ot.forEach(function(mt){St.releaseProgram(mt)}),F.isShaderMaterial&&St.releaseShaderCache(F))}this.renderBufferDirect=function(F,ot,mt,rt,vt,Wt){ot===null&&(ot=$t);const ie=vt.isMesh&&vt.matrixWorld.determinant()<0,re=vp(F,ot,mt,rt,vt);ct.setMaterial(rt,ie);let ce=mt.index,me=1;rt.wireframe===!0&&(ce=k.getWireframeAttribute(mt),me=2);const he=mt.drawRange,ge=mt.attributes.position;let rn=he.start*me,on=(he.start+he.count)*me;Wt!==null&&(rn=Math.max(rn,Wt.start*me),on=Math.min(on,(Wt.start+Wt.count)*me)),ce!==null?(rn=Math.max(rn,0),on=Math.min(on,ce.count)):ge!=null&&(rn=Math.max(rn,0),on=Math.min(on,ge.count));const Jn=on-rn;if(Jn<0||Jn===1/0)return;ne.setup(vt,rt,re,mt,ce);let Ki,pn=zt;if(ce!==null&&(Ki=U.get(ce),pn=Ut,pn.setIndex(Ki)),vt.isMesh)rt.wireframe===!0?(ct.setLineWidth(rt.wireframeLinewidth*Mt()),pn.setMode(X.LINES)):pn.setMode(X.TRIANGLES);else if(vt.isLine){let Pe=rt.linewidth;Pe===void 0&&(Pe=1),ct.setLineWidth(Pe*Mt()),vt.isLineSegments?pn.setMode(X.LINES):vt.isLineLoop?pn.setMode(X.LINE_LOOP):pn.setMode(X.LINE_STRIP)}else vt.isPoints?pn.setMode(X.POINTS):vt.isSprite&&pn.setMode(X.TRIANGLES);if(vt.isInstancedMesh)pn.renderInstances(rn,Jn,vt.count);else if(mt.isInstancedBufferGeometry){const Pe=mt._maxInstanceCount!==void 0?mt._maxInstanceCount:1/0,jl=Math.min(mt.instanceCount,Pe);pn.renderInstances(rn,Jn,jl)}else pn.render(rn,Jn)},this.compile=function(F,ot){function mt(rt,vt,Wt){rt.transparent===!0&&rt.side===An&&rt.forceSinglePass===!1?(rt.side=oi,rt.needsUpdate=!0,xa(rt,vt,Wt),rt.side=Mr,rt.needsUpdate=!0,xa(rt,vt,Wt),rt.side=An):xa(rt,vt,Wt)}v=Jt.get(F),v.init(),b.push(v),F.traverseVisible(function(rt){rt.isLight&&rt.layers.test(ot.layers)&&(v.pushLight(rt),rt.castShadow&&v.pushShadow(rt))}),v.setupLights(M._useLegacyLights),F.traverse(function(rt){const vt=rt.material;if(vt)if(Array.isArray(vt))for(let Wt=0;Wt<vt.length;Wt++){const ie=vt[Wt];mt(ie,F,rt)}else mt(vt,F,rt)}),b.pop(),v=null};let Ti=null;function Ze(F){Ti&&Ti(F)}function Yi(){hs.stop()}function Zi(){hs.start()}const hs=new TS;hs.setAnimationLoop(Ze),typeof self<"u"&&hs.setContext(self),this.setAnimationLoop=function(F){Ti=F,Rt.setAnimationLoop(F),F===null?hs.stop():hs.start()},Rt.addEventListener("sessionstart",Yi),Rt.addEventListener("sessionend",Zi),this.render=function(F,ot){if(ot!==void 0&&ot.isCamera!==!0){console.error("THREE.WebGLRenderer.render: camera is not an instance of THREE.Camera.");return}if(A===!0)return;F.matrixWorldAutoUpdate===!0&&F.updateMatrixWorld(),ot.parent===null&&ot.matrixWorldAutoUpdate===!0&&ot.updateMatrixWorld(),Rt.enabled===!0&&Rt.isPresenting===!0&&(Rt.cameraAutoUpdate===!0&&Rt.updateCamera(ot),ot=Rt.getCamera()),F.isScene===!0&&F.onBeforeRender(M,F,ot,C),v=Jt.get(F,b.length),v.init(),b.push(v),qt.multiplyMatrices(ot.projectionMatrix,ot.matrixWorldInverse),Ot.setFromProjectionMatrix(qt),Kt=this.localClippingEnabled,It=tt.init(this.clippingPlanes,Kt),_=Dt.get(F,w.length),_.init(),w.push(_),zu(F,ot,0,M.sortObjects),_.finish(),M.sortObjects===!0&&_.sort(ut,dt),this.info.render.frame++,It===!0&&tt.beginShadows();const mt=v.state.shadowsArray;if(Q.render(mt,F,ot),It===!0&&tt.endShadows(),this.info.autoReset===!0&&this.info.reset(),V.render(_,F),v.setupLights(M._useLegacyLights),ot.isArrayCamera){const rt=ot.cameras;for(let vt=0,Wt=rt.length;vt<Wt;vt++){const ie=rt[vt];_a(_,F,ie,ie.viewport)}}else _a(_,F,ot);C!==null&&(Tt.updateMultisampleRenderTarget(C),Tt.updateRenderTargetMipmap(C)),F.isScene===!0&&F.onAfterRender(M,F,ot),ne.resetDefaultState(),S=-1,L=null,b.pop(),b.length>0?v=b[b.length-1]:v=null,w.pop(),w.length>0?_=w[w.length-1]:_=null};function zu(F,ot,mt,rt){if(F.visible===!1)return;if(F.layers.test(ot.layers)){if(F.isGroup)mt=F.renderOrder;else if(F.isLOD)F.autoUpdate===!0&&F.update(ot);else if(F.isLight)v.pushLight(F),F.castShadow&&v.pushShadow(F);else if(F.isSprite){if(!F.frustumCulled||Ot.intersectsSprite(F)){rt&&le.setFromMatrixPosition(F.matrixWorld).applyMatrix4(qt);const ie=ht.update(F),re=F.material;re.visible&&_.push(F,ie,re,mt,le.z,null)}}else if((F.isMesh||F.isLine||F.isPoints)&&(!F.frustumCulled||Ot.intersectsObject(F))){const ie=ht.update(F),re=F.material;if(rt&&(F.boundingSphere!==void 0?(F.boundingSphere===null&&F.computeBoundingSphere(),le.copy(F.boundingSphere.center)):(ie.boundingSphere===null&&ie.computeBoundingSphere(),le.copy(ie.boundingSphere.center)),le.applyMatrix4(F.matrixWorld).applyMatrix4(qt)),Array.isArray(re)){const ce=ie.groups;for(let me=0,he=ce.length;me<he;me++){const ge=ce[me],rn=re[ge.materialIndex];rn&&rn.visible&&_.push(F,ie,rn,mt,le.z,ge)}}else re.visible&&_.push(F,ie,re,mt,le.z,null)}}const Wt=F.children;for(let ie=0,re=Wt.length;ie<re;ie++)zu(Wt[ie],ot,mt,rt)}function _a(F,ot,mt,rt){const vt=F.opaque,Wt=F.transmissive,ie=F.transparent;v.setupLightsView(mt),It===!0&&tt.setGlobalState(M.clippingPlanes,mt),Wt.length>0&&gp(vt,Wt,ot,mt),rt&&ct.viewport(H.copy(rt)),vt.length>0&&ya(vt,ot,mt),Wt.length>0&&ya(Wt,ot,mt),ie.length>0&&ya(ie,ot,mt),ct.buffers.depth.setTest(!0),ct.buffers.depth.setMask(!0),ct.buffers.color.setMask(!0),ct.setPolygonOffset(!1)}function gp(F,ot,mt,rt){const vt=st.isWebGL2;Ht===null&&(Ht=new Wi(1,1,{generateMipmaps:!0,type:W.has("EXT_color_buffer_half_float")?yl:ai,minFilter:so,samples:vt?4:0})),M.getDrawingBufferSize(ee),vt?Ht.setSize(ee.x,ee.y):Ht.setSize(Hf(ee.x),Hf(ee.y));const Wt=M.getRenderTarget();M.setRenderTarget(Ht),M.getClearColor(G),I=M.getClearAlpha(),I<1&&M.setClearColor(16777215,.5),M.clear();const ie=M.toneMapping;M.toneMapping=xr,ya(F,mt,rt),Tt.updateMultisampleRenderTarget(Ht),Tt.updateRenderTargetMipmap(Ht);let re=!1;for(let ce=0,me=ot.length;ce<me;ce++){const he=ot[ce],ge=he.object,rn=he.geometry,on=he.material,Jn=he.group;if(on.side===An&&ge.layers.test(rt.layers)){const Ki=on.side;on.side=oi,on.needsUpdate=!0,ku(ge,mt,rt,rn,on,Jn),on.side=Ki,on.needsUpdate=!0,re=!0}}re===!0&&(Tt.updateMultisampleRenderTarget(Ht),Tt.updateRenderTargetMipmap(Ht)),M.setRenderTarget(Wt),M.setClearColor(G,I),M.toneMapping=ie}function ya(F,ot,mt){const rt=ot.isScene===!0?ot.overrideMaterial:null;for(let vt=0,Wt=F.length;vt<Wt;vt++){const ie=F[vt],re=ie.object,ce=ie.geometry,me=rt===null?ie.material:rt,he=ie.group;re.layers.test(mt.layers)&&ku(re,ot,mt,ce,me,he)}}function ku(F,ot,mt,rt,vt,Wt){F.onBeforeRender(M,ot,mt,rt,vt,Wt),F.modelViewMatrix.multiplyMatrices(mt.matrixWorldInverse,F.matrixWorld),F.normalMatrix.getNormalMatrix(F.modelViewMatrix),vt.onBeforeRender(M,ot,mt,rt,F,Wt),vt.transparent===!0&&vt.side===An&&vt.forceSinglePass===!1?(vt.side=oi,vt.needsUpdate=!0,M.renderBufferDirect(mt,ot,rt,vt,F,Wt),vt.side=Mr,vt.needsUpdate=!0,M.renderBufferDirect(mt,ot,rt,vt,F,Wt),vt.side=An):M.renderBufferDirect(mt,ot,rt,vt,F,Wt),F.onAfterRender(M,ot,mt,rt,vt,Wt)}function xa(F,ot,mt){ot.isScene!==!0&&(ot=$t);const rt=wt.get(F),vt=v.state.lights,Wt=v.state.shadowsArray,ie=vt.state.version,re=St.getParameters(F,vt.state,Wt,ot,mt),ce=St.getProgramCacheKey(re);let me=rt.programs;rt.environment=F.isMeshStandardMaterial?ot.environment:null,rt.fog=ot.fog,rt.envMap=(F.isMeshStandardMaterial?Qt:Xt).get(F.envMap||rt.environment),me===void 0&&(F.addEventListener("dispose",ye),me=new Map,rt.programs=me);let he=me.get(ce);if(he!==void 0){if(rt.currentProgram===he&&rt.lightsStateVersion===ie)return Uu(F,re),he}else re.uniforms=St.getUniforms(F),F.onBuild(mt,re,M),F.onBeforeCompile(re,M),he=St.acquireProgram(re,ce),me.set(ce,he),rt.uniforms=re.uniforms;const ge=rt.uniforms;(!F.isShaderMaterial&&!F.isRawShaderMaterial||F.clipping===!0)&&(ge.clippingPlanes=tt.uniform),Uu(F,re),rt.needsLights=yp(F),rt.lightsStateVersion=ie,rt.needsLights&&(ge.ambientLightColor.value=vt.state.ambient,ge.lightProbe.value=vt.state.probe,ge.directionalLights.value=vt.state.directional,ge.directionalLightShadows.value=vt.state.directionalShadow,ge.spotLights.value=vt.state.spot,ge.spotLightShadows.value=vt.state.spotShadow,ge.rectAreaLights.value=vt.state.rectArea,ge.ltc_1.value=vt.state.rectAreaLTC1,ge.ltc_2.value=vt.state.rectAreaLTC2,ge.pointLights.value=vt.state.point,ge.pointLightShadows.value=vt.state.pointShadow,ge.hemisphereLights.value=vt.state.hemi,ge.directionalShadowMap.value=vt.state.directionalShadowMap,ge.directionalShadowMatrix.value=vt.state.directionalShadowMatrix,ge.spotShadowMap.value=vt.state.spotShadowMap,ge.spotLightMatrix.value=vt.state.spotLightMatrix,ge.spotLightMap.value=vt.state.spotLightMap,ge.pointShadowMap.value=vt.state.pointShadowMap,ge.pointShadowMatrix.value=vt.state.pointShadowMatrix);const rn=he.getUniforms(),on=Pf.seqWithValue(rn.seq,ge);return rt.currentProgram=he,rt.uniformsList=on,he}function Uu(F,ot){const mt=wt.get(F);mt.outputColorSpace=ot.outputColorSpace,mt.instancing=ot.instancing,mt.skinning=ot.skinning,mt.morphTargets=ot.morphTargets,mt.morphNormals=ot.morphNormals,mt.morphColors=ot.morphColors,mt.morphTargetsCount=ot.morphTargetsCount,mt.numClippingPlanes=ot.numClippingPlanes,mt.numIntersection=ot.numClipIntersection,mt.vertexAlphas=ot.vertexAlphas,mt.vertexTangents=ot.vertexTangents,mt.toneMapping=ot.toneMapping}function vp(F,ot,mt,rt,vt){ot.isScene!==!0&&(ot=$t),Tt.resetTextureUnits();const Wt=ot.fog,ie=rt.isMeshStandardMaterial?ot.environment:null,re=C===null?M.outputColorSpace:C.isXRRenderTarget===!0?C.texture.colorSpace:Es,ce=(rt.isMeshStandardMaterial?Qt:Xt).get(rt.envMap||ie),me=rt.vertexColors===!0&&!!mt.attributes.color&&mt.attributes.color.itemSize===4,he=!!mt.attributes.tangent&&(!!rt.normalMap||rt.anisotropy>0),ge=!!mt.morphAttributes.position,rn=!!mt.morphAttributes.normal,on=!!mt.morphAttributes.color;let Jn=xr;rt.toneMapped&&(C===null||C.isXRRenderTarget===!0)&&(Jn=M.toneMapping);const Ki=mt.morphAttributes.position||mt.morphAttributes.normal||mt.morphAttributes.color,pn=Ki!==void 0?Ki.length:0,Pe=wt.get(rt),jl=v.state.lights;if(It===!0&&(Kt===!0||F!==L)){const qn=F===L&&rt.id===S;tt.setState(rt,F,qn)}let En=!1;rt.version===Pe.__version?(Pe.needsLights&&Pe.lightsStateVersion!==jl.state.version||Pe.outputColorSpace!==re||vt.isInstancedMesh&&Pe.instancing===!1||!vt.isInstancedMesh&&Pe.instancing===!0||vt.isSkinnedMesh&&Pe.skinning===!1||!vt.isSkinnedMesh&&Pe.skinning===!0||Pe.envMap!==ce||rt.fog===!0&&Pe.fog!==Wt||Pe.numClippingPlanes!==void 0&&(Pe.numClippingPlanes!==tt.numPlanes||Pe.numIntersection!==tt.numIntersection)||Pe.vertexAlphas!==me||Pe.vertexTangents!==he||Pe.morphTargets!==ge||Pe.morphNormals!==rn||Pe.morphColors!==on||Pe.toneMapping!==Jn||st.isWebGL2===!0&&Pe.morphTargetsCount!==pn)&&(En=!0):(En=!0,Pe.__version=rt.version);let Ls=Pe.currentProgram;En===!0&&(Ls=xa(rt,ot,vt));let Yl=!1,Pr=!1,po=!1;const Fn=Ls.getUniforms(),Ds=Pe.uniforms;if(ct.useProgram(Ls.program)&&(Yl=!0,Pr=!0,po=!0),rt.id!==S&&(S=rt.id,Pr=!0),Yl||L!==F){if(Fn.setValue(X,"projectionMatrix",F.projectionMatrix),st.logarithmicDepthBuffer&&Fn.setValue(X,"logDepthBufFC",2/(Math.log(F.far+1)/Math.LN2)),L!==F&&(L=F,Pr=!0,po=!0),rt.isShaderMaterial||rt.isMeshPhongMaterial||rt.isMeshToonMaterial||rt.isMeshStandardMaterial||rt.envMap){const qn=Fn.map.cameraPosition;qn!==void 0&&qn.setValue(X,le.setFromMatrixPosition(F.matrixWorld))}(rt.isMeshPhongMaterial||rt.isMeshToonMaterial||rt.isMeshLambertMaterial||rt.isMeshBasicMaterial||rt.isMeshStandardMaterial||rt.isShaderMaterial)&&Fn.setValue(X,"isOrthographic",F.isOrthographicCamera===!0),(rt.isMeshPhongMaterial||rt.isMeshToonMaterial||rt.isMeshLambertMaterial||rt.isMeshBasicMaterial||rt.isMeshStandardMaterial||rt.isShaderMaterial||rt.isShadowMaterial||vt.isSkinnedMesh)&&Fn.setValue(X,"viewMatrix",F.matrixWorldInverse)}if(vt.isSkinnedMesh){Fn.setOptional(X,vt,"bindMatrix"),Fn.setOptional(X,vt,"bindMatrixInverse");const qn=vt.skeleton;qn&&(st.floatVertexTextures?(qn.boneTexture===null&&qn.computeBoneTexture(),Fn.setValue(X,"boneTexture",qn.boneTexture,Tt),Fn.setValue(X,"boneTextureSize",qn.boneTextureSize)):console.warn("THREE.WebGLRenderer: SkinnedMesh can only be used with WebGL 2. With WebGL 1 OES_texture_float and vertex textures support is required."))}const Rr=mt.morphAttributes;if((Rr.position!==void 0||Rr.normal!==void 0||Rr.color!==void 0&&st.isWebGL2===!0)&&_t.update(vt,mt,Ls),(Pr||Pe.receiveShadow!==vt.receiveShadow)&&(Pe.receiveShadow=vt.receiveShadow,Fn.setValue(X,"receiveShadow",vt.receiveShadow)),rt.isMeshGouraudMaterial&&rt.envMap!==null&&(Ds.envMap.value=ce,Ds.flipEnvMap.value=ce.isCubeTexture&&ce.isRenderTargetTexture===!1?-1:1),Pr&&(Fn.setValue(X,"toneMappingExposure",M.toneMappingExposure),Pe.needsLights&&_p(Ds,po),Wt&&rt.fog===!0&&Et.refreshFogUniforms(Ds,Wt),Et.refreshMaterialUniforms(Ds,rt,J,Y,Ht),Pf.upload(X,Pe.uniformsList,Ds,Tt)),rt.isShaderMaterial&&rt.uniformsNeedUpdate===!0&&(Pf.upload(X,Pe.uniformsList,Ds,Tt),rt.uniformsNeedUpdate=!1),rt.isSpriteMaterial&&Fn.setValue(X,"center",vt.center),Fn.setValue(X,"modelViewMatrix",vt.modelViewMatrix),Fn.setValue(X,"normalMatrix",vt.normalMatrix),Fn.setValue(X,"modelMatrix",vt.matrixWorld),rt.isShaderMaterial||rt.isRawShaderMaterial){const qn=rt.uniformsGroups;for(let Zl=0,Nu=qn.length;Zl<Nu;Zl++)if(st.isWebGL2){const Kl=qn[Zl];_e.update(Kl,Ls),_e.bind(Kl,Ls)}else console.warn("THREE.WebGLRenderer: Uniform Buffer Objects can only be used with WebGL 2.")}return Ls}function _p(F,ot){F.ambientLightColor.needsUpdate=ot,F.lightProbe.needsUpdate=ot,F.directionalLights.needsUpdate=ot,F.directionalLightShadows.needsUpdate=ot,F.pointLights.needsUpdate=ot,F.pointLightShadows.needsUpdate=ot,F.spotLights.needsUpdate=ot,F.spotLightShadows.needsUpdate=ot,F.rectAreaLights.needsUpdate=ot,F.hemisphereLights.needsUpdate=ot}function yp(F){return F.isMeshLambertMaterial||F.isMeshToonMaterial||F.isMeshPhongMaterial||F.isMeshStandardMaterial||F.isShadowMaterial||F.isShaderMaterial&&F.lights===!0}this.getActiveCubeFace=function(){return T},this.getActiveMipmapLevel=function(){return P},this.getRenderTarget=function(){return C},this.setRenderTargetTextures=function(F,ot,mt){wt.get(F.texture).__webglTexture=ot,wt.get(F.depthTexture).__webglTexture=mt;const rt=wt.get(F);rt.__hasExternalTextures=!0,rt.__hasExternalTextures&&(rt.__autoAllocateDepthBuffer=mt===void 0,rt.__autoAllocateDepthBuffer||W.has("WEBGL_multisampled_render_to_texture")===!0&&(console.warn("THREE.WebGLRenderer: Render-to-texture extension was disabled because an external texture was provided"),rt.__useRenderToTexture=!1))},this.setRenderTargetFramebuffer=function(F,ot){const mt=wt.get(F);mt.__webglFramebuffer=ot,mt.__useDefaultFramebuffer=ot===void 0},this.setRenderTarget=function(F,ot=0,mt=0){C=F,T=ot,P=mt;let rt=!0,vt=null,Wt=!1,ie=!1;if(F){const ce=wt.get(F);ce.__useDefaultFramebuffer!==void 0?(ct.bindFramebuffer(X.FRAMEBUFFER,null),rt=!1):ce.__webglFramebuffer===void 0?Tt.setupRenderTarget(F):ce.__hasExternalTextures&&Tt.rebindTextures(F,wt.get(F.texture).__webglTexture,wt.get(F.depthTexture).__webglTexture);const me=F.texture;(me.isData3DTexture||me.isDataArrayTexture||me.isCompressedArrayTexture)&&(ie=!0);const he=wt.get(F).__webglFramebuffer;F.isWebGLCubeRenderTarget?(vt=he[ot],Wt=!0):st.isWebGL2&&F.samples>0&&Tt.useMultisampledRTT(F)===!1?vt=wt.get(F).__webglMultisampledFramebuffer:vt=he,H.copy(F.viewport),$.copy(F.scissor),B=F.scissorTest}else H.copy(nt).multiplyScalar(J).floor(),$.copy(ft).multiplyScalar(J).floor(),B=Lt;if(ct.bindFramebuffer(X.FRAMEBUFFER,vt)&&st.drawBuffers&&rt&&ct.drawBuffers(F,vt),ct.viewport(H),ct.scissor($),ct.setScissorTest(B),Wt){const ce=wt.get(F.texture);X.framebufferTexture2D(X.FRAMEBUFFER,X.COLOR_ATTACHMENT0,X.TEXTURE_CUBE_MAP_POSITIVE_X+ot,ce.__webglTexture,mt)}else if(ie){const ce=wt.get(F.texture),me=ot||0;X.framebufferTextureLayer(X.FRAMEBUFFER,X.COLOR_ATTACHMENT0,ce.__webglTexture,mt||0,me)}S=-1},this.readRenderTargetPixels=function(F,ot,mt,rt,vt,Wt,ie){if(!(F&&F.isWebGLRenderTarget)){console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not THREE.WebGLRenderTarget.");return}let re=wt.get(F).__webglFramebuffer;if(F.isWebGLCubeRenderTarget&&ie!==void 0&&(re=re[ie]),re){ct.bindFramebuffer(X.FRAMEBUFFER,re);try{const ce=F.texture,me=ce.format,he=ce.type;if(me!==Vn&&kt.convert(me)!==X.getParameter(X.IMPLEMENTATION_COLOR_READ_FORMAT)){console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not in RGBA or implementation defined format.");return}const ge=he===yl&&(W.has("EXT_color_buffer_half_float")||st.isWebGL2&&W.has("EXT_color_buffer_float"));if(he!==ai&&kt.convert(he)!==X.getParameter(X.IMPLEMENTATION_COLOR_READ_TYPE)&&!(he===Cn&&(st.isWebGL2||W.has("OES_texture_float")||W.has("WEBGL_color_buffer_float")))&&!ge){console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not in UnsignedByteType or implementation defined type.");return}ot>=0&&ot<=F.width-rt&&mt>=0&&mt<=F.height-vt&&X.readPixels(ot,mt,rt,vt,kt.convert(me),kt.convert(he),Wt)}finally{const ce=C!==null?wt.get(C).__webglFramebuffer:null;ct.bindFramebuffer(X.FRAMEBUFFER,ce)}}},this.copyFramebufferToTexture=function(F,ot,mt=0){const rt=Math.pow(2,-mt),vt=Math.floor(ot.image.width*rt),Wt=Math.floor(ot.image.height*rt);Tt.setTexture2D(ot,0),X.copyTexSubImage2D(X.TEXTURE_2D,mt,0,0,F.x,F.y,vt,Wt),ct.unbindTexture()},this.copyTextureToTexture=function(F,ot,mt,rt=0){const vt=ot.image.width,Wt=ot.image.height,ie=kt.convert(mt.format),re=kt.convert(mt.type);Tt.setTexture2D(mt,0),X.pixelStorei(X.UNPACK_FLIP_Y_WEBGL,mt.flipY),X.pixelStorei(X.UNPACK_PREMULTIPLY_ALPHA_WEBGL,mt.premultiplyAlpha),X.pixelStorei(X.UNPACK_ALIGNMENT,mt.unpackAlignment),ot.isDataTexture?X.texSubImage2D(X.TEXTURE_2D,rt,F.x,F.y,vt,Wt,ie,re,ot.image.data):ot.isCompressedTexture?X.compressedTexSubImage2D(X.TEXTURE_2D,rt,F.x,F.y,ot.mipmaps[0].width,ot.mipmaps[0].height,ie,ot.mipmaps[0].data):X.texSubImage2D(X.TEXTURE_2D,rt,F.x,F.y,ie,re,ot.image),rt===0&&mt.generateMipmaps&&X.generateMipmap(X.TEXTURE_2D),ct.unbindTexture()},this.copyTextureToTexture3D=function(F,ot,mt,rt,vt=0){if(M.isWebGL1Renderer){console.warn("THREE.WebGLRenderer.copyTextureToTexture3D: can only be used with WebGL2.");return}const Wt=F.max.x-F.min.x+1,ie=F.max.y-F.min.y+1,re=F.max.z-F.min.z+1,ce=kt.convert(rt.format),me=kt.convert(rt.type);let he;if(rt.isData3DTexture)Tt.setTexture3D(rt,0),he=X.TEXTURE_3D;else if(rt.isDataArrayTexture)Tt.setTexture2DArray(rt,0),he=X.TEXTURE_2D_ARRAY;else{console.warn("THREE.WebGLRenderer.copyTextureToTexture3D: only supports THREE.DataTexture3D and THREE.DataTexture2DArray.");return}X.pixelStorei(X.UNPACK_FLIP_Y_WEBGL,rt.flipY),X.pixelStorei(X.UNPACK_PREMULTIPLY_ALPHA_WEBGL,rt.premultiplyAlpha),X.pixelStorei(X.UNPACK_ALIGNMENT,rt.unpackAlignment);const ge=X.getParameter(X.UNPACK_ROW_LENGTH),rn=X.getParameter(X.UNPACK_IMAGE_HEIGHT),on=X.getParameter(X.UNPACK_SKIP_PIXELS),Jn=X.getParameter(X.UNPACK_SKIP_ROWS),Ki=X.getParameter(X.UNPACK_SKIP_IMAGES),pn=mt.isCompressedTexture?mt.mipmaps[0]:mt.image;X.pixelStorei(X.UNPACK_ROW_LENGTH,pn.width),X.pixelStorei(X.UNPACK_IMAGE_HEIGHT,pn.height),X.pixelStorei(X.UNPACK_SKIP_PIXELS,F.min.x),X.pixelStorei(X.UNPACK_SKIP_ROWS,F.min.y),X.pixelStorei(X.UNPACK_SKIP_IMAGES,F.min.z),mt.isDataTexture||mt.isData3DTexture?X.texSubImage3D(he,vt,ot.x,ot.y,ot.z,Wt,ie,re,ce,me,pn.data):mt.isCompressedArrayTexture?(console.warn("THREE.WebGLRenderer.copyTextureToTexture3D: untested support for compressed srcTexture."),X.compressedTexSubImage3D(he,vt,ot.x,ot.y,ot.z,Wt,ie,re,ce,pn.data)):X.texSubImage3D(he,vt,ot.x,ot.y,ot.z,Wt,ie,re,ce,me,pn),X.pixelStorei(X.UNPACK_ROW_LENGTH,ge),X.pixelStorei(X.UNPACK_IMAGE_HEIGHT,rn),X.pixelStorei(X.UNPACK_SKIP_PIXELS,on),X.pixelStorei(X.UNPACK_SKIP_ROWS,Jn),X.pixelStorei(X.UNPACK_SKIP_IMAGES,Ki),vt===0&&rt.generateMipmaps&&X.generateMipmap(he),ct.unbindTexture()},this.initTexture=function(F){F.isCubeTexture?Tt.setTextureCube(F,0):F.isData3DTexture?Tt.setTexture3D(F,0):F.isDataArrayTexture||F.isCompressedArrayTexture?Tt.setTexture2DArray(F,0):Tt.setTexture2D(F,0),ct.unbindTexture()},this.resetState=function(){T=0,P=0,C=null,ct.reset(),ne.reset()},typeof __THREE_DEVTOOLS__<"u"&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("observe",{detail:this}))}get coordinateSystem(){return Us}get physicallyCorrectLights(){return console.warn("THREE.WebGLRenderer: The property .physicallyCorrectLights has been removed. Set renderer.useLegacyLights instead."),!this.useLegacyLights}set physicallyCorrectLights(t){console.warn("THREE.WebGLRenderer: The property .physicallyCorrectLights has been removed. Set renderer.useLegacyLights instead."),this.useLegacyLights=!t}get outputEncoding(){return console.warn("THREE.WebGLRenderer: Property .outputEncoding has been removed. Use .outputColorSpace instead."),this.outputColorSpace===ve?br:Xc}set outputEncoding(t){console.warn("THREE.WebGLRenderer: Property .outputEncoding has been removed. Use .outputColorSpace instead."),this.outputColorSpace=t===br?ve:Es}get useLegacyLights(){return console.warn("THREE.WebGLRenderer: The property .useLegacyLights has been deprecated. Migrate your lighting according to the following guide: https://discourse.threejs.org/t/updates-to-lighting-in-three-js-r155/53733."),this._useLegacyLights}set useLegacyLights(t){console.warn("THREE.WebGLRenderer: The property .useLegacyLights has been deprecated. Migrate your lighting according to the following guide: https://discourse.threejs.org/t/updates-to-lighting-in-three-js-r155/53733."),this._useLegacyLights=t}}class y_ extends __{}y_.prototype.isWebGL1Renderer=!0;class gd{constructor(t,e=25e-5){this.isFogExp2=!0,this.name="",this.color=new Vt(t),this.density=e}clone(){return new gd(this.color,this.density)}toJSON(){return{type:"FogExp2",color:this.color.getHex(),density:this.density}}}class vd{constructor(t,e=1,n=1e3){this.isFog=!0,this.name="",this.color=new Vt(t),this.near=e,this.far=n}clone(){return new vd(this.color,this.near,this.far)}toJSON(){return{type:"Fog",color:this.color.getHex(),near:this.near,far:this.far}}}let zl=class extends Ne{constructor(){super(),this.isScene=!0,this.type="Scene",this.background=null,this.environment=null,this.fog=null,this.backgroundBlurriness=0,this.backgroundIntensity=1,this.overrideMaterial=null,typeof __THREE_DEVTOOLS__<"u"&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("observe",{detail:this}))}copy(t,e){return super.copy(t,e),t.background!==null&&(this.background=t.background.clone()),t.environment!==null&&(this.environment=t.environment.clone()),t.fog!==null&&(this.fog=t.fog.clone()),this.backgroundBlurriness=t.backgroundBlurriness,this.backgroundIntensity=t.backgroundIntensity,t.overrideMaterial!==null&&(this.overrideMaterial=t.overrideMaterial.clone()),this.matrixAutoUpdate=t.matrixAutoUpdate,this}toJSON(t){const e=super.toJSON(t);return this.fog!==null&&(e.object.fog=this.fog.toJSON()),this.backgroundBlurriness>0&&(e.object.backgroundBlurriness=this.backgroundBlurriness),this.backgroundIntensity!==1&&(e.object.backgroundIntensity=this.backgroundIntensity),e}};class _d{constructor(t,e){this.isInterleavedBuffer=!0,this.array=t,this.stride=e,this.count=t!==void 0?t.length/e:0,this.usage=jc,this.updateRange={offset:0,count:-1},this.version=0,this.uuid=qi()}onUploadCallback(){}set needsUpdate(t){t===!0&&this.version++}setUsage(t){return this.usage=t,this}copy(t){return this.array=new t.array.constructor(t.array),this.count=t.count,this.stride=t.stride,this.usage=t.usage,this}copyAt(t,e,n){t*=this.stride,n*=e.stride;for(let i=0,r=this.stride;i<r;i++)this.array[t+i]=e.array[n+i];return this}set(t,e=0){return this.array.set(t,e),this}clone(t){t.arrayBuffers===void 0&&(t.arrayBuffers={}),this.array.buffer._uuid===void 0&&(this.array.buffer._uuid=qi()),t.arrayBuffers[this.array.buffer._uuid]===void 0&&(t.arrayBuffers[this.array.buffer._uuid]=this.array.slice(0).buffer);const e=new this.array.constructor(t.arrayBuffers[this.array.buffer._uuid]),n=new this.constructor(e,this.stride);return n.setUsage(this.usage),n}onUpload(t){return this.onUploadCallback=t,this}toJSON(t){return t.arrayBuffers===void 0&&(t.arrayBuffers={}),this.array.buffer._uuid===void 0&&(this.array.buffer._uuid=qi()),t.arrayBuffers[this.array.buffer._uuid]===void 0&&(t.arrayBuffers[this.array.buffer._uuid]=Array.from(new Uint32Array(this.array.buffer))),{uuid:this.uuid,buffer:this.array.buffer._uuid,type:this.array.constructor.name,stride:this.stride}}}const ni=new N;class Ko{constructor(t,e,n,i=!1){this.isInterleavedBufferAttribute=!0,this.name="",this.data=t,this.itemSize=e,this.offset=n,this.normalized=i}get count(){return this.data.count}get array(){return this.data.array}set needsUpdate(t){this.data.needsUpdate=t}applyMatrix4(t){for(let e=0,n=this.data.count;e<n;e++)ni.fromBufferAttribute(this,e),ni.applyMatrix4(t),this.setXYZ(e,ni.x,ni.y,ni.z);return this}applyNormalMatrix(t){for(let e=0,n=this.count;e<n;e++)ni.fromBufferAttribute(this,e),ni.applyNormalMatrix(t),this.setXYZ(e,ni.x,ni.y,ni.z);return this}transformDirection(t){for(let e=0,n=this.count;e<n;e++)ni.fromBufferAttribute(this,e),ni.transformDirection(t),this.setXYZ(e,ni.x,ni.y,ni.z);return this}setX(t,e){return this.normalized&&(e=Ae(e,this.array)),this.data.array[t*this.data.stride+this.offset]=e,this}setY(t,e){return this.normalized&&(e=Ae(e,this.array)),this.data.array[t*this.data.stride+this.offset+1]=e,this}setZ(t,e){return this.normalized&&(e=Ae(e,this.array)),this.data.array[t*this.data.stride+this.offset+2]=e,this}setW(t,e){return this.normalized&&(e=Ae(e,this.array)),this.data.array[t*this.data.stride+this.offset+3]=e,this}getX(t){let e=this.data.array[t*this.data.stride+this.offset];return this.normalized&&(e=Vi(e,this.array)),e}getY(t){let e=this.data.array[t*this.data.stride+this.offset+1];return this.normalized&&(e=Vi(e,this.array)),e}getZ(t){let e=this.data.array[t*this.data.stride+this.offset+2];return this.normalized&&(e=Vi(e,this.array)),e}getW(t){let e=this.data.array[t*this.data.stride+this.offset+3];return this.normalized&&(e=Vi(e,this.array)),e}setXY(t,e,n){return t=t*this.data.stride+this.offset,this.normalized&&(e=Ae(e,this.array),n=Ae(n,this.array)),this.data.array[t+0]=e,this.data.array[t+1]=n,this}setXYZ(t,e,n,i){return t=t*this.data.stride+this.offset,this.normalized&&(e=Ae(e,this.array),n=Ae(n,this.array),i=Ae(i,this.array)),this.data.array[t+0]=e,this.data.array[t+1]=n,this.data.array[t+2]=i,this}setXYZW(t,e,n,i,r){return t=t*this.data.stride+this.offset,this.normalized&&(e=Ae(e,this.array),n=Ae(n,this.array),i=Ae(i,this.array),r=Ae(r,this.array)),this.data.array[t+0]=e,this.data.array[t+1]=n,this.data.array[t+2]=i,this.data.array[t+3]=r,this}clone(t){if(t===void 0){console.log("THREE.InterleavedBufferAttribute.clone(): Cloning an interleaved buffer attribute will de-interleave buffer data.");const e=[];for(let n=0;n<this.count;n++){const i=n*this.data.stride+this.offset;for(let r=0;r<this.itemSize;r++)e.push(this.data.array[i+r])}return new ue(new this.array.constructor(e),this.itemSize,this.normalized)}else return t.interleavedBuffers===void 0&&(t.interleavedBuffers={}),t.interleavedBuffers[this.data.uuid]===void 0&&(t.interleavedBuffers[this.data.uuid]=this.data.clone(t)),new Ko(t.interleavedBuffers[this.data.uuid],this.itemSize,this.offset,this.normalized)}toJSON(t){if(t===void 0){console.log("THREE.InterleavedBufferAttribute.toJSON(): Serializing an interleaved buffer attribute will de-interleave buffer data.");const e=[];for(let n=0;n<this.count;n++){const i=n*this.data.stride+this.offset;for(let r=0;r<this.itemSize;r++)e.push(this.data.array[i+r])}return{itemSize:this.itemSize,type:this.array.constructor.name,array:e,normalized:this.normalized}}else return t.interleavedBuffers===void 0&&(t.interleavedBuffers={}),t.interleavedBuffers[this.data.uuid]===void 0&&(t.interleavedBuffers[this.data.uuid]=this.data.toJSON(t)),{isInterleavedBufferAttribute:!0,itemSize:this.itemSize,data:this.data.uuid,offset:this.offset,normalized:this.normalized}}}class x_ extends Zn{constructor(t){super(),this.isSpriteMaterial=!0,this.type="SpriteMaterial",this.color=new Vt(16777215),this.map=null,this.alphaMap=null,this.rotation=0,this.sizeAttenuation=!0,this.transparent=!0,this.fog=!0,this.setValues(t)}copy(t){return super.copy(t),this.color.copy(t.color),this.map=t.map,this.alphaMap=t.alphaMap,this.rotation=t.rotation,this.sizeAttenuation=t.sizeAttenuation,this.fog=t.fog,this}}let Ka;const vc=new N,Ja=new N,Qa=new N,tl=new pt,_c=new pt,zS=new de,qh=new N,yc=new N,Wh=new N,$b=new pt,Zm=new pt,Xb=new pt;let kS=class extends Ne{constructor(t){if(super(),this.isSprite=!0,this.type="Sprite",Ka===void 0){Ka=new we;const e=new Float32Array([-.5,-.5,0,0,0,.5,-.5,0,1,0,.5,.5,0,1,1,-.5,.5,0,0,1]),n=new _d(e,5);Ka.setIndex([0,1,2,0,2,3]),Ka.setAttribute("position",new Ko(n,3,0,!1)),Ka.setAttribute("uv",new Ko(n,2,3,!1))}this.geometry=Ka,this.material=t!==void 0?t:new x_,this.center=new pt(.5,.5)}raycast(t,e){t.camera===null&&console.error('THREE.Sprite: "Raycaster.camera" needs to be set in order to raycast against sprites.'),Ja.setFromMatrixScale(this.matrixWorld),zS.copy(t.camera.matrixWorld),this.modelViewMatrix.multiplyMatrices(t.camera.matrixWorldInverse,this.matrixWorld),Qa.setFromMatrixPosition(this.modelViewMatrix),t.camera.isPerspectiveCamera&&this.material.sizeAttenuation===!1&&Ja.multiplyScalar(-Qa.z);const n=this.material.rotation;let i,r;n!==0&&(r=Math.cos(n),i=Math.sin(n));const o=this.center;$h(qh.set(-.5,-.5,0),Qa,o,Ja,i,r),$h(yc.set(.5,-.5,0),Qa,o,Ja,i,r),$h(Wh.set(.5,.5,0),Qa,o,Ja,i,r),$b.set(0,0),Zm.set(1,0),Xb.set(1,1);let a=t.ray.intersectTriangle(qh,yc,Wh,!1,vc);if(a===null&&($h(yc.set(-.5,.5,0),Qa,o,Ja,i,r),Zm.set(0,1),a=t.ray.intersectTriangle(qh,Wh,yc,!1,vc),a===null))return;const l=t.ray.origin.distanceTo(vc);l<t.near||l>t.far||e.push({distance:l,point:vc.clone(),uv:gi.getInterpolation(vc,qh,yc,Wh,$b,Zm,Xb,new pt),face:null,object:this})}copy(t,e){return super.copy(t,e),t.center!==void 0&&this.center.copy(t.center),this.material=t.material,this}};function $h(s,t,e,n,i,r){tl.subVectors(s,e).addScalar(.5).multiply(n),i!==void 0?(_c.x=r*tl.x-i*tl.y,_c.y=i*tl.x+r*tl.y):_c.copy(tl),s.copy(t),s.x+=_c.x,s.y+=_c.y,s.applyMatrix4(zS)}const Xh=new N,jb=new N;class US extends Ne{constructor(){super(),this._currentLevel=0,this.type="LOD",Object.defineProperties(this,{levels:{enumerable:!0,value:[]},isLOD:{value:!0}}),this.autoUpdate=!0}copy(t){super.copy(t,!1);const e=t.levels;for(let n=0,i=e.length;n<i;n++){const r=e[n];this.addLevel(r.object.clone(),r.distance,r.hysteresis)}return this.autoUpdate=t.autoUpdate,this}addLevel(t,e=0,n=0){e=Math.abs(e);const i=this.levels;let r;for(r=0;r<i.length&&!(e<i[r].distance);r++);return i.splice(r,0,{distance:e,hysteresis:n,object:t}),this.add(t),this}getCurrentLevel(){return this._currentLevel}getObjectForDistance(t){const e=this.levels;if(e.length>0){let n,i;for(n=1,i=e.length;n<i;n++){let r=e[n].distance;if(e[n].object.visible&&(r-=r*e[n].hysteresis),t<r)break}return e[n-1].object}return null}raycast(t,e){if(this.levels.length>0){Xh.setFromMatrixPosition(this.matrixWorld);const i=t.ray.origin.distanceTo(Xh);this.getObjectForDistance(i).raycast(t,e)}}update(t){const e=this.levels;if(e.length>1){Xh.setFromMatrixPosition(t.matrixWorld),jb.setFromMatrixPosition(this.matrixWorld);const n=Xh.distanceTo(jb)/t.zoom;e[0].object.visible=!0;let i,r;for(i=1,r=e.length;i<r;i++){let o=e[i].distance;if(e[i].object.visible&&(o-=o*e[i].hysteresis),n>=o)e[i-1].object.visible=!1,e[i].object.visible=!0;else break}for(this._currentLevel=i-1;i<r;i++)e[i].object.visible=!1}}toJSON(t){const e=super.toJSON(t);this.autoUpdate===!1&&(e.object.autoUpdate=!1),e.object.levels=[];const n=this.levels;for(let i=0,r=n.length;i<r;i++){const o=n[i];e.object.levels.push({object:o.object.uuid,distance:o.distance,hysteresis:o.hysteresis})}return e}}const Yb=new N,Zb=new Oe,Kb=new Oe,L4=new N,Jb=new de,el=new N,Km=new Ts,Qb=new de,Jm=new la;class NS extends Xe{constructor(t,e){super(t,e),this.isSkinnedMesh=!0,this.type="SkinnedMesh",this.bindMode="attached",this.bindMatrix=new de,this.bindMatrixInverse=new de,this.boundingBox=null,this.boundingSphere=null}computeBoundingBox(){const t=this.geometry;this.boundingBox===null&&(this.boundingBox=new js),this.boundingBox.makeEmpty();const e=t.getAttribute("position");for(let n=0;n<e.count;n++)el.fromBufferAttribute(e,n),this.applyBoneTransform(n,el),this.boundingBox.expandByPoint(el)}computeBoundingSphere(){const t=this.geometry;this.boundingSphere===null&&(this.boundingSphere=new Ts),this.boundingSphere.makeEmpty();const e=t.getAttribute("position");for(let n=0;n<e.count;n++)el.fromBufferAttribute(e,n),this.applyBoneTransform(n,el),this.boundingSphere.expandByPoint(el)}copy(t,e){return super.copy(t,e),this.bindMode=t.bindMode,this.bindMatrix.copy(t.bindMatrix),this.bindMatrixInverse.copy(t.bindMatrixInverse),this.skeleton=t.skeleton,t.boundingBox!==null&&(this.boundingBox=t.boundingBox.clone()),t.boundingSphere!==null&&(this.boundingSphere=t.boundingSphere.clone()),this}raycast(t,e){const n=this.material,i=this.matrixWorld;n!==void 0&&(this.boundingSphere===null&&this.computeBoundingSphere(),Km.copy(this.boundingSphere),Km.applyMatrix4(i),t.ray.intersectsSphere(Km)!==!1&&(Qb.copy(i).invert(),Jm.copy(t.ray).applyMatrix4(Qb),!(this.boundingBox!==null&&Jm.intersectsBox(this.boundingBox)===!1)&&this._computeIntersections(t,e,Jm)))}getVertexPosition(t,e){return super.getVertexPosition(t,e),this.applyBoneTransform(t,e),e}bind(t,e){this.skeleton=t,e===void 0&&(this.updateMatrixWorld(!0),this.skeleton.calculateInverses(),e=this.matrixWorld),this.bindMatrix.copy(e),this.bindMatrixInverse.copy(e).invert()}pose(){this.skeleton.pose()}normalizeSkinWeights(){const t=new Oe,e=this.geometry.attributes.skinWeight;for(let n=0,i=e.count;n<i;n++){t.fromBufferAttribute(e,n);const r=1/t.manhattanLength();r!==1/0?t.multiplyScalar(r):t.set(1,0,0,0),e.setXYZW(n,t.x,t.y,t.z,t.w)}}updateMatrixWorld(t){super.updateMatrixWorld(t),this.bindMode==="attached"?this.bindMatrixInverse.copy(this.matrixWorld).invert():this.bindMode==="detached"?this.bindMatrixInverse.copy(this.bindMatrix).invert():console.warn("THREE.SkinnedMesh: Unrecognized bindMode: "+this.bindMode)}applyBoneTransform(t,e){const n=this.skeleton,i=this.geometry;Zb.fromBufferAttribute(i.attributes.skinIndex,t),Kb.fromBufferAttribute(i.attributes.skinWeight,t),Yb.copy(e).applyMatrix4(this.bindMatrix),e.set(0,0,0);for(let r=0;r<4;r++){const o=Kb.getComponent(r);if(o!==0){const a=Zb.getComponent(r);Jb.multiplyMatrices(n.bones[a].matrixWorld,n.boneInverses[a]),e.addScaledVector(L4.copy(Yb).applyMatrix4(Jb),o)}}return e.applyMatrix4(this.bindMatrixInverse)}boneTransform(t,e){return console.warn("THREE.SkinnedMesh: .boneTransform() was renamed to .applyBoneTransform() in r151."),this.applyBoneTransform(t,e)}}class b_ extends Ne{constructor(){super(),this.isBone=!0,this.type="Bone"}}let ml=class extends xn{constructor(t=null,e=1,n=1,i,r,o,a,l,c=Ve,h=Ve,f,d){super(null,o,a,l,c,h,i,r,f,d),this.isDataTexture=!0,this.image={data:t,width:e,height:n},this.generateMipmaps=!1,this.flipY=!1,this.unpackAlignment=1}};const tw=new de,D4=new de;class yd{constructor(t=[],e=[]){this.uuid=qi(),this.bones=t.slice(0),this.boneInverses=e,this.boneMatrices=null,this.boneTexture=null,this.boneTextureSize=0,this.init()}init(){const t=this.bones,e=this.boneInverses;if(this.boneMatrices=new Float32Array(t.length*16),e.length===0)this.calculateInverses();else if(t.length!==e.length){console.warn("THREE.Skeleton: Number of inverse bone matrices does not match amount of bones."),this.boneInverses=[];for(let n=0,i=this.bones.length;n<i;n++)this.boneInverses.push(new de)}}calculateInverses(){this.boneInverses.length=0;for(let t=0,e=this.bones.length;t<e;t++){const n=new de;this.bones[t]&&n.copy(this.bones[t].matrixWorld).invert(),this.boneInverses.push(n)}}pose(){for(let t=0,e=this.bones.length;t<e;t++){const n=this.bones[t];n&&n.matrixWorld.copy(this.boneInverses[t]).invert()}for(let t=0,e=this.bones.length;t<e;t++){const n=this.bones[t];n&&(n.parent&&n.parent.isBone?(n.matrix.copy(n.parent.matrixWorld).invert(),n.matrix.multiply(n.matrixWorld)):n.matrix.copy(n.matrixWorld),n.matrix.decompose(n.position,n.quaternion,n.scale))}}update(){const t=this.bones,e=this.boneInverses,n=this.boneMatrices,i=this.boneTexture;for(let r=0,o=t.length;r<o;r++){const a=t[r]?t[r].matrixWorld:D4;tw.multiplyMatrices(a,e[r]),tw.toArray(n,r*16)}i!==null&&(i.needsUpdate=!0)}clone(){return new yd(this.bones,this.boneInverses)}computeBoneTexture(){let t=Math.sqrt(this.bones.length*4);t=mS(t),t=Math.max(t,4);const e=new Float32Array(t*t*4);e.set(this.boneMatrices);const n=new ml(e,t,t,Vn,Cn);return n.needsUpdate=!0,this.boneMatrices=e,this.boneTexture=n,this.boneTextureSize=t,this}getBoneByName(t){for(let e=0,n=this.bones.length;e<n;e++){const i=this.bones[e];if(i.name===t)return i}}dispose(){this.boneTexture!==null&&(this.boneTexture.dispose(),this.boneTexture=null)}fromJSON(t,e){this.uuid=t.uuid;for(let n=0,i=t.bones.length;n<i;n++){const r=t.bones[n];let o=e[r];o===void 0&&(console.warn("THREE.Skeleton: No bone found with UUID:",r),o=new b_),this.bones.push(o),this.boneInverses.push(new de().fromArray(t.boneInverses[n]))}return this.init(),this}toJSON(){const t={metadata:{version:4.6,type:"Skeleton",generator:"Skeleton.toJSON"},bones:[],boneInverses:[]};t.uuid=this.uuid;const e=this.bones,n=this.boneInverses;for(let i=0,r=e.length;i<r;i++){const o=e[i];t.bones.push(o.uuid);const a=n[i];t.boneInverses.push(a.toArray())}return t}}class wl extends ue{constructor(t,e,n,i=1){super(t,e,n),this.isInstancedBufferAttribute=!0,this.meshPerAttribute=i}copy(t){return super.copy(t),this.meshPerAttribute=t.meshPerAttribute,this}toJSON(){const t=super.toJSON();return t.meshPerAttribute=this.meshPerAttribute,t.isInstancedBufferAttribute=!0,t}}const nl=new de,ew=new de,jh=[],nw=new js,I4=new de,xc=new Xe,bc=new Ts;class FS extends Xe{constructor(t,e,n){super(t,e),this.isInstancedMesh=!0,this.instanceMatrix=new wl(new Float32Array(n*16),16),this.instanceColor=null,this.count=n,this.boundingBox=null,this.boundingSphere=null;for(let i=0;i<n;i++)this.setMatrixAt(i,I4)}computeBoundingBox(){const t=this.geometry,e=this.count;this.boundingBox===null&&(this.boundingBox=new js),t.boundingBox===null&&t.computeBoundingBox(),this.boundingBox.makeEmpty();for(let n=0;n<e;n++)this.getMatrixAt(n,nl),nw.copy(t.boundingBox).applyMatrix4(nl),this.boundingBox.union(nw)}computeBoundingSphere(){const t=this.geometry,e=this.count;this.boundingSphere===null&&(this.boundingSphere=new Ts),t.boundingSphere===null&&t.computeBoundingSphere(),this.boundingSphere.makeEmpty();for(let n=0;n<e;n++)this.getMatrixAt(n,nl),bc.copy(t.boundingSphere).applyMatrix4(nl),this.boundingSphere.union(bc)}copy(t,e){return super.copy(t,e),this.instanceMatrix.copy(t.instanceMatrix),t.instanceColor!==null&&(this.instanceColor=t.instanceColor.clone()),this.count=t.count,t.boundingBox!==null&&(this.boundingBox=t.boundingBox.clone()),t.boundingSphere!==null&&(this.boundingSphere=t.boundingSphere.clone()),this}getColorAt(t,e){e.fromArray(this.instanceColor.array,t*3)}getMatrixAt(t,e){e.fromArray(this.instanceMatrix.array,t*16)}raycast(t,e){const n=this.matrixWorld,i=this.count;if(xc.geometry=this.geometry,xc.material=this.material,xc.material!==void 0&&(this.boundingSphere===null&&this.computeBoundingSphere(),bc.copy(this.boundingSphere),bc.applyMatrix4(n),t.ray.intersectsSphere(bc)!==!1))for(let r=0;r<i;r++){this.getMatrixAt(r,nl),ew.multiplyMatrices(n,nl),xc.matrixWorld=ew,xc.raycast(t,jh);for(let o=0,a=jh.length;o<a;o++){const l=jh[o];l.instanceId=r,l.object=this,e.push(l)}jh.length=0}}setColorAt(t,e){this.instanceColor===null&&(this.instanceColor=new wl(new Float32Array(this.instanceMatrix.count*3),3)),e.toArray(this.instanceColor.array,t*3)}setMatrixAt(t,e){e.toArray(this.instanceMatrix.array,t*16)}updateMorphTargets(){}dispose(){this.dispatchEvent({type:"dispose"})}}class li extends Zn{constructor(t){super(),this.isLineBasicMaterial=!0,this.type="LineBasicMaterial",this.color=new Vt(16777215),this.map=null,this.linewidth=1,this.linecap="round",this.linejoin="round",this.fog=!0,this.setValues(t)}copy(t){return super.copy(t),this.color.copy(t.color),this.map=t.map,this.linewidth=t.linewidth,this.linecap=t.linecap,this.linejoin=t.linejoin,this.fog=t.fog,this}}const iw=new N,sw=new N,rw=new de,Qm=new la,Yh=new Ts;let ro=class extends Ne{constructor(t=new we,e=new li){super(),this.isLine=!0,this.type="Line",this.geometry=t,this.material=e,this.updateMorphTargets()}copy(t,e){return super.copy(t,e),this.material=t.material,this.geometry=t.geometry,this}computeLineDistances(){const t=this.geometry;if(t.index===null){const e=t.attributes.position,n=[0];for(let i=1,r=e.count;i<r;i++)iw.fromBufferAttribute(e,i-1),sw.fromBufferAttribute(e,i),n[i]=n[i-1],n[i]+=iw.distanceTo(sw);t.setAttribute("lineDistance",new jt(n,1))}else console.warn("THREE.Line.computeLineDistances(): Computation only possible with non-indexed BufferGeometry.");return this}raycast(t,e){const n=this.geometry,i=this.matrixWorld,r=t.params.Line.threshold,o=n.drawRange;if(n.boundingSphere===null&&n.computeBoundingSphere(),Yh.copy(n.boundingSphere),Yh.applyMatrix4(i),Yh.radius+=r,t.ray.intersectsSphere(Yh)===!1)return;rw.copy(i).invert(),Qm.copy(t.ray).applyMatrix4(rw);const a=r/((this.scale.x+this.scale.y+this.scale.z)/3),l=a*a,c=new N,h=new N,f=new N,d=new N,m=this.isLineSegments?2:1,g=n.index,_=n.attributes.position;if(g!==null){const v=Math.max(0,o.start),w=Math.min(g.count,o.start+o.count);for(let b=v,M=w-1;b<M;b+=m){const A=g.getX(b),T=g.getX(b+1);if(c.fromBufferAttribute(_,A),h.fromBufferAttribute(_,T),Qm.distanceSqToSegment(c,h,d,f)>l)continue;d.applyMatrix4(this.matrixWorld);const C=t.ray.origin.distanceTo(d);C<t.near||C>t.far||e.push({distance:C,point:f.clone().applyMatrix4(this.matrixWorld),index:b,face:null,faceIndex:null,object:this})}}else{const v=Math.max(0,o.start),w=Math.min(_.count,o.start+o.count);for(let b=v,M=w-1;b<M;b+=m){if(c.fromBufferAttribute(_,b),h.fromBufferAttribute(_,b+1),Qm.distanceSqToSegment(c,h,d,f)>l)continue;d.applyMatrix4(this.matrixWorld);const T=t.ray.origin.distanceTo(d);T<t.near||T>t.far||e.push({distance:T,point:f.clone().applyMatrix4(this.matrixWorld),index:b,face:null,faceIndex:null,object:this})}}}updateMorphTargets(){const e=this.geometry.morphAttributes,n=Object.keys(e);if(n.length>0){const i=e[n[0]];if(i!==void 0){this.morphTargetInfluences=[],this.morphTargetDictionary={};for(let r=0,o=i.length;r<o;r++){const a=i[r].name||String(r);this.morphTargetInfluences.push(0),this.morphTargetDictionary[a]=r}}}}};const ow=new N,aw=new N;class Ys extends ro{constructor(t,e){super(t,e),this.isLineSegments=!0,this.type="LineSegments"}computeLineDistances(){const t=this.geometry;if(t.index===null){const e=t.attributes.position,n=[];for(let i=0,r=e.count;i<r;i+=2)ow.fromBufferAttribute(e,i),aw.fromBufferAttribute(e,i+1),n[i]=i===0?0:n[i-1],n[i+1]=n[i]+ow.distanceTo(aw);t.setAttribute("lineDistance",new jt(n,1))}else console.warn("THREE.LineSegments.computeLineDistances(): Computation only possible with non-indexed BufferGeometry.");return this}}class BS extends ro{constructor(t,e){super(t,e),this.isLineLoop=!0,this.type="LineLoop"}}class w_ extends Zn{constructor(t){super(),this.isPointsMaterial=!0,this.type="PointsMaterial",this.color=new Vt(16777215),this.map=null,this.alphaMap=null,this.size=1,this.sizeAttenuation=!0,this.fog=!0,this.setValues(t)}copy(t){return super.copy(t),this.color.copy(t.color),this.map=t.map,this.alphaMap=t.alphaMap,this.size=t.size,this.sizeAttenuation=t.sizeAttenuation,this.fog=t.fog,this}}const lw=new de,ov=new la,Zh=new Ts,Kh=new N;class HS extends Ne{constructor(t=new we,e=new w_){super(),this.isPoints=!0,this.type="Points",this.geometry=t,this.material=e,this.updateMorphTargets()}copy(t,e){return super.copy(t,e),this.material=t.material,this.geometry=t.geometry,this}raycast(t,e){const n=this.geometry,i=this.matrixWorld,r=t.params.Points.threshold,o=n.drawRange;if(n.boundingSphere===null&&n.computeBoundingSphere(),Zh.copy(n.boundingSphere),Zh.applyMatrix4(i),Zh.radius+=r,t.ray.intersectsSphere(Zh)===!1)return;lw.copy(i).invert(),ov.copy(t.ray).applyMatrix4(lw);const a=r/((this.scale.x+this.scale.y+this.scale.z)/3),l=a*a,c=n.index,f=n.attributes.position;if(c!==null){const d=Math.max(0,o.start),m=Math.min(c.count,o.start+o.count);for(let g=d,y=m;g<y;g++){const _=c.getX(g);Kh.fromBufferAttribute(f,_),cw(Kh,_,l,i,t,e,this)}}else{const d=Math.max(0,o.start),m=Math.min(f.count,o.start+o.count);for(let g=d,y=m;g<y;g++)Kh.fromBufferAttribute(f,g),cw(Kh,g,l,i,t,e,this)}}updateMorphTargets(){const e=this.geometry.morphAttributes,n=Object.keys(e);if(n.length>0){const i=e[n[0]];if(i!==void 0){this.morphTargetInfluences=[],this.morphTargetDictionary={};for(let r=0,o=i.length;r<o;r++){const a=i[r].name||String(r);this.morphTargetInfluences.push(0),this.morphTargetDictionary[a]=r}}}}}function cw(s,t,e,n,i,r,o){const a=ov.distanceSqToPoint(s);if(a<e){const l=new N;ov.closestPointToPoint(s,l),l.applyMatrix4(n);const c=i.ray.origin.distanceTo(l);if(c<i.near||c>i.far)return;r.push({distance:c,distanceToRay:Math.sqrt(a),point:l,index:t,face:null,object:o})}}class O4 extends xn{constructor(t,e,n,i,r,o,a,l,c){super(t,e,n,i,r,o,a,l,c),this.isVideoTexture=!0,this.minFilter=o!==void 0?o:fn,this.magFilter=r!==void 0?r:fn,this.generateMipmaps=!1;const h=this;function f(){h.needsUpdate=!0,t.requestVideoFrameCallback(f)}"requestVideoFrameCallback"in t&&t.requestVideoFrameCallback(f)}clone(){return new this.constructor(this.image).copy(this)}update(){const t=this.image;"requestVideoFrameCallback"in t===!1&&t.readyState>=t.HAVE_CURRENT_DATA&&(this.needsUpdate=!0)}}class z4 extends xn{constructor(t,e){super({width:t,height:e}),this.isFramebufferTexture=!0,this.magFilter=Ve,this.minFilter=Ve,this.generateMipmaps=!1,this.needsUpdate=!0}}class xd extends xn{constructor(t,e,n,i,r,o,a,l,c,h,f,d){super(null,o,a,l,c,h,i,r,f,d),this.isCompressedTexture=!0,this.image={width:e,height:n},this.mipmaps=t,this.flipY=!1,this.generateMipmaps=!1}}class k4 extends xd{constructor(t,e,n,i,r,o){super(t,e,n,r,o),this.isCompressedArrayTexture=!0,this.image.depth=i,this.wrapR=In}}class U4 extends xd{constructor(t,e,n){super(void 0,t[0].width,t[0].height,e,n,Sr),this.isCompressedCubeTexture=!0,this.isCubeTexture=!0,this.image=t}}class N4 extends xn{constructor(t,e,n,i,r,o,a,l,c){super(t,e,n,i,r,o,a,l,c),this.isCanvasTexture=!0,this.needsUpdate=!0}}class Cs{constructor(){this.type="Curve",this.arcLengthDivisions=200}getPoint(){return console.warn("THREE.Curve: .getPoint() not implemented."),null}getPointAt(t,e){const n=this.getUtoTmapping(t);return this.getPoint(n,e)}getPoints(t=5){const e=[];for(let n=0;n<=t;n++)e.push(this.getPoint(n/t));return e}getSpacedPoints(t=5){const e=[];for(let n=0;n<=t;n++)e.push(this.getPointAt(n/t));return e}getLength(){const t=this.getLengths();return t[t.length-1]}getLengths(t=this.arcLengthDivisions){if(this.cacheArcLengths&&this.cacheArcLengths.length===t+1&&!this.needsUpdate)return this.cacheArcLengths;this.needsUpdate=!1;const e=[];let n,i=this.getPoint(0),r=0;e.push(0);for(let o=1;o<=t;o++)n=this.getPoint(o/t),r+=n.distanceTo(i),e.push(r),i=n;return this.cacheArcLengths=e,e}updateArcLengths(){this.needsUpdate=!0,this.getLengths()}getUtoTmapping(t,e){const n=this.getLengths();let i=0;const r=n.length;let o;e?o=e:o=t*n[r-1];let a=0,l=r-1,c;for(;a<=l;)if(i=Math.floor(a+(l-a)/2),c=n[i]-o,c<0)a=i+1;else if(c>0)l=i-1;else{l=i;break}if(i=l,n[i]===o)return i/(r-1);const h=n[i],d=n[i+1]-h,m=(o-h)/d;return(i+m)/(r-1)}getTangent(t,e){let i=t-1e-4,r=t+1e-4;i<0&&(i=0),r>1&&(r=1);const o=this.getPoint(i),a=this.getPoint(r),l=e||(o.isVector2?new pt:new N);return l.copy(a).sub(o).normalize(),l}getTangentAt(t,e){const n=this.getUtoTmapping(t);return this.getTangent(n,e)}computeFrenetFrames(t,e){const n=new N,i=[],r=[],o=[],a=new N,l=new de;for(let m=0;m<=t;m++){const g=m/t;i[m]=this.getTangentAt(g,new N)}r[0]=new N,o[0]=new N;let c=Number.MAX_VALUE;const h=Math.abs(i[0].x),f=Math.abs(i[0].y),d=Math.abs(i[0].z);h<=c&&(c=h,n.set(1,0,0)),f<=c&&(c=f,n.set(0,1,0)),d<=c&&n.set(0,0,1),a.crossVectors(i[0],n).normalize(),r[0].crossVectors(i[0],a),o[0].crossVectors(i[0],r[0]);for(let m=1;m<=t;m++){if(r[m]=r[m-1].clone(),o[m]=o[m-1].clone(),a.crossVectors(i[m-1],i[m]),a.length()>Number.EPSILON){a.normalize();const g=Math.acos(yn(i[m-1].dot(i[m]),-1,1));r[m].applyMatrix4(l.makeRotationAxis(a,g))}o[m].crossVectors(i[m],r[m])}if(e===!0){let m=Math.acos(yn(r[0].dot(r[t]),-1,1));m/=t,i[0].dot(a.crossVectors(r[0],r[t]))>0&&(m=-m);for(let g=1;g<=t;g++)r[g].applyMatrix4(l.makeRotationAxis(i[g],m*g)),o[g].crossVectors(i[g],r[g])}return{tangents:i,normals:r,binormals:o}}clone(){return new this.constructor().copy(this)}copy(t){return this.arcLengthDivisions=t.arcLengthDivisions,this}toJSON(){const t={metadata:{version:4.6,type:"Curve",generator:"Curve.toJSON"}};return t.arcLengthDivisions=this.arcLengthDivisions,t.type=this.type,t}fromJSON(t){return this.arcLengthDivisions=t.arcLengthDivisions,this}}class bd extends Cs{constructor(t=0,e=0,n=1,i=1,r=0,o=Math.PI*2,a=!1,l=0){super(),this.isEllipseCurve=!0,this.type="EllipseCurve",this.aX=t,this.aY=e,this.xRadius=n,this.yRadius=i,this.aStartAngle=r,this.aEndAngle=o,this.aClockwise=a,this.aRotation=l}getPoint(t,e){const n=e||new pt,i=Math.PI*2;let r=this.aEndAngle-this.aStartAngle;const o=Math.abs(r)<Number.EPSILON;for(;r<0;)r+=i;for(;r>i;)r-=i;r<Number.EPSILON&&(o?r=0:r=i),this.aClockwise===!0&&!o&&(r===i?r=-i:r=r-i);const a=this.aStartAngle+t*r;let l=this.aX+this.xRadius*Math.cos(a),c=this.aY+this.yRadius*Math.sin(a);if(this.aRotation!==0){const h=Math.cos(this.aRotation),f=Math.sin(this.aRotation),d=l-this.aX,m=c-this.aY;l=d*h-m*f+this.aX,c=d*f+m*h+this.aY}return n.set(l,c)}copy(t){return super.copy(t),this.aX=t.aX,this.aY=t.aY,this.xRadius=t.xRadius,this.yRadius=t.yRadius,this.aStartAngle=t.aStartAngle,this.aEndAngle=t.aEndAngle,this.aClockwise=t.aClockwise,this.aRotation=t.aRotation,this}toJSON(){const t=super.toJSON();return t.aX=this.aX,t.aY=this.aY,t.xRadius=this.xRadius,t.yRadius=this.yRadius,t.aStartAngle=this.aStartAngle,t.aEndAngle=this.aEndAngle,t.aClockwise=this.aClockwise,t.aRotation=this.aRotation,t}fromJSON(t){return super.fromJSON(t),this.aX=t.aX,this.aY=t.aY,this.xRadius=t.xRadius,this.yRadius=t.yRadius,this.aStartAngle=t.aStartAngle,this.aEndAngle=t.aEndAngle,this.aClockwise=t.aClockwise,this.aRotation=t.aRotation,this}}class VS extends bd{constructor(t,e,n,i,r,o){super(t,e,n,n,i,r,o),this.isArcCurve=!0,this.type="ArcCurve"}}function M_(){let s=0,t=0,e=0,n=0;function i(r,o,a,l){s=r,t=a,e=-3*r+3*o-2*a-l,n=2*r-2*o+a+l}return{initCatmullRom:function(r,o,a,l,c){i(o,a,c*(a-r),c*(l-o))},initNonuniformCatmullRom:function(r,o,a,l,c,h,f){let d=(o-r)/c-(a-r)/(c+h)+(a-o)/h,m=(a-o)/h-(l-o)/(h+f)+(l-a)/f;d*=h,m*=h,i(o,a,d,m)},calc:function(r){const o=r*r,a=o*r;return s+t*r+e*o+n*a}}}const Jh=new N,tg=new M_,eg=new M_,ng=new M_;class GS extends Cs{constructor(t=[],e=!1,n="centripetal",i=.5){super(),this.isCatmullRomCurve3=!0,this.type="CatmullRomCurve3",this.points=t,this.closed=e,this.curveType=n,this.tension=i}getPoint(t,e=new N){const n=e,i=this.points,r=i.length,o=(r-(this.closed?0:1))*t;let a=Math.floor(o),l=o-a;this.closed?a+=a>0?0:(Math.floor(Math.abs(a)/r)+1)*r:l===0&&a===r-1&&(a=r-2,l=1);let c,h;this.closed||a>0?c=i[(a-1)%r]:(Jh.subVectors(i[0],i[1]).add(i[0]),c=Jh);const f=i[a%r],d=i[(a+1)%r];if(this.closed||a+2<r?h=i[(a+2)%r]:(Jh.subVectors(i[r-1],i[r-2]).add(i[r-1]),h=Jh),this.curveType==="centripetal"||this.curveType==="chordal"){const m=this.curveType==="chordal"?.5:.25;let g=Math.pow(c.distanceToSquared(f),m),y=Math.pow(f.distanceToSquared(d),m),_=Math.pow(d.distanceToSquared(h),m);y<1e-4&&(y=1),g<1e-4&&(g=y),_<1e-4&&(_=y),tg.initNonuniformCatmullRom(c.x,f.x,d.x,h.x,g,y,_),eg.initNonuniformCatmullRom(c.y,f.y,d.y,h.y,g,y,_),ng.initNonuniformCatmullRom(c.z,f.z,d.z,h.z,g,y,_)}else this.curveType==="catmullrom"&&(tg.initCatmullRom(c.x,f.x,d.x,h.x,this.tension),eg.initCatmullRom(c.y,f.y,d.y,h.y,this.tension),ng.initCatmullRom(c.z,f.z,d.z,h.z,this.tension));return n.set(tg.calc(l),eg.calc(l),ng.calc(l)),n}copy(t){super.copy(t),this.points=[];for(let e=0,n=t.points.length;e<n;e++){const i=t.points[e];this.points.push(i.clone())}return this.closed=t.closed,this.curveType=t.curveType,this.tension=t.tension,this}toJSON(){const t=super.toJSON();t.points=[];for(let e=0,n=this.points.length;e<n;e++){const i=this.points[e];t.points.push(i.toArray())}return t.closed=this.closed,t.curveType=this.curveType,t.tension=this.tension,t}fromJSON(t){super.fromJSON(t),this.points=[];for(let e=0,n=t.points.length;e<n;e++){const i=t.points[e];this.points.push(new N().fromArray(i))}return this.closed=t.closed,this.curveType=t.curveType,this.tension=t.tension,this}}function uw(s,t,e,n,i){const r=(n-t)*.5,o=(i-e)*.5,a=s*s,l=s*a;return(2*e-2*n+r+o)*l+(-3*e+3*n-2*r-o)*a+r*s+e}function F4(s,t){const e=1-s;return e*e*t}function B4(s,t){return 2*(1-s)*s*t}function H4(s,t){return s*s*t}function Uc(s,t,e,n){return F4(s,t)+B4(s,e)+H4(s,n)}function V4(s,t){const e=1-s;return e*e*e*t}function G4(s,t){const e=1-s;return 3*e*e*s*t}function q4(s,t){return 3*(1-s)*s*s*t}function W4(s,t){return s*s*s*t}function Nc(s,t,e,n,i){return V4(s,t)+G4(s,e)+q4(s,n)+W4(s,i)}class S_ extends Cs{constructor(t=new pt,e=new pt,n=new pt,i=new pt){super(),this.isCubicBezierCurve=!0,this.type="CubicBezierCurve",this.v0=t,this.v1=e,this.v2=n,this.v3=i}getPoint(t,e=new pt){const n=e,i=this.v0,r=this.v1,o=this.v2,a=this.v3;return n.set(Nc(t,i.x,r.x,o.x,a.x),Nc(t,i.y,r.y,o.y,a.y)),n}copy(t){return super.copy(t),this.v0.copy(t.v0),this.v1.copy(t.v1),this.v2.copy(t.v2),this.v3.copy(t.v3),this}toJSON(){const t=super.toJSON();return t.v0=this.v0.toArray(),t.v1=this.v1.toArray(),t.v2=this.v2.toArray(),t.v3=this.v3.toArray(),t}fromJSON(t){return super.fromJSON(t),this.v0.fromArray(t.v0),this.v1.fromArray(t.v1),this.v2.fromArray(t.v2),this.v3.fromArray(t.v3),this}}class qS extends Cs{constructor(t=new N,e=new N,n=new N,i=new N){super(),this.isCubicBezierCurve3=!0,this.type="CubicBezierCurve3",this.v0=t,this.v1=e,this.v2=n,this.v3=i}getPoint(t,e=new N){const n=e,i=this.v0,r=this.v1,o=this.v2,a=this.v3;return n.set(Nc(t,i.x,r.x,o.x,a.x),Nc(t,i.y,r.y,o.y,a.y),Nc(t,i.z,r.z,o.z,a.z)),n}copy(t){return super.copy(t),this.v0.copy(t.v0),this.v1.copy(t.v1),this.v2.copy(t.v2),this.v3.copy(t.v3),this}toJSON(){const t=super.toJSON();return t.v0=this.v0.toArray(),t.v1=this.v1.toArray(),t.v2=this.v2.toArray(),t.v3=this.v3.toArray(),t}fromJSON(t){return super.fromJSON(t),this.v0.fromArray(t.v0),this.v1.fromArray(t.v1),this.v2.fromArray(t.v2),this.v3.fromArray(t.v3),this}}class wd extends Cs{constructor(t=new pt,e=new pt){super(),this.isLineCurve=!0,this.type="LineCurve",this.v1=t,this.v2=e}getPoint(t,e=new pt){const n=e;return t===1?n.copy(this.v2):(n.copy(this.v2).sub(this.v1),n.multiplyScalar(t).add(this.v1)),n}getPointAt(t,e){return this.getPoint(t,e)}getTangent(t,e=new pt){return e.subVectors(this.v2,this.v1).normalize()}getTangentAt(t,e){return this.getTangent(t,e)}copy(t){return super.copy(t),this.v1.copy(t.v1),this.v2.copy(t.v2),this}toJSON(){const t=super.toJSON();return t.v1=this.v1.toArray(),t.v2=this.v2.toArray(),t}fromJSON(t){return super.fromJSON(t),this.v1.fromArray(t.v1),this.v2.fromArray(t.v2),this}}class WS extends Cs{constructor(t=new N,e=new N){super(),this.isLineCurve3=!0,this.type="LineCurve3",this.v1=t,this.v2=e}getPoint(t,e=new N){const n=e;return t===1?n.copy(this.v2):(n.copy(this.v2).sub(this.v1),n.multiplyScalar(t).add(this.v1)),n}getPointAt(t,e){return this.getPoint(t,e)}getTangent(t,e=new N){return e.subVectors(this.v2,this.v1).normalize()}getTangentAt(t,e){return this.getTangent(t,e)}copy(t){return super.copy(t),this.v1.copy(t.v1),this.v2.copy(t.v2),this}toJSON(){const t=super.toJSON();return t.v1=this.v1.toArray(),t.v2=this.v2.toArray(),t}fromJSON(t){return super.fromJSON(t),this.v1.fromArray(t.v1),this.v2.fromArray(t.v2),this}}class A_ extends Cs{constructor(t=new pt,e=new pt,n=new pt){super(),this.isQuadraticBezierCurve=!0,this.type="QuadraticBezierCurve",this.v0=t,this.v1=e,this.v2=n}getPoint(t,e=new pt){const n=e,i=this.v0,r=this.v1,o=this.v2;return n.set(Uc(t,i.x,r.x,o.x),Uc(t,i.y,r.y,o.y)),n}copy(t){return super.copy(t),this.v0.copy(t.v0),this.v1.copy(t.v1),this.v2.copy(t.v2),this}toJSON(){const t=super.toJSON();return t.v0=this.v0.toArray(),t.v1=this.v1.toArray(),t.v2=this.v2.toArray(),t}fromJSON(t){return super.fromJSON(t),this.v0.fromArray(t.v0),this.v1.fromArray(t.v1),this.v2.fromArray(t.v2),this}}class E_ extends Cs{constructor(t=new N,e=new N,n=new N){super(),this.isQuadraticBezierCurve3=!0,this.type="QuadraticBezierCurve3",this.v0=t,this.v1=e,this.v2=n}getPoint(t,e=new N){const n=e,i=this.v0,r=this.v1,o=this.v2;return n.set(Uc(t,i.x,r.x,o.x),Uc(t,i.y,r.y,o.y),Uc(t,i.z,r.z,o.z)),n}copy(t){return super.copy(t),this.v0.copy(t.v0),this.v1.copy(t.v1),this.v2.copy(t.v2),this}toJSON(){const t=super.toJSON();return t.v0=this.v0.toArray(),t.v1=this.v1.toArray(),t.v2=this.v2.toArray(),t}fromJSON(t){return super.fromJSON(t),this.v0.fromArray(t.v0),this.v1.fromArray(t.v1),this.v2.fromArray(t.v2),this}}class T_ extends Cs{constructor(t=[]){super(),this.isSplineCurve=!0,this.type="SplineCurve",this.points=t}getPoint(t,e=new pt){const n=e,i=this.points,r=(i.length-1)*t,o=Math.floor(r),a=r-o,l=i[o===0?o:o-1],c=i[o],h=i[o>i.length-2?i.length-1:o+1],f=i[o>i.length-3?i.length-1:o+2];return n.set(uw(a,l.x,c.x,h.x,f.x),uw(a,l.y,c.y,h.y,f.y)),n}copy(t){super.copy(t),this.points=[];for(let e=0,n=t.points.length;e<n;e++){const i=t.points[e];this.points.push(i.clone())}return this}toJSON(){const t=super.toJSON();t.points=[];for(let e=0,n=this.points.length;e<n;e++){const i=this.points[e];t.points.push(i.toArray())}return t}fromJSON(t){super.fromJSON(t),this.points=[];for(let e=0,n=t.points.length;e<n;e++){const i=t.points[e];this.points.push(new pt().fromArray(i))}return this}}var C_=Object.freeze({__proto__:null,ArcCurve:VS,CatmullRomCurve3:GS,CubicBezierCurve:S_,CubicBezierCurve3:qS,EllipseCurve:bd,LineCurve:wd,LineCurve3:WS,QuadraticBezierCurve:A_,QuadraticBezierCurve3:E_,SplineCurve:T_});class $S extends Cs{constructor(){super(),this.type="CurvePath",this.curves=[],this.autoClose=!1}add(t){this.curves.push(t)}closePath(){const t=this.curves[0].getPoint(0),e=this.curves[this.curves.length-1].getPoint(1);t.equals(e)||this.curves.push(new wd(e,t))}getPoint(t,e){const n=t*this.getLength(),i=this.getCurveLengths();let r=0;for(;r<i.length;){if(i[r]>=n){const o=i[r]-n,a=this.curves[r],l=a.getLength(),c=l===0?0:1-o/l;return a.getPointAt(c,e)}r++}return null}getLength(){const t=this.getCurveLengths();return t[t.length-1]}updateArcLengths(){this.needsUpdate=!0,this.cacheLengths=null,this.getCurveLengths()}getCurveLengths(){if(this.cacheLengths&&this.cacheLengths.length===this.curves.length)return this.cacheLengths;const t=[];let e=0;for(let n=0,i=this.curves.length;n<i;n++)e+=this.curves[n].getLength(),t.push(e);return this.cacheLengths=t,t}getSpacedPoints(t=40){const e=[];for(let n=0;n<=t;n++)e.push(this.getPoint(n/t));return this.autoClose&&e.push(e[0]),e}getPoints(t=12){const e=[];let n;for(let i=0,r=this.curves;i<r.length;i++){const o=r[i],a=o.isEllipseCurve?t*2:o.isLineCurve||o.isLineCurve3?1:o.isSplineCurve?t*o.points.length:t,l=o.getPoints(a);for(let c=0;c<l.length;c++){const h=l[c];n&&n.equals(h)||(e.push(h),n=h)}}return this.autoClose&&e.length>1&&!e[e.length-1].equals(e[0])&&e.push(e[0]),e}copy(t){super.copy(t),this.curves=[];for(let e=0,n=t.curves.length;e<n;e++){const i=t.curves[e];this.curves.push(i.clone())}return this.autoClose=t.autoClose,this}toJSON(){const t=super.toJSON();t.autoClose=this.autoClose,t.curves=[];for(let e=0,n=this.curves.length;e<n;e++){const i=this.curves[e];t.curves.push(i.toJSON())}return t}fromJSON(t){super.fromJSON(t),this.autoClose=t.autoClose,this.curves=[];for(let e=0,n=t.curves.length;e<n;e++){const i=t.curves[e];this.curves.push(new C_[i.type]().fromJSON(i))}return this}}class Kc extends $S{constructor(t){super(),this.type="Path",this.currentPoint=new pt,t&&this.setFromPoints(t)}setFromPoints(t){this.moveTo(t[0].x,t[0].y);for(let e=1,n=t.length;e<n;e++)this.lineTo(t[e].x,t[e].y);return this}moveTo(t,e){return this.currentPoint.set(t,e),this}lineTo(t,e){const n=new wd(this.currentPoint.clone(),new pt(t,e));return this.curves.push(n),this.currentPoint.set(t,e),this}quadraticCurveTo(t,e,n,i){const r=new A_(this.currentPoint.clone(),new pt(t,e),new pt(n,i));return this.curves.push(r),this.currentPoint.set(n,i),this}bezierCurveTo(t,e,n,i,r,o){const a=new S_(this.currentPoint.clone(),new pt(t,e),new pt(n,i),new pt(r,o));return this.curves.push(a),this.currentPoint.set(r,o),this}splineThru(t){const e=[this.currentPoint.clone()].concat(t),n=new T_(e);return this.curves.push(n),this.currentPoint.copy(t[t.length-1]),this}arc(t,e,n,i,r,o){const a=this.currentPoint.x,l=this.currentPoint.y;return this.absarc(t+a,e+l,n,i,r,o),this}absarc(t,e,n,i,r,o){return this.absellipse(t,e,n,n,i,r,o),this}ellipse(t,e,n,i,r,o,a,l){const c=this.currentPoint.x,h=this.currentPoint.y;return this.absellipse(t+c,e+h,n,i,r,o,a,l),this}absellipse(t,e,n,i,r,o,a,l){const c=new bd(t,e,n,i,r,o,a,l);if(this.curves.length>0){const f=c.getPoint(0);f.equals(this.currentPoint)||this.lineTo(f.x,f.y)}this.curves.push(c);const h=c.getPoint(1);return this.currentPoint.copy(h),this}copy(t){return super.copy(t),this.currentPoint.copy(t.currentPoint),this}toJSON(){const t=super.toJSON();return t.currentPoint=this.currentPoint.toArray(),t}fromJSON(t){return super.fromJSON(t),this.currentPoint.fromArray(t.currentPoint),this}}class wu extends we{constructor(t=[new pt(0,-.5),new pt(.5,0),new pt(0,.5)],e=12,n=0,i=Math.PI*2){super(),this.type="LatheGeometry",this.parameters={points:t,segments:e,phiStart:n,phiLength:i},e=Math.floor(e),i=yn(i,0,Math.PI*2);const r=[],o=[],a=[],l=[],c=[],h=1/e,f=new N,d=new pt,m=new N,g=new N,y=new N;let _=0,v=0;for(let w=0;w<=t.length-1;w++)switch(w){case 0:_=t[w+1].x-t[w].x,v=t[w+1].y-t[w].y,m.x=v*1,m.y=-_,m.z=v*0,y.copy(m),m.normalize(),l.push(m.x,m.y,m.z);break;case t.length-1:l.push(y.x,y.y,y.z);break;default:_=t[w+1].x-t[w].x,v=t[w+1].y-t[w].y,m.x=v*1,m.y=-_,m.z=v*0,g.copy(m),m.x+=y.x,m.y+=y.y,m.z+=y.z,m.normalize(),l.push(m.x,m.y,m.z),y.copy(g)}for(let w=0;w<=e;w++){const b=n+w*h*i,M=Math.sin(b),A=Math.cos(b);for(let T=0;T<=t.length-1;T++){f.x=t[T].x*M,f.y=t[T].y,f.z=t[T].x*A,o.push(f.x,f.y,f.z),d.x=w/e,d.y=T/(t.length-1),a.push(d.x,d.y);const P=l[3*T+0]*M,C=l[3*T+1],S=l[3*T+0]*A;c.push(P,C,S)}}for(let w=0;w<e;w++)for(let b=0;b<t.length-1;b++){const M=b+w*t.length,A=M,T=M+t.length,P=M+t.length+1,C=M+1;r.push(A,T,C),r.push(P,C,T)}this.setIndex(r),this.setAttribute("position",new jt(o,3)),this.setAttribute("uv",new jt(a,2)),this.setAttribute("normal",new jt(c,3))}copy(t){return super.copy(t),this.parameters=Object.assign({},t.parameters),this}static fromJSON(t){return new wu(t.points,t.segments,t.phiStart,t.phiLength)}}class Md extends wu{constructor(t=1,e=1,n=4,i=8){const r=new Kc;r.absarc(0,-e/2,t,Math.PI*1.5,0),r.absarc(0,e/2,t,0,Math.PI*.5),super(r.getPoints(n),i),this.type="CapsuleGeometry",this.parameters={radius:t,length:e,capSegments:n,radialSegments:i}}static fromJSON(t){return new Md(t.radius,t.length,t.capSegments,t.radialSegments)}}class Sd extends we{constructor(t=1,e=32,n=0,i=Math.PI*2){super(),this.type="CircleGeometry",this.parameters={radius:t,segments:e,thetaStart:n,thetaLength:i},e=Math.max(3,e);const r=[],o=[],a=[],l=[],c=new N,h=new pt;o.push(0,0,0),a.push(0,0,1),l.push(.5,.5);for(let f=0,d=3;f<=e;f++,d+=3){const m=n+f/e*i;c.x=t*Math.cos(m),c.y=t*Math.sin(m),o.push(c.x,c.y,c.z),a.push(0,0,1),h.x=(o[d]/t+1)/2,h.y=(o[d+1]/t+1)/2,l.push(h.x,h.y)}for(let f=1;f<=e;f++)r.push(f,f+1,0);this.setIndex(r),this.setAttribute("position",new jt(o,3)),this.setAttribute("normal",new jt(a,3)),this.setAttribute("uv",new jt(l,2))}copy(t){return super.copy(t),this.parameters=Object.assign({},t.parameters),this}static fromJSON(t){return new Sd(t.radius,t.segments,t.thetaStart,t.thetaLength)}}class kl extends we{constructor(t=1,e=1,n=1,i=32,r=1,o=!1,a=0,l=Math.PI*2){super(),this.type="CylinderGeometry",this.parameters={radiusTop:t,radiusBottom:e,height:n,radialSegments:i,heightSegments:r,openEnded:o,thetaStart:a,thetaLength:l};const c=this;i=Math.floor(i),r=Math.floor(r);const h=[],f=[],d=[],m=[];let g=0;const y=[],_=n/2;let v=0;w(),o===!1&&(t>0&&b(!0),e>0&&b(!1)),this.setIndex(h),this.setAttribute("position",new jt(f,3)),this.setAttribute("normal",new jt(d,3)),this.setAttribute("uv",new jt(m,2));function w(){const M=new N,A=new N;let T=0;const P=(e-t)/n;for(let C=0;C<=r;C++){const S=[],L=C/r,H=L*(e-t)+t;for(let $=0;$<=i;$++){const B=$/i,G=B*l+a,I=Math.sin(G),et=Math.cos(G);A.x=H*I,A.y=-L*n+_,A.z=H*et,f.push(A.x,A.y,A.z),M.set(I,P,et).normalize(),d.push(M.x,M.y,M.z),m.push(B,1-L),S.push(g++)}y.push(S)}for(let C=0;C<i;C++)for(let S=0;S<r;S++){const L=y[S][C],H=y[S+1][C],$=y[S+1][C+1],B=y[S][C+1];h.push(L,H,B),h.push(H,$,B),T+=6}c.addGroup(v,T,0),v+=T}function b(M){const A=g,T=new pt,P=new N;let C=0;const S=M===!0?t:e,L=M===!0?1:-1;for(let $=1;$<=i;$++)f.push(0,_*L,0),d.push(0,L,0),m.push(.5,.5),g++;const H=g;for(let $=0;$<=i;$++){const G=$/i*l+a,I=Math.cos(G),et=Math.sin(G);P.x=S*et,P.y=_*L,P.z=S*I,f.push(P.x,P.y,P.z),d.push(0,L,0),T.x=I*.5+.5,T.y=et*.5*L+.5,m.push(T.x,T.y),g++}for(let $=0;$<i;$++){const B=A+$,G=H+$;M===!0?h.push(G,G+1,B):h.push(G+1,G,B),C+=3}c.addGroup(v,C,M===!0?1:2),v+=C}}copy(t){return super.copy(t),this.parameters=Object.assign({},t.parameters),this}static fromJSON(t){return new kl(t.radiusTop,t.radiusBottom,t.height,t.radialSegments,t.heightSegments,t.openEnded,t.thetaStart,t.thetaLength)}}class Ad extends kl{constructor(t=1,e=1,n=32,i=1,r=!1,o=0,a=Math.PI*2){super(0,t,e,n,i,r,o,a),this.type="ConeGeometry",this.parameters={radius:t,height:e,radialSegments:n,heightSegments:i,openEnded:r,thetaStart:o,thetaLength:a}}static fromJSON(t){return new Ad(t.radius,t.height,t.radialSegments,t.heightSegments,t.openEnded,t.thetaStart,t.thetaLength)}}class co extends we{constructor(t=[],e=[],n=1,i=0){super(),this.type="PolyhedronGeometry",this.parameters={vertices:t,indices:e,radius:n,detail:i};const r=[],o=[];a(i),c(n),h(),this.setAttribute("position",new jt(r,3)),this.setAttribute("normal",new jt(r.slice(),3)),this.setAttribute("uv",new jt(o,2)),i===0?this.computeVertexNormals():this.normalizeNormals();function a(w){const b=new N,M=new N,A=new N;for(let T=0;T<e.length;T+=3)m(e[T+0],b),m(e[T+1],M),m(e[T+2],A),l(b,M,A,w)}function l(w,b,M,A){const T=A+1,P=[];for(let C=0;C<=T;C++){P[C]=[];const S=w.clone().lerp(M,C/T),L=b.clone().lerp(M,C/T),H=T-C;for(let $=0;$<=H;$++)$===0&&C===T?P[C][$]=S:P[C][$]=S.clone().lerp(L,$/H)}for(let C=0;C<T;C++)for(let S=0;S<2*(T-C)-1;S++){const L=Math.floor(S/2);S%2===0?(d(P[C][L+1]),d(P[C+1][L]),d(P[C][L])):(d(P[C][L+1]),d(P[C+1][L+1]),d(P[C+1][L]))}}function c(w){const b=new N;for(let M=0;M<r.length;M+=3)b.x=r[M+0],b.y=r[M+1],b.z=r[M+2],b.normalize().multiplyScalar(w),r[M+0]=b.x,r[M+1]=b.y,r[M+2]=b.z}function h(){const w=new N;for(let b=0;b<r.length;b+=3){w.x=r[b+0],w.y=r[b+1],w.z=r[b+2];const M=_(w)/2/Math.PI+.5,A=v(w)/Math.PI+.5;o.push(M,1-A)}g(),f()}function f(){for(let w=0;w<o.length;w+=6){const b=o[w+0],M=o[w+2],A=o[w+4],T=Math.max(b,M,A),P=Math.min(b,M,A);T>.9&&P<.1&&(b<.2&&(o[w+0]+=1),M<.2&&(o[w+2]+=1),A<.2&&(o[w+4]+=1))}}function d(w){r.push(w.x,w.y,w.z)}function m(w,b){const M=w*3;b.x=t[M+0],b.y=t[M+1],b.z=t[M+2]}function g(){const w=new N,b=new N,M=new N,A=new N,T=new pt,P=new pt,C=new pt;for(let S=0,L=0;S<r.length;S+=9,L+=6){w.set(r[S+0],r[S+1],r[S+2]),b.set(r[S+3],r[S+4],r[S+5]),M.set(r[S+6],r[S+7],r[S+8]),T.set(o[L+0],o[L+1]),P.set(o[L+2],o[L+3]),C.set(o[L+4],o[L+5]),A.copy(w).add(b).add(M).divideScalar(3);const H=_(A);y(T,L+0,w,H),y(P,L+2,b,H),y(C,L+4,M,H)}}function y(w,b,M,A){A<0&&w.x===1&&(o[b]=w.x-1),M.x===0&&M.z===0&&(o[b]=A/2/Math.PI+.5)}function _(w){return Math.atan2(w.z,-w.x)}function v(w){return Math.atan2(-w.y,Math.sqrt(w.x*w.x+w.z*w.z))}}copy(t){return super.copy(t),this.parameters=Object.assign({},t.parameters),this}static fromJSON(t){return new co(t.vertices,t.indices,t.radius,t.details)}}class Ed extends co{constructor(t=1,e=0){const n=(1+Math.sqrt(5))/2,i=1/n,r=[-1,-1,-1,-1,-1,1,-1,1,-1,-1,1,1,1,-1,-1,1,-1,1,1,1,-1,1,1,1,0,-i,-n,0,-i,n,0,i,-n,0,i,n,-i,-n,0,-i,n,0,i,-n,0,i,n,0,-n,0,-i,n,0,-i,-n,0,i,n,0,i],o=[3,11,7,3,7,15,3,15,13,7,19,17,7,17,6,7,6,15,17,4,8,17,8,10,17,10,6,8,0,16,8,16,2,8,2,10,0,12,1,0,1,18,0,18,16,6,10,2,6,2,13,6,13,15,2,16,18,2,18,3,2,3,13,18,1,9,18,9,11,18,11,3,4,14,12,4,12,0,4,0,8,11,9,5,11,5,19,11,19,7,19,5,14,19,14,4,19,4,17,1,12,14,1,14,5,1,5,9];super(r,o,t,e),this.type="DodecahedronGeometry",this.parameters={radius:t,detail:e}}static fromJSON(t){return new Ed(t.radius,t.detail)}}const Qh=new N,tf=new N,ig=new N,ef=new gi;class XS extends we{constructor(t=null,e=1){if(super(),this.type="EdgesGeometry",this.parameters={geometry:t,thresholdAngle:e},t!==null){const i=Math.pow(10,4),r=Math.cos($o*e),o=t.getIndex(),a=t.getAttribute("position"),l=o?o.count:a.count,c=[0,0,0],h=["a","b","c"],f=new Array(3),d={},m=[];for(let g=0;g<l;g+=3){o?(c[0]=o.getX(g),c[1]=o.getX(g+1),c[2]=o.getX(g+2)):(c[0]=g,c[1]=g+1,c[2]=g+2);const{a:y,b:_,c:v}=ef;if(y.fromBufferAttribute(a,c[0]),_.fromBufferAttribute(a,c[1]),v.fromBufferAttribute(a,c[2]),ef.getNormal(ig),f[0]=`${Math.round(y.x*i)},${Math.round(y.y*i)},${Math.round(y.z*i)}`,f[1]=`${Math.round(_.x*i)},${Math.round(_.y*i)},${Math.round(_.z*i)}`,f[2]=`${Math.round(v.x*i)},${Math.round(v.y*i)},${Math.round(v.z*i)}`,!(f[0]===f[1]||f[1]===f[2]||f[2]===f[0]))for(let w=0;w<3;w++){const b=(w+1)%3,M=f[w],A=f[b],T=ef[h[w]],P=ef[h[b]],C=`${M}_${A}`,S=`${A}_${M}`;S in d&&d[S]?(ig.dot(d[S].normal)<=r&&(m.push(T.x,T.y,T.z),m.push(P.x,P.y,P.z)),d[S]=null):C in d||(d[C]={index0:c[w],index1:c[b],normal:ig.clone()})}}for(const g in d)if(d[g]){const{index0:y,index1:_}=d[g];Qh.fromBufferAttribute(a,y),tf.fromBufferAttribute(a,_),m.push(Qh.x,Qh.y,Qh.z),m.push(tf.x,tf.y,tf.z)}this.setAttribute("position",new jt(m,3))}}copy(t){return super.copy(t),this.parameters=Object.assign({},t.parameters),this}}class Xo extends Kc{constructor(t){super(t),this.uuid=qi(),this.type="Shape",this.holes=[]}getPointsHoles(t){const e=[];for(let n=0,i=this.holes.length;n<i;n++)e[n]=this.holes[n].getPoints(t);return e}extractPoints(t){return{shape:this.getPoints(t),holes:this.getPointsHoles(t)}}copy(t){super.copy(t),this.holes=[];for(let e=0,n=t.holes.length;e<n;e++){const i=t.holes[e];this.holes.push(i.clone())}return this}toJSON(){const t=super.toJSON();t.uuid=this.uuid,t.holes=[];for(let e=0,n=this.holes.length;e<n;e++){const i=this.holes[e];t.holes.push(i.toJSON())}return t}fromJSON(t){super.fromJSON(t),this.uuid=t.uuid,this.holes=[];for(let e=0,n=t.holes.length;e<n;e++){const i=t.holes[e];this.holes.push(new Kc().fromJSON(i))}return this}}const $4={triangulate:function(s,t,e=2){const n=t&&t.length,i=n?t[0]*e:s.length;let r=jS(s,0,i,e,!0);const o=[];if(!r||r.next===r.prev)return o;let a,l,c,h,f,d,m;if(n&&(r=K4(s,t,r,e)),s.length>80*e){a=c=s[0],l=h=s[1];for(let g=e;g<i;g+=e)f=s[g],d=s[g+1],f<a&&(a=f),d<l&&(l=d),f>c&&(c=f),d>h&&(h=d);m=Math.max(c-a,h-l),m=m!==0?32767/m:0}return Jc(r,o,e,a,l,m,0),o}};function jS(s,t,e,n,i){let r,o;if(i===lB(s,t,e,n)>0)for(r=t;r<e;r+=n)o=hw(r,s[r],s[r+1],o);else for(r=e-n;r>=t;r-=n)o=hw(r,s[r],s[r+1],o);return o&&Td(o,o.next)&&(tu(o),o=o.next),o}function Jo(s,t){if(!s)return s;t||(t=s);let e=s,n;do if(n=!1,!e.steiner&&(Td(e,e.next)||dn(e.prev,e,e.next)===0)){if(tu(e),e=t=e.prev,e===e.next)break;n=!0}else e=e.next;while(n||e!==t);return t}function Jc(s,t,e,n,i,r,o){if(!s)return;!o&&r&&nB(s,n,i,r);let a=s,l,c;for(;s.prev!==s.next;){if(l=s.prev,c=s.next,r?j4(s,n,i,r):X4(s)){t.push(l.i/e|0),t.push(s.i/e|0),t.push(c.i/e|0),tu(s),s=c.next,a=c.next;continue}if(s=c,s===a){o?o===1?(s=Y4(Jo(s),t,e),Jc(s,t,e,n,i,r,2)):o===2&&Z4(s,t,e,n,i,r):Jc(Jo(s),t,e,n,i,r,1);break}}}function X4(s){const t=s.prev,e=s,n=s.next;if(dn(t,e,n)>=0)return!1;const i=t.x,r=e.x,o=n.x,a=t.y,l=e.y,c=n.y,h=i<r?i<o?i:o:r<o?r:o,f=a<l?a<c?a:c:l<c?l:c,d=i>r?i>o?i:o:r>o?r:o,m=a>l?a>c?a:c:l>c?l:c;let g=n.next;for(;g!==t;){if(g.x>=h&&g.x<=d&&g.y>=f&&g.y<=m&&ll(i,a,r,l,o,c,g.x,g.y)&&dn(g.prev,g,g.next)>=0)return!1;g=g.next}return!0}function j4(s,t,e,n){const i=s.prev,r=s,o=s.next;if(dn(i,r,o)>=0)return!1;const a=i.x,l=r.x,c=o.x,h=i.y,f=r.y,d=o.y,m=a<l?a<c?a:c:l<c?l:c,g=h<f?h<d?h:d:f<d?f:d,y=a>l?a>c?a:c:l>c?l:c,_=h>f?h>d?h:d:f>d?f:d,v=av(m,g,t,e,n),w=av(y,_,t,e,n);let b=s.prevZ,M=s.nextZ;for(;b&&b.z>=v&&M&&M.z<=w;){if(b.x>=m&&b.x<=y&&b.y>=g&&b.y<=_&&b!==i&&b!==o&&ll(a,h,l,f,c,d,b.x,b.y)&&dn(b.prev,b,b.next)>=0||(b=b.prevZ,M.x>=m&&M.x<=y&&M.y>=g&&M.y<=_&&M!==i&&M!==o&&ll(a,h,l,f,c,d,M.x,M.y)&&dn(M.prev,M,M.next)>=0))return!1;M=M.nextZ}for(;b&&b.z>=v;){if(b.x>=m&&b.x<=y&&b.y>=g&&b.y<=_&&b!==i&&b!==o&&ll(a,h,l,f,c,d,b.x,b.y)&&dn(b.prev,b,b.next)>=0)return!1;b=b.prevZ}for(;M&&M.z<=w;){if(M.x>=m&&M.x<=y&&M.y>=g&&M.y<=_&&M!==i&&M!==o&&ll(a,h,l,f,c,d,M.x,M.y)&&dn(M.prev,M,M.next)>=0)return!1;M=M.nextZ}return!0}function Y4(s,t,e){let n=s;do{const i=n.prev,r=n.next.next;!Td(i,r)&&YS(i,n,n.next,r)&&Qc(i,r)&&Qc(r,i)&&(t.push(i.i/e|0),t.push(n.i/e|0),t.push(r.i/e|0),tu(n),tu(n.next),n=s=r),n=n.next}while(n!==s);return Jo(n)}function Z4(s,t,e,n,i,r){let o=s;do{let a=o.next.next;for(;a!==o.prev;){if(o.i!==a.i&&rB(o,a)){let l=ZS(o,a);o=Jo(o,o.next),l=Jo(l,l.next),Jc(o,t,e,n,i,r,0),Jc(l,t,e,n,i,r,0);return}a=a.next}o=o.next}while(o!==s)}function K4(s,t,e,n){const i=[];let r,o,a,l,c;for(r=0,o=t.length;r<o;r++)a=t[r]*n,l=r<o-1?t[r+1]*n:s.length,c=jS(s,a,l,n,!1),c===c.next&&(c.steiner=!0),i.push(sB(c));for(i.sort(J4),r=0;r<i.length;r++)e=Q4(i[r],e);return e}function J4(s,t){return s.x-t.x}function Q4(s,t){const e=tB(s,t);if(!e)return t;const n=ZS(e,s);return Jo(n,n.next),Jo(e,e.next)}function tB(s,t){let e=t,n=-1/0,i;const r=s.x,o=s.y;do{if(o<=e.y&&o>=e.next.y&&e.next.y!==e.y){const d=e.x+(o-e.y)*(e.next.x-e.x)/(e.next.y-e.y);if(d<=r&&d>n&&(n=d,i=e.x<e.next.x?e:e.next,d===r))return i}e=e.next}while(e!==t);if(!i)return null;const a=i,l=i.x,c=i.y;let h=1/0,f;e=i;do r>=e.x&&e.x>=l&&r!==e.x&&ll(o<c?r:n,o,l,c,o<c?n:r,o,e.x,e.y)&&(f=Math.abs(o-e.y)/(r-e.x),Qc(e,s)&&(f<h||f===h&&(e.x>i.x||e.x===i.x&&eB(i,e)))&&(i=e,h=f)),e=e.next;while(e!==a);return i}function eB(s,t){return dn(s.prev,s,t.prev)<0&&dn(t.next,s,s.next)<0}function nB(s,t,e,n){let i=s;do i.z===0&&(i.z=av(i.x,i.y,t,e,n)),i.prevZ=i.prev,i.nextZ=i.next,i=i.next;while(i!==s);i.prevZ.nextZ=null,i.prevZ=null,iB(i)}function iB(s){let t,e,n,i,r,o,a,l,c=1;do{for(e=s,s=null,r=null,o=0;e;){for(o++,n=e,a=0,t=0;t<c&&(a++,n=n.nextZ,!!n);t++);for(l=c;a>0||l>0&&n;)a!==0&&(l===0||!n||e.z<=n.z)?(i=e,e=e.nextZ,a--):(i=n,n=n.nextZ,l--),r?r.nextZ=i:s=i,i.prevZ=r,r=i;e=n}r.nextZ=null,c*=2}while(o>1);return s}function av(s,t,e,n,i){return s=(s-e)*i|0,t=(t-n)*i|0,s=(s|s<<8)&16711935,s=(s|s<<4)&252645135,s=(s|s<<2)&858993459,s=(s|s<<1)&1431655765,t=(t|t<<8)&16711935,t=(t|t<<4)&252645135,t=(t|t<<2)&858993459,t=(t|t<<1)&1431655765,s|t<<1}function sB(s){let t=s,e=s;do(t.x<e.x||t.x===e.x&&t.y<e.y)&&(e=t),t=t.next;while(t!==s);return e}function ll(s,t,e,n,i,r,o,a){return(i-o)*(t-a)>=(s-o)*(r-a)&&(s-o)*(n-a)>=(e-o)*(t-a)&&(e-o)*(r-a)>=(i-o)*(n-a)}function rB(s,t){return s.next.i!==t.i&&s.prev.i!==t.i&&!oB(s,t)&&(Qc(s,t)&&Qc(t,s)&&aB(s,t)&&(dn(s.prev,s,t.prev)||dn(s,t.prev,t))||Td(s,t)&&dn(s.prev,s,s.next)>0&&dn(t.prev,t,t.next)>0)}function dn(s,t,e){return(t.y-s.y)*(e.x-t.x)-(t.x-s.x)*(e.y-t.y)}function Td(s,t){return s.x===t.x&&s.y===t.y}function YS(s,t,e,n){const i=sf(dn(s,t,e)),r=sf(dn(s,t,n)),o=sf(dn(e,n,s)),a=sf(dn(e,n,t));return!!(i!==r&&o!==a||i===0&&nf(s,e,t)||r===0&&nf(s,n,t)||o===0&&nf(e,s,n)||a===0&&nf(e,t,n))}function nf(s,t,e){return t.x<=Math.max(s.x,e.x)&&t.x>=Math.min(s.x,e.x)&&t.y<=Math.max(s.y,e.y)&&t.y>=Math.min(s.y,e.y)}function sf(s){return s>0?1:s<0?-1:0}function oB(s,t){let e=s;do{if(e.i!==s.i&&e.next.i!==s.i&&e.i!==t.i&&e.next.i!==t.i&&YS(e,e.next,s,t))return!0;e=e.next}while(e!==s);return!1}function Qc(s,t){return dn(s.prev,s,s.next)<0?dn(s,t,s.next)>=0&&dn(s,s.prev,t)>=0:dn(s,t,s.prev)<0||dn(s,s.next,t)<0}function aB(s,t){let e=s,n=!1;const i=(s.x+t.x)/2,r=(s.y+t.y)/2;do e.y>r!=e.next.y>r&&e.next.y!==e.y&&i<(e.next.x-e.x)*(r-e.y)/(e.next.y-e.y)+e.x&&(n=!n),e=e.next;while(e!==s);return n}function ZS(s,t){const e=new lv(s.i,s.x,s.y),n=new lv(t.i,t.x,t.y),i=s.next,r=t.prev;return s.next=t,t.prev=s,e.next=i,i.prev=e,n.next=e,e.prev=n,r.next=n,n.prev=r,n}function hw(s,t,e,n){const i=new lv(s,t,e);return n?(i.next=n.next,i.prev=n,n.next.prev=i,n.next=i):(i.prev=i,i.next=i),i}function tu(s){s.next.prev=s.prev,s.prev.next=s.next,s.prevZ&&(s.prevZ.nextZ=s.nextZ),s.nextZ&&(s.nextZ.prevZ=s.prevZ)}function lv(s,t,e){this.i=s,this.x=t,this.y=e,this.prev=null,this.next=null,this.z=0,this.prevZ=null,this.nextZ=null,this.steiner=!1}function lB(s,t,e,n){let i=0;for(let r=t,o=e-n;r<e;r+=n)i+=(s[o]-s[r])*(s[r+1]+s[o+1]),o=r;return i}class Hs{static area(t){const e=t.length;let n=0;for(let i=e-1,r=0;r<e;i=r++)n+=t[i].x*t[r].y-t[r].x*t[i].y;return n*.5}static isClockWise(t){return Hs.area(t)<0}static triangulateShape(t,e){const n=[],i=[],r=[];fw(t),dw(n,t);let o=t.length;e.forEach(fw);for(let l=0;l<e.length;l++)i.push(o),o+=e[l].length,dw(n,e[l]);const a=$4.triangulate(n,i);for(let l=0;l<a.length;l+=3)r.push(a.slice(l,l+3));return r}}function fw(s){const t=s.length;t>2&&s[t-1].equals(s[0])&&s.pop()}function dw(s,t){for(let e=0;e<t.length;e++)s.push(t[e].x),s.push(t[e].y)}class Cd extends we{constructor(t=new Xo([new pt(.5,.5),new pt(-.5,.5),new pt(-.5,-.5),new pt(.5,-.5)]),e={}){super(),this.type="ExtrudeGeometry",this.parameters={shapes:t,options:e},t=Array.isArray(t)?t:[t];const n=this,i=[],r=[];for(let a=0,l=t.length;a<l;a++){const c=t[a];o(c)}this.setAttribute("position",new jt(i,3)),this.setAttribute("uv",new jt(r,2)),this.computeVertexNormals();function o(a){const l=[],c=e.curveSegments!==void 0?e.curveSegments:12,h=e.steps!==void 0?e.steps:1,f=e.depth!==void 0?e.depth:1;let d=e.bevelEnabled!==void 0?e.bevelEnabled:!0,m=e.bevelThickness!==void 0?e.bevelThickness:.2,g=e.bevelSize!==void 0?e.bevelSize:m-.1,y=e.bevelOffset!==void 0?e.bevelOffset:0,_=e.bevelSegments!==void 0?e.bevelSegments:3;const v=e.extrudePath,w=e.UVGenerator!==void 0?e.UVGenerator:cB;let b,M=!1,A,T,P,C;v&&(b=v.getSpacedPoints(h),M=!0,d=!1,A=v.computeFrenetFrames(h,!1),T=new N,P=new N,C=new N),d||(_=0,m=0,g=0,y=0);const S=a.extractPoints(c);let L=S.shape;const H=S.holes;if(!Hs.isClockWise(L)){L=L.reverse();for(let Mt=0,X=H.length;Mt<X;Mt++){const bt=H[Mt];Hs.isClockWise(bt)&&(H[Mt]=bt.reverse())}}const B=Hs.triangulateShape(L,H),G=L;for(let Mt=0,X=H.length;Mt<X;Mt++){const bt=H[Mt];L=L.concat(bt)}function I(Mt,X,bt){return X||console.error("THREE.ExtrudeGeometry: vec does not exist"),Mt.clone().addScaledVector(X,bt)}const et=L.length,Y=B.length;function J(Mt,X,bt){let W,st,ct;const Ct=Mt.x-X.x,wt=Mt.y-X.y,Tt=bt.x-Mt.x,Xt=bt.y-Mt.y,Qt=Ct*Ct+wt*wt,U=Ct*Xt-wt*Tt;if(Math.abs(U)>Number.EPSILON){const k=Math.sqrt(Qt),ht=Math.sqrt(Tt*Tt+Xt*Xt),St=X.x-wt/k,Et=X.y+Ct/k,Dt=bt.x-Xt/ht,Jt=bt.y+Tt/ht,tt=((Dt-St)*Xt-(Jt-Et)*Tt)/(Ct*Xt-wt*Tt);W=St+Ct*tt-Mt.x,st=Et+wt*tt-Mt.y;const Q=W*W+st*st;if(Q<=2)return new pt(W,st);ct=Math.sqrt(Q/2)}else{let k=!1;Ct>Number.EPSILON?Tt>Number.EPSILON&&(k=!0):Ct<-Number.EPSILON?Tt<-Number.EPSILON&&(k=!0):Math.sign(wt)===Math.sign(Xt)&&(k=!0),k?(W=-wt,st=Ct,ct=Math.sqrt(Qt)):(W=Ct,st=wt,ct=Math.sqrt(Qt/2))}return new pt(W/ct,st/ct)}const ut=[];for(let Mt=0,X=G.length,bt=X-1,W=Mt+1;Mt<X;Mt++,bt++,W++)bt===X&&(bt=0),W===X&&(W=0),ut[Mt]=J(G[Mt],G[bt],G[W]);const dt=[];let nt,ft=ut.concat();for(let Mt=0,X=H.length;Mt<X;Mt++){const bt=H[Mt];nt=[];for(let W=0,st=bt.length,ct=st-1,Ct=W+1;W<st;W++,ct++,Ct++)ct===st&&(ct=0),Ct===st&&(Ct=0),nt[W]=J(bt[W],bt[ct],bt[Ct]);dt.push(nt),ft=ft.concat(nt)}for(let Mt=0;Mt<_;Mt++){const X=Mt/_,bt=m*Math.cos(X*Math.PI/2),W=g*Math.sin(X*Math.PI/2)+y;for(let st=0,ct=G.length;st<ct;st++){const Ct=I(G[st],ut[st],W);Ht(Ct.x,Ct.y,-bt)}for(let st=0,ct=H.length;st<ct;st++){const Ct=H[st];nt=dt[st];for(let wt=0,Tt=Ct.length;wt<Tt;wt++){const Xt=I(Ct[wt],nt[wt],W);Ht(Xt.x,Xt.y,-bt)}}}const Lt=g+y;for(let Mt=0;Mt<et;Mt++){const X=d?I(L[Mt],ft[Mt],Lt):L[Mt];M?(P.copy(A.normals[0]).multiplyScalar(X.x),T.copy(A.binormals[0]).multiplyScalar(X.y),C.copy(b[0]).add(P).add(T),Ht(C.x,C.y,C.z)):Ht(X.x,X.y,0)}for(let Mt=1;Mt<=h;Mt++)for(let X=0;X<et;X++){const bt=d?I(L[X],ft[X],Lt):L[X];M?(P.copy(A.normals[Mt]).multiplyScalar(bt.x),T.copy(A.binormals[Mt]).multiplyScalar(bt.y),C.copy(b[Mt]).add(P).add(T),Ht(C.x,C.y,C.z)):Ht(bt.x,bt.y,f/h*Mt)}for(let Mt=_-1;Mt>=0;Mt--){const X=Mt/_,bt=m*Math.cos(X*Math.PI/2),W=g*Math.sin(X*Math.PI/2)+y;for(let st=0,ct=G.length;st<ct;st++){const Ct=I(G[st],ut[st],W);Ht(Ct.x,Ct.y,f+bt)}for(let st=0,ct=H.length;st<ct;st++){const Ct=H[st];nt=dt[st];for(let wt=0,Tt=Ct.length;wt<Tt;wt++){const Xt=I(Ct[wt],nt[wt],W);M?Ht(Xt.x,Xt.y+b[h-1].y,b[h-1].x+bt):Ht(Xt.x,Xt.y,f+bt)}}}Ot(),It();function Ot(){const Mt=i.length/3;if(d){let X=0,bt=et*X;for(let W=0;W<Y;W++){const st=B[W];qt(st[2]+bt,st[1]+bt,st[0]+bt)}X=h+_*2,bt=et*X;for(let W=0;W<Y;W++){const st=B[W];qt(st[0]+bt,st[1]+bt,st[2]+bt)}}else{for(let X=0;X<Y;X++){const bt=B[X];qt(bt[2],bt[1],bt[0])}for(let X=0;X<Y;X++){const bt=B[X];qt(bt[0]+et*h,bt[1]+et*h,bt[2]+et*h)}}n.addGroup(Mt,i.length/3-Mt,0)}function It(){const Mt=i.length/3;let X=0;Kt(G,X),X+=G.length;for(let bt=0,W=H.length;bt<W;bt++){const st=H[bt];Kt(st,X),X+=st.length}n.addGroup(Mt,i.length/3-Mt,1)}function Kt(Mt,X){let bt=Mt.length;for(;--bt>=0;){const W=bt;let st=bt-1;st<0&&(st=Mt.length-1);for(let ct=0,Ct=h+_*2;ct<Ct;ct++){const wt=et*ct,Tt=et*(ct+1),Xt=X+W+wt,Qt=X+st+wt,U=X+st+Tt,k=X+W+Tt;ee(Xt,Qt,U,k)}}}function Ht(Mt,X,bt){l.push(Mt),l.push(X),l.push(bt)}function qt(Mt,X,bt){le(Mt),le(X),le(bt);const W=i.length/3,st=w.generateTopUV(n,i,W-3,W-2,W-1);$t(st[0]),$t(st[1]),$t(st[2])}function ee(Mt,X,bt,W){le(Mt),le(X),le(W),le(X),le(bt),le(W);const st=i.length/3,ct=w.generateSideWallUV(n,i,st-6,st-3,st-2,st-1);$t(ct[0]),$t(ct[1]),$t(ct[3]),$t(ct[1]),$t(ct[2]),$t(ct[3])}function le(Mt){i.push(l[Mt*3+0]),i.push(l[Mt*3+1]),i.push(l[Mt*3+2])}function $t(Mt){r.push(Mt.x),r.push(Mt.y)}}}copy(t){return super.copy(t),this.parameters=Object.assign({},t.parameters),this}toJSON(){const t=super.toJSON(),e=this.parameters.shapes,n=this.parameters.options;return uB(e,n,t)}static fromJSON(t,e){const n=[];for(let r=0,o=t.shapes.length;r<o;r++){const a=e[t.shapes[r]];n.push(a)}const i=t.options.extrudePath;return i!==void 0&&(t.options.extrudePath=new C_[i.type]().fromJSON(i)),new Cd(n,t.options)}}const cB={generateTopUV:function(s,t,e,n,i){const r=t[e*3],o=t[e*3+1],a=t[n*3],l=t[n*3+1],c=t[i*3],h=t[i*3+1];return[new pt(r,o),new pt(a,l),new pt(c,h)]},generateSideWallUV:function(s,t,e,n,i,r){const o=t[e*3],a=t[e*3+1],l=t[e*3+2],c=t[n*3],h=t[n*3+1],f=t[n*3+2],d=t[i*3],m=t[i*3+1],g=t[i*3+2],y=t[r*3],_=t[r*3+1],v=t[r*3+2];return Math.abs(a-h)<Math.abs(o-c)?[new pt(o,1-l),new pt(c,1-f),new pt(d,1-g),new pt(y,1-v)]:[new pt(a,1-l),new pt(h,1-f),new pt(m,1-g),new pt(_,1-v)]}};function uB(s,t,e){if(e.shapes=[],Array.isArray(s))for(let n=0,i=s.length;n<i;n++){const r=s[n];e.shapes.push(r.uuid)}else e.shapes.push(s.uuid);return e.options=Object.assign({},t),t.extrudePath!==void 0&&(e.options.extrudePath=t.extrudePath.toJSON()),e}class Pd extends co{constructor(t=1,e=0){const n=(1+Math.sqrt(5))/2,i=[-1,n,0,1,n,0,-1,-n,0,1,-n,0,0,-1,n,0,1,n,0,-1,-n,0,1,-n,n,0,-1,n,0,1,-n,0,-1,-n,0,1],r=[0,11,5,0,5,1,0,1,7,0,7,10,0,10,11,1,5,9,5,11,4,11,10,2,10,7,6,7,1,8,3,9,4,3,4,2,3,2,6,3,6,8,3,8,9,4,9,5,2,4,11,6,2,10,8,6,7,9,8,1];super(i,r,t,e),this.type="IcosahedronGeometry",this.parameters={radius:t,detail:e}}static fromJSON(t){return new Pd(t.radius,t.detail)}}class Mu extends co{constructor(t=1,e=0){const n=[1,0,0,-1,0,0,0,1,0,0,-1,0,0,0,1,0,0,-1],i=[0,2,4,0,4,3,0,3,5,0,5,2,1,2,5,1,5,3,1,3,4,1,4,2];super(n,i,t,e),this.type="OctahedronGeometry",this.parameters={radius:t,detail:e}}static fromJSON(t){return new Mu(t.radius,t.detail)}}class Rd extends we{constructor(t=.5,e=1,n=32,i=1,r=0,o=Math.PI*2){super(),this.type="RingGeometry",this.parameters={innerRadius:t,outerRadius:e,thetaSegments:n,phiSegments:i,thetaStart:r,thetaLength:o},n=Math.max(3,n),i=Math.max(1,i);const a=[],l=[],c=[],h=[];let f=t;const d=(e-t)/i,m=new N,g=new pt;for(let y=0;y<=i;y++){for(let _=0;_<=n;_++){const v=r+_/n*o;m.x=f*Math.cos(v),m.y=f*Math.sin(v),l.push(m.x,m.y,m.z),c.push(0,0,1),g.x=(m.x/e+1)/2,g.y=(m.y/e+1)/2,h.push(g.x,g.y)}f+=d}for(let y=0;y<i;y++){const _=y*(n+1);for(let v=0;v<n;v++){const w=v+_,b=w,M=w+n+1,A=w+n+2,T=w+1;a.push(b,M,T),a.push(M,A,T)}}this.setIndex(a),this.setAttribute("position",new jt(l,3)),this.setAttribute("normal",new jt(c,3)),this.setAttribute("uv",new jt(h,2))}copy(t){return super.copy(t),this.parameters=Object.assign({},t.parameters),this}static fromJSON(t){return new Rd(t.innerRadius,t.outerRadius,t.thetaSegments,t.phiSegments,t.thetaStart,t.thetaLength)}}class Ld extends we{constructor(t=new Xo([new pt(0,.5),new pt(-.5,-.5),new pt(.5,-.5)]),e=12){super(),this.type="ShapeGeometry",this.parameters={shapes:t,curveSegments:e};const n=[],i=[],r=[],o=[];let a=0,l=0;if(Array.isArray(t)===!1)c(t);else for(let h=0;h<t.length;h++)c(t[h]),this.addGroup(a,l,h),a+=l,l=0;this.setIndex(n),this.setAttribute("position",new jt(i,3)),this.setAttribute("normal",new jt(r,3)),this.setAttribute("uv",new jt(o,2));function c(h){const f=i.length/3,d=h.extractPoints(e);let m=d.shape;const g=d.holes;Hs.isClockWise(m)===!1&&(m=m.reverse());for(let _=0,v=g.length;_<v;_++){const w=g[_];Hs.isClockWise(w)===!0&&(g[_]=w.reverse())}const y=Hs.triangulateShape(m,g);for(let _=0,v=g.length;_<v;_++){const w=g[_];m=m.concat(w)}for(let _=0,v=m.length;_<v;_++){const w=m[_];i.push(w.x,w.y,0),r.push(0,0,1),o.push(w.x,w.y)}for(let _=0,v=y.length;_<v;_++){const w=y[_],b=w[0]+f,M=w[1]+f,A=w[2]+f;n.push(b,M,A),l+=3}}}copy(t){return super.copy(t),this.parameters=Object.assign({},t.parameters),this}toJSON(){const t=super.toJSON(),e=this.parameters.shapes;return hB(e,t)}static fromJSON(t,e){const n=[];for(let i=0,r=t.shapes.length;i<r;i++){const o=e[t.shapes[i]];n.push(o)}return new Ld(n,t.curveSegments)}}function hB(s,t){if(t.shapes=[],Array.isArray(s))for(let e=0,n=s.length;e<n;e++){const i=s[e];t.shapes.push(i.uuid)}else t.shapes.push(s.uuid);return t}class Su extends we{constructor(t=1,e=32,n=16,i=0,r=Math.PI*2,o=0,a=Math.PI){super(),this.type="SphereGeometry",this.parameters={radius:t,widthSegments:e,heightSegments:n,phiStart:i,phiLength:r,thetaStart:o,thetaLength:a},e=Math.max(3,Math.floor(e)),n=Math.max(2,Math.floor(n));const l=Math.min(o+a,Math.PI);let c=0;const h=[],f=new N,d=new N,m=[],g=[],y=[],_=[];for(let v=0;v<=n;v++){const w=[],b=v/n;let M=0;v===0&&o===0?M=.5/e:v===n&&l===Math.PI&&(M=-.5/e);for(let A=0;A<=e;A++){const T=A/e;f.x=-t*Math.cos(i+T*r)*Math.sin(o+b*a),f.y=t*Math.cos(o+b*a),f.z=t*Math.sin(i+T*r)*Math.sin(o+b*a),g.push(f.x,f.y,f.z),d.copy(f).normalize(),y.push(d.x,d.y,d.z),_.push(T+M,1-b),w.push(c++)}h.push(w)}for(let v=0;v<n;v++)for(let w=0;w<e;w++){const b=h[v][w+1],M=h[v][w],A=h[v+1][w],T=h[v+1][w+1];(v!==0||o>0)&&m.push(b,M,T),(v!==n-1||l<Math.PI)&&m.push(M,A,T)}this.setIndex(m),this.setAttribute("position",new jt(g,3)),this.setAttribute("normal",new jt(y,3)),this.setAttribute("uv",new jt(_,2))}copy(t){return super.copy(t),this.parameters=Object.assign({},t.parameters),this}static fromJSON(t){return new Su(t.radius,t.widthSegments,t.heightSegments,t.phiStart,t.phiLength,t.thetaStart,t.thetaLength)}}class Dd extends co{constructor(t=1,e=0){const n=[1,1,1,-1,-1,1,-1,1,-1,1,-1,-1],i=[2,1,0,0,3,2,1,3,0,2,3,1];super(n,i,t,e),this.type="TetrahedronGeometry",this.parameters={radius:t,detail:e}}static fromJSON(t){return new Dd(t.radius,t.detail)}}class Id extends we{constructor(t=1,e=.4,n=12,i=48,r=Math.PI*2){super(),this.type="TorusGeometry",this.parameters={radius:t,tube:e,radialSegments:n,tubularSegments:i,arc:r},n=Math.floor(n),i=Math.floor(i);const o=[],a=[],l=[],c=[],h=new N,f=new N,d=new N;for(let m=0;m<=n;m++)for(let g=0;g<=i;g++){const y=g/i*r,_=m/n*Math.PI*2;f.x=(t+e*Math.cos(_))*Math.cos(y),f.y=(t+e*Math.cos(_))*Math.sin(y),f.z=e*Math.sin(_),a.push(f.x,f.y,f.z),h.x=t*Math.cos(y),h.y=t*Math.sin(y),d.subVectors(f,h).normalize(),l.push(d.x,d.y,d.z),c.push(g/i),c.push(m/n)}for(let m=1;m<=n;m++)for(let g=1;g<=i;g++){const y=(i+1)*m+g-1,_=(i+1)*(m-1)+g-1,v=(i+1)*(m-1)+g,w=(i+1)*m+g;o.push(y,_,w),o.push(_,v,w)}this.setIndex(o),this.setAttribute("position",new jt(a,3)),this.setAttribute("normal",new jt(l,3)),this.setAttribute("uv",new jt(c,2))}copy(t){return super.copy(t),this.parameters=Object.assign({},t.parameters),this}static fromJSON(t){return new Id(t.radius,t.tube,t.radialSegments,t.tubularSegments,t.arc)}}class Od extends we{constructor(t=1,e=.4,n=64,i=8,r=2,o=3){super(),this.type="TorusKnotGeometry",this.parameters={radius:t,tube:e,tubularSegments:n,radialSegments:i,p:r,q:o},n=Math.floor(n),i=Math.floor(i);const a=[],l=[],c=[],h=[],f=new N,d=new N,m=new N,g=new N,y=new N,_=new N,v=new N;for(let b=0;b<=n;++b){const M=b/n*r*Math.PI*2;w(M,r,o,t,m),w(M+.01,r,o,t,g),_.subVectors(g,m),v.addVectors(g,m),y.crossVectors(_,v),v.crossVectors(y,_),y.normalize(),v.normalize();for(let A=0;A<=i;++A){const T=A/i*Math.PI*2,P=-e*Math.cos(T),C=e*Math.sin(T);f.x=m.x+(P*v.x+C*y.x),f.y=m.y+(P*v.y+C*y.y),f.z=m.z+(P*v.z+C*y.z),l.push(f.x,f.y,f.z),d.subVectors(f,m).normalize(),c.push(d.x,d.y,d.z),h.push(b/n),h.push(A/i)}}for(let b=1;b<=n;b++)for(let M=1;M<=i;M++){const A=(i+1)*(b-1)+(M-1),T=(i+1)*b+(M-1),P=(i+1)*b+M,C=(i+1)*(b-1)+M;a.push(A,T,C),a.push(T,P,C)}this.setIndex(a),this.setAttribute("position",new jt(l,3)),this.setAttribute("normal",new jt(c,3)),this.setAttribute("uv",new jt(h,2));function w(b,M,A,T,P){const C=Math.cos(b),S=Math.sin(b),L=A/M*b,H=Math.cos(L);P.x=T*(2+H)*.5*C,P.y=T*(2+H)*S*.5,P.z=T*Math.sin(L)*.5}}copy(t){return super.copy(t),this.parameters=Object.assign({},t.parameters),this}static fromJSON(t){return new Od(t.radius,t.tube,t.tubularSegments,t.radialSegments,t.p,t.q)}}class zd extends we{constructor(t=new E_(new N(-1,-1,0),new N(-1,1,0),new N(1,1,0)),e=64,n=1,i=8,r=!1){super(),this.type="TubeGeometry",this.parameters={path:t,tubularSegments:e,radius:n,radialSegments:i,closed:r};const o=t.computeFrenetFrames(e,r);this.tangents=o.tangents,this.normals=o.normals,this.binormals=o.binormals;const a=new N,l=new N,c=new pt;let h=new N;const f=[],d=[],m=[],g=[];y(),this.setIndex(g),this.setAttribute("position",new jt(f,3)),this.setAttribute("normal",new jt(d,3)),this.setAttribute("uv",new jt(m,2));function y(){for(let b=0;b<e;b++)_(b);_(r===!1?e:0),w(),v()}function _(b){h=t.getPointAt(b/e,h);const M=o.normals[b],A=o.binormals[b];for(let T=0;T<=i;T++){const P=T/i*Math.PI*2,C=Math.sin(P),S=-Math.cos(P);l.x=S*M.x+C*A.x,l.y=S*M.y+C*A.y,l.z=S*M.z+C*A.z,l.normalize(),d.push(l.x,l.y,l.z),a.x=h.x+n*l.x,a.y=h.y+n*l.y,a.z=h.z+n*l.z,f.push(a.x,a.y,a.z)}}function v(){for(let b=1;b<=e;b++)for(let M=1;M<=i;M++){const A=(i+1)*(b-1)+(M-1),T=(i+1)*b+(M-1),P=(i+1)*b+M,C=(i+1)*(b-1)+M;g.push(A,T,C),g.push(T,P,C)}}function w(){for(let b=0;b<=e;b++)for(let M=0;M<=i;M++)c.x=b/e,c.y=M/i,m.push(c.x,c.y)}}copy(t){return super.copy(t),this.parameters=Object.assign({},t.parameters),this}toJSON(){const t=super.toJSON();return t.path=this.parameters.path.toJSON(),t}static fromJSON(t){return new zd(new C_[t.path.type]().fromJSON(t.path),t.tubularSegments,t.radius,t.radialSegments,t.closed)}}class KS extends we{constructor(t=null){if(super(),this.type="WireframeGeometry",this.parameters={geometry:t},t!==null){const e=[],n=new Set,i=new N,r=new N;if(t.index!==null){const o=t.attributes.position,a=t.index;let l=t.groups;l.length===0&&(l=[{start:0,count:a.count,materialIndex:0}]);for(let c=0,h=l.length;c<h;++c){const f=l[c],d=f.start,m=f.count;for(let g=d,y=d+m;g<y;g+=3)for(let _=0;_<3;_++){const v=a.getX(g+_),w=a.getX(g+(_+1)%3);i.fromBufferAttribute(o,v),r.fromBufferAttribute(o,w),pw(i,r,n)===!0&&(e.push(i.x,i.y,i.z),e.push(r.x,r.y,r.z))}}}else{const o=t.attributes.position;for(let a=0,l=o.count/3;a<l;a++)for(let c=0;c<3;c++){const h=3*a+c,f=3*a+(c+1)%3;i.fromBufferAttribute(o,h),r.fromBufferAttribute(o,f),pw(i,r,n)===!0&&(e.push(i.x,i.y,i.z),e.push(r.x,r.y,r.z))}}this.setAttribute("position",new jt(e,3))}}copy(t){return super.copy(t),this.parameters=Object.assign({},t.parameters),this}}function pw(s,t,e){const n=`${s.x},${s.y},${s.z}-${t.x},${t.y},${t.z}`,i=`${t.x},${t.y},${t.z}-${s.x},${s.y},${s.z}`;return e.has(n)===!0||e.has(i)===!0?!1:(e.add(n),e.add(i),!0)}var mw=Object.freeze({__proto__:null,BoxGeometry:ua,CapsuleGeometry:Md,CircleGeometry:Sd,ConeGeometry:Ad,CylinderGeometry:kl,DodecahedronGeometry:Ed,EdgesGeometry:XS,ExtrudeGeometry:Cd,IcosahedronGeometry:Pd,LatheGeometry:wu,OctahedronGeometry:Mu,PlaneGeometry:Il,PolyhedronGeometry:co,RingGeometry:Rd,ShapeGeometry:Ld,SphereGeometry:Su,TetrahedronGeometry:Dd,TorusGeometry:Id,TorusKnotGeometry:Od,TubeGeometry:zd,WireframeGeometry:KS});class JS extends Zn{constructor(t){super(),this.isShadowMaterial=!0,this.type="ShadowMaterial",this.color=new Vt(0),this.transparent=!0,this.fog=!0,this.setValues(t)}copy(t){return super.copy(t),this.color.copy(t.color),this.fog=t.fog,this}}class P_ extends qs{constructor(t){super(t),this.isRawShaderMaterial=!0,this.type="RawShaderMaterial"}}class R_ extends Zn{constructor(t){super(),this.isMeshStandardMaterial=!0,this.defines={STANDARD:""},this.type="MeshStandardMaterial",this.color=new Vt(16777215),this.roughness=1,this.metalness=0,this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new Vt(0),this.emissiveIntensity=1,this.emissiveMap=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=lo,this.normalScale=new pt(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.roughnessMap=null,this.metalnessMap=null,this.alphaMap=null,this.envMap=null,this.envMapIntensity=1,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.flatShading=!1,this.fog=!0,this.setValues(t)}copy(t){return super.copy(t),this.defines={STANDARD:""},this.color.copy(t.color),this.roughness=t.roughness,this.metalness=t.metalness,this.map=t.map,this.lightMap=t.lightMap,this.lightMapIntensity=t.lightMapIntensity,this.aoMap=t.aoMap,this.aoMapIntensity=t.aoMapIntensity,this.emissive.copy(t.emissive),this.emissiveMap=t.emissiveMap,this.emissiveIntensity=t.emissiveIntensity,this.bumpMap=t.bumpMap,this.bumpScale=t.bumpScale,this.normalMap=t.normalMap,this.normalMapType=t.normalMapType,this.normalScale.copy(t.normalScale),this.displacementMap=t.displacementMap,this.displacementScale=t.displacementScale,this.displacementBias=t.displacementBias,this.roughnessMap=t.roughnessMap,this.metalnessMap=t.metalnessMap,this.alphaMap=t.alphaMap,this.envMap=t.envMap,this.envMapIntensity=t.envMapIntensity,this.wireframe=t.wireframe,this.wireframeLinewidth=t.wireframeLinewidth,this.wireframeLinecap=t.wireframeLinecap,this.wireframeLinejoin=t.wireframeLinejoin,this.flatShading=t.flatShading,this.fog=t.fog,this}}class QS extends R_{constructor(t){super(),this.isMeshPhysicalMaterial=!0,this.defines={STANDARD:"",PHYSICAL:""},this.type="MeshPhysicalMaterial",this.anisotropyRotation=0,this.anisotropyMap=null,this.clearcoatMap=null,this.clearcoatRoughness=0,this.clearcoatRoughnessMap=null,this.clearcoatNormalScale=new pt(1,1),this.clearcoatNormalMap=null,this.ior=1.5,Object.defineProperty(this,"reflectivity",{get:function(){return yn(2.5*(this.ior-1)/(this.ior+1),0,1)},set:function(e){this.ior=(1+.4*e)/(1-.4*e)}}),this.iridescenceMap=null,this.iridescenceIOR=1.3,this.iridescenceThicknessRange=[100,400],this.iridescenceThicknessMap=null,this.sheenColor=new Vt(0),this.sheenColorMap=null,this.sheenRoughness=1,this.sheenRoughnessMap=null,this.transmissionMap=null,this.thickness=0,this.thicknessMap=null,this.attenuationDistance=1/0,this.attenuationColor=new Vt(1,1,1),this.specularIntensity=1,this.specularIntensityMap=null,this.specularColor=new Vt(1,1,1),this.specularColorMap=null,this._anisotropy=0,this._clearcoat=0,this._iridescence=0,this._sheen=0,this._transmission=0,this.setValues(t)}get anisotropy(){return this._anisotropy}set anisotropy(t){this._anisotropy>0!=t>0&&this.version++,this._anisotropy=t}get clearcoat(){return this._clearcoat}set clearcoat(t){this._clearcoat>0!=t>0&&this.version++,this._clearcoat=t}get iridescence(){return this._iridescence}set iridescence(t){this._iridescence>0!=t>0&&this.version++,this._iridescence=t}get sheen(){return this._sheen}set sheen(t){this._sheen>0!=t>0&&this.version++,this._sheen=t}get transmission(){return this._transmission}set transmission(t){this._transmission>0!=t>0&&this.version++,this._transmission=t}copy(t){return super.copy(t),this.defines={STANDARD:"",PHYSICAL:""},this.anisotropy=t.anisotropy,this.anisotropyRotation=t.anisotropyRotation,this.anisotropyMap=t.anisotropyMap,this.clearcoat=t.clearcoat,this.clearcoatMap=t.clearcoatMap,this.clearcoatRoughness=t.clearcoatRoughness,this.clearcoatRoughnessMap=t.clearcoatRoughnessMap,this.clearcoatNormalMap=t.clearcoatNormalMap,this.clearcoatNormalScale.copy(t.clearcoatNormalScale),this.ior=t.ior,this.iridescence=t.iridescence,this.iridescenceMap=t.iridescenceMap,this.iridescenceIOR=t.iridescenceIOR,this.iridescenceThicknessRange=[...t.iridescenceThicknessRange],this.iridescenceThicknessMap=t.iridescenceThicknessMap,this.sheen=t.sheen,this.sheenColor.copy(t.sheenColor),this.sheenColorMap=t.sheenColorMap,this.sheenRoughness=t.sheenRoughness,this.sheenRoughnessMap=t.sheenRoughnessMap,this.transmission=t.transmission,this.transmissionMap=t.transmissionMap,this.thickness=t.thickness,this.thicknessMap=t.thicknessMap,this.attenuationDistance=t.attenuationDistance,this.attenuationColor.copy(t.attenuationColor),this.specularIntensity=t.specularIntensity,this.specularIntensityMap=t.specularIntensityMap,this.specularColor.copy(t.specularColor),this.specularColorMap=t.specularColorMap,this}}class tA extends Zn{constructor(t){super(),this.isMeshPhongMaterial=!0,this.type="MeshPhongMaterial",this.color=new Vt(16777215),this.specular=new Vt(1118481),this.shininess=30,this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new Vt(0),this.emissiveIntensity=1,this.emissiveMap=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=lo,this.normalScale=new pt(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.specularMap=null,this.alphaMap=null,this.envMap=null,this.combine=gu,this.reflectivity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.flatShading=!1,this.fog=!0,this.setValues(t)}copy(t){return super.copy(t),this.color.copy(t.color),this.specular.copy(t.specular),this.shininess=t.shininess,this.map=t.map,this.lightMap=t.lightMap,this.lightMapIntensity=t.lightMapIntensity,this.aoMap=t.aoMap,this.aoMapIntensity=t.aoMapIntensity,this.emissive.copy(t.emissive),this.emissiveMap=t.emissiveMap,this.emissiveIntensity=t.emissiveIntensity,this.bumpMap=t.bumpMap,this.bumpScale=t.bumpScale,this.normalMap=t.normalMap,this.normalMapType=t.normalMapType,this.normalScale.copy(t.normalScale),this.displacementMap=t.displacementMap,this.displacementScale=t.displacementScale,this.displacementBias=t.displacementBias,this.specularMap=t.specularMap,this.alphaMap=t.alphaMap,this.envMap=t.envMap,this.combine=t.combine,this.reflectivity=t.reflectivity,this.refractionRatio=t.refractionRatio,this.wireframe=t.wireframe,this.wireframeLinewidth=t.wireframeLinewidth,this.wireframeLinecap=t.wireframeLinecap,this.wireframeLinejoin=t.wireframeLinejoin,this.flatShading=t.flatShading,this.fog=t.fog,this}}class eA extends Zn{constructor(t){super(),this.isMeshToonMaterial=!0,this.defines={TOON:""},this.type="MeshToonMaterial",this.color=new Vt(16777215),this.map=null,this.gradientMap=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new Vt(0),this.emissiveIntensity=1,this.emissiveMap=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=lo,this.normalScale=new pt(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.alphaMap=null,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.fog=!0,this.setValues(t)}copy(t){return super.copy(t),this.color.copy(t.color),this.map=t.map,this.gradientMap=t.gradientMap,this.lightMap=t.lightMap,this.lightMapIntensity=t.lightMapIntensity,this.aoMap=t.aoMap,this.aoMapIntensity=t.aoMapIntensity,this.emissive.copy(t.emissive),this.emissiveMap=t.emissiveMap,this.emissiveIntensity=t.emissiveIntensity,this.bumpMap=t.bumpMap,this.bumpScale=t.bumpScale,this.normalMap=t.normalMap,this.normalMapType=t.normalMapType,this.normalScale.copy(t.normalScale),this.displacementMap=t.displacementMap,this.displacementScale=t.displacementScale,this.displacementBias=t.displacementBias,this.alphaMap=t.alphaMap,this.wireframe=t.wireframe,this.wireframeLinewidth=t.wireframeLinewidth,this.wireframeLinecap=t.wireframeLinecap,this.wireframeLinejoin=t.wireframeLinejoin,this.fog=t.fog,this}}class nA extends Zn{constructor(t){super(),this.isMeshNormalMaterial=!0,this.type="MeshNormalMaterial",this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=lo,this.normalScale=new pt(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.wireframe=!1,this.wireframeLinewidth=1,this.flatShading=!1,this.setValues(t)}copy(t){return super.copy(t),this.bumpMap=t.bumpMap,this.bumpScale=t.bumpScale,this.normalMap=t.normalMap,this.normalMapType=t.normalMapType,this.normalScale.copy(t.normalScale),this.displacementMap=t.displacementMap,this.displacementScale=t.displacementScale,this.displacementBias=t.displacementBias,this.wireframe=t.wireframe,this.wireframeLinewidth=t.wireframeLinewidth,this.flatShading=t.flatShading,this}}class iA extends Zn{constructor(t){super(),this.isMeshLambertMaterial=!0,this.type="MeshLambertMaterial",this.color=new Vt(16777215),this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new Vt(0),this.emissiveIntensity=1,this.emissiveMap=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=lo,this.normalScale=new pt(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.specularMap=null,this.alphaMap=null,this.envMap=null,this.combine=gu,this.reflectivity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.flatShading=!1,this.fog=!0,this.setValues(t)}copy(t){return super.copy(t),this.color.copy(t.color),this.map=t.map,this.lightMap=t.lightMap,this.lightMapIntensity=t.lightMapIntensity,this.aoMap=t.aoMap,this.aoMapIntensity=t.aoMapIntensity,this.emissive.copy(t.emissive),this.emissiveMap=t.emissiveMap,this.emissiveIntensity=t.emissiveIntensity,this.bumpMap=t.bumpMap,this.bumpScale=t.bumpScale,this.normalMap=t.normalMap,this.normalMapType=t.normalMapType,this.normalScale.copy(t.normalScale),this.displacementMap=t.displacementMap,this.displacementScale=t.displacementScale,this.displacementBias=t.displacementBias,this.specularMap=t.specularMap,this.alphaMap=t.alphaMap,this.envMap=t.envMap,this.combine=t.combine,this.reflectivity=t.reflectivity,this.refractionRatio=t.refractionRatio,this.wireframe=t.wireframe,this.wireframeLinewidth=t.wireframeLinewidth,this.wireframeLinecap=t.wireframeLinecap,this.wireframeLinejoin=t.wireframeLinejoin,this.flatShading=t.flatShading,this.fog=t.fog,this}}class sA extends Zn{constructor(t){super(),this.isMeshMatcapMaterial=!0,this.defines={MATCAP:""},this.type="MeshMatcapMaterial",this.color=new Vt(16777215),this.matcap=null,this.map=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=lo,this.normalScale=new pt(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.alphaMap=null,this.flatShading=!1,this.fog=!0,this.setValues(t)}copy(t){return super.copy(t),this.defines={MATCAP:""},this.color.copy(t.color),this.matcap=t.matcap,this.map=t.map,this.bumpMap=t.bumpMap,this.bumpScale=t.bumpScale,this.normalMap=t.normalMap,this.normalMapType=t.normalMapType,this.normalScale.copy(t.normalScale),this.displacementMap=t.displacementMap,this.displacementScale=t.displacementScale,this.displacementBias=t.displacementBias,this.alphaMap=t.alphaMap,this.flatShading=t.flatShading,this.fog=t.fog,this}}class rA extends li{constructor(t){super(),this.isLineDashedMaterial=!0,this.type="LineDashedMaterial",this.scale=1,this.dashSize=3,this.gapSize=1,this.setValues(t)}copy(t){return super.copy(t),this.scale=t.scale,this.dashSize=t.dashSize,this.gapSize=t.gapSize,this}}function as(s,t,e){return L_(s)?new s.constructor(s.subarray(t,e!==void 0?e:s.length)):s.slice(t,e)}function qo(s,t,e){return!s||!e&&s.constructor===t?s:typeof t.BYTES_PER_ELEMENT=="number"?new t(s):Array.prototype.slice.call(s)}function L_(s){return ArrayBuffer.isView(s)&&!(s instanceof DataView)}function oA(s){function t(i,r){return s[i]-s[r]}const e=s.length,n=new Array(e);for(let i=0;i!==e;++i)n[i]=i;return n.sort(t),n}function cv(s,t,e){const n=s.length,i=new s.constructor(n);for(let r=0,o=0;o!==n;++r){const a=e[r]*t;for(let l=0;l!==t;++l)i[o++]=s[a+l]}return i}function D_(s,t,e,n){let i=1,r=s[0];for(;r!==void 0&&r[n]===void 0;)r=s[i++];if(r===void 0)return;let o=r[n];if(o!==void 0)if(Array.isArray(o))do o=r[n],o!==void 0&&(t.push(r.time),e.push.apply(e,o)),r=s[i++];while(r!==void 0);else if(o.toArray!==void 0)do o=r[n],o!==void 0&&(t.push(r.time),o.toArray(e,e.length)),r=s[i++];while(r!==void 0);else do o=r[n],o!==void 0&&(t.push(r.time),e.push(o)),r=s[i++];while(r!==void 0)}function fB(s,t,e,n,i=30){const r=s.clone();r.name=t;const o=[];for(let l=0;l<r.tracks.length;++l){const c=r.tracks[l],h=c.getValueSize(),f=[],d=[];for(let m=0;m<c.times.length;++m){const g=c.times[m]*i;if(!(g<e||g>=n)){f.push(c.times[m]);for(let y=0;y<h;++y)d.push(c.values[m*h+y])}}f.length!==0&&(c.times=qo(f,c.times.constructor),c.values=qo(d,c.values.constructor),o.push(c))}r.tracks=o;let a=1/0;for(let l=0;l<r.tracks.length;++l)a>r.tracks[l].times[0]&&(a=r.tracks[l].times[0]);for(let l=0;l<r.tracks.length;++l)r.tracks[l].shift(-1*a);return r.resetDuration(),r}function dB(s,t=0,e=s,n=30){n<=0&&(n=30);const i=e.tracks.length,r=t/n;for(let o=0;o<i;++o){const a=e.tracks[o],l=a.ValueTypeName;if(l==="bool"||l==="string")continue;const c=s.tracks.find(function(v){return v.name===a.name&&v.ValueTypeName===l});if(c===void 0)continue;let h=0;const f=a.getValueSize();a.createInterpolant.isInterpolantFactoryMethodGLTFCubicSpline&&(h=f/3);let d=0;const m=c.getValueSize();c.createInterpolant.isInterpolantFactoryMethodGLTFCubicSpline&&(d=m/3);const g=a.times.length-1;let y;if(r<=a.times[0]){const v=h,w=f-h;y=as(a.values,v,w)}else if(r>=a.times[g]){const v=g*f+h,w=v+f-h;y=as(a.values,v,w)}else{const v=a.createInterpolant(),w=h,b=f-h;v.evaluate(r),y=as(v.resultBuffer,w,b)}l==="quaternion"&&new Pn().fromArray(y).normalize().conjugate().toArray(y);const _=c.times.length;for(let v=0;v<_;++v){const w=v*m+d;if(l==="quaternion")Pn.multiplyQuaternionsFlat(c.values,w,y,0,c.values,w);else{const b=m-d*2;for(let M=0;M<b;++M)c.values[w+M]-=y[M]}}}return s.blendMode=l_,s}const pB={arraySlice:as,convertArray:qo,isTypedArray:L_,getKeyframeOrder:oA,sortedArray:cv,flattenJSON:D_,subclip:fB,makeClipAdditive:dB};class Au{constructor(t,e,n,i){this.parameterPositions=t,this._cachedIndex=0,this.resultBuffer=i!==void 0?i:new e.constructor(n),this.sampleValues=e,this.valueSize=n,this.settings=null,this.DefaultSettings_={}}evaluate(t){const e=this.parameterPositions;let n=this._cachedIndex,i=e[n],r=e[n-1];t:{e:{let o;n:{i:if(!(t<i)){for(let a=n+2;;){if(i===void 0){if(t<r)break i;return n=e.length,this._cachedIndex=n,this.copySampleValue_(n-1)}if(n===a)break;if(r=i,i=e[++n],t<i)break e}o=e.length;break n}if(!(t>=r)){const a=e[1];t<a&&(n=2,r=a);for(let l=n-2;;){if(r===void 0)return this._cachedIndex=0,this.copySampleValue_(0);if(n===l)break;if(i=r,r=e[--n-1],t>=r)break e}o=n,n=0;break n}break t}for(;n<o;){const a=n+o>>>1;t<e[a]?o=a:n=a+1}if(i=e[n],r=e[n-1],r===void 0)return this._cachedIndex=0,this.copySampleValue_(0);if(i===void 0)return n=e.length,this._cachedIndex=n,this.copySampleValue_(n-1)}this._cachedIndex=n,this.intervalChanged_(n,r,i)}return this.interpolate_(n,r,t,i)}getSettings_(){return this.settings||this.DefaultSettings_}copySampleValue_(t){const e=this.resultBuffer,n=this.sampleValues,i=this.valueSize,r=t*i;for(let o=0;o!==i;++o)e[o]=n[r+o];return e}interpolate_(){throw new Error("call to abstract method")}intervalChanged_(){}}class aA extends Au{constructor(t,e,n,i){super(t,e,n,i),this._weightPrev=-0,this._offsetPrev=-0,this._weightNext=-0,this._offsetNext=-0,this.DefaultSettings_={endingStart:Ho,endingEnd:Ho}}intervalChanged_(t,e,n){const i=this.parameterPositions;let r=t-2,o=t+1,a=i[r],l=i[o];if(a===void 0)switch(this.getSettings_().endingStart){case Vo:r=t,a=2*e-n;break;case $c:r=i.length-2,a=e+i[r]-i[r+1];break;default:r=t,a=n}if(l===void 0)switch(this.getSettings_().endingEnd){case Vo:o=t,l=2*n-e;break;case $c:o=1,l=n+i[1]-i[0];break;default:o=t-1,l=e}const c=(n-e)*.5,h=this.valueSize;this._weightPrev=c/(e-a),this._weightNext=c/(l-n),this._offsetPrev=r*h,this._offsetNext=o*h}interpolate_(t,e,n,i){const r=this.resultBuffer,o=this.sampleValues,a=this.valueSize,l=t*a,c=l-a,h=this._offsetPrev,f=this._offsetNext,d=this._weightPrev,m=this._weightNext,g=(n-e)/(i-e),y=g*g,_=y*g,v=-d*_+2*d*y-d*g,w=(1+d)*_+(-1.5-2*d)*y+(-.5+d)*g+1,b=(-1-m)*_+(1.5+m)*y+.5*g,M=m*_-m*y;for(let A=0;A!==a;++A)r[A]=v*o[h+A]+w*o[c+A]+b*o[l+A]+M*o[f+A];return r}}class I_ extends Au{constructor(t,e,n,i){super(t,e,n,i)}interpolate_(t,e,n,i){const r=this.resultBuffer,o=this.sampleValues,a=this.valueSize,l=t*a,c=l-a,h=(n-e)/(i-e),f=1-h;for(let d=0;d!==a;++d)r[d]=o[c+d]*f+o[l+d]*h;return r}}class lA extends Au{constructor(t,e,n,i){super(t,e,n,i)}interpolate_(t){return this.copySampleValue_(t-1)}}class Ps{constructor(t,e,n,i){if(t===void 0)throw new Error("THREE.KeyframeTrack: track name is undefined");if(e===void 0||e.length===0)throw new Error("THREE.KeyframeTrack: no keyframes in track named "+t);this.name=t,this.times=qo(e,this.TimeBufferType),this.values=qo(n,this.ValueBufferType),this.setInterpolation(i||this.DefaultInterpolation)}static toJSON(t){const e=t.constructor;let n;if(e.toJSON!==this.toJSON)n=e.toJSON(t);else{n={name:t.name,times:qo(t.times,Array),values:qo(t.values,Array)};const i=t.getInterpolation();i!==t.DefaultInterpolation&&(n.interpolation=i)}return n.type=t.ValueTypeName,n}InterpolantFactoryMethodDiscrete(t){return new lA(this.times,this.values,this.getValueSize(),t)}InterpolantFactoryMethodLinear(t){return new I_(this.times,this.values,this.getValueSize(),t)}InterpolantFactoryMethodSmooth(t){return new aA(this.times,this.values,this.getValueSize(),t)}setInterpolation(t){let e;switch(t){case qc:e=this.InterpolantFactoryMethodDiscrete;break;case Wc:e=this.InterpolantFactoryMethodLinear;break;case Tf:e=this.InterpolantFactoryMethodSmooth;break}if(e===void 0){const n="unsupported interpolation for "+this.ValueTypeName+" keyframe track named "+this.name;if(this.createInterpolant===void 0)if(t!==this.DefaultInterpolation)this.setInterpolation(this.DefaultInterpolation);else throw new Error(n);return console.warn("THREE.KeyframeTrack:",n),this}return this.createInterpolant=e,this}getInterpolation(){switch(this.createInterpolant){case this.InterpolantFactoryMethodDiscrete:return qc;case this.InterpolantFactoryMethodLinear:return Wc;case this.InterpolantFactoryMethodSmooth:return Tf}}getValueSize(){return this.values.length/this.times.length}shift(t){if(t!==0){const e=this.times;for(let n=0,i=e.length;n!==i;++n)e[n]+=t}return this}scale(t){if(t!==1){const e=this.times;for(let n=0,i=e.length;n!==i;++n)e[n]*=t}return this}trim(t,e){const n=this.times,i=n.length;let r=0,o=i-1;for(;r!==i&&n[r]<t;)++r;for(;o!==-1&&n[o]>e;)--o;if(++o,r!==0||o!==i){r>=o&&(o=Math.max(o,1),r=o-1);const a=this.getValueSize();this.times=as(n,r,o),this.values=as(this.values,r*a,o*a)}return this}validate(){let t=!0;const e=this.getValueSize();e-Math.floor(e)!==0&&(console.error("THREE.KeyframeTrack: Invalid value size in track.",this),t=!1);const n=this.times,i=this.values,r=n.length;r===0&&(console.error("THREE.KeyframeTrack: Track is empty.",this),t=!1);let o=null;for(let a=0;a!==r;a++){const l=n[a];if(typeof l=="number"&&isNaN(l)){console.error("THREE.KeyframeTrack: Time is not a valid number.",this,a,l),t=!1;break}if(o!==null&&o>l){console.error("THREE.KeyframeTrack: Out of order keys.",this,a,l,o),t=!1;break}o=l}if(i!==void 0&&L_(i))for(let a=0,l=i.length;a!==l;++a){const c=i[a];if(isNaN(c)){console.error("THREE.KeyframeTrack: Value is not a valid number.",this,a,c),t=!1;break}}return t}optimize(){const t=as(this.times),e=as(this.values),n=this.getValueSize(),i=this.getInterpolation()===Tf,r=t.length-1;let o=1;for(let a=1;a<r;++a){let l=!1;const c=t[a],h=t[a+1];if(c!==h&&(a!==1||c!==t[0]))if(i)l=!0;else{const f=a*n,d=f-n,m=f+n;for(let g=0;g!==n;++g){const y=e[f+g];if(y!==e[d+g]||y!==e[m+g]){l=!0;break}}}if(l){if(a!==o){t[o]=t[a];const f=a*n,d=o*n;for(let m=0;m!==n;++m)e[d+m]=e[f+m]}++o}}if(r>0){t[o]=t[r];for(let a=r*n,l=o*n,c=0;c!==n;++c)e[l+c]=e[a+c];++o}return o!==t.length?(this.times=as(t,0,o),this.values=as(e,0,o*n)):(this.times=t,this.values=e),this}clone(){const t=as(this.times,0),e=as(this.values,0),n=this.constructor,i=new n(this.name,t,e);return i.createInterpolant=this.createInterpolant,i}}Ps.prototype.TimeBufferType=Float32Array;Ps.prototype.ValueBufferType=Float32Array;Ps.prototype.DefaultInterpolation=Wc;class ha extends Ps{}ha.prototype.ValueTypeName="bool";ha.prototype.ValueBufferType=Array;ha.prototype.DefaultInterpolation=qc;ha.prototype.InterpolantFactoryMethodLinear=void 0;ha.prototype.InterpolantFactoryMethodSmooth=void 0;class O_ extends Ps{}O_.prototype.ValueTypeName="color";class eu extends Ps{}eu.prototype.ValueTypeName="number";class cA extends Au{constructor(t,e,n,i){super(t,e,n,i)}interpolate_(t,e,n,i){const r=this.resultBuffer,o=this.sampleValues,a=this.valueSize,l=(n-e)/(i-e);let c=t*a;for(let h=c+a;c!==h;c+=4)Pn.slerpFlat(r,0,o,c-a,o,c,l);return r}}class Ul extends Ps{InterpolantFactoryMethodLinear(t){return new cA(this.times,this.values,this.getValueSize(),t)}}Ul.prototype.ValueTypeName="quaternion";Ul.prototype.DefaultInterpolation=Wc;Ul.prototype.InterpolantFactoryMethodSmooth=void 0;class fa extends Ps{}fa.prototype.ValueTypeName="string";fa.prototype.ValueBufferType=Array;fa.prototype.DefaultInterpolation=qc;fa.prototype.InterpolantFactoryMethodLinear=void 0;fa.prototype.InterpolantFactoryMethodSmooth=void 0;class nu extends Ps{}nu.prototype.ValueTypeName="vector";class iu{constructor(t,e=-1,n,i=hd){this.name=t,this.tracks=n,this.duration=e,this.blendMode=i,this.uuid=qi(),this.duration<0&&this.resetDuration()}static parse(t){const e=[],n=t.tracks,i=1/(t.fps||1);for(let o=0,a=n.length;o!==a;++o)e.push(gB(n[o]).scale(i));const r=new this(t.name,t.duration,e,t.blendMode);return r.uuid=t.uuid,r}static toJSON(t){const e=[],n=t.tracks,i={name:t.name,duration:t.duration,tracks:e,uuid:t.uuid,blendMode:t.blendMode};for(let r=0,o=n.length;r!==o;++r)e.push(Ps.toJSON(n[r]));return i}static CreateFromMorphTargetSequence(t,e,n,i){const r=e.length,o=[];for(let a=0;a<r;a++){let l=[],c=[];l.push((a+r-1)%r,a,(a+1)%r),c.push(0,1,0);const h=oA(l);l=cv(l,1,h),c=cv(c,1,h),!i&&l[0]===0&&(l.push(r),c.push(c[0])),o.push(new eu(".morphTargetInfluences["+e[a].name+"]",l,c).scale(1/n))}return new this(t,-1,o)}static findByName(t,e){let n=t;if(!Array.isArray(t)){const i=t;n=i.geometry&&i.geometry.animations||i.animations}for(let i=0;i<n.length;i++)if(n[i].name===e)return n[i];return null}static CreateClipsFromMorphTargetSequences(t,e,n){const i={},r=/^([\w-]*?)([\d]+)$/;for(let a=0,l=t.length;a<l;a++){const c=t[a],h=c.name.match(r);if(h&&h.length>1){const f=h[1];let d=i[f];d||(i[f]=d=[]),d.push(c)}}const o=[];for(const a in i)o.push(this.CreateFromMorphTargetSequence(a,i[a],e,n));return o}static parseAnimation(t,e){if(!t)return console.error("THREE.AnimationClip: No animation in JSONLoader data."),null;const n=function(f,d,m,g,y){if(m.length!==0){const _=[],v=[];D_(m,_,v,g),_.length!==0&&y.push(new f(d,_,v))}},i=[],r=t.name||"default",o=t.fps||30,a=t.blendMode;let l=t.length||-1;const c=t.hierarchy||[];for(let f=0;f<c.length;f++){const d=c[f].keys;if(!(!d||d.length===0))if(d[0].morphTargets){const m={};let g;for(g=0;g<d.length;g++)if(d[g].morphTargets)for(let y=0;y<d[g].morphTargets.length;y++)m[d[g].morphTargets[y]]=-1;for(const y in m){const _=[],v=[];for(let w=0;w!==d[g].morphTargets.length;++w){const b=d[g];_.push(b.time),v.push(b.morphTarget===y?1:0)}i.push(new eu(".morphTargetInfluence["+y+"]",_,v))}l=m.length*o}else{const m=".bones["+e[f].name+"]";n(nu,m+".position",d,"pos",i),n(Ul,m+".quaternion",d,"rot",i),n(nu,m+".scale",d,"scl",i)}}return i.length===0?null:new this(r,l,i,a)}resetDuration(){const t=this.tracks;let e=0;for(let n=0,i=t.length;n!==i;++n){const r=this.tracks[n];e=Math.max(e,r.times[r.times.length-1])}return this.duration=e,this}trim(){for(let t=0;t<this.tracks.length;t++)this.tracks[t].trim(0,this.duration);return this}validate(){let t=!0;for(let e=0;e<this.tracks.length;e++)t=t&&this.tracks[e].validate();return t}optimize(){for(let t=0;t<this.tracks.length;t++)this.tracks[t].optimize();return this}clone(){const t=[];for(let e=0;e<this.tracks.length;e++)t.push(this.tracks[e].clone());return new this.constructor(this.name,this.duration,t,this.blendMode)}toJSON(){return this.constructor.toJSON(this)}}function mB(s){switch(s.toLowerCase()){case"scalar":case"double":case"float":case"number":case"integer":return eu;case"vector":case"vector2":case"vector3":case"vector4":return nu;case"color":return O_;case"quaternion":return Ul;case"bool":case"boolean":return ha;case"string":return fa}throw new Error("THREE.KeyframeTrack: Unsupported typeName: "+s)}function gB(s){if(s.type===void 0)throw new Error("THREE.KeyframeTrack: track type undefined, can not parse");const t=mB(s.type);if(s.times===void 0){const e=[],n=[];D_(s.keys,e,n,"value"),s.times=e,s.values=n}return t.parse!==void 0?t.parse(s):new t(s.name,s.times,s.values,s.interpolation)}const Qo={enabled:!1,files:{},add:function(s,t){this.enabled!==!1&&(this.files[s]=t)},get:function(s){if(this.enabled!==!1)return this.files[s]},remove:function(s){delete this.files[s]},clear:function(){this.files={}}};class z_{constructor(t,e,n){const i=this;let r=!1,o=0,a=0,l;const c=[];this.onStart=void 0,this.onLoad=t,this.onProgress=e,this.onError=n,this.itemStart=function(h){a++,r===!1&&i.onStart!==void 0&&i.onStart(h,o,a),r=!0},this.itemEnd=function(h){o++,i.onProgress!==void 0&&i.onProgress(h,o,a),o===a&&(r=!1,i.onLoad!==void 0&&i.onLoad())},this.itemError=function(h){i.onError!==void 0&&i.onError(h)},this.resolveURL=function(h){return l?l(h):h},this.setURLModifier=function(h){return l=h,this},this.addHandler=function(h,f){return c.push(h,f),this},this.removeHandler=function(h){const f=c.indexOf(h);return f!==-1&&c.splice(f,2),this},this.getHandler=function(h){for(let f=0,d=c.length;f<d;f+=2){const m=c[f],g=c[f+1];if(m.global&&(m.lastIndex=0),m.test(h))return g}return null}}}const uA=new z_;class Ai{constructor(t){this.manager=t!==void 0?t:uA,this.crossOrigin="anonymous",this.withCredentials=!1,this.path="",this.resourcePath="",this.requestHeader={}}load(){}loadAsync(t,e){const n=this;return new Promise(function(i,r){n.load(t,i,e,r)})}parse(){}setCrossOrigin(t){return this.crossOrigin=t,this}setWithCredentials(t){return this.withCredentials=t,this}setPath(t){return this.path=t,this}setResourcePath(t){return this.resourcePath=t,this}setRequestHeader(t){return this.requestHeader=t,this}}Ai.DEFAULT_MATERIAL_NAME="__DEFAULT";const dr={};class vB extends Error{constructor(t,e){super(t),this.response=e}}class Ar extends Ai{constructor(t){super(t)}load(t,e,n,i){t===void 0&&(t=""),this.path!==void 0&&(t=this.path+t),t=this.manager.resolveURL(t);const r=Qo.get(t);if(r!==void 0)return this.manager.itemStart(t),setTimeout(()=>{e&&e(r),this.manager.itemEnd(t)},0),r;if(dr[t]!==void 0){dr[t].push({onLoad:e,onProgress:n,onError:i});return}dr[t]=[],dr[t].push({onLoad:e,onProgress:n,onError:i});const o=new Request(t,{headers:new Headers(this.requestHeader),credentials:this.withCredentials?"include":"same-origin"}),a=this.mimeType,l=this.responseType;fetch(o).then(c=>{if(c.status===200||c.status===0){if(c.status===0&&console.warn("THREE.FileLoader: HTTP Status 0 received."),typeof ReadableStream>"u"||c.body===void 0||c.body.getReader===void 0)return c;const h=dr[t],f=c.body.getReader(),d=c.headers.get("Content-Length")||c.headers.get("X-File-Size"),m=d?parseInt(d):0,g=m!==0;let y=0;const _=new ReadableStream({start(v){w();function w(){f.read().then(({done:b,value:M})=>{if(b)v.close();else{y+=M.byteLength;const A=new ProgressEvent("progress",{lengthComputable:g,loaded:y,total:m});for(let T=0,P=h.length;T<P;T++){const C=h[T];C.onProgress&&C.onProgress(A)}v.enqueue(M),w()}})}}});return new Response(_)}else throw new vB(`fetch for "${c.url}" responded with ${c.status}: ${c.statusText}`,c)}).then(c=>{switch(l){case"arraybuffer":return c.arrayBuffer();case"blob":return c.blob();case"document":return c.text().then(h=>new DOMParser().parseFromString(h,a));case"json":return c.json();default:if(a===void 0)return c.text();{const f=/charset="?([^;"\s]*)"?/i.exec(a),d=f&&f[1]?f[1].toLowerCase():void 0,m=new TextDecoder(d);return c.arrayBuffer().then(g=>m.decode(g))}}}).then(c=>{Qo.add(t,c);const h=dr[t];delete dr[t];for(let f=0,d=h.length;f<d;f++){const m=h[f];m.onLoad&&m.onLoad(c)}}).catch(c=>{const h=dr[t];if(h===void 0)throw this.manager.itemError(t),c;delete dr[t];for(let f=0,d=h.length;f<d;f++){const m=h[f];m.onError&&m.onError(c)}this.manager.itemError(t)}).finally(()=>{this.manager.itemEnd(t)}),this.manager.itemStart(t)}setResponseType(t){return this.responseType=t,this}setMimeType(t){return this.mimeType=t,this}}class _B extends Ai{constructor(t){super(t)}load(t,e,n,i){const r=this,o=new Ar(this.manager);o.setPath(this.path),o.setRequestHeader(this.requestHeader),o.setWithCredentials(this.withCredentials),o.load(t,function(a){try{e(r.parse(JSON.parse(a)))}catch(l){i?i(l):console.error(l),r.manager.itemError(t)}},n,i)}parse(t){const e=[];for(let n=0;n<t.length;n++){const i=iu.parse(t[n]);e.push(i)}return e}}class yB extends Ai{constructor(t){super(t)}load(t,e,n,i){const r=this,o=[],a=new xd,l=new Ar(this.manager);l.setPath(this.path),l.setResponseType("arraybuffer"),l.setRequestHeader(this.requestHeader),l.setWithCredentials(r.withCredentials);let c=0;function h(f){l.load(t[f],function(d){const m=r.parse(d,!0);o[f]={width:m.width,height:m.height,format:m.format,mipmaps:m.mipmaps},c+=1,c===6&&(m.mipmapCount===1&&(a.minFilter=fn),a.image=o,a.format=m.format,a.needsUpdate=!0,e&&e(a))},n,i)}if(Array.isArray(t))for(let f=0,d=t.length;f<d;++f)h(f);else l.load(t,function(f){const d=r.parse(f,!0);if(d.isCubemap){const m=d.mipmaps.length/d.mipmapCount;for(let g=0;g<m;g++){o[g]={mipmaps:[]};for(let y=0;y<d.mipmapCount;y++)o[g].mipmaps.push(d.mipmaps[g*d.mipmapCount+y]),o[g].format=d.format,o[g].width=d.width,o[g].height=d.height}a.image=o}else a.image.width=d.width,a.image.height=d.height,a.mipmaps=d.mipmaps;d.mipmapCount===1&&(a.minFilter=fn),a.format=d.format,a.needsUpdate=!0,e&&e(a)},n,i);return a}}class su extends Ai{constructor(t){super(t)}load(t,e,n,i){this.path!==void 0&&(t=this.path+t),t=this.manager.resolveURL(t);const r=this,o=Qo.get(t);if(o!==void 0)return r.manager.itemStart(t),setTimeout(function(){e&&e(o),r.manager.itemEnd(t)},0),o;const a=Zc("img");function l(){h(),Qo.add(t,this),e&&e(this),r.manager.itemEnd(t)}function c(f){h(),i&&i(f),r.manager.itemError(t),r.manager.itemEnd(t)}function h(){a.removeEventListener("load",l,!1),a.removeEventListener("error",c,!1)}return a.addEventListener("load",l,!1),a.addEventListener("error",c,!1),t.slice(0,5)!=="data:"&&this.crossOrigin!==void 0&&(a.crossOrigin=this.crossOrigin),r.manager.itemStart(t),a.src=t,a}}class xB extends Ai{constructor(t){super(t)}load(t,e,n,i){const r=new xu;r.colorSpace=ve;const o=new su(this.manager);o.setCrossOrigin(this.crossOrigin),o.setPath(this.path);let a=0;function l(c){o.load(t[c],function(h){r.images[c]=h,a++,a===6&&(r.needsUpdate=!0,e&&e(r))},void 0,i)}for(let c=0;c<t.length;++c)l(c);return r}}class bB extends Ai{constructor(t){super(t)}load(t,e,n,i){const r=this,o=new ml,a=new Ar(this.manager);return a.setResponseType("arraybuffer"),a.setRequestHeader(this.requestHeader),a.setPath(this.path),a.setWithCredentials(r.withCredentials),a.load(t,function(l){const c=r.parse(l);c&&(c.image!==void 0?o.image=c.image:c.data!==void 0&&(o.image.width=c.width,o.image.height=c.height,o.image.data=c.data),o.wrapS=c.wrapS!==void 0?c.wrapS:In,o.wrapT=c.wrapT!==void 0?c.wrapT:In,o.magFilter=c.magFilter!==void 0?c.magFilter:fn,o.minFilter=c.minFilter!==void 0?c.minFilter:fn,o.anisotropy=c.anisotropy!==void 0?c.anisotropy:1,c.colorSpace!==void 0?o.colorSpace=c.colorSpace:c.encoding!==void 0&&(o.encoding=c.encoding),c.flipY!==void 0&&(o.flipY=c.flipY),c.format!==void 0&&(o.format=c.format),c.type!==void 0&&(o.type=c.type),c.mipmaps!==void 0&&(o.mipmaps=c.mipmaps,o.minFilter=so),c.mipmapCount===1&&(o.minFilter=fn),c.generateMipmaps!==void 0&&(o.generateMipmaps=c.generateMipmaps),o.needsUpdate=!0,e&&e(o,c))},n,i),o}}class wB extends Ai{constructor(t){super(t)}load(t,e,n,i){const r=new xn,o=new su(this.manager);return o.setCrossOrigin(this.crossOrigin),o.setPath(this.path),o.load(t,function(a){r.image=a,r.needsUpdate=!0,e!==void 0&&e(r)},n,i),r}}class uo extends Ne{constructor(t,e=1){super(),this.isLight=!0,this.type="Light",this.color=new Vt(t),this.intensity=e}dispose(){}copy(t,e){return super.copy(t,e),this.color.copy(t.color),this.intensity=t.intensity,this}toJSON(t){const e=super.toJSON(t);return e.object.color=this.color.getHex(),e.object.intensity=this.intensity,this.groundColor!==void 0&&(e.object.groundColor=this.groundColor.getHex()),this.distance!==void 0&&(e.object.distance=this.distance),this.angle!==void 0&&(e.object.angle=this.angle),this.decay!==void 0&&(e.object.decay=this.decay),this.penumbra!==void 0&&(e.object.penumbra=this.penumbra),this.shadow!==void 0&&(e.object.shadow=this.shadow.toJSON()),e}}class hA extends uo{constructor(t,e,n){super(t,n),this.isHemisphereLight=!0,this.type="HemisphereLight",this.position.copy(Ne.DEFAULT_UP),this.updateMatrix(),this.groundColor=new Vt(e)}copy(t,e){return super.copy(t,e),this.groundColor.copy(t.groundColor),this}}const sg=new de,gw=new N,vw=new N;class k_{constructor(t){this.camera=t,this.bias=0,this.normalBias=0,this.radius=1,this.blurSamples=8,this.mapSize=new pt(512,512),this.map=null,this.mapPass=null,this.matrix=new de,this.autoUpdate=!0,this.needsUpdate=!1,this._frustum=new pd,this._frameExtents=new pt(1,1),this._viewportCount=1,this._viewports=[new Oe(0,0,1,1)]}getViewportCount(){return this._viewportCount}getFrustum(){return this._frustum}updateMatrices(t){const e=this.camera,n=this.matrix;gw.setFromMatrixPosition(t.matrixWorld),e.position.copy(gw),vw.setFromMatrixPosition(t.target.matrixWorld),e.lookAt(vw),e.updateMatrixWorld(),sg.multiplyMatrices(e.projectionMatrix,e.matrixWorldInverse),this._frustum.setFromProjectionMatrix(sg),n.set(.5,0,0,.5,0,.5,0,.5,0,0,.5,.5,0,0,0,1),n.multiply(sg)}getViewport(t){return this._viewports[t]}getFrameExtents(){return this._frameExtents}dispose(){this.map&&this.map.dispose(),this.mapPass&&this.mapPass.dispose()}copy(t){return this.camera=t.camera.clone(),this.bias=t.bias,this.radius=t.radius,this.mapSize.copy(t.mapSize),this}clone(){return new this.constructor().copy(this)}toJSON(){const t={};return this.bias!==0&&(t.bias=this.bias),this.normalBias!==0&&(t.normalBias=this.normalBias),this.radius!==1&&(t.radius=this.radius),(this.mapSize.x!==512||this.mapSize.y!==512)&&(t.mapSize=this.mapSize.toArray()),t.camera=this.camera.toJSON(!1).object,delete t.camera.matrix,t}}class MB extends k_{constructor(){super(new nn(50,1,.5,500)),this.isSpotLightShadow=!0,this.focus=1}updateMatrices(t){const e=this.camera,n=xl*2*t.angle*this.focus,i=this.mapSize.width/this.mapSize.height,r=t.distance||e.far;(n!==e.fov||i!==e.aspect||r!==e.far)&&(e.fov=n,e.aspect=i,e.far=r,e.updateProjectionMatrix()),super.updateMatrices(t)}copy(t){return super.copy(t),this.focus=t.focus,this}}class fA extends uo{constructor(t,e,n=0,i=Math.PI/3,r=0,o=2){super(t,e),this.isSpotLight=!0,this.type="SpotLight",this.position.copy(Ne.DEFAULT_UP),this.updateMatrix(),this.target=new Ne,this.distance=n,this.angle=i,this.penumbra=r,this.decay=o,this.map=null,this.shadow=new MB}get power(){return this.intensity*Math.PI}set power(t){this.intensity=t/Math.PI}dispose(){this.shadow.dispose()}copy(t,e){return super.copy(t,e),this.distance=t.distance,this.angle=t.angle,this.penumbra=t.penumbra,this.decay=t.decay,this.target=t.target.clone(),this.shadow=t.shadow.clone(),this}}const _w=new de,wc=new N,rg=new N;class SB extends k_{constructor(){super(new nn(90,1,.5,500)),this.isPointLightShadow=!0,this._frameExtents=new pt(4,2),this._viewportCount=6,this._viewports=[new Oe(2,1,1,1),new Oe(0,1,1,1),new Oe(3,1,1,1),new Oe(1,1,1,1),new Oe(3,0,1,1),new Oe(1,0,1,1)],this._cubeDirections=[new N(1,0,0),new N(-1,0,0),new N(0,0,1),new N(0,0,-1),new N(0,1,0),new N(0,-1,0)],this._cubeUps=[new N(0,1,0),new N(0,1,0),new N(0,1,0),new N(0,1,0),new N(0,0,1),new N(0,0,-1)]}updateMatrices(t,e=0){const n=this.camera,i=this.matrix,r=t.distance||n.far;r!==n.far&&(n.far=r,n.updateProjectionMatrix()),wc.setFromMatrixPosition(t.matrixWorld),n.position.copy(wc),rg.copy(n.position),rg.add(this._cubeDirections[e]),n.up.copy(this._cubeUps[e]),n.lookAt(rg),n.updateMatrixWorld(),i.makeTranslation(-wc.x,-wc.y,-wc.z),_w.multiplyMatrices(n.projectionMatrix,n.matrixWorldInverse),this._frustum.setFromProjectionMatrix(_w)}}class dA extends uo{constructor(t,e,n=0,i=2){super(t,e),this.isPointLight=!0,this.type="PointLight",this.distance=n,this.decay=i,this.shadow=new SB}get power(){return this.intensity*4*Math.PI}set power(t){this.intensity=t/(4*Math.PI)}dispose(){this.shadow.dispose()}copy(t,e){return super.copy(t,e),this.distance=t.distance,this.decay=t.decay,this.shadow=t.shadow.clone(),this}}class AB extends k_{constructor(){super(new bu(-5,5,5,-5,.5,500)),this.isDirectionalLightShadow=!0}}class pA extends uo{constructor(t,e){super(t,e),this.isDirectionalLight=!0,this.type="DirectionalLight",this.position.copy(Ne.DEFAULT_UP),this.updateMatrix(),this.target=new Ne,this.shadow=new AB}dispose(){this.shadow.dispose()}copy(t){return super.copy(t),this.target=t.target.clone(),this.shadow=t.shadow.clone(),this}}class mA extends uo{constructor(t,e){super(t,e),this.isAmbientLight=!0,this.type="AmbientLight"}}class gA extends uo{constructor(t,e,n=10,i=10){super(t,e),this.isRectAreaLight=!0,this.type="RectAreaLight",this.width=n,this.height=i}get power(){return this.intensity*this.width*this.height*Math.PI}set power(t){this.intensity=t/(this.width*this.height*Math.PI)}copy(t){return super.copy(t),this.width=t.width,this.height=t.height,this}toJSON(t){const e=super.toJSON(t);return e.object.width=this.width,e.object.height=this.height,e}}class vA{constructor(){this.isSphericalHarmonics3=!0,this.coefficients=[];for(let t=0;t<9;t++)this.coefficients.push(new N)}set(t){for(let e=0;e<9;e++)this.coefficients[e].copy(t[e]);return this}zero(){for(let t=0;t<9;t++)this.coefficients[t].set(0,0,0);return this}getAt(t,e){const n=t.x,i=t.y,r=t.z,o=this.coefficients;return e.copy(o[0]).multiplyScalar(.282095),e.addScaledVector(o[1],.488603*i),e.addScaledVector(o[2],.488603*r),e.addScaledVector(o[3],.488603*n),e.addScaledVector(o[4],1.092548*(n*i)),e.addScaledVector(o[5],1.092548*(i*r)),e.addScaledVector(o[6],.315392*(3*r*r-1)),e.addScaledVector(o[7],1.092548*(n*r)),e.addScaledVector(o[8],.546274*(n*n-i*i)),e}getIrradianceAt(t,e){const n=t.x,i=t.y,r=t.z,o=this.coefficients;return e.copy(o[0]).multiplyScalar(.886227),e.addScaledVector(o[1],2*.511664*i),e.addScaledVector(o[2],2*.511664*r),e.addScaledVector(o[3],2*.511664*n),e.addScaledVector(o[4],2*.429043*n*i),e.addScaledVector(o[5],2*.429043*i*r),e.addScaledVector(o[6],.743125*r*r-.247708),e.addScaledVector(o[7],2*.429043*n*r),e.addScaledVector(o[8],.429043*(n*n-i*i)),e}add(t){for(let e=0;e<9;e++)this.coefficients[e].add(t.coefficients[e]);return this}addScaledSH(t,e){for(let n=0;n<9;n++)this.coefficients[n].addScaledVector(t.coefficients[n],e);return this}scale(t){for(let e=0;e<9;e++)this.coefficients[e].multiplyScalar(t);return this}lerp(t,e){for(let n=0;n<9;n++)this.coefficients[n].lerp(t.coefficients[n],e);return this}equals(t){for(let e=0;e<9;e++)if(!this.coefficients[e].equals(t.coefficients[e]))return!1;return!0}copy(t){return this.set(t.coefficients)}clone(){return new this.constructor().copy(this)}fromArray(t,e=0){const n=this.coefficients;for(let i=0;i<9;i++)n[i].fromArray(t,e+i*3);return this}toArray(t=[],e=0){const n=this.coefficients;for(let i=0;i<9;i++)n[i].toArray(t,e+i*3);return t}static getBasisAt(t,e){const n=t.x,i=t.y,r=t.z;e[0]=.282095,e[1]=.488603*i,e[2]=.488603*r,e[3]=.488603*n,e[4]=1.092548*n*i,e[5]=1.092548*i*r,e[6]=.315392*(3*r*r-1),e[7]=1.092548*n*r,e[8]=.546274*(n*n-i*i)}}class kd extends uo{constructor(t=new vA,e=1){super(void 0,e),this.isLightProbe=!0,this.sh=t}copy(t){return super.copy(t),this.sh.copy(t.sh),this}fromJSON(t){return this.intensity=t.intensity,this.sh.fromArray(t.sh),this}toJSON(t){const e=super.toJSON(t);return e.object.sh=this.sh.toArray(),e}}class Ud extends Ai{constructor(t){super(t),this.textures={}}load(t,e,n,i){const r=this,o=new Ar(r.manager);o.setPath(r.path),o.setRequestHeader(r.requestHeader),o.setWithCredentials(r.withCredentials),o.load(t,function(a){try{e(r.parse(JSON.parse(a)))}catch(l){i?i(l):console.error(l),r.manager.itemError(t)}},n,i)}parse(t){const e=this.textures;function n(r){return e[r]===void 0&&console.warn("THREE.MaterialLoader: Undefined texture",r),e[r]}const i=Ud.createMaterialFromType(t.type);if(t.uuid!==void 0&&(i.uuid=t.uuid),t.name!==void 0&&(i.name=t.name),t.color!==void 0&&i.color!==void 0&&i.color.setHex(t.color),t.roughness!==void 0&&(i.roughness=t.roughness),t.metalness!==void 0&&(i.metalness=t.metalness),t.sheen!==void 0&&(i.sheen=t.sheen),t.sheenColor!==void 0&&(i.sheenColor=new Vt().setHex(t.sheenColor)),t.sheenRoughness!==void 0&&(i.sheenRoughness=t.sheenRoughness),t.emissive!==void 0&&i.emissive!==void 0&&i.emissive.setHex(t.emissive),t.specular!==void 0&&i.specular!==void 0&&i.specular.setHex(t.specular),t.specularIntensity!==void 0&&(i.specularIntensity=t.specularIntensity),t.specularColor!==void 0&&i.specularColor!==void 0&&i.specularColor.setHex(t.specularColor),t.shininess!==void 0&&(i.shininess=t.shininess),t.clearcoat!==void 0&&(i.clearcoat=t.clearcoat),t.clearcoatRoughness!==void 0&&(i.clearcoatRoughness=t.clearcoatRoughness),t.iridescence!==void 0&&(i.iridescence=t.iridescence),t.iridescenceIOR!==void 0&&(i.iridescenceIOR=t.iridescenceIOR),t.iridescenceThicknessRange!==void 0&&(i.iridescenceThicknessRange=t.iridescenceThicknessRange),t.transmission!==void 0&&(i.transmission=t.transmission),t.thickness!==void 0&&(i.thickness=t.thickness),t.attenuationDistance!==void 0&&(i.attenuationDistance=t.attenuationDistance),t.attenuationColor!==void 0&&i.attenuationColor!==void 0&&i.attenuationColor.setHex(t.attenuationColor),t.anisotropy!==void 0&&(i.anisotropy=t.anisotropy),t.anisotropyRotation!==void 0&&(i.anisotropyRotation=t.anisotropyRotation),t.fog!==void 0&&(i.fog=t.fog),t.flatShading!==void 0&&(i.flatShading=t.flatShading),t.blending!==void 0&&(i.blending=t.blending),t.combine!==void 0&&(i.combine=t.combine),t.side!==void 0&&(i.side=t.side),t.shadowSide!==void 0&&(i.shadowSide=t.shadowSide),t.opacity!==void 0&&(i.opacity=t.opacity),t.transparent!==void 0&&(i.transparent=t.transparent),t.alphaTest!==void 0&&(i.alphaTest=t.alphaTest),t.alphaHash!==void 0&&(i.alphaHash=t.alphaHash),t.depthTest!==void 0&&(i.depthTest=t.depthTest),t.depthWrite!==void 0&&(i.depthWrite=t.depthWrite),t.colorWrite!==void 0&&(i.colorWrite=t.colorWrite),t.stencilWrite!==void 0&&(i.stencilWrite=t.stencilWrite),t.stencilWriteMask!==void 0&&(i.stencilWriteMask=t.stencilWriteMask),t.stencilFunc!==void 0&&(i.stencilFunc=t.stencilFunc),t.stencilRef!==void 0&&(i.stencilRef=t.stencilRef),t.stencilFuncMask!==void 0&&(i.stencilFuncMask=t.stencilFuncMask),t.stencilFail!==void 0&&(i.stencilFail=t.stencilFail),t.stencilZFail!==void 0&&(i.stencilZFail=t.stencilZFail),t.stencilZPass!==void 0&&(i.stencilZPass=t.stencilZPass),t.wireframe!==void 0&&(i.wireframe=t.wireframe),t.wireframeLinewidth!==void 0&&(i.wireframeLinewidth=t.wireframeLinewidth),t.wireframeLinecap!==void 0&&(i.wireframeLinecap=t.wireframeLinecap),t.wireframeLinejoin!==void 0&&(i.wireframeLinejoin=t.wireframeLinejoin),t.rotation!==void 0&&(i.rotation=t.rotation),t.linewidth!==1&&(i.linewidth=t.linewidth),t.dashSize!==void 0&&(i.dashSize=t.dashSize),t.gapSize!==void 0&&(i.gapSize=t.gapSize),t.scale!==void 0&&(i.scale=t.scale),t.polygonOffset!==void 0&&(i.polygonOffset=t.polygonOffset),t.polygonOffsetFactor!==void 0&&(i.polygonOffsetFactor=t.polygonOffsetFactor),t.polygonOffsetUnits!==void 0&&(i.polygonOffsetUnits=t.polygonOffsetUnits),t.dithering!==void 0&&(i.dithering=t.dithering),t.alphaToCoverage!==void 0&&(i.alphaToCoverage=t.alphaToCoverage),t.premultipliedAlpha!==void 0&&(i.premultipliedAlpha=t.premultipliedAlpha),t.forceSinglePass!==void 0&&(i.forceSinglePass=t.forceSinglePass),t.visible!==void 0&&(i.visible=t.visible),t.toneMapped!==void 0&&(i.toneMapped=t.toneMapped),t.userData!==void 0&&(i.userData=t.userData),t.vertexColors!==void 0&&(typeof t.vertexColors=="number"?i.vertexColors=t.vertexColors>0:i.vertexColors=t.vertexColors),t.uniforms!==void 0)for(const r in t.uniforms){const o=t.uniforms[r];switch(i.uniforms[r]={},o.type){case"t":i.uniforms[r].value=n(o.value);break;case"c":i.uniforms[r].value=new Vt().setHex(o.value);break;case"v2":i.uniforms[r].value=new pt().fromArray(o.value);break;case"v3":i.uniforms[r].value=new N().fromArray(o.value);break;case"v4":i.uniforms[r].value=new Oe().fromArray(o.value);break;case"m3":i.uniforms[r].value=new Te().fromArray(o.value);break;case"m4":i.uniforms[r].value=new de().fromArray(o.value);break;default:i.uniforms[r].value=o.value}}if(t.defines!==void 0&&(i.defines=t.defines),t.vertexShader!==void 0&&(i.vertexShader=t.vertexShader),t.fragmentShader!==void 0&&(i.fragmentShader=t.fragmentShader),t.glslVersion!==void 0&&(i.glslVersion=t.glslVersion),t.extensions!==void 0)for(const r in t.extensions)i.extensions[r]=t.extensions[r];if(t.lights!==void 0&&(i.lights=t.lights),t.clipping!==void 0&&(i.clipping=t.clipping),t.size!==void 0&&(i.size=t.size),t.sizeAttenuation!==void 0&&(i.sizeAttenuation=t.sizeAttenuation),t.map!==void 0&&(i.map=n(t.map)),t.matcap!==void 0&&(i.matcap=n(t.matcap)),t.alphaMap!==void 0&&(i.alphaMap=n(t.alphaMap)),t.bumpMap!==void 0&&(i.bumpMap=n(t.bumpMap)),t.bumpScale!==void 0&&(i.bumpScale=t.bumpScale),t.normalMap!==void 0&&(i.normalMap=n(t.normalMap)),t.normalMapType!==void 0&&(i.normalMapType=t.normalMapType),t.normalScale!==void 0){let r=t.normalScale;Array.isArray(r)===!1&&(r=[r,r]),i.normalScale=new pt().fromArray(r)}return t.displacementMap!==void 0&&(i.displacementMap=n(t.displacementMap)),t.displacementScale!==void 0&&(i.displacementScale=t.displacementScale),t.displacementBias!==void 0&&(i.displacementBias=t.displacementBias),t.roughnessMap!==void 0&&(i.roughnessMap=n(t.roughnessMap)),t.metalnessMap!==void 0&&(i.metalnessMap=n(t.metalnessMap)),t.emissiveMap!==void 0&&(i.emissiveMap=n(t.emissiveMap)),t.emissiveIntensity!==void 0&&(i.emissiveIntensity=t.emissiveIntensity),t.specularMap!==void 0&&(i.specularMap=n(t.specularMap)),t.specularIntensityMap!==void 0&&(i.specularIntensityMap=n(t.specularIntensityMap)),t.specularColorMap!==void 0&&(i.specularColorMap=n(t.specularColorMap)),t.envMap!==void 0&&(i.envMap=n(t.envMap)),t.envMapIntensity!==void 0&&(i.envMapIntensity=t.envMapIntensity),t.reflectivity!==void 0&&(i.reflectivity=t.reflectivity),t.refractionRatio!==void 0&&(i.refractionRatio=t.refractionRatio),t.lightMap!==void 0&&(i.lightMap=n(t.lightMap)),t.lightMapIntensity!==void 0&&(i.lightMapIntensity=t.lightMapIntensity),t.aoMap!==void 0&&(i.aoMap=n(t.aoMap)),t.aoMapIntensity!==void 0&&(i.aoMapIntensity=t.aoMapIntensity),t.gradientMap!==void 0&&(i.gradientMap=n(t.gradientMap)),t.clearcoatMap!==void 0&&(i.clearcoatMap=n(t.clearcoatMap)),t.clearcoatRoughnessMap!==void 0&&(i.clearcoatRoughnessMap=n(t.clearcoatRoughnessMap)),t.clearcoatNormalMap!==void 0&&(i.clearcoatNormalMap=n(t.clearcoatNormalMap)),t.clearcoatNormalScale!==void 0&&(i.clearcoatNormalScale=new pt().fromArray(t.clearcoatNormalScale)),t.iridescenceMap!==void 0&&(i.iridescenceMap=n(t.iridescenceMap)),t.iridescenceThicknessMap!==void 0&&(i.iridescenceThicknessMap=n(t.iridescenceThicknessMap)),t.transmissionMap!==void 0&&(i.transmissionMap=n(t.transmissionMap)),t.thicknessMap!==void 0&&(i.thicknessMap=n(t.thicknessMap)),t.anisotropyMap!==void 0&&(i.anisotropyMap=n(t.anisotropyMap)),t.sheenColorMap!==void 0&&(i.sheenColorMap=n(t.sheenColorMap)),t.sheenRoughnessMap!==void 0&&(i.sheenRoughnessMap=n(t.sheenRoughnessMap)),i}setTextures(t){return this.textures=t,this}static createMaterialFromType(t){const e={ShadowMaterial:JS,SpriteMaterial:x_,RawShaderMaterial:P_,ShaderMaterial:qs,PointsMaterial:w_,MeshPhysicalMaterial:QS,MeshStandardMaterial:R_,MeshPhongMaterial:tA,MeshToonMaterial:eA,MeshNormalMaterial:nA,MeshLambertMaterial:iA,MeshDepthMaterial:g_,MeshDistanceMaterial:v_,MeshBasicMaterial:Tr,MeshMatcapMaterial:sA,LineDashedMaterial:rA,LineBasicMaterial:li,Material:Zn};return new e[t]}}class uv{static decodeText(t){if(typeof TextDecoder<"u")return new TextDecoder().decode(t);let e="";for(let n=0,i=t.length;n<i;n++)e+=String.fromCharCode(t[n]);try{return decodeURIComponent(escape(e))}catch{return e}}static extractUrlBase(t){const e=t.lastIndexOf("/");return e===-1?"./":t.slice(0,e+1)}static resolveURL(t,e){return typeof t!="string"||t===""?"":(/^https?:\/\//i.test(e)&&/^\//.test(t)&&(e=e.replace(/(^https?:\/\/[^\/]+).*/i,"$1")),/^(https?:)?\/\//i.test(t)||/^data:.*,.*$/i.test(t)||/^blob:.*$/i.test(t)?t:e+t)}}class _A extends we{constructor(){super(),this.isInstancedBufferGeometry=!0,this.type="InstancedBufferGeometry",this.instanceCount=1/0}copy(t){return super.copy(t),this.instanceCount=t.instanceCount,this}toJSON(){const t=super.toJSON();return t.instanceCount=this.instanceCount,t.isInstancedBufferGeometry=!0,t}}class yA extends Ai{constructor(t){super(t)}load(t,e,n,i){const r=this,o=new Ar(r.manager);o.setPath(r.path),o.setRequestHeader(r.requestHeader),o.setWithCredentials(r.withCredentials),o.load(t,function(a){try{e(r.parse(JSON.parse(a)))}catch(l){i?i(l):console.error(l),r.manager.itemError(t)}},n,i)}parse(t){const e={},n={};function i(m,g){if(e[g]!==void 0)return e[g];const _=m.interleavedBuffers[g],v=r(m,_.buffer),w=rl(_.type,v),b=new _d(w,_.stride);return b.uuid=_.uuid,e[g]=b,b}function r(m,g){if(n[g]!==void 0)return n[g];const _=m.arrayBuffers[g],v=new Uint32Array(_).buffer;return n[g]=v,v}const o=t.isInstancedBufferGeometry?new _A:new we,a=t.data.index;if(a!==void 0){const m=rl(a.type,a.array);o.setIndex(new ue(m,1))}const l=t.data.attributes;for(const m in l){const g=l[m];let y;if(g.isInterleavedBufferAttribute){const _=i(t.data,g.data);y=new Ko(_,g.itemSize,g.offset,g.normalized)}else{const _=rl(g.type,g.array),v=g.isInstancedBufferAttribute?wl:ue;y=new v(_,g.itemSize,g.normalized)}g.name!==void 0&&(y.name=g.name),g.usage!==void 0&&y.setUsage(g.usage),g.updateRange!==void 0&&(y.updateRange.offset=g.updateRange.offset,y.updateRange.count=g.updateRange.count),o.setAttribute(m,y)}const c=t.data.morphAttributes;if(c)for(const m in c){const g=c[m],y=[];for(let _=0,v=g.length;_<v;_++){const w=g[_];let b;if(w.isInterleavedBufferAttribute){const M=i(t.data,w.data);b=new Ko(M,w.itemSize,w.offset,w.normalized)}else{const M=rl(w.type,w.array);b=new ue(M,w.itemSize,w.normalized)}w.name!==void 0&&(b.name=w.name),y.push(b)}o.morphAttributes[m]=y}t.data.morphTargetsRelative&&(o.morphTargetsRelative=!0);const f=t.data.groups||t.data.drawcalls||t.data.offsets;if(f!==void 0)for(let m=0,g=f.length;m!==g;++m){const y=f[m];o.addGroup(y.start,y.count,y.materialIndex)}const d=t.data.boundingSphere;if(d!==void 0){const m=new N;d.center!==void 0&&m.fromArray(d.center),o.boundingSphere=new Ts(m,d.radius)}return t.name&&(o.name=t.name),t.userData&&(o.userData=t.userData),o}}class EB extends Ai{constructor(t){super(t)}load(t,e,n,i){const r=this,o=this.path===""?uv.extractUrlBase(t):this.path;this.resourcePath=this.resourcePath||o;const a=new Ar(this.manager);a.setPath(this.path),a.setRequestHeader(this.requestHeader),a.setWithCredentials(this.withCredentials),a.load(t,function(l){let c=null;try{c=JSON.parse(l)}catch(f){i!==void 0&&i(f),console.error("THREE:ObjectLoader: Can't parse "+t+".",f.message);return}const h=c.metadata;if(h===void 0||h.type===void 0||h.type.toLowerCase()==="geometry"){i!==void 0&&i(new Error("THREE.ObjectLoader: Can't load "+t)),console.error("THREE.ObjectLoader: Can't load "+t);return}r.parse(c,e)},n,i)}async loadAsync(t,e){const n=this,i=this.path===""?uv.extractUrlBase(t):this.path;this.resourcePath=this.resourcePath||i;const r=new Ar(this.manager);r.setPath(this.path),r.setRequestHeader(this.requestHeader),r.setWithCredentials(this.withCredentials);const o=await r.loadAsync(t,e),a=JSON.parse(o),l=a.metadata;if(l===void 0||l.type===void 0||l.type.toLowerCase()==="geometry")throw new Error("THREE.ObjectLoader: Can't load "+t);return await n.parseAsync(a)}parse(t,e){const n=this.parseAnimations(t.animations),i=this.parseShapes(t.shapes),r=this.parseGeometries(t.geometries,i),o=this.parseImages(t.images,function(){e!==void 0&&e(c)}),a=this.parseTextures(t.textures,o),l=this.parseMaterials(t.materials,a),c=this.parseObject(t.object,r,l,a,n),h=this.parseSkeletons(t.skeletons,c);if(this.bindSkeletons(c,h),e!==void 0){let f=!1;for(const d in o)if(o[d].data instanceof HTMLImageElement){f=!0;break}f===!1&&e(c)}return c}async parseAsync(t){const e=this.parseAnimations(t.animations),n=this.parseShapes(t.shapes),i=this.parseGeometries(t.geometries,n),r=await this.parseImagesAsync(t.images),o=this.parseTextures(t.textures,r),a=this.parseMaterials(t.materials,o),l=this.parseObject(t.object,i,a,o,e),c=this.parseSkeletons(t.skeletons,l);return this.bindSkeletons(l,c),l}parseShapes(t){const e={};if(t!==void 0)for(let n=0,i=t.length;n<i;n++){const r=new Xo().fromJSON(t[n]);e[r.uuid]=r}return e}parseSkeletons(t,e){const n={},i={};if(e.traverse(function(r){r.isBone&&(i[r.uuid]=r)}),t!==void 0)for(let r=0,o=t.length;r<o;r++){const a=new yd().fromJSON(t[r],i);n[a.uuid]=a}return n}parseGeometries(t,e){const n={};if(t!==void 0){const i=new yA;for(let r=0,o=t.length;r<o;r++){let a;const l=t[r];switch(l.type){case"BufferGeometry":case"InstancedBufferGeometry":a=i.parse(l);break;default:l.type in mw?a=mw[l.type].fromJSON(l,e):console.warn(`THREE.ObjectLoader: Unsupported geometry type "${l.type}"`)}a.uuid=l.uuid,l.name!==void 0&&(a.name=l.name),l.userData!==void 0&&(a.userData=l.userData),n[l.uuid]=a}}return n}parseMaterials(t,e){const n={},i={};if(t!==void 0){const r=new Ud;r.setTextures(e);for(let o=0,a=t.length;o<a;o++){const l=t[o];n[l.uuid]===void 0&&(n[l.uuid]=r.parse(l)),i[l.uuid]=n[l.uuid]}}return i}parseAnimations(t){const e={};if(t!==void 0)for(let n=0;n<t.length;n++){const i=t[n],r=iu.parse(i);e[r.uuid]=r}return e}parseImages(t,e){const n=this,i={};let r;function o(l){return n.manager.itemStart(l),r.load(l,function(){n.manager.itemEnd(l)},void 0,function(){n.manager.itemError(l),n.manager.itemEnd(l)})}function a(l){if(typeof l=="string"){const c=l,h=/^(\/\/)|([a-z]+:(\/\/)?)/i.test(c)?c:n.resourcePath+c;return o(h)}else return l.data?{data:rl(l.type,l.data),width:l.width,height:l.height}:null}if(t!==void 0&&t.length>0){const l=new z_(e);r=new su(l),r.setCrossOrigin(this.crossOrigin);for(let c=0,h=t.length;c<h;c++){const f=t[c],d=f.url;if(Array.isArray(d)){const m=[];for(let g=0,y=d.length;g<y;g++){const _=d[g],v=a(_);v!==null&&(v instanceof HTMLImageElement?m.push(v):m.push(new ml(v.data,v.width,v.height)))}i[f.uuid]=new Go(m)}else{const m=a(f.url);i[f.uuid]=new Go(m)}}}return i}async parseImagesAsync(t){const e=this,n={};let i;async function r(o){if(typeof o=="string"){const a=o,l=/^(\/\/)|([a-z]+:(\/\/)?)/i.test(a)?a:e.resourcePath+a;return await i.loadAsync(l)}else return o.data?{data:rl(o.type,o.data),width:o.width,height:o.height}:null}if(t!==void 0&&t.length>0){i=new su(this.manager),i.setCrossOrigin(this.crossOrigin);for(let o=0,a=t.length;o<a;o++){const l=t[o],c=l.url;if(Array.isArray(c)){const h=[];for(let f=0,d=c.length;f<d;f++){const m=c[f],g=await r(m);g!==null&&(g instanceof HTMLImageElement?h.push(g):h.push(new ml(g.data,g.width,g.height)))}n[l.uuid]=new Go(h)}else{const h=await r(l.url);n[l.uuid]=new Go(h)}}}return n}parseTextures(t,e){function n(r,o){return typeof r=="number"?r:(console.warn("THREE.ObjectLoader.parseTexture: Constant should be in numeric form.",r),o[r])}const i={};if(t!==void 0)for(let r=0,o=t.length;r<o;r++){const a=t[r];a.image===void 0&&console.warn('THREE.ObjectLoader: No "image" specified for',a.uuid),e[a.image]===void 0&&console.warn("THREE.ObjectLoader: Undefined image",a.image);const l=e[a.image],c=l.data;let h;Array.isArray(c)?(h=new xu,c.length===6&&(h.needsUpdate=!0)):(c&&c.data?h=new ml:h=new xn,c&&(h.needsUpdate=!0)),h.source=l,h.uuid=a.uuid,a.name!==void 0&&(h.name=a.name),a.mapping!==void 0&&(h.mapping=n(a.mapping,TB)),a.channel!==void 0&&(h.channel=a.channel),a.offset!==void 0&&h.offset.fromArray(a.offset),a.repeat!==void 0&&h.repeat.fromArray(a.repeat),a.center!==void 0&&h.center.fromArray(a.center),a.rotation!==void 0&&(h.rotation=a.rotation),a.wrap!==void 0&&(h.wrapS=n(a.wrap[0],yw),h.wrapT=n(a.wrap[1],yw)),a.format!==void 0&&(h.format=a.format),a.internalFormat!==void 0&&(h.internalFormat=a.internalFormat),a.type!==void 0&&(h.type=a.type),a.colorSpace!==void 0&&(h.colorSpace=a.colorSpace),a.encoding!==void 0&&(h.encoding=a.encoding),a.minFilter!==void 0&&(h.minFilter=n(a.minFilter,xw)),a.magFilter!==void 0&&(h.magFilter=n(a.magFilter,xw)),a.anisotropy!==void 0&&(h.anisotropy=a.anisotropy),a.flipY!==void 0&&(h.flipY=a.flipY),a.generateMipmaps!==void 0&&(h.generateMipmaps=a.generateMipmaps),a.premultiplyAlpha!==void 0&&(h.premultiplyAlpha=a.premultiplyAlpha),a.unpackAlignment!==void 0&&(h.unpackAlignment=a.unpackAlignment),a.compareFunction!==void 0&&(h.compareFunction=a.compareFunction),a.userData!==void 0&&(h.userData=a.userData),i[a.uuid]=h}return i}parseObject(t,e,n,i,r){let o;function a(d){return e[d]===void 0&&console.warn("THREE.ObjectLoader: Undefined geometry",d),e[d]}function l(d){if(d!==void 0){if(Array.isArray(d)){const m=[];for(let g=0,y=d.length;g<y;g++){const _=d[g];n[_]===void 0&&console.warn("THREE.ObjectLoader: Undefined material",_),m.push(n[_])}return m}return n[d]===void 0&&console.warn("THREE.ObjectLoader: Undefined material",d),n[d]}}function c(d){return i[d]===void 0&&console.warn("THREE.ObjectLoader: Undefined texture",d),i[d]}let h,f;switch(t.type){case"Scene":o=new zl,t.background!==void 0&&(Number.isInteger(t.background)?o.background=new Vt(t.background):o.background=c(t.background)),t.environment!==void 0&&(o.environment=c(t.environment)),t.fog!==void 0&&(t.fog.type==="Fog"?o.fog=new vd(t.fog.color,t.fog.near,t.fog.far):t.fog.type==="FogExp2"&&(o.fog=new gd(t.fog.color,t.fog.density))),t.backgroundBlurriness!==void 0&&(o.backgroundBlurriness=t.backgroundBlurriness),t.backgroundIntensity!==void 0&&(o.backgroundIntensity=t.backgroundIntensity);break;case"PerspectiveCamera":o=new nn(t.fov,t.aspect,t.near,t.far),t.focus!==void 0&&(o.focus=t.focus),t.zoom!==void 0&&(o.zoom=t.zoom),t.filmGauge!==void 0&&(o.filmGauge=t.filmGauge),t.filmOffset!==void 0&&(o.filmOffset=t.filmOffset),t.view!==void 0&&(o.view=Object.assign({},t.view));break;case"OrthographicCamera":o=new bu(t.left,t.right,t.top,t.bottom,t.near,t.far),t.zoom!==void 0&&(o.zoom=t.zoom),t.view!==void 0&&(o.view=Object.assign({},t.view));break;case"AmbientLight":o=new mA(t.color,t.intensity);break;case"DirectionalLight":o=new pA(t.color,t.intensity);break;case"PointLight":o=new dA(t.color,t.intensity,t.distance,t.decay);break;case"RectAreaLight":o=new gA(t.color,t.intensity,t.width,t.height);break;case"SpotLight":o=new fA(t.color,t.intensity,t.distance,t.angle,t.penumbra,t.decay);break;case"HemisphereLight":o=new hA(t.color,t.groundColor,t.intensity);break;case"LightProbe":o=new kd().fromJSON(t);break;case"SkinnedMesh":h=a(t.geometry),f=l(t.material),o=new NS(h,f),t.bindMode!==void 0&&(o.bindMode=t.bindMode),t.bindMatrix!==void 0&&o.bindMatrix.fromArray(t.bindMatrix),t.skeleton!==void 0&&(o.skeleton=t.skeleton);break;case"Mesh":h=a(t.geometry),f=l(t.material),o=new Xe(h,f);break;case"InstancedMesh":h=a(t.geometry),f=l(t.material);const d=t.count,m=t.instanceMatrix,g=t.instanceColor;o=new FS(h,f,d),o.instanceMatrix=new wl(new Float32Array(m.array),16),g!==void 0&&(o.instanceColor=new wl(new Float32Array(g.array),g.itemSize));break;case"LOD":o=new US;break;case"Line":o=new ro(a(t.geometry),l(t.material));break;case"LineLoop":o=new BS(a(t.geometry),l(t.material));break;case"LineSegments":o=new Ys(a(t.geometry),l(t.material));break;case"PointCloud":case"Points":o=new HS(a(t.geometry),l(t.material));break;case"Sprite":o=new kS(l(t.material));break;case"Group":o=new al;break;case"Bone":o=new b_;break;default:o=new Ne}if(o.uuid=t.uuid,t.name!==void 0&&(o.name=t.name),t.matrix!==void 0?(o.matrix.fromArray(t.matrix),t.matrixAutoUpdate!==void 0&&(o.matrixAutoUpdate=t.matrixAutoUpdate),o.matrixAutoUpdate&&o.matrix.decompose(o.position,o.quaternion,o.scale)):(t.position!==void 0&&o.position.fromArray(t.position),t.rotation!==void 0&&o.rotation.fromArray(t.rotation),t.quaternion!==void 0&&o.quaternion.fromArray(t.quaternion),t.scale!==void 0&&o.scale.fromArray(t.scale)),t.up!==void 0&&o.up.fromArray(t.up),t.castShadow!==void 0&&(o.castShadow=t.castShadow),t.receiveShadow!==void 0&&(o.receiveShadow=t.receiveShadow),t.shadow&&(t.shadow.bias!==void 0&&(o.shadow.bias=t.shadow.bias),t.shadow.normalBias!==void 0&&(o.shadow.normalBias=t.shadow.normalBias),t.shadow.radius!==void 0&&(o.shadow.radius=t.shadow.radius),t.shadow.mapSize!==void 0&&o.shadow.mapSize.fromArray(t.shadow.mapSize),t.shadow.camera!==void 0&&(o.shadow.camera=this.parseObject(t.shadow.camera))),t.visible!==void 0&&(o.visible=t.visible),t.frustumCulled!==void 0&&(o.frustumCulled=t.frustumCulled),t.renderOrder!==void 0&&(o.renderOrder=t.renderOrder),t.userData!==void 0&&(o.userData=t.userData),t.layers!==void 0&&(o.layers.mask=t.layers),t.children!==void 0){const d=t.children;for(let m=0;m<d.length;m++)o.add(this.parseObject(d[m],e,n,i,r))}if(t.animations!==void 0){const d=t.animations;for(let m=0;m<d.length;m++){const g=d[m];o.animations.push(r[g])}}if(t.type==="LOD"){t.autoUpdate!==void 0&&(o.autoUpdate=t.autoUpdate);const d=t.levels;for(let m=0;m<d.length;m++){const g=d[m],y=o.getObjectByProperty("uuid",g.object);y!==void 0&&o.addLevel(y,g.distance,g.hysteresis)}}return o}bindSkeletons(t,e){Object.keys(e).length!==0&&t.traverse(function(n){if(n.isSkinnedMesh===!0&&n.skeleton!==void 0){const i=e[n.skeleton];i===void 0?console.warn("THREE.ObjectLoader: No skeleton found with UUID:",n.skeleton):n.bind(i,n.bindMatrix)}})}}const TB={UVMapping:vu,CubeReflectionMapping:Sr,CubeRefractionMapping:io,EquirectangularReflectionMapping:Vc,EquirectangularRefractionMapping:Gc,CubeUVReflectionMapping:Rl},yw={RepeatWrapping:vl,ClampToEdgeWrapping:In,MirroredRepeatWrapping:_l},xw={NearestFilter:Ve,NearestMipmapNearestFilter:Ff,NearestMipmapLinearFilter:Oc,LinearFilter:fn,LinearMipmapNearestFilter:e_,LinearMipmapLinearFilter:so};class CB extends Ai{constructor(t){super(t),this.isImageBitmapLoader=!0,typeof createImageBitmap>"u"&&console.warn("THREE.ImageBitmapLoader: createImageBitmap() not supported."),typeof fetch>"u"&&console.warn("THREE.ImageBitmapLoader: fetch() not supported."),this.options={premultiplyAlpha:"none"}}setOptions(t){return this.options=t,this}load(t,e,n,i){t===void 0&&(t=""),this.path!==void 0&&(t=this.path+t),t=this.manager.resolveURL(t);const r=this,o=Qo.get(t);if(o!==void 0)return r.manager.itemStart(t),setTimeout(function(){e&&e(o),r.manager.itemEnd(t)},0),o;const a={};a.credentials=this.crossOrigin==="anonymous"?"same-origin":"include",a.headers=this.requestHeader,fetch(t,a).then(function(l){return l.blob()}).then(function(l){return createImageBitmap(l,Object.assign(r.options,{colorSpaceConversion:"none"}))}).then(function(l){Qo.add(t,l),e&&e(l),r.manager.itemEnd(t)}).catch(function(l){i&&i(l),r.manager.itemError(t),r.manager.itemEnd(t)}),r.manager.itemStart(t)}}let rf;class U_{static getContext(){return rf===void 0&&(rf=new(window.AudioContext||window.webkitAudioContext)),rf}static setContext(t){rf=t}}class PB extends Ai{constructor(t){super(t)}load(t,e,n,i){const r=this,o=new Ar(this.manager);o.setResponseType("arraybuffer"),o.setPath(this.path),o.setRequestHeader(this.requestHeader),o.setWithCredentials(this.withCredentials),o.load(t,function(l){try{const c=l.slice(0);U_.getContext().decodeAudioData(c,function(f){e(f)},a)}catch(c){a(c)}},n,i);function a(l){i?i(l):console.error(l),r.manager.itemError(t)}}}class RB extends kd{constructor(t,e,n=1){super(void 0,n),this.isHemisphereLightProbe=!0;const i=new Vt().set(t),r=new Vt().set(e),o=new N(i.r,i.g,i.b),a=new N(r.r,r.g,r.b),l=Math.sqrt(Math.PI),c=l*Math.sqrt(.75);this.sh.coefficients[0].copy(o).add(a).multiplyScalar(l),this.sh.coefficients[1].copy(o).sub(a).multiplyScalar(c)}}class LB extends kd{constructor(t,e=1){super(void 0,e),this.isAmbientLightProbe=!0;const n=new Vt().set(t);this.sh.coefficients[0].set(n.r,n.g,n.b).multiplyScalar(2*Math.sqrt(Math.PI))}}const bw=new de,ww=new de,Co=new de;class DB{constructor(){this.type="StereoCamera",this.aspect=1,this.eyeSep=.064,this.cameraL=new nn,this.cameraL.layers.enable(1),this.cameraL.matrixAutoUpdate=!1,this.cameraR=new nn,this.cameraR.layers.enable(2),this.cameraR.matrixAutoUpdate=!1,this._cache={focus:null,fov:null,aspect:null,near:null,far:null,zoom:null,eyeSep:null}}update(t){const e=this._cache;if(e.focus!==t.focus||e.fov!==t.fov||e.aspect!==t.aspect*this.aspect||e.near!==t.near||e.far!==t.far||e.zoom!==t.zoom||e.eyeSep!==this.eyeSep){e.focus=t.focus,e.fov=t.fov,e.aspect=t.aspect*this.aspect,e.near=t.near,e.far=t.far,e.zoom=t.zoom,e.eyeSep=this.eyeSep,Co.copy(t.projectionMatrix);const i=e.eyeSep/2,r=i*e.near/e.focus,o=e.near*Math.tan($o*e.fov*.5)/e.zoom;let a,l;ww.elements[12]=-i,bw.elements[12]=i,a=-o*e.aspect+r,l=o*e.aspect+r,Co.elements[0]=2*e.near/(l-a),Co.elements[8]=(l+a)/(l-a),this.cameraL.projectionMatrix.copy(Co),a=-o*e.aspect-r,l=o*e.aspect-r,Co.elements[0]=2*e.near/(l-a),Co.elements[8]=(l+a)/(l-a),this.cameraR.projectionMatrix.copy(Co)}this.cameraL.matrixWorld.copy(t.matrixWorld).multiply(ww),this.cameraR.matrixWorld.copy(t.matrixWorld).multiply(bw)}}let N_=class{constructor(t=!0){this.autoStart=t,this.startTime=0,this.oldTime=0,this.elapsedTime=0,this.running=!1}start(){this.startTime=Mw(),this.oldTime=this.startTime,this.elapsedTime=0,this.running=!0}stop(){this.getElapsedTime(),this.running=!1,this.autoStart=!1}getElapsedTime(){return this.getDelta(),this.elapsedTime}getDelta(){let t=0;if(this.autoStart&&!this.running)return this.start(),0;if(this.running){const e=Mw();t=(e-this.oldTime)/1e3,this.oldTime=e,this.elapsedTime+=t}return t}};function Mw(){return(typeof performance>"u"?Date:performance).now()}const Po=new N,Sw=new Pn,IB=new N,Ro=new N;class OB extends Ne{constructor(){super(),this.type="AudioListener",this.context=U_.getContext(),this.gain=this.context.createGain(),this.gain.connect(this.context.destination),this.filter=null,this.timeDelta=0,this._clock=new N_}getInput(){return this.gain}removeFilter(){return this.filter!==null&&(this.gain.disconnect(this.filter),this.filter.disconnect(this.context.destination),this.gain.connect(this.context.destination),this.filter=null),this}getFilter(){return this.filter}setFilter(t){return this.filter!==null?(this.gain.disconnect(this.filter),this.filter.disconnect(this.context.destination)):this.gain.disconnect(this.context.destination),this.filter=t,this.gain.connect(this.filter),this.filter.connect(this.context.destination),this}getMasterVolume(){return this.gain.gain.value}setMasterVolume(t){return this.gain.gain.setTargetAtTime(t,this.context.currentTime,.01),this}updateMatrixWorld(t){super.updateMatrixWorld(t);const e=this.context.listener,n=this.up;if(this.timeDelta=this._clock.getDelta(),this.matrixWorld.decompose(Po,Sw,IB),Ro.set(0,0,-1).applyQuaternion(Sw),e.positionX){const i=this.context.currentTime+this.timeDelta;e.positionX.linearRampToValueAtTime(Po.x,i),e.positionY.linearRampToValueAtTime(Po.y,i),e.positionZ.linearRampToValueAtTime(Po.z,i),e.forwardX.linearRampToValueAtTime(Ro.x,i),e.forwardY.linearRampToValueAtTime(Ro.y,i),e.forwardZ.linearRampToValueAtTime(Ro.z,i),e.upX.linearRampToValueAtTime(n.x,i),e.upY.linearRampToValueAtTime(n.y,i),e.upZ.linearRampToValueAtTime(n.z,i)}else e.setPosition(Po.x,Po.y,Po.z),e.setOrientation(Ro.x,Ro.y,Ro.z,n.x,n.y,n.z)}}class xA extends Ne{constructor(t){super(),this.type="Audio",this.listener=t,this.context=t.context,this.gain=this.context.createGain(),this.gain.connect(t.getInput()),this.autoplay=!1,this.buffer=null,this.detune=0,this.loop=!1,this.loopStart=0,this.loopEnd=0,this.offset=0,this.duration=void 0,this.playbackRate=1,this.isPlaying=!1,this.hasPlaybackControl=!0,this.source=null,this.sourceType="empty",this._startedAt=0,this._progress=0,this._connected=!1,this.filters=[]}getOutput(){return this.gain}setNodeSource(t){return this.hasPlaybackControl=!1,this.sourceType="audioNode",this.source=t,this.connect(),this}setMediaElementSource(t){return this.hasPlaybackControl=!1,this.sourceType="mediaNode",this.source=this.context.createMediaElementSource(t),this.connect(),this}setMediaStreamSource(t){return this.hasPlaybackControl=!1,this.sourceType="mediaStreamNode",this.source=this.context.createMediaStreamSource(t),this.connect(),this}setBuffer(t){return this.buffer=t,this.sourceType="buffer",this.autoplay&&this.play(),this}play(t=0){if(this.isPlaying===!0){console.warn("THREE.Audio: Audio is already playing.");return}if(this.hasPlaybackControl===!1){console.warn("THREE.Audio: this Audio has no playback control.");return}this._startedAt=this.context.currentTime+t;const e=this.context.createBufferSource();return e.buffer=this.buffer,e.loop=this.loop,e.loopStart=this.loopStart,e.loopEnd=this.loopEnd,e.onended=this.onEnded.bind(this),e.start(this._startedAt,this._progress+this.offset,this.duration),this.isPlaying=!0,this.source=e,this.setDetune(this.detune),this.setPlaybackRate(this.playbackRate),this.connect()}pause(){if(this.hasPlaybackControl===!1){console.warn("THREE.Audio: this Audio has no playback control.");return}return this.isPlaying===!0&&(this._progress+=Math.max(this.context.currentTime-this._startedAt,0)*this.playbackRate,this.loop===!0&&(this._progress=this._progress%(this.duration||this.buffer.duration)),this.source.stop(),this.source.onended=null,this.isPlaying=!1),this}stop(){if(this.hasPlaybackControl===!1){console.warn("THREE.Audio: this Audio has no playback control.");return}return this._progress=0,this.source!==null&&(this.source.stop(),this.source.onended=null),this.isPlaying=!1,this}connect(){if(this.filters.length>0){this.source.connect(this.filters[0]);for(let t=1,e=this.filters.length;t<e;t++)this.filters[t-1].connect(this.filters[t]);this.filters[this.filters.length-1].connect(this.getOutput())}else this.source.connect(this.getOutput());return this._connected=!0,this}disconnect(){if(this.filters.length>0){this.source.disconnect(this.filters[0]);for(let t=1,e=this.filters.length;t<e;t++)this.filters[t-1].disconnect(this.filters[t]);this.filters[this.filters.length-1].disconnect(this.getOutput())}else this.source.disconnect(this.getOutput());return this._connected=!1,this}getFilters(){return this.filters}setFilters(t){return t||(t=[]),this._connected===!0?(this.disconnect(),this.filters=t.slice(),this.connect()):this.filters=t.slice(),this}setDetune(t){if(this.detune=t,this.source.detune!==void 0)return this.isPlaying===!0&&this.source.detune.setTargetAtTime(this.detune,this.context.currentTime,.01),this}getDetune(){return this.detune}getFilter(){return this.getFilters()[0]}setFilter(t){return this.setFilters(t?[t]:[])}setPlaybackRate(t){if(this.hasPlaybackControl===!1){console.warn("THREE.Audio: this Audio has no playback control.");return}return this.playbackRate=t,this.isPlaying===!0&&this.source.playbackRate.setTargetAtTime(this.playbackRate,this.context.currentTime,.01),this}getPlaybackRate(){return this.playbackRate}onEnded(){this.isPlaying=!1}getLoop(){return this.hasPlaybackControl===!1?(console.warn("THREE.Audio: this Audio has no playback control."),!1):this.loop}setLoop(t){if(this.hasPlaybackControl===!1){console.warn("THREE.Audio: this Audio has no playback control.");return}return this.loop=t,this.isPlaying===!0&&(this.source.loop=this.loop),this}setLoopStart(t){return this.loopStart=t,this}setLoopEnd(t){return this.loopEnd=t,this}getVolume(){return this.gain.gain.value}setVolume(t){return this.gain.gain.setTargetAtTime(t,this.context.currentTime,.01),this}}const Lo=new N,Aw=new Pn,zB=new N,Do=new N;class kB extends xA{constructor(t){super(t),this.panner=this.context.createPanner(),this.panner.panningModel="HRTF",this.panner.connect(this.gain)}connect(){super.connect(),this.panner.connect(this.gain)}disconnect(){super.disconnect(),this.panner.disconnect(this.gain)}getOutput(){return this.panner}getRefDistance(){return this.panner.refDistance}setRefDistance(t){return this.panner.refDistance=t,this}getRolloffFactor(){return this.panner.rolloffFactor}setRolloffFactor(t){return this.panner.rolloffFactor=t,this}getDistanceModel(){return this.panner.distanceModel}setDistanceModel(t){return this.panner.distanceModel=t,this}getMaxDistance(){return this.panner.maxDistance}setMaxDistance(t){return this.panner.maxDistance=t,this}setDirectionalCone(t,e,n){return this.panner.coneInnerAngle=t,this.panner.coneOuterAngle=e,this.panner.coneOuterGain=n,this}updateMatrixWorld(t){if(super.updateMatrixWorld(t),this.hasPlaybackControl===!0&&this.isPlaying===!1)return;this.matrixWorld.decompose(Lo,Aw,zB),Do.set(0,0,1).applyQuaternion(Aw);const e=this.panner;if(e.positionX){const n=this.context.currentTime+this.listener.timeDelta;e.positionX.linearRampToValueAtTime(Lo.x,n),e.positionY.linearRampToValueAtTime(Lo.y,n),e.positionZ.linearRampToValueAtTime(Lo.z,n),e.orientationX.linearRampToValueAtTime(Do.x,n),e.orientationY.linearRampToValueAtTime(Do.y,n),e.orientationZ.linearRampToValueAtTime(Do.z,n)}else e.setPosition(Lo.x,Lo.y,Lo.z),e.setOrientation(Do.x,Do.y,Do.z)}}class UB{constructor(t,e=2048){this.analyser=t.context.createAnalyser(),this.analyser.fftSize=e,this.data=new Uint8Array(this.analyser.frequencyBinCount),t.getOutput().connect(this.analyser)}getFrequencyData(){return this.analyser.getByteFrequencyData(this.data),this.data}getAverageFrequency(){let t=0;const e=this.getFrequencyData();for(let n=0;n<e.length;n++)t+=e[n];return t/e.length}}class bA{constructor(t,e,n){this.binding=t,this.valueSize=n;let i,r,o;switch(e){case"quaternion":i=this._slerp,r=this._slerpAdditive,o=this._setAdditiveIdentityQuaternion,this.buffer=new Float64Array(n*6),this._workIndex=5;break;case"string":case"bool":i=this._select,r=this._select,o=this._setAdditiveIdentityOther,this.buffer=new Array(n*5);break;default:i=this._lerp,r=this._lerpAdditive,o=this._setAdditiveIdentityNumeric,this.buffer=new Float64Array(n*5)}this._mixBufferRegion=i,this._mixBufferRegionAdditive=r,this._setIdentity=o,this._origIndex=3,this._addIndex=4,this.cumulativeWeight=0,this.cumulativeWeightAdditive=0,this.useCount=0,this.referenceCount=0}accumulate(t,e){const n=this.buffer,i=this.valueSize,r=t*i+i;let o=this.cumulativeWeight;if(o===0){for(let a=0;a!==i;++a)n[r+a]=n[a];o=e}else{o+=e;const a=e/o;this._mixBufferRegion(n,r,0,a,i)}this.cumulativeWeight=o}accumulateAdditive(t){const e=this.buffer,n=this.valueSize,i=n*this._addIndex;this.cumulativeWeightAdditive===0&&this._setIdentity(),this._mixBufferRegionAdditive(e,i,0,t,n),this.cumulativeWeightAdditive+=t}apply(t){const e=this.valueSize,n=this.buffer,i=t*e+e,r=this.cumulativeWeight,o=this.cumulativeWeightAdditive,a=this.binding;if(this.cumulativeWeight=0,this.cumulativeWeightAdditive=0,r<1){const l=e*this._origIndex;this._mixBufferRegion(n,i,l,1-r,e)}o>0&&this._mixBufferRegionAdditive(n,i,this._addIndex*e,1,e);for(let l=e,c=e+e;l!==c;++l)if(n[l]!==n[l+e]){a.setValue(n,i);break}}saveOriginalState(){const t=this.binding,e=this.buffer,n=this.valueSize,i=n*this._origIndex;t.getValue(e,i);for(let r=n,o=i;r!==o;++r)e[r]=e[i+r%n];this._setIdentity(),this.cumulativeWeight=0,this.cumulativeWeightAdditive=0}restoreOriginalState(){const t=this.valueSize*3;this.binding.setValue(this.buffer,t)}_setAdditiveIdentityNumeric(){const t=this._addIndex*this.valueSize,e=t+this.valueSize;for(let n=t;n<e;n++)this.buffer[n]=0}_setAdditiveIdentityQuaternion(){this._setAdditiveIdentityNumeric(),this.buffer[this._addIndex*this.valueSize+3]=1}_setAdditiveIdentityOther(){const t=this._origIndex*this.valueSize,e=this._addIndex*this.valueSize;for(let n=0;n<this.valueSize;n++)this.buffer[e+n]=this.buffer[t+n]}_select(t,e,n,i,r){if(i>=.5)for(let o=0;o!==r;++o)t[e+o]=t[n+o]}_slerp(t,e,n,i){Pn.slerpFlat(t,e,t,e,t,n,i)}_slerpAdditive(t,e,n,i,r){const o=this._workIndex*r;Pn.multiplyQuaternionsFlat(t,o,t,e,t,n),Pn.slerpFlat(t,e,t,e,t,o,i)}_lerp(t,e,n,i,r){const o=1-i;for(let a=0;a!==r;++a){const l=e+a;t[l]=t[l]*o+t[n+a]*i}}_lerpAdditive(t,e,n,i,r){for(let o=0;o!==r;++o){const a=e+o;t[a]=t[a]+t[n+o]*i}}}const F_="\\[\\]\\.:\\/",NB=new RegExp("["+F_+"]","g"),B_="[^"+F_+"]",FB="[^"+F_.replace("\\.","")+"]",BB=/((?:WC+[\/:])*)/.source.replace("WC",B_),HB=/(WCOD+)?/.source.replace("WCOD",FB),VB=/(?:\.(WC+)(?:\[(.+)\])?)?/.source.replace("WC",B_),GB=/\.(WC+)(?:\[(.+)\])?/.source.replace("WC",B_),qB=new RegExp("^"+BB+HB+VB+GB+"$"),WB=["material","materials","bones","map"];class $B{constructor(t,e,n){const i=n||ke.parseTrackName(e);this._targetGroup=t,this._bindings=t.subscribe_(e,i)}getValue(t,e){this.bind();const n=this._targetGroup.nCachedObjects_,i=this._bindings[n];i!==void 0&&i.getValue(t,e)}setValue(t,e){const n=this._bindings;for(let i=this._targetGroup.nCachedObjects_,r=n.length;i!==r;++i)n[i].setValue(t,e)}bind(){const t=this._bindings;for(let e=this._targetGroup.nCachedObjects_,n=t.length;e!==n;++e)t[e].bind()}unbind(){const t=this._bindings;for(let e=this._targetGroup.nCachedObjects_,n=t.length;e!==n;++e)t[e].unbind()}}class ke{constructor(t,e,n){this.path=e,this.parsedPath=n||ke.parseTrackName(e),this.node=ke.findNode(t,this.parsedPath.nodeName),this.rootNode=t,this.getValue=this._getValue_unbound,this.setValue=this._setValue_unbound}static create(t,e,n){return t&&t.isAnimationObjectGroup?new ke.Composite(t,e,n):new ke(t,e,n)}static sanitizeNodeName(t){return t.replace(/\s/g,"_").replace(NB,"")}static parseTrackName(t){const e=qB.exec(t);if(e===null)throw new Error("PropertyBinding: Cannot parse trackName: "+t);const n={nodeName:e[2],objectName:e[3],objectIndex:e[4],propertyName:e[5],propertyIndex:e[6]},i=n.nodeName&&n.nodeName.lastIndexOf(".");if(i!==void 0&&i!==-1){const r=n.nodeName.substring(i+1);WB.indexOf(r)!==-1&&(n.nodeName=n.nodeName.substring(0,i),n.objectName=r)}if(n.propertyName===null||n.propertyName.length===0)throw new Error("PropertyBinding: can not parse propertyName from trackName: "+t);return n}static findNode(t,e){if(e===void 0||e===""||e==="."||e===-1||e===t.name||e===t.uuid)return t;if(t.skeleton){const n=t.skeleton.getBoneByName(e);if(n!==void 0)return n}if(t.children){const n=function(r){for(let o=0;o<r.length;o++){const a=r[o];if(a.name===e||a.uuid===e)return a;const l=n(a.children);if(l)return l}return null},i=n(t.children);if(i)return i}return null}_getValue_unavailable(){}_setValue_unavailable(){}_getValue_direct(t,e){t[e]=this.targetObject[this.propertyName]}_getValue_array(t,e){const n=this.resolvedProperty;for(let i=0,r=n.length;i!==r;++i)t[e++]=n[i]}_getValue_arrayElement(t,e){t[e]=this.resolvedProperty[this.propertyIndex]}_getValue_toArray(t,e){this.resolvedProperty.toArray(t,e)}_setValue_direct(t,e){this.targetObject[this.propertyName]=t[e]}_setValue_direct_setNeedsUpdate(t,e){this.targetObject[this.propertyName]=t[e],this.targetObject.needsUpdate=!0}_setValue_direct_setMatrixWorldNeedsUpdate(t,e){this.targetObject[this.propertyName]=t[e],this.targetObject.matrixWorldNeedsUpdate=!0}_setValue_array(t,e){const n=this.resolvedProperty;for(let i=0,r=n.length;i!==r;++i)n[i]=t[e++]}_setValue_array_setNeedsUpdate(t,e){const n=this.resolvedProperty;for(let i=0,r=n.length;i!==r;++i)n[i]=t[e++];this.targetObject.needsUpdate=!0}_setValue_array_setMatrixWorldNeedsUpdate(t,e){const n=this.resolvedProperty;for(let i=0,r=n.length;i!==r;++i)n[i]=t[e++];this.targetObject.matrixWorldNeedsUpdate=!0}_setValue_arrayElement(t,e){this.resolvedProperty[this.propertyIndex]=t[e]}_setValue_arrayElement_setNeedsUpdate(t,e){this.resolvedProperty[this.propertyIndex]=t[e],this.targetObject.needsUpdate=!0}_setValue_arrayElement_setMatrixWorldNeedsUpdate(t,e){this.resolvedProperty[this.propertyIndex]=t[e],this.targetObject.matrixWorldNeedsUpdate=!0}_setValue_fromArray(t,e){this.resolvedProperty.fromArray(t,e)}_setValue_fromArray_setNeedsUpdate(t,e){this.resolvedProperty.fromArray(t,e),this.targetObject.needsUpdate=!0}_setValue_fromArray_setMatrixWorldNeedsUpdate(t,e){this.resolvedProperty.fromArray(t,e),this.targetObject.matrixWorldNeedsUpdate=!0}_getValue_unbound(t,e){this.bind(),this.getValue(t,e)}_setValue_unbound(t,e){this.bind(),this.setValue(t,e)}bind(){let t=this.node;const e=this.parsedPath,n=e.objectName,i=e.propertyName;let r=e.propertyIndex;if(t||(t=ke.findNode(this.rootNode,e.nodeName),this.node=t),this.getValue=this._getValue_unavailable,this.setValue=this._setValue_unavailable,!t){console.warn("THREE.PropertyBinding: No target node found for track: "+this.path+".");return}if(n){let c=e.objectIndex;switch(n){case"materials":if(!t.material){console.error("THREE.PropertyBinding: Can not bind to material as node does not have a material.",this);return}if(!t.material.materials){console.error("THREE.PropertyBinding: Can not bind to material.materials as node.material does not have a materials array.",this);return}t=t.material.materials;break;case"bones":if(!t.skeleton){console.error("THREE.PropertyBinding: Can not bind to bones as node does not have a skeleton.",this);return}t=t.skeleton.bones;for(let h=0;h<t.length;h++)if(t[h].name===c){c=h;break}break;case"map":if("map"in t){t=t.map;break}if(!t.material){console.error("THREE.PropertyBinding: Can not bind to material as node does not have a material.",this);return}if(!t.material.map){console.error("THREE.PropertyBinding: Can not bind to material.map as node.material does not have a map.",this);return}t=t.material.map;break;default:if(t[n]===void 0){console.error("THREE.PropertyBinding: Can not bind to objectName of node undefined.",this);return}t=t[n]}if(c!==void 0){if(t[c]===void 0){console.error("THREE.PropertyBinding: Trying to bind to objectIndex of objectName, but is undefined.",this,t);return}t=t[c]}}const o=t[i];if(o===void 0){const c=e.nodeName;console.error("THREE.PropertyBinding: Trying to update property for track: "+c+"."+i+" but it wasn't found.",t);return}let a=this.Versioning.None;this.targetObject=t,t.needsUpdate!==void 0?a=this.Versioning.NeedsUpdate:t.matrixWorldNeedsUpdate!==void 0&&(a=this.Versioning.MatrixWorldNeedsUpdate);let l=this.BindingType.Direct;if(r!==void 0){if(i==="morphTargetInfluences"){if(!t.geometry){console.error("THREE.PropertyBinding: Can not bind to morphTargetInfluences because node does not have a geometry.",this);return}if(!t.geometry.morphAttributes){console.error("THREE.PropertyBinding: Can not bind to morphTargetInfluences because node does not have a geometry.morphAttributes.",this);return}t.morphTargetDictionary[r]!==void 0&&(r=t.morphTargetDictionary[r])}l=this.BindingType.ArrayElement,this.resolvedProperty=o,this.propertyIndex=r}else o.fromArray!==void 0&&o.toArray!==void 0?(l=this.BindingType.HasFromToArray,this.resolvedProperty=o):Array.isArray(o)?(l=this.BindingType.EntireArray,this.resolvedProperty=o):this.propertyName=i;this.getValue=this.GetterByBindingType[l],this.setValue=this.SetterByBindingTypeAndVersioning[l][a]}unbind(){this.node=null,this.getValue=this._getValue_unbound,this.setValue=this._setValue_unbound}}ke.Composite=$B;ke.prototype.BindingType={Direct:0,EntireArray:1,ArrayElement:2,HasFromToArray:3};ke.prototype.Versioning={None:0,NeedsUpdate:1,MatrixWorldNeedsUpdate:2};ke.prototype.GetterByBindingType=[ke.prototype._getValue_direct,ke.prototype._getValue_array,ke.prototype._getValue_arrayElement,ke.prototype._getValue_toArray];ke.prototype.SetterByBindingTypeAndVersioning=[[ke.prototype._setValue_direct,ke.prototype._setValue_direct_setNeedsUpdate,ke.prototype._setValue_direct_setMatrixWorldNeedsUpdate],[ke.prototype._setValue_array,ke.prototype._setValue_array_setNeedsUpdate,ke.prototype._setValue_array_setMatrixWorldNeedsUpdate],[ke.prototype._setValue_arrayElement,ke.prototype._setValue_arrayElement_setNeedsUpdate,ke.prototype._setValue_arrayElement_setMatrixWorldNeedsUpdate],[ke.prototype._setValue_fromArray,ke.prototype._setValue_fromArray_setNeedsUpdate,ke.prototype._setValue_fromArray_setMatrixWorldNeedsUpdate]];class XB{constructor(){this.isAnimationObjectGroup=!0,this.uuid=qi(),this._objects=Array.prototype.slice.call(arguments),this.nCachedObjects_=0;const t={};this._indicesByUUID=t;for(let n=0,i=arguments.length;n!==i;++n)t[arguments[n].uuid]=n;this._paths=[],this._parsedPaths=[],this._bindings=[],this._bindingsIndicesByPath={};const e=this;this.stats={objects:{get total(){return e._objects.length},get inUse(){return this.total-e.nCachedObjects_}},get bindingsPerObject(){return e._bindings.length}}}add(){const t=this._objects,e=this._indicesByUUID,n=this._paths,i=this._parsedPaths,r=this._bindings,o=r.length;let a,l=t.length,c=this.nCachedObjects_;for(let h=0,f=arguments.length;h!==f;++h){const d=arguments[h],m=d.uuid;let g=e[m];if(g===void 0){g=l++,e[m]=g,t.push(d);for(let y=0,_=o;y!==_;++y)r[y].push(new ke(d,n[y],i[y]))}else if(g<c){a=t[g];const y=--c,_=t[y];e[_.uuid]=g,t[g]=_,e[m]=y,t[y]=d;for(let v=0,w=o;v!==w;++v){const b=r[v],M=b[y];let A=b[g];b[g]=M,A===void 0&&(A=new ke(d,n[v],i[v])),b[y]=A}}else t[g]!==a&&console.error("THREE.AnimationObjectGroup: Different objects with the same UUID detected. Clean the caches or recreate your infrastructure when reloading scenes.")}this.nCachedObjects_=c}remove(){const t=this._objects,e=this._indicesByUUID,n=this._bindings,i=n.length;let r=this.nCachedObjects_;for(let o=0,a=arguments.length;o!==a;++o){const l=arguments[o],c=l.uuid,h=e[c];if(h!==void 0&&h>=r){const f=r++,d=t[f];e[d.uuid]=h,t[h]=d,e[c]=f,t[f]=l;for(let m=0,g=i;m!==g;++m){const y=n[m],_=y[f],v=y[h];y[h]=_,y[f]=v}}}this.nCachedObjects_=r}uncache(){const t=this._objects,e=this._indicesByUUID,n=this._bindings,i=n.length;let r=this.nCachedObjects_,o=t.length;for(let a=0,l=arguments.length;a!==l;++a){const c=arguments[a],h=c.uuid,f=e[h];if(f!==void 0)if(delete e[h],f<r){const d=--r,m=t[d],g=--o,y=t[g];e[m.uuid]=f,t[f]=m,e[y.uuid]=d,t[d]=y,t.pop();for(let _=0,v=i;_!==v;++_){const w=n[_],b=w[d],M=w[g];w[f]=b,w[d]=M,w.pop()}}else{const d=--o,m=t[d];d>0&&(e[m.uuid]=f),t[f]=m,t.pop();for(let g=0,y=i;g!==y;++g){const _=n[g];_[f]=_[d],_.pop()}}}this.nCachedObjects_=r}subscribe_(t,e){const n=this._bindingsIndicesByPath;let i=n[t];const r=this._bindings;if(i!==void 0)return r[i];const o=this._paths,a=this._parsedPaths,l=this._objects,c=l.length,h=this.nCachedObjects_,f=new Array(c);i=r.length,n[t]=i,o.push(t),a.push(e),r.push(f);for(let d=h,m=l.length;d!==m;++d){const g=l[d];f[d]=new ke(g,t,e)}return f}unsubscribe_(t){const e=this._bindingsIndicesByPath,n=e[t];if(n!==void 0){const i=this._paths,r=this._parsedPaths,o=this._bindings,a=o.length-1,l=o[a],c=t[a];e[c]=n,o[n]=l,o.pop(),r[n]=r[a],r.pop(),i[n]=i[a],i.pop()}}}class wA{constructor(t,e,n=null,i=e.blendMode){this._mixer=t,this._clip=e,this._localRoot=n,this.blendMode=i;const r=e.tracks,o=r.length,a=new Array(o),l={endingStart:Ho,endingEnd:Ho};for(let c=0;c!==o;++c){const h=r[c].createInterpolant(null);a[c]=h,h.settings=l}this._interpolantSettings=l,this._interpolants=a,this._propertyBindings=new Array(o),this._cacheIndex=null,this._byClipCacheIndex=null,this._timeScaleInterpolant=null,this._weightInterpolant=null,this.loop=eS,this._loopCount=-1,this._startTime=null,this.time=0,this.timeScale=1,this._effectiveTimeScale=1,this.weight=1,this._effectiveWeight=1,this.repetitions=1/0,this.paused=!1,this.enabled=!0,this.clampWhenFinished=!1,this.zeroSlopeAtStart=!0,this.zeroSlopeAtEnd=!0}play(){return this._mixer._activateAction(this),this}stop(){return this._mixer._deactivateAction(this),this.reset()}reset(){return this.paused=!1,this.enabled=!0,this.time=0,this._loopCount=-1,this._startTime=null,this.stopFading().stopWarping()}isRunning(){return this.enabled&&!this.paused&&this.timeScale!==0&&this._startTime===null&&this._mixer._isActiveAction(this)}isScheduled(){return this._mixer._isActiveAction(this)}startAt(t){return this._startTime=t,this}setLoop(t,e){return this.loop=t,this.repetitions=e,this}setEffectiveWeight(t){return this.weight=t,this._effectiveWeight=this.enabled?t:0,this.stopFading()}getEffectiveWeight(){return this._effectiveWeight}fadeIn(t){return this._scheduleFading(t,0,1)}fadeOut(t){return this._scheduleFading(t,1,0)}crossFadeFrom(t,e,n){if(t.fadeOut(e),this.fadeIn(e),n){const i=this._clip.duration,r=t._clip.duration,o=r/i,a=i/r;t.warp(1,o,e),this.warp(a,1,e)}return this}crossFadeTo(t,e,n){return t.crossFadeFrom(this,e,n)}stopFading(){const t=this._weightInterpolant;return t!==null&&(this._weightInterpolant=null,this._mixer._takeBackControlInterpolant(t)),this}setEffectiveTimeScale(t){return this.timeScale=t,this._effectiveTimeScale=this.paused?0:t,this.stopWarping()}getEffectiveTimeScale(){return this._effectiveTimeScale}setDuration(t){return this.timeScale=this._clip.duration/t,this.stopWarping()}syncWith(t){return this.time=t.time,this.timeScale=t.timeScale,this.stopWarping()}halt(t){return this.warp(this._effectiveTimeScale,0,t)}warp(t,e,n){const i=this._mixer,r=i.time,o=this.timeScale;let a=this._timeScaleInterpolant;a===null&&(a=i._lendControlInterpolant(),this._timeScaleInterpolant=a);const l=a.parameterPositions,c=a.sampleValues;return l[0]=r,l[1]=r+n,c[0]=t/o,c[1]=e/o,this}stopWarping(){const t=this._timeScaleInterpolant;return t!==null&&(this._timeScaleInterpolant=null,this._mixer._takeBackControlInterpolant(t)),this}getMixer(){return this._mixer}getClip(){return this._clip}getRoot(){return this._localRoot||this._mixer._root}_update(t,e,n,i){if(!this.enabled){this._updateWeight(t);return}const r=this._startTime;if(r!==null){const l=(t-r)*n;l<0||n===0?e=0:(this._startTime=null,e=n*l)}e*=this._updateTimeScale(t);const o=this._updateTime(e),a=this._updateWeight(t);if(a>0){const l=this._interpolants,c=this._propertyBindings;switch(this.blendMode){case l_:for(let h=0,f=l.length;h!==f;++h)l[h].evaluate(o),c[h].accumulateAdditive(a);break;case hd:default:for(let h=0,f=l.length;h!==f;++h)l[h].evaluate(o),c[h].accumulate(i,a)}}}_updateWeight(t){let e=0;if(this.enabled){e=this.weight;const n=this._weightInterpolant;if(n!==null){const i=n.evaluate(t)[0];e*=i,t>n.parameterPositions[1]&&(this.stopFading(),i===0&&(this.enabled=!1))}}return this._effectiveWeight=e,e}_updateTimeScale(t){let e=0;if(!this.paused){e=this.timeScale;const n=this._timeScaleInterpolant;if(n!==null){const i=n.evaluate(t)[0];e*=i,t>n.parameterPositions[1]&&(this.stopWarping(),e===0?this.paused=!0:this.timeScale=e)}}return this._effectiveTimeScale=e,e}_updateTime(t){const e=this._clip.duration,n=this.loop;let i=this.time+t,r=this._loopCount;const o=n===nS;if(t===0)return r===-1?i:o&&(r&1)===1?e-i:i;if(n===tS){r===-1&&(this._loopCount=0,this._setEndings(!0,!0,!1));t:{if(i>=e)i=e;else if(i<0)i=0;else{this.time=i;break t}this.clampWhenFinished?this.paused=!0:this.enabled=!1,this.time=i,this._mixer.dispatchEvent({type:"finished",action:this,direction:t<0?-1:1})}}else{if(r===-1&&(t>=0?(r=0,this._setEndings(!0,this.repetitions===0,o)):this._setEndings(this.repetitions===0,!0,o)),i>=e||i<0){const a=Math.floor(i/e);i-=e*a,r+=Math.abs(a);const l=this.repetitions-r;if(l<=0)this.clampWhenFinished?this.paused=!0:this.enabled=!1,i=t>0?e:0,this.time=i,this._mixer.dispatchEvent({type:"finished",action:this,direction:t>0?1:-1});else{if(l===1){const c=t<0;this._setEndings(c,!c,o)}else this._setEndings(!1,!1,o);this._loopCount=r,this.time=i,this._mixer.dispatchEvent({type:"loop",action:this,loopDelta:a})}}else this.time=i;if(o&&(r&1)===1)return e-i}return i}_setEndings(t,e,n){const i=this._interpolantSettings;n?(i.endingStart=Vo,i.endingEnd=Vo):(t?i.endingStart=this.zeroSlopeAtStart?Vo:Ho:i.endingStart=$c,e?i.endingEnd=this.zeroSlopeAtEnd?Vo:Ho:i.endingEnd=$c)}_scheduleFading(t,e,n){const i=this._mixer,r=i.time;let o=this._weightInterpolant;o===null&&(o=i._lendControlInterpolant(),this._weightInterpolant=o);const a=o.parameterPositions,l=o.sampleValues;return a[0]=r,l[0]=e,a[1]=r+t,l[1]=n,this}}const jB=new Float32Array(1);class YB extends Gi{constructor(t){super(),this._root=t,this._initMemoryManager(),this._accuIndex=0,this.time=0,this.timeScale=1}_bindAction(t,e){const n=t._localRoot||this._root,i=t._clip.tracks,r=i.length,o=t._propertyBindings,a=t._interpolants,l=n.uuid,c=this._bindingsByRootAndName;let h=c[l];h===void 0&&(h={},c[l]=h);for(let f=0;f!==r;++f){const d=i[f],m=d.name;let g=h[m];if(g!==void 0)++g.referenceCount,o[f]=g;else{if(g=o[f],g!==void 0){g._cacheIndex===null&&(++g.referenceCount,this._addInactiveBinding(g,l,m));continue}const y=e&&e._propertyBindings[f].binding.parsedPath;g=new bA(ke.create(n,m,y),d.ValueTypeName,d.getValueSize()),++g.referenceCount,this._addInactiveBinding(g,l,m),o[f]=g}a[f].resultBuffer=g.buffer}}_activateAction(t){if(!this._isActiveAction(t)){if(t._cacheIndex===null){const n=(t._localRoot||this._root).uuid,i=t._clip.uuid,r=this._actionsByClip[i];this._bindAction(t,r&&r.knownActions[0]),this._addInactiveAction(t,i,n)}const e=t._propertyBindings;for(let n=0,i=e.length;n!==i;++n){const r=e[n];r.useCount++===0&&(this._lendBinding(r),r.saveOriginalState())}this._lendAction(t)}}_deactivateAction(t){if(this._isActiveAction(t)){const e=t._propertyBindings;for(let n=0,i=e.length;n!==i;++n){const r=e[n];--r.useCount===0&&(r.restoreOriginalState(),this._takeBackBinding(r))}this._takeBackAction(t)}}_initMemoryManager(){this._actions=[],this._nActiveActions=0,this._actionsByClip={},this._bindings=[],this._nActiveBindings=0,this._bindingsByRootAndName={},this._controlInterpolants=[],this._nActiveControlInterpolants=0;const t=this;this.stats={actions:{get total(){return t._actions.length},get inUse(){return t._nActiveActions}},bindings:{get total(){return t._bindings.length},get inUse(){return t._nActiveBindings}},controlInterpolants:{get total(){return t._controlInterpolants.length},get inUse(){return t._nActiveControlInterpolants}}}}_isActiveAction(t){const e=t._cacheIndex;return e!==null&&e<this._nActiveActions}_addInactiveAction(t,e,n){const i=this._actions,r=this._actionsByClip;let o=r[e];if(o===void 0)o={knownActions:[t],actionByRoot:{}},t._byClipCacheIndex=0,r[e]=o;else{const a=o.knownActions;t._byClipCacheIndex=a.length,a.push(t)}t._cacheIndex=i.length,i.push(t),o.actionByRoot[n]=t}_removeInactiveAction(t){const e=this._actions,n=e[e.length-1],i=t._cacheIndex;n._cacheIndex=i,e[i]=n,e.pop(),t._cacheIndex=null;const r=t._clip.uuid,o=this._actionsByClip,a=o[r],l=a.knownActions,c=l[l.length-1],h=t._byClipCacheIndex;c._byClipCacheIndex=h,l[h]=c,l.pop(),t._byClipCacheIndex=null;const f=a.actionByRoot,d=(t._localRoot||this._root).uuid;delete f[d],l.length===0&&delete o[r],this._removeInactiveBindingsForAction(t)}_removeInactiveBindingsForAction(t){const e=t._propertyBindings;for(let n=0,i=e.length;n!==i;++n){const r=e[n];--r.referenceCount===0&&this._removeInactiveBinding(r)}}_lendAction(t){const e=this._actions,n=t._cacheIndex,i=this._nActiveActions++,r=e[i];t._cacheIndex=i,e[i]=t,r._cacheIndex=n,e[n]=r}_takeBackAction(t){const e=this._actions,n=t._cacheIndex,i=--this._nActiveActions,r=e[i];t._cacheIndex=i,e[i]=t,r._cacheIndex=n,e[n]=r}_addInactiveBinding(t,e,n){const i=this._bindingsByRootAndName,r=this._bindings;let o=i[e];o===void 0&&(o={},i[e]=o),o[n]=t,t._cacheIndex=r.length,r.push(t)}_removeInactiveBinding(t){const e=this._bindings,n=t.binding,i=n.rootNode.uuid,r=n.path,o=this._bindingsByRootAndName,a=o[i],l=e[e.length-1],c=t._cacheIndex;l._cacheIndex=c,e[c]=l,e.pop(),delete a[r],Object.keys(a).length===0&&delete o[i]}_lendBinding(t){const e=this._bindings,n=t._cacheIndex,i=this._nActiveBindings++,r=e[i];t._cacheIndex=i,e[i]=t,r._cacheIndex=n,e[n]=r}_takeBackBinding(t){const e=this._bindings,n=t._cacheIndex,i=--this._nActiveBindings,r=e[i];t._cacheIndex=i,e[i]=t,r._cacheIndex=n,e[n]=r}_lendControlInterpolant(){const t=this._controlInterpolants,e=this._nActiveControlInterpolants++;let n=t[e];return n===void 0&&(n=new I_(new Float32Array(2),new Float32Array(2),1,jB),n.__cacheIndex=e,t[e]=n),n}_takeBackControlInterpolant(t){const e=this._controlInterpolants,n=t.__cacheIndex,i=--this._nActiveControlInterpolants,r=e[i];t.__cacheIndex=i,e[i]=t,r.__cacheIndex=n,e[n]=r}clipAction(t,e,n){const i=e||this._root,r=i.uuid;let o=typeof t=="string"?iu.findByName(i,t):t;const a=o!==null?o.uuid:t,l=this._actionsByClip[a];let c=null;if(n===void 0&&(o!==null?n=o.blendMode:n=hd),l!==void 0){const f=l.actionByRoot[r];if(f!==void 0&&f.blendMode===n)return f;c=l.knownActions[0],o===null&&(o=c._clip)}if(o===null)return null;const h=new wA(this,o,e,n);return this._bindAction(h,c),this._addInactiveAction(h,a,r),h}existingAction(t,e){const n=e||this._root,i=n.uuid,r=typeof t=="string"?iu.findByName(n,t):t,o=r?r.uuid:t,a=this._actionsByClip[o];return a!==void 0&&a.actionByRoot[i]||null}stopAllAction(){const t=this._actions,e=this._nActiveActions;for(let n=e-1;n>=0;--n)t[n].stop();return this}update(t){t*=this.timeScale;const e=this._actions,n=this._nActiveActions,i=this.time+=t,r=Math.sign(t),o=this._accuIndex^=1;for(let c=0;c!==n;++c)e[c]._update(i,t,r,o);const a=this._bindings,l=this._nActiveBindings;for(let c=0;c!==l;++c)a[c].apply(o);return this}setTime(t){this.time=0;for(let e=0;e<this._actions.length;e++)this._actions[e].time=0;return this.update(t)}getRoot(){return this._root}uncacheClip(t){const e=this._actions,n=t.uuid,i=this._actionsByClip,r=i[n];if(r!==void 0){const o=r.knownActions;for(let a=0,l=o.length;a!==l;++a){const c=o[a];this._deactivateAction(c);const h=c._cacheIndex,f=e[e.length-1];c._cacheIndex=null,c._byClipCacheIndex=null,f._cacheIndex=h,e[h]=f,e.pop(),this._removeInactiveBindingsForAction(c)}delete i[n]}}uncacheRoot(t){const e=t.uuid,n=this._actionsByClip;for(const o in n){const a=n[o].actionByRoot,l=a[e];l!==void 0&&(this._deactivateAction(l),this._removeInactiveAction(l))}const i=this._bindingsByRootAndName,r=i[e];if(r!==void 0)for(const o in r){const a=r[o];a.restoreOriginalState(),this._removeInactiveBinding(a)}}uncacheAction(t,e){const n=this.existingAction(t,e);n!==null&&(this._deactivateAction(n),this._removeInactiveAction(n))}}class H_{constructor(t){this.value=t}clone(){return new H_(this.value.clone===void 0?this.value:this.value.clone())}}let ZB=0;class KB extends Gi{constructor(){super(),this.isUniformsGroup=!0,Object.defineProperty(this,"id",{value:ZB++}),this.name="",this.usage=jc,this.uniforms=[]}add(t){return this.uniforms.push(t),this}remove(t){const e=this.uniforms.indexOf(t);return e!==-1&&this.uniforms.splice(e,1),this}setName(t){return this.name=t,this}setUsage(t){return this.usage=t,this}dispose(){return this.dispatchEvent({type:"dispose"}),this}copy(t){this.name=t.name,this.usage=t.usage;const e=t.uniforms;this.uniforms.length=0;for(let n=0,i=e.length;n<i;n++)this.uniforms.push(e[n].clone());return this}clone(){return new this.constructor().copy(this)}}class JB extends _d{constructor(t,e,n=1){super(t,e),this.isInstancedInterleavedBuffer=!0,this.meshPerAttribute=n}copy(t){return super.copy(t),this.meshPerAttribute=t.meshPerAttribute,this}clone(t){const e=super.clone(t);return e.meshPerAttribute=this.meshPerAttribute,e}toJSON(t){const e=super.toJSON(t);return e.isInstancedInterleavedBuffer=!0,e.meshPerAttribute=this.meshPerAttribute,e}}class QB{constructor(t,e,n,i,r){this.isGLBufferAttribute=!0,this.name="",this.buffer=t,this.type=e,this.itemSize=n,this.elementSize=i,this.count=r,this.version=0}set needsUpdate(t){t===!0&&this.version++}setBuffer(t){return this.buffer=t,this}setType(t,e){return this.type=t,this.elementSize=e,this}setItemSize(t){return this.itemSize=t,this}setCount(t){return this.count=t,this}}class tH{constructor(t,e,n=0,i=1/0){this.ray=new la(t,e),this.near=n,this.far=i,this.camera=null,this.layers=new dd,this.params={Mesh:{},Line:{threshold:1},LOD:{},Points:{threshold:1},Sprite:{}}}set(t,e){this.ray.set(t,e)}setFromCamera(t,e){e.isPerspectiveCamera?(this.ray.origin.setFromMatrixPosition(e.matrixWorld),this.ray.direction.set(t.x,t.y,.5).unproject(e).sub(this.ray.origin).normalize(),this.camera=e):e.isOrthographicCamera?(this.ray.origin.set(t.x,t.y,(e.near+e.far)/(e.near-e.far)).unproject(e),this.ray.direction.set(0,0,-1).transformDirection(e.matrixWorld),this.camera=e):console.error("THREE.Raycaster: Unsupported camera type: "+e.type)}intersectObject(t,e=!0,n=[]){return hv(t,this,n,e),n.sort(Ew),n}intersectObjects(t,e=!0,n=[]){for(let i=0,r=t.length;i<r;i++)hv(t[i],this,n,e);return n.sort(Ew),n}}function Ew(s,t){return s.distance-t.distance}function hv(s,t,e,n){if(s.layers.test(t.layers)&&s.raycast(t,e),n===!0){const i=s.children;for(let r=0,o=i.length;r<o;r++)hv(i[r],t,e,!0)}}let fv=class{constructor(t=1,e=0,n=0){return this.radius=t,this.phi=e,this.theta=n,this}set(t,e,n){return this.radius=t,this.phi=e,this.theta=n,this}copy(t){return this.radius=t.radius,this.phi=t.phi,this.theta=t.theta,this}makeSafe(){return this.phi=Math.max(1e-6,Math.min(Math.PI-1e-6,this.phi)),this}setFromVector3(t){return this.setFromCartesianCoords(t.x,t.y,t.z)}setFromCartesianCoords(t,e,n){return this.radius=Math.sqrt(t*t+e*e+n*n),this.radius===0?(this.theta=0,this.phi=0):(this.theta=Math.atan2(t,n),this.phi=Math.acos(yn(e/this.radius,-1,1))),this}clone(){return new this.constructor().copy(this)}};class eH{constructor(t=1,e=0,n=0){return this.radius=t,this.theta=e,this.y=n,this}set(t,e,n){return this.radius=t,this.theta=e,this.y=n,this}copy(t){return this.radius=t.radius,this.theta=t.theta,this.y=t.y,this}setFromVector3(t){return this.setFromCartesianCoords(t.x,t.y,t.z)}setFromCartesianCoords(t,e,n){return this.radius=Math.sqrt(t*t+n*n),this.theta=Math.atan2(t,n),this.y=e,this}clone(){return new this.constructor().copy(this)}}const Tw=new pt;class nH{constructor(t=new pt(1/0,1/0),e=new pt(-1/0,-1/0)){this.isBox2=!0,this.min=t,this.max=e}set(t,e){return this.min.copy(t),this.max.copy(e),this}setFromPoints(t){this.makeEmpty();for(let e=0,n=t.length;e<n;e++)this.expandByPoint(t[e]);return this}setFromCenterAndSize(t,e){const n=Tw.copy(e).multiplyScalar(.5);return this.min.copy(t).sub(n),this.max.copy(t).add(n),this}clone(){return new this.constructor().copy(this)}copy(t){return this.min.copy(t.min),this.max.copy(t.max),this}makeEmpty(){return this.min.x=this.min.y=1/0,this.max.x=this.max.y=-1/0,this}isEmpty(){return this.max.x<this.min.x||this.max.y<this.min.y}getCenter(t){return this.isEmpty()?t.set(0,0):t.addVectors(this.min,this.max).multiplyScalar(.5)}getSize(t){return this.isEmpty()?t.set(0,0):t.subVectors(this.max,this.min)}expandByPoint(t){return this.min.min(t),this.max.max(t),this}expandByVector(t){return this.min.sub(t),this.max.add(t),this}expandByScalar(t){return this.min.addScalar(-t),this.max.addScalar(t),this}containsPoint(t){return!(t.x<this.min.x||t.x>this.max.x||t.y<this.min.y||t.y>this.max.y)}containsBox(t){return this.min.x<=t.min.x&&t.max.x<=this.max.x&&this.min.y<=t.min.y&&t.max.y<=this.max.y}getParameter(t,e){return e.set((t.x-this.min.x)/(this.max.x-this.min.x),(t.y-this.min.y)/(this.max.y-this.min.y))}intersectsBox(t){return!(t.max.x<this.min.x||t.min.x>this.max.x||t.max.y<this.min.y||t.min.y>this.max.y)}clampPoint(t,e){return e.copy(t).clamp(this.min,this.max)}distanceToPoint(t){return this.clampPoint(t,Tw).distanceTo(t)}intersect(t){return this.min.max(t.min),this.max.min(t.max),this.isEmpty()&&this.makeEmpty(),this}union(t){return this.min.min(t.min),this.max.max(t.max),this}translate(t){return this.min.add(t),this.max.add(t),this}equals(t){return t.min.equals(this.min)&&t.max.equals(this.max)}}const Cw=new N,of=new N;class iH{constructor(t=new N,e=new N){this.start=t,this.end=e}set(t,e){return this.start.copy(t),this.end.copy(e),this}copy(t){return this.start.copy(t.start),this.end.copy(t.end),this}getCenter(t){return t.addVectors(this.start,this.end).multiplyScalar(.5)}delta(t){return t.subVectors(this.end,this.start)}distanceSq(){return this.start.distanceToSquared(this.end)}distance(){return this.start.distanceTo(this.end)}at(t,e){return this.delta(e).multiplyScalar(t).add(this.start)}closestPointToPointParameter(t,e){Cw.subVectors(t,this.start),of.subVectors(this.end,this.start);const n=of.dot(of);let r=of.dot(Cw)/n;return e&&(r=yn(r,0,1)),r}closestPointToPoint(t,e,n){const i=this.closestPointToPointParameter(t,e);return this.delta(n).multiplyScalar(i).add(this.start)}applyMatrix4(t){return this.start.applyMatrix4(t),this.end.applyMatrix4(t),this}equals(t){return t.start.equals(this.start)&&t.end.equals(this.end)}clone(){return new this.constructor().copy(this)}}const Pw=new N;class sH extends Ne{constructor(t,e){super(),this.light=t,this.matrix=t.matrixWorld,this.matrixAutoUpdate=!1,this.color=e,this.type="SpotLightHelper";const n=new we,i=[0,0,0,0,0,1,0,0,0,1,0,1,0,0,0,-1,0,1,0,0,0,0,1,1,0,0,0,0,-1,1];for(let o=0,a=1,l=32;o<l;o++,a++){const c=o/l*Math.PI*2,h=a/l*Math.PI*2;i.push(Math.cos(c),Math.sin(c),1,Math.cos(h),Math.sin(h),1)}n.setAttribute("position",new jt(i,3));const r=new li({fog:!1,toneMapped:!1});this.cone=new Ys(n,r),this.add(this.cone),this.update()}dispose(){this.cone.geometry.dispose(),this.cone.material.dispose()}update(){this.light.updateWorldMatrix(!0,!1),this.light.target.updateWorldMatrix(!0,!1);const t=this.light.distance?this.light.distance:1e3,e=t*Math.tan(this.light.angle);this.cone.scale.set(e,e,t),Pw.setFromMatrixPosition(this.light.target.matrixWorld),this.cone.lookAt(Pw),this.color!==void 0?this.cone.material.color.set(this.color):this.cone.material.color.copy(this.light.color)}}const qr=new N,af=new de,og=new de;class rH extends Ys{constructor(t){const e=MA(t),n=new we,i=[],r=[],o=new Vt(0,0,1),a=new Vt(0,1,0);for(let c=0;c<e.length;c++){const h=e[c];h.parent&&h.parent.isBone&&(i.push(0,0,0),i.push(0,0,0),r.push(o.r,o.g,o.b),r.push(a.r,a.g,a.b))}n.setAttribute("position",new jt(i,3)),n.setAttribute("color",new jt(r,3));const l=new li({vertexColors:!0,depthTest:!1,depthWrite:!1,toneMapped:!1,transparent:!0});super(n,l),this.isSkeletonHelper=!0,this.type="SkeletonHelper",this.root=t,this.bones=e,this.matrix=t.matrixWorld,this.matrixAutoUpdate=!1}updateMatrixWorld(t){const e=this.bones,n=this.geometry,i=n.getAttribute("position");og.copy(this.root.matrixWorld).invert();for(let r=0,o=0;r<e.length;r++){const a=e[r];a.parent&&a.parent.isBone&&(af.multiplyMatrices(og,a.matrixWorld),qr.setFromMatrixPosition(af),i.setXYZ(o,qr.x,qr.y,qr.z),af.multiplyMatrices(og,a.parent.matrixWorld),qr.setFromMatrixPosition(af),i.setXYZ(o+1,qr.x,qr.y,qr.z),o+=2)}n.getAttribute("position").needsUpdate=!0,super.updateMatrixWorld(t)}dispose(){this.geometry.dispose(),this.material.dispose()}}function MA(s){const t=[];s.isBone===!0&&t.push(s);for(let e=0;e<s.children.length;e++)t.push.apply(t,MA(s.children[e]));return t}class oH extends Xe{constructor(t,e,n){const i=new Su(e,4,2),r=new Tr({wireframe:!0,fog:!1,toneMapped:!1});super(i,r),this.light=t,this.color=n,this.type="PointLightHelper",this.matrix=this.light.matrixWorld,this.matrixAutoUpdate=!1,this.update()}dispose(){this.geometry.dispose(),this.material.dispose()}update(){this.light.updateWorldMatrix(!0,!1),this.color!==void 0?this.material.color.set(this.color):this.material.color.copy(this.light.color)}}const aH=new N,Rw=new Vt,Lw=new Vt;class lH extends Ne{constructor(t,e,n){super(),this.light=t,this.matrix=t.matrixWorld,this.matrixAutoUpdate=!1,this.color=n,this.type="HemisphereLightHelper";const i=new Mu(e);i.rotateY(Math.PI*.5),this.material=new Tr({wireframe:!0,fog:!1,toneMapped:!1}),this.color===void 0&&(this.material.vertexColors=!0);const r=i.getAttribute("position"),o=new Float32Array(r.count*3);i.setAttribute("color",new ue(o,3)),this.add(new Xe(i,this.material)),this.update()}dispose(){this.children[0].geometry.dispose(),this.children[0].material.dispose()}update(){const t=this.children[0];if(this.color!==void 0)this.material.color.set(this.color);else{const e=t.geometry.getAttribute("color");Rw.copy(this.light.color),Lw.copy(this.light.groundColor);for(let n=0,i=e.count;n<i;n++){const r=n<i/2?Rw:Lw;e.setXYZ(n,r.r,r.g,r.b)}e.needsUpdate=!0}this.light.updateWorldMatrix(!0,!1),t.lookAt(aH.setFromMatrixPosition(this.light.matrixWorld).negate())}}class cH extends Ys{constructor(t=10,e=10,n=4473924,i=8947848){n=new Vt(n),i=new Vt(i);const r=e/2,o=t/e,a=t/2,l=[],c=[];for(let d=0,m=0,g=-a;d<=e;d++,g+=o){l.push(-a,0,g,a,0,g),l.push(g,0,-a,g,0,a);const y=d===r?n:i;y.toArray(c,m),m+=3,y.toArray(c,m),m+=3,y.toArray(c,m),m+=3,y.toArray(c,m),m+=3}const h=new we;h.setAttribute("position",new jt(l,3)),h.setAttribute("color",new jt(c,3));const f=new li({vertexColors:!0,toneMapped:!1});super(h,f),this.type="GridHelper"}dispose(){this.geometry.dispose(),this.material.dispose()}}class uH extends Ys{constructor(t=10,e=16,n=8,i=64,r=4473924,o=8947848){r=new Vt(r),o=new Vt(o);const a=[],l=[];if(e>1)for(let f=0;f<e;f++){const d=f/e*(Math.PI*2),m=Math.sin(d)*t,g=Math.cos(d)*t;a.push(0,0,0),a.push(m,0,g);const y=f&1?r:o;l.push(y.r,y.g,y.b),l.push(y.r,y.g,y.b)}for(let f=0;f<n;f++){const d=f&1?r:o,m=t-t/n*f;for(let g=0;g<i;g++){let y=g/i*(Math.PI*2),_=Math.sin(y)*m,v=Math.cos(y)*m;a.push(_,0,v),l.push(d.r,d.g,d.b),y=(g+1)/i*(Math.PI*2),_=Math.sin(y)*m,v=Math.cos(y)*m,a.push(_,0,v),l.push(d.r,d.g,d.b)}}const c=new we;c.setAttribute("position",new jt(a,3)),c.setAttribute("color",new jt(l,3));const h=new li({vertexColors:!0,toneMapped:!1});super(c,h),this.type="PolarGridHelper"}dispose(){this.geometry.dispose(),this.material.dispose()}}const Dw=new N,lf=new N,Iw=new N;class hH extends Ne{constructor(t,e,n){super(),this.light=t,this.matrix=t.matrixWorld,this.matrixAutoUpdate=!1,this.color=n,this.type="DirectionalLightHelper",e===void 0&&(e=1);let i=new we;i.setAttribute("position",new jt([-e,e,0,e,e,0,e,-e,0,-e,-e,0,-e,e,0],3));const r=new li({fog:!1,toneMapped:!1});this.lightPlane=new ro(i,r),this.add(this.lightPlane),i=new we,i.setAttribute("position",new jt([0,0,0,0,0,1],3)),this.targetLine=new ro(i,r),this.add(this.targetLine),this.update()}dispose(){this.lightPlane.geometry.dispose(),this.lightPlane.material.dispose(),this.targetLine.geometry.dispose(),this.targetLine.material.dispose()}update(){this.light.updateWorldMatrix(!0,!1),this.light.target.updateWorldMatrix(!0,!1),Dw.setFromMatrixPosition(this.light.matrixWorld),lf.setFromMatrixPosition(this.light.target.matrixWorld),Iw.subVectors(lf,Dw),this.lightPlane.lookAt(lf),this.color!==void 0?(this.lightPlane.material.color.set(this.color),this.targetLine.material.color.set(this.color)):(this.lightPlane.material.color.copy(this.light.color),this.targetLine.material.color.copy(this.light.color)),this.targetLine.lookAt(lf),this.targetLine.scale.z=Iw.length()}}const cf=new N,vn=new Dl;class fH extends Ys{constructor(t){const e=new we,n=new li({color:16777215,vertexColors:!0,toneMapped:!1}),i=[],r=[],o={};a("n1","n2"),a("n2","n4"),a("n4","n3"),a("n3","n1"),a("f1","f2"),a("f2","f4"),a("f4","f3"),a("f3","f1"),a("n1","f1"),a("n2","f2"),a("n3","f3"),a("n4","f4"),a("p","n1"),a("p","n2"),a("p","n3"),a("p","n4"),a("u1","u2"),a("u2","u3"),a("u3","u1"),a("c","t"),a("p","c"),a("cn1","cn2"),a("cn3","cn4"),a("cf1","cf2"),a("cf3","cf4");function a(g,y){l(g),l(y)}function l(g){i.push(0,0,0),r.push(0,0,0),o[g]===void 0&&(o[g]=[]),o[g].push(i.length/3-1)}e.setAttribute("position",new jt(i,3)),e.setAttribute("color",new jt(r,3)),super(e,n),this.type="CameraHelper",this.camera=t,this.camera.updateProjectionMatrix&&this.camera.updateProjectionMatrix(),this.matrix=t.matrixWorld,this.matrixAutoUpdate=!1,this.pointMap=o,this.update();const c=new Vt(16755200),h=new Vt(16711680),f=new Vt(43775),d=new Vt(16777215),m=new Vt(3355443);this.setColors(c,h,f,d,m)}setColors(t,e,n,i,r){const a=this.geometry.getAttribute("color");a.setXYZ(0,t.r,t.g,t.b),a.setXYZ(1,t.r,t.g,t.b),a.setXYZ(2,t.r,t.g,t.b),a.setXYZ(3,t.r,t.g,t.b),a.setXYZ(4,t.r,t.g,t.b),a.setXYZ(5,t.r,t.g,t.b),a.setXYZ(6,t.r,t.g,t.b),a.setXYZ(7,t.r,t.g,t.b),a.setXYZ(8,t.r,t.g,t.b),a.setXYZ(9,t.r,t.g,t.b),a.setXYZ(10,t.r,t.g,t.b),a.setXYZ(11,t.r,t.g,t.b),a.setXYZ(12,t.r,t.g,t.b),a.setXYZ(13,t.r,t.g,t.b),a.setXYZ(14,t.r,t.g,t.b),a.setXYZ(15,t.r,t.g,t.b),a.setXYZ(16,t.r,t.g,t.b),a.setXYZ(17,t.r,t.g,t.b),a.setXYZ(18,t.r,t.g,t.b),a.setXYZ(19,t.r,t.g,t.b),a.setXYZ(20,t.r,t.g,t.b),a.setXYZ(21,t.r,t.g,t.b),a.setXYZ(22,t.r,t.g,t.b),a.setXYZ(23,t.r,t.g,t.b),a.setXYZ(24,e.r,e.g,e.b),a.setXYZ(25,e.r,e.g,e.b),a.setXYZ(26,e.r,e.g,e.b),a.setXYZ(27,e.r,e.g,e.b),a.setXYZ(28,e.r,e.g,e.b),a.setXYZ(29,e.r,e.g,e.b),a.setXYZ(30,e.r,e.g,e.b),a.setXYZ(31,e.r,e.g,e.b),a.setXYZ(32,n.r,n.g,n.b),a.setXYZ(33,n.r,n.g,n.b),a.setXYZ(34,n.r,n.g,n.b),a.setXYZ(35,n.r,n.g,n.b),a.setXYZ(36,n.r,n.g,n.b),a.setXYZ(37,n.r,n.g,n.b),a.setXYZ(38,i.r,i.g,i.b),a.setXYZ(39,i.r,i.g,i.b),a.setXYZ(40,r.r,r.g,r.b),a.setXYZ(41,r.r,r.g,r.b),a.setXYZ(42,r.r,r.g,r.b),a.setXYZ(43,r.r,r.g,r.b),a.setXYZ(44,r.r,r.g,r.b),a.setXYZ(45,r.r,r.g,r.b),a.setXYZ(46,r.r,r.g,r.b),a.setXYZ(47,r.r,r.g,r.b),a.setXYZ(48,r.r,r.g,r.b),a.setXYZ(49,r.r,r.g,r.b),a.needsUpdate=!0}update(){const t=this.geometry,e=this.pointMap,n=1,i=1;vn.projectionMatrixInverse.copy(this.camera.projectionMatrixInverse),Sn("c",e,t,vn,0,0,-1),Sn("t",e,t,vn,0,0,1),Sn("n1",e,t,vn,-n,-i,-1),Sn("n2",e,t,vn,n,-i,-1),Sn("n3",e,t,vn,-n,i,-1),Sn("n4",e,t,vn,n,i,-1),Sn("f1",e,t,vn,-n,-i,1),Sn("f2",e,t,vn,n,-i,1),Sn("f3",e,t,vn,-n,i,1),Sn("f4",e,t,vn,n,i,1),Sn("u1",e,t,vn,n*.7,i*1.1,-1),Sn("u2",e,t,vn,-n*.7,i*1.1,-1),Sn("u3",e,t,vn,0,i*2,-1),Sn("cf1",e,t,vn,-n,0,1),Sn("cf2",e,t,vn,n,0,1),Sn("cf3",e,t,vn,0,-i,1),Sn("cf4",e,t,vn,0,i,1),Sn("cn1",e,t,vn,-n,0,-1),Sn("cn2",e,t,vn,n,0,-1),Sn("cn3",e,t,vn,0,-i,-1),Sn("cn4",e,t,vn,0,i,-1),t.getAttribute("position").needsUpdate=!0}dispose(){this.geometry.dispose(),this.material.dispose()}}function Sn(s,t,e,n,i,r,o){cf.set(i,r,o).unproject(n);const a=t[s];if(a!==void 0){const l=e.getAttribute("position");for(let c=0,h=a.length;c<h;c++)l.setXYZ(a[c],cf.x,cf.y,cf.z)}}const uf=new js;class dH extends Ys{constructor(t,e=16776960){const n=new Uint16Array([0,1,1,2,2,3,3,0,4,5,5,6,6,7,7,4,0,4,1,5,2,6,3,7]),i=new Float32Array(8*3),r=new we;r.setIndex(new ue(n,1)),r.setAttribute("position",new ue(i,3)),super(r,new li({color:e,toneMapped:!1})),this.object=t,this.type="BoxHelper",this.matrixAutoUpdate=!1,this.update()}update(t){if(t!==void 0&&console.warn("THREE.BoxHelper: .update() has no longer arguments."),this.object!==void 0&&uf.setFromObject(this.object),uf.isEmpty())return;const e=uf.min,n=uf.max,i=this.geometry.attributes.position,r=i.array;r[0]=n.x,r[1]=n.y,r[2]=n.z,r[3]=e.x,r[4]=n.y,r[5]=n.z,r[6]=e.x,r[7]=e.y,r[8]=n.z,r[9]=n.x,r[10]=e.y,r[11]=n.z,r[12]=n.x,r[13]=n.y,r[14]=e.z,r[15]=e.x,r[16]=n.y,r[17]=e.z,r[18]=e.x,r[19]=e.y,r[20]=e.z,r[21]=n.x,r[22]=e.y,r[23]=e.z,i.needsUpdate=!0,this.geometry.computeBoundingSphere()}setFromObject(t){return this.object=t,this.update(),this}copy(t,e){return super.copy(t,e),this.object=t.object,this}dispose(){this.geometry.dispose(),this.material.dispose()}}class pH extends Ys{constructor(t,e=16776960){const n=new Uint16Array([0,1,1,2,2,3,3,0,4,5,5,6,6,7,7,4,0,4,1,5,2,6,3,7]),i=[1,1,1,-1,1,1,-1,-1,1,1,-1,1,1,1,-1,-1,1,-1,-1,-1,-1,1,-1,-1],r=new we;r.setIndex(new ue(n,1)),r.setAttribute("position",new jt(i,3)),super(r,new li({color:e,toneMapped:!1})),this.box=t,this.type="Box3Helper",this.geometry.computeBoundingSphere()}updateMatrixWorld(t){const e=this.box;e.isEmpty()||(e.getCenter(this.position),e.getSize(this.scale),this.scale.multiplyScalar(.5),super.updateMatrixWorld(t))}dispose(){this.geometry.dispose(),this.material.dispose()}}class mH extends ro{constructor(t,e=1,n=16776960){const i=n,r=[1,-1,0,-1,1,0,-1,-1,0,1,1,0,-1,1,0,-1,-1,0,1,-1,0,1,1,0],o=new we;o.setAttribute("position",new jt(r,3)),o.computeBoundingSphere(),super(o,new li({color:i,toneMapped:!1})),this.type="PlaneHelper",this.plane=t,this.size=e;const a=[1,1,0,-1,1,0,-1,-1,0,1,1,0,-1,-1,0,1,-1,0],l=new we;l.setAttribute("position",new jt(a,3)),l.computeBoundingSphere(),this.add(new Xe(l,new Tr({color:i,opacity:.2,transparent:!0,depthWrite:!1,toneMapped:!1})))}updateMatrixWorld(t){this.position.set(0,0,0),this.scale.set(.5*this.size,.5*this.size,1),this.lookAt(this.plane.normal),this.translateZ(-this.plane.constant),super.updateMatrixWorld(t)}dispose(){this.geometry.dispose(),this.material.dispose(),this.children[0].geometry.dispose(),this.children[0].material.dispose()}}const Ow=new N;let hf,ag;class gH extends Ne{constructor(t=new N(0,0,1),e=new N(0,0,0),n=1,i=16776960,r=n*.2,o=r*.2){super(),this.type="ArrowHelper",hf===void 0&&(hf=new we,hf.setAttribute("position",new jt([0,0,0,0,1,0],3)),ag=new kl(0,.5,1,5,1),ag.translate(0,-.5,0)),this.position.copy(e),this.line=new ro(hf,new li({color:i,toneMapped:!1})),this.line.matrixAutoUpdate=!1,this.add(this.line),this.cone=new Xe(ag,new Tr({color:i,toneMapped:!1})),this.cone.matrixAutoUpdate=!1,this.add(this.cone),this.setDirection(t),this.setLength(n,r,o)}setDirection(t){if(t.y>.99999)this.quaternion.set(0,0,0,1);else if(t.y<-.99999)this.quaternion.set(1,0,0,0);else{Ow.set(t.z,0,-t.x).normalize();const e=Math.acos(t.y);this.quaternion.setFromAxisAngle(Ow,e)}}setLength(t,e=t*.2,n=e*.2){this.line.scale.set(1,Math.max(1e-4,t-e),1),this.line.updateMatrix(),this.cone.scale.set(n,e,n),this.cone.position.y=t,this.cone.updateMatrix()}setColor(t){this.line.material.color.set(t),this.cone.material.color.set(t)}copy(t){return super.copy(t,!1),this.line.copy(t.line),this.cone.copy(t.cone),this}dispose(){this.line.geometry.dispose(),this.line.material.dispose(),this.cone.geometry.dispose(),this.cone.material.dispose()}}class vH extends Ys{constructor(t=1){const e=[0,0,0,t,0,0,0,0,0,0,t,0,0,0,0,0,0,t],n=[1,0,0,1,.6,0,0,1,0,.6,1,0,0,0,1,0,.6,1],i=new we;i.setAttribute("position",new jt(e,3)),i.setAttribute("color",new jt(n,3));const r=new li({vertexColors:!0,toneMapped:!1});super(i,r),this.type="AxesHelper"}setColors(t,e,n){const i=new Vt,r=this.geometry.attributes.color.array;return i.set(t),i.toArray(r,0),i.toArray(r,3),i.set(e),i.toArray(r,6),i.toArray(r,9),i.set(n),i.toArray(r,12),i.toArray(r,15),this.geometry.attributes.color.needsUpdate=!0,this}dispose(){this.geometry.dispose(),this.material.dispose()}}class _H{constructor(){this.type="ShapePath",this.color=new Vt,this.subPaths=[],this.currentPath=null}moveTo(t,e){return this.currentPath=new Kc,this.subPaths.push(this.currentPath),this.currentPath.moveTo(t,e),this}lineTo(t,e){return this.currentPath.lineTo(t,e),this}quadraticCurveTo(t,e,n,i){return this.currentPath.quadraticCurveTo(t,e,n,i),this}bezierCurveTo(t,e,n,i,r,o){return this.currentPath.bezierCurveTo(t,e,n,i,r,o),this}splineThru(t){return this.currentPath.splineThru(t),this}toShapes(t){function e(v){const w=[];for(let b=0,M=v.length;b<M;b++){const A=v[b],T=new Xo;T.curves=A.curves,w.push(T)}return w}function n(v,w){const b=w.length;let M=!1;for(let A=b-1,T=0;T<b;A=T++){let P=w[A],C=w[T],S=C.x-P.x,L=C.y-P.y;if(Math.abs(L)>Number.EPSILON){if(L<0&&(P=w[T],S=-S,C=w[A],L=-L),v.y<P.y||v.y>C.y)continue;if(v.y===P.y){if(v.x===P.x)return!0}else{const H=L*(v.x-P.x)-S*(v.y-P.y);if(H===0)return!0;if(H<0)continue;M=!M}}else{if(v.y!==P.y)continue;if(C.x<=v.x&&v.x<=P.x||P.x<=v.x&&v.x<=C.x)return!0}}return M}const i=Hs.isClockWise,r=this.subPaths;if(r.length===0)return[];let o,a,l;const c=[];if(r.length===1)return a=r[0],l=new Xo,l.curves=a.curves,c.push(l),c;let h=!i(r[0].getPoints());h=t?!h:h;const f=[],d=[];let m=[],g=0,y;d[g]=void 0,m[g]=[];for(let v=0,w=r.length;v<w;v++)a=r[v],y=a.getPoints(),o=i(y),o=t?!o:o,o?(!h&&d[g]&&g++,d[g]={s:new Xo,p:y},d[g].s.curves=a.curves,h&&g++,m[g]=[]):m[g].push({h:a,p:y[0]});if(!d[0])return e(r);if(d.length>1){let v=!1,w=0;for(let b=0,M=d.length;b<M;b++)f[b]=[];for(let b=0,M=d.length;b<M;b++){const A=m[b];for(let T=0;T<A.length;T++){const P=A[T];let C=!0;for(let S=0;S<d.length;S++)n(P.p,d[S].p)&&(b!==S&&w++,C?(C=!1,f[S].push(P)):v=!0);C&&f[b].push(P)}}w>0&&v===!1&&(m=f)}let _;for(let v=0,w=d.length;v<w;v++){l=d[v].s,c.push(l),_=m[v];for(let b=0,M=_.length;b<M;b++)l.holes.push(_[b].h)}return c}}typeof __THREE_DEVTOOLS__<"u"&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("register",{detail:{revision:id}}));typeof window<"u"&&(window.__THREE__?console.warn("WARNING: Multiple instances of Three.js being imported."):window.__THREE__=id);const yH=Object.freeze(Object.defineProperty({__proto__:null,ACESFilmicToneMapping:Jv,AddEquation:$r,AddOperation:WM,AdditiveAnimationBlendMode:l_,AdditiveBlending:Tg,AlphaFormat:s_,AlwaysCompare:pS,AlwaysDepth:NM,AlwaysStencilFunc:oS,AmbientLight:mA,AmbientLightProbe:LB,AnimationAction:wA,AnimationClip:iu,AnimationLoader:_B,AnimationMixer:YB,AnimationObjectGroup:XB,AnimationUtils:pB,ArcCurve:VS,ArrayCamera:IS,ArrowHelper:gH,Audio:xA,AudioAnalyser:UB,AudioContext:U_,AudioListener:OB,AudioLoader:PB,AxesHelper:vH,BackSide:oi,BasicDepthPacking:iS,BasicShadowMap:zz,Bone:b_,BooleanKeyframeTrack:ha,Box2:nH,Box3:js,Box3Helper:pH,BoxGeometry:ua,BoxHelper:dH,BufferAttribute:ue,BufferGeometry:we,BufferGeometryLoader:yA,ByteType:_u,Cache:Qo,Camera:Dl,CameraHelper:fH,CanvasTexture:N4,CapsuleGeometry:Md,CatmullRomCurve3:GS,CineonToneMapping:jM,CircleGeometry:Sd,ClampToEdgeWrapping:In,Clock:N_,Color:Vt,ColorKeyframeTrack:O_,ColorManagement:Ui,CompressedArrayTexture:k4,CompressedCubeTexture:U4,CompressedTexture:xd,CompressedTextureLoader:yB,ConeGeometry:Ad,CubeCamera:AS,CubeReflectionMapping:Sr,CubeRefractionMapping:io,CubeTexture:xu,CubeTextureLoader:xB,CubeUVReflectionMapping:Rl,CubicBezierCurve:S_,CubicBezierCurve3:qS,CubicInterpolant:aA,CullFaceBack:Eg,CullFaceFront:zM,CullFaceFrontBack:Oz,CullFaceNone:OM,Curve:Cs,CurvePath:$S,CustomBlending:kM,CustomToneMapping:YM,CylinderGeometry:kl,Cylindrical:eH,Data3DTexture:f_,DataArrayTexture:fd,DataTexture:ml,DataTextureLoader:bB,DataUtils:Gk,DecrementStencilOp:Gz,DecrementWrapStencilOp:Wz,DefaultLoadingManager:uA,DepthFormat:Kr,DepthStencilFormat:Zo,DepthTexture:OS,DirectionalLight:pA,DirectionalLightHelper:hH,DiscreteInterpolant:lA,DisplayP3ColorSpace:c_,DodecahedronGeometry:Ed,DoubleSide:An,DstAlphaFactor:Xv,DstColorFactor:Yv,DynamicCopyUsage:ok,DynamicDrawUsage:tk,DynamicReadUsage:ik,EdgesGeometry:XS,EllipseCurve:bd,EqualCompare:cS,EqualDepth:BM,EqualStencilFunc:Yz,EquirectangularReflectionMapping:Vc,EquirectangularRefractionMapping:Gc,Euler:ca,EventDispatcher:Gi,ExtrudeGeometry:Cd,FileLoader:Ar,Float16BufferAttribute:Yk,Float32BufferAttribute:jt,Float64BufferAttribute:Zk,FloatType:Cn,Fog:vd,FogExp2:gd,FramebufferTexture:z4,FrontSide:Mr,Frustum:pd,GLBufferAttribute:QB,GLSL1:lk,GLSL3:ev,GreaterCompare:hS,GreaterDepth:VM,GreaterEqualCompare:dS,GreaterEqualDepth:HM,GreaterEqualStencilFunc:Qz,GreaterStencilFunc:Kz,GridHelper:cH,Group:al,HalfFloatType:yl,HemisphereLight:hA,HemisphereLightHelper:lH,HemisphereLightProbe:RB,IcosahedronGeometry:Pd,ImageBitmapLoader:CB,ImageLoader:su,ImageUtils:h_,IncrementStencilOp:Vz,IncrementWrapStencilOp:qz,InstancedBufferAttribute:wl,InstancedBufferGeometry:_A,InstancedInterleavedBuffer:JB,InstancedMesh:FS,Int16BufferAttribute:Xk,Int32BufferAttribute:jk,Int8BufferAttribute:qk,IntType:Ll,InterleavedBuffer:_d,InterleavedBufferAttribute:Ko,Interpolant:Au,InterpolateDiscrete:qc,InterpolateLinear:Wc,InterpolateSmooth:Tf,InvertStencilOp:$z,KeepStencilOp:Cf,KeyframeTrack:Ps,LOD:US,LatheGeometry:wu,Layers:dd,LessCompare:lS,LessDepth:FM,LessEqualCompare:uS,LessEqualDepth:Nf,LessEqualStencilFunc:Zz,LessStencilFunc:jz,Light:uo,LightProbe:kd,Line:ro,Line3:iH,LineBasicMaterial:li,LineCurve:wd,LineCurve3:WS,LineDashedMaterial:rA,LineLoop:BS,LineSegments:Ys,LinearEncoding:Xc,LinearFilter:fn,LinearInterpolant:I_,LinearMipMapLinearFilter:i_,LinearMipMapNearestFilter:n_,LinearMipmapLinearFilter:so,LinearMipmapNearestFilter:e_,LinearSRGBColorSpace:Es,LinearToneMapping:$M,Loader:Ai,LoaderUtils:uv,LoadingManager:z_,LoopOnce:tS,LoopPingPong:nS,LoopRepeat:eS,LuminanceAlphaFormat:ud,LuminanceFormat:cd,MOUSE:Oo,Material:Zn,MaterialLoader:Ud,MathUtils:gS,Matrix3:Te,Matrix4:de,MaxEquation:Lg,Mesh:Xe,MeshBasicMaterial:Tr,MeshDepthMaterial:g_,MeshDistanceMaterial:v_,MeshLambertMaterial:iA,MeshMatcapMaterial:sA,MeshNormalMaterial:nA,MeshPhongMaterial:tA,MeshPhysicalMaterial:QS,MeshStandardMaterial:R_,MeshToonMaterial:eA,MinEquation:Rg,MirroredRepeatWrapping:_l,MixOperation:qM,MultiplyBlending:Pg,MultiplyOperation:gu,NearestFilter:Ve,NearestMipMapLinearFilter:t_,NearestMipMapNearestFilter:Qv,NearestMipmapLinearFilter:Oc,NearestMipmapNearestFilter:Ff,NeverCompare:aS,NeverDepth:UM,NeverStencilFunc:Xz,NoBlending:yr,NoColorSpace:Jr,NoToneMapping:xr,NormalAnimationBlendMode:hd,NormalBlending:Yr,NotEqualCompare:fS,NotEqualDepth:GM,NotEqualStencilFunc:Jz,NumberKeyframeTrack:eu,Object3D:Ne,ObjectLoader:EB,ObjectSpaceNormalMap:rS,OctahedronGeometry:Mu,OneFactor:qv,OneMinusDstAlphaFactor:jv,OneMinusDstColorFactor:Zv,OneMinusSrcAlphaFactor:od,OneMinusSrcColorFactor:$v,OrthographicCamera:bu,PCFShadowMap:Bv,PCFSoftShadowMap:sd,PMREMGenerator:sv,Path:Kc,PerspectiveCamera:nn,Plane:vr,PlaneGeometry:Il,PlaneHelper:mH,PointLight:dA,PointLightHelper:oH,Points:HS,PointsMaterial:w_,PolarGridHelper:uH,PolyhedronGeometry:co,PositionalAudio:kB,PropertyBinding:ke,PropertyMixer:bA,QuadraticBezierCurve:A_,QuadraticBezierCurve3:E_,Quaternion:Pn,QuaternionKeyframeTrack:Ul,QuaternionLinearInterpolant:cA,RED_GREEN_RGTC2_Format:Qg,RED_RGTC1_Format:QM,REVISION:id,RGBADepthPacking:sS,RGBAFormat:Vn,RGBAIntegerFormat:a_,RGBA_ASTC_10x10_Format:Yg,RGBA_ASTC_10x5_Format:$g,RGBA_ASTC_10x6_Format:Xg,RGBA_ASTC_10x8_Format:jg,RGBA_ASTC_12x10_Format:Zg,RGBA_ASTC_12x12_Format:Kg,RGBA_ASTC_4x4_Format:Ng,RGBA_ASTC_5x4_Format:Fg,RGBA_ASTC_5x5_Format:Bg,RGBA_ASTC_6x5_Format:Hg,RGBA_ASTC_6x6_Format:Vg,RGBA_ASTC_8x5_Format:Gg,RGBA_ASTC_8x6_Format:qg,RGBA_ASTC_8x8_Format:Wg,RGBA_BPTC_Format:Ef,RGBA_ETC2_EAC_Format:Ug,RGBA_PVRTC_2BPPV1_Format:zg,RGBA_PVRTC_4BPPV1_Format:Og,RGBA_S3TC_DXT1_Format:Mf,RGBA_S3TC_DXT3_Format:Sf,RGBA_S3TC_DXT5_Format:Af,RGB_ETC1_Format:JM,RGB_ETC2_Format:kg,RGB_PVRTC_2BPPV1_Format:Ig,RGB_PVRTC_4BPPV1_Format:Dg,RGB_S3TC_DXT1_Format:wf,RGFormat:KM,RGIntegerFormat:o_,RawShaderMaterial:P_,Ray:la,Raycaster:tH,RectAreaLight:gA,RedFormat:ZM,RedIntegerFormat:r_,ReinhardToneMapping:XM,RepeatWrapping:vl,ReplaceStencilOp:Hz,ReverseSubtractEquation:Vv,RingGeometry:Rd,SIGNED_RED_GREEN_RGTC2_Format:tv,SIGNED_RED_RGTC1_Format:Jg,SRGBColorSpace:ve,Scene:zl,ShaderChunk:be,ShaderLib:ws,ShaderMaterial:qs,ShadowMaterial:JS,Shape:Xo,ShapeGeometry:Ld,ShapePath:_H,ShapeUtils:Hs,ShortType:yu,Skeleton:yd,SkeletonHelper:rH,SkinnedMesh:NS,Source:Go,Sphere:Ts,SphereGeometry:Su,Spherical:fv,SphericalHarmonics3:vA,SplineCurve:T_,SpotLight:fA,SpotLightHelper:sH,Sprite:kS,SpriteMaterial:x_,SrcAlphaFactor:rd,SrcAlphaSaturateFactor:Kv,SrcColorFactor:Wv,StaticCopyUsage:rk,StaticDrawUsage:jc,StaticReadUsage:nk,StereoCamera:DB,StreamCopyUsage:ak,StreamDrawUsage:ek,StreamReadUsage:sk,StringKeyframeTrack:fa,SubtractEquation:Hv,SubtractiveBlending:Cg,TOUCH:zo,TangentSpaceNormalMap:lo,TetrahedronGeometry:Dd,Texture:xn,TextureLoader:wB,TorusGeometry:Id,TorusKnotGeometry:Od,Triangle:gi,TriangleFanDrawMode:Fz,TriangleStripDrawMode:Nz,TrianglesDrawMode:Uz,TubeGeometry:zd,TwoPassDoubleSide:kz,UVMapping:vu,Uint16BufferAttribute:d_,Uint32BufferAttribute:p_,Uint8BufferAttribute:Wk,Uint8ClampedBufferAttribute:$k,Uniform:H_,UniformsGroup:KB,UniformsLib:Ft,UniformsUtils:SS,UnsignedByteType:ai,UnsignedInt248Type:Zr,UnsignedIntType:ls,UnsignedShort4444Type:ad,UnsignedShort5551Type:ld,UnsignedShortType:aa,VSMShadowMap:ks,Vector2:pt,Vector3:N,Vector4:Oe,VectorKeyframeTrack:nu,VideoTexture:O4,WebGL1Renderer:y_,WebGL3DRenderTarget:Dk,WebGLArrayRenderTarget:Lk,WebGLCoordinateSystem:Us,WebGLCubeRenderTarget:ES,WebGLMultipleRenderTargets:Ik,WebGLRenderTarget:Wi,WebGLRenderer:__,WebGLUtils:DS,WebGPUCoordinateSystem:Yc,WireframeGeometry:KS,WrapAroundEnding:$c,ZeroCurvatureEnding:Ho,ZeroFactor:Gv,ZeroSlopeEnding:Vo,ZeroStencilOp:Bz,_SRGBAFormat:Bf,sRGBEncoding:br},Symbol.toStringTag,{value:"Module"})),xH=()=>Gs("threlte-internal-context");function bH(s){let t;const e=s[9].default,n=ia(e,s,s[8],null);return{c(){n&&n.c()},l(i){n&&n.l(i)},m(i,r){n&&n.m(i,r),t=!0},p(i,[r]){n&&n.p&&(!t||r&256)&&sa(n,e,i,i[8],t?oa(e,i[8],r,null):ra(i[8]),null)},i(i){t||($e(n,i),t=!0)},o(i){Ye(n,i),t=!1},d(i){n&&n.d(i)}}}const zw="threlte-disposable-object-context";function wH(s,t,e){let n,i,{$$slots:r={},$$scope:o}=t;const{collectDisposableObjects:a,addDisposableObjects:l,removeDisposableObjects:c}=xH();let{object:h=void 0}=t,f=h,{dispose:d=void 0}=t;const m=Gs(zw);no(s,m,_=>e(7,i=_));const g=us(d??i??!0);no(s,g,_=>e(6,n=_)),As(zw,g);let y=n?a(h):[];return l(y),Gn(()=>{c(y)}),s.$$set=_=>{"object"in _&&e(2,h=_.object),"dispose"in _&&e(3,d=_.dispose),"$$scope"in _&&e(8,o=_.$$scope)},s.$$.update=()=>{s.$$.dirty&136&&g.set(d??i??!0),s.$$.dirty&116&&h!==f&&(c(y),e(5,y=n?a(h):[]),l(y),e(4,f=h))},[m,g,h,d,f,y,n,i,o,r]}class MH extends Xi{constructor(t){super(),ji(this,t,wH,bH,$i,{object:2,dispose:3})}}function SH(s,t){const e=us(s);let n=s;const i=e.subscribe(a=>n=a);return Gn(i),{...e,set:a=>{if((a==null?void 0:a.uuid)===(n==null?void 0:n.uuid))return;const l=n;e.set(a),t==null||t(a,l)},update:a=>{const l=a(n);if((l==null?void 0:l.uuid)===(n==null?void 0:n.uuid))return;const c=n;e.set(l),t==null||t(l,c)}}}const Nl=()=>Gs("threlte"),SA=()=>Gs("threlte-hierarchical-parent-context");function AH(s){let t;const e=s[8].default,n=ia(e,s,s[7],null);return{c(){n&&n.c()},l(i){n&&n.l(i)},m(i,r){n&&n.m(i,r),t=!0},p(i,[r]){n&&n.p&&(!t||r&128)&&sa(n,e,i,i[7],t?oa(e,i[7],r,null):ra(i[7]),null)},i(i){t||($e(n,i),t=!0)},o(i){Ye(n,i),t=!1},d(i){n&&n.d(i)}}}const EH=()=>({onChildMount:Gs("threlte-hierarchical-object-on-mount"),onChildDestroy:Gs("threlte-hierarchical-object-on-destroy")});function TH(s,t,e){var v;let n,{$$slots:i={},$$scope:r}=t,{object:o=void 0}=t,{children:a=[]}=t,{onChildMount:l=void 0}=t;const c=w=>{a.push(w),e(1,a),l==null||l(w)};let{onChildDestroy:h=void 0}=t;const f=w=>{const b=a.findIndex(M=>M.uuid===w.uuid);b!==-1&&a.splice(b,1),e(1,a),h==null||h(w)},{invalidate:d}=Nl(),m=SA();no(s,m,w=>e(6,n=w));let{parent:g=n}=t;const y=EH();o&&((v=y.onChildMount)==null||v.call(y,o),d("HierarchicalObject: object added"));const _=SH(o,(w,b)=>{var M,A;b&&((M=y.onChildDestroy)==null||M.call(y,b),d("HierarchicalObject: object added")),w&&((A=y.onChildMount)==null||A.call(y,w),d("HierarchicalObject: object removed"))});return Gn(()=>{var w;o&&((w=y.onChildDestroy)==null||w.call(y,o),d("HierarchicalObject: object removed"))}),As("threlte-hierarchical-object-on-mount",c),As("threlte-hierarchical-object-on-destroy",f),As("threlte-hierarchical-parent-context",_),s.$$set=w=>{"object"in w&&e(3,o=w.object),"children"in w&&e(1,a=w.children),"onChildMount"in w&&e(4,l=w.onChildMount),"onChildDestroy"in w&&e(5,h=w.onChildDestroy),"parent"in w&&e(2,g=w.parent),"$$scope"in w&&e(7,r=w.$$scope)},s.$$.update=()=>{s.$$.dirty&64&&e(2,g=n),s.$$.dirty&8&&_.set(o)},[m,a,g,o,l,h,n,r,i]}class CH extends Xi{constructor(t){super(),ji(this,t,TH,AH,$i,{object:3,children:1,onChildMount:4,onChildDestroy:5,parent:2})}}function PH(s){let t;const e=s[1].default,n=ia(e,s,s[4],null);return{c(){n&&n.c()},l(i){n&&n.l(i)},m(i,r){n&&n.m(i,r),t=!0},p(i,r){n&&n.p&&(!t||r&16)&&sa(n,e,i,i[4],t?oa(e,i[4],r,null):ra(i[4]),null)},i(i){t||($e(n,i),t=!0)},o(i){Ye(n,i),t=!1},d(i){n&&n.d(i)}}}function RH(s){let t,e;return t=new CH({props:{object:s[0],onChildMount:s[2],onChildDestroy:s[3],$$slots:{default:[PH]},$$scope:{ctx:s}}}),{c(){xi(t.$$.fragment)},l(n){bi(t.$$.fragment,n)},m(n,i){wi(t,n,i),e=!0},p(n,[i]){const r={};i&1&&(r.object=n[0]),i&1&&(r.onChildMount=n[2]),i&1&&(r.onChildDestroy=n[3]),i&16&&(r.$$scope={dirty:i,ctx:n}),t.$set(r)},i(n){e||($e(t.$$.fragment,n),e=!0)},o(n){Ye(t.$$.fragment,n),e=!1},d(n){Mi(t,n)}}}function LH(s,t,e){let{$$slots:n={},$$scope:i}=t,{object:r}=t;const o=l=>r.add(l),a=l=>r.remove(l);return s.$$set=l=>{"object"in l&&e(0,r=l.object),"$$scope"in l&&e(4,i=l.$$scope)},[r,n,o,a,i]}class DH extends Xi{constructor(t){super(),ji(this,t,LH,RH,$i,{object:0})}}const AA=(s,t)=>{if(t.includes(".")){const e=t.split("."),n=e.pop();for(let i=0;i<e.length;i+=1)s=s[e[i]];return{target:s,key:n}}else return{target:s,key:t}},lg=Symbol("initialValueBeforeAttach"),IH=()=>{const{invalidate:s}=Nl();let t=!1,e=lg,n,i,r;const o=(l,c,h)=>{if(a(),!h){const f=l;((f==null?void 0:f.isMaterial)||!1)&&(h="material"),((f==null?void 0:f.isBufferGeometry)||(f==null?void 0:f.isGeometry)||!1)&&(h="geometry")}if(h){if(typeof h=="function")n=h(c,l);else{const{target:f,key:d}=AA(c,h);e=f[d],f[d]=l,i=f,r=d}t=!0,s()}},a=()=>{t&&(n?(n(),n=void 0):i&&r&&e!==lg&&(i[r]=e,e=lg,i=void 0,r=void 0),t=!1,s())};return Gn(()=>{a()}),{update:o}},OH=s=>s&&s.isCamera,EA=s=>s&&s.isOrthographicCamera,TA=s=>s&&s.isPerspectiveCamera,zH=s=>TA(s)||EA(s),kH=()=>{const{invalidate:s,size:t,camera:e}=Nl();let n,i;Gn(()=>{i==null||i()});const r=l=>{n&&(EA(n)?(n.left=l.width/-2,n.right=l.width/2,n.top=l.height/2,n.bottom=l.height/-2,n.updateProjectionMatrix(),n.updateMatrixWorld(),s()):TA(n)&&(n.aspect=l.width/l.height,n.updateProjectionMatrix(),n.updateMatrixWorld(),s()))};return{update:(l,c)=>{if(i==null||i(),c||!zH(l)){n=void 0;return}n=l,i=t.subscribe(r)},makeDefaultCamera:(l,c)=>{!OH(l)||!c||(e.set(l),s())}}},CA=()=>{const s=kv(),t=(n,i)=>{const r=s.$$.callbacks[n];r&&r.forEach(o=>{o(i)})};return Object.defineProperty(t,"hasEventListener",{value:n=>!!s.$$.callbacks[n],enumerable:!0}),t},UH=()=>{const s=CA(),t=[];let e,n=!1;const i=()=>{t.forEach(a=>a()),t.length=0,s("create",{ref:e,cleanup:a=>{t.push(a)}})},r=o=>{e=o,n&&i()};return nd(()=>{i(),n=!0}),Gn(()=>{t.forEach(o=>o())}),{updateRef:r}},kw=s=>!!(s!=null&&s.addEventListener),NH=()=>{const s=CA(),t=kv(),e=d=>{d!=null&&d.type&&s(d.type,d)},n=(d,m)=>{kw(d)&&m.forEach(g=>{d.removeEventListener(g,e)})},i=(d,m)=>{kw(d)&&m.forEach(g=>{d.addEventListener(g,e)})};let r=[],o;const a=us([]),l=a.subscribe(d=>{n(o,r),i(o,d),r=d});Gn(l);const c=us(),h=c.subscribe(d=>{n(o,r),i(d,r),o=d});return Gn(h),Gn(()=>{n(o,r)}),nd(()=>{a.set(Object.keys(t.$$.callbacks))}),{updateRef:d=>{c.set(d)}}},FH=s=>{const e=Gs("threlte-plugin-context");if(!e)return;const n=Object.values(e).map(c=>c(s)).filter(Boolean),i=n.flatMap(c=>c.pluginProps??[]);let r=[];return Gn(()=>{r.forEach(c=>c())}),{updateRef:c=>{r.forEach(h=>h()),r=[],n.forEach(h=>{var d;const f=(d=h.onRefChange)==null?void 0:d.call(h,c);f&&r.push(f)})},updateProps:c=>{n.forEach(h=>{var f;(f=h.onPropsChange)==null||f.call(h,c)})},updateRestProps:c=>{n.forEach(h=>{var f;(f=h.onRestPropsChange)==null||f.call(h,c)})},pluginsProps:i}},BH=new Set(["$$scope","$$slots","type","args","attach","instance"]),HH=new Set(["fov","aspect","near","far","left","right","top","bottom","zoom"]),VH=s=>typeof s=="string"||typeof s=="number"||typeof s=="boolean"||typeof s>"u"||s===null,GH=()=>{const{invalidate:s}=Nl(),t=new Map,e=(i,r,o,a)=>{var h,f;if(VH(o)){const d=t.get(r);if(d&&d.instance===i&&d.value===o)return;t.set(r,{instance:i,value:o})}const{key:l,target:c}=AA(i,r);if(!Array.isArray(o)&&typeof o=="number"&&typeof((h=c[l])==null?void 0:h.setScalar)=="function")c[l].setScalar(o);else if(typeof((f=c[l])==null?void 0:f.set)=="function")Array.isArray(o)?c[l].set(...o):c[l].set(o);else{if(c[l]=o,a.manualCamera)return;HH.has(l)&&(c.isPerspectiveCamera||c.isOrthographicCamera)&&c.updateProjectionMatrix()}};return{updateProps:(i,r,o)=>{var a;for(const l in r)!BH.has(l)&&!((a=o.pluginsProps)!=null&&a.includes(l))&&e(i,l,r[l],o),s()}}},qH=s=>({ref:s&2}),Uw=s=>({ref:s[1]}),WH=s=>({ref:s&2}),Nw=s=>({ref:s[1]});function Fw(s){let t,e;return t=new MH({props:{object:s[1],dispose:s[0]}}),{c(){xi(t.$$.fragment)},l(n){bi(t.$$.fragment,n)},m(n,i){wi(t,n,i),e=!0},p(n,i){const r={};i&2&&(r.object=n[1]),i&1&&(r.dispose=n[0]),t.$set(r)},i(n){e||($e(t.$$.fragment,n),e=!0)},o(n){Ye(t.$$.fragment,n),e=!1},d(n){Mi(t,n)}}}function $H(s){let t;const e=s[12].default,n=ia(e,s,s[13],Uw);return{c(){n&&n.c()},l(i){n&&n.l(i)},m(i,r){n&&n.m(i,r),t=!0},p(i,r){n&&n.p&&(!t||r&8194)&&sa(n,e,i,i[13],t?oa(e,i[13],r,qH):ra(i[13]),Uw)},i(i){t||($e(n,i),t=!0)},o(i){Ye(n,i),t=!1},d(i){n&&n.d(i)}}}function XH(s){let t,e;return t=new DH({props:{object:s[1],$$slots:{default:[jH]},$$scope:{ctx:s}}}),{c(){xi(t.$$.fragment)},l(n){bi(t.$$.fragment,n)},m(n,i){wi(t,n,i),e=!0},p(n,i){const r={};i&2&&(r.object=n[1]),i&8194&&(r.$$scope={dirty:i,ctx:n}),t.$set(r)},i(n){e||($e(t.$$.fragment,n),e=!0)},o(n){Ye(t.$$.fragment,n),e=!1},d(n){Mi(t,n)}}}function jH(s){let t;const e=s[12].default,n=ia(e,s,s[13],Nw);return{c(){n&&n.c()},l(i){n&&n.l(i)},m(i,r){n&&n.m(i,r),t=!0},p(i,r){n&&n.p&&(!t||r&8194)&&sa(n,e,i,i[13],t?oa(e,i[13],r,WH):ra(i[13]),Nw)},i(i){t||($e(n,i),t=!0)},o(i){Ye(n,i),t=!1},d(i){n&&n.d(i)}}}function YH(s){let t=s[4](s[1]),e,n,i,r,o,a,l=t&&Fw(s);const c=[XH,$H],h=[];function f(d,m){return m&2&&(n=null),n==null&&(n=!!d[3](d[1])),n?0:1}return i=f(s,-1),r=h[i]=c[i](s),{c(){l&&l.c(),e=Uv(),r.c(),o=Uf()},l(d){l&&l.l(d),e=Nv(d),r.l(d),o=Uf()},m(d,m){l&&l.m(d,m),Yo(d,e,m),h[i].m(d,m),Yo(d,o,m),a=!0},p(d,[m]){m&2&&(t=d[4](d[1])),t?l?(l.p(d,m),m&2&&$e(l,1)):(l=Fw(d),l.c(),$e(l,1),l.m(e.parentNode,e)):l&&(Ag(),Ye(l,1,1,()=>{l=null}),Sg());let g=i;i=f(d,m),i===g?h[i].p(d,m):(Ag(),Ye(h[g],1,1,()=>{h[g]=null}),Sg(),r=h[i],r?r.p(d,m):(r=h[i]=c[i](d),r.c()),$e(r,1),r.m(o.parentNode,o))},i(d){a||($e(l),$e(r),a=!0)},o(d){Ye(l),Ye(r),a=!1},d(d){d&&(Fe(e),Fe(o)),l&&l.d(d),h[i].d(d)}}}function ZH(s,t,e){const n=["is","args","attach","manual","makeDefault","dispose","ref"];let i=kf(t,n),r,{$$slots:o={},$$scope:a}=t,{is:l}=t,{args:c=void 0}=t,{attach:h=void 0}=t,{manual:f=void 0}=t,{makeDefault:d=void 0}=t,{dispose:m=void 0}=t;const g=Gs("threlte-hierarchical-parent-context");no(s,g,I=>e(11,r=I));const y=I=>typeof I=="function"&&/^\s*class\s+/.test(I.toString()),_=I=>Array.isArray(I),v=UH();let w=y(l)&&_(c)?new l(...c):y(l)?new l:l;v.updateRef(w);let b=!1;const M=()=>{if(!b){b=!0;return}e(1,w=y(l)&&_(c)?new l(...c):y(l)?new l:l),v.updateRef(w)};let{ref:A=w}=t;const T=us(w);As("threlte-hierarchical-parent-context",T);const P=FH({ref:w,props:t}),C=(P==null?void 0:P.pluginsProps)??[],S=GH(),L=kH(),H=IH(),$=NH(),B=I=>!!I.isObject3D,G=I=>I.dispose!==void 0;return s.$$set=I=>{e(27,t=Hc(Hc({},t),Mg(I))),e(26,i=kf(t,n)),"is"in I&&e(6,l=I.is),"args"in I&&e(7,c=I.args),"attach"in I&&e(8,h=I.attach),"manual"in I&&e(9,f=I.manual),"makeDefault"in I&&e(10,d=I.makeDefault),"dispose"in I&&e(0,m=I.dispose),"ref"in I&&e(5,A=I.ref),"$$scope"in I&&e(13,a=I.$$scope)},s.$$.update=()=>{s.$$.dirty&192&&M(),s.$$.dirty&2&&e(5,A=w),s.$$.dirty&2&&T.set(w),S.updateProps(w,i,{manualCamera:f,pluginsProps:C}),s.$$.dirty&514&&L.update(w,f),s.$$.dirty&1026&&L.makeDefaultCamera(w,d),s.$$.dirty&2306&&H.update(w,r,h),s.$$.dirty&2&&$.updateRef(w),s.$$.dirty&2&&(P==null||P.updateRef(w)),P==null||P.updateProps(t),P==null||P.updateRestProps(i)},t=Mg(t),[m,w,g,B,G,A,l,c,h,f,d,r,o,a]}let V_=class extends Xi{constructor(t){super(),ji(this,t,ZH,YH,$i,{is:6,args:7,attach:8,manual:9,makeDefault:10,dispose:0,ref:5})}};const G_=typeof window<"u",KH=()=>{const s=us({width:0,height:0});let t={width:0,height:0};const e=s.subscribe(o=>t=o);Gn(e);let n;const i=()=>{const o=t;if(!n||!n.parentElement)return;const{clientWidth:a,clientHeight:l}=n.parentElement;(a!==o.width||l!==o.height)&&s.set({width:a,height:l})},r=o=>{n=o,i(),window.addEventListener("resize",i)};return G_?(Gn(()=>{window.removeEventListener("resize",i)}),{parentSizeAction:r,parentSize:s}):{parentSize:s,parentSizeAction:r}},JH=()=>{As("threlte-cache",[])},PA=s=>s.userData,QH=()=>{const s=new nn(75,0,.1,1e3);return PA(s).threlteDefaultCamera=!0,s.position.z=5,s.lookAt(0,0,0),s},tV=s=>{q_(s.size,t=>{PA(yz(s.camera)).threlteDefaultCamera&&s.camera.update(e=>{const n=e;return n.aspect=t.width/t.height,n.updateProjectionMatrix(),s.invalidate("Default camera: aspect ratio changed"),n})})},q_=(s,t)=>{const e=Fv(s,r=>r);let n;const i=e.subscribe(async r=>{n&&n();const o=await t(r);o&&(n=o)});Gn(()=>{i(),n&&n()})},pr=s=>{const t=us(s),e={set:n=>{e.current=n,t.set(n)},subscribe:t.subscribe,update:n=>{const i=n(e.current);e.current=i,t.set(i)},current:s};return e},eV=s=>{const t={debugFrameloop:s.debugFrameloop,frame:0,frameInvalidated:!0,invalidations:{},manualFrameHandlers:new Set,autoFrameHandlers:new Set,allFrameHandlers:new Set,allFrameHandlersNeedSortCheck:!1,renderHandlers:new Set,renderHandlersNeedSortCheck:!1,advance:!1,dispose:async(o=!1)=>{await xz(),!(!t.shouldDispose&&!o)&&(t.disposableObjects.forEach((a,l)=>{var c;(a===0||o)&&((c=l==null?void 0:l.dispose)==null||c.call(l),t.disposableObjects.delete(l))}),t.shouldDispose=!1)},collectDisposableObjects:(o,a)=>{const l=a??[];return o&&(o!=null&&o.dispose&&typeof o.dispose=="function"&&o.type!=="Scene"&&l.push(o),Object.entries(o).forEach(([c,h])=>{if(c==="parent"||c==="children"||typeof h!="object")return;const f=h;f!=null&&f.dispose&&t.collectDisposableObjects(f,l)})),l},addDisposableObjects:o=>{o.forEach(a=>{const l=t.disposableObjects.get(a);l?t.disposableObjects.set(a,l+1):t.disposableObjects.set(a,1)})},removeDisposableObjects:o=>{o.length!==0&&(o.forEach(a=>{const l=t.disposableObjects.get(a);l&&l>0&&t.disposableObjects.set(a,l-1)}),t.shouldDispose=!0)},disposableObjects:new Map,shouldDispose:!1},e={size:Fv([s.userSize,s.parentSize],([o,a])=>o||a),clock:new N_,camera:pr(QH()),scene:new zl,renderer:void 0,invalidate:o=>{t.frameInvalidated=!0,t.debugFrameloop&&o&&(t.invalidations[o]=t.invalidations[o]?t.invalidations[o]+1:1)},advance:()=>{t.advance=!0},colorSpace:pr(s.colorSpace),toneMapping:pr(s.toneMapping),dpr:pr(s.dpr),useLegacyLights:pr(s.useLegacyLights),shadows:pr(s.shadows),colorManagementEnabled:pr(s.colorManagementEnabled),frameloop:pr(s.frameloop)},n=pr({});return As("threlte",e),As("threlte-internal-context",t),As("threlte-user-context",n),{ctx:e,internalCtx:t,getCtx:()=>e,getInternalCtx:()=>t}},nV=(s,t,e)=>{if(t.allFrameHandlers.size!==0){if(t.allFrameHandlersNeedSortCheck){const n=Array.from(t.allFrameHandlers);if(n.some(r=>r.order)){const r=n.sort((o,a)=>(o.order??0)>(a.order??0)?1:-1);t.allFrameHandlers.clear(),r.forEach(o=>t.allFrameHandlers.add(o))}t.allFrameHandlersNeedSortCheck=!1}if(t.debugFrameloop){let n=0;t.autoFrameHandlers.forEach(i=>{i.debugFrameloopMessage?t.invalidations[i.debugFrameloopMessage]=i.debugFrameloopMessage in t.invalidations?t.invalidations[i.debugFrameloopMessage]+1:1:++n}),n>0&&(t.invalidations.useFrame=t.autoFrameHandlers.size)}t.allFrameHandlers.forEach(n=>n.fn(s,e))}},iV=(s,t,e)=>{if(t.renderHandlers.size!==0){if(t.renderHandlersNeedSortCheck){const n=Array.from(t.renderHandlers);if(n.some(r=>r.order)){const r=n.sort((o,a)=>(o.order??0)>(a.order??0)?1:-1);t.renderHandlers.clear(),r.forEach(o=>t.renderHandlers.add(o))}t.renderHandlersNeedSortCheck=!1}t.renderHandlers.forEach(n=>n.fn(s,e))}},sV=s=>{s.debugFrameloop&&(s.frame+=1,console.log(`frame: ${s.frame}${Object.keys(s.invalidations).length>0?", requested by ↴":""}`),Object.keys(s.invalidations).length>0&&console.table(s.invalidations),s.invalidations={})},rV=(s,t)=>s.frameloop.current==="always"||s.frameloop.current==="demand"&&(t.frameInvalidated||t.autoFrameHandlers.size>0)||s.frameloop.current==="never"&&t.advance,oV=(s,t)=>{var e;(e=s.renderer)==null||e.setAnimationLoop(()=>{t.dispose();const n=s.clock.getDelta();nV(s,t,n),rV(s,t)&&(t.renderHandlers.size>0?iV(s,t,n):s.renderer&&s.camera.current&&s.renderer.render(s.scene,s.camera.current),sV(t),t.frameInvalidated=!1,t.advance=!1)})},aV={srgb:br,"srgb-linear":Xc,"":Xc},lV=s=>s.outputColorSpace!==void 0,cV=s=>{const t=us(void 0),e=(n,i)=>{s.renderer=new __({powerPreference:"high-performance",canvas:n,antialias:!0,alpha:!0,...i}),t.set(s.renderer)};return q_([t,s.size,s.toneMapping,s.colorSpace,s.dpr,s.shadows,s.colorManagementEnabled,s.useLegacyLights],([n,i,r,o,a,l,c,h])=>{if(!n)return;if(n.setSize(i.width,i.height),n.setPixelRatio(a),lV(n))n.outputColorSpace=o;else{const m=aV[o];m?n.outputEncoding=m:console.warn("No encoding found for colorSpace",o)}n.toneMapping=r,n.shadowMap.enabled=!!l,l&&l!==!0?n.shadowMap.type=l:l===!0&&(n.shadowMap.type=sd);const f=Ui;f.enabled!==void 0?f.enabled=c:f.legacyMode!==void 0&&(f.legacyMode=!c);const d=n;h&&d.useLegacyLights!==void 0?d.useLegacyLights=h:d.physicallyCorrectLights!==void 0&&(d.physicallyCorrectLights=!h)}),Gn(()=>{var n;(n=s.renderer)==null||n.dispose()}),{createRenderer:e}};function Bw(s){let t,e;return t=new V_({props:{is:s[3].ctx.scene,$$slots:{default:[uV]},$$scope:{ctx:s}}}),{c(){xi(t.$$.fragment)},l(n){bi(t.$$.fragment,n)},m(n,i){wi(t,n,i),e=!0},p(n,i){const r={};i&131072&&(r.$$scope={dirty:i,ctx:n}),t.$set(r)},i(n){e||($e(t.$$.fragment,n),e=!0)},o(n){Ye(t.$$.fragment,n),e=!1},d(n){Mi(t,n)}}}function uV(s){let t;const e=s[15].default,n=ia(e,s,s[17],null);return{c(){n&&n.c()},l(i){n&&n.l(i)},m(i,r){n&&n.m(i,r),t=!0},p(i,r){n&&n.p&&(!t||r&131072)&&sa(n,e,i,i[17],t?oa(e,i[17],r,null):ra(i[17]),null)},i(i){t||($e(n,i),t=!0)},o(i){Ye(n,i),t=!1},d(i){n&&n.d(i)}}}function hV(s){let t,e,n,i,r=s[1]&&Bw(s);return{c(){t=ln("canvas"),r&&r.c(),this.h()},l(o){t=cn(o,"CANVAS",{class:!0});var a=IM(t);r&&r.l(a),a.forEach(Fe),this.h()},h(){Zt(t,"class","svelte-15bl8wt")},m(o,a){Yo(o,t,a),r&&r.m(t,null),s[16](t),e=!0,n||(i=bz(s[2].call(null,t)),n=!0)},p(o,[a]){o[1]?r?(r.p(o,a),a&2&&$e(r,1)):(r=Bw(o),r.c(),$e(r,1),r.m(t,null)):r&&(Ag(),Ye(r,1,1,()=>{r=null}),Sg())},i(o){e||($e(r),e=!0)},o(o){Ye(r),e=!1},d(o){o&&Fe(t),r&&r.d(),s[16](null),n=!1,i()}}}const Hw=new Set;function fV(s,t,e){let{$$slots:n={},$$scope:i}=t,{dpr:r=G_?window.devicePixelRatio:1}=t,{toneMapping:o=Jv}=t,{colorSpace:a="srgb"}=t,{frameloop:l="demand"}=t,{debugFrameloop:c=!1}=t,{shadows:h=sd}=t,{size:f=void 0}=t,{rendererParameters:d=void 0}=t,{colorManagementEnabled:m=!0}=t,{useLegacyLights:g=!0}=t,y,_=!1;const v=us(f),{parentSize:w,parentSizeAction:b}=KH(),M=eV({colorSpace:a,toneMapping:o,dpr:r,userSize:v,parentSize:w,debugFrameloop:c,frameloop:l,shadows:h,colorManagementEnabled:m,useLegacyLights:g});JH();const A=M.ctx;tV(A),Hw.add(A.invalidate),Gn(()=>{Hw.delete(A.invalidate)});const{createRenderer:T}=cV(A);nd(()=>{y&&(T(y,d),oV(M.ctx,M.internalCtx),e(1,_=!0))}),Gn(()=>{var C;M.internalCtx.dispose(!0),(C=M.ctx.renderer)==null||C.setAnimationLoop(null)});function P(C){DM[C?"unshift":"push"](()=>{y=C,e(0,y)})}return s.$$set=C=>{"dpr"in C&&e(4,r=C.dpr),"toneMapping"in C&&e(5,o=C.toneMapping),"colorSpace"in C&&e(6,a=C.colorSpace),"frameloop"in C&&e(7,l=C.frameloop),"debugFrameloop"in C&&e(8,c=C.debugFrameloop),"shadows"in C&&e(9,h=C.shadows),"size"in C&&e(10,f=C.size),"rendererParameters"in C&&e(11,d=C.rendererParameters),"colorManagementEnabled"in C&&e(12,m=C.colorManagementEnabled),"useLegacyLights"in C&&e(13,g=C.useLegacyLights),"$$scope"in C&&e(17,i=C.$$scope)},s.$$.update=()=>{s.$$.dirty&1024&&v.set(f)},[y,_,b,M,r,o,a,l,c,h,f,d,m,g,A,n,P,i]}class dV extends Xi{constructor(t){super(),ji(this,t,fV,hV,$i,{dpr:4,toneMapping:5,colorSpace:6,frameloop:7,debugFrameloop:8,shadows:9,size:10,rendererParameters:11,colorManagementEnabled:12,useLegacyLights:13,ctx:14})}get ctx(){return this.$$.ctx[14]}}const pV={},mV=(s,t)=>{const e=pV[t]||yH[t];if(!e)throw new Error(`No Three.js module found for ${t}. Did you forget to extend the catalogue?`);return{...s,props:{...s.props,is:e}}},gV=s=>new Proxy(class{},{construct(t,[e]){const n=e;return new V_(mV(n,s))}}),RA=new Proxy(class{},{construct(s,[t]){const e=t;return new V_(e)},get(s,t){return gV(t)}}),LA=(s,t)=>{if(!G_)return{start:()=>{},stop:()=>{},started:Sz(!1)};const e=(t==null?void 0:t.invalidate)??!0,n=Gs("threlte-internal-context"),i={fn:s,order:t==null?void 0:t.order,debugFrameloopMessage:t==null?void 0:t.debugFrameloopMessage,invalidate:e},r=us(!1),o=()=>{e?n.autoFrameHandlers.delete(i):n.manualFrameHandlers.delete(i),n.allFrameHandlers.delete(i),r.set(!1)},a=()=>{e?n.autoFrameHandlers.add(i):n.manualFrameHandlers.add(i),n.allFrameHandlers.add(i),n.allFrameHandlersNeedSortCheck=!0,r.set(!0)};return((t==null?void 0:t.autostart)??!0)&&a(),Gn(()=>{o()}),{start:a,stop:o,started:{subscribe:r.subscribe}}};function vV(s,t,e){const n=Gs("threlte-user-context");if(!n)throw new Error("No user context store found, did you invoke this function outside of your main <Canvas> component?");return s?s&&!t?Fv(n,i=>i[s]):(n.update(i=>{if(s in i){if(!e||e.existing==="skip")return i;if(e.existing==="merge")return Object.assign(i[s],t),i}return i[s]=t,i}),n.current[s]):{subscribe:n.subscribe}}const _V=()=>{const s=kv(),t=us(void 0);return q_(t,e=>{e&&Object.entries(s.$$.callbacks).forEach(n=>{const[i,r]=n;i in e.$$.callbacks&&Array.isArray(e.$$.callbacks[i])?e.$$.callbacks[i].push(...r):e.$$.callbacks[i]=r})}),t};new N;new N;new N;var Vf={exports:{}};/**
 * @license
 * Lodash <https://lodash.com/>
 * Copyright OpenJS Foundation and other contributors <https://openjsf.org/>
 * Released under MIT license <https://lodash.com/license>
 * Based on Underscore.js 1.8.3 <http://underscorejs.org/LICENSE>
 * Copyright Jeremy Ashkenas, DocumentCloud and Investigative Reporters & Editors
 */Vf.exports;(function(s,t){(function(){var e,n="4.17.21",i=200,r="Unsupported core-js use. Try https://npms.io/search?q=ponyfill.",o="Expected a function",a="Invalid `variable` option passed into `_.template`",l="__lodash_hash_undefined__",c=500,h="__lodash_placeholder__",f=1,d=2,m=4,g=1,y=2,_=1,v=2,w=4,b=8,M=16,A=32,T=64,P=128,C=256,S=512,L=30,H="...",$=800,B=16,G=1,I=2,et=3,Y=1/0,J=9007199254740991,ut=17976931348623157e292,dt=0/0,nt=4294967295,ft=nt-1,Lt=nt>>>1,Ot=[["ary",P],["bind",_],["bindKey",v],["curry",b],["curryRight",M],["flip",S],["partial",A],["partialRight",T],["rearg",C]],It="[object Arguments]",Kt="[object Array]",Ht="[object AsyncFunction]",qt="[object Boolean]",ee="[object Date]",le="[object DOMException]",$t="[object Error]",Mt="[object Function]",X="[object GeneratorFunction]",bt="[object Map]",W="[object Number]",st="[object Null]",ct="[object Object]",Ct="[object Promise]",wt="[object Proxy]",Tt="[object RegExp]",Xt="[object Set]",Qt="[object String]",U="[object Symbol]",k="[object Undefined]",ht="[object WeakMap]",St="[object WeakSet]",Et="[object ArrayBuffer]",Dt="[object DataView]",Jt="[object Float32Array]",tt="[object Float64Array]",Q="[object Int8Array]",V="[object Int16Array]",_t="[object Int32Array]",zt="[object Uint8Array]",Ut="[object Uint8ClampedArray]",kt="[object Uint16Array]",ne="[object Uint32Array]",_e=/\b__p \+= '';/g,Z=/\b(__p \+=) '' \+/g,Rt=/(__e\(.*?\)|\b__t\)) \+\n'';/g,at=/&(?:amp|lt|gt|quot|#39);/g,Pt=/[&<>"']/g,Nt=RegExp(at.source),ye=RegExp(Pt.source),Be=/<%-([\s\S]+?)%>/g,Qe=/<%([\s\S]+?)%>/g,Ti=/<%=([\s\S]+?)%>/g,Ze=/\.|\[(?:[^[\]]*|(["'])(?:(?!\1)[^\\]|\\.)*?\1)\]/,Yi=/^\w*$/,Zi=/[^.[\]]+|\[(?:(-?\d+(?:\.\d+)?)|(["'])((?:(?!\2)[^\\]|\\.)*?)\2)\]|(?=(?:\.|\[\])(?:\.|\[\]|$))/g,hs=/[\\^$.*+?()[\]{}|]/g,zu=RegExp(hs.source),_a=/^\s+/,gp=/\s/,ya=/\{(?:\n\/\* \[wrapped with .+\] \*\/)?\n?/,ku=/\{\n\/\* \[wrapped with (.+)\] \*/,xa=/,? & /,Uu=/[^\x00-\x2f\x3a-\x40\x5b-\x60\x7b-\x7f]+/g,vp=/[()=,{}\[\]\/\s]/,_p=/\\(\\)?/g,yp=/\$\{([^\\}]*(?:\\.[^\\}]*)*)\}/g,F=/\w*$/,ot=/^[-+]0x[0-9a-f]+$/i,mt=/^0b[01]+$/i,rt=/^\[object .+?Constructor\]$/,vt=/^0o[0-7]+$/i,Wt=/^(?:0|[1-9]\d*)$/,ie=/[\xc0-\xd6\xd8-\xf6\xf8-\xff\u0100-\u017f]/g,re=/($^)/,ce=/['\n\r\u2028\u2029\\]/g,me="\\ud800-\\udfff",he="\\u0300-\\u036f",ge="\\ufe20-\\ufe2f",rn="\\u20d0-\\u20ff",on=he+ge+rn,Jn="\\u2700-\\u27bf",Ki="a-z\\xdf-\\xf6\\xf8-\\xff",pn="\\xac\\xb1\\xd7\\xf7",Pe="\\x00-\\x2f\\x3a-\\x40\\x5b-\\x60\\x7b-\\xbf",jl="\\u2000-\\u206f",En=" \\t\\x0b\\f\\xa0\\ufeff\\n\\r\\u2028\\u2029\\u1680\\u180e\\u2000\\u2001\\u2002\\u2003\\u2004\\u2005\\u2006\\u2007\\u2008\\u2009\\u200a\\u202f\\u205f\\u3000",Ls="A-Z\\xc0-\\xd6\\xd8-\\xde",Yl="\\ufe0e\\ufe0f",Pr=pn+Pe+jl+En,po="['’]",Fn="["+me+"]",Ds="["+Pr+"]",Rr="["+on+"]",qn="\\d+",Zl="["+Jn+"]",Nu="["+Ki+"]",Kl="[^"+me+Pr+qn+Jn+Ki+Ls+"]",xp="\\ud83c[\\udffb-\\udfff]",b2="(?:"+Rr+"|"+xp+")",Wy="[^"+me+"]",bp="(?:\\ud83c[\\udde6-\\uddff]){2}",wp="[\\ud800-\\udbff][\\udc00-\\udfff]",ba="["+Ls+"]",$y="\\u200d",Xy="(?:"+Nu+"|"+Kl+")",w2="(?:"+ba+"|"+Kl+")",jy="(?:"+po+"(?:d|ll|m|re|s|t|ve))?",Yy="(?:"+po+"(?:D|LL|M|RE|S|T|VE))?",Zy=b2+"?",Ky="["+Yl+"]?",M2="(?:"+$y+"(?:"+[Wy,bp,wp].join("|")+")"+Ky+Zy+")*",S2="\\d*(?:1st|2nd|3rd|(?![123])\\dth)(?=\\b|[A-Z_])",A2="\\d*(?:1ST|2ND|3RD|(?![123])\\dTH)(?=\\b|[a-z_])",Jy=Ky+Zy+M2,E2="(?:"+[Zl,bp,wp].join("|")+")"+Jy,T2="(?:"+[Wy+Rr+"?",Rr,bp,wp,Fn].join("|")+")",C2=RegExp(po,"g"),P2=RegExp(Rr,"g"),Mp=RegExp(xp+"(?="+xp+")|"+T2+Jy,"g"),R2=RegExp([ba+"?"+Nu+"+"+jy+"(?="+[Ds,ba,"$"].join("|")+")",w2+"+"+Yy+"(?="+[Ds,ba+Xy,"$"].join("|")+")",ba+"?"+Xy+"+"+jy,ba+"+"+Yy,A2,S2,qn,E2].join("|"),"g"),L2=RegExp("["+$y+me+on+Yl+"]"),D2=/[a-z][A-Z]|[A-Z]{2}[a-z]|[0-9][a-zA-Z]|[a-zA-Z][0-9]|[^a-zA-Z0-9 ]/,I2=["Array","Buffer","DataView","Date","Error","Float32Array","Float64Array","Function","Int8Array","Int16Array","Int32Array","Map","Math","Object","Promise","RegExp","Set","String","Symbol","TypeError","Uint8Array","Uint8ClampedArray","Uint16Array","Uint32Array","WeakMap","_","clearTimeout","isFinite","parseInt","setTimeout"],O2=-1,tn={};tn[Jt]=tn[tt]=tn[Q]=tn[V]=tn[_t]=tn[zt]=tn[Ut]=tn[kt]=tn[ne]=!0,tn[It]=tn[Kt]=tn[Et]=tn[qt]=tn[Dt]=tn[ee]=tn[$t]=tn[Mt]=tn[bt]=tn[W]=tn[ct]=tn[Tt]=tn[Xt]=tn[Qt]=tn[ht]=!1;var Ke={};Ke[It]=Ke[Kt]=Ke[Et]=Ke[Dt]=Ke[qt]=Ke[ee]=Ke[Jt]=Ke[tt]=Ke[Q]=Ke[V]=Ke[_t]=Ke[bt]=Ke[W]=Ke[ct]=Ke[Tt]=Ke[Xt]=Ke[Qt]=Ke[U]=Ke[zt]=Ke[Ut]=Ke[kt]=Ke[ne]=!0,Ke[$t]=Ke[Mt]=Ke[ht]=!1;var z2={À:"A",Á:"A",Â:"A",Ã:"A",Ä:"A",Å:"A",à:"a",á:"a",â:"a",ã:"a",ä:"a",å:"a",Ç:"C",ç:"c",Ð:"D",ð:"d",È:"E",É:"E",Ê:"E",Ë:"E",è:"e",é:"e",ê:"e",ë:"e",Ì:"I",Í:"I",Î:"I",Ï:"I",ì:"i",í:"i",î:"i",ï:"i",Ñ:"N",ñ:"n",Ò:"O",Ó:"O",Ô:"O",Õ:"O",Ö:"O",Ø:"O",ò:"o",ó:"o",ô:"o",õ:"o",ö:"o",ø:"o",Ù:"U",Ú:"U",Û:"U",Ü:"U",ù:"u",ú:"u",û:"u",ü:"u",Ý:"Y",ý:"y",ÿ:"y",Æ:"Ae",æ:"ae",Þ:"Th",þ:"th",ß:"ss",Ā:"A",Ă:"A",Ą:"A",ā:"a",ă:"a",ą:"a",Ć:"C",Ĉ:"C",Ċ:"C",Č:"C",ć:"c",ĉ:"c",ċ:"c",č:"c",Ď:"D",Đ:"D",ď:"d",đ:"d",Ē:"E",Ĕ:"E",Ė:"E",Ę:"E",Ě:"E",ē:"e",ĕ:"e",ė:"e",ę:"e",ě:"e",Ĝ:"G",Ğ:"G",Ġ:"G",Ģ:"G",ĝ:"g",ğ:"g",ġ:"g",ģ:"g",Ĥ:"H",Ħ:"H",ĥ:"h",ħ:"h",Ĩ:"I",Ī:"I",Ĭ:"I",Į:"I",İ:"I",ĩ:"i",ī:"i",ĭ:"i",į:"i",ı:"i",Ĵ:"J",ĵ:"j",Ķ:"K",ķ:"k",ĸ:"k",Ĺ:"L",Ļ:"L",Ľ:"L",Ŀ:"L",Ł:"L",ĺ:"l",ļ:"l",ľ:"l",ŀ:"l",ł:"l",Ń:"N",Ņ:"N",Ň:"N",Ŋ:"N",ń:"n",ņ:"n",ň:"n",ŋ:"n",Ō:"O",Ŏ:"O",Ő:"O",ō:"o",ŏ:"o",ő:"o",Ŕ:"R",Ŗ:"R",Ř:"R",ŕ:"r",ŗ:"r",ř:"r",Ś:"S",Ŝ:"S",Ş:"S",Š:"S",ś:"s",ŝ:"s",ş:"s",š:"s",Ţ:"T",Ť:"T",Ŧ:"T",ţ:"t",ť:"t",ŧ:"t",Ũ:"U",Ū:"U",Ŭ:"U",Ů:"U",Ű:"U",Ų:"U",ũ:"u",ū:"u",ŭ:"u",ů:"u",ű:"u",ų:"u",Ŵ:"W",ŵ:"w",Ŷ:"Y",ŷ:"y",Ÿ:"Y",Ź:"Z",Ż:"Z",Ž:"Z",ź:"z",ż:"z",ž:"z",Ĳ:"IJ",ĳ:"ij",Œ:"Oe",œ:"oe",ŉ:"'n",ſ:"s"},k2={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;"},U2={"&amp;":"&","&lt;":"<","&gt;":">","&quot;":'"',"&#39;":"'"},N2={"\\":"\\","'":"'","\n":"n","\r":"r","\u2028":"u2028","\u2029":"u2029"},F2=parseFloat,B2=parseInt,Qy=typeof te=="object"&&te&&te.Object===Object&&te,H2=typeof self=="object"&&self&&self.Object===Object&&self,Bn=Qy||H2||Function("return this")(),Sp=t&&!t.nodeType&&t,mo=Sp&&!0&&s&&!s.nodeType&&s,t0=mo&&mo.exports===Sp,Ap=t0&&Qy.process,Ji=function(){try{var K=mo&&mo.require&&mo.require("util").types;return K||Ap&&Ap.binding&&Ap.binding("util")}catch{}}(),e0=Ji&&Ji.isArrayBuffer,n0=Ji&&Ji.isDate,i0=Ji&&Ji.isMap,s0=Ji&&Ji.isRegExp,r0=Ji&&Ji.isSet,o0=Ji&&Ji.isTypedArray;function Ci(K,gt,lt){switch(lt.length){case 0:return K.call(gt);case 1:return K.call(gt,lt[0]);case 2:return K.call(gt,lt[0],lt[1]);case 3:return K.call(gt,lt[0],lt[1],lt[2])}return K.apply(gt,lt)}function V2(K,gt,lt,Gt){for(var fe=-1,He=K==null?0:K.length;++fe<He;){var Ln=K[fe];gt(Gt,Ln,lt(Ln),K)}return Gt}function Qi(K,gt){for(var lt=-1,Gt=K==null?0:K.length;++lt<Gt&&gt(K[lt],lt,K)!==!1;);return K}function G2(K,gt){for(var lt=K==null?0:K.length;lt--&&gt(K[lt],lt,K)!==!1;);return K}function a0(K,gt){for(var lt=-1,Gt=K==null?0:K.length;++lt<Gt;)if(!gt(K[lt],lt,K))return!1;return!0}function Lr(K,gt){for(var lt=-1,Gt=K==null?0:K.length,fe=0,He=[];++lt<Gt;){var Ln=K[lt];gt(Ln,lt,K)&&(He[fe++]=Ln)}return He}function Fu(K,gt){var lt=K==null?0:K.length;return!!lt&&wa(K,gt,0)>-1}function Ep(K,gt,lt){for(var Gt=-1,fe=K==null?0:K.length;++Gt<fe;)if(lt(gt,K[Gt]))return!0;return!1}function an(K,gt){for(var lt=-1,Gt=K==null?0:K.length,fe=Array(Gt);++lt<Gt;)fe[lt]=gt(K[lt],lt,K);return fe}function Dr(K,gt){for(var lt=-1,Gt=gt.length,fe=K.length;++lt<Gt;)K[fe+lt]=gt[lt];return K}function Tp(K,gt,lt,Gt){var fe=-1,He=K==null?0:K.length;for(Gt&&He&&(lt=K[++fe]);++fe<He;)lt=gt(lt,K[fe],fe,K);return lt}function q2(K,gt,lt,Gt){var fe=K==null?0:K.length;for(Gt&&fe&&(lt=K[--fe]);fe--;)lt=gt(lt,K[fe],fe,K);return lt}function Cp(K,gt){for(var lt=-1,Gt=K==null?0:K.length;++lt<Gt;)if(gt(K[lt],lt,K))return!0;return!1}var W2=Pp("length");function $2(K){return K.split("")}function X2(K){return K.match(Uu)||[]}function l0(K,gt,lt){var Gt;return lt(K,function(fe,He,Ln){if(gt(fe,He,Ln))return Gt=He,!1}),Gt}function Bu(K,gt,lt,Gt){for(var fe=K.length,He=lt+(Gt?1:-1);Gt?He--:++He<fe;)if(gt(K[He],He,K))return He;return-1}function wa(K,gt,lt){return gt===gt?rP(K,gt,lt):Bu(K,c0,lt)}function j2(K,gt,lt,Gt){for(var fe=lt-1,He=K.length;++fe<He;)if(Gt(K[fe],gt))return fe;return-1}function c0(K){return K!==K}function u0(K,gt){var lt=K==null?0:K.length;return lt?Lp(K,gt)/lt:dt}function Pp(K){return function(gt){return gt==null?e:gt[K]}}function Rp(K){return function(gt){return K==null?e:K[gt]}}function h0(K,gt,lt,Gt,fe){return fe(K,function(He,Ln,je){lt=Gt?(Gt=!1,He):gt(lt,He,Ln,je)}),lt}function Y2(K,gt){var lt=K.length;for(K.sort(gt);lt--;)K[lt]=K[lt].value;return K}function Lp(K,gt){for(var lt,Gt=-1,fe=K.length;++Gt<fe;){var He=gt(K[Gt]);He!==e&&(lt=lt===e?He:lt+He)}return lt}function Dp(K,gt){for(var lt=-1,Gt=Array(K);++lt<K;)Gt[lt]=gt(lt);return Gt}function Z2(K,gt){return an(gt,function(lt){return[lt,K[lt]]})}function f0(K){return K&&K.slice(0,g0(K)+1).replace(_a,"")}function Pi(K){return function(gt){return K(gt)}}function Ip(K,gt){return an(gt,function(lt){return K[lt]})}function Jl(K,gt){return K.has(gt)}function d0(K,gt){for(var lt=-1,Gt=K.length;++lt<Gt&&wa(gt,K[lt],0)>-1;);return lt}function p0(K,gt){for(var lt=K.length;lt--&&wa(gt,K[lt],0)>-1;);return lt}function K2(K,gt){for(var lt=K.length,Gt=0;lt--;)K[lt]===gt&&++Gt;return Gt}var J2=Rp(z2),Q2=Rp(k2);function tP(K){return"\\"+N2[K]}function eP(K,gt){return K==null?e:K[gt]}function Ma(K){return L2.test(K)}function nP(K){return D2.test(K)}function iP(K){for(var gt,lt=[];!(gt=K.next()).done;)lt.push(gt.value);return lt}function Op(K){var gt=-1,lt=Array(K.size);return K.forEach(function(Gt,fe){lt[++gt]=[fe,Gt]}),lt}function m0(K,gt){return function(lt){return K(gt(lt))}}function Ir(K,gt){for(var lt=-1,Gt=K.length,fe=0,He=[];++lt<Gt;){var Ln=K[lt];(Ln===gt||Ln===h)&&(K[lt]=h,He[fe++]=lt)}return He}function Hu(K){var gt=-1,lt=Array(K.size);return K.forEach(function(Gt){lt[++gt]=Gt}),lt}function sP(K){var gt=-1,lt=Array(K.size);return K.forEach(function(Gt){lt[++gt]=[Gt,Gt]}),lt}function rP(K,gt,lt){for(var Gt=lt-1,fe=K.length;++Gt<fe;)if(K[Gt]===gt)return Gt;return-1}function oP(K,gt,lt){for(var Gt=lt+1;Gt--;)if(K[Gt]===gt)return Gt;return Gt}function Sa(K){return Ma(K)?lP(K):W2(K)}function fs(K){return Ma(K)?cP(K):$2(K)}function g0(K){for(var gt=K.length;gt--&&gp.test(K.charAt(gt)););return gt}var aP=Rp(U2);function lP(K){for(var gt=Mp.lastIndex=0;Mp.test(K);)++gt;return gt}function cP(K){return K.match(Mp)||[]}function uP(K){return K.match(R2)||[]}var hP=function K(gt){gt=gt==null?Bn:Aa.defaults(Bn.Object(),gt,Aa.pick(Bn,I2));var lt=gt.Array,Gt=gt.Date,fe=gt.Error,He=gt.Function,Ln=gt.Math,je=gt.Object,zp=gt.RegExp,fP=gt.String,ts=gt.TypeError,Vu=lt.prototype,dP=He.prototype,Ea=je.prototype,Gu=gt["__core-js_shared__"],qu=dP.toString,qe=Ea.hasOwnProperty,pP=0,v0=function(){var u=/[^.]+$/.exec(Gu&&Gu.keys&&Gu.keys.IE_PROTO||"");return u?"Symbol(src)_1."+u:""}(),Wu=Ea.toString,mP=qu.call(je),gP=Bn._,vP=zp("^"+qu.call(qe).replace(hs,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$"),$u=t0?gt.Buffer:e,Or=gt.Symbol,Xu=gt.Uint8Array,_0=$u?$u.allocUnsafe:e,ju=m0(je.getPrototypeOf,je),y0=je.create,x0=Ea.propertyIsEnumerable,Yu=Vu.splice,b0=Or?Or.isConcatSpreadable:e,Ql=Or?Or.iterator:e,go=Or?Or.toStringTag:e,Zu=function(){try{var u=bo(je,"defineProperty");return u({},"",{}),u}catch{}}(),_P=gt.clearTimeout!==Bn.clearTimeout&&gt.clearTimeout,yP=Gt&&Gt.now!==Bn.Date.now&&Gt.now,xP=gt.setTimeout!==Bn.setTimeout&&gt.setTimeout,Ku=Ln.ceil,Ju=Ln.floor,kp=je.getOwnPropertySymbols,bP=$u?$u.isBuffer:e,w0=gt.isFinite,wP=Vu.join,MP=m0(je.keys,je),Dn=Ln.max,Wn=Ln.min,SP=Gt.now,AP=gt.parseInt,M0=Ln.random,EP=Vu.reverse,Up=bo(gt,"DataView"),tc=bo(gt,"Map"),Np=bo(gt,"Promise"),Ta=bo(gt,"Set"),ec=bo(gt,"WeakMap"),nc=bo(je,"create"),Qu=ec&&new ec,Ca={},TP=wo(Up),CP=wo(tc),PP=wo(Np),RP=wo(Ta),LP=wo(ec),th=Or?Or.prototype:e,ic=th?th.valueOf:e,S0=th?th.toString:e;function O(u){if(mn(u)&&!pe(u)&&!(u instanceof Re)){if(u instanceof es)return u;if(qe.call(u,"__wrapped__"))return Ax(u)}return new es(u)}var Pa=function(){function u(){}return function(p){if(!hn(p))return{};if(y0)return y0(p);u.prototype=p;var x=new u;return u.prototype=e,x}}();function eh(){}function es(u,p){this.__wrapped__=u,this.__actions__=[],this.__chain__=!!p,this.__index__=0,this.__values__=e}O.templateSettings={escape:Be,evaluate:Qe,interpolate:Ti,variable:"",imports:{_:O}},O.prototype=eh.prototype,O.prototype.constructor=O,es.prototype=Pa(eh.prototype),es.prototype.constructor=es;function Re(u){this.__wrapped__=u,this.__actions__=[],this.__dir__=1,this.__filtered__=!1,this.__iteratees__=[],this.__takeCount__=nt,this.__views__=[]}function DP(){var u=new Re(this.__wrapped__);return u.__actions__=ui(this.__actions__),u.__dir__=this.__dir__,u.__filtered__=this.__filtered__,u.__iteratees__=ui(this.__iteratees__),u.__takeCount__=this.__takeCount__,u.__views__=ui(this.__views__),u}function IP(){if(this.__filtered__){var u=new Re(this);u.__dir__=-1,u.__filtered__=!0}else u=this.clone(),u.__dir__*=-1;return u}function OP(){var u=this.__wrapped__.value(),p=this.__dir__,x=pe(u),E=p<0,R=x?u.length:0,z=$R(0,R,this.__views__),q=z.start,j=z.end,it=j-q,yt=E?j:q-1,xt=this.__iteratees__,At=xt.length,Bt=0,Yt=Wn(it,this.__takeCount__);if(!x||!E&&R==it&&Yt==it)return j0(u,this.__actions__);var oe=[];t:for(;it--&&Bt<Yt;){yt+=p;for(var Me=-1,ae=u[yt];++Me<At;){var Ce=xt[Me],Le=Ce.iteratee,Di=Ce.type,ei=Le(ae);if(Di==I)ae=ei;else if(!ei){if(Di==G)continue t;break t}}oe[Bt++]=ae}return oe}Re.prototype=Pa(eh.prototype),Re.prototype.constructor=Re;function vo(u){var p=-1,x=u==null?0:u.length;for(this.clear();++p<x;){var E=u[p];this.set(E[0],E[1])}}function zP(){this.__data__=nc?nc(null):{},this.size=0}function kP(u){var p=this.has(u)&&delete this.__data__[u];return this.size-=p?1:0,p}function UP(u){var p=this.__data__;if(nc){var x=p[u];return x===l?e:x}return qe.call(p,u)?p[u]:e}function NP(u){var p=this.__data__;return nc?p[u]!==e:qe.call(p,u)}function FP(u,p){var x=this.__data__;return this.size+=this.has(u)?0:1,x[u]=nc&&p===e?l:p,this}vo.prototype.clear=zP,vo.prototype.delete=kP,vo.prototype.get=UP,vo.prototype.has=NP,vo.prototype.set=FP;function Js(u){var p=-1,x=u==null?0:u.length;for(this.clear();++p<x;){var E=u[p];this.set(E[0],E[1])}}function BP(){this.__data__=[],this.size=0}function HP(u){var p=this.__data__,x=nh(p,u);if(x<0)return!1;var E=p.length-1;return x==E?p.pop():Yu.call(p,x,1),--this.size,!0}function VP(u){var p=this.__data__,x=nh(p,u);return x<0?e:p[x][1]}function GP(u){return nh(this.__data__,u)>-1}function qP(u,p){var x=this.__data__,E=nh(x,u);return E<0?(++this.size,x.push([u,p])):x[E][1]=p,this}Js.prototype.clear=BP,Js.prototype.delete=HP,Js.prototype.get=VP,Js.prototype.has=GP,Js.prototype.set=qP;function Qs(u){var p=-1,x=u==null?0:u.length;for(this.clear();++p<x;){var E=u[p];this.set(E[0],E[1])}}function WP(){this.size=0,this.__data__={hash:new vo,map:new(tc||Js),string:new vo}}function $P(u){var p=ph(this,u).delete(u);return this.size-=p?1:0,p}function XP(u){return ph(this,u).get(u)}function jP(u){return ph(this,u).has(u)}function YP(u,p){var x=ph(this,u),E=x.size;return x.set(u,p),this.size+=x.size==E?0:1,this}Qs.prototype.clear=WP,Qs.prototype.delete=$P,Qs.prototype.get=XP,Qs.prototype.has=jP,Qs.prototype.set=YP;function _o(u){var p=-1,x=u==null?0:u.length;for(this.__data__=new Qs;++p<x;)this.add(u[p])}function ZP(u){return this.__data__.set(u,l),this}function KP(u){return this.__data__.has(u)}_o.prototype.add=_o.prototype.push=ZP,_o.prototype.has=KP;function ds(u){var p=this.__data__=new Js(u);this.size=p.size}function JP(){this.__data__=new Js,this.size=0}function QP(u){var p=this.__data__,x=p.delete(u);return this.size=p.size,x}function tR(u){return this.__data__.get(u)}function eR(u){return this.__data__.has(u)}function nR(u,p){var x=this.__data__;if(x instanceof Js){var E=x.__data__;if(!tc||E.length<i-1)return E.push([u,p]),this.size=++x.size,this;x=this.__data__=new Qs(E)}return x.set(u,p),this.size=x.size,this}ds.prototype.clear=JP,ds.prototype.delete=QP,ds.prototype.get=tR,ds.prototype.has=eR,ds.prototype.set=nR;function A0(u,p){var x=pe(u),E=!x&&Mo(u),R=!x&&!E&&Fr(u),z=!x&&!E&&!R&&Ia(u),q=x||E||R||z,j=q?Dp(u.length,fP):[],it=j.length;for(var yt in u)(p||qe.call(u,yt))&&!(q&&(yt=="length"||R&&(yt=="offset"||yt=="parent")||z&&(yt=="buffer"||yt=="byteLength"||yt=="byteOffset")||ir(yt,it)))&&j.push(yt);return j}function E0(u){var p=u.length;return p?u[Yp(0,p-1)]:e}function iR(u,p){return mh(ui(u),yo(p,0,u.length))}function sR(u){return mh(ui(u))}function Fp(u,p,x){(x!==e&&!ps(u[p],x)||x===e&&!(p in u))&&tr(u,p,x)}function sc(u,p,x){var E=u[p];(!(qe.call(u,p)&&ps(E,x))||x===e&&!(p in u))&&tr(u,p,x)}function nh(u,p){for(var x=u.length;x--;)if(ps(u[x][0],p))return x;return-1}function rR(u,p,x,E){return zr(u,function(R,z,q){p(E,R,x(R),q)}),E}function T0(u,p){return u&&Os(p,kn(p),u)}function oR(u,p){return u&&Os(p,fi(p),u)}function tr(u,p,x){p=="__proto__"&&Zu?Zu(u,p,{configurable:!0,enumerable:!0,value:x,writable:!0}):u[p]=x}function Bp(u,p){for(var x=-1,E=p.length,R=lt(E),z=u==null;++x<E;)R[x]=z?e:xm(u,p[x]);return R}function yo(u,p,x){return u===u&&(x!==e&&(u=u<=x?u:x),p!==e&&(u=u>=p?u:p)),u}function ns(u,p,x,E,R,z){var q,j=p&f,it=p&d,yt=p&m;if(x&&(q=R?x(u,E,R,z):x(u)),q!==e)return q;if(!hn(u))return u;var xt=pe(u);if(xt){if(q=jR(u),!j)return ui(u,q)}else{var At=$n(u),Bt=At==Mt||At==X;if(Fr(u))return K0(u,j);if(At==ct||At==It||Bt&&!R){if(q=it||Bt?{}:gx(u),!j)return it?UR(u,oR(q,u)):kR(u,T0(q,u))}else{if(!Ke[At])return R?u:{};q=YR(u,At,j)}}z||(z=new ds);var Yt=z.get(u);if(Yt)return Yt;z.set(u,q),Wx(u)?u.forEach(function(ae){q.add(ns(ae,p,x,ae,u,z))}):Gx(u)&&u.forEach(function(ae,Ce){q.set(Ce,ns(ae,p,x,Ce,u,z))});var oe=yt?it?om:rm:it?fi:kn,Me=xt?e:oe(u);return Qi(Me||u,function(ae,Ce){Me&&(Ce=ae,ae=u[Ce]),sc(q,Ce,ns(ae,p,x,Ce,u,z))}),q}function aR(u){var p=kn(u);return function(x){return C0(x,u,p)}}function C0(u,p,x){var E=x.length;if(u==null)return!E;for(u=je(u);E--;){var R=x[E],z=p[R],q=u[R];if(q===e&&!(R in u)||!z(q))return!1}return!0}function P0(u,p,x){if(typeof u!="function")throw new ts(o);return hc(function(){u.apply(e,x)},p)}function rc(u,p,x,E){var R=-1,z=Fu,q=!0,j=u.length,it=[],yt=p.length;if(!j)return it;x&&(p=an(p,Pi(x))),E?(z=Ep,q=!1):p.length>=i&&(z=Jl,q=!1,p=new _o(p));t:for(;++R<j;){var xt=u[R],At=x==null?xt:x(xt);if(xt=E||xt!==0?xt:0,q&&At===At){for(var Bt=yt;Bt--;)if(p[Bt]===At)continue t;it.push(xt)}else z(p,At,E)||it.push(xt)}return it}var zr=nx(Is),R0=nx(Vp,!0);function lR(u,p){var x=!0;return zr(u,function(E,R,z){return x=!!p(E,R,z),x}),x}function ih(u,p,x){for(var E=-1,R=u.length;++E<R;){var z=u[E],q=p(z);if(q!=null&&(j===e?q===q&&!Li(q):x(q,j)))var j=q,it=z}return it}function cR(u,p,x,E){var R=u.length;for(x=xe(x),x<0&&(x=-x>R?0:R+x),E=E===e||E>R?R:xe(E),E<0&&(E+=R),E=x>E?0:Xx(E);x<E;)u[x++]=p;return u}function L0(u,p){var x=[];return zr(u,function(E,R,z){p(E,R,z)&&x.push(E)}),x}function Hn(u,p,x,E,R){var z=-1,q=u.length;for(x||(x=KR),R||(R=[]);++z<q;){var j=u[z];p>0&&x(j)?p>1?Hn(j,p-1,x,E,R):Dr(R,j):E||(R[R.length]=j)}return R}var Hp=ix(),D0=ix(!0);function Is(u,p){return u&&Hp(u,p,kn)}function Vp(u,p){return u&&D0(u,p,kn)}function sh(u,p){return Lr(p,function(x){return sr(u[x])})}function xo(u,p){p=Ur(p,u);for(var x=0,E=p.length;u!=null&&x<E;)u=u[zs(p[x++])];return x&&x==E?u:e}function I0(u,p,x){var E=p(u);return pe(u)?E:Dr(E,x(u))}function Qn(u){return u==null?u===e?k:st:go&&go in je(u)?WR(u):sL(u)}function Gp(u,p){return u>p}function uR(u,p){return u!=null&&qe.call(u,p)}function hR(u,p){return u!=null&&p in je(u)}function fR(u,p,x){return u>=Wn(p,x)&&u<Dn(p,x)}function qp(u,p,x){for(var E=x?Ep:Fu,R=u[0].length,z=u.length,q=z,j=lt(z),it=1/0,yt=[];q--;){var xt=u[q];q&&p&&(xt=an(xt,Pi(p))),it=Wn(xt.length,it),j[q]=!x&&(p||R>=120&&xt.length>=120)?new _o(q&&xt):e}xt=u[0];var At=-1,Bt=j[0];t:for(;++At<R&&yt.length<it;){var Yt=xt[At],oe=p?p(Yt):Yt;if(Yt=x||Yt!==0?Yt:0,!(Bt?Jl(Bt,oe):E(yt,oe,x))){for(q=z;--q;){var Me=j[q];if(!(Me?Jl(Me,oe):E(u[q],oe,x)))continue t}Bt&&Bt.push(oe),yt.push(Yt)}}return yt}function dR(u,p,x,E){return Is(u,function(R,z,q){p(E,x(R),z,q)}),E}function oc(u,p,x){p=Ur(p,u),u=xx(u,p);var E=u==null?u:u[zs(ss(p))];return E==null?e:Ci(E,u,x)}function O0(u){return mn(u)&&Qn(u)==It}function pR(u){return mn(u)&&Qn(u)==Et}function mR(u){return mn(u)&&Qn(u)==ee}function ac(u,p,x,E,R){return u===p?!0:u==null||p==null||!mn(u)&&!mn(p)?u!==u&&p!==p:gR(u,p,x,E,ac,R)}function gR(u,p,x,E,R,z){var q=pe(u),j=pe(p),it=q?Kt:$n(u),yt=j?Kt:$n(p);it=it==It?ct:it,yt=yt==It?ct:yt;var xt=it==ct,At=yt==ct,Bt=it==yt;if(Bt&&Fr(u)){if(!Fr(p))return!1;q=!0,xt=!1}if(Bt&&!xt)return z||(z=new ds),q||Ia(u)?dx(u,p,x,E,R,z):GR(u,p,it,x,E,R,z);if(!(x&g)){var Yt=xt&&qe.call(u,"__wrapped__"),oe=At&&qe.call(p,"__wrapped__");if(Yt||oe){var Me=Yt?u.value():u,ae=oe?p.value():p;return z||(z=new ds),R(Me,ae,x,E,z)}}return Bt?(z||(z=new ds),qR(u,p,x,E,R,z)):!1}function vR(u){return mn(u)&&$n(u)==bt}function Wp(u,p,x,E){var R=x.length,z=R,q=!E;if(u==null)return!z;for(u=je(u);R--;){var j=x[R];if(q&&j[2]?j[1]!==u[j[0]]:!(j[0]in u))return!1}for(;++R<z;){j=x[R];var it=j[0],yt=u[it],xt=j[1];if(q&&j[2]){if(yt===e&&!(it in u))return!1}else{var At=new ds;if(E)var Bt=E(yt,xt,it,u,p,At);if(!(Bt===e?ac(xt,yt,g|y,E,At):Bt))return!1}}return!0}function z0(u){if(!hn(u)||QR(u))return!1;var p=sr(u)?vP:rt;return p.test(wo(u))}function _R(u){return mn(u)&&Qn(u)==Tt}function yR(u){return mn(u)&&$n(u)==Xt}function xR(u){return mn(u)&&bh(u.length)&&!!tn[Qn(u)]}function k0(u){return typeof u=="function"?u:u==null?di:typeof u=="object"?pe(u)?F0(u[0],u[1]):N0(u):sb(u)}function $p(u){if(!uc(u))return MP(u);var p=[];for(var x in je(u))qe.call(u,x)&&x!="constructor"&&p.push(x);return p}function bR(u){if(!hn(u))return iL(u);var p=uc(u),x=[];for(var E in u)E=="constructor"&&(p||!qe.call(u,E))||x.push(E);return x}function Xp(u,p){return u<p}function U0(u,p){var x=-1,E=hi(u)?lt(u.length):[];return zr(u,function(R,z,q){E[++x]=p(R,z,q)}),E}function N0(u){var p=lm(u);return p.length==1&&p[0][2]?_x(p[0][0],p[0][1]):function(x){return x===u||Wp(x,u,p)}}function F0(u,p){return um(u)&&vx(p)?_x(zs(u),p):function(x){var E=xm(x,u);return E===e&&E===p?bm(x,u):ac(p,E,g|y)}}function rh(u,p,x,E,R){u!==p&&Hp(p,function(z,q){if(R||(R=new ds),hn(z))wR(u,p,q,x,rh,E,R);else{var j=E?E(fm(u,q),z,q+"",u,p,R):e;j===e&&(j=z),Fp(u,q,j)}},fi)}function wR(u,p,x,E,R,z,q){var j=fm(u,x),it=fm(p,x),yt=q.get(it);if(yt){Fp(u,x,yt);return}var xt=z?z(j,it,x+"",u,p,q):e,At=xt===e;if(At){var Bt=pe(it),Yt=!Bt&&Fr(it),oe=!Bt&&!Yt&&Ia(it);xt=it,Bt||Yt||oe?pe(j)?xt=j:wn(j)?xt=ui(j):Yt?(At=!1,xt=K0(it,!0)):oe?(At=!1,xt=J0(it,!0)):xt=[]:fc(it)||Mo(it)?(xt=j,Mo(j)?xt=jx(j):(!hn(j)||sr(j))&&(xt=gx(it))):At=!1}At&&(q.set(it,xt),R(xt,it,E,z,q),q.delete(it)),Fp(u,x,xt)}function B0(u,p){var x=u.length;if(x)return p+=p<0?x:0,ir(p,x)?u[p]:e}function H0(u,p,x){p.length?p=an(p,function(z){return pe(z)?function(q){return xo(q,z.length===1?z[0]:z)}:z}):p=[di];var E=-1;p=an(p,Pi(se()));var R=U0(u,function(z,q,j){var it=an(p,function(yt){return yt(z)});return{criteria:it,index:++E,value:z}});return Y2(R,function(z,q){return zR(z,q,x)})}function MR(u,p){return V0(u,p,function(x,E){return bm(u,E)})}function V0(u,p,x){for(var E=-1,R=p.length,z={};++E<R;){var q=p[E],j=xo(u,q);x(j,q)&&lc(z,Ur(q,u),j)}return z}function SR(u){return function(p){return xo(p,u)}}function jp(u,p,x,E){var R=E?j2:wa,z=-1,q=p.length,j=u;for(u===p&&(p=ui(p)),x&&(j=an(u,Pi(x)));++z<q;)for(var it=0,yt=p[z],xt=x?x(yt):yt;(it=R(j,xt,it,E))>-1;)j!==u&&Yu.call(j,it,1),Yu.call(u,it,1);return u}function G0(u,p){for(var x=u?p.length:0,E=x-1;x--;){var R=p[x];if(x==E||R!==z){var z=R;ir(R)?Yu.call(u,R,1):Jp(u,R)}}return u}function Yp(u,p){return u+Ju(M0()*(p-u+1))}function AR(u,p,x,E){for(var R=-1,z=Dn(Ku((p-u)/(x||1)),0),q=lt(z);z--;)q[E?z:++R]=u,u+=x;return q}function Zp(u,p){var x="";if(!u||p<1||p>J)return x;do p%2&&(x+=u),p=Ju(p/2),p&&(u+=u);while(p);return x}function Ee(u,p){return dm(yx(u,p,di),u+"")}function ER(u){return E0(Oa(u))}function TR(u,p){var x=Oa(u);return mh(x,yo(p,0,x.length))}function lc(u,p,x,E){if(!hn(u))return u;p=Ur(p,u);for(var R=-1,z=p.length,q=z-1,j=u;j!=null&&++R<z;){var it=zs(p[R]),yt=x;if(it==="__proto__"||it==="constructor"||it==="prototype")return u;if(R!=q){var xt=j[it];yt=E?E(xt,it,j):e,yt===e&&(yt=hn(xt)?xt:ir(p[R+1])?[]:{})}sc(j,it,yt),j=j[it]}return u}var q0=Qu?function(u,p){return Qu.set(u,p),u}:di,CR=Zu?function(u,p){return Zu(u,"toString",{configurable:!0,enumerable:!1,value:Mm(p),writable:!0})}:di;function PR(u){return mh(Oa(u))}function is(u,p,x){var E=-1,R=u.length;p<0&&(p=-p>R?0:R+p),x=x>R?R:x,x<0&&(x+=R),R=p>x?0:x-p>>>0,p>>>=0;for(var z=lt(R);++E<R;)z[E]=u[E+p];return z}function RR(u,p){var x;return zr(u,function(E,R,z){return x=p(E,R,z),!x}),!!x}function oh(u,p,x){var E=0,R=u==null?E:u.length;if(typeof p=="number"&&p===p&&R<=Lt){for(;E<R;){var z=E+R>>>1,q=u[z];q!==null&&!Li(q)&&(x?q<=p:q<p)?E=z+1:R=z}return R}return Kp(u,p,di,x)}function Kp(u,p,x,E){var R=0,z=u==null?0:u.length;if(z===0)return 0;p=x(p);for(var q=p!==p,j=p===null,it=Li(p),yt=p===e;R<z;){var xt=Ju((R+z)/2),At=x(u[xt]),Bt=At!==e,Yt=At===null,oe=At===At,Me=Li(At);if(q)var ae=E||oe;else yt?ae=oe&&(E||Bt):j?ae=oe&&Bt&&(E||!Yt):it?ae=oe&&Bt&&!Yt&&(E||!Me):Yt||Me?ae=!1:ae=E?At<=p:At<p;ae?R=xt+1:z=xt}return Wn(z,ft)}function W0(u,p){for(var x=-1,E=u.length,R=0,z=[];++x<E;){var q=u[x],j=p?p(q):q;if(!x||!ps(j,it)){var it=j;z[R++]=q===0?0:q}}return z}function $0(u){return typeof u=="number"?u:Li(u)?dt:+u}function Ri(u){if(typeof u=="string")return u;if(pe(u))return an(u,Ri)+"";if(Li(u))return S0?S0.call(u):"";var p=u+"";return p=="0"&&1/u==-Y?"-0":p}function kr(u,p,x){var E=-1,R=Fu,z=u.length,q=!0,j=[],it=j;if(x)q=!1,R=Ep;else if(z>=i){var yt=p?null:HR(u);if(yt)return Hu(yt);q=!1,R=Jl,it=new _o}else it=p?[]:j;t:for(;++E<z;){var xt=u[E],At=p?p(xt):xt;if(xt=x||xt!==0?xt:0,q&&At===At){for(var Bt=it.length;Bt--;)if(it[Bt]===At)continue t;p&&it.push(At),j.push(xt)}else R(it,At,x)||(it!==j&&it.push(At),j.push(xt))}return j}function Jp(u,p){return p=Ur(p,u),u=xx(u,p),u==null||delete u[zs(ss(p))]}function X0(u,p,x,E){return lc(u,p,x(xo(u,p)),E)}function ah(u,p,x,E){for(var R=u.length,z=E?R:-1;(E?z--:++z<R)&&p(u[z],z,u););return x?is(u,E?0:z,E?z+1:R):is(u,E?z+1:0,E?R:z)}function j0(u,p){var x=u;return x instanceof Re&&(x=x.value()),Tp(p,function(E,R){return R.func.apply(R.thisArg,Dr([E],R.args))},x)}function Qp(u,p,x){var E=u.length;if(E<2)return E?kr(u[0]):[];for(var R=-1,z=lt(E);++R<E;)for(var q=u[R],j=-1;++j<E;)j!=R&&(z[R]=rc(z[R]||q,u[j],p,x));return kr(Hn(z,1),p,x)}function Y0(u,p,x){for(var E=-1,R=u.length,z=p.length,q={};++E<R;){var j=E<z?p[E]:e;x(q,u[E],j)}return q}function tm(u){return wn(u)?u:[]}function em(u){return typeof u=="function"?u:di}function Ur(u,p){return pe(u)?u:um(u,p)?[u]:Sx(Ge(u))}var LR=Ee;function Nr(u,p,x){var E=u.length;return x=x===e?E:x,!p&&x>=E?u:is(u,p,x)}var Z0=_P||function(u){return Bn.clearTimeout(u)};function K0(u,p){if(p)return u.slice();var x=u.length,E=_0?_0(x):new u.constructor(x);return u.copy(E),E}function nm(u){var p=new u.constructor(u.byteLength);return new Xu(p).set(new Xu(u)),p}function DR(u,p){var x=p?nm(u.buffer):u.buffer;return new u.constructor(x,u.byteOffset,u.byteLength)}function IR(u){var p=new u.constructor(u.source,F.exec(u));return p.lastIndex=u.lastIndex,p}function OR(u){return ic?je(ic.call(u)):{}}function J0(u,p){var x=p?nm(u.buffer):u.buffer;return new u.constructor(x,u.byteOffset,u.length)}function Q0(u,p){if(u!==p){var x=u!==e,E=u===null,R=u===u,z=Li(u),q=p!==e,j=p===null,it=p===p,yt=Li(p);if(!j&&!yt&&!z&&u>p||z&&q&&it&&!j&&!yt||E&&q&&it||!x&&it||!R)return 1;if(!E&&!z&&!yt&&u<p||yt&&x&&R&&!E&&!z||j&&x&&R||!q&&R||!it)return-1}return 0}function zR(u,p,x){for(var E=-1,R=u.criteria,z=p.criteria,q=R.length,j=x.length;++E<q;){var it=Q0(R[E],z[E]);if(it){if(E>=j)return it;var yt=x[E];return it*(yt=="desc"?-1:1)}}return u.index-p.index}function tx(u,p,x,E){for(var R=-1,z=u.length,q=x.length,j=-1,it=p.length,yt=Dn(z-q,0),xt=lt(it+yt),At=!E;++j<it;)xt[j]=p[j];for(;++R<q;)(At||R<z)&&(xt[x[R]]=u[R]);for(;yt--;)xt[j++]=u[R++];return xt}function ex(u,p,x,E){for(var R=-1,z=u.length,q=-1,j=x.length,it=-1,yt=p.length,xt=Dn(z-j,0),At=lt(xt+yt),Bt=!E;++R<xt;)At[R]=u[R];for(var Yt=R;++it<yt;)At[Yt+it]=p[it];for(;++q<j;)(Bt||R<z)&&(At[Yt+x[q]]=u[R++]);return At}function ui(u,p){var x=-1,E=u.length;for(p||(p=lt(E));++x<E;)p[x]=u[x];return p}function Os(u,p,x,E){var R=!x;x||(x={});for(var z=-1,q=p.length;++z<q;){var j=p[z],it=E?E(x[j],u[j],j,x,u):e;it===e&&(it=u[j]),R?tr(x,j,it):sc(x,j,it)}return x}function kR(u,p){return Os(u,cm(u),p)}function UR(u,p){return Os(u,px(u),p)}function lh(u,p){return function(x,E){var R=pe(x)?V2:rR,z=p?p():{};return R(x,u,se(E,2),z)}}function Ra(u){return Ee(function(p,x){var E=-1,R=x.length,z=R>1?x[R-1]:e,q=R>2?x[2]:e;for(z=u.length>3&&typeof z=="function"?(R--,z):e,q&&ti(x[0],x[1],q)&&(z=R<3?e:z,R=1),p=je(p);++E<R;){var j=x[E];j&&u(p,j,E,z)}return p})}function nx(u,p){return function(x,E){if(x==null)return x;if(!hi(x))return u(x,E);for(var R=x.length,z=p?R:-1,q=je(x);(p?z--:++z<R)&&E(q[z],z,q)!==!1;);return x}}function ix(u){return function(p,x,E){for(var R=-1,z=je(p),q=E(p),j=q.length;j--;){var it=q[u?j:++R];if(x(z[it],it,z)===!1)break}return p}}function NR(u,p,x){var E=p&_,R=cc(u);function z(){var q=this&&this!==Bn&&this instanceof z?R:u;return q.apply(E?x:this,arguments)}return z}function sx(u){return function(p){p=Ge(p);var x=Ma(p)?fs(p):e,E=x?x[0]:p.charAt(0),R=x?Nr(x,1).join(""):p.slice(1);return E[u]()+R}}function La(u){return function(p){return Tp(nb(eb(p).replace(C2,"")),u,"")}}function cc(u){return function(){var p=arguments;switch(p.length){case 0:return new u;case 1:return new u(p[0]);case 2:return new u(p[0],p[1]);case 3:return new u(p[0],p[1],p[2]);case 4:return new u(p[0],p[1],p[2],p[3]);case 5:return new u(p[0],p[1],p[2],p[3],p[4]);case 6:return new u(p[0],p[1],p[2],p[3],p[4],p[5]);case 7:return new u(p[0],p[1],p[2],p[3],p[4],p[5],p[6])}var x=Pa(u.prototype),E=u.apply(x,p);return hn(E)?E:x}}function FR(u,p,x){var E=cc(u);function R(){for(var z=arguments.length,q=lt(z),j=z,it=Da(R);j--;)q[j]=arguments[j];var yt=z<3&&q[0]!==it&&q[z-1]!==it?[]:Ir(q,it);if(z-=yt.length,z<x)return cx(u,p,ch,R.placeholder,e,q,yt,e,e,x-z);var xt=this&&this!==Bn&&this instanceof R?E:u;return Ci(xt,this,q)}return R}function rx(u){return function(p,x,E){var R=je(p);if(!hi(p)){var z=se(x,3);p=kn(p),x=function(j){return z(R[j],j,R)}}var q=u(p,x,E);return q>-1?R[z?p[q]:q]:e}}function ox(u){return nr(function(p){var x=p.length,E=x,R=es.prototype.thru;for(u&&p.reverse();E--;){var z=p[E];if(typeof z!="function")throw new ts(o);if(R&&!q&&dh(z)=="wrapper")var q=new es([],!0)}for(E=q?E:x;++E<x;){z=p[E];var j=dh(z),it=j=="wrapper"?am(z):e;it&&hm(it[0])&&it[1]==(P|b|A|C)&&!it[4].length&&it[9]==1?q=q[dh(it[0])].apply(q,it[3]):q=z.length==1&&hm(z)?q[j]():q.thru(z)}return function(){var yt=arguments,xt=yt[0];if(q&&yt.length==1&&pe(xt))return q.plant(xt).value();for(var At=0,Bt=x?p[At].apply(this,yt):xt;++At<x;)Bt=p[At].call(this,Bt);return Bt}})}function ch(u,p,x,E,R,z,q,j,it,yt){var xt=p&P,At=p&_,Bt=p&v,Yt=p&(b|M),oe=p&S,Me=Bt?e:cc(u);function ae(){for(var Ce=arguments.length,Le=lt(Ce),Di=Ce;Di--;)Le[Di]=arguments[Di];if(Yt)var ei=Da(ae),Ii=K2(Le,ei);if(E&&(Le=tx(Le,E,R,Yt)),z&&(Le=ex(Le,z,q,Yt)),Ce-=Ii,Yt&&Ce<yt){var Mn=Ir(Le,ei);return cx(u,p,ch,ae.placeholder,x,Le,Mn,j,it,yt-Ce)}var ms=At?x:this,or=Bt?ms[u]:u;return Ce=Le.length,j?Le=rL(Le,j):oe&&Ce>1&&Le.reverse(),xt&&it<Ce&&(Le.length=it),this&&this!==Bn&&this instanceof ae&&(or=Me||cc(or)),or.apply(ms,Le)}return ae}function ax(u,p){return function(x,E){return dR(x,u,p(E),{})}}function uh(u,p){return function(x,E){var R;if(x===e&&E===e)return p;if(x!==e&&(R=x),E!==e){if(R===e)return E;typeof x=="string"||typeof E=="string"?(x=Ri(x),E=Ri(E)):(x=$0(x),E=$0(E)),R=u(x,E)}return R}}function im(u){return nr(function(p){return p=an(p,Pi(se())),Ee(function(x){var E=this;return u(p,function(R){return Ci(R,E,x)})})})}function hh(u,p){p=p===e?" ":Ri(p);var x=p.length;if(x<2)return x?Zp(p,u):p;var E=Zp(p,Ku(u/Sa(p)));return Ma(p)?Nr(fs(E),0,u).join(""):E.slice(0,u)}function BR(u,p,x,E){var R=p&_,z=cc(u);function q(){for(var j=-1,it=arguments.length,yt=-1,xt=E.length,At=lt(xt+it),Bt=this&&this!==Bn&&this instanceof q?z:u;++yt<xt;)At[yt]=E[yt];for(;it--;)At[yt++]=arguments[++j];return Ci(Bt,R?x:this,At)}return q}function lx(u){return function(p,x,E){return E&&typeof E!="number"&&ti(p,x,E)&&(x=E=e),p=rr(p),x===e?(x=p,p=0):x=rr(x),E=E===e?p<x?1:-1:rr(E),AR(p,x,E,u)}}function fh(u){return function(p,x){return typeof p=="string"&&typeof x=="string"||(p=rs(p),x=rs(x)),u(p,x)}}function cx(u,p,x,E,R,z,q,j,it,yt){var xt=p&b,At=xt?q:e,Bt=xt?e:q,Yt=xt?z:e,oe=xt?e:z;p|=xt?A:T,p&=~(xt?T:A),p&w||(p&=~(_|v));var Me=[u,p,R,Yt,At,oe,Bt,j,it,yt],ae=x.apply(e,Me);return hm(u)&&bx(ae,Me),ae.placeholder=E,wx(ae,u,p)}function sm(u){var p=Ln[u];return function(x,E){if(x=rs(x),E=E==null?0:Wn(xe(E),292),E&&w0(x)){var R=(Ge(x)+"e").split("e"),z=p(R[0]+"e"+(+R[1]+E));return R=(Ge(z)+"e").split("e"),+(R[0]+"e"+(+R[1]-E))}return p(x)}}var HR=Ta&&1/Hu(new Ta([,-0]))[1]==Y?function(u){return new Ta(u)}:Em;function ux(u){return function(p){var x=$n(p);return x==bt?Op(p):x==Xt?sP(p):Z2(p,u(p))}}function er(u,p,x,E,R,z,q,j){var it=p&v;if(!it&&typeof u!="function")throw new ts(o);var yt=E?E.length:0;if(yt||(p&=~(A|T),E=R=e),q=q===e?q:Dn(xe(q),0),j=j===e?j:xe(j),yt-=R?R.length:0,p&T){var xt=E,At=R;E=R=e}var Bt=it?e:am(u),Yt=[u,p,x,E,R,xt,At,z,q,j];if(Bt&&nL(Yt,Bt),u=Yt[0],p=Yt[1],x=Yt[2],E=Yt[3],R=Yt[4],j=Yt[9]=Yt[9]===e?it?0:u.length:Dn(Yt[9]-yt,0),!j&&p&(b|M)&&(p&=~(b|M)),!p||p==_)var oe=NR(u,p,x);else p==b||p==M?oe=FR(u,p,j):(p==A||p==(_|A))&&!R.length?oe=BR(u,p,x,E):oe=ch.apply(e,Yt);var Me=Bt?q0:bx;return wx(Me(oe,Yt),u,p)}function hx(u,p,x,E){return u===e||ps(u,Ea[x])&&!qe.call(E,x)?p:u}function fx(u,p,x,E,R,z){return hn(u)&&hn(p)&&(z.set(p,u),rh(u,p,e,fx,z),z.delete(p)),u}function VR(u){return fc(u)?e:u}function dx(u,p,x,E,R,z){var q=x&g,j=u.length,it=p.length;if(j!=it&&!(q&&it>j))return!1;var yt=z.get(u),xt=z.get(p);if(yt&&xt)return yt==p&&xt==u;var At=-1,Bt=!0,Yt=x&y?new _o:e;for(z.set(u,p),z.set(p,u);++At<j;){var oe=u[At],Me=p[At];if(E)var ae=q?E(Me,oe,At,p,u,z):E(oe,Me,At,u,p,z);if(ae!==e){if(ae)continue;Bt=!1;break}if(Yt){if(!Cp(p,function(Ce,Le){if(!Jl(Yt,Le)&&(oe===Ce||R(oe,Ce,x,E,z)))return Yt.push(Le)})){Bt=!1;break}}else if(!(oe===Me||R(oe,Me,x,E,z))){Bt=!1;break}}return z.delete(u),z.delete(p),Bt}function GR(u,p,x,E,R,z,q){switch(x){case Dt:if(u.byteLength!=p.byteLength||u.byteOffset!=p.byteOffset)return!1;u=u.buffer,p=p.buffer;case Et:return!(u.byteLength!=p.byteLength||!z(new Xu(u),new Xu(p)));case qt:case ee:case W:return ps(+u,+p);case $t:return u.name==p.name&&u.message==p.message;case Tt:case Qt:return u==p+"";case bt:var j=Op;case Xt:var it=E&g;if(j||(j=Hu),u.size!=p.size&&!it)return!1;var yt=q.get(u);if(yt)return yt==p;E|=y,q.set(u,p);var xt=dx(j(u),j(p),E,R,z,q);return q.delete(u),xt;case U:if(ic)return ic.call(u)==ic.call(p)}return!1}function qR(u,p,x,E,R,z){var q=x&g,j=rm(u),it=j.length,yt=rm(p),xt=yt.length;if(it!=xt&&!q)return!1;for(var At=it;At--;){var Bt=j[At];if(!(q?Bt in p:qe.call(p,Bt)))return!1}var Yt=z.get(u),oe=z.get(p);if(Yt&&oe)return Yt==p&&oe==u;var Me=!0;z.set(u,p),z.set(p,u);for(var ae=q;++At<it;){Bt=j[At];var Ce=u[Bt],Le=p[Bt];if(E)var Di=q?E(Le,Ce,Bt,p,u,z):E(Ce,Le,Bt,u,p,z);if(!(Di===e?Ce===Le||R(Ce,Le,x,E,z):Di)){Me=!1;break}ae||(ae=Bt=="constructor")}if(Me&&!ae){var ei=u.constructor,Ii=p.constructor;ei!=Ii&&"constructor"in u&&"constructor"in p&&!(typeof ei=="function"&&ei instanceof ei&&typeof Ii=="function"&&Ii instanceof Ii)&&(Me=!1)}return z.delete(u),z.delete(p),Me}function nr(u){return dm(yx(u,e,Cx),u+"")}function rm(u){return I0(u,kn,cm)}function om(u){return I0(u,fi,px)}var am=Qu?function(u){return Qu.get(u)}:Em;function dh(u){for(var p=u.name+"",x=Ca[p],E=qe.call(Ca,p)?x.length:0;E--;){var R=x[E],z=R.func;if(z==null||z==u)return R.name}return p}function Da(u){var p=qe.call(O,"placeholder")?O:u;return p.placeholder}function se(){var u=O.iteratee||Sm;return u=u===Sm?k0:u,arguments.length?u(arguments[0],arguments[1]):u}function ph(u,p){var x=u.__data__;return JR(p)?x[typeof p=="string"?"string":"hash"]:x.map}function lm(u){for(var p=kn(u),x=p.length;x--;){var E=p[x],R=u[E];p[x]=[E,R,vx(R)]}return p}function bo(u,p){var x=eP(u,p);return z0(x)?x:e}function WR(u){var p=qe.call(u,go),x=u[go];try{u[go]=e;var E=!0}catch{}var R=Wu.call(u);return E&&(p?u[go]=x:delete u[go]),R}var cm=kp?function(u){return u==null?[]:(u=je(u),Lr(kp(u),function(p){return x0.call(u,p)}))}:Tm,px=kp?function(u){for(var p=[];u;)Dr(p,cm(u)),u=ju(u);return p}:Tm,$n=Qn;(Up&&$n(new Up(new ArrayBuffer(1)))!=Dt||tc&&$n(new tc)!=bt||Np&&$n(Np.resolve())!=Ct||Ta&&$n(new Ta)!=Xt||ec&&$n(new ec)!=ht)&&($n=function(u){var p=Qn(u),x=p==ct?u.constructor:e,E=x?wo(x):"";if(E)switch(E){case TP:return Dt;case CP:return bt;case PP:return Ct;case RP:return Xt;case LP:return ht}return p});function $R(u,p,x){for(var E=-1,R=x.length;++E<R;){var z=x[E],q=z.size;switch(z.type){case"drop":u+=q;break;case"dropRight":p-=q;break;case"take":p=Wn(p,u+q);break;case"takeRight":u=Dn(u,p-q);break}}return{start:u,end:p}}function XR(u){var p=u.match(ku);return p?p[1].split(xa):[]}function mx(u,p,x){p=Ur(p,u);for(var E=-1,R=p.length,z=!1;++E<R;){var q=zs(p[E]);if(!(z=u!=null&&x(u,q)))break;u=u[q]}return z||++E!=R?z:(R=u==null?0:u.length,!!R&&bh(R)&&ir(q,R)&&(pe(u)||Mo(u)))}function jR(u){var p=u.length,x=new u.constructor(p);return p&&typeof u[0]=="string"&&qe.call(u,"index")&&(x.index=u.index,x.input=u.input),x}function gx(u){return typeof u.constructor=="function"&&!uc(u)?Pa(ju(u)):{}}function YR(u,p,x){var E=u.constructor;switch(p){case Et:return nm(u);case qt:case ee:return new E(+u);case Dt:return DR(u,x);case Jt:case tt:case Q:case V:case _t:case zt:case Ut:case kt:case ne:return J0(u,x);case bt:return new E;case W:case Qt:return new E(u);case Tt:return IR(u);case Xt:return new E;case U:return OR(u)}}function ZR(u,p){var x=p.length;if(!x)return u;var E=x-1;return p[E]=(x>1?"& ":"")+p[E],p=p.join(x>2?", ":" "),u.replace(ya,`{
/* [wrapped with `+p+`] */
`)}function KR(u){return pe(u)||Mo(u)||!!(b0&&u&&u[b0])}function ir(u,p){var x=typeof u;return p=p??J,!!p&&(x=="number"||x!="symbol"&&Wt.test(u))&&u>-1&&u%1==0&&u<p}function ti(u,p,x){if(!hn(x))return!1;var E=typeof p;return(E=="number"?hi(x)&&ir(p,x.length):E=="string"&&p in x)?ps(x[p],u):!1}function um(u,p){if(pe(u))return!1;var x=typeof u;return x=="number"||x=="symbol"||x=="boolean"||u==null||Li(u)?!0:Yi.test(u)||!Ze.test(u)||p!=null&&u in je(p)}function JR(u){var p=typeof u;return p=="string"||p=="number"||p=="symbol"||p=="boolean"?u!=="__proto__":u===null}function hm(u){var p=dh(u),x=O[p];if(typeof x!="function"||!(p in Re.prototype))return!1;if(u===x)return!0;var E=am(x);return!!E&&u===E[0]}function QR(u){return!!v0&&v0 in u}var tL=Gu?sr:Cm;function uc(u){var p=u&&u.constructor,x=typeof p=="function"&&p.prototype||Ea;return u===x}function vx(u){return u===u&&!hn(u)}function _x(u,p){return function(x){return x==null?!1:x[u]===p&&(p!==e||u in je(x))}}function eL(u){var p=yh(u,function(E){return x.size===c&&x.clear(),E}),x=p.cache;return p}function nL(u,p){var x=u[1],E=p[1],R=x|E,z=R<(_|v|P),q=E==P&&x==b||E==P&&x==C&&u[7].length<=p[8]||E==(P|C)&&p[7].length<=p[8]&&x==b;if(!(z||q))return u;E&_&&(u[2]=p[2],R|=x&_?0:w);var j=p[3];if(j){var it=u[3];u[3]=it?tx(it,j,p[4]):j,u[4]=it?Ir(u[3],h):p[4]}return j=p[5],j&&(it=u[5],u[5]=it?ex(it,j,p[6]):j,u[6]=it?Ir(u[5],h):p[6]),j=p[7],j&&(u[7]=j),E&P&&(u[8]=u[8]==null?p[8]:Wn(u[8],p[8])),u[9]==null&&(u[9]=p[9]),u[0]=p[0],u[1]=R,u}function iL(u){var p=[];if(u!=null)for(var x in je(u))p.push(x);return p}function sL(u){return Wu.call(u)}function yx(u,p,x){return p=Dn(p===e?u.length-1:p,0),function(){for(var E=arguments,R=-1,z=Dn(E.length-p,0),q=lt(z);++R<z;)q[R]=E[p+R];R=-1;for(var j=lt(p+1);++R<p;)j[R]=E[R];return j[p]=x(q),Ci(u,this,j)}}function xx(u,p){return p.length<2?u:xo(u,is(p,0,-1))}function rL(u,p){for(var x=u.length,E=Wn(p.length,x),R=ui(u);E--;){var z=p[E];u[E]=ir(z,x)?R[z]:e}return u}function fm(u,p){if(!(p==="constructor"&&typeof u[p]=="function")&&p!="__proto__")return u[p]}var bx=Mx(q0),hc=xP||function(u,p){return Bn.setTimeout(u,p)},dm=Mx(CR);function wx(u,p,x){var E=p+"";return dm(u,ZR(E,oL(XR(E),x)))}function Mx(u){var p=0,x=0;return function(){var E=SP(),R=B-(E-x);if(x=E,R>0){if(++p>=$)return arguments[0]}else p=0;return u.apply(e,arguments)}}function mh(u,p){var x=-1,E=u.length,R=E-1;for(p=p===e?E:p;++x<p;){var z=Yp(x,R),q=u[z];u[z]=u[x],u[x]=q}return u.length=p,u}var Sx=eL(function(u){var p=[];return u.charCodeAt(0)===46&&p.push(""),u.replace(Zi,function(x,E,R,z){p.push(R?z.replace(_p,"$1"):E||x)}),p});function zs(u){if(typeof u=="string"||Li(u))return u;var p=u+"";return p=="0"&&1/u==-Y?"-0":p}function wo(u){if(u!=null){try{return qu.call(u)}catch{}try{return u+""}catch{}}return""}function oL(u,p){return Qi(Ot,function(x){var E="_."+x[0];p&x[1]&&!Fu(u,E)&&u.push(E)}),u.sort()}function Ax(u){if(u instanceof Re)return u.clone();var p=new es(u.__wrapped__,u.__chain__);return p.__actions__=ui(u.__actions__),p.__index__=u.__index__,p.__values__=u.__values__,p}function aL(u,p,x){(x?ti(u,p,x):p===e)?p=1:p=Dn(xe(p),0);var E=u==null?0:u.length;if(!E||p<1)return[];for(var R=0,z=0,q=lt(Ku(E/p));R<E;)q[z++]=is(u,R,R+=p);return q}function lL(u){for(var p=-1,x=u==null?0:u.length,E=0,R=[];++p<x;){var z=u[p];z&&(R[E++]=z)}return R}function cL(){var u=arguments.length;if(!u)return[];for(var p=lt(u-1),x=arguments[0],E=u;E--;)p[E-1]=arguments[E];return Dr(pe(x)?ui(x):[x],Hn(p,1))}var uL=Ee(function(u,p){return wn(u)?rc(u,Hn(p,1,wn,!0)):[]}),hL=Ee(function(u,p){var x=ss(p);return wn(x)&&(x=e),wn(u)?rc(u,Hn(p,1,wn,!0),se(x,2)):[]}),fL=Ee(function(u,p){var x=ss(p);return wn(x)&&(x=e),wn(u)?rc(u,Hn(p,1,wn,!0),e,x):[]});function dL(u,p,x){var E=u==null?0:u.length;return E?(p=x||p===e?1:xe(p),is(u,p<0?0:p,E)):[]}function pL(u,p,x){var E=u==null?0:u.length;return E?(p=x||p===e?1:xe(p),p=E-p,is(u,0,p<0?0:p)):[]}function mL(u,p){return u&&u.length?ah(u,se(p,3),!0,!0):[]}function gL(u,p){return u&&u.length?ah(u,se(p,3),!0):[]}function vL(u,p,x,E){var R=u==null?0:u.length;return R?(x&&typeof x!="number"&&ti(u,p,x)&&(x=0,E=R),cR(u,p,x,E)):[]}function Ex(u,p,x){var E=u==null?0:u.length;if(!E)return-1;var R=x==null?0:xe(x);return R<0&&(R=Dn(E+R,0)),Bu(u,se(p,3),R)}function Tx(u,p,x){var E=u==null?0:u.length;if(!E)return-1;var R=E-1;return x!==e&&(R=xe(x),R=x<0?Dn(E+R,0):Wn(R,E-1)),Bu(u,se(p,3),R,!0)}function Cx(u){var p=u==null?0:u.length;return p?Hn(u,1):[]}function _L(u){var p=u==null?0:u.length;return p?Hn(u,Y):[]}function yL(u,p){var x=u==null?0:u.length;return x?(p=p===e?1:xe(p),Hn(u,p)):[]}function xL(u){for(var p=-1,x=u==null?0:u.length,E={};++p<x;){var R=u[p];E[R[0]]=R[1]}return E}function Px(u){return u&&u.length?u[0]:e}function bL(u,p,x){var E=u==null?0:u.length;if(!E)return-1;var R=x==null?0:xe(x);return R<0&&(R=Dn(E+R,0)),wa(u,p,R)}function wL(u){var p=u==null?0:u.length;return p?is(u,0,-1):[]}var ML=Ee(function(u){var p=an(u,tm);return p.length&&p[0]===u[0]?qp(p):[]}),SL=Ee(function(u){var p=ss(u),x=an(u,tm);return p===ss(x)?p=e:x.pop(),x.length&&x[0]===u[0]?qp(x,se(p,2)):[]}),AL=Ee(function(u){var p=ss(u),x=an(u,tm);return p=typeof p=="function"?p:e,p&&x.pop(),x.length&&x[0]===u[0]?qp(x,e,p):[]});function EL(u,p){return u==null?"":wP.call(u,p)}function ss(u){var p=u==null?0:u.length;return p?u[p-1]:e}function TL(u,p,x){var E=u==null?0:u.length;if(!E)return-1;var R=E;return x!==e&&(R=xe(x),R=R<0?Dn(E+R,0):Wn(R,E-1)),p===p?oP(u,p,R):Bu(u,c0,R,!0)}function CL(u,p){return u&&u.length?B0(u,xe(p)):e}var PL=Ee(Rx);function Rx(u,p){return u&&u.length&&p&&p.length?jp(u,p):u}function RL(u,p,x){return u&&u.length&&p&&p.length?jp(u,p,se(x,2)):u}function LL(u,p,x){return u&&u.length&&p&&p.length?jp(u,p,e,x):u}var DL=nr(function(u,p){var x=u==null?0:u.length,E=Bp(u,p);return G0(u,an(p,function(R){return ir(R,x)?+R:R}).sort(Q0)),E});function IL(u,p){var x=[];if(!(u&&u.length))return x;var E=-1,R=[],z=u.length;for(p=se(p,3);++E<z;){var q=u[E];p(q,E,u)&&(x.push(q),R.push(E))}return G0(u,R),x}function pm(u){return u==null?u:EP.call(u)}function OL(u,p,x){var E=u==null?0:u.length;return E?(x&&typeof x!="number"&&ti(u,p,x)?(p=0,x=E):(p=p==null?0:xe(p),x=x===e?E:xe(x)),is(u,p,x)):[]}function zL(u,p){return oh(u,p)}function kL(u,p,x){return Kp(u,p,se(x,2))}function UL(u,p){var x=u==null?0:u.length;if(x){var E=oh(u,p);if(E<x&&ps(u[E],p))return E}return-1}function NL(u,p){return oh(u,p,!0)}function FL(u,p,x){return Kp(u,p,se(x,2),!0)}function BL(u,p){var x=u==null?0:u.length;if(x){var E=oh(u,p,!0)-1;if(ps(u[E],p))return E}return-1}function HL(u){return u&&u.length?W0(u):[]}function VL(u,p){return u&&u.length?W0(u,se(p,2)):[]}function GL(u){var p=u==null?0:u.length;return p?is(u,1,p):[]}function qL(u,p,x){return u&&u.length?(p=x||p===e?1:xe(p),is(u,0,p<0?0:p)):[]}function WL(u,p,x){var E=u==null?0:u.length;return E?(p=x||p===e?1:xe(p),p=E-p,is(u,p<0?0:p,E)):[]}function $L(u,p){return u&&u.length?ah(u,se(p,3),!1,!0):[]}function XL(u,p){return u&&u.length?ah(u,se(p,3)):[]}var jL=Ee(function(u){return kr(Hn(u,1,wn,!0))}),YL=Ee(function(u){var p=ss(u);return wn(p)&&(p=e),kr(Hn(u,1,wn,!0),se(p,2))}),ZL=Ee(function(u){var p=ss(u);return p=typeof p=="function"?p:e,kr(Hn(u,1,wn,!0),e,p)});function KL(u){return u&&u.length?kr(u):[]}function JL(u,p){return u&&u.length?kr(u,se(p,2)):[]}function QL(u,p){return p=typeof p=="function"?p:e,u&&u.length?kr(u,e,p):[]}function mm(u){if(!(u&&u.length))return[];var p=0;return u=Lr(u,function(x){if(wn(x))return p=Dn(x.length,p),!0}),Dp(p,function(x){return an(u,Pp(x))})}function Lx(u,p){if(!(u&&u.length))return[];var x=mm(u);return p==null?x:an(x,function(E){return Ci(p,e,E)})}var tD=Ee(function(u,p){return wn(u)?rc(u,p):[]}),eD=Ee(function(u){return Qp(Lr(u,wn))}),nD=Ee(function(u){var p=ss(u);return wn(p)&&(p=e),Qp(Lr(u,wn),se(p,2))}),iD=Ee(function(u){var p=ss(u);return p=typeof p=="function"?p:e,Qp(Lr(u,wn),e,p)}),sD=Ee(mm);function rD(u,p){return Y0(u||[],p||[],sc)}function oD(u,p){return Y0(u||[],p||[],lc)}var aD=Ee(function(u){var p=u.length,x=p>1?u[p-1]:e;return x=typeof x=="function"?(u.pop(),x):e,Lx(u,x)});function Dx(u){var p=O(u);return p.__chain__=!0,p}function lD(u,p){return p(u),u}function gh(u,p){return p(u)}var cD=nr(function(u){var p=u.length,x=p?u[0]:0,E=this.__wrapped__,R=function(z){return Bp(z,u)};return p>1||this.__actions__.length||!(E instanceof Re)||!ir(x)?this.thru(R):(E=E.slice(x,+x+(p?1:0)),E.__actions__.push({func:gh,args:[R],thisArg:e}),new es(E,this.__chain__).thru(function(z){return p&&!z.length&&z.push(e),z}))});function uD(){return Dx(this)}function hD(){return new es(this.value(),this.__chain__)}function fD(){this.__values__===e&&(this.__values__=$x(this.value()));var u=this.__index__>=this.__values__.length,p=u?e:this.__values__[this.__index__++];return{done:u,value:p}}function dD(){return this}function pD(u){for(var p,x=this;x instanceof eh;){var E=Ax(x);E.__index__=0,E.__values__=e,p?R.__wrapped__=E:p=E;var R=E;x=x.__wrapped__}return R.__wrapped__=u,p}function mD(){var u=this.__wrapped__;if(u instanceof Re){var p=u;return this.__actions__.length&&(p=new Re(this)),p=p.reverse(),p.__actions__.push({func:gh,args:[pm],thisArg:e}),new es(p,this.__chain__)}return this.thru(pm)}function gD(){return j0(this.__wrapped__,this.__actions__)}var vD=lh(function(u,p,x){qe.call(u,x)?++u[x]:tr(u,x,1)});function _D(u,p,x){var E=pe(u)?a0:lR;return x&&ti(u,p,x)&&(p=e),E(u,se(p,3))}function yD(u,p){var x=pe(u)?Lr:L0;return x(u,se(p,3))}var xD=rx(Ex),bD=rx(Tx);function wD(u,p){return Hn(vh(u,p),1)}function MD(u,p){return Hn(vh(u,p),Y)}function SD(u,p,x){return x=x===e?1:xe(x),Hn(vh(u,p),x)}function Ix(u,p){var x=pe(u)?Qi:zr;return x(u,se(p,3))}function Ox(u,p){var x=pe(u)?G2:R0;return x(u,se(p,3))}var AD=lh(function(u,p,x){qe.call(u,x)?u[x].push(p):tr(u,x,[p])});function ED(u,p,x,E){u=hi(u)?u:Oa(u),x=x&&!E?xe(x):0;var R=u.length;return x<0&&(x=Dn(R+x,0)),wh(u)?x<=R&&u.indexOf(p,x)>-1:!!R&&wa(u,p,x)>-1}var TD=Ee(function(u,p,x){var E=-1,R=typeof p=="function",z=hi(u)?lt(u.length):[];return zr(u,function(q){z[++E]=R?Ci(p,q,x):oc(q,p,x)}),z}),CD=lh(function(u,p,x){tr(u,x,p)});function vh(u,p){var x=pe(u)?an:U0;return x(u,se(p,3))}function PD(u,p,x,E){return u==null?[]:(pe(p)||(p=p==null?[]:[p]),x=E?e:x,pe(x)||(x=x==null?[]:[x]),H0(u,p,x))}var RD=lh(function(u,p,x){u[x?0:1].push(p)},function(){return[[],[]]});function LD(u,p,x){var E=pe(u)?Tp:h0,R=arguments.length<3;return E(u,se(p,4),x,R,zr)}function DD(u,p,x){var E=pe(u)?q2:h0,R=arguments.length<3;return E(u,se(p,4),x,R,R0)}function ID(u,p){var x=pe(u)?Lr:L0;return x(u,xh(se(p,3)))}function OD(u){var p=pe(u)?E0:ER;return p(u)}function zD(u,p,x){(x?ti(u,p,x):p===e)?p=1:p=xe(p);var E=pe(u)?iR:TR;return E(u,p)}function kD(u){var p=pe(u)?sR:PR;return p(u)}function UD(u){if(u==null)return 0;if(hi(u))return wh(u)?Sa(u):u.length;var p=$n(u);return p==bt||p==Xt?u.size:$p(u).length}function ND(u,p,x){var E=pe(u)?Cp:RR;return x&&ti(u,p,x)&&(p=e),E(u,se(p,3))}var FD=Ee(function(u,p){if(u==null)return[];var x=p.length;return x>1&&ti(u,p[0],p[1])?p=[]:x>2&&ti(p[0],p[1],p[2])&&(p=[p[0]]),H0(u,Hn(p,1),[])}),_h=yP||function(){return Bn.Date.now()};function BD(u,p){if(typeof p!="function")throw new ts(o);return u=xe(u),function(){if(--u<1)return p.apply(this,arguments)}}function zx(u,p,x){return p=x?e:p,p=u&&p==null?u.length:p,er(u,P,e,e,e,e,p)}function kx(u,p){var x;if(typeof p!="function")throw new ts(o);return u=xe(u),function(){return--u>0&&(x=p.apply(this,arguments)),u<=1&&(p=e),x}}var gm=Ee(function(u,p,x){var E=_;if(x.length){var R=Ir(x,Da(gm));E|=A}return er(u,E,p,x,R)}),Ux=Ee(function(u,p,x){var E=_|v;if(x.length){var R=Ir(x,Da(Ux));E|=A}return er(p,E,u,x,R)});function Nx(u,p,x){p=x?e:p;var E=er(u,b,e,e,e,e,e,p);return E.placeholder=Nx.placeholder,E}function Fx(u,p,x){p=x?e:p;var E=er(u,M,e,e,e,e,e,p);return E.placeholder=Fx.placeholder,E}function Bx(u,p,x){var E,R,z,q,j,it,yt=0,xt=!1,At=!1,Bt=!0;if(typeof u!="function")throw new ts(o);p=rs(p)||0,hn(x)&&(xt=!!x.leading,At="maxWait"in x,z=At?Dn(rs(x.maxWait)||0,p):z,Bt="trailing"in x?!!x.trailing:Bt);function Yt(Mn){var ms=E,or=R;return E=R=e,yt=Mn,q=u.apply(or,ms),q}function oe(Mn){return yt=Mn,j=hc(Ce,p),xt?Yt(Mn):q}function Me(Mn){var ms=Mn-it,or=Mn-yt,rb=p-ms;return At?Wn(rb,z-or):rb}function ae(Mn){var ms=Mn-it,or=Mn-yt;return it===e||ms>=p||ms<0||At&&or>=z}function Ce(){var Mn=_h();if(ae(Mn))return Le(Mn);j=hc(Ce,Me(Mn))}function Le(Mn){return j=e,Bt&&E?Yt(Mn):(E=R=e,q)}function Di(){j!==e&&Z0(j),yt=0,E=it=R=j=e}function ei(){return j===e?q:Le(_h())}function Ii(){var Mn=_h(),ms=ae(Mn);if(E=arguments,R=this,it=Mn,ms){if(j===e)return oe(it);if(At)return Z0(j),j=hc(Ce,p),Yt(it)}return j===e&&(j=hc(Ce,p)),q}return Ii.cancel=Di,Ii.flush=ei,Ii}var HD=Ee(function(u,p){return P0(u,1,p)}),VD=Ee(function(u,p,x){return P0(u,rs(p)||0,x)});function GD(u){return er(u,S)}function yh(u,p){if(typeof u!="function"||p!=null&&typeof p!="function")throw new ts(o);var x=function(){var E=arguments,R=p?p.apply(this,E):E[0],z=x.cache;if(z.has(R))return z.get(R);var q=u.apply(this,E);return x.cache=z.set(R,q)||z,q};return x.cache=new(yh.Cache||Qs),x}yh.Cache=Qs;function xh(u){if(typeof u!="function")throw new ts(o);return function(){var p=arguments;switch(p.length){case 0:return!u.call(this);case 1:return!u.call(this,p[0]);case 2:return!u.call(this,p[0],p[1]);case 3:return!u.call(this,p[0],p[1],p[2])}return!u.apply(this,p)}}function qD(u){return kx(2,u)}var WD=LR(function(u,p){p=p.length==1&&pe(p[0])?an(p[0],Pi(se())):an(Hn(p,1),Pi(se()));var x=p.length;return Ee(function(E){for(var R=-1,z=Wn(E.length,x);++R<z;)E[R]=p[R].call(this,E[R]);return Ci(u,this,E)})}),vm=Ee(function(u,p){var x=Ir(p,Da(vm));return er(u,A,e,p,x)}),Hx=Ee(function(u,p){var x=Ir(p,Da(Hx));return er(u,T,e,p,x)}),$D=nr(function(u,p){return er(u,C,e,e,e,p)});function XD(u,p){if(typeof u!="function")throw new ts(o);return p=p===e?p:xe(p),Ee(u,p)}function jD(u,p){if(typeof u!="function")throw new ts(o);return p=p==null?0:Dn(xe(p),0),Ee(function(x){var E=x[p],R=Nr(x,0,p);return E&&Dr(R,E),Ci(u,this,R)})}function YD(u,p,x){var E=!0,R=!0;if(typeof u!="function")throw new ts(o);return hn(x)&&(E="leading"in x?!!x.leading:E,R="trailing"in x?!!x.trailing:R),Bx(u,p,{leading:E,maxWait:p,trailing:R})}function ZD(u){return zx(u,1)}function KD(u,p){return vm(em(p),u)}function JD(){if(!arguments.length)return[];var u=arguments[0];return pe(u)?u:[u]}function QD(u){return ns(u,m)}function tI(u,p){return p=typeof p=="function"?p:e,ns(u,m,p)}function eI(u){return ns(u,f|m)}function nI(u,p){return p=typeof p=="function"?p:e,ns(u,f|m,p)}function iI(u,p){return p==null||C0(u,p,kn(p))}function ps(u,p){return u===p||u!==u&&p!==p}var sI=fh(Gp),rI=fh(function(u,p){return u>=p}),Mo=O0(function(){return arguments}())?O0:function(u){return mn(u)&&qe.call(u,"callee")&&!x0.call(u,"callee")},pe=lt.isArray,oI=e0?Pi(e0):pR;function hi(u){return u!=null&&bh(u.length)&&!sr(u)}function wn(u){return mn(u)&&hi(u)}function aI(u){return u===!0||u===!1||mn(u)&&Qn(u)==qt}var Fr=bP||Cm,lI=n0?Pi(n0):mR;function cI(u){return mn(u)&&u.nodeType===1&&!fc(u)}function uI(u){if(u==null)return!0;if(hi(u)&&(pe(u)||typeof u=="string"||typeof u.splice=="function"||Fr(u)||Ia(u)||Mo(u)))return!u.length;var p=$n(u);if(p==bt||p==Xt)return!u.size;if(uc(u))return!$p(u).length;for(var x in u)if(qe.call(u,x))return!1;return!0}function hI(u,p){return ac(u,p)}function fI(u,p,x){x=typeof x=="function"?x:e;var E=x?x(u,p):e;return E===e?ac(u,p,e,x):!!E}function _m(u){if(!mn(u))return!1;var p=Qn(u);return p==$t||p==le||typeof u.message=="string"&&typeof u.name=="string"&&!fc(u)}function dI(u){return typeof u=="number"&&w0(u)}function sr(u){if(!hn(u))return!1;var p=Qn(u);return p==Mt||p==X||p==Ht||p==wt}function Vx(u){return typeof u=="number"&&u==xe(u)}function bh(u){return typeof u=="number"&&u>-1&&u%1==0&&u<=J}function hn(u){var p=typeof u;return u!=null&&(p=="object"||p=="function")}function mn(u){return u!=null&&typeof u=="object"}var Gx=i0?Pi(i0):vR;function pI(u,p){return u===p||Wp(u,p,lm(p))}function mI(u,p,x){return x=typeof x=="function"?x:e,Wp(u,p,lm(p),x)}function gI(u){return qx(u)&&u!=+u}function vI(u){if(tL(u))throw new fe(r);return z0(u)}function _I(u){return u===null}function yI(u){return u==null}function qx(u){return typeof u=="number"||mn(u)&&Qn(u)==W}function fc(u){if(!mn(u)||Qn(u)!=ct)return!1;var p=ju(u);if(p===null)return!0;var x=qe.call(p,"constructor")&&p.constructor;return typeof x=="function"&&x instanceof x&&qu.call(x)==mP}var ym=s0?Pi(s0):_R;function xI(u){return Vx(u)&&u>=-J&&u<=J}var Wx=r0?Pi(r0):yR;function wh(u){return typeof u=="string"||!pe(u)&&mn(u)&&Qn(u)==Qt}function Li(u){return typeof u=="symbol"||mn(u)&&Qn(u)==U}var Ia=o0?Pi(o0):xR;function bI(u){return u===e}function wI(u){return mn(u)&&$n(u)==ht}function MI(u){return mn(u)&&Qn(u)==St}var SI=fh(Xp),AI=fh(function(u,p){return u<=p});function $x(u){if(!u)return[];if(hi(u))return wh(u)?fs(u):ui(u);if(Ql&&u[Ql])return iP(u[Ql]());var p=$n(u),x=p==bt?Op:p==Xt?Hu:Oa;return x(u)}function rr(u){if(!u)return u===0?u:0;if(u=rs(u),u===Y||u===-Y){var p=u<0?-1:1;return p*ut}return u===u?u:0}function xe(u){var p=rr(u),x=p%1;return p===p?x?p-x:p:0}function Xx(u){return u?yo(xe(u),0,nt):0}function rs(u){if(typeof u=="number")return u;if(Li(u))return dt;if(hn(u)){var p=typeof u.valueOf=="function"?u.valueOf():u;u=hn(p)?p+"":p}if(typeof u!="string")return u===0?u:+u;u=f0(u);var x=mt.test(u);return x||vt.test(u)?B2(u.slice(2),x?2:8):ot.test(u)?dt:+u}function jx(u){return Os(u,fi(u))}function EI(u){return u?yo(xe(u),-J,J):u===0?u:0}function Ge(u){return u==null?"":Ri(u)}var TI=Ra(function(u,p){if(uc(p)||hi(p)){Os(p,kn(p),u);return}for(var x in p)qe.call(p,x)&&sc(u,x,p[x])}),Yx=Ra(function(u,p){Os(p,fi(p),u)}),Mh=Ra(function(u,p,x,E){Os(p,fi(p),u,E)}),CI=Ra(function(u,p,x,E){Os(p,kn(p),u,E)}),PI=nr(Bp);function RI(u,p){var x=Pa(u);return p==null?x:T0(x,p)}var LI=Ee(function(u,p){u=je(u);var x=-1,E=p.length,R=E>2?p[2]:e;for(R&&ti(p[0],p[1],R)&&(E=1);++x<E;)for(var z=p[x],q=fi(z),j=-1,it=q.length;++j<it;){var yt=q[j],xt=u[yt];(xt===e||ps(xt,Ea[yt])&&!qe.call(u,yt))&&(u[yt]=z[yt])}return u}),DI=Ee(function(u){return u.push(e,fx),Ci(Zx,e,u)});function II(u,p){return l0(u,se(p,3),Is)}function OI(u,p){return l0(u,se(p,3),Vp)}function zI(u,p){return u==null?u:Hp(u,se(p,3),fi)}function kI(u,p){return u==null?u:D0(u,se(p,3),fi)}function UI(u,p){return u&&Is(u,se(p,3))}function NI(u,p){return u&&Vp(u,se(p,3))}function FI(u){return u==null?[]:sh(u,kn(u))}function BI(u){return u==null?[]:sh(u,fi(u))}function xm(u,p,x){var E=u==null?e:xo(u,p);return E===e?x:E}function HI(u,p){return u!=null&&mx(u,p,uR)}function bm(u,p){return u!=null&&mx(u,p,hR)}var VI=ax(function(u,p,x){p!=null&&typeof p.toString!="function"&&(p=Wu.call(p)),u[p]=x},Mm(di)),GI=ax(function(u,p,x){p!=null&&typeof p.toString!="function"&&(p=Wu.call(p)),qe.call(u,p)?u[p].push(x):u[p]=[x]},se),qI=Ee(oc);function kn(u){return hi(u)?A0(u):$p(u)}function fi(u){return hi(u)?A0(u,!0):bR(u)}function WI(u,p){var x={};return p=se(p,3),Is(u,function(E,R,z){tr(x,p(E,R,z),E)}),x}function $I(u,p){var x={};return p=se(p,3),Is(u,function(E,R,z){tr(x,R,p(E,R,z))}),x}var XI=Ra(function(u,p,x){rh(u,p,x)}),Zx=Ra(function(u,p,x,E){rh(u,p,x,E)}),jI=nr(function(u,p){var x={};if(u==null)return x;var E=!1;p=an(p,function(z){return z=Ur(z,u),E||(E=z.length>1),z}),Os(u,om(u),x),E&&(x=ns(x,f|d|m,VR));for(var R=p.length;R--;)Jp(x,p[R]);return x});function YI(u,p){return Kx(u,xh(se(p)))}var ZI=nr(function(u,p){return u==null?{}:MR(u,p)});function Kx(u,p){if(u==null)return{};var x=an(om(u),function(E){return[E]});return p=se(p),V0(u,x,function(E,R){return p(E,R[0])})}function KI(u,p,x){p=Ur(p,u);var E=-1,R=p.length;for(R||(R=1,u=e);++E<R;){var z=u==null?e:u[zs(p[E])];z===e&&(E=R,z=x),u=sr(z)?z.call(u):z}return u}function JI(u,p,x){return u==null?u:lc(u,p,x)}function QI(u,p,x,E){return E=typeof E=="function"?E:e,u==null?u:lc(u,p,x,E)}var Jx=ux(kn),Qx=ux(fi);function tO(u,p,x){var E=pe(u),R=E||Fr(u)||Ia(u);if(p=se(p,4),x==null){var z=u&&u.constructor;R?x=E?new z:[]:hn(u)?x=sr(z)?Pa(ju(u)):{}:x={}}return(R?Qi:Is)(u,function(q,j,it){return p(x,q,j,it)}),x}function eO(u,p){return u==null?!0:Jp(u,p)}function nO(u,p,x){return u==null?u:X0(u,p,em(x))}function iO(u,p,x,E){return E=typeof E=="function"?E:e,u==null?u:X0(u,p,em(x),E)}function Oa(u){return u==null?[]:Ip(u,kn(u))}function sO(u){return u==null?[]:Ip(u,fi(u))}function rO(u,p,x){return x===e&&(x=p,p=e),x!==e&&(x=rs(x),x=x===x?x:0),p!==e&&(p=rs(p),p=p===p?p:0),yo(rs(u),p,x)}function oO(u,p,x){return p=rr(p),x===e?(x=p,p=0):x=rr(x),u=rs(u),fR(u,p,x)}function aO(u,p,x){if(x&&typeof x!="boolean"&&ti(u,p,x)&&(p=x=e),x===e&&(typeof p=="boolean"?(x=p,p=e):typeof u=="boolean"&&(x=u,u=e)),u===e&&p===e?(u=0,p=1):(u=rr(u),p===e?(p=u,u=0):p=rr(p)),u>p){var E=u;u=p,p=E}if(x||u%1||p%1){var R=M0();return Wn(u+R*(p-u+F2("1e-"+((R+"").length-1))),p)}return Yp(u,p)}var lO=La(function(u,p,x){return p=p.toLowerCase(),u+(x?tb(p):p)});function tb(u){return wm(Ge(u).toLowerCase())}function eb(u){return u=Ge(u),u&&u.replace(ie,J2).replace(P2,"")}function cO(u,p,x){u=Ge(u),p=Ri(p);var E=u.length;x=x===e?E:yo(xe(x),0,E);var R=x;return x-=p.length,x>=0&&u.slice(x,R)==p}function uO(u){return u=Ge(u),u&&ye.test(u)?u.replace(Pt,Q2):u}function hO(u){return u=Ge(u),u&&zu.test(u)?u.replace(hs,"\\$&"):u}var fO=La(function(u,p,x){return u+(x?"-":"")+p.toLowerCase()}),dO=La(function(u,p,x){return u+(x?" ":"")+p.toLowerCase()}),pO=sx("toLowerCase");function mO(u,p,x){u=Ge(u),p=xe(p);var E=p?Sa(u):0;if(!p||E>=p)return u;var R=(p-E)/2;return hh(Ju(R),x)+u+hh(Ku(R),x)}function gO(u,p,x){u=Ge(u),p=xe(p);var E=p?Sa(u):0;return p&&E<p?u+hh(p-E,x):u}function vO(u,p,x){u=Ge(u),p=xe(p);var E=p?Sa(u):0;return p&&E<p?hh(p-E,x)+u:u}function _O(u,p,x){return x||p==null?p=0:p&&(p=+p),AP(Ge(u).replace(_a,""),p||0)}function yO(u,p,x){return(x?ti(u,p,x):p===e)?p=1:p=xe(p),Zp(Ge(u),p)}function xO(){var u=arguments,p=Ge(u[0]);return u.length<3?p:p.replace(u[1],u[2])}var bO=La(function(u,p,x){return u+(x?"_":"")+p.toLowerCase()});function wO(u,p,x){return x&&typeof x!="number"&&ti(u,p,x)&&(p=x=e),x=x===e?nt:x>>>0,x?(u=Ge(u),u&&(typeof p=="string"||p!=null&&!ym(p))&&(p=Ri(p),!p&&Ma(u))?Nr(fs(u),0,x):u.split(p,x)):[]}var MO=La(function(u,p,x){return u+(x?" ":"")+wm(p)});function SO(u,p,x){return u=Ge(u),x=x==null?0:yo(xe(x),0,u.length),p=Ri(p),u.slice(x,x+p.length)==p}function AO(u,p,x){var E=O.templateSettings;x&&ti(u,p,x)&&(p=e),u=Ge(u),p=Mh({},p,E,hx);var R=Mh({},p.imports,E.imports,hx),z=kn(R),q=Ip(R,z),j,it,yt=0,xt=p.interpolate||re,At="__p += '",Bt=zp((p.escape||re).source+"|"+xt.source+"|"+(xt===Ti?yp:re).source+"|"+(p.evaluate||re).source+"|$","g"),Yt="//# sourceURL="+(qe.call(p,"sourceURL")?(p.sourceURL+"").replace(/\s/g," "):"lodash.templateSources["+ ++O2+"]")+`
`;u.replace(Bt,function(ae,Ce,Le,Di,ei,Ii){return Le||(Le=Di),At+=u.slice(yt,Ii).replace(ce,tP),Ce&&(j=!0,At+=`' +
__e(`+Ce+`) +
'`),ei&&(it=!0,At+=`';
`+ei+`;
__p += '`),Le&&(At+=`' +
((__t = (`+Le+`)) == null ? '' : __t) +
'`),yt=Ii+ae.length,ae}),At+=`';
`;var oe=qe.call(p,"variable")&&p.variable;if(!oe)At=`with (obj) {
`+At+`
}
`;else if(vp.test(oe))throw new fe(a);At=(it?At.replace(_e,""):At).replace(Z,"$1").replace(Rt,"$1;"),At="function("+(oe||"obj")+`) {
`+(oe?"":`obj || (obj = {});
`)+"var __t, __p = ''"+(j?", __e = _.escape":"")+(it?`, __j = Array.prototype.join;
function print() { __p += __j.call(arguments, '') }
`:`;
`)+At+`return __p
}`;var Me=ib(function(){return He(z,Yt+"return "+At).apply(e,q)});if(Me.source=At,_m(Me))throw Me;return Me}function EO(u){return Ge(u).toLowerCase()}function TO(u){return Ge(u).toUpperCase()}function CO(u,p,x){if(u=Ge(u),u&&(x||p===e))return f0(u);if(!u||!(p=Ri(p)))return u;var E=fs(u),R=fs(p),z=d0(E,R),q=p0(E,R)+1;return Nr(E,z,q).join("")}function PO(u,p,x){if(u=Ge(u),u&&(x||p===e))return u.slice(0,g0(u)+1);if(!u||!(p=Ri(p)))return u;var E=fs(u),R=p0(E,fs(p))+1;return Nr(E,0,R).join("")}function RO(u,p,x){if(u=Ge(u),u&&(x||p===e))return u.replace(_a,"");if(!u||!(p=Ri(p)))return u;var E=fs(u),R=d0(E,fs(p));return Nr(E,R).join("")}function LO(u,p){var x=L,E=H;if(hn(p)){var R="separator"in p?p.separator:R;x="length"in p?xe(p.length):x,E="omission"in p?Ri(p.omission):E}u=Ge(u);var z=u.length;if(Ma(u)){var q=fs(u);z=q.length}if(x>=z)return u;var j=x-Sa(E);if(j<1)return E;var it=q?Nr(q,0,j).join(""):u.slice(0,j);if(R===e)return it+E;if(q&&(j+=it.length-j),ym(R)){if(u.slice(j).search(R)){var yt,xt=it;for(R.global||(R=zp(R.source,Ge(F.exec(R))+"g")),R.lastIndex=0;yt=R.exec(xt);)var At=yt.index;it=it.slice(0,At===e?j:At)}}else if(u.indexOf(Ri(R),j)!=j){var Bt=it.lastIndexOf(R);Bt>-1&&(it=it.slice(0,Bt))}return it+E}function DO(u){return u=Ge(u),u&&Nt.test(u)?u.replace(at,aP):u}var IO=La(function(u,p,x){return u+(x?" ":"")+p.toUpperCase()}),wm=sx("toUpperCase");function nb(u,p,x){return u=Ge(u),p=x?e:p,p===e?nP(u)?uP(u):X2(u):u.match(p)||[]}var ib=Ee(function(u,p){try{return Ci(u,e,p)}catch(x){return _m(x)?x:new fe(x)}}),OO=nr(function(u,p){return Qi(p,function(x){x=zs(x),tr(u,x,gm(u[x],u))}),u});function zO(u){var p=u==null?0:u.length,x=se();return u=p?an(u,function(E){if(typeof E[1]!="function")throw new ts(o);return[x(E[0]),E[1]]}):[],Ee(function(E){for(var R=-1;++R<p;){var z=u[R];if(Ci(z[0],this,E))return Ci(z[1],this,E)}})}function kO(u){return aR(ns(u,f))}function Mm(u){return function(){return u}}function UO(u,p){return u==null||u!==u?p:u}var NO=ox(),FO=ox(!0);function di(u){return u}function Sm(u){return k0(typeof u=="function"?u:ns(u,f))}function BO(u){return N0(ns(u,f))}function HO(u,p){return F0(u,ns(p,f))}var VO=Ee(function(u,p){return function(x){return oc(x,u,p)}}),GO=Ee(function(u,p){return function(x){return oc(u,x,p)}});function Am(u,p,x){var E=kn(p),R=sh(p,E);x==null&&!(hn(p)&&(R.length||!E.length))&&(x=p,p=u,u=this,R=sh(p,kn(p)));var z=!(hn(x)&&"chain"in x)||!!x.chain,q=sr(u);return Qi(R,function(j){var it=p[j];u[j]=it,q&&(u.prototype[j]=function(){var yt=this.__chain__;if(z||yt){var xt=u(this.__wrapped__),At=xt.__actions__=ui(this.__actions__);return At.push({func:it,args:arguments,thisArg:u}),xt.__chain__=yt,xt}return it.apply(u,Dr([this.value()],arguments))})}),u}function qO(){return Bn._===this&&(Bn._=gP),this}function Em(){}function WO(u){return u=xe(u),Ee(function(p){return B0(p,u)})}var $O=im(an),XO=im(a0),jO=im(Cp);function sb(u){return um(u)?Pp(zs(u)):SR(u)}function YO(u){return function(p){return u==null?e:xo(u,p)}}var ZO=lx(),KO=lx(!0);function Tm(){return[]}function Cm(){return!1}function JO(){return{}}function QO(){return""}function tz(){return!0}function ez(u,p){if(u=xe(u),u<1||u>J)return[];var x=nt,E=Wn(u,nt);p=se(p),u-=nt;for(var R=Dp(E,p);++x<u;)p(x);return R}function nz(u){return pe(u)?an(u,zs):Li(u)?[u]:ui(Sx(Ge(u)))}function iz(u){var p=++pP;return Ge(u)+p}var sz=uh(function(u,p){return u+p},0),rz=sm("ceil"),oz=uh(function(u,p){return u/p},1),az=sm("floor");function lz(u){return u&&u.length?ih(u,di,Gp):e}function cz(u,p){return u&&u.length?ih(u,se(p,2),Gp):e}function uz(u){return u0(u,di)}function hz(u,p){return u0(u,se(p,2))}function fz(u){return u&&u.length?ih(u,di,Xp):e}function dz(u,p){return u&&u.length?ih(u,se(p,2),Xp):e}var pz=uh(function(u,p){return u*p},1),mz=sm("round"),gz=uh(function(u,p){return u-p},0);function vz(u){return u&&u.length?Lp(u,di):0}function _z(u,p){return u&&u.length?Lp(u,se(p,2)):0}return O.after=BD,O.ary=zx,O.assign=TI,O.assignIn=Yx,O.assignInWith=Mh,O.assignWith=CI,O.at=PI,O.before=kx,O.bind=gm,O.bindAll=OO,O.bindKey=Ux,O.castArray=JD,O.chain=Dx,O.chunk=aL,O.compact=lL,O.concat=cL,O.cond=zO,O.conforms=kO,O.constant=Mm,O.countBy=vD,O.create=RI,O.curry=Nx,O.curryRight=Fx,O.debounce=Bx,O.defaults=LI,O.defaultsDeep=DI,O.defer=HD,O.delay=VD,O.difference=uL,O.differenceBy=hL,O.differenceWith=fL,O.drop=dL,O.dropRight=pL,O.dropRightWhile=mL,O.dropWhile=gL,O.fill=vL,O.filter=yD,O.flatMap=wD,O.flatMapDeep=MD,O.flatMapDepth=SD,O.flatten=Cx,O.flattenDeep=_L,O.flattenDepth=yL,O.flip=GD,O.flow=NO,O.flowRight=FO,O.fromPairs=xL,O.functions=FI,O.functionsIn=BI,O.groupBy=AD,O.initial=wL,O.intersection=ML,O.intersectionBy=SL,O.intersectionWith=AL,O.invert=VI,O.invertBy=GI,O.invokeMap=TD,O.iteratee=Sm,O.keyBy=CD,O.keys=kn,O.keysIn=fi,O.map=vh,O.mapKeys=WI,O.mapValues=$I,O.matches=BO,O.matchesProperty=HO,O.memoize=yh,O.merge=XI,O.mergeWith=Zx,O.method=VO,O.methodOf=GO,O.mixin=Am,O.negate=xh,O.nthArg=WO,O.omit=jI,O.omitBy=YI,O.once=qD,O.orderBy=PD,O.over=$O,O.overArgs=WD,O.overEvery=XO,O.overSome=jO,O.partial=vm,O.partialRight=Hx,O.partition=RD,O.pick=ZI,O.pickBy=Kx,O.property=sb,O.propertyOf=YO,O.pull=PL,O.pullAll=Rx,O.pullAllBy=RL,O.pullAllWith=LL,O.pullAt=DL,O.range=ZO,O.rangeRight=KO,O.rearg=$D,O.reject=ID,O.remove=IL,O.rest=XD,O.reverse=pm,O.sampleSize=zD,O.set=JI,O.setWith=QI,O.shuffle=kD,O.slice=OL,O.sortBy=FD,O.sortedUniq=HL,O.sortedUniqBy=VL,O.split=wO,O.spread=jD,O.tail=GL,O.take=qL,O.takeRight=WL,O.takeRightWhile=$L,O.takeWhile=XL,O.tap=lD,O.throttle=YD,O.thru=gh,O.toArray=$x,O.toPairs=Jx,O.toPairsIn=Qx,O.toPath=nz,O.toPlainObject=jx,O.transform=tO,O.unary=ZD,O.union=jL,O.unionBy=YL,O.unionWith=ZL,O.uniq=KL,O.uniqBy=JL,O.uniqWith=QL,O.unset=eO,O.unzip=mm,O.unzipWith=Lx,O.update=nO,O.updateWith=iO,O.values=Oa,O.valuesIn=sO,O.without=tD,O.words=nb,O.wrap=KD,O.xor=eD,O.xorBy=nD,O.xorWith=iD,O.zip=sD,O.zipObject=rD,O.zipObjectDeep=oD,O.zipWith=aD,O.entries=Jx,O.entriesIn=Qx,O.extend=Yx,O.extendWith=Mh,Am(O,O),O.add=sz,O.attempt=ib,O.camelCase=lO,O.capitalize=tb,O.ceil=rz,O.clamp=rO,O.clone=QD,O.cloneDeep=eI,O.cloneDeepWith=nI,O.cloneWith=tI,O.conformsTo=iI,O.deburr=eb,O.defaultTo=UO,O.divide=oz,O.endsWith=cO,O.eq=ps,O.escape=uO,O.escapeRegExp=hO,O.every=_D,O.find=xD,O.findIndex=Ex,O.findKey=II,O.findLast=bD,O.findLastIndex=Tx,O.findLastKey=OI,O.floor=az,O.forEach=Ix,O.forEachRight=Ox,O.forIn=zI,O.forInRight=kI,O.forOwn=UI,O.forOwnRight=NI,O.get=xm,O.gt=sI,O.gte=rI,O.has=HI,O.hasIn=bm,O.head=Px,O.identity=di,O.includes=ED,O.indexOf=bL,O.inRange=oO,O.invoke=qI,O.isArguments=Mo,O.isArray=pe,O.isArrayBuffer=oI,O.isArrayLike=hi,O.isArrayLikeObject=wn,O.isBoolean=aI,O.isBuffer=Fr,O.isDate=lI,O.isElement=cI,O.isEmpty=uI,O.isEqual=hI,O.isEqualWith=fI,O.isError=_m,O.isFinite=dI,O.isFunction=sr,O.isInteger=Vx,O.isLength=bh,O.isMap=Gx,O.isMatch=pI,O.isMatchWith=mI,O.isNaN=gI,O.isNative=vI,O.isNil=yI,O.isNull=_I,O.isNumber=qx,O.isObject=hn,O.isObjectLike=mn,O.isPlainObject=fc,O.isRegExp=ym,O.isSafeInteger=xI,O.isSet=Wx,O.isString=wh,O.isSymbol=Li,O.isTypedArray=Ia,O.isUndefined=bI,O.isWeakMap=wI,O.isWeakSet=MI,O.join=EL,O.kebabCase=fO,O.last=ss,O.lastIndexOf=TL,O.lowerCase=dO,O.lowerFirst=pO,O.lt=SI,O.lte=AI,O.max=lz,O.maxBy=cz,O.mean=uz,O.meanBy=hz,O.min=fz,O.minBy=dz,O.stubArray=Tm,O.stubFalse=Cm,O.stubObject=JO,O.stubString=QO,O.stubTrue=tz,O.multiply=pz,O.nth=CL,O.noConflict=qO,O.noop=Em,O.now=_h,O.pad=mO,O.padEnd=gO,O.padStart=vO,O.parseInt=_O,O.random=aO,O.reduce=LD,O.reduceRight=DD,O.repeat=yO,O.replace=xO,O.result=KI,O.round=mz,O.runInContext=K,O.sample=OD,O.size=UD,O.snakeCase=bO,O.some=ND,O.sortedIndex=zL,O.sortedIndexBy=kL,O.sortedIndexOf=UL,O.sortedLastIndex=NL,O.sortedLastIndexBy=FL,O.sortedLastIndexOf=BL,O.startCase=MO,O.startsWith=SO,O.subtract=gz,O.sum=vz,O.sumBy=_z,O.template=AO,O.times=ez,O.toFinite=rr,O.toInteger=xe,O.toLength=Xx,O.toLower=EO,O.toNumber=rs,O.toSafeInteger=EI,O.toString=Ge,O.toUpper=TO,O.trim=CO,O.trimEnd=PO,O.trimStart=RO,O.truncate=LO,O.unescape=DO,O.uniqueId=iz,O.upperCase=IO,O.upperFirst=wm,O.each=Ix,O.eachRight=Ox,O.first=Px,Am(O,function(){var u={};return Is(O,function(p,x){qe.call(O.prototype,x)||(u[x]=p)}),u}(),{chain:!1}),O.VERSION=n,Qi(["bind","bindKey","curry","curryRight","partial","partialRight"],function(u){O[u].placeholder=O}),Qi(["drop","take"],function(u,p){Re.prototype[u]=function(x){x=x===e?1:Dn(xe(x),0);var E=this.__filtered__&&!p?new Re(this):this.clone();return E.__filtered__?E.__takeCount__=Wn(x,E.__takeCount__):E.__views__.push({size:Wn(x,nt),type:u+(E.__dir__<0?"Right":"")}),E},Re.prototype[u+"Right"]=function(x){return this.reverse()[u](x).reverse()}}),Qi(["filter","map","takeWhile"],function(u,p){var x=p+1,E=x==G||x==et;Re.prototype[u]=function(R){var z=this.clone();return z.__iteratees__.push({iteratee:se(R,3),type:x}),z.__filtered__=z.__filtered__||E,z}}),Qi(["head","last"],function(u,p){var x="take"+(p?"Right":"");Re.prototype[u]=function(){return this[x](1).value()[0]}}),Qi(["initial","tail"],function(u,p){var x="drop"+(p?"":"Right");Re.prototype[u]=function(){return this.__filtered__?new Re(this):this[x](1)}}),Re.prototype.compact=function(){return this.filter(di)},Re.prototype.find=function(u){return this.filter(u).head()},Re.prototype.findLast=function(u){return this.reverse().find(u)},Re.prototype.invokeMap=Ee(function(u,p){return typeof u=="function"?new Re(this):this.map(function(x){return oc(x,u,p)})}),Re.prototype.reject=function(u){return this.filter(xh(se(u)))},Re.prototype.slice=function(u,p){u=xe(u);var x=this;return x.__filtered__&&(u>0||p<0)?new Re(x):(u<0?x=x.takeRight(-u):u&&(x=x.drop(u)),p!==e&&(p=xe(p),x=p<0?x.dropRight(-p):x.take(p-u)),x)},Re.prototype.takeRightWhile=function(u){return this.reverse().takeWhile(u).reverse()},Re.prototype.toArray=function(){return this.take(nt)},Is(Re.prototype,function(u,p){var x=/^(?:filter|find|map|reject)|While$/.test(p),E=/^(?:head|last)$/.test(p),R=O[E?"take"+(p=="last"?"Right":""):p],z=E||/^find/.test(p);R&&(O.prototype[p]=function(){var q=this.__wrapped__,j=E?[1]:arguments,it=q instanceof Re,yt=j[0],xt=it||pe(q),At=function(Ce){var Le=R.apply(O,Dr([Ce],j));return E&&Bt?Le[0]:Le};xt&&x&&typeof yt=="function"&&yt.length!=1&&(it=xt=!1);var Bt=this.__chain__,Yt=!!this.__actions__.length,oe=z&&!Bt,Me=it&&!Yt;if(!z&&xt){q=Me?q:new Re(this);var ae=u.apply(q,j);return ae.__actions__.push({func:gh,args:[At],thisArg:e}),new es(ae,Bt)}return oe&&Me?u.apply(this,j):(ae=this.thru(At),oe?E?ae.value()[0]:ae.value():ae)})}),Qi(["pop","push","shift","sort","splice","unshift"],function(u){var p=Vu[u],x=/^(?:push|sort|unshift)$/.test(u)?"tap":"thru",E=/^(?:pop|shift)$/.test(u);O.prototype[u]=function(){var R=arguments;if(E&&!this.__chain__){var z=this.value();return p.apply(pe(z)?z:[],R)}return this[x](function(q){return p.apply(pe(q)?q:[],R)})}}),Is(Re.prototype,function(u,p){var x=O[p];if(x){var E=x.name+"";qe.call(Ca,E)||(Ca[E]=[]),Ca[E].push({name:p,func:x})}}),Ca[ch(e,v).name]=[{name:"wrapper",func:e}],Re.prototype.clone=DP,Re.prototype.reverse=IP,Re.prototype.value=OP,O.prototype.at=cD,O.prototype.chain=uD,O.prototype.commit=hD,O.prototype.next=fD,O.prototype.plant=pD,O.prototype.reverse=mD,O.prototype.toJSON=O.prototype.valueOf=O.prototype.value=gD,O.prototype.first=O.prototype.head,Ql&&(O.prototype[Ql]=dD),O},Aa=hP();mo?((mo.exports=Aa)._=Aa,Sp._=Aa):Bn._=Aa}).call(te)})(Vf,Vf.exports);Vf.exports;const yV=()=>vV("threlte-controls",{orbitControls:us(void 0)}),Vw={type:"change"},cg={type:"start"},Gw={type:"end"},ff=new la,qw=new vr,xV=Math.cos(70*gS.DEG2RAD);let bV=class extends Gi{constructor(t,e){super(),this.object=t,this.domElement=e,this.domElement.style.touchAction="none",this.enabled=!0,this.target=new N,this.minDistance=0,this.maxDistance=1/0,this.minZoom=0,this.maxZoom=1/0,this.minPolarAngle=0,this.maxPolarAngle=Math.PI,this.minAzimuthAngle=-1/0,this.maxAzimuthAngle=1/0,this.enableDamping=!1,this.dampingFactor=.05,this.enableZoom=!0,this.zoomSpeed=1,this.enableRotate=!0,this.rotateSpeed=1,this.enablePan=!0,this.panSpeed=1,this.screenSpacePanning=!0,this.keyPanSpeed=7,this.zoomToCursor=!1,this.autoRotate=!1,this.autoRotateSpeed=2,this.keys={LEFT:"ArrowLeft",UP:"ArrowUp",RIGHT:"ArrowRight",BOTTOM:"ArrowDown"},this.mouseButtons={LEFT:Oo.ROTATE,MIDDLE:Oo.DOLLY,RIGHT:Oo.PAN},this.touches={ONE:zo.ROTATE,TWO:zo.DOLLY_PAN},this.target0=this.target.clone(),this.position0=this.object.position.clone(),this.zoom0=this.object.zoom,this._domElementKeyEvents=null,this.getPolarAngle=function(){return a.phi},this.getAzimuthalAngle=function(){return a.theta},this.getDistance=function(){return this.object.position.distanceTo(this.target)},this.listenToKeyEvents=function(V){V.addEventListener("keydown",k),this._domElementKeyEvents=V},this.stopListenToKeyEvents=function(){this._domElementKeyEvents.removeEventListener("keydown",k),this._domElementKeyEvents=null},this.saveState=function(){n.target0.copy(n.target),n.position0.copy(n.object.position),n.zoom0=n.object.zoom},this.reset=function(){n.target.copy(n.target0),n.object.position.copy(n.position0),n.object.zoom=n.zoom0,n.object.updateProjectionMatrix(),n.dispatchEvent(Vw),n.update(),r=i.NONE},this.update=function(){const V=new N,_t=new Pn().setFromUnitVectors(t.up,new N(0,1,0)),zt=_t.clone().invert(),Ut=new N,kt=new Pn,ne=new N,_e=2*Math.PI;return function(){const Rt=n.object.position;V.copy(Rt).sub(n.target),V.applyQuaternion(_t),a.setFromVector3(V),n.autoRotate&&r===i.NONE&&H(S()),n.enableDamping?(a.theta+=l.theta*n.dampingFactor,a.phi+=l.phi*n.dampingFactor):(a.theta+=l.theta,a.phi+=l.phi);let at=n.minAzimuthAngle,Pt=n.maxAzimuthAngle;isFinite(at)&&isFinite(Pt)&&(at<-Math.PI?at+=_e:at>Math.PI&&(at-=_e),Pt<-Math.PI?Pt+=_e:Pt>Math.PI&&(Pt-=_e),at<=Pt?a.theta=Math.max(at,Math.min(Pt,a.theta)):a.theta=a.theta>(at+Pt)/2?Math.max(at,a.theta):Math.min(Pt,a.theta)),a.phi=Math.max(n.minPolarAngle,Math.min(n.maxPolarAngle,a.phi)),a.makeSafe(),n.enableDamping===!0?n.target.addScaledVector(h,n.dampingFactor):n.target.add(h),n.zoomToCursor&&T||n.object.isOrthographicCamera?a.radius=ut(a.radius):a.radius=ut(a.radius*c),V.setFromSpherical(a),V.applyQuaternion(zt),Rt.copy(n.target).add(V),n.object.lookAt(n.target),n.enableDamping===!0?(l.theta*=1-n.dampingFactor,l.phi*=1-n.dampingFactor,h.multiplyScalar(1-n.dampingFactor)):(l.set(0,0,0),h.set(0,0,0));let Nt=!1;if(n.zoomToCursor&&T){let ye=null;if(n.object.isPerspectiveCamera){const Be=V.length();ye=ut(Be*c);const Qe=Be-ye;n.object.position.addScaledVector(M,Qe),n.object.updateMatrixWorld()}else if(n.object.isOrthographicCamera){const Be=new N(A.x,A.y,0);Be.unproject(n.object),n.object.zoom=Math.max(n.minZoom,Math.min(n.maxZoom,n.object.zoom/c)),n.object.updateProjectionMatrix(),Nt=!0;const Qe=new N(A.x,A.y,0);Qe.unproject(n.object),n.object.position.sub(Qe).add(Be),n.object.updateMatrixWorld(),ye=V.length()}else console.warn("WARNING: OrbitControls.js encountered an unknown camera type - zoom to cursor disabled."),n.zoomToCursor=!1;ye!==null&&(this.screenSpacePanning?n.target.set(0,0,-1).transformDirection(n.object.matrix).multiplyScalar(ye).add(n.object.position):(ff.origin.copy(n.object.position),ff.direction.set(0,0,-1).transformDirection(n.object.matrix),Math.abs(n.object.up.dot(ff.direction))<xV?t.lookAt(n.target):(qw.setFromNormalAndCoplanarPoint(n.object.up,n.target),ff.intersectPlane(qw,n.target))))}else n.object.isOrthographicCamera&&(n.object.zoom=Math.max(n.minZoom,Math.min(n.maxZoom,n.object.zoom/c)),n.object.updateProjectionMatrix(),Nt=!0);return c=1,T=!1,Nt||Ut.distanceToSquared(n.object.position)>o||8*(1-kt.dot(n.object.quaternion))>o||ne.distanceToSquared(n.target)>0?(n.dispatchEvent(Vw),Ut.copy(n.object.position),kt.copy(n.object.quaternion),ne.copy(n.target),Nt=!1,!0):!1}}(),this.dispose=function(){n.domElement.removeEventListener("contextmenu",Et),n.domElement.removeEventListener("pointerdown",Ct),n.domElement.removeEventListener("pointercancel",Tt),n.domElement.removeEventListener("wheel",U),n.domElement.removeEventListener("pointermove",wt),n.domElement.removeEventListener("pointerup",Tt),n._domElementKeyEvents!==null&&(n._domElementKeyEvents.removeEventListener("keydown",k),n._domElementKeyEvents=null)};const n=this,i={NONE:-1,ROTATE:0,DOLLY:1,PAN:2,TOUCH_ROTATE:3,TOUCH_PAN:4,TOUCH_DOLLY_PAN:5,TOUCH_DOLLY_ROTATE:6};let r=i.NONE;const o=1e-6,a=new fv,l=new fv;let c=1;const h=new N,f=new pt,d=new pt,m=new pt,g=new pt,y=new pt,_=new pt,v=new pt,w=new pt,b=new pt,M=new N,A=new pt;let T=!1;const P=[],C={};function S(){return 2*Math.PI/60/60*n.autoRotateSpeed}function L(){return Math.pow(.95,n.zoomSpeed)}function H(V){l.theta-=V}function $(V){l.phi-=V}const B=function(){const V=new N;return function(zt,Ut){V.setFromMatrixColumn(Ut,0),V.multiplyScalar(-zt),h.add(V)}}(),G=function(){const V=new N;return function(zt,Ut){n.screenSpacePanning===!0?V.setFromMatrixColumn(Ut,1):(V.setFromMatrixColumn(Ut,0),V.crossVectors(n.object.up,V)),V.multiplyScalar(zt),h.add(V)}}(),I=function(){const V=new N;return function(zt,Ut){const kt=n.domElement;if(n.object.isPerspectiveCamera){const ne=n.object.position;V.copy(ne).sub(n.target);let _e=V.length();_e*=Math.tan(n.object.fov/2*Math.PI/180),B(2*zt*_e/kt.clientHeight,n.object.matrix),G(2*Ut*_e/kt.clientHeight,n.object.matrix)}else n.object.isOrthographicCamera?(B(zt*(n.object.right-n.object.left)/n.object.zoom/kt.clientWidth,n.object.matrix),G(Ut*(n.object.top-n.object.bottom)/n.object.zoom/kt.clientHeight,n.object.matrix)):(console.warn("WARNING: OrbitControls.js encountered an unknown camera type - pan disabled."),n.enablePan=!1)}}();function et(V){n.object.isPerspectiveCamera||n.object.isOrthographicCamera?c/=V:(console.warn("WARNING: OrbitControls.js encountered an unknown camera type - dolly/zoom disabled."),n.enableZoom=!1)}function Y(V){n.object.isPerspectiveCamera||n.object.isOrthographicCamera?c*=V:(console.warn("WARNING: OrbitControls.js encountered an unknown camera type - dolly/zoom disabled."),n.enableZoom=!1)}function J(V){if(!n.zoomToCursor)return;T=!0;const _t=n.domElement.getBoundingClientRect(),zt=V.clientX-_t.left,Ut=V.clientY-_t.top,kt=_t.width,ne=_t.height;A.x=zt/kt*2-1,A.y=-(Ut/ne)*2+1,M.set(A.x,A.y,1).unproject(t).sub(t.position).normalize()}function ut(V){return Math.max(n.minDistance,Math.min(n.maxDistance,V))}function dt(V){f.set(V.clientX,V.clientY)}function nt(V){J(V),v.set(V.clientX,V.clientY)}function ft(V){g.set(V.clientX,V.clientY)}function Lt(V){d.set(V.clientX,V.clientY),m.subVectors(d,f).multiplyScalar(n.rotateSpeed);const _t=n.domElement;H(2*Math.PI*m.x/_t.clientHeight),$(2*Math.PI*m.y/_t.clientHeight),f.copy(d),n.update()}function Ot(V){w.set(V.clientX,V.clientY),b.subVectors(w,v),b.y>0?et(L()):b.y<0&&Y(L()),v.copy(w),n.update()}function It(V){y.set(V.clientX,V.clientY),_.subVectors(y,g).multiplyScalar(n.panSpeed),I(_.x,_.y),g.copy(y),n.update()}function Kt(V){J(V),V.deltaY<0?Y(L()):V.deltaY>0&&et(L()),n.update()}function Ht(V){let _t=!1;switch(V.code){case n.keys.UP:V.ctrlKey||V.metaKey||V.shiftKey?$(2*Math.PI*n.rotateSpeed/n.domElement.clientHeight):I(0,n.keyPanSpeed),_t=!0;break;case n.keys.BOTTOM:V.ctrlKey||V.metaKey||V.shiftKey?$(-2*Math.PI*n.rotateSpeed/n.domElement.clientHeight):I(0,-n.keyPanSpeed),_t=!0;break;case n.keys.LEFT:V.ctrlKey||V.metaKey||V.shiftKey?H(2*Math.PI*n.rotateSpeed/n.domElement.clientHeight):I(n.keyPanSpeed,0),_t=!0;break;case n.keys.RIGHT:V.ctrlKey||V.metaKey||V.shiftKey?H(-2*Math.PI*n.rotateSpeed/n.domElement.clientHeight):I(-n.keyPanSpeed,0),_t=!0;break}_t&&(V.preventDefault(),n.update())}function qt(){if(P.length===1)f.set(P[0].pageX,P[0].pageY);else{const V=.5*(P[0].pageX+P[1].pageX),_t=.5*(P[0].pageY+P[1].pageY);f.set(V,_t)}}function ee(){if(P.length===1)g.set(P[0].pageX,P[0].pageY);else{const V=.5*(P[0].pageX+P[1].pageX),_t=.5*(P[0].pageY+P[1].pageY);g.set(V,_t)}}function le(){const V=P[0].pageX-P[1].pageX,_t=P[0].pageY-P[1].pageY,zt=Math.sqrt(V*V+_t*_t);v.set(0,zt)}function $t(){n.enableZoom&&le(),n.enablePan&&ee()}function Mt(){n.enableZoom&&le(),n.enableRotate&&qt()}function X(V){if(P.length==1)d.set(V.pageX,V.pageY);else{const zt=Q(V),Ut=.5*(V.pageX+zt.x),kt=.5*(V.pageY+zt.y);d.set(Ut,kt)}m.subVectors(d,f).multiplyScalar(n.rotateSpeed);const _t=n.domElement;H(2*Math.PI*m.x/_t.clientHeight),$(2*Math.PI*m.y/_t.clientHeight),f.copy(d)}function bt(V){if(P.length===1)y.set(V.pageX,V.pageY);else{const _t=Q(V),zt=.5*(V.pageX+_t.x),Ut=.5*(V.pageY+_t.y);y.set(zt,Ut)}_.subVectors(y,g).multiplyScalar(n.panSpeed),I(_.x,_.y),g.copy(y)}function W(V){const _t=Q(V),zt=V.pageX-_t.x,Ut=V.pageY-_t.y,kt=Math.sqrt(zt*zt+Ut*Ut);w.set(0,kt),b.set(0,Math.pow(w.y/v.y,n.zoomSpeed)),et(b.y),v.copy(w)}function st(V){n.enableZoom&&W(V),n.enablePan&&bt(V)}function ct(V){n.enableZoom&&W(V),n.enableRotate&&X(V)}function Ct(V){n.enabled!==!1&&(P.length===0&&(n.domElement.setPointerCapture(V.pointerId),n.domElement.addEventListener("pointermove",wt),n.domElement.addEventListener("pointerup",Tt)),Dt(V),V.pointerType==="touch"?ht(V):Xt(V))}function wt(V){n.enabled!==!1&&(V.pointerType==="touch"?St(V):Qt(V))}function Tt(V){Jt(V),P.length===0&&(n.domElement.releasePointerCapture(V.pointerId),n.domElement.removeEventListener("pointermove",wt),n.domElement.removeEventListener("pointerup",Tt)),n.dispatchEvent(Gw),r=i.NONE}function Xt(V){let _t;switch(V.button){case 0:_t=n.mouseButtons.LEFT;break;case 1:_t=n.mouseButtons.MIDDLE;break;case 2:_t=n.mouseButtons.RIGHT;break;default:_t=-1}switch(_t){case Oo.DOLLY:if(n.enableZoom===!1)return;nt(V),r=i.DOLLY;break;case Oo.ROTATE:if(V.ctrlKey||V.metaKey||V.shiftKey){if(n.enablePan===!1)return;ft(V),r=i.PAN}else{if(n.enableRotate===!1)return;dt(V),r=i.ROTATE}break;case Oo.PAN:if(V.ctrlKey||V.metaKey||V.shiftKey){if(n.enableRotate===!1)return;dt(V),r=i.ROTATE}else{if(n.enablePan===!1)return;ft(V),r=i.PAN}break;default:r=i.NONE}r!==i.NONE&&n.dispatchEvent(cg)}function Qt(V){switch(r){case i.ROTATE:if(n.enableRotate===!1)return;Lt(V);break;case i.DOLLY:if(n.enableZoom===!1)return;Ot(V);break;case i.PAN:if(n.enablePan===!1)return;It(V);break}}function U(V){n.enabled===!1||n.enableZoom===!1||r!==i.NONE||(V.preventDefault(),n.dispatchEvent(cg),Kt(V),n.dispatchEvent(Gw))}function k(V){n.enabled===!1||n.enablePan===!1||Ht(V)}function ht(V){switch(tt(V),P.length){case 1:switch(n.touches.ONE){case zo.ROTATE:if(n.enableRotate===!1)return;qt(),r=i.TOUCH_ROTATE;break;case zo.PAN:if(n.enablePan===!1)return;ee(),r=i.TOUCH_PAN;break;default:r=i.NONE}break;case 2:switch(n.touches.TWO){case zo.DOLLY_PAN:if(n.enableZoom===!1&&n.enablePan===!1)return;$t(),r=i.TOUCH_DOLLY_PAN;break;case zo.DOLLY_ROTATE:if(n.enableZoom===!1&&n.enableRotate===!1)return;Mt(),r=i.TOUCH_DOLLY_ROTATE;break;default:r=i.NONE}break;default:r=i.NONE}r!==i.NONE&&n.dispatchEvent(cg)}function St(V){switch(tt(V),r){case i.TOUCH_ROTATE:if(n.enableRotate===!1)return;X(V),n.update();break;case i.TOUCH_PAN:if(n.enablePan===!1)return;bt(V),n.update();break;case i.TOUCH_DOLLY_PAN:if(n.enableZoom===!1&&n.enablePan===!1)return;st(V),n.update();break;case i.TOUCH_DOLLY_ROTATE:if(n.enableZoom===!1&&n.enableRotate===!1)return;ct(V),n.update();break;default:r=i.NONE}}function Et(V){n.enabled!==!1&&V.preventDefault()}function Dt(V){P.push(V)}function Jt(V){delete C[V.pointerId];for(let _t=0;_t<P.length;_t++)if(P[_t].pointerId==V.pointerId){P.splice(_t,1);return}}function tt(V){let _t=C[V.pointerId];_t===void 0&&(_t=new pt,C[V.pointerId]=_t),_t.set(V.pageX,V.pageY)}function Q(V){const _t=V.pointerId===P[0].pointerId?P[1]:P[0];return C[_t.pointerId]}n.domElement.addEventListener("contextmenu",Et),n.domElement.addEventListener("pointerdown",Ct),n.domElement.addEventListener("pointercancel",Tt),n.domElement.addEventListener("wheel",U,{passive:!1}),this.update()}};const wV=s=>({ref:s&1}),Ww=s=>({ref:s[0]});function MV(s){let t;const e=s[7].default,n=ia(e,s,s[10],Ww);return{c(){n&&n.c()},l(i){n&&n.l(i)},m(i,r){n&&n.m(i,r),t=!0},p(i,r){n&&n.p&&(!t||r&1025)&&sa(n,e,i,i[10],t?oa(e,i[10],r,wV):ra(i[10]),Ww)},i(i){t||($e(n,i),t=!0)},o(i){Ye(n,i),t=!1},d(i){n&&n.d(i)}}}function SV(s){let t,e;const n=[{is:s[0]},s[6]];let i={$$slots:{default:[MV,({ref:r})=>({0:r}),({ref:r})=>r?1:0]},$$scope:{ctx:s}};for(let r=0;r<n.length;r+=1)i=Hc(i,n[r]);return t=new RA({props:i}),s[8](t),t.$on("change",s[3]),t.$on("create",s[9]),{c(){xi(t.$$.fragment)},l(r){bi(t.$$.fragment,r)},m(r,o){wi(t,r,o),e=!0},p(r,[o]){const a=o&65?Ez(n,[o&1&&{is:r[0]},o&64&&Tz(r[6])]):{};o&1025&&(a.$$scope={dirty:o,ctx:r}),t.$set(a)},i(r){e||($e(t.$$.fragment,r),e=!0)},o(r){Ye(t.$$.fragment,r),e=!1},d(r){s[8](null),Mi(t,r)}}}function AV(s,t,e){const n=["ref"];let i=kf(t,n),r,o,{$$slots:a={},$$scope:l}=t;const c=SA();no(s,c,b=>e(11,r=b));const{renderer:h,invalidate:f}=Nl();if(!h)throw new Error("Threlte Context missing: Is <OrbitControls> a child of <Canvas>?");if(!(r instanceof Dl))throw new Error("Parent missing: <OrbitControls> need to be a child of a <Camera>");const d=new bV(r,h.domElement),{start:m,stop:g}=LA(()=>d.update(),{autostart:!1,debugFrameloopMessage:"OrbitControls: updating controls"}),y=_V();no(s,y,b=>e(1,o=b));const{orbitControls:_}=yV();function v(b){DM[b?"unshift":"push"](()=>{o=b,y.set(o)})}const w=({ref:b,cleanup:M})=>{_.set(b),M(()=>{_.set(void 0)})};return s.$$set=b=>{t=Hc(Hc({},t),Mg(b)),e(6,i=kf(t,n)),"$$scope"in b&&e(10,l=b.$$scope)},s.$$.update=()=>{i.autoRotate||i.enableDamping?m():g()},[d,o,c,f,y,_,i,a,v,w,l]}class EV extends Xi{constructor(t){super(),ji(this,t,AV,SV,$i,{ref:0})}get ref(){return this.$$.ctx[0]}}new de;new de;new Xe;class TV{static apply(t){t.set=function(e){const n=this.options||{},i=Object.entries(e).reduce(function(r,[o,a]){return n[o]!==a&&(r[o]=a),r},{});this.options=Object.assign(n,i),this.trigger({type:"change",options:e,changes:i})},t.get=function(){return this.options},t.api=function(e,n){return e||(e={}),n&&Object.entries(e).forEach(function([i,r]){typeof r=="function"&&(e[i]=(...o)=>r(...o,n))}),e.set=this.set.bind(this),e.get=this.get.bind(this),e}}}class Ss{static bind(t,e){return function(n,i){i.__binds||(i.__binds=[]);let r=t;Array.isArray(n)&&(r=n[0],n=n[1]);const o=/^([^.:]*(?:\.[^.:]+)*)?(?::(.*))?$/.exec(n),a=o[1].split(/\./g),l=a.pop(),c=o[2]||l,h=a.shift();let f={this:i}[h]||e[h]||t[h]||r;for(;f&&(n=a.shift());)f=f[n];if(f&&(f.on||f.addEventListener)){const d=function(g){i[c]&&i[c](g,t)};Ss._polyfill(f,["addEventListener","on"],function(g){f[g](l,d)});const m={target:f,name:l,callback:d};return i.__binds.push(m),d}else throw"Cannot bind '"+n+"' in "+this.__name}}static unbind(){return function(t){t.__binds&&(t.__binds.forEach((function(e){Ss._polyfill(e.target,["removeEventListener","off"],function(n){e.target[n](e.name,e.callback)})}).bind(this)),t.__binds=[])}}static apply(t){t.trigger=Ss._trigger,t.triggerOnce=Ss._triggerOnce,t.hasEventListener=Gi.prototype.hasEventListener,t.addEventListener=Gi.prototype.addEventListener,t.removeEventListener=Gi.prototype.removeEventListener,t.on=t.addEventListener,t.off=t.removeEventListener,t.dispatchEvent=t.trigger}static _triggerOnce(t){this.trigger(t),this._listeners&&delete this._listeners[t.type]}static _trigger(t){if(this._listeners===void 0)return;const e=t.type;let n=this._listeners[e];if(n!==void 0){n=n.slice();const i=n.length;t.target=this;for(let r=0;r<i;r++)n[r].call(this,t,this)}}static _polyfill(t,e,n){e.map(function(i){return t.method}),e.length&&n(e[0])}}function $w(s){return s&&typeof s.valueOf()=="string"}const CV=(s,t)=>{let e=0;for(const n of s){if(t(n,e,s)===!1)break;e++}};class Ue{static initClass(){this.Plugins={},this.Aliases={}}static registerPlugin(t,e){const n=function(i){Ue.Plugin.call(this,i),this.__name=t};n.prototype=Object.assign(new Ue.Plugin,e),this.Plugins[t]=n}static unregisterPlugin(t){delete this.Plugins[t]}static registerAlias(t,e){this.Aliases[t]=e}static unregisterAlias(t){delete this.Aliases[t]}constructor(t){if(t){let i=[].slice.apply(arguments);if(t={},i[0]instanceof Node){const r=i[0];i=i.slice(1),t.element=r}$w(i[0])?t.plugins=i:Array.isArray(i[0])?t.plugins=i[0]:i[0]&&(t=Object.assign({},i[0],t))}const e={init:!0,element:document.body,plugins:["core"],aliases:{},plugindb:Ue.Plugins||{},aliasdb:Ue.Aliases||{}};this.__options=Object.assign({},e,t||{}),this.__inited=!1,this.__destroyed=!1,this.__installed=[];let n=this.__options.element;n===""+n&&(n=document.querySelector(n)),this.plugins={},this.element=n,this.trigger=this.trigger.bind(this),this.frame=this.frame.bind(this),this.events=["pre","update","render","post"].map(function(i){return{type:i}}),this.__options.init&&this.init()}init(){this.__inited||(this.__inited=!0,this.install(this.__options.plugins))}destroy(){this.__inited&&(this.__destroyed||(this.__destroyed=!0,this.trigger({type:"destroy"}),this.uninstall()))}frame(){this.events.map(this.trigger)}resolve(t){t=Array.isArray(t)?t:[t];const e=this.__options,n=Object.assign({},e.aliasdb,e.aliases),i=function(o){const a=o.split(":");return a[1]?(n[a[0]]=[a[1]],!1):!0};t=t.filter(i),Object.entries(n).forEach(function([o,a]){n[o]=Array.isArray(a)?a:[a]});function r(o,a,l){if(l>=256)throw"Plug-in alias recursion detected.";return o=o.filter(i),o.forEach(function(c){const h=n[c];h?a=a.concat(r(h,[],l+1)):a.push(c)}),a}return r(t,[],0)}install(t){t=Array.isArray(t)?t:[t],t=this.resolve(t),CV(t,e=>this.__install(e)),this.__ready()}uninstall(t){t&&(t=Array.isArray(t)?t:[t],t=this.resolve(t)),(t||this.__installed).reverse().forEach(e=>this.__uninstall(e))}__install(t){const e=this.__options.plugindb[t];if(!e)throw"[three.install] Cannot install. '"+t+"' is not registered.";if(this.plugins[t])return console.warn("[three.install] "+t+" is already installed.");const n=e,i=new n(this.__options[t]||{},t);this.plugins[t]=i;const r=i.install(this);return this.__installed.push(i),this.trigger({type:"install",plugin:i}),r}__uninstall(t){const e=$w(t)?this.plugins[t]:t;if(!e){console.warn("[three.uninstall] "+t+"' is not installed.");return}t=e.__name,e.uninstall(this),this.__installed=this.__installed.filter(n=>n!==e),delete this.plugins[t],this.trigger({type:"uninstall",plugin:e})}__ready(){this.triggerOnce({type:"ready"})}}Ue.initClass();Ue.Plugin=function(s){this.options=Object.assign({},this.defaults,s||{})};Ue.Plugin.prototype={listen:[],defaults:{},install:function(s){},uninstall:function(s){}};Ss.apply(Ue.prototype);Ss.apply(Ue.Plugin.prototype);TV.apply(Ue.Plugin.prototype);Ue.registerPlugin("splash",{defaults:{color:"mono",fancy:!0},listen:["ready","mathbox/init:init","mathbox/progress:progress","mathbox/destroy:destroy"],uninstall(){return this.destroy()},ready(s,t){if(t.MathBox&&!this.div)return this.init(s,t)},init(s,t){let e;this.destroy();const{color:n}=this.options,i=`<div class="mathbox-loader mathbox-splash-${n}">
  <div class="mathbox-logo">
    <div> <div></div><div></div><div></div> </div>
    <div> <div></div><div></div><div></div> </div>
  </div>
  <div class="mathbox-progress"><div></div></div>
</div>`;this.div=e=document.createElement("div"),e.innerHTML=i,t.element.appendChild(e);const r=Math.random()*2-1,o=Math.random()*2-1,a=Math.random()*2-1,l=1/Math.sqrt(r*r+o*o+a*a);return this.loader=e.querySelector(".mathbox-loader"),this.bar=e.querySelector(".mathbox-progress > div"),this.gyro=e.querySelectorAll(".mathbox-logo > div"),this.transforms=["rotateZ(22deg) rotateX(24deg) rotateY(30deg)","rotateZ(11deg) rotateX(12deg) rotateY(15deg) scale3d(.6, .6, .6)"],this.random=[r*l,o*l,a*l],this.start=t.Time.now,this.timer=null},progress(s,t){if(!this.div)return;const{current:e,total:n}=s,i=e<n;clearTimeout(this.timer),i?(this.loader.classList.remove("mathbox-exit"),this.loader.style.display="block"):(this.loader.classList.add("mathbox-exit"),this.timer=setTimeout(()=>this.loader.style.display="none",150));const r=e<n?Math.round(1e3*e/n)*.1+"%":"100%";if(this.bar.style.width=r,this.options.fancy){const o=this.random,a=Math.max(0,Math.min(1,t.Time.now-this.start)),l=function(c,h){return h==null&&(h=0),c.replace(/(-?[0-9.e]+)deg/g,(f,d)=>+d+o[h++]*a*t.Time.step*60+"deg")};return(()=>{const c=[];for(let h=0;h<this.gyro.length;h++){let f;const d=this.gyro[h];this.transforms[h]=f=l(this.transforms[h]),c.push(d.style.transform=d.style.WebkitTransform=f)}return c})()}},destroy(){return this.div!=null&&this.div.remove(),this.div=null}});Ue.registerAlias("empty",["fallback","bind","renderer","size","fill","loop","time"]);Ue.registerAlias("core",["empty","scene","camera","render","warmup"]);Ue.registerAlias("VR",["core","cursor","fullscreen","render:vr"]);Ue.registerPlugin("bind",{install:function(s){const t={three:s,window};s.bind=Ss.bind(s,t),s.unbind=Ss.unbind(s),s.bind("install:bind",this),s.bind("uninstall:unbind",this)},uninstall:function(s){s.unbind(this),delete s.bind,delete s.unbind},bind:function(s,t){const e=s.plugin,n=e.listen;n&&n.forEach(function(i){t.bind(i,e)})},unbind:function(s,t){t.unbind(s.plugin)}});Ue.registerPlugin("camera",{defaults:{near:.01,far:1e4,type:"perspective",fov:60,aspect:null,left:-1,right:1,bottom:-1,top:1,klass:null,parameters:null},listen:["resize","this.change"],install:function(s){s.Camera=this.api(),s.camera=null,this.aspect=1,this.change({},s)},uninstall:function(s){delete s.Camera,delete s.camera},change:function(s,t){const e=this.options,n=t.camera;if(!t.camera||s.changes.type||s.changes.klass){const i=e.klass||{perspective:nn,orthographic:bu}[e.type]||Dl;t.camera=e.parameters?new i(e.parameters):new i}Object.entries(e).forEach((function([i]){Object.prototype.hasOwnProperty.call(t.camera,i)&&(t.camera[i]=e[i])}).bind(this)),this.update(t),n===t.camera||t.trigger({type:"camera",camera:t.camera})},resize:function(s,t){this.aspect=s.viewWidth/Math.max(1,s.viewHeight),this.update(t)},update:function(s){s.camera.aspect=this.options.aspect||this.aspect,s.camera.updateProjectionMatrix()}});Ue.registerPlugin("fallback",{defaults:{force:!1,fill:!0,begin:'<div class="threestrap-fallback" style="display: table; width: 100%; height: 100%;box-sizing: border-box; border: 1px dashed rgba(0, 0, 0, .25);"><div style="display: table-cell; padding: 10px; vertical-align: middle; text-align: center;">',end:"</div></div>",message:'<big><strong>This example requires WebGL</strong></big><br>Visit <a target="_blank" href="http://get.webgl.org/">get.webgl.org</a> for more info</a>'},install:function(s){let t,e;try{if(t=document.createElement("canvas"),e=t.getContext("webgl")||t.getContext("experimental-webgl"),!e||this.options.force)throw"WebGL unavailable.";s.fallback=!1}catch{const i=this.options.message,r=this.options.begin,o=this.options.end,a=this.options.fill,l=document.createElement("div");for(l.innerHTML=r+i+o,this.children=[];l.childNodes.length>0;)this.children.push(l.firstChild),s.element.appendChild(l.firstChild);return a&&s.install("fill"),this.div=l,s.fallback=!0,!1}},uninstall:function(s){this.children&&(this.children.forEach(function(t){t.parentNode.removeChild(t)}),this.children=null),delete s.fallback}});Ue.registerPlugin("fill",{defaults:{block:!0,body:!0,layout:!0},install:function(s){function t(n){const i=n.style.height;return i=="auto"||i==""}function e(n){return n.style.height="100%",n.style.margin=0,n.style.padding=0,n}this.options.body&&s.element==document.body&&(this.applied=[s.element,document.documentElement].filter(t).map(e)),this.options.block&&s.canvas&&(s.canvas.style.display="block",this.block=!0),this.options.layout&&s.element&&window.getComputedStyle(s.element).position=="static"&&(s.element.style.position="relative",this.layout=!0)},uninstall:function(s){if(this.applied){const t=function(e){return e.style.height="",e.style.margin="",e.style.padding="",e};this.applied.map(t),delete this.applied}this.block&&s.canvas&&(s.canvas.style.display="",delete this.block),this.layout&&s.element&&(s.element.style.position="",delete this.layout)},change:function(s){this.uninstall(s),this.install(s)}});Ue.registerPlugin("loop",{defaults:{start:!0,each:1},listen:["ready"],install:function(s){this.running=!1,this.lastRequestId=null,s.Loop=this.api({start:this.start.bind(this),stop:this.stop.bind(this),running:!1,window},s),this.events=["pre","update","render","post"].map(function(t){return{type:t}})},uninstall:function(s){this.stop(s)},ready:function(s,t){this.options.start&&this.start(t)},start:function(s){if(this.running)return;s.Loop.running=this.running=!0;const t=s.trigger.bind(s),e=(function(){this.running&&(this.lastRequestId=s.Loop.window.requestAnimationFrame(e),this.events.map(t))}).bind(this);this.lastRequestId=s.Loop.window.requestAnimationFrame(e),s.trigger({type:"start"})},stop:function(s){this.running&&(s.Loop.running=this.running=!1,s.Loop.window.cancelAnimationFrame(this.lastRequestId),this.lastRequestId=null,s.trigger({type:"stop"}))}});Ue.registerPlugin("render",{listen:["render"],render:function(s,t){t.scene&&t.camera&&t.renderer.render(t.scene,t.camera)}});Ue.registerPlugin("renderer",{defaults:{klass:y_,parameters:{depth:!0,stencil:!0,preserveDrawingBuffer:!0,antialias:!0}},listen:["resize"],install:function(s){const t=s.renderer=new this.options.klass(this.options.parameters);s.canvas=t.domElement,s.element.appendChild(t.domElement)},uninstall:function(s){s.element.removeChild(s.renderer.domElement),delete s.renderer,delete s.canvas},resize:function(s,t){const e=t.renderer,n=e.domElement;n&&n.tagName=="CANVAS"?e.setSize(s.renderWidth,s.renderHeight,!1):(e.setRenderSize&&e.setRenderSize(s.renderWidth,s.renderHeight),e.setSize(s.viewWidth,s.viewHeight,!1))}});Ue.registerPlugin("scene",{install:function(s){s.scene=new zl},uninstall:function(s){delete s.scene}});Ue.registerPlugin("size",{defaults:{width:null,height:null,aspect:null,scale:1,maxRenderWidth:1/0,maxRenderHeight:1/0,devicePixelRatio:!0},listen:["window.resize:queue","element.resize:queue","this.change:queue","ready:resize","pre:pre"],install:function(s){s.Size=this.api({renderWidth:0,renderHeight:0,viewWidth:0,viewHeight:0}),this.resized=!1},uninstall:function(s){delete s.Size},queue:function(s,t){this.resized=!0},pre:function(s,t){this.resized&&(this.resized=!1,this.resize(s,t))},resize:function(s,t){const e=this.options,n=t.element,i=t.renderer;let r,o,a,l,c,h,f,d,m=0,g=0;r=a=e.width===void 0||e.width==null?n.offsetWidth||n.innerWidth||0:e.width,o=l=e.height===void 0||e.height==null?n.offsetHeight||n.innerHeight||0:e.height,f=r/o,e.aspect&&(e.aspect>f?(o=Math.round(r/e.aspect),g=Math.floor((l-o)/2)):(r=Math.round(o*e.aspect),m=Math.floor((a-r)/2)),f=r/o),d=1,e.devicePixelRatio&&typeof window<"u"&&(d=window.devicePixelRatio||1),c=Math.round(Math.min(r*d*e.scale,e.maxRenderWidth)),h=Math.round(Math.min(o*d*e.scale,e.maxRenderHeight)),c/h>f?c=Math.round(h*f):h=Math.round(c/f),d=h/o;const _=i.domElement.style;_.width=r+"px",_.height=o+"px",_.marginLeft=m+"px",_.marginTop=g+"px",Object.assign(t.Size,{renderWidth:c,renderHeight:h,viewWidth:r,viewHeight:o,aspect:f,pixelRatio:d}),t.trigger({type:"resize",renderWidth:c,renderHeight:h,viewWidth:r,viewHeight:o,aspect:f,pixelRatio:d})}});Ue.registerPlugin("time",{defaults:{speed:1,warmup:0,timeout:1},listen:["pre:tick","this.change"],now:function(){return+new Date/1e3},install:function(s){s.Time=this.api({now:this.now(),clock:0,step:1/60,frames:0,time:0,delta:1/60,average:0,fps:0}),this.last=0,this.time=0,this.clock=0,this.wait=this.options.warmup,this.clockStart=0,this.timeStart=0},tick:function(s,t){const e=this.options.speed,n=this.options.timeout,i=t.Time,r=i.now=this.now(),o=this.last;let a=this.time,l=this.clock;if(o){let c=i.delta=r-o;const h=i.average||c;c>n&&(c=0);const f=c*e;a+=c,l+=f,i.frames>0&&(i.average=h+(c-h)*.1,i.fps=1/h),i.step=f,i.clock=l-this.clockStart,i.time=a-this.timeStart,i.frames++,this.wait-- >0&&(this.clockStart=l,this.timeStart=a,i.clock=0,i.step=1e-100)}this.last=r,this.clock=l,this.time=a},uninstall:function(s){delete s.Time}});Ue.registerPlugin("warmup",{defaults:{delay:2},listen:["ready","post"],ready:function(s,t){t.renderer.domElement.style.visibility="hidden",this.frame=0,this.hidden=!0},post:function(s,t){this.hidden&&this.frame>=this.options.delay&&(t.renderer.domElement.style.visibility="visible",this.hidden=!1),this.frame++}});Ue.registerPlugin("controls",{listen:["update","resize","camera","this.change"],defaults:{klass:null,parameters:{}},install:function(s){if(!this.options.klass)throw"Must provide class for `controls.klass`";s.controls=null,this._camera=s.camera||new nn,this.change(null,s)},uninstall:function(s){delete s.controls},change:function(s,t){this.options.klass?((!s||s.changes.klass)&&(t.controls=new this.options.klass(this._camera,t.renderer.domElement)),Object.assign(t.controls,this.options.parameters)):t.controls=null},update:function(s,t){const e=t.Time&&t.Time.delta||.016666666666666666,n=t.VR&&t.VR.state;t.controls.vr&&t.controls.vr(n),t.controls.update(e)},camera:function(s,t){t.controls.object=this._camera=s.camera},resize:function(s,t){t.controls.handleResize&&t.controls.handleResize()}});Ue.registerPlugin("cursor",{listen:["update","this.change","install:change","uninstall:change","element.mousemove","vr"],defaults:{cursor:null,hide:!1,timeout:3},install:function(s){this.timeout=this.options.timeout,this.element=s.element,this.change(null,s)},uninstall:function(s){delete s.controls},change:function(s,t){this.applyCursor(t)},mousemove:function(s,t){this.options.hide&&(this.applyCursor(t),this.timeout=+this.options.timeout||0)},update:function(s,t){const e=t.Time&&t.Time.delta||.016666666666666666;this.options.hide&&(this.timeout-=e,this.timeout<0&&this.applyCursor(t,"none"))},vr:function(s,t){this.hide=s.active&&!s.hmd.fake,this.applyCursor(t)},applyCursor:function(s,t){const e=s.controls?"move":"";t=t||this.options.cursor||e,this.hide&&(t="none"),this.cursor!=t&&(this.element.style.cursor=t)}});Ue.registerPlugin("fullscreen",{defaults:{key:"f"},listen:["ready","update"],install:function(s){s.Fullscreen=this.api({active:!1,toggle:this.toggle.bind(this)},s)},uninstall:function(s){delete s.Fullscreen},ready:function(s,t){document.body.addEventListener("keypress",(function(n){this.options.key&&n.charCode==this.options.key.charCodeAt(0)&&this.toggle(t)}).bind(this));const e=(function(){const n=!!document.fullscreenElement||!!document.mozFullScreenElement||!!document.webkitFullscreenElement||!!document.msFullscreenElement;t.Fullscreen.active=this.active=n,t.trigger({type:"fullscreen",active:n})}).bind(this);document.addEventListener("fullscreenchange",e,!1),document.addEventListener("webkitfullscreenchange",e,!1),document.addEventListener("mozfullscreenchange",e,!1)},toggle:function(s){const t=s.canvas,e=s.VR&&s.VR.active?{vrDisplay:s.VR.hmd}:{};this.active?document.exitFullscreen?document.exitFullscreen():document.msExitFullscreen?document.msExitFullscreen():document.webkitExitFullscreen?document.webkitExitFullscreen():document.mozCancelFullScreen&&document.mozCancelFullScreen():t.requestFullScreen?t.requestFullScreen(e):t.msRequestFullScreen?t.msRequestFullscreen(e):t.webkitRequestFullscreen?t.webkitRequestFullscreen(e):t.mozRequestFullScreen&&t.mozRequestFullScreen(e)}});var DA={exports:{}};(function(s,t){(function(e,n){s.exports=n()})(te,function(){var e=function(){function n(m){return o.appendChild(m.dom),m}function i(m){for(var g=0;g<o.children.length;g++)o.children[g].style.display=g===m?"block":"none";r=m}var r=0,o=document.createElement("div");o.style.cssText="position:fixed;top:0;left:0;cursor:pointer;opacity:0.9;z-index:10000",o.addEventListener("click",function(m){m.preventDefault(),i(++r%o.children.length)},!1);var a=(performance||Date).now(),l=a,c=0,h=n(new e.Panel("FPS","#0ff","#002")),f=n(new e.Panel("MS","#0f0","#020"));if(self.performance&&self.performance.memory)var d=n(new e.Panel("MB","#f08","#201"));return i(0),{REVISION:16,dom:o,addPanel:n,showPanel:i,begin:function(){a=(performance||Date).now()},end:function(){c++;var m=(performance||Date).now();if(f.update(m-a,200),m>l+1e3&&(h.update(1e3*c/(m-l),100),l=m,c=0,d)){var g=performance.memory;d.update(g.usedJSHeapSize/1048576,g.jsHeapSizeLimit/1048576)}return m},update:function(){a=this.end()},domElement:o,setMode:i}};return e.Panel=function(n,i,r){var o=1/0,a=0,l=Math.round,c=l(window.devicePixelRatio||1),h=80*c,f=48*c,d=3*c,m=2*c,g=3*c,y=15*c,_=74*c,v=30*c,w=document.createElement("canvas");w.width=h,w.height=f,w.style.cssText="width:80px;height:48px";var b=w.getContext("2d");return b.font="bold "+9*c+"px Helvetica,Arial,sans-serif",b.textBaseline="top",b.fillStyle=r,b.fillRect(0,0,h,f),b.fillStyle=i,b.fillText(n,d,m),b.fillRect(g,y,_,v),b.fillStyle=r,b.globalAlpha=.9,b.fillRect(g,y,_,v),{dom:w,update:function(M,A){o=Math.min(o,M),a=Math.max(a,M),b.fillStyle=r,b.globalAlpha=1,b.fillRect(0,0,h,y),b.fillStyle=i,b.fillText(l(M)+" "+n+" ("+l(o)+"-"+l(a)+")",d,m),b.drawImage(w,g+c,y,_-c,v,g,y,_-c,v),b.fillRect(g+_-c,y,c,v),b.fillStyle=r,b.globalAlpha=.9,b.fillRect(g+_-c,y,c,l((1-M/A)*v))}}},e})})(DA);var PV=DA.exports;const RV=mu(PV);Ue.registerPlugin("stats",{listen:["pre","post"],install:function(s){const t=this.stats=new RV,e=t.domElement.style;e.position="absolute",e.top=e.left=0,s.element.appendChild(t.domElement),s.stats=t},uninstall:function(s){this.stats.domElement.remove(),delete s.stats},pre:function(s,t){this.stats.begin()},post:function(s,t){this.stats.end()}});Ue.registerPlugin("ui",{defaults:{theme:"white",style:".threestrap-ui { position: absolute; bottom: 5px; right: 5px; float: left; }.threestrap-ui button { border: 0; background: none;  vertical-align: middle; font-weight: bold; } .threestrap-ui .glyphicon { top: 2px; font-weight: bold; } @media (max-width: 640px) { .threestrap-ui button { font-size: 120% } }.threestrap-white button { color: #fff; text-shadow: 0 1px 1px rgba(0, 0, 0, 1), 0 1px 3px rgba(0, 0, 0, 1); }.threestrap-black button { color: #000; text-shadow: 0 0px 1px rgba(255, 255, 255, 1), 0 0px 2px rgba(255, 255, 255, 1), 0 0px 2px rgba(255, 255, 255, 1) }"},listen:["fullscreen"],markup:function(s,t,e){let n="//netdna.bootstrapcdn.com/bootstrap/3.0.0/css/bootstrap-glyphicons.css";location.href.match(/^file:\/\//)&&(n="http://"+n);const i=[];return s.Fullscreen&&i.push('<button class="fullscreen" title="Full Screen"><span class="glyphicon glyphicon-fullscreen"></span></button>'),s.VR&&i.push('<button class="vr" title="VR Headset">VR</button>'),'<style type="text/css">@import url("'+n+'"); '+e+'</style><div class="threestrap-ui threestrap-'+t+'">'+i.join(`
`)+"</div>"},install:function(s){const t=this.ui=document.createElement("div");t.innerHTML=this.markup(s,this.options.theme,this.options.style),document.body.appendChild(t);const e=this.ui.fullscreen=t.querySelector("button.fullscreen");e&&s.bind([e,"click:goFullscreen"],this);const n=this.ui.vr=t.querySelector("button.vr");n&&s.VR&&(s.VR.set({mode:"2d"}),s.bind([n,"click:goVR"],this))},fullscreen:function(s,t){this.ui.style.display=s.active?"none":"block",s.active||t.VR&&t.VR.set({mode:"2d"})},goFullscreen:function(s,t){t.Fullscreen&&t.Fullscreen.toggle()},goVR:function(s,t){t.VR&&(t.VR.set({mode:"auto"}),t.Fullscreen.toggle())},uninstall:function(s){document.body.removeChild(this.ui)}});class Xw{constructor(t,e){this.renderer=t,this.right=new N,this.cameraLeft=new nn,this.cameraRight=new nn;const n=e.getEyeTranslation("left");this.halfIPD=new N(n.x,n.y,n.z).length(),this.fovLeft=e.getRecommendedEyeFieldOfView("left"),this.fovRight=e.getRecommendedEyeFieldOfView("right")}FovToNDCScaleOffset(t){const e=2/(t.leftTan+t.rightTan),n=(t.leftTan-t.rightTan)*e*.5,i=2/(t.upTan+t.downTan),r=(t.upTan-t.downTan)*i*.5;return{scale:[e,i],offset:[n,r]}}FovPortToProjection(t,e,n,i,r){n=n===void 0?!0:n,i=i===void 0?.01:i,r=r===void 0?1e4:r;const o=n?-1:1,a=t.elements,l=this.FovToNDCScaleOffset(e);a[0*4+0]=l.scale[0],a[0*4+1]=0,a[0*4+2]=l.offset[0]*o,a[0*4+3]=0,a[1*4+0]=0,a[1*4+1]=l.scale[1],a[1*4+2]=-l.offset[1]*o,a[1*4+3]=0,a[2*4+0]=0,a[2*4+1]=0,a[2*4+2]=r/(i-r)*-o,a[2*4+3]=r*i/(i-r),a[3*4+0]=0,a[3*4+1]=0,a[3*4+2]=o,a[3*4+3]=0,t.transpose()}FovToProjection(t,e,n,i,r){const o={upTan:Math.tan(e.upDegrees*Math.PI/180),downTan:Math.tan(e.downDegrees*Math.PI/180),leftTan:Math.tan(e.leftDegrees*Math.PI/180),rightTan:Math.tan(e.rightDegrees*Math.PI/180)};return this.FovPortToProjection(t,o,n,i,r)}render(t,e){this.FovToProjection(this.cameraLeft.projectionMatrix,this.fovLeft,!0,e.near,e.far),this.FovToProjection(this.cameraRight.projectionMatrix,this.fovRight,!0,e.near,e.far),this.right.set(this.halfIPD,0,0),this.right.applyQuaternion(e.quaternion),this.cameraLeft.position.copy(e.position).sub(this.right),this.cameraRight.position.copy(e.position).add(this.right),this.cameraLeft.quaternion.copy(e.quaternion),this.cameraRight.quaternion.copy(e.quaternion);const n=this.renderer.devicePixelRatio||1,i=this.renderer.domElement.width/2/n,r=this.renderer.domElement.height/n;this.renderer.enableScissorTest(!0),this.renderer.setViewport(0,0,i,r),this.renderer.setScissor(0,0,i,r),this.renderer.render(t,this.cameraLeft),this.renderer.setViewport(i,0,i,r),this.renderer.setScissor(i,0,i,r),this.renderer.render(t,this.cameraRight)}}Ue.registerPlugin("vr",{defaults:{mode:"auto",device:null,fov:80},listen:["window.load","pre","render","resize","this.change"],install:function(s){s.VR=this.api({active:!1,devices:[],hmd:null,sensor:null,renderer:null,state:null},s)},uninstall:function(s){delete s.VR},mocks:function(s,t,e){return[{fake:!0,force:1,deviceId:"emu",deviceName:"Emulated",getEyeTranslation:function(a){return{left:{x:-.03,y:0,z:0},right:{x:.03,y:0,z:0}}[a]},getRecommendedEyeFieldOfView:function(a){const l=s.camera,c=l&&l.aspect||16/9,h=(t||l&&l.fov||e)/2,f=Math.atan(Math.tan(h*Math.PI/180)*c/2)*180/Math.PI,d=h;return{left:{rightDegrees:f,leftDegrees:f,downDegrees:d,upDegrees:d},right:{rightDegrees:f,leftDegrees:f,downDegrees:d,upDegrees:d}}[a]}},{force:2,getState:function(){return{}}}]},load:function(s,t){const e=(function(n){this.callback(n,t)}).bind(this);navigator.getVRDevices?navigator.getVRDevices().then(e):navigator.mozGetVRDevices?navigator.mozGetVRDevices(e):(console.warn("No native VR support detected."),e(this.mocks(t,this.options.fov,this.defaults.fov),t))},callback:function(s,t){let e,n;const i=window.HMDVRDevice||function(){},r=window.PositionSensorVRDevice||function(){};s=t.VR.devices=s||t.VR.devices;const o=this.options.device;let a;for(let l=0;l<s.length;++l)if(a=s[l],a.force==1||a instanceof i){if(o&&o!=a.deviceId)continue;e=a;break}if(e){let l;for(let c=0;c<s.length;++c)if(l=s[c],l.force==2||l instanceof r&&l.hardwareUnitId==e.hardwareUnitId){n=l;break}this.hookup(e,n,t)}},hookup:function(s,t,e){Xw||console.log("VRRenderer not found");const n=Xw||function(){};this.renderer=new n(e.renderer,s),this.hmd=s,this.sensor=t,e.VR.renderer=this.renderer,e.VR.hmd=s,e.VR.sensor=t,console.log("VRRenderer",s.deviceName)},change:function(s,t){s.changes.device&&this.callback(null,t),this.pre(s,t)},pre:function(s,t){const e=this.active,n=this.active=this.renderer&&this.options.mode!="2d";if(t.VR.active=n,n&&this.sensor){const i=this.sensor.getState();t.VR.state=i}else t.VR.state=null;e!=this.active&&t.trigger({type:"vr",active:n,hmd:this.hmd,sensor:this.sensor})},resize:function(s,t){this.active&&this.renderer.initialize()},render:function(s,t){if(t.scene&&t.camera){const e=this.active?this.renderer:t.renderer;if(this.last!=e&&e==t.renderer){const n=e.getPixelRatio(),i=e.domElement.width/n,r=e.domElement.height/n;e.setScissorTest(!1),e.setViewport(0,0,i,r)}this.last=e,e.render(t.scene,t.camera)}}});class IA{constructor(t,e){this.context=e,this.traits=t.Traits,this.types=t.Types,this.pending=[],this.bound=[],this.last=null}make(t){return{enum:typeof t.enum=="function"?t.enum():void 0,type:typeof t.uniform=="function"?t.uniform():void 0,value:t.make()}}apply(t,e){return new LV(t,e,this)}bind(t){return this.bound.push(t)}unbind(t){return this.bound=Array.from(this.bound).filter(e=>e!==t)}queue(t,e,n,i){return this.lastObject=e,this.lastKey=n,this.lastValue=i,this.pending.push(t)}invoke(t){return t(this.context.time.clock,this.context.time.step)}compute(){if(this.bound.length)for(const t of Array.from(this.bound))this.invoke(t)}digest(){let t;if(!this.pending.length)return!1;[t,this.pending]=Array.from([this.pending,[]]);for(const e of Array.from(t))e();return!0}getTrait(t){return this.traits[t]}getLastTrigger(){return`${this.lastObject.toString()} - ${this.lastKey}=\`${this.lastValue}\``}}const df=function(s){const t={};for(const e in s){const n=s[e];t[e]=n}return t};let LV=class{constructor(t,e,n){let i,r,o,a,l,c,h,{props:f}=e;const{traits:d,finals:m,freeform:g}=e,y=this;t.props!=null&&t.expr!=null&&t.orig!=null&&t.computed!=null&&t.attributes!=null&&(c=df(t.props),a=df(t.expr),l=t.orig(),o=t.computed(),t.attributes!=null&&t.attributes.dispose());const _={},v={},w={},b=W=>w[W]!=null?w[W]:W,M=function(W,st){if(w[st])throw new Error(`${t.toString()} - Duplicate property \`${st}\``);return w[st]=W},A=W=>(y[W]!=null?y[W].value:void 0)!=null?y[W]!=null?y[W].value:void 0:DV(y[b(W)],st=>st.value),T=function(W,st,ct,Ct){let wt;if(W=b(W),(wt=y[W])==null){if(!g)throw new Error(`${t.toString()} - Setting unknown property \`${W}={${st}}\``);wt=y[W]={short:W,type:null,last:null,value:null},J[W]=Qt=>Qt}if(!ct){if(H[W])throw new Error(`${t.toString()} - Can't set bound property \`${W}={${st}}\``);if($[W])throw new Error(`${t.toString()} - Can't set computed property \`${W}={${st}}\``);if(B[W])throw new Error(`${t.toString()} - Can't set final property \`${W}={${st}}\``)}let Tt=!0;const Xt=nt(W,st,wt.last,function(){return Tt=!1,null});if(Tt){[wt.value,wt.last]=Array.from([Xt,wt.value]);const{short:Qt}=wt;_[Qt]=Xt,ct||(v[Qt]=st),!Ct&&!dt(W,wt.value,wt.last)&&qt(W,st)}return Tt},P=function(W,st,ct){return W=b(W),T(W,st,!0,ct),B[W]=!0},C={},S={},L={},H={},$={},B={},G=function(W,st,ct){if(ct==null&&(ct=!1),W=b(W),typeof st!="function")throw new Error(`${t.toString()} - Expression \`${W}=>{${C}}\` is not a function`);if(H[W])throw new Error(`${t.toString()} - Property \`${W}=>{${C}}\` is already bound`);if($[W])throw new Error(`${t.toString()} - Property \`${W}\` is computed`);if(B[W])throw new Error(`${t.toString()} - Property \`${W}\` is final`);const Ct=ct?$:H;Ct[W]=st;const wt=y[W]!=null?y[W].short:W;return ct||(C[wt]=st),L[W]=st,st=st.bind(t),S[W]=function(Tt,Xt){let Qt;return(Qt=t.clock!=null?t.clock.getTime():void 0)&&(Tt=Qt.clock,Xt=Qt.step),t.set(W,st(Tt,Xt),!0)},n.bind(S[W])},I=function(W,st){st==null&&(st=!1),W=b(W);const ct=st?$:H;if(ct[W])return n.unbind(S[W]),delete S[W],delete ct[W],y[W]!=null&&(W=y[W].short),delete C[W]},et=function(W,st){let ct;return W=b(W),(ct=typeof L[W]=="function"?L[W](st,0):void 0)!=null?ct:y[W].value};t.expr=C,t.props=_,t.evaluate=function(W,st){if(W!=null)return et(W,st);{const ct={};for(W in f)ct[W]=et(W,st);return ct}},t.get=function(W){return W!=null?A(W):_},t.set=function(W,st,ct,Ct){if(typeof W=="string")T(W,st,ct,Ct);else{Ct=ct,ct=st;const wt=W;for(W in wt)st=wt[W],T(W,st,ct,Ct)}},t.bind=function(W,st,ct){if(typeof W=="string")G(W,st,ct);else{ct=st;const Ct=W;for(W in Ct)st=Ct[W],G(W,st,ct)}},t.unbind=function(W,st){if(typeof W=="string")I(W,st);else{st=C;const ct=W;for(W in ct)I(W,st)}},t.attribute=function(W){return W!=null?y[b(W)]:y},t.orig=function(W){return W!=null?v[b(W)]:df(v)},t.computed=function(W){return W!=null?$[b(W)]:df($)};const Y={},J={},ut={},dt=(W,st,ct)=>ut[W](st,ct),nt=(W,st,ct,Ct)=>J[W](st,ct,Ct);t.validate=function(W,st){let ct;W=b(W);const Ct=Y[W];return Ct!=null&&(ct=Ct()),ct=nt(W,st,ct,function(){throw new Error(`${t.toString()} - Invalid value \`${W}={${st}}\``)})};let ft=!1,Lt={},Ot={},It={},Kt={};const Ht=W=>W.split(".")[0],qt=function(W,st){ft||(ft=!0,n.queue(le,t,W,st));const ct=Ht(W);return Lt[W]=!0,Ot[ct]=!0},ee={type:"change",changed:null,touched:null},le=function(){let W;ee.changed=Lt,ee.touched=Ot,Lt=It,Ot=Kt,{changed:It}=ee,{touched:Kt}=ee,ft=!1;for(W in Lt)Lt[W]=!1;for(W in Ot)Ot[W]=!1;return ee.type="change",t.trigger(ee),(()=>{const st=[];for(const ct in ee.touched)ee.type=`change:${ct}`,st.push(t.trigger(ee));return st})()},$t=function(W){const st=W.split(/\./g),ct=st.pop();return st.pop(),st.unshift(ct),st.reduce((Ct,wt)=>Ct+wt.charAt(0).toUpperCase()+wt.substring(1))},Mt=(W,st)=>(()=>{const ct=[];for(let Ct in st){let wt;const Tt=st[Ct];Ct=[W,Ct].join(".");const Xt=$t(Ct);y[Ct]={T:Tt,ns:W,short:Xt,enum:typeof Tt.enum=="function"?Tt.enum():void 0,type:typeof Tt.uniform=="function"?Tt.uniform():void 0,last:Tt.make(),value:wt=Tt.make()},M(Ct,Xt),_[Xt]=wt,Y[Ct]=Tt.make,J[Ct]=Tt.validate!=null?Tt.validate:Qt=>Qt,ct.push(ut[Ct]=Tt.equals!=null?Tt.equals:(Qt,U)=>Qt===U)}return ct})(),X=[];for(let W of Array.from(d)){[W,r]=Array.from(W.split(":"));const st=r?[r,W].join("."):W;h=n.getTrait(W),X.push(W),h!=null&&Mt(st,h)}if(f!=null)for(r in f)h=f[r],Mt(r,h);const bt=X.filter((W,st)=>X.indexOf(W)===st);if(t.traits=bt,c!=null&&t.set(c,!0,!0),m!=null)for(i in m){const W=m[i];P(i,W,!0)}l!=null&&t.set(l,!1,!0),o!=null&&t.bind(o,!0),a!=null&&t.bind(a,!1),this.dispose=function(){for(i in $)I(i,!0);for(i in H)I(i,!1);return f={},delete t.attributes,delete t.get,delete t.set}}};function DV(s,t){return typeof s<"u"&&s!==null?t(s):void 0}const jw=5,IV=1e-4,OV=(s,t)=>Math.abs(s/t-Math.round(s/t))<IV,pf=s=>OV(s,1),zV=function(s,t,e,n){const i=Math.round(s/t);return i===1?`${e}`:i===-1?`-${e}`:e==="1"?`${i}`:n?`${i}${e}`:`${i}*${e}`},kV=function(s,t,e,n){let i=Math.round(s*t);return Math.abs(i)===1?(i=i<0?"-":"",i+=e):e!=="1"&&(i+=n?`${e}`:`*${e}`),`${i}/${t}`},Yw=[{1:1},{1:1,τ:Math.PI*2},{1:1,π:Math.PI},{1:1,τ:Math.PI*2,π:Math.PI},{1:1,e:Math.E},{1:1,τ:Math.PI*2,e:Math.E},{1:1,π:Math.PI,e:Math.E},{1:1,τ:Math.PI*2,π:Math.PI,e:Math.E}],UV=[[2*2*3*5*7,[2,3,5,7]],[2*2*2*3*3*5*5*7*7,[2,3,5,7]],[2*2*3*5*7*11*13,[2,3,5,7,11,13]],[2*2*17*19*23*29,[2,17,19,23,29]],[256*256,[2]],[1e6,[2,5]]],OA=function(s){let t,e,n,i,r;s&&({cache:t,compact:e,tau:r,pi:i,e:n}=s),e=+!!(e??!0),r=+!!(r??!0),i=+!!(i??!0),n=+!!(n??!0),t=+!!(t??!0);const o=r+i*2+n*4,a=t?{}:null;return function(l){if(a!=null){let d;if((d=a[l])!=null)return d;if(l===Math.round(l))return a[l]=`${l}`}let c=`${l}`,h=c.length+c.indexOf(".")+2;const f=function(d){const m=d.length;if(m<=h)return c=`${d}`,h=m};for(const d in Yw[o]){const m=Yw[o][d];if(pf(l/m))f(`${zV(l/m,1,d,e)}`);else for(let[g,y]of Array.from(UV)){let _=l/m*g;if(pf(_)){for(const v of Array.from(y)){let w,b;for(;pf(b=_/v)&&pf(w=g/v);)_=b,g=w}f(`${kV(l/m,g,d,e)}`);break}}}return`${l}`.length>jw&&f(`${l.toPrecision(jw)}`),a!=null&&(a[l]=c),c}},W_=function(s,t){return t==null&&(t="info"),s=zA(s),console[t].apply(console,s)},zA=function(s){const t="color:rgb(128,0,128)",e="color:rgb(144,64,0)",n="color:rgb(0,0,192)",i="color:rgb(0,70,156)",r="color:inherit";let o=!1,a=0;const l=[];return s=s.replace(/(\\[<={}> "'])|(=>|[<={}> "'])/g,function(c,h,f){return h!=null&&h.length?h:o&&!['"',"'"].includes(f)||a&&!['"',"'","{","}"].includes(f)?f:(()=>{switch(f){case"<":return l.push(t),"%c<";case">":return l.push(t),l.push(r),"%c>%c";case" ":return l.push(e)," %c";case"=":case"=>":return l.push(t),`%c${f}`;case'"':case"'":return o=!o,o?(l.push(a?e:n),`${f}%c`):(l.push(a?i:t),`%c${f}`);case"{":return a++===0?(l.push(i),`%c${f}`):f;case"}":return--a===0?(l.push(t),`${f}%c`):f;default:return f}})()}),[s].concat(l)},NV=(s,t)=>kA(s,t,"="),FV=(s,t)=>kA(s,t,"=>"),kA=function(){const s=OA({compact:!1});return function(t,e,n){const i=function(a){return a===""+ +a||a.match(/^[A-Za-z_][A-Za-z0-9]*$/)?a:JSON.stringify(a)},r=function(a){return a.match(`
*"`)?a:`{${a}}`},o=function(a){if(a instanceof Array)return`[${a.map(o).join(", ")}]`;switch(typeof a){case"string":return a.match(`
`)?`"
${a}"
`:`"${a}"`;case"function":return a=`${a}`,a.match(`
`),a=a.replace(/^function (\([^)]*\))/,"$1 =>"),a=a.replace(/^(\([^)]*\)) =>\s*{\s*return\s*([^}]+)\s*;\s*}/,"$1 => $2");case"number":return s(a);default:return a!=null&&a!==!!a?a._up!=null?o(a.map(l=>l)):a.toMarkup?a.toString():"{"+(()=>{const l=[];for(const c in a){const h=a[c];Object.prototype.hasOwnProperty.call(a,c)&&l.push(`${i(c)}: ${o(h)}`)}return l})().join(", ")+"}":`${JSON.stringify(a)}`}};return[t,n,r(o(e))].join("")}}(),ug=function(s){return s=s.replace(/&/g,"&amp;"),s=s.replace(/</g,"&lt;"),s=s.replace(/"/g,"&quot;")},BV=function(s){const t=[].slice.call(arguments);t.shift();let e="<span>";s=ug(s);for(const n of Array.from(t))s=s.replace(/%([a-z])/,function(i,r){const o=t.shift();switch(r){case"c":return`</span><span style="${ug(o)}">`;default:return ug(o)}});return e+=s,e+="</span>"},dv={prop:NV,bind:FV},HV=Object.freeze(Object.defineProperty({__proto__:null,JSX:dv,format:BV,markup:zA,number:OA,print:W_},Symbol.toStringTag,{value:"Module"}));let VV=0,ru=class{constructor(t,e,n,i,r,o){this.type=t,this._id=(++VV).toString(),this.configure(r,o),this.parent=this.root=this.path=this.index=null,this.set(e,!0,!0),this.set(n,!1,!0),this.bind(i,!1)}configure(t,e){let{traits:n,props:i,finals:r,freeform:o}=t;return n==null&&(n=(this._config!=null?this._config.traits:void 0)!=null?this._config!=null?this._config.traits:void 0:[]),i==null&&(i=(this._config!=null?this._config.props:void 0)!=null?this._config!=null?this._config.props:void 0:{}),r==null&&(r=(this._config!=null?this._config.finals:void 0)!=null?this._config!=null?this._config.finals:void 0:{}),o==null&&(o=(this._config!=null?this._config.freeform:void 0)!=null?this._config!=null?this._config.freeform:void 0:!1),this._config={traits:n,props:i,finals:r,freeform:o},this.attributes=e.apply(this,this._config)}dispose(){return this.attributes.dispose(),this.attributes=null}_added(t){this.parent=t,this.root=t.root;const e={type:"add",node:this,parent:this.parent};return this.root&&this.root.trigger(e),e.type="added",this.trigger(e)}_removed(){const t={type:"remove",node:this};return this.root&&this.root.trigger(t),t.type="removed",this.trigger(t),this.root=this.parent=null}_index(t,e){let n;if(e==null&&({parent:e}=this),this.index=t,this.path=n=t!=null?((e!=null?e.path:void 0)!=null?e!=null?e.path:void 0:[]).concat([t]):null,this.order=n!=null?this._encode(n):1/0,this.root!=null)return this.trigger({type:"reindex"})}_encode(t){const n=a=>3/(a+3),i=a=>o+(r-o)*a;let r=1.3333333333333333,o=0;for(const a of Array.from(t)){const l=n(a+1),c=n(a+2);[r,o]=Array.from([i(l),i(c)])}return r}toString(){const t=this.id!=null?this.id:this._id,e=this.type!=null?this.type:"node";let n=e;if(n+=`#${t}`,this.classes!=null&&this.classes.length&&(n+=`.${this.classes.join(".")}`),this.children!=null){let i;return(i=this.children.length)?`<${n}>…(${i})…</${e}>`:`<${n}></${e}>`}else return`<${n} />`}toMarkup(t=null,e){let n,i;if(e==null&&(e=""),t&&typeof t!="function"){let m;t=(m=this.root!=null?this.root.model._matcher(t):void 0)!=null?m:()=>!0}const r=this.type!=null?this.type:"node";let{expr:o}=this;const a={id:this._id},l=typeof this.orig=="function"?this.orig():void 0;for(n in l)i=l[n],a[n]=i;const c=(()=>{const m=[];for(n in a)i=a[n],this.expr[n]||m.push(dv.prop(n,i));return m})();o=(()=>{const m=[];for(n in o)i=o[n],m.push(dv.bind(n,i));return m})();let h=[""];c.length&&(h=h.concat(c)),o.length&&(h=h.concat(o)),h=h.join(" ");let f=e;const d=()=>this.children!=null&&this.children.length?this.children.map(m=>m.toMarkup(t,f)).filter(m=>m!=null&&m.length).join(`
`):"";if(t&&!t(this))return d();if(this.children!=null){const m=`<${r}${h}>`,g=`</${r}>`;f=e+"  ";let y=d();return y.length&&(y=`
`+y+`
`+e),y==null&&(y=""),e+m+y+g}else return`${e}<${r}${h} />`}print(t,e){return W_(this.toMarkup(t),e)}};Ss.apply(ru.prototype);let UA=class extends ru{constructor(t,e,n,i,r,o){super(t,e,n,i,r,o),this.children=[],this.on("reindex",a=>Array.from(this.children).map(l=>l.trigger(a)))}add(t){return t.parent!=null&&t.parent.remove(t),t._index(this.children.length,this),this.children.push(t),t._added(this)}remove(t){t.children!=null&&t.children.length&&t.empty();const e=this.children.indexOf(t);if(e!==-1){this.children.splice(e,1),t._index(null),t._removed(this);for(let n=0;n<this.children.length;n++)t=this.children[n],n>=e&&t._index(n)}}empty(){const t=this.children.slice().reverse();for(const e of Array.from(t))this.remove(e)}};class NA{constructor(t){t==null&&(t=10),this.limit=t}iterate(t){const{step:e,last:n}=t;let{limit:i}=this;for(;e();)if(!--i)throw console.warn("Last iteration",typeof n=="function"?n():void 0),new Error("Exceeded iteration limit.");return null}}var Gf={},FA={},Ni={},da={},Eu={};(function(s){Object.defineProperty(s,"__esModule",{value:!0}),s.Doctype=s.CDATA=s.Tag=s.Style=s.Script=s.Comment=s.Directive=s.Text=s.Root=s.isTag=s.ElementType=void 0;var t;(function(n){n.Root="root",n.Text="text",n.Directive="directive",n.Comment="comment",n.Script="script",n.Style="style",n.Tag="tag",n.CDATA="cdata",n.Doctype="doctype"})(t=s.ElementType||(s.ElementType={}));function e(n){return n.type===t.Tag||n.type===t.Script||n.type===t.Style}s.isTag=e,s.Root=t.Root,s.Text=t.Text,s.Directive=t.Directive,s.Comment=t.Comment,s.Script=t.Script,s.Style=t.Style,s.Tag=t.Tag,s.CDATA=t.CDATA,s.Doctype=t.Doctype})(Eu);var De={},pa=te&&te.__extends||function(){var s=function(t,e){return s=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,i){n.__proto__=i}||function(n,i){for(var r in i)Object.prototype.hasOwnProperty.call(i,r)&&(n[r]=i[r])},s(t,e)};return function(t,e){if(typeof e!="function"&&e!==null)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");s(t,e);function n(){this.constructor=t}t.prototype=e===null?Object.create(e):(n.prototype=e.prototype,new n)}}(),Fc=te&&te.__assign||function(){return Fc=Object.assign||function(s){for(var t,e=1,n=arguments.length;e<n;e++){t=arguments[e];for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&(s[i]=t[i])}return s},Fc.apply(this,arguments)};Object.defineProperty(De,"__esModule",{value:!0});De.cloneNode=De.hasChildren=De.isDocument=De.isDirective=De.isComment=De.isText=De.isCDATA=De.isTag=De.Element=De.Document=De.NodeWithChildren=De.ProcessingInstruction=De.Comment=De.Text=De.DataNode=De.Node=void 0;var _n=Eu,GV=new Map([[_n.ElementType.Tag,1],[_n.ElementType.Script,1],[_n.ElementType.Style,1],[_n.ElementType.Directive,1],[_n.ElementType.Text,3],[_n.ElementType.CDATA,4],[_n.ElementType.Comment,8],[_n.ElementType.Root,9]]),$_=function(){function s(t){this.type=t,this.parent=null,this.prev=null,this.next=null,this.startIndex=null,this.endIndex=null}return Object.defineProperty(s.prototype,"nodeType",{get:function(){var t;return(t=GV.get(this.type))!==null&&t!==void 0?t:1},enumerable:!1,configurable:!0}),Object.defineProperty(s.prototype,"parentNode",{get:function(){return this.parent},set:function(t){this.parent=t},enumerable:!1,configurable:!0}),Object.defineProperty(s.prototype,"previousSibling",{get:function(){return this.prev},set:function(t){this.prev=t},enumerable:!1,configurable:!0}),Object.defineProperty(s.prototype,"nextSibling",{get:function(){return this.next},set:function(t){this.next=t},enumerable:!1,configurable:!0}),s.prototype.cloneNode=function(t){return t===void 0&&(t=!1),X_(this,t)},s}();De.Node=$_;var Nd=function(s){pa(t,s);function t(e,n){var i=s.call(this,e)||this;return i.data=n,i}return Object.defineProperty(t.prototype,"nodeValue",{get:function(){return this.data},set:function(e){this.data=e},enumerable:!1,configurable:!0}),t}($_);De.DataNode=Nd;var BA=function(s){pa(t,s);function t(e){return s.call(this,_n.ElementType.Text,e)||this}return t}(Nd);De.Text=BA;var HA=function(s){pa(t,s);function t(e){return s.call(this,_n.ElementType.Comment,e)||this}return t}(Nd);De.Comment=HA;var VA=function(s){pa(t,s);function t(e,n){var i=s.call(this,_n.ElementType.Directive,n)||this;return i.name=e,i}return t}(Nd);De.ProcessingInstruction=VA;var Fd=function(s){pa(t,s);function t(e,n){var i=s.call(this,e)||this;return i.children=n,i}return Object.defineProperty(t.prototype,"firstChild",{get:function(){var e;return(e=this.children[0])!==null&&e!==void 0?e:null},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"lastChild",{get:function(){return this.children.length>0?this.children[this.children.length-1]:null},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"childNodes",{get:function(){return this.children},set:function(e){this.children=e},enumerable:!1,configurable:!0}),t}($_);De.NodeWithChildren=Fd;var GA=function(s){pa(t,s);function t(e){return s.call(this,_n.ElementType.Root,e)||this}return t}(Fd);De.Document=GA;var qA=function(s){pa(t,s);function t(e,n,i,r){i===void 0&&(i=[]),r===void 0&&(r=e==="script"?_n.ElementType.Script:e==="style"?_n.ElementType.Style:_n.ElementType.Tag);var o=s.call(this,r,i)||this;return o.name=e,o.attribs=n,o}return Object.defineProperty(t.prototype,"tagName",{get:function(){return this.name},set:function(e){this.name=e},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"attributes",{get:function(){var e=this;return Object.keys(this.attribs).map(function(n){var i,r;return{name:n,value:e.attribs[n],namespace:(i=e["x-attribsNamespace"])===null||i===void 0?void 0:i[n],prefix:(r=e["x-attribsPrefix"])===null||r===void 0?void 0:r[n]}})},enumerable:!1,configurable:!0}),t}(Fd);De.Element=qA;function WA(s){return(0,_n.isTag)(s)}De.isTag=WA;function $A(s){return s.type===_n.ElementType.CDATA}De.isCDATA=$A;function XA(s){return s.type===_n.ElementType.Text}De.isText=XA;function jA(s){return s.type===_n.ElementType.Comment}De.isComment=jA;function YA(s){return s.type===_n.ElementType.Directive}De.isDirective=YA;function ZA(s){return s.type===_n.ElementType.Root}De.isDocument=ZA;function qV(s){return Object.prototype.hasOwnProperty.call(s,"children")}De.hasChildren=qV;function X_(s,t){t===void 0&&(t=!1);var e;if(XA(s))e=new BA(s.data);else if(jA(s))e=new HA(s.data);else if(WA(s)){var n=t?hg(s.children):[],i=new qA(s.name,Fc({},s.attribs),n);n.forEach(function(l){return l.parent=i}),s.namespace!=null&&(i.namespace=s.namespace),s["x-attribsNamespace"]&&(i["x-attribsNamespace"]=Fc({},s["x-attribsNamespace"])),s["x-attribsPrefix"]&&(i["x-attribsPrefix"]=Fc({},s["x-attribsPrefix"])),e=i}else if($A(s)){var n=t?hg(s.children):[],r=new Fd(_n.ElementType.CDATA,n);n.forEach(function(c){return c.parent=r}),e=r}else if(ZA(s)){var n=t?hg(s.children):[],o=new GA(n);n.forEach(function(c){return c.parent=o}),s["x-mode"]&&(o["x-mode"]=s["x-mode"]),e=o}else if(YA(s)){var a=new VA(s.name,s.data);s["x-name"]!=null&&(a["x-name"]=s["x-name"],a["x-publicId"]=s["x-publicId"],a["x-systemId"]=s["x-systemId"]),e=a}else throw new Error("Not implemented yet: ".concat(s.type));return e.startIndex=s.startIndex,e.endIndex=s.endIndex,s.sourceCodeLocation!=null&&(e.sourceCodeLocation=s.sourceCodeLocation),e}De.cloneNode=X_;function hg(s){for(var t=s.map(function(n){return X_(n,!0)}),e=1;e<t.length;e++)t[e].prev=t[e-1],t[e-1].next=t[e];return t}(function(s){var t=te&&te.__createBinding||(Object.create?function(l,c,h,f){f===void 0&&(f=h);var d=Object.getOwnPropertyDescriptor(c,h);(!d||("get"in d?!c.__esModule:d.writable||d.configurable))&&(d={enumerable:!0,get:function(){return c[h]}}),Object.defineProperty(l,f,d)}:function(l,c,h,f){f===void 0&&(f=h),l[f]=c[h]}),e=te&&te.__exportStar||function(l,c){for(var h in l)h!=="default"&&!Object.prototype.hasOwnProperty.call(c,h)&&t(c,l,h)};Object.defineProperty(s,"__esModule",{value:!0}),s.DomHandler=void 0;var n=Eu,i=De;e(De,s);var r=/\s+/g,o={normalizeWhitespace:!1,withStartIndices:!1,withEndIndices:!1,xmlMode:!1},a=function(){function l(c,h,f){this.dom=[],this.root=new i.Document(this.dom),this.done=!1,this.tagStack=[this.root],this.lastNode=null,this.parser=null,typeof h=="function"&&(f=h,h=o),typeof c=="object"&&(h=c,c=void 0),this.callback=c??null,this.options=h??o,this.elementCB=f??null}return l.prototype.onparserinit=function(c){this.parser=c},l.prototype.onreset=function(){this.dom=[],this.root=new i.Document(this.dom),this.done=!1,this.tagStack=[this.root],this.lastNode=null,this.parser=null},l.prototype.onend=function(){this.done||(this.done=!0,this.parser=null,this.handleCallback(null))},l.prototype.onerror=function(c){this.handleCallback(c)},l.prototype.onclosetag=function(){this.lastNode=null;var c=this.tagStack.pop();this.options.withEndIndices&&(c.endIndex=this.parser.endIndex),this.elementCB&&this.elementCB(c)},l.prototype.onopentag=function(c,h){var f=this.options.xmlMode?n.ElementType.Tag:void 0,d=new i.Element(c,h,void 0,f);this.addNode(d),this.tagStack.push(d)},l.prototype.ontext=function(c){var h=this.options.normalizeWhitespace,f=this.lastNode;if(f&&f.type===n.ElementType.Text)h?f.data=(f.data+c).replace(r," "):f.data+=c,this.options.withEndIndices&&(f.endIndex=this.parser.endIndex);else{h&&(c=c.replace(r," "));var d=new i.Text(c);this.addNode(d),this.lastNode=d}},l.prototype.oncomment=function(c){if(this.lastNode&&this.lastNode.type===n.ElementType.Comment){this.lastNode.data+=c;return}var h=new i.Comment(c);this.addNode(h),this.lastNode=h},l.prototype.oncommentend=function(){this.lastNode=null},l.prototype.oncdatastart=function(){var c=new i.Text(""),h=new i.NodeWithChildren(n.ElementType.CDATA,[c]);this.addNode(h),c.parent=h,this.lastNode=c},l.prototype.oncdataend=function(){this.lastNode=null},l.prototype.onprocessinginstruction=function(c,h){var f=new i.ProcessingInstruction(c,h);this.addNode(f)},l.prototype.handleCallback=function(c){if(typeof this.callback=="function")this.callback(c,this.dom);else if(c)throw c},l.prototype.addNode=function(c){var h=this.tagStack[this.tagStack.length-1],f=h.children[h.children.length-1];this.options.withStartIndices&&(c.startIndex=this.parser.startIndex),this.options.withEndIndices&&(c.endIndex=this.parser.endIndex),h.children.push(c),f&&(c.prev=f,f.next=c),c.parent=h,this.lastNode=null},l}();s.DomHandler=a,s.default=a})(da);var j_={},KA={},wr={};const WV="Á",$V="á",XV="Ă",jV="ă",YV="∾",ZV="∿",KV="∾̳",JV="Â",QV="â",tG="´",eG="А",nG="а",iG="Æ",sG="æ",rG="⁡",oG="𝔄",aG="𝔞",lG="À",cG="à",uG="ℵ",hG="ℵ",fG="Α",dG="α",pG="Ā",mG="ā",gG="⨿",vG="&",_G="&",yG="⩕",xG="⩓",bG="∧",wG="⩜",MG="⩘",SG="⩚",AG="∠",EG="⦤",TG="∠",CG="⦨",PG="⦩",RG="⦪",LG="⦫",DG="⦬",IG="⦭",OG="⦮",zG="⦯",kG="∡",UG="∟",NG="⊾",FG="⦝",BG="∢",HG="Å",VG="⍼",GG="Ą",qG="ą",WG="𝔸",$G="𝕒",XG="⩯",jG="≈",YG="⩰",ZG="≊",KG="≋",JG="'",QG="⁡",t5="≈",e5="≊",n5="Å",i5="å",s5="𝒜",r5="𝒶",o5="≔",a5="*",l5="≈",c5="≍",u5="Ã",h5="ã",f5="Ä",d5="ä",p5="∳",m5="⨑",g5="≌",v5="϶",_5="‵",y5="∽",x5="⋍",b5="∖",w5="⫧",M5="⊽",S5="⌅",A5="⌆",E5="⌅",T5="⎵",C5="⎶",P5="≌",R5="Б",L5="б",D5="„",I5="∵",O5="∵",z5="∵",k5="⦰",U5="϶",N5="ℬ",F5="ℬ",B5="Β",H5="β",V5="ℶ",G5="≬",q5="𝔅",W5="𝔟",$5="⋂",X5="◯",j5="⋃",Y5="⨀",Z5="⨁",K5="⨂",J5="⨆",Q5="★",tq="▽",eq="△",nq="⨄",iq="⋁",sq="⋀",rq="⤍",oq="⧫",aq="▪",lq="▴",cq="▾",uq="◂",hq="▸",fq="␣",dq="▒",pq="░",mq="▓",gq="█",vq="=⃥",_q="≡⃥",yq="⫭",xq="⌐",bq="𝔹",wq="𝕓",Mq="⊥",Sq="⊥",Aq="⋈",Eq="⧉",Tq="┐",Cq="╕",Pq="╖",Rq="╗",Lq="┌",Dq="╒",Iq="╓",Oq="╔",zq="─",kq="═",Uq="┬",Nq="╤",Fq="╥",Bq="╦",Hq="┴",Vq="╧",Gq="╨",qq="╩",Wq="⊟",$q="⊞",Xq="⊠",jq="┘",Yq="╛",Zq="╜",Kq="╝",Jq="└",Qq="╘",tW="╙",eW="╚",nW="│",iW="║",sW="┼",rW="╪",oW="╫",aW="╬",lW="┤",cW="╡",uW="╢",hW="╣",fW="├",dW="╞",pW="╟",mW="╠",gW="‵",vW="˘",_W="˘",yW="¦",xW="𝒷",bW="ℬ",wW="⁏",MW="∽",SW="⋍",AW="⧅",EW="\\",TW="⟈",CW="•",PW="•",RW="≎",LW="⪮",DW="≏",IW="≎",OW="≏",zW="Ć",kW="ć",UW="⩄",NW="⩉",FW="⩋",BW="∩",HW="⋒",VW="⩇",GW="⩀",qW="ⅅ",WW="∩︀",$W="⁁",XW="ˇ",jW="ℭ",YW="⩍",ZW="Č",KW="č",JW="Ç",QW="ç",t$="Ĉ",e$="ĉ",n$="∰",i$="⩌",s$="⩐",r$="Ċ",o$="ċ",a$="¸",l$="¸",c$="⦲",u$="¢",h$="·",f$="·",d$="𝔠",p$="ℭ",m$="Ч",g$="ч",v$="✓",_$="✓",y$="Χ",x$="χ",b$="ˆ",w$="≗",M$="↺",S$="↻",A$="⊛",E$="⊚",T$="⊝",C$="⊙",P$="®",R$="Ⓢ",L$="⊖",D$="⊕",I$="⊗",O$="○",z$="⧃",k$="≗",U$="⨐",N$="⫯",F$="⧂",B$="∲",H$="”",V$="’",G$="♣",q$="♣",W$=":",$$="∷",X$="⩴",j$="≔",Y$="≔",Z$=",",K$="@",J$="∁",Q$="∘",t8="∁",e8="ℂ",n8="≅",i8="⩭",s8="≡",r8="∮",o8="∯",a8="∮",l8="𝕔",c8="ℂ",u8="∐",h8="∐",f8="©",d8="©",p8="℗",m8="∳",g8="↵",v8="✗",_8="⨯",y8="𝒞",x8="𝒸",b8="⫏",w8="⫑",M8="⫐",S8="⫒",A8="⋯",E8="⤸",T8="⤵",C8="⋞",P8="⋟",R8="↶",L8="⤽",D8="⩈",I8="⩆",O8="≍",z8="∪",k8="⋓",U8="⩊",N8="⊍",F8="⩅",B8="∪︀",H8="↷",V8="⤼",G8="⋞",q8="⋟",W8="⋎",$8="⋏",X8="¤",j8="↶",Y8="↷",Z8="⋎",K8="⋏",J8="∲",Q8="∱",t6="⌭",e6="†",n6="‡",i6="ℸ",s6="↓",r6="↡",o6="⇓",a6="‐",l6="⫤",c6="⊣",u6="⤏",h6="˝",f6="Ď",d6="ď",p6="Д",m6="д",g6="‡",v6="⇊",_6="ⅅ",y6="ⅆ",x6="⤑",b6="⩷",w6="°",M6="∇",S6="Δ",A6="δ",E6="⦱",T6="⥿",C6="𝔇",P6="𝔡",R6="⥥",L6="⇃",D6="⇂",I6="´",O6="˙",z6="˝",k6="`",U6="˜",N6="⋄",F6="⋄",B6="⋄",H6="♦",V6="♦",G6="¨",q6="ⅆ",W6="ϝ",$6="⋲",X6="÷",j6="÷",Y6="⋇",Z6="⋇",K6="Ђ",J6="ђ",Q6="⌞",tX="⌍",eX="$",nX="𝔻",iX="𝕕",sX="¨",rX="˙",oX="⃜",aX="≐",lX="≑",cX="≐",uX="∸",hX="∔",fX="⊡",dX="⌆",pX="∯",mX="¨",gX="⇓",vX="⇐",_X="⇔",yX="⫤",xX="⟸",bX="⟺",wX="⟹",MX="⇒",SX="⊨",AX="⇑",EX="⇕",TX="∥",CX="⤓",PX="↓",RX="↓",LX="⇓",DX="⇵",IX="̑",OX="⇊",zX="⇃",kX="⇂",UX="⥐",NX="⥞",FX="⥖",BX="↽",HX="⥟",VX="⥗",GX="⇁",qX="↧",WX="⊤",$X="⤐",XX="⌟",jX="⌌",YX="𝒟",ZX="𝒹",KX="Ѕ",JX="ѕ",QX="⧶",tj="Đ",ej="đ",nj="⋱",ij="▿",sj="▾",rj="⇵",oj="⥯",aj="⦦",lj="Џ",cj="џ",uj="⟿",hj="É",fj="é",dj="⩮",pj="Ě",mj="ě",gj="Ê",vj="ê",_j="≖",yj="≕",xj="Э",bj="э",wj="⩷",Mj="Ė",Sj="ė",Aj="≑",Ej="ⅇ",Tj="≒",Cj="𝔈",Pj="𝔢",Rj="⪚",Lj="È",Dj="è",Ij="⪖",Oj="⪘",zj="⪙",kj="∈",Uj="⏧",Nj="ℓ",Fj="⪕",Bj="⪗",Hj="Ē",Vj="ē",Gj="∅",qj="∅",Wj="◻",$j="∅",Xj="▫",jj=" ",Yj=" ",Zj=" ",Kj="Ŋ",Jj="ŋ",Qj=" ",t9="Ę",e9="ę",n9="𝔼",i9="𝕖",s9="⋕",r9="⧣",o9="⩱",a9="ε",l9="Ε",c9="ε",u9="ϵ",h9="≖",f9="≕",d9="≂",p9="⪖",m9="⪕",g9="⩵",v9="=",_9="≂",y9="≟",x9="⇌",b9="≡",w9="⩸",M9="⧥",S9="⥱",A9="≓",E9="ℯ",T9="ℰ",C9="≐",P9="⩳",R9="≂",L9="Η",D9="η",I9="Ð",O9="ð",z9="Ë",k9="ë",U9="€",N9="!",F9="∃",B9="∃",H9="ℰ",V9="ⅇ",G9="ⅇ",q9="≒",W9="Ф",$9="ф",X9="♀",j9="ﬃ",Y9="ﬀ",Z9="ﬄ",K9="𝔉",J9="𝔣",Q9="ﬁ",tY="◼",eY="▪",nY="fj",iY="♭",sY="ﬂ",rY="▱",oY="ƒ",aY="𝔽",lY="𝕗",cY="∀",uY="∀",hY="⋔",fY="⫙",dY="ℱ",pY="⨍",mY="½",gY="⅓",vY="¼",_Y="⅕",yY="⅙",xY="⅛",bY="⅔",wY="⅖",MY="¾",SY="⅗",AY="⅜",EY="⅘",TY="⅚",CY="⅝",PY="⅞",RY="⁄",LY="⌢",DY="𝒻",IY="ℱ",OY="ǵ",zY="Γ",kY="γ",UY="Ϝ",NY="ϝ",FY="⪆",BY="Ğ",HY="ğ",VY="Ģ",GY="Ĝ",qY="ĝ",WY="Г",$Y="г",XY="Ġ",jY="ġ",YY="≥",ZY="≧",KY="⪌",JY="⋛",QY="≥",t7="≧",e7="⩾",n7="⪩",i7="⩾",s7="⪀",r7="⪂",o7="⪄",a7="⋛︀",l7="⪔",c7="𝔊",u7="𝔤",h7="≫",f7="⋙",d7="⋙",p7="ℷ",m7="Ѓ",g7="ѓ",v7="⪥",_7="≷",y7="⪒",x7="⪤",b7="⪊",w7="⪊",M7="⪈",S7="≩",A7="⪈",E7="≩",T7="⋧",C7="𝔾",P7="𝕘",R7="`",L7="≥",D7="⋛",I7="≧",O7="⪢",z7="≷",k7="⩾",U7="≳",N7="𝒢",F7="ℊ",B7="≳",H7="⪎",V7="⪐",G7="⪧",q7="⩺",W7=">",$7=">",X7="≫",j7="⋗",Y7="⦕",Z7="⩼",K7="⪆",J7="⥸",Q7="⋗",tZ="⋛",eZ="⪌",nZ="≷",iZ="≳",sZ="≩︀",rZ="≩︀",oZ="ˇ",aZ=" ",lZ="½",cZ="ℋ",uZ="Ъ",hZ="ъ",fZ="⥈",dZ="↔",pZ="⇔",mZ="↭",gZ="^",vZ="ℏ",_Z="Ĥ",yZ="ĥ",xZ="♥",bZ="♥",wZ="…",MZ="⊹",SZ="𝔥",AZ="ℌ",EZ="ℋ",TZ="⤥",CZ="⤦",PZ="⇿",RZ="∻",LZ="↩",DZ="↪",IZ="𝕙",OZ="ℍ",zZ="―",kZ="─",UZ="𝒽",NZ="ℋ",FZ="ℏ",BZ="Ħ",HZ="ħ",VZ="≎",GZ="≏",qZ="⁃",WZ="‐",$Z="Í",XZ="í",jZ="⁣",YZ="Î",ZZ="î",KZ="И",JZ="и",QZ="İ",tK="Е",eK="е",nK="¡",iK="⇔",sK="𝔦",rK="ℑ",oK="Ì",aK="ì",lK="ⅈ",cK="⨌",uK="∭",hK="⧜",fK="℩",dK="Ĳ",pK="ĳ",mK="Ī",gK="ī",vK="ℑ",_K="ⅈ",yK="ℐ",xK="ℑ",bK="ı",wK="ℑ",MK="⊷",SK="Ƶ",AK="⇒",EK="℅",TK="∞",CK="⧝",PK="ı",RK="⊺",LK="∫",DK="∬",IK="ℤ",OK="∫",zK="⊺",kK="⋂",UK="⨗",NK="⨼",FK="⁣",BK="⁢",HK="Ё",VK="ё",GK="Į",qK="į",WK="𝕀",$K="𝕚",XK="Ι",jK="ι",YK="⨼",ZK="¿",KK="𝒾",JK="ℐ",QK="∈",tJ="⋵",eJ="⋹",nJ="⋴",iJ="⋳",sJ="∈",rJ="⁢",oJ="Ĩ",aJ="ĩ",lJ="І",cJ="і",uJ="Ï",hJ="ï",fJ="Ĵ",dJ="ĵ",pJ="Й",mJ="й",gJ="𝔍",vJ="𝔧",_J="ȷ",yJ="𝕁",xJ="𝕛",bJ="𝒥",wJ="𝒿",MJ="Ј",SJ="ј",AJ="Є",EJ="є",TJ="Κ",CJ="κ",PJ="ϰ",RJ="Ķ",LJ="ķ",DJ="К",IJ="к",OJ="𝔎",zJ="𝔨",kJ="ĸ",UJ="Х",NJ="х",FJ="Ќ",BJ="ќ",HJ="𝕂",VJ="𝕜",GJ="𝒦",qJ="𝓀",WJ="⇚",$J="Ĺ",XJ="ĺ",jJ="⦴",YJ="ℒ",ZJ="Λ",KJ="λ",JJ="⟨",QJ="⟪",tQ="⦑",eQ="⟨",nQ="⪅",iQ="ℒ",sQ="«",rQ="⇤",oQ="⤟",aQ="←",lQ="↞",cQ="⇐",uQ="⤝",hQ="↩",fQ="↫",dQ="⤹",pQ="⥳",mQ="↢",gQ="⤙",vQ="⤛",_Q="⪫",yQ="⪭",xQ="⪭︀",bQ="⤌",wQ="⤎",MQ="❲",SQ="{",AQ="[",EQ="⦋",TQ="⦏",CQ="⦍",PQ="Ľ",RQ="ľ",LQ="Ļ",DQ="ļ",IQ="⌈",OQ="{",zQ="Л",kQ="л",UQ="⤶",NQ="“",FQ="„",BQ="⥧",HQ="⥋",VQ="↲",GQ="≤",qQ="≦",WQ="⟨",$Q="⇤",XQ="←",jQ="←",YQ="⇐",ZQ="⇆",KQ="↢",JQ="⌈",QQ="⟦",ttt="⥡",ett="⥙",ntt="⇃",itt="⌊",stt="↽",rtt="↼",ott="⇇",att="↔",ltt="↔",ctt="⇔",utt="⇆",htt="⇋",ftt="↭",dtt="⥎",ptt="↤",mtt="⊣",gtt="⥚",vtt="⋋",_tt="⧏",ytt="⊲",xtt="⊴",btt="⥑",wtt="⥠",Mtt="⥘",Stt="↿",Att="⥒",Ett="↼",Ttt="⪋",Ctt="⋚",Ptt="≤",Rtt="≦",Ltt="⩽",Dtt="⪨",Itt="⩽",Ott="⩿",ztt="⪁",ktt="⪃",Utt="⋚︀",Ntt="⪓",Ftt="⪅",Btt="⋖",Htt="⋚",Vtt="⪋",Gtt="⋚",qtt="≦",Wtt="≶",$tt="≶",Xtt="⪡",jtt="≲",Ytt="⩽",Ztt="≲",Ktt="⥼",Jtt="⌊",Qtt="𝔏",tet="𝔩",eet="≶",net="⪑",iet="⥢",set="↽",ret="↼",oet="⥪",aet="▄",cet="Љ",uet="љ",het="⇇",fet="≪",det="⋘",pet="⌞",met="⇚",get="⥫",vet="◺",_et="Ŀ",yet="ŀ",xet="⎰",bet="⎰",wet="⪉",Met="⪉",Aet="⪇",Eet="≨",Tet="⪇",Cet="≨",Pet="⋦",Ret="⟬",Let="⇽",Det="⟦",Iet="⟵",Oet="⟵",zet="⟸",ket="⟷",Uet="⟷",Net="⟺",Fet="⟼",Bet="⟶",Het="⟶",Vet="⟹",Get="↫",qet="↬",Wet="⦅",$et="𝕃",Xet="𝕝",jet="⨭",Yet="⨴",Zet="∗",Ket="_",Jet="↙",Qet="↘",tnt="◊",ent="◊",nnt="⧫",int="(",snt="⦓",rnt="⇆",ont="⌟",ant="⇋",lnt="⥭",cnt="‎",unt="⊿",hnt="‹",fnt="𝓁",dnt="ℒ",pnt="↰",mnt="↰",gnt="≲",vnt="⪍",_nt="⪏",ynt="[",xnt="‘",bnt="‚",wnt="Ł",Mnt="ł",Snt="⪦",Ant="⩹",Ent="<",Tnt="<",Cnt="≪",Pnt="⋖",Rnt="⋋",Lnt="⋉",Dnt="⥶",Int="⩻",Ont="◃",znt="⊴",knt="◂",Unt="⦖",Nnt="⥊",Fnt="⥦",Bnt="≨︀",Hnt="≨︀",Vnt="¯",Gnt="♂",qnt="✠",Wnt="✠",$nt="↦",Xnt="↦",jnt="↧",Ynt="↤",Znt="↥",Knt="▮",Jnt="⨩",Qnt="М",tit="м",eit="—",nit="∺",iit="∡",sit=" ",rit="ℳ",oit="𝔐",ait="𝔪",lit="℧",cit="µ",uit="*",hit="⫰",fit="∣",dit="·",pit="⊟",mit="−",git="∸",vit="⨪",_it="∓",yit="⫛",xit="…",bit="∓",wit="⊧",Mit="𝕄",Sit="𝕞",Ait="∓",Eit="𝓂",Tit="ℳ",Cit="∾",Pit="Μ",Rit="μ",Lit="⊸",Dit="⊸",Iit="∇",Oit="Ń",zit="ń",kit="∠⃒",Uit="≉",Nit="⩰̸",Fit="≋̸",Bit="ŉ",Hit="≉",Vit="♮",Git="ℕ",qit="♮",Wit=" ",$it="≎̸",Xit="≏̸",jit="⩃",Yit="Ň",Zit="ň",Kit="Ņ",Jit="ņ",Qit="≇",tst="⩭̸",est="⩂",nst="Н",ist="н",sst="–",rst="⤤",ost="↗",ast="⇗",lst="↗",cst="≠",ust="≐̸",hst="​",fst="​",dst="​",pst="​",mst="≢",gst="⤨",vst="≂̸",_st="≫",yst="≪",xst=`
`,bst="∄",wst="∄",Mst="𝔑",Sst="𝔫",Ast="≧̸",Est="≱",Tst="≱",Cst="≧̸",Pst="⩾̸",Rst="⩾̸",Lst="⋙̸",Dst="≵",Ist="≫⃒",Ost="≯",zst="≯",kst="≫̸",Ust="↮",Nst="⇎",Fst="⫲",Bst="∋",Hst="⋼",Vst="⋺",Gst="∋",qst="Њ",Wst="њ",$st="↚",Xst="⇍",jst="‥",Yst="≦̸",Zst="≰",Kst="↚",Jst="⇍",Qst="↮",trt="⇎",ert="≰",nrt="≦̸",irt="⩽̸",srt="⩽̸",rrt="≮",ort="⋘̸",art="≴",lrt="≪⃒",crt="≮",urt="⋪",hrt="⋬",frt="≪̸",drt="∤",prt="⁠",mrt=" ",grt="𝕟",vrt="ℕ",_rt="⫬",yrt="¬",xrt="≢",brt="≭",wrt="∦",Mrt="∉",Srt="≠",Art="≂̸",Ert="∄",Trt="≯",Crt="≱",Prt="≧̸",Rrt="≫̸",Lrt="≹",Drt="⩾̸",Irt="≵",Ort="≎̸",zrt="≏̸",krt="∉",Urt="⋵̸",Nrt="⋹̸",Frt="∉",Brt="⋷",Hrt="⋶",Vrt="⧏̸",Grt="⋪",qrt="⋬",Wrt="≮",$rt="≰",Xrt="≸",jrt="≪̸",Yrt="⩽̸",Zrt="≴",Krt="⪢̸",Jrt="⪡̸",Qrt="∌",tot="∌",eot="⋾",not="⋽",iot="⊀",sot="⪯̸",rot="⋠",oot="∌",aot="⧐̸",lot="⋫",cot="⋭",uot="⊏̸",hot="⋢",fot="⊐̸",dot="⋣",pot="⊂⃒",mot="⊈",got="⊁",vot="⪰̸",_ot="⋡",yot="≿̸",xot="⊃⃒",bot="⊉",wot="≁",Mot="≄",Sot="≇",Aot="≉",Eot="∤",Tot="∦",Cot="∦",Pot="⫽⃥",Rot="∂̸",Lot="⨔",Dot="⊀",Iot="⋠",Oot="⊀",zot="⪯̸",kot="⪯̸",Uot="⤳̸",Not="↛",Fot="⇏",Bot="↝̸",Hot="↛",Vot="⇏",Got="⋫",qot="⋭",Wot="⊁",$ot="⋡",Xot="⪰̸",jot="𝒩",Yot="𝓃",Zot="∤",Kot="∦",Jot="≁",Qot="≄",tat="≄",eat="∤",nat="∦",iat="⋢",sat="⋣",rat="⊄",oat="⫅̸",aat="⊈",lat="⊂⃒",cat="⊈",uat="⫅̸",hat="⊁",fat="⪰̸",dat="⊅",pat="⫆̸",mat="⊉",gat="⊃⃒",vat="⊉",_at="⫆̸",yat="≹",xat="Ñ",bat="ñ",wat="≸",Mat="⋪",Sat="⋬",Aat="⋫",Eat="⋭",Tat="Ν",Cat="ν",Pat="#",Rat="№",Lat=" ",Dat="≍⃒",Iat="⊬",Oat="⊭",zat="⊮",kat="⊯",Uat="≥⃒",Nat=">⃒",Fat="⤄",Bat="⧞",Hat="⤂",Vat="≤⃒",Gat="<⃒",qat="⊴⃒",Wat="⤃",$at="⊵⃒",Xat="∼⃒",jat="⤣",Yat="↖",Zat="⇖",Kat="↖",Jat="⤧",Qat="Ó",tlt="ó",elt="⊛",nlt="Ô",ilt="ô",slt="⊚",rlt="О",olt="о",alt="⊝",llt="Ő",clt="ő",ult="⨸",hlt="⊙",flt="⦼",dlt="Œ",plt="œ",mlt="⦿",glt="𝔒",vlt="𝔬",_lt="˛",ylt="Ò",xlt="ò",blt="⧁",wlt="⦵",Mlt="Ω",Slt="∮",Alt="↺",Elt="⦾",Tlt="⦻",Clt="‾",Plt="⧀",Rlt="Ō",Llt="ō",Dlt="Ω",Ilt="ω",Olt="Ο",zlt="ο",klt="⦶",Ult="⊖",Nlt="𝕆",Flt="𝕠",Blt="⦷",Hlt="“",Vlt="‘",Glt="⦹",qlt="⊕",Wlt="↻",$lt="⩔",Xlt="∨",jlt="⩝",Ylt="ℴ",Zlt="ℴ",Klt="ª",Jlt="º",Qlt="⊶",tct="⩖",ect="⩗",nct="⩛",ict="Ⓢ",sct="𝒪",rct="ℴ",oct="Ø",act="ø",lct="⊘",cct="Õ",uct="õ",hct="⨶",fct="⨷",dct="⊗",pct="Ö",mct="ö",gct="⌽",vct="‾",_ct="⏞",yct="⎴",xct="⏜",bct="¶",wct="∥",Mct="∥",Sct="⫳",Act="⫽",Ect="∂",Tct="∂",Cct="П",Pct="п",Rct="%",Lct=".",Dct="‰",Ict="⊥",Oct="‱",zct="𝔓",kct="𝔭",Uct="Φ",Nct="φ",Fct="ϕ",Bct="ℳ",Hct="☎",Vct="Π",Gct="π",qct="⋔",Wct="ϖ",$ct="ℏ",Xct="ℎ",jct="ℏ",Yct="⨣",Zct="⊞",Kct="⨢",Jct="+",Qct="∔",tut="⨥",eut="⩲",nut="±",iut="±",sut="⨦",rut="⨧",out="±",aut="ℌ",lut="⨕",cut="𝕡",uut="ℙ",hut="£",fut="⪷",dut="⪻",put="≺",mut="≼",gut="⪷",vut="≺",_ut="≼",yut="≺",xut="⪯",but="≼",wut="≾",Mut="⪯",Sut="⪹",Aut="⪵",Eut="⋨",Tut="⪯",Cut="⪳",Put="≾",Rut="′",Lut="″",Dut="ℙ",Iut="⪹",Out="⪵",zut="⋨",kut="∏",Uut="∏",Nut="⌮",Fut="⌒",But="⌓",Hut="∝",Vut="∝",Gut="∷",qut="∝",Wut="≾",$ut="⊰",Xut="𝒫",jut="𝓅",Yut="Ψ",Zut="ψ",Kut=" ",Jut="𝔔",Qut="𝔮",tht="⨌",eht="𝕢",nht="ℚ",iht="⁗",sht="𝒬",rht="𝓆",oht="ℍ",aht="⨖",lht="?",cht="≟",uht='"',hht='"',fht="⇛",dht="∽̱",pht="Ŕ",mht="ŕ",ght="√",vht="⦳",_ht="⟩",yht="⟫",xht="⦒",bht="⦥",wht="⟩",Mht="»",Sht="⥵",Aht="⇥",Eht="⤠",Tht="⤳",Cht="→",Pht="↠",Rht="⇒",Lht="⤞",Dht="↪",Iht="↬",Oht="⥅",zht="⥴",kht="⤖",Uht="↣",Nht="↝",Fht="⤚",Bht="⤜",Hht="∶",Vht="ℚ",Ght="⤍",qht="⤏",Wht="⤐",$ht="❳",Xht="}",jht="]",Yht="⦌",Zht="⦎",Kht="⦐",Jht="Ř",Qht="ř",tft="Ŗ",eft="ŗ",nft="⌉",ift="}",sft="Р",rft="р",oft="⤷",aft="⥩",lft="”",cft="”",uft="↳",hft="ℜ",fft="ℛ",dft="ℜ",pft="ℝ",mft="ℜ",gft="▭",vft="®",_ft="®",yft="∋",xft="⇋",bft="⥯",wft="⥽",Mft="⌋",Sft="𝔯",Aft="ℜ",Eft="⥤",Tft="⇁",Cft="⇀",Pft="⥬",Rft="Ρ",Lft="ρ",Dft="ϱ",Ift="⟩",Oft="⇥",zft="→",kft="→",Uft="⇒",Nft="⇄",Fft="↣",Bft="⌉",Hft="⟧",Vft="⥝",Gft="⥕",qft="⇂",Wft="⌋",$ft="⇁",Xft="⇀",jft="⇄",Yft="⇌",Zft="⇉",Kft="↝",Jft="↦",Qft="⊢",tdt="⥛",edt="⋌",ndt="⧐",idt="⊳",sdt="⊵",rdt="⥏",odt="⥜",adt="⥔",ldt="↾",cdt="⥓",udt="⇀",hdt="˚",fdt="≓",ddt="⇄",pdt="⇌",mdt="‏",gdt="⎱",vdt="⎱",_dt="⫮",ydt="⟭",xdt="⇾",bdt="⟧",wdt="⦆",Mdt="𝕣",Sdt="ℝ",Adt="⨮",Edt="⨵",Tdt="⥰",Cdt=")",Pdt="⦔",Rdt="⨒",Ldt="⇉",Ddt="⇛",Idt="›",Odt="𝓇",zdt="ℛ",kdt="↱",Udt="↱",Ndt="]",Fdt="’",Bdt="’",Hdt="⋌",Vdt="⋊",Gdt="▹",qdt="⊵",Wdt="▸",$dt="⧎",Xdt="⧴",jdt="⥨",Ydt="℞",Zdt="Ś",Kdt="ś",Jdt="‚",Qdt="⪸",tpt="Š",ept="š",npt="⪼",ipt="≻",spt="≽",rpt="⪰",opt="⪴",apt="Ş",lpt="ş",cpt="Ŝ",upt="ŝ",hpt="⪺",fpt="⪶",dpt="⋩",ppt="⨓",mpt="≿",gpt="С",vpt="с",_pt="⊡",ypt="⋅",xpt="⩦",bpt="⤥",wpt="↘",Mpt="⇘",Spt="↘",Apt="§",Ept=";",Tpt="⤩",Cpt="∖",Ppt="∖",Rpt="✶",Lpt="𝔖",Dpt="𝔰",Ipt="⌢",Opt="♯",zpt="Щ",kpt="щ",Upt="Ш",Npt="ш",Fpt="↓",Bpt="←",Hpt="∣",Vpt="∥",Gpt="→",qpt="↑",Wpt="­",$pt="Σ",Xpt="σ",jpt="ς",Ypt="ς",Zpt="∼",Kpt="⩪",Jpt="≃",Qpt="≃",tmt="⪞",emt="⪠",nmt="⪝",imt="⪟",smt="≆",rmt="⨤",omt="⥲",amt="←",lmt="∘",cmt="∖",umt="⨳",hmt="⧤",fmt="∣",dmt="⌣",pmt="⪪",mmt="⪬",gmt="⪬︀",vmt="Ь",_mt="ь",ymt="⌿",xmt="⧄",bmt="/",wmt="𝕊",Mmt="𝕤",Smt="♠",Amt="♠",Emt="∥",Tmt="⊓",Cmt="⊓︀",Pmt="⊔",Rmt="⊔︀",Lmt="√",Dmt="⊏",Imt="⊑",Omt="⊏",zmt="⊑",kmt="⊐",Umt="⊒",Nmt="⊐",Fmt="⊒",Bmt="□",Hmt="□",Vmt="⊓",Gmt="⊏",qmt="⊑",Wmt="⊐",$mt="⊒",Xmt="⊔",jmt="▪",Ymt="□",Zmt="▪",Kmt="→",Jmt="𝒮",Qmt="𝓈",tgt="∖",egt="⌣",ngt="⋆",igt="⋆",sgt="☆",rgt="★",ogt="ϵ",agt="ϕ",lgt="¯",cgt="⊂",ugt="⋐",hgt="⪽",fgt="⫅",dgt="⊆",pgt="⫃",mgt="⫁",ggt="⫋",vgt="⊊",_gt="⪿",ygt="⥹",xgt="⊂",bgt="⋐",wgt="⊆",Mgt="⫅",Sgt="⊆",Agt="⊊",Egt="⫋",Tgt="⫇",Cgt="⫕",Pgt="⫓",Rgt="⪸",Lgt="≻",Dgt="≽",Igt="≻",Ogt="⪰",zgt="≽",kgt="≿",Ugt="⪰",Ngt="⪺",Fgt="⪶",Bgt="⋩",Hgt="≿",Vgt="∋",Ggt="∑",qgt="∑",Wgt="♪",$gt="¹",Xgt="²",jgt="³",Ygt="⊃",Zgt="⋑",Kgt="⪾",Jgt="⫘",Qgt="⫆",tvt="⊇",evt="⫄",nvt="⊃",ivt="⊇",svt="⟉",rvt="⫗",ovt="⥻",avt="⫂",lvt="⫌",cvt="⊋",uvt="⫀",hvt="⊃",fvt="⋑",dvt="⊇",pvt="⫆",mvt="⊋",gvt="⫌",vvt="⫈",_vt="⫔",yvt="⫖",xvt="⤦",bvt="↙",wvt="⇙",Mvt="↙",Svt="⤪",Avt="ß",Evt="	",Tvt="⌖",Cvt="Τ",Pvt="τ",Rvt="⎴",Lvt="Ť",Dvt="ť",Ivt="Ţ",Ovt="ţ",zvt="Т",kvt="т",Uvt="⃛",Nvt="⌕",Fvt="𝔗",Bvt="𝔱",Hvt="∴",Vvt="∴",Gvt="∴",qvt="Θ",Wvt="θ",$vt="ϑ",Xvt="ϑ",jvt="≈",Yvt="∼",Zvt="  ",Kvt=" ",Jvt=" ",Qvt="≈",t_t="∼",e_t="Þ",n_t="þ",i_t="˜",s_t="∼",r_t="≃",o_t="≅",a_t="≈",l_t="⨱",c_t="⊠",u_t="×",h_t="⨰",f_t="∭",d_t="⤨",p_t="⌶",m_t="⫱",g_t="⊤",v_t="𝕋",__t="𝕥",y_t="⫚",x_t="⤩",b_t="‴",w_t="™",M_t="™",S_t="▵",A_t="▿",E_t="◃",T_t="⊴",C_t="≜",P_t="▹",R_t="⊵",L_t="◬",D_t="≜",I_t="⨺",O_t="⃛",z_t="⨹",k_t="⧍",U_t="⨻",N_t="⏢",F_t="𝒯",B_t="𝓉",H_t="Ц",V_t="ц",G_t="Ћ",q_t="ћ",W_t="Ŧ",$_t="ŧ",X_t="≬",j_t="↞",Y_t="↠",Z_t="Ú",K_t="ú",J_t="↑",Q_t="↟",tyt="⇑",eyt="⥉",nyt="Ў",iyt="ў",syt="Ŭ",ryt="ŭ",oyt="Û",ayt="û",lyt="У",cyt="у",uyt="⇅",hyt="Ű",fyt="ű",dyt="⥮",pyt="⥾",myt="𝔘",gyt="𝔲",vyt="Ù",_yt="ù",yyt="⥣",xyt="↿",byt="↾",wyt="▀",Myt="⌜",Syt="⌜",Ayt="⌏",Eyt="◸",Tyt="Ū",Cyt="ū",Pyt="¨",Ryt="_",Lyt="⏟",Dyt="⎵",Iyt="⏝",Oyt="⋃",zyt="⊎",kyt="Ų",Uyt="ų",Nyt="𝕌",Fyt="𝕦",Byt="⤒",Hyt="↑",Vyt="↑",Gyt="⇑",qyt="⇅",Wyt="↕",$yt="↕",Xyt="⇕",jyt="⥮",Yyt="↿",Zyt="↾",Kyt="⊎",Jyt="↖",Qyt="↗",t0t="υ",e0t="ϒ",n0t="ϒ",i0t="Υ",s0t="υ",r0t="↥",o0t="⊥",a0t="⇈",l0t="⌝",c0t="⌝",u0t="⌎",h0t="Ů",f0t="ů",d0t="◹",p0t="𝒰",m0t="𝓊",g0t="⋰",v0t="Ũ",_0t="ũ",y0t="▵",x0t="▴",b0t="⇈",w0t="Ü",M0t="ü",S0t="⦧",A0t="⦜",E0t="ϵ",T0t="ϰ",C0t="∅",P0t="ϕ",R0t="ϖ",L0t="∝",D0t="↕",I0t="⇕",O0t="ϱ",z0t="ς",k0t="⊊︀",U0t="⫋︀",N0t="⊋︀",F0t="⫌︀",B0t="ϑ",H0t="⊲",V0t="⊳",G0t="⫨",q0t="⫫",W0t="⫩",$0t="В",X0t="в",j0t="⊢",Y0t="⊨",Z0t="⊩",K0t="⊫",J0t="⫦",Q0t="⊻",txt="∨",ext="⋁",nxt="≚",ixt="⋮",sxt="|",rxt="‖",oxt="|",axt="‖",lxt="∣",cxt="|",uxt="❘",hxt="≀",fxt=" ",dxt="𝔙",pxt="𝔳",mxt="⊲",gxt="⊂⃒",vxt="⊃⃒",_xt="𝕍",yxt="𝕧",xxt="∝",bxt="⊳",wxt="𝒱",Mxt="𝓋",Sxt="⫋︀",Axt="⊊︀",Ext="⫌︀",Txt="⊋︀",Cxt="⊪",Pxt="⦚",Rxt="Ŵ",Lxt="ŵ",Dxt="⩟",Ixt="∧",Oxt="⋀",zxt="≙",kxt="℘",Uxt="𝔚",Nxt="𝔴",Fxt="𝕎",Bxt="𝕨",Hxt="℘",Vxt="≀",Gxt="≀",qxt="𝒲",Wxt="𝓌",$xt="⋂",Xxt="◯",jxt="⋃",Yxt="▽",Zxt="𝔛",Kxt="𝔵",Jxt="⟷",Qxt="⟺",tbt="Ξ",ebt="ξ",nbt="⟵",ibt="⟸",sbt="⟼",rbt="⋻",obt="⨀",abt="𝕏",lbt="𝕩",cbt="⨁",ubt="⨂",hbt="⟶",fbt="⟹",dbt="𝒳",pbt="𝓍",mbt="⨆",gbt="⨄",vbt="△",_bt="⋁",ybt="⋀",xbt="Ý",bbt="ý",wbt="Я",Mbt="я",Sbt="Ŷ",Abt="ŷ",Ebt="Ы",Tbt="ы",Cbt="¥",Pbt="𝔜",Rbt="𝔶",Lbt="Ї",Dbt="ї",Ibt="𝕐",Obt="𝕪",zbt="𝒴",kbt="𝓎",Ubt="Ю",Nbt="ю",Fbt="ÿ",Bbt="Ÿ",Hbt="Ź",Vbt="ź",Gbt="Ž",qbt="ž",Wbt="З",$bt="з",Xbt="Ż",jbt="ż",Ybt="ℨ",Zbt="​",Kbt="Ζ",Jbt="ζ",Qbt="𝔷",twt="ℨ",ewt="Ж",nwt="ж",iwt="⇝",swt="𝕫",rwt="ℤ",owt="𝒵",awt="𝓏",lwt="‍",cwt="‌",JA={Aacute:WV,aacute:$V,Abreve:XV,abreve:jV,ac:YV,acd:ZV,acE:KV,Acirc:JV,acirc:QV,acute:tG,Acy:eG,acy:nG,AElig:iG,aelig:sG,af:rG,Afr:oG,afr:aG,Agrave:lG,agrave:cG,alefsym:uG,aleph:hG,Alpha:fG,alpha:dG,Amacr:pG,amacr:mG,amalg:gG,amp:vG,AMP:_G,andand:yG,And:xG,and:bG,andd:wG,andslope:MG,andv:SG,ang:AG,ange:EG,angle:TG,angmsdaa:CG,angmsdab:PG,angmsdac:RG,angmsdad:LG,angmsdae:DG,angmsdaf:IG,angmsdag:OG,angmsdah:zG,angmsd:kG,angrt:UG,angrtvb:NG,angrtvbd:FG,angsph:BG,angst:HG,angzarr:VG,Aogon:GG,aogon:qG,Aopf:WG,aopf:$G,apacir:XG,ap:jG,apE:YG,ape:ZG,apid:KG,apos:JG,ApplyFunction:QG,approx:t5,approxeq:e5,Aring:n5,aring:i5,Ascr:s5,ascr:r5,Assign:o5,ast:a5,asymp:l5,asympeq:c5,Atilde:u5,atilde:h5,Auml:f5,auml:d5,awconint:p5,awint:m5,backcong:g5,backepsilon:v5,backprime:_5,backsim:y5,backsimeq:x5,Backslash:b5,Barv:w5,barvee:M5,barwed:S5,Barwed:A5,barwedge:E5,bbrk:T5,bbrktbrk:C5,bcong:P5,Bcy:R5,bcy:L5,bdquo:D5,becaus:I5,because:O5,Because:z5,bemptyv:k5,bepsi:U5,bernou:N5,Bernoullis:F5,Beta:B5,beta:H5,beth:V5,between:G5,Bfr:q5,bfr:W5,bigcap:$5,bigcirc:X5,bigcup:j5,bigodot:Y5,bigoplus:Z5,bigotimes:K5,bigsqcup:J5,bigstar:Q5,bigtriangledown:tq,bigtriangleup:eq,biguplus:nq,bigvee:iq,bigwedge:sq,bkarow:rq,blacklozenge:oq,blacksquare:aq,blacktriangle:lq,blacktriangledown:cq,blacktriangleleft:uq,blacktriangleright:hq,blank:fq,blk12:dq,blk14:pq,blk34:mq,block:gq,bne:vq,bnequiv:_q,bNot:yq,bnot:xq,Bopf:bq,bopf:wq,bot:Mq,bottom:Sq,bowtie:Aq,boxbox:Eq,boxdl:Tq,boxdL:Cq,boxDl:Pq,boxDL:Rq,boxdr:Lq,boxdR:Dq,boxDr:Iq,boxDR:Oq,boxh:zq,boxH:kq,boxhd:Uq,boxHd:Nq,boxhD:Fq,boxHD:Bq,boxhu:Hq,boxHu:Vq,boxhU:Gq,boxHU:qq,boxminus:Wq,boxplus:$q,boxtimes:Xq,boxul:jq,boxuL:Yq,boxUl:Zq,boxUL:Kq,boxur:Jq,boxuR:Qq,boxUr:tW,boxUR:eW,boxv:nW,boxV:iW,boxvh:sW,boxvH:rW,boxVh:oW,boxVH:aW,boxvl:lW,boxvL:cW,boxVl:uW,boxVL:hW,boxvr:fW,boxvR:dW,boxVr:pW,boxVR:mW,bprime:gW,breve:vW,Breve:_W,brvbar:yW,bscr:xW,Bscr:bW,bsemi:wW,bsim:MW,bsime:SW,bsolb:AW,bsol:EW,bsolhsub:TW,bull:CW,bullet:PW,bump:RW,bumpE:LW,bumpe:DW,Bumpeq:IW,bumpeq:OW,Cacute:zW,cacute:kW,capand:UW,capbrcup:NW,capcap:FW,cap:BW,Cap:HW,capcup:VW,capdot:GW,CapitalDifferentialD:qW,caps:WW,caret:$W,caron:XW,Cayleys:jW,ccaps:YW,Ccaron:ZW,ccaron:KW,Ccedil:JW,ccedil:QW,Ccirc:t$,ccirc:e$,Cconint:n$,ccups:i$,ccupssm:s$,Cdot:r$,cdot:o$,cedil:a$,Cedilla:l$,cemptyv:c$,cent:u$,centerdot:h$,CenterDot:f$,cfr:d$,Cfr:p$,CHcy:m$,chcy:g$,check:v$,checkmark:_$,Chi:y$,chi:x$,circ:b$,circeq:w$,circlearrowleft:M$,circlearrowright:S$,circledast:A$,circledcirc:E$,circleddash:T$,CircleDot:C$,circledR:P$,circledS:R$,CircleMinus:L$,CirclePlus:D$,CircleTimes:I$,cir:O$,cirE:z$,cire:k$,cirfnint:U$,cirmid:N$,cirscir:F$,ClockwiseContourIntegral:B$,CloseCurlyDoubleQuote:H$,CloseCurlyQuote:V$,clubs:G$,clubsuit:q$,colon:W$,Colon:$$,Colone:X$,colone:j$,coloneq:Y$,comma:Z$,commat:K$,comp:J$,compfn:Q$,complement:t8,complexes:e8,cong:n8,congdot:i8,Congruent:s8,conint:r8,Conint:o8,ContourIntegral:a8,copf:l8,Copf:c8,coprod:u8,Coproduct:h8,copy:f8,COPY:d8,copysr:p8,CounterClockwiseContourIntegral:m8,crarr:g8,cross:v8,Cross:_8,Cscr:y8,cscr:x8,csub:b8,csube:w8,csup:M8,csupe:S8,ctdot:A8,cudarrl:E8,cudarrr:T8,cuepr:C8,cuesc:P8,cularr:R8,cularrp:L8,cupbrcap:D8,cupcap:I8,CupCap:O8,cup:z8,Cup:k8,cupcup:U8,cupdot:N8,cupor:F8,cups:B8,curarr:H8,curarrm:V8,curlyeqprec:G8,curlyeqsucc:q8,curlyvee:W8,curlywedge:$8,curren:X8,curvearrowleft:j8,curvearrowright:Y8,cuvee:Z8,cuwed:K8,cwconint:J8,cwint:Q8,cylcty:t6,dagger:e6,Dagger:n6,daleth:i6,darr:s6,Darr:r6,dArr:o6,dash:a6,Dashv:l6,dashv:c6,dbkarow:u6,dblac:h6,Dcaron:f6,dcaron:d6,Dcy:p6,dcy:m6,ddagger:g6,ddarr:v6,DD:_6,dd:y6,DDotrahd:x6,ddotseq:b6,deg:w6,Del:M6,Delta:S6,delta:A6,demptyv:E6,dfisht:T6,Dfr:C6,dfr:P6,dHar:R6,dharl:L6,dharr:D6,DiacriticalAcute:I6,DiacriticalDot:O6,DiacriticalDoubleAcute:z6,DiacriticalGrave:k6,DiacriticalTilde:U6,diam:N6,diamond:F6,Diamond:B6,diamondsuit:H6,diams:V6,die:G6,DifferentialD:q6,digamma:W6,disin:$6,div:X6,divide:j6,divideontimes:Y6,divonx:Z6,DJcy:K6,djcy:J6,dlcorn:Q6,dlcrop:tX,dollar:eX,Dopf:nX,dopf:iX,Dot:sX,dot:rX,DotDot:oX,doteq:aX,doteqdot:lX,DotEqual:cX,dotminus:uX,dotplus:hX,dotsquare:fX,doublebarwedge:dX,DoubleContourIntegral:pX,DoubleDot:mX,DoubleDownArrow:gX,DoubleLeftArrow:vX,DoubleLeftRightArrow:_X,DoubleLeftTee:yX,DoubleLongLeftArrow:xX,DoubleLongLeftRightArrow:bX,DoubleLongRightArrow:wX,DoubleRightArrow:MX,DoubleRightTee:SX,DoubleUpArrow:AX,DoubleUpDownArrow:EX,DoubleVerticalBar:TX,DownArrowBar:CX,downarrow:PX,DownArrow:RX,Downarrow:LX,DownArrowUpArrow:DX,DownBreve:IX,downdownarrows:OX,downharpoonleft:zX,downharpoonright:kX,DownLeftRightVector:UX,DownLeftTeeVector:NX,DownLeftVectorBar:FX,DownLeftVector:BX,DownRightTeeVector:HX,DownRightVectorBar:VX,DownRightVector:GX,DownTeeArrow:qX,DownTee:WX,drbkarow:$X,drcorn:XX,drcrop:jX,Dscr:YX,dscr:ZX,DScy:KX,dscy:JX,dsol:QX,Dstrok:tj,dstrok:ej,dtdot:nj,dtri:ij,dtrif:sj,duarr:rj,duhar:oj,dwangle:aj,DZcy:lj,dzcy:cj,dzigrarr:uj,Eacute:hj,eacute:fj,easter:dj,Ecaron:pj,ecaron:mj,Ecirc:gj,ecirc:vj,ecir:_j,ecolon:yj,Ecy:xj,ecy:bj,eDDot:wj,Edot:Mj,edot:Sj,eDot:Aj,ee:Ej,efDot:Tj,Efr:Cj,efr:Pj,eg:Rj,Egrave:Lj,egrave:Dj,egs:Ij,egsdot:Oj,el:zj,Element:kj,elinters:Uj,ell:Nj,els:Fj,elsdot:Bj,Emacr:Hj,emacr:Vj,empty:Gj,emptyset:qj,EmptySmallSquare:Wj,emptyv:$j,EmptyVerySmallSquare:Xj,emsp13:jj,emsp14:Yj,emsp:Zj,ENG:Kj,eng:Jj,ensp:Qj,Eogon:t9,eogon:e9,Eopf:n9,eopf:i9,epar:s9,eparsl:r9,eplus:o9,epsi:a9,Epsilon:l9,epsilon:c9,epsiv:u9,eqcirc:h9,eqcolon:f9,eqsim:d9,eqslantgtr:p9,eqslantless:m9,Equal:g9,equals:v9,EqualTilde:_9,equest:y9,Equilibrium:x9,equiv:b9,equivDD:w9,eqvparsl:M9,erarr:S9,erDot:A9,escr:E9,Escr:T9,esdot:C9,Esim:P9,esim:R9,Eta:L9,eta:D9,ETH:I9,eth:O9,Euml:z9,euml:k9,euro:U9,excl:N9,exist:F9,Exists:B9,expectation:H9,exponentiale:V9,ExponentialE:G9,fallingdotseq:q9,Fcy:W9,fcy:$9,female:X9,ffilig:j9,fflig:Y9,ffllig:Z9,Ffr:K9,ffr:J9,filig:Q9,FilledSmallSquare:tY,FilledVerySmallSquare:eY,fjlig:nY,flat:iY,fllig:sY,fltns:rY,fnof:oY,Fopf:aY,fopf:lY,forall:cY,ForAll:uY,fork:hY,forkv:fY,Fouriertrf:dY,fpartint:pY,frac12:mY,frac13:gY,frac14:vY,frac15:_Y,frac16:yY,frac18:xY,frac23:bY,frac25:wY,frac34:MY,frac35:SY,frac38:AY,frac45:EY,frac56:TY,frac58:CY,frac78:PY,frasl:RY,frown:LY,fscr:DY,Fscr:IY,gacute:OY,Gamma:zY,gamma:kY,Gammad:UY,gammad:NY,gap:FY,Gbreve:BY,gbreve:HY,Gcedil:VY,Gcirc:GY,gcirc:qY,Gcy:WY,gcy:$Y,Gdot:XY,gdot:jY,ge:YY,gE:ZY,gEl:KY,gel:JY,geq:QY,geqq:t7,geqslant:e7,gescc:n7,ges:i7,gesdot:s7,gesdoto:r7,gesdotol:o7,gesl:a7,gesles:l7,Gfr:c7,gfr:u7,gg:h7,Gg:f7,ggg:d7,gimel:p7,GJcy:m7,gjcy:g7,gla:v7,gl:_7,glE:y7,glj:x7,gnap:b7,gnapprox:w7,gne:M7,gnE:S7,gneq:A7,gneqq:E7,gnsim:T7,Gopf:C7,gopf:P7,grave:R7,GreaterEqual:L7,GreaterEqualLess:D7,GreaterFullEqual:I7,GreaterGreater:O7,GreaterLess:z7,GreaterSlantEqual:k7,GreaterTilde:U7,Gscr:N7,gscr:F7,gsim:B7,gsime:H7,gsiml:V7,gtcc:G7,gtcir:q7,gt:W7,GT:$7,Gt:X7,gtdot:j7,gtlPar:Y7,gtquest:Z7,gtrapprox:K7,gtrarr:J7,gtrdot:Q7,gtreqless:tZ,gtreqqless:eZ,gtrless:nZ,gtrsim:iZ,gvertneqq:sZ,gvnE:rZ,Hacek:oZ,hairsp:aZ,half:lZ,hamilt:cZ,HARDcy:uZ,hardcy:hZ,harrcir:fZ,harr:dZ,hArr:pZ,harrw:mZ,Hat:gZ,hbar:vZ,Hcirc:_Z,hcirc:yZ,hearts:xZ,heartsuit:bZ,hellip:wZ,hercon:MZ,hfr:SZ,Hfr:AZ,HilbertSpace:EZ,hksearow:TZ,hkswarow:CZ,hoarr:PZ,homtht:RZ,hookleftarrow:LZ,hookrightarrow:DZ,hopf:IZ,Hopf:OZ,horbar:zZ,HorizontalLine:kZ,hscr:UZ,Hscr:NZ,hslash:FZ,Hstrok:BZ,hstrok:HZ,HumpDownHump:VZ,HumpEqual:GZ,hybull:qZ,hyphen:WZ,Iacute:$Z,iacute:XZ,ic:jZ,Icirc:YZ,icirc:ZZ,Icy:KZ,icy:JZ,Idot:QZ,IEcy:tK,iecy:eK,iexcl:nK,iff:iK,ifr:sK,Ifr:rK,Igrave:oK,igrave:aK,ii:lK,iiiint:cK,iiint:uK,iinfin:hK,iiota:fK,IJlig:dK,ijlig:pK,Imacr:mK,imacr:gK,image:vK,ImaginaryI:_K,imagline:yK,imagpart:xK,imath:bK,Im:wK,imof:MK,imped:SK,Implies:AK,incare:EK,in:"∈",infin:TK,infintie:CK,inodot:PK,intcal:RK,int:LK,Int:DK,integers:IK,Integral:OK,intercal:zK,Intersection:kK,intlarhk:UK,intprod:NK,InvisibleComma:FK,InvisibleTimes:BK,IOcy:HK,iocy:VK,Iogon:GK,iogon:qK,Iopf:WK,iopf:$K,Iota:XK,iota:jK,iprod:YK,iquest:ZK,iscr:KK,Iscr:JK,isin:QK,isindot:tJ,isinE:eJ,isins:nJ,isinsv:iJ,isinv:sJ,it:rJ,Itilde:oJ,itilde:aJ,Iukcy:lJ,iukcy:cJ,Iuml:uJ,iuml:hJ,Jcirc:fJ,jcirc:dJ,Jcy:pJ,jcy:mJ,Jfr:gJ,jfr:vJ,jmath:_J,Jopf:yJ,jopf:xJ,Jscr:bJ,jscr:wJ,Jsercy:MJ,jsercy:SJ,Jukcy:AJ,jukcy:EJ,Kappa:TJ,kappa:CJ,kappav:PJ,Kcedil:RJ,kcedil:LJ,Kcy:DJ,kcy:IJ,Kfr:OJ,kfr:zJ,kgreen:kJ,KHcy:UJ,khcy:NJ,KJcy:FJ,kjcy:BJ,Kopf:HJ,kopf:VJ,Kscr:GJ,kscr:qJ,lAarr:WJ,Lacute:$J,lacute:XJ,laemptyv:jJ,lagran:YJ,Lambda:ZJ,lambda:KJ,lang:JJ,Lang:QJ,langd:tQ,langle:eQ,lap:nQ,Laplacetrf:iQ,laquo:sQ,larrb:rQ,larrbfs:oQ,larr:aQ,Larr:lQ,lArr:cQ,larrfs:uQ,larrhk:hQ,larrlp:fQ,larrpl:dQ,larrsim:pQ,larrtl:mQ,latail:gQ,lAtail:vQ,lat:_Q,late:yQ,lates:xQ,lbarr:bQ,lBarr:wQ,lbbrk:MQ,lbrace:SQ,lbrack:AQ,lbrke:EQ,lbrksld:TQ,lbrkslu:CQ,Lcaron:PQ,lcaron:RQ,Lcedil:LQ,lcedil:DQ,lceil:IQ,lcub:OQ,Lcy:zQ,lcy:kQ,ldca:UQ,ldquo:NQ,ldquor:FQ,ldrdhar:BQ,ldrushar:HQ,ldsh:VQ,le:GQ,lE:qQ,LeftAngleBracket:WQ,LeftArrowBar:$Q,leftarrow:XQ,LeftArrow:jQ,Leftarrow:YQ,LeftArrowRightArrow:ZQ,leftarrowtail:KQ,LeftCeiling:JQ,LeftDoubleBracket:QQ,LeftDownTeeVector:ttt,LeftDownVectorBar:ett,LeftDownVector:ntt,LeftFloor:itt,leftharpoondown:stt,leftharpoonup:rtt,leftleftarrows:ott,leftrightarrow:att,LeftRightArrow:ltt,Leftrightarrow:ctt,leftrightarrows:utt,leftrightharpoons:htt,leftrightsquigarrow:ftt,LeftRightVector:dtt,LeftTeeArrow:ptt,LeftTee:mtt,LeftTeeVector:gtt,leftthreetimes:vtt,LeftTriangleBar:_tt,LeftTriangle:ytt,LeftTriangleEqual:xtt,LeftUpDownVector:btt,LeftUpTeeVector:wtt,LeftUpVectorBar:Mtt,LeftUpVector:Stt,LeftVectorBar:Att,LeftVector:Ett,lEg:Ttt,leg:Ctt,leq:Ptt,leqq:Rtt,leqslant:Ltt,lescc:Dtt,les:Itt,lesdot:Ott,lesdoto:ztt,lesdotor:ktt,lesg:Utt,lesges:Ntt,lessapprox:Ftt,lessdot:Btt,lesseqgtr:Htt,lesseqqgtr:Vtt,LessEqualGreater:Gtt,LessFullEqual:qtt,LessGreater:Wtt,lessgtr:$tt,LessLess:Xtt,lesssim:jtt,LessSlantEqual:Ytt,LessTilde:Ztt,lfisht:Ktt,lfloor:Jtt,Lfr:Qtt,lfr:tet,lg:eet,lgE:net,lHar:iet,lhard:set,lharu:ret,lharul:oet,lhblk:aet,LJcy:cet,ljcy:uet,llarr:het,ll:fet,Ll:det,llcorner:pet,Lleftarrow:met,llhard:get,lltri:vet,Lmidot:_et,lmidot:yet,lmoustache:xet,lmoust:bet,lnap:wet,lnapprox:Met,lne:Aet,lnE:Eet,lneq:Tet,lneqq:Cet,lnsim:Pet,loang:Ret,loarr:Let,lobrk:Det,longleftarrow:Iet,LongLeftArrow:Oet,Longleftarrow:zet,longleftrightarrow:ket,LongLeftRightArrow:Uet,Longleftrightarrow:Net,longmapsto:Fet,longrightarrow:Bet,LongRightArrow:Het,Longrightarrow:Vet,looparrowleft:Get,looparrowright:qet,lopar:Wet,Lopf:$et,lopf:Xet,loplus:jet,lotimes:Yet,lowast:Zet,lowbar:Ket,LowerLeftArrow:Jet,LowerRightArrow:Qet,loz:tnt,lozenge:ent,lozf:nnt,lpar:int,lparlt:snt,lrarr:rnt,lrcorner:ont,lrhar:ant,lrhard:lnt,lrm:cnt,lrtri:unt,lsaquo:hnt,lscr:fnt,Lscr:dnt,lsh:pnt,Lsh:mnt,lsim:gnt,lsime:vnt,lsimg:_nt,lsqb:ynt,lsquo:xnt,lsquor:bnt,Lstrok:wnt,lstrok:Mnt,ltcc:Snt,ltcir:Ant,lt:Ent,LT:Tnt,Lt:Cnt,ltdot:Pnt,lthree:Rnt,ltimes:Lnt,ltlarr:Dnt,ltquest:Int,ltri:Ont,ltrie:znt,ltrif:knt,ltrPar:Unt,lurdshar:Nnt,luruhar:Fnt,lvertneqq:Bnt,lvnE:Hnt,macr:Vnt,male:Gnt,malt:qnt,maltese:Wnt,Map:"⤅",map:$nt,mapsto:Xnt,mapstodown:jnt,mapstoleft:Ynt,mapstoup:Znt,marker:Knt,mcomma:Jnt,Mcy:Qnt,mcy:tit,mdash:eit,mDDot:nit,measuredangle:iit,MediumSpace:sit,Mellintrf:rit,Mfr:oit,mfr:ait,mho:lit,micro:cit,midast:uit,midcir:hit,mid:fit,middot:dit,minusb:pit,minus:mit,minusd:git,minusdu:vit,MinusPlus:_it,mlcp:yit,mldr:xit,mnplus:bit,models:wit,Mopf:Mit,mopf:Sit,mp:Ait,mscr:Eit,Mscr:Tit,mstpos:Cit,Mu:Pit,mu:Rit,multimap:Lit,mumap:Dit,nabla:Iit,Nacute:Oit,nacute:zit,nang:kit,nap:Uit,napE:Nit,napid:Fit,napos:Bit,napprox:Hit,natural:Vit,naturals:Git,natur:qit,nbsp:Wit,nbump:$it,nbumpe:Xit,ncap:jit,Ncaron:Yit,ncaron:Zit,Ncedil:Kit,ncedil:Jit,ncong:Qit,ncongdot:tst,ncup:est,Ncy:nst,ncy:ist,ndash:sst,nearhk:rst,nearr:ost,neArr:ast,nearrow:lst,ne:cst,nedot:ust,NegativeMediumSpace:hst,NegativeThickSpace:fst,NegativeThinSpace:dst,NegativeVeryThinSpace:pst,nequiv:mst,nesear:gst,nesim:vst,NestedGreaterGreater:_st,NestedLessLess:yst,NewLine:xst,nexist:bst,nexists:wst,Nfr:Mst,nfr:Sst,ngE:Ast,nge:Est,ngeq:Tst,ngeqq:Cst,ngeqslant:Pst,nges:Rst,nGg:Lst,ngsim:Dst,nGt:Ist,ngt:Ost,ngtr:zst,nGtv:kst,nharr:Ust,nhArr:Nst,nhpar:Fst,ni:Bst,nis:Hst,nisd:Vst,niv:Gst,NJcy:qst,njcy:Wst,nlarr:$st,nlArr:Xst,nldr:jst,nlE:Yst,nle:Zst,nleftarrow:Kst,nLeftarrow:Jst,nleftrightarrow:Qst,nLeftrightarrow:trt,nleq:ert,nleqq:nrt,nleqslant:irt,nles:srt,nless:rrt,nLl:ort,nlsim:art,nLt:lrt,nlt:crt,nltri:urt,nltrie:hrt,nLtv:frt,nmid:drt,NoBreak:prt,NonBreakingSpace:mrt,nopf:grt,Nopf:vrt,Not:_rt,not:yrt,NotCongruent:xrt,NotCupCap:brt,NotDoubleVerticalBar:wrt,NotElement:Mrt,NotEqual:Srt,NotEqualTilde:Art,NotExists:Ert,NotGreater:Trt,NotGreaterEqual:Crt,NotGreaterFullEqual:Prt,NotGreaterGreater:Rrt,NotGreaterLess:Lrt,NotGreaterSlantEqual:Drt,NotGreaterTilde:Irt,NotHumpDownHump:Ort,NotHumpEqual:zrt,notin:krt,notindot:Urt,notinE:Nrt,notinva:Frt,notinvb:Brt,notinvc:Hrt,NotLeftTriangleBar:Vrt,NotLeftTriangle:Grt,NotLeftTriangleEqual:qrt,NotLess:Wrt,NotLessEqual:$rt,NotLessGreater:Xrt,NotLessLess:jrt,NotLessSlantEqual:Yrt,NotLessTilde:Zrt,NotNestedGreaterGreater:Krt,NotNestedLessLess:Jrt,notni:Qrt,notniva:tot,notnivb:eot,notnivc:not,NotPrecedes:iot,NotPrecedesEqual:sot,NotPrecedesSlantEqual:rot,NotReverseElement:oot,NotRightTriangleBar:aot,NotRightTriangle:lot,NotRightTriangleEqual:cot,NotSquareSubset:uot,NotSquareSubsetEqual:hot,NotSquareSuperset:fot,NotSquareSupersetEqual:dot,NotSubset:pot,NotSubsetEqual:mot,NotSucceeds:got,NotSucceedsEqual:vot,NotSucceedsSlantEqual:_ot,NotSucceedsTilde:yot,NotSuperset:xot,NotSupersetEqual:bot,NotTilde:wot,NotTildeEqual:Mot,NotTildeFullEqual:Sot,NotTildeTilde:Aot,NotVerticalBar:Eot,nparallel:Tot,npar:Cot,nparsl:Pot,npart:Rot,npolint:Lot,npr:Dot,nprcue:Iot,nprec:Oot,npreceq:zot,npre:kot,nrarrc:Uot,nrarr:Not,nrArr:Fot,nrarrw:Bot,nrightarrow:Hot,nRightarrow:Vot,nrtri:Got,nrtrie:qot,nsc:Wot,nsccue:$ot,nsce:Xot,Nscr:jot,nscr:Yot,nshortmid:Zot,nshortparallel:Kot,nsim:Jot,nsime:Qot,nsimeq:tat,nsmid:eat,nspar:nat,nsqsube:iat,nsqsupe:sat,nsub:rat,nsubE:oat,nsube:aat,nsubset:lat,nsubseteq:cat,nsubseteqq:uat,nsucc:hat,nsucceq:fat,nsup:dat,nsupE:pat,nsupe:mat,nsupset:gat,nsupseteq:vat,nsupseteqq:_at,ntgl:yat,Ntilde:xat,ntilde:bat,ntlg:wat,ntriangleleft:Mat,ntrianglelefteq:Sat,ntriangleright:Aat,ntrianglerighteq:Eat,Nu:Tat,nu:Cat,num:Pat,numero:Rat,numsp:Lat,nvap:Dat,nvdash:Iat,nvDash:Oat,nVdash:zat,nVDash:kat,nvge:Uat,nvgt:Nat,nvHarr:Fat,nvinfin:Bat,nvlArr:Hat,nvle:Vat,nvlt:Gat,nvltrie:qat,nvrArr:Wat,nvrtrie:$at,nvsim:Xat,nwarhk:jat,nwarr:Yat,nwArr:Zat,nwarrow:Kat,nwnear:Jat,Oacute:Qat,oacute:tlt,oast:elt,Ocirc:nlt,ocirc:ilt,ocir:slt,Ocy:rlt,ocy:olt,odash:alt,Odblac:llt,odblac:clt,odiv:ult,odot:hlt,odsold:flt,OElig:dlt,oelig:plt,ofcir:mlt,Ofr:glt,ofr:vlt,ogon:_lt,Ograve:ylt,ograve:xlt,ogt:blt,ohbar:wlt,ohm:Mlt,oint:Slt,olarr:Alt,olcir:Elt,olcross:Tlt,oline:Clt,olt:Plt,Omacr:Rlt,omacr:Llt,Omega:Dlt,omega:Ilt,Omicron:Olt,omicron:zlt,omid:klt,ominus:Ult,Oopf:Nlt,oopf:Flt,opar:Blt,OpenCurlyDoubleQuote:Hlt,OpenCurlyQuote:Vlt,operp:Glt,oplus:qlt,orarr:Wlt,Or:$lt,or:Xlt,ord:jlt,order:Ylt,orderof:Zlt,ordf:Klt,ordm:Jlt,origof:Qlt,oror:tct,orslope:ect,orv:nct,oS:ict,Oscr:sct,oscr:rct,Oslash:oct,oslash:act,osol:lct,Otilde:cct,otilde:uct,otimesas:hct,Otimes:fct,otimes:dct,Ouml:pct,ouml:mct,ovbar:gct,OverBar:vct,OverBrace:_ct,OverBracket:yct,OverParenthesis:xct,para:bct,parallel:wct,par:Mct,parsim:Sct,parsl:Act,part:Ect,PartialD:Tct,Pcy:Cct,pcy:Pct,percnt:Rct,period:Lct,permil:Dct,perp:Ict,pertenk:Oct,Pfr:zct,pfr:kct,Phi:Uct,phi:Nct,phiv:Fct,phmmat:Bct,phone:Hct,Pi:Vct,pi:Gct,pitchfork:qct,piv:Wct,planck:$ct,planckh:Xct,plankv:jct,plusacir:Yct,plusb:Zct,pluscir:Kct,plus:Jct,plusdo:Qct,plusdu:tut,pluse:eut,PlusMinus:nut,plusmn:iut,plussim:sut,plustwo:rut,pm:out,Poincareplane:aut,pointint:lut,popf:cut,Popf:uut,pound:hut,prap:fut,Pr:dut,pr:put,prcue:mut,precapprox:gut,prec:vut,preccurlyeq:_ut,Precedes:yut,PrecedesEqual:xut,PrecedesSlantEqual:but,PrecedesTilde:wut,preceq:Mut,precnapprox:Sut,precneqq:Aut,precnsim:Eut,pre:Tut,prE:Cut,precsim:Put,prime:Rut,Prime:Lut,primes:Dut,prnap:Iut,prnE:Out,prnsim:zut,prod:kut,Product:Uut,profalar:Nut,profline:Fut,profsurf:But,prop:Hut,Proportional:Vut,Proportion:Gut,propto:qut,prsim:Wut,prurel:$ut,Pscr:Xut,pscr:jut,Psi:Yut,psi:Zut,puncsp:Kut,Qfr:Jut,qfr:Qut,qint:tht,qopf:eht,Qopf:nht,qprime:iht,Qscr:sht,qscr:rht,quaternions:oht,quatint:aht,quest:lht,questeq:cht,quot:uht,QUOT:hht,rAarr:fht,race:dht,Racute:pht,racute:mht,radic:ght,raemptyv:vht,rang:_ht,Rang:yht,rangd:xht,range:bht,rangle:wht,raquo:Mht,rarrap:Sht,rarrb:Aht,rarrbfs:Eht,rarrc:Tht,rarr:Cht,Rarr:Pht,rArr:Rht,rarrfs:Lht,rarrhk:Dht,rarrlp:Iht,rarrpl:Oht,rarrsim:zht,Rarrtl:kht,rarrtl:Uht,rarrw:Nht,ratail:Fht,rAtail:Bht,ratio:Hht,rationals:Vht,rbarr:Ght,rBarr:qht,RBarr:Wht,rbbrk:$ht,rbrace:Xht,rbrack:jht,rbrke:Yht,rbrksld:Zht,rbrkslu:Kht,Rcaron:Jht,rcaron:Qht,Rcedil:tft,rcedil:eft,rceil:nft,rcub:ift,Rcy:sft,rcy:rft,rdca:oft,rdldhar:aft,rdquo:lft,rdquor:cft,rdsh:uft,real:hft,realine:fft,realpart:dft,reals:pft,Re:mft,rect:gft,reg:vft,REG:_ft,ReverseElement:yft,ReverseEquilibrium:xft,ReverseUpEquilibrium:bft,rfisht:wft,rfloor:Mft,rfr:Sft,Rfr:Aft,rHar:Eft,rhard:Tft,rharu:Cft,rharul:Pft,Rho:Rft,rho:Lft,rhov:Dft,RightAngleBracket:Ift,RightArrowBar:Oft,rightarrow:zft,RightArrow:kft,Rightarrow:Uft,RightArrowLeftArrow:Nft,rightarrowtail:Fft,RightCeiling:Bft,RightDoubleBracket:Hft,RightDownTeeVector:Vft,RightDownVectorBar:Gft,RightDownVector:qft,RightFloor:Wft,rightharpoondown:$ft,rightharpoonup:Xft,rightleftarrows:jft,rightleftharpoons:Yft,rightrightarrows:Zft,rightsquigarrow:Kft,RightTeeArrow:Jft,RightTee:Qft,RightTeeVector:tdt,rightthreetimes:edt,RightTriangleBar:ndt,RightTriangle:idt,RightTriangleEqual:sdt,RightUpDownVector:rdt,RightUpTeeVector:odt,RightUpVectorBar:adt,RightUpVector:ldt,RightVectorBar:cdt,RightVector:udt,ring:hdt,risingdotseq:fdt,rlarr:ddt,rlhar:pdt,rlm:mdt,rmoustache:gdt,rmoust:vdt,rnmid:_dt,roang:ydt,roarr:xdt,robrk:bdt,ropar:wdt,ropf:Mdt,Ropf:Sdt,roplus:Adt,rotimes:Edt,RoundImplies:Tdt,rpar:Cdt,rpargt:Pdt,rppolint:Rdt,rrarr:Ldt,Rrightarrow:Ddt,rsaquo:Idt,rscr:Odt,Rscr:zdt,rsh:kdt,Rsh:Udt,rsqb:Ndt,rsquo:Fdt,rsquor:Bdt,rthree:Hdt,rtimes:Vdt,rtri:Gdt,rtrie:qdt,rtrif:Wdt,rtriltri:$dt,RuleDelayed:Xdt,ruluhar:jdt,rx:Ydt,Sacute:Zdt,sacute:Kdt,sbquo:Jdt,scap:Qdt,Scaron:tpt,scaron:ept,Sc:npt,sc:ipt,sccue:spt,sce:rpt,scE:opt,Scedil:apt,scedil:lpt,Scirc:cpt,scirc:upt,scnap:hpt,scnE:fpt,scnsim:dpt,scpolint:ppt,scsim:mpt,Scy:gpt,scy:vpt,sdotb:_pt,sdot:ypt,sdote:xpt,searhk:bpt,searr:wpt,seArr:Mpt,searrow:Spt,sect:Apt,semi:Ept,seswar:Tpt,setminus:Cpt,setmn:Ppt,sext:Rpt,Sfr:Lpt,sfr:Dpt,sfrown:Ipt,sharp:Opt,SHCHcy:zpt,shchcy:kpt,SHcy:Upt,shcy:Npt,ShortDownArrow:Fpt,ShortLeftArrow:Bpt,shortmid:Hpt,shortparallel:Vpt,ShortRightArrow:Gpt,ShortUpArrow:qpt,shy:Wpt,Sigma:$pt,sigma:Xpt,sigmaf:jpt,sigmav:Ypt,sim:Zpt,simdot:Kpt,sime:Jpt,simeq:Qpt,simg:tmt,simgE:emt,siml:nmt,simlE:imt,simne:smt,simplus:rmt,simrarr:omt,slarr:amt,SmallCircle:lmt,smallsetminus:cmt,smashp:umt,smeparsl:hmt,smid:fmt,smile:dmt,smt:pmt,smte:mmt,smtes:gmt,SOFTcy:vmt,softcy:_mt,solbar:ymt,solb:xmt,sol:bmt,Sopf:wmt,sopf:Mmt,spades:Smt,spadesuit:Amt,spar:Emt,sqcap:Tmt,sqcaps:Cmt,sqcup:Pmt,sqcups:Rmt,Sqrt:Lmt,sqsub:Dmt,sqsube:Imt,sqsubset:Omt,sqsubseteq:zmt,sqsup:kmt,sqsupe:Umt,sqsupset:Nmt,sqsupseteq:Fmt,square:Bmt,Square:Hmt,SquareIntersection:Vmt,SquareSubset:Gmt,SquareSubsetEqual:qmt,SquareSuperset:Wmt,SquareSupersetEqual:$mt,SquareUnion:Xmt,squarf:jmt,squ:Ymt,squf:Zmt,srarr:Kmt,Sscr:Jmt,sscr:Qmt,ssetmn:tgt,ssmile:egt,sstarf:ngt,Star:igt,star:sgt,starf:rgt,straightepsilon:ogt,straightphi:agt,strns:lgt,sub:cgt,Sub:ugt,subdot:hgt,subE:fgt,sube:dgt,subedot:pgt,submult:mgt,subnE:ggt,subne:vgt,subplus:_gt,subrarr:ygt,subset:xgt,Subset:bgt,subseteq:wgt,subseteqq:Mgt,SubsetEqual:Sgt,subsetneq:Agt,subsetneqq:Egt,subsim:Tgt,subsub:Cgt,subsup:Pgt,succapprox:Rgt,succ:Lgt,succcurlyeq:Dgt,Succeeds:Igt,SucceedsEqual:Ogt,SucceedsSlantEqual:zgt,SucceedsTilde:kgt,succeq:Ugt,succnapprox:Ngt,succneqq:Fgt,succnsim:Bgt,succsim:Hgt,SuchThat:Vgt,sum:Ggt,Sum:qgt,sung:Wgt,sup1:$gt,sup2:Xgt,sup3:jgt,sup:Ygt,Sup:Zgt,supdot:Kgt,supdsub:Jgt,supE:Qgt,supe:tvt,supedot:evt,Superset:nvt,SupersetEqual:ivt,suphsol:svt,suphsub:rvt,suplarr:ovt,supmult:avt,supnE:lvt,supne:cvt,supplus:uvt,supset:hvt,Supset:fvt,supseteq:dvt,supseteqq:pvt,supsetneq:mvt,supsetneqq:gvt,supsim:vvt,supsub:_vt,supsup:yvt,swarhk:xvt,swarr:bvt,swArr:wvt,swarrow:Mvt,swnwar:Svt,szlig:Avt,Tab:Evt,target:Tvt,Tau:Cvt,tau:Pvt,tbrk:Rvt,Tcaron:Lvt,tcaron:Dvt,Tcedil:Ivt,tcedil:Ovt,Tcy:zvt,tcy:kvt,tdot:Uvt,telrec:Nvt,Tfr:Fvt,tfr:Bvt,there4:Hvt,therefore:Vvt,Therefore:Gvt,Theta:qvt,theta:Wvt,thetasym:$vt,thetav:Xvt,thickapprox:jvt,thicksim:Yvt,ThickSpace:Zvt,ThinSpace:Kvt,thinsp:Jvt,thkap:Qvt,thksim:t_t,THORN:e_t,thorn:n_t,tilde:i_t,Tilde:s_t,TildeEqual:r_t,TildeFullEqual:o_t,TildeTilde:a_t,timesbar:l_t,timesb:c_t,times:u_t,timesd:h_t,tint:f_t,toea:d_t,topbot:p_t,topcir:m_t,top:g_t,Topf:v_t,topf:__t,topfork:y_t,tosa:x_t,tprime:b_t,trade:w_t,TRADE:M_t,triangle:S_t,triangledown:A_t,triangleleft:E_t,trianglelefteq:T_t,triangleq:C_t,triangleright:P_t,trianglerighteq:R_t,tridot:L_t,trie:D_t,triminus:I_t,TripleDot:O_t,triplus:z_t,trisb:k_t,tritime:U_t,trpezium:N_t,Tscr:F_t,tscr:B_t,TScy:H_t,tscy:V_t,TSHcy:G_t,tshcy:q_t,Tstrok:W_t,tstrok:$_t,twixt:X_t,twoheadleftarrow:j_t,twoheadrightarrow:Y_t,Uacute:Z_t,uacute:K_t,uarr:J_t,Uarr:Q_t,uArr:tyt,Uarrocir:eyt,Ubrcy:nyt,ubrcy:iyt,Ubreve:syt,ubreve:ryt,Ucirc:oyt,ucirc:ayt,Ucy:lyt,ucy:cyt,udarr:uyt,Udblac:hyt,udblac:fyt,udhar:dyt,ufisht:pyt,Ufr:myt,ufr:gyt,Ugrave:vyt,ugrave:_yt,uHar:yyt,uharl:xyt,uharr:byt,uhblk:wyt,ulcorn:Myt,ulcorner:Syt,ulcrop:Ayt,ultri:Eyt,Umacr:Tyt,umacr:Cyt,uml:Pyt,UnderBar:Ryt,UnderBrace:Lyt,UnderBracket:Dyt,UnderParenthesis:Iyt,Union:Oyt,UnionPlus:zyt,Uogon:kyt,uogon:Uyt,Uopf:Nyt,uopf:Fyt,UpArrowBar:Byt,uparrow:Hyt,UpArrow:Vyt,Uparrow:Gyt,UpArrowDownArrow:qyt,updownarrow:Wyt,UpDownArrow:$yt,Updownarrow:Xyt,UpEquilibrium:jyt,upharpoonleft:Yyt,upharpoonright:Zyt,uplus:Kyt,UpperLeftArrow:Jyt,UpperRightArrow:Qyt,upsi:t0t,Upsi:e0t,upsih:n0t,Upsilon:i0t,upsilon:s0t,UpTeeArrow:r0t,UpTee:o0t,upuparrows:a0t,urcorn:l0t,urcorner:c0t,urcrop:u0t,Uring:h0t,uring:f0t,urtri:d0t,Uscr:p0t,uscr:m0t,utdot:g0t,Utilde:v0t,utilde:_0t,utri:y0t,utrif:x0t,uuarr:b0t,Uuml:w0t,uuml:M0t,uwangle:S0t,vangrt:A0t,varepsilon:E0t,varkappa:T0t,varnothing:C0t,varphi:P0t,varpi:R0t,varpropto:L0t,varr:D0t,vArr:I0t,varrho:O0t,varsigma:z0t,varsubsetneq:k0t,varsubsetneqq:U0t,varsupsetneq:N0t,varsupsetneqq:F0t,vartheta:B0t,vartriangleleft:H0t,vartriangleright:V0t,vBar:G0t,Vbar:q0t,vBarv:W0t,Vcy:$0t,vcy:X0t,vdash:j0t,vDash:Y0t,Vdash:Z0t,VDash:K0t,Vdashl:J0t,veebar:Q0t,vee:txt,Vee:ext,veeeq:nxt,vellip:ixt,verbar:sxt,Verbar:rxt,vert:oxt,Vert:axt,VerticalBar:lxt,VerticalLine:cxt,VerticalSeparator:uxt,VerticalTilde:hxt,VeryThinSpace:fxt,Vfr:dxt,vfr:pxt,vltri:mxt,vnsub:gxt,vnsup:vxt,Vopf:_xt,vopf:yxt,vprop:xxt,vrtri:bxt,Vscr:wxt,vscr:Mxt,vsubnE:Sxt,vsubne:Axt,vsupnE:Ext,vsupne:Txt,Vvdash:Cxt,vzigzag:Pxt,Wcirc:Rxt,wcirc:Lxt,wedbar:Dxt,wedge:Ixt,Wedge:Oxt,wedgeq:zxt,weierp:kxt,Wfr:Uxt,wfr:Nxt,Wopf:Fxt,wopf:Bxt,wp:Hxt,wr:Vxt,wreath:Gxt,Wscr:qxt,wscr:Wxt,xcap:$xt,xcirc:Xxt,xcup:jxt,xdtri:Yxt,Xfr:Zxt,xfr:Kxt,xharr:Jxt,xhArr:Qxt,Xi:tbt,xi:ebt,xlarr:nbt,xlArr:ibt,xmap:sbt,xnis:rbt,xodot:obt,Xopf:abt,xopf:lbt,xoplus:cbt,xotime:ubt,xrarr:hbt,xrArr:fbt,Xscr:dbt,xscr:pbt,xsqcup:mbt,xuplus:gbt,xutri:vbt,xvee:_bt,xwedge:ybt,Yacute:xbt,yacute:bbt,YAcy:wbt,yacy:Mbt,Ycirc:Sbt,ycirc:Abt,Ycy:Ebt,ycy:Tbt,yen:Cbt,Yfr:Pbt,yfr:Rbt,YIcy:Lbt,yicy:Dbt,Yopf:Ibt,yopf:Obt,Yscr:zbt,yscr:kbt,YUcy:Ubt,yucy:Nbt,yuml:Fbt,Yuml:Bbt,Zacute:Hbt,zacute:Vbt,Zcaron:Gbt,zcaron:qbt,Zcy:Wbt,zcy:$bt,Zdot:Xbt,zdot:jbt,zeetrf:Ybt,ZeroWidthSpace:Zbt,Zeta:Kbt,zeta:Jbt,zfr:Qbt,Zfr:twt,ZHcy:ewt,zhcy:nwt,zigrarr:iwt,zopf:swt,Zopf:rwt,Zscr:owt,zscr:awt,zwj:lwt,zwnj:cwt},uwt="Á",hwt="á",fwt="Â",dwt="â",pwt="´",mwt="Æ",gwt="æ",vwt="À",_wt="à",ywt="&",xwt="&",bwt="Å",wwt="å",Mwt="Ã",Swt="ã",Awt="Ä",Ewt="ä",Twt="¦",Cwt="Ç",Pwt="ç",Rwt="¸",Lwt="¢",Dwt="©",Iwt="©",Owt="¤",zwt="°",kwt="÷",Uwt="É",Nwt="é",Fwt="Ê",Bwt="ê",Hwt="È",Vwt="è",Gwt="Ð",qwt="ð",Wwt="Ë",$wt="ë",Xwt="½",jwt="¼",Ywt="¾",Zwt=">",Kwt=">",Jwt="Í",Qwt="í",t1t="Î",e1t="î",n1t="¡",i1t="Ì",s1t="ì",r1t="¿",o1t="Ï",a1t="ï",l1t="«",c1t="<",u1t="<",h1t="¯",f1t="µ",d1t="·",p1t=" ",m1t="¬",g1t="Ñ",v1t="ñ",_1t="Ó",y1t="ó",x1t="Ô",b1t="ô",w1t="Ò",M1t="ò",S1t="ª",A1t="º",E1t="Ø",T1t="ø",C1t="Õ",P1t="õ",R1t="Ö",L1t="ö",D1t="¶",I1t="±",O1t="£",z1t='"',k1t='"',U1t="»",N1t="®",F1t="®",B1t="§",H1t="­",V1t="¹",G1t="²",q1t="³",W1t="ß",$1t="Þ",X1t="þ",j1t="×",Y1t="Ú",Z1t="ú",K1t="Û",J1t="û",Q1t="Ù",tMt="ù",eMt="¨",nMt="Ü",iMt="ü",sMt="Ý",rMt="ý",oMt="¥",aMt="ÿ",lMt={Aacute:uwt,aacute:hwt,Acirc:fwt,acirc:dwt,acute:pwt,AElig:mwt,aelig:gwt,Agrave:vwt,agrave:_wt,amp:ywt,AMP:xwt,Aring:bwt,aring:wwt,Atilde:Mwt,atilde:Swt,Auml:Awt,auml:Ewt,brvbar:Twt,Ccedil:Cwt,ccedil:Pwt,cedil:Rwt,cent:Lwt,copy:Dwt,COPY:Iwt,curren:Owt,deg:zwt,divide:kwt,Eacute:Uwt,eacute:Nwt,Ecirc:Fwt,ecirc:Bwt,Egrave:Hwt,egrave:Vwt,ETH:Gwt,eth:qwt,Euml:Wwt,euml:$wt,frac12:Xwt,frac14:jwt,frac34:Ywt,gt:Zwt,GT:Kwt,Iacute:Jwt,iacute:Qwt,Icirc:t1t,icirc:e1t,iexcl:n1t,Igrave:i1t,igrave:s1t,iquest:r1t,Iuml:o1t,iuml:a1t,laquo:l1t,lt:c1t,LT:u1t,macr:h1t,micro:f1t,middot:d1t,nbsp:p1t,not:m1t,Ntilde:g1t,ntilde:v1t,Oacute:_1t,oacute:y1t,Ocirc:x1t,ocirc:b1t,Ograve:w1t,ograve:M1t,ordf:S1t,ordm:A1t,Oslash:E1t,oslash:T1t,Otilde:C1t,otilde:P1t,Ouml:R1t,ouml:L1t,para:D1t,plusmn:I1t,pound:O1t,quot:z1t,QUOT:k1t,raquo:U1t,reg:N1t,REG:F1t,sect:B1t,shy:H1t,sup1:V1t,sup2:G1t,sup3:q1t,szlig:W1t,THORN:$1t,thorn:X1t,times:j1t,Uacute:Y1t,uacute:Z1t,Ucirc:K1t,ucirc:J1t,Ugrave:Q1t,ugrave:tMt,uml:eMt,Uuml:nMt,uuml:iMt,Yacute:sMt,yacute:rMt,yen:oMt,yuml:aMt},cMt="&",uMt="'",hMt=">",fMt="<",dMt='"',QA={amp:cMt,apos:uMt,gt:hMt,lt:fMt,quot:dMt};var Y_={};const pMt={0:65533,128:8364,130:8218,131:402,132:8222,133:8230,134:8224,135:8225,136:710,137:8240,138:352,139:8249,140:338,142:381,145:8216,146:8217,147:8220,148:8221,149:8226,150:8211,151:8212,152:732,153:8482,154:353,155:8250,156:339,158:382,159:376};var mMt=te&&te.__importDefault||function(s){return s&&s.__esModule?s:{default:s}};Object.defineProperty(Y_,"__esModule",{value:!0});var Zw=mMt(pMt),gMt=String.fromCodePoint||function(s){var t="";return s>65535&&(s-=65536,t+=String.fromCharCode(s>>>10&1023|55296),s=56320|s&1023),t+=String.fromCharCode(s),t};function vMt(s){return s>=55296&&s<=57343||s>1114111?"�":(s in Zw.default&&(s=Zw.default[s]),gMt(s))}Y_.default=vMt;var Bd=te&&te.__importDefault||function(s){return s&&s.__esModule?s:{default:s}};Object.defineProperty(wr,"__esModule",{value:!0});wr.decodeHTML=wr.decodeHTMLStrict=wr.decodeXML=void 0;var pv=Bd(JA),_Mt=Bd(lMt),yMt=Bd(QA),Kw=Bd(Y_),xMt=/&(?:[a-zA-Z0-9]+|#[xX][\da-fA-F]+|#\d+);/g;wr.decodeXML=tE(yMt.default);wr.decodeHTMLStrict=tE(pv.default);function tE(s){var t=eE(s);return function(e){return String(e).replace(xMt,t)}}var Jw=function(s,t){return s<t?1:-1};wr.decodeHTML=function(){for(var s=Object.keys(_Mt.default).sort(Jw),t=Object.keys(pv.default).sort(Jw),e=0,n=0;e<t.length;e++)s[n]===t[e]?(t[e]+=";?",n++):t[e]+=";";var i=new RegExp("&(?:"+t.join("|")+"|#[xX][\\da-fA-F]+;?|#\\d+;?)","g"),r=eE(pv.default);function o(a){return a.substr(-1)!==";"&&(a+=";"),r(a)}return function(a){return String(a).replace(i,o)}}();function eE(s){return function(e){if(e.charAt(1)==="#"){var n=e.charAt(2);return n==="X"||n==="x"?Kw.default(parseInt(e.substr(3),16)):Kw.default(parseInt(e.substr(2),10))}return s[e.slice(1,-1)]||e}}var Fi={},nE=te&&te.__importDefault||function(s){return s&&s.__esModule?s:{default:s}};Object.defineProperty(Fi,"__esModule",{value:!0});Fi.escapeUTF8=Fi.escape=Fi.encodeNonAsciiHTML=Fi.encodeHTML=Fi.encodeXML=void 0;var bMt=nE(QA),iE=rE(bMt.default),sE=oE(iE);Fi.encodeXML=cE(iE);var wMt=nE(JA),Z_=rE(wMt.default),MMt=oE(Z_);Fi.encodeHTML=AMt(Z_,MMt);Fi.encodeNonAsciiHTML=cE(Z_);function rE(s){return Object.keys(s).sort().reduce(function(t,e){return t[s[e]]="&"+e+";",t},{})}function oE(s){for(var t=[],e=[],n=0,i=Object.keys(s);n<i.length;n++){var r=i[n];r.length===1?t.push("\\"+r):e.push(r)}t.sort();for(var o=0;o<t.length-1;o++){for(var a=o;a<t.length-1&&t[a].charCodeAt(1)+1===t[a+1].charCodeAt(1);)a+=1;var l=1+a-o;l<3||t.splice(o,l,t[o]+"-"+t[a])}return e.unshift("["+t.join("")+"]"),new RegExp(e.join("|"),"g")}var aE=/(?:[\x80-\uD7FF\uE000-\uFFFF]|[\uD800-\uDBFF][\uDC00-\uDFFF]|[\uD800-\uDBFF](?![\uDC00-\uDFFF])|(?:[^\uD800-\uDBFF]|^)[\uDC00-\uDFFF])/g,SMt=String.prototype.codePointAt!=null?function(s){return s.codePointAt(0)}:function(s){return(s.charCodeAt(0)-55296)*1024+s.charCodeAt(1)-56320+65536};function Hd(s){return"&#x"+(s.length>1?SMt(s):s.charCodeAt(0)).toString(16).toUpperCase()+";"}function AMt(s,t){return function(e){return e.replace(t,function(n){return s[n]}).replace(aE,Hd)}}var lE=new RegExp(sE.source+"|"+aE.source,"g");function EMt(s){return s.replace(lE,Hd)}Fi.escape=EMt;function TMt(s){return s.replace(sE,Hd)}Fi.escapeUTF8=TMt;function cE(s){return function(t){return t.replace(lE,function(e){return s[e]||Hd(e)})}}(function(s){Object.defineProperty(s,"__esModule",{value:!0}),s.decodeXMLStrict=s.decodeHTML5Strict=s.decodeHTML4Strict=s.decodeHTML5=s.decodeHTML4=s.decodeHTMLStrict=s.decodeHTML=s.decodeXML=s.encodeHTML5=s.encodeHTML4=s.escapeUTF8=s.escape=s.encodeNonAsciiHTML=s.encodeHTML=s.encodeXML=s.encode=s.decodeStrict=s.decode=void 0;var t=wr,e=Fi;function n(l,c){return(!c||c<=0?t.decodeXML:t.decodeHTML)(l)}s.decode=n;function i(l,c){return(!c||c<=0?t.decodeXML:t.decodeHTMLStrict)(l)}s.decodeStrict=i;function r(l,c){return(!c||c<=0?e.encodeXML:e.encodeHTML)(l)}s.encode=r;var o=Fi;Object.defineProperty(s,"encodeXML",{enumerable:!0,get:function(){return o.encodeXML}}),Object.defineProperty(s,"encodeHTML",{enumerable:!0,get:function(){return o.encodeHTML}}),Object.defineProperty(s,"encodeNonAsciiHTML",{enumerable:!0,get:function(){return o.encodeNonAsciiHTML}}),Object.defineProperty(s,"escape",{enumerable:!0,get:function(){return o.escape}}),Object.defineProperty(s,"escapeUTF8",{enumerable:!0,get:function(){return o.escapeUTF8}}),Object.defineProperty(s,"encodeHTML4",{enumerable:!0,get:function(){return o.encodeHTML}}),Object.defineProperty(s,"encodeHTML5",{enumerable:!0,get:function(){return o.encodeHTML}});var a=wr;Object.defineProperty(s,"decodeXML",{enumerable:!0,get:function(){return a.decodeXML}}),Object.defineProperty(s,"decodeHTML",{enumerable:!0,get:function(){return a.decodeHTML}}),Object.defineProperty(s,"decodeHTMLStrict",{enumerable:!0,get:function(){return a.decodeHTMLStrict}}),Object.defineProperty(s,"decodeHTML4",{enumerable:!0,get:function(){return a.decodeHTML}}),Object.defineProperty(s,"decodeHTML5",{enumerable:!0,get:function(){return a.decodeHTML}}),Object.defineProperty(s,"decodeHTML4Strict",{enumerable:!0,get:function(){return a.decodeHTMLStrict}}),Object.defineProperty(s,"decodeHTML5Strict",{enumerable:!0,get:function(){return a.decodeHTMLStrict}}),Object.defineProperty(s,"decodeXMLStrict",{enumerable:!0,get:function(){return a.decodeXML}})})(KA);var Ml={};Object.defineProperty(Ml,"__esModule",{value:!0});Ml.attributeNames=Ml.elementNames=void 0;Ml.elementNames=new Map([["altglyph","altGlyph"],["altglyphdef","altGlyphDef"],["altglyphitem","altGlyphItem"],["animatecolor","animateColor"],["animatemotion","animateMotion"],["animatetransform","animateTransform"],["clippath","clipPath"],["feblend","feBlend"],["fecolormatrix","feColorMatrix"],["fecomponenttransfer","feComponentTransfer"],["fecomposite","feComposite"],["feconvolvematrix","feConvolveMatrix"],["fediffuselighting","feDiffuseLighting"],["fedisplacementmap","feDisplacementMap"],["fedistantlight","feDistantLight"],["fedropshadow","feDropShadow"],["feflood","feFlood"],["fefunca","feFuncA"],["fefuncb","feFuncB"],["fefuncg","feFuncG"],["fefuncr","feFuncR"],["fegaussianblur","feGaussianBlur"],["feimage","feImage"],["femerge","feMerge"],["femergenode","feMergeNode"],["femorphology","feMorphology"],["feoffset","feOffset"],["fepointlight","fePointLight"],["fespecularlighting","feSpecularLighting"],["fespotlight","feSpotLight"],["fetile","feTile"],["feturbulence","feTurbulence"],["foreignobject","foreignObject"],["glyphref","glyphRef"],["lineargradient","linearGradient"],["radialgradient","radialGradient"],["textpath","textPath"]]);Ml.attributeNames=new Map([["definitionurl","definitionURL"],["attributename","attributeName"],["attributetype","attributeType"],["basefrequency","baseFrequency"],["baseprofile","baseProfile"],["calcmode","calcMode"],["clippathunits","clipPathUnits"],["diffuseconstant","diffuseConstant"],["edgemode","edgeMode"],["filterunits","filterUnits"],["glyphref","glyphRef"],["gradienttransform","gradientTransform"],["gradientunits","gradientUnits"],["kernelmatrix","kernelMatrix"],["kernelunitlength","kernelUnitLength"],["keypoints","keyPoints"],["keysplines","keySplines"],["keytimes","keyTimes"],["lengthadjust","lengthAdjust"],["limitingconeangle","limitingConeAngle"],["markerheight","markerHeight"],["markerunits","markerUnits"],["markerwidth","markerWidth"],["maskcontentunits","maskContentUnits"],["maskunits","maskUnits"],["numoctaves","numOctaves"],["pathlength","pathLength"],["patterncontentunits","patternContentUnits"],["patterntransform","patternTransform"],["patternunits","patternUnits"],["pointsatx","pointsAtX"],["pointsaty","pointsAtY"],["pointsatz","pointsAtZ"],["preservealpha","preserveAlpha"],["preserveaspectratio","preserveAspectRatio"],["primitiveunits","primitiveUnits"],["refx","refX"],["refy","refY"],["repeatcount","repeatCount"],["repeatdur","repeatDur"],["requiredextensions","requiredExtensions"],["requiredfeatures","requiredFeatures"],["specularconstant","specularConstant"],["specularexponent","specularExponent"],["spreadmethod","spreadMethod"],["startoffset","startOffset"],["stddeviation","stdDeviation"],["stitchtiles","stitchTiles"],["surfacescale","surfaceScale"],["systemlanguage","systemLanguage"],["tablevalues","tableValues"],["targetx","targetX"],["targety","targetY"],["textlength","textLength"],["viewbox","viewBox"],["viewtarget","viewTarget"],["xchannelselector","xChannelSelector"],["ychannelselector","yChannelSelector"],["zoomandpan","zoomAndPan"]]);var cl=te&&te.__assign||function(){return cl=Object.assign||function(s){for(var t,e=1,n=arguments.length;e<n;e++){t=arguments[e];for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&(s[i]=t[i])}return s},cl.apply(this,arguments)},CMt=te&&te.__createBinding||(Object.create?function(s,t,e,n){n===void 0&&(n=e),Object.defineProperty(s,n,{enumerable:!0,get:function(){return t[e]}})}:function(s,t,e,n){n===void 0&&(n=e),s[n]=t[e]}),PMt=te&&te.__setModuleDefault||(Object.create?function(s,t){Object.defineProperty(s,"default",{enumerable:!0,value:t})}:function(s,t){s.default=t}),RMt=te&&te.__importStar||function(s){if(s&&s.__esModule)return s;var t={};if(s!=null)for(var e in s)e!=="default"&&Object.prototype.hasOwnProperty.call(s,e)&&CMt(t,s,e);return PMt(t,s),t};Object.defineProperty(j_,"__esModule",{value:!0});var mr=RMt(Eu),uE=KA,hE=Ml,LMt=new Set(["style","script","xmp","iframe","noembed","noframes","plaintext","noscript"]);function DMt(s,t){if(s)return Object.keys(s).map(function(e){var n,i,r=(n=s[e])!==null&&n!==void 0?n:"";return t.xmlMode==="foreign"&&(e=(i=hE.attributeNames.get(e))!==null&&i!==void 0?i:e),!t.emptyAttrs&&!t.xmlMode&&r===""?e:e+'="'+(t.decodeEntities!==!1?uE.encodeXML(r):r.replace(/"/g,"&quot;"))+'"'}).join(" ")}var Qw=new Set(["area","base","basefont","br","col","command","embed","frame","hr","img","input","isindex","keygen","link","meta","param","source","track","wbr"]);function K_(s,t){t===void 0&&(t={});for(var e=("length"in s)?s:[s],n="",i=0;i<e.length;i++)n+=IMt(e[i],t);return n}j_.default=K_;function IMt(s,t){switch(s.type){case mr.Root:return K_(s.children,t);case mr.Directive:case mr.Doctype:return UMt(s);case mr.Comment:return BMt(s);case mr.CDATA:return FMt(s);case mr.Script:case mr.Style:case mr.Tag:return kMt(s,t);case mr.Text:return NMt(s,t)}}var OMt=new Set(["mi","mo","mn","ms","mtext","annotation-xml","foreignObject","desc","title"]),zMt=new Set(["svg","math"]);function kMt(s,t){var e;t.xmlMode==="foreign"&&(s.name=(e=hE.elementNames.get(s.name))!==null&&e!==void 0?e:s.name,s.parent&&OMt.has(s.parent.name)&&(t=cl(cl({},t),{xmlMode:!1}))),!t.xmlMode&&zMt.has(s.name)&&(t=cl(cl({},t),{xmlMode:"foreign"}));var n="<"+s.name,i=DMt(s.attribs,t);return i&&(n+=" "+i),s.children.length===0&&(t.xmlMode?t.selfClosingTags!==!1:t.selfClosingTags&&Qw.has(s.name))?(t.xmlMode||(n+=" "),n+="/>"):(n+=">",s.children.length>0&&(n+=K_(s.children,t)),(t.xmlMode||!Qw.has(s.name))&&(n+="</"+s.name+">")),n}function UMt(s){return"<"+s.data+">"}function NMt(s,t){var e=s.data||"";return t.decodeEntities!==!1&&!(!t.xmlMode&&s.parent&&LMt.has(s.parent.name))&&(e=uE.encodeXML(e)),e}function FMt(s){return"<![CDATA["+s.children[0].data+"]]>"}function BMt(s){return"<!--"+s.data+"-->"}var HMt=te&&te.__importDefault||function(s){return s&&s.__esModule?s:{default:s}};Object.defineProperty(Ni,"__esModule",{value:!0});Ni.innerText=Ni.textContent=Ni.getText=Ni.getInnerHTML=Ni.getOuterHTML=void 0;var Vs=da,VMt=HMt(j_),GMt=Eu;function fE(s,t){return(0,VMt.default)(s,t)}Ni.getOuterHTML=fE;function qMt(s,t){return(0,Vs.hasChildren)(s)?s.children.map(function(e){return fE(e,t)}).join(""):""}Ni.getInnerHTML=qMt;function Rf(s){return Array.isArray(s)?s.map(Rf).join(""):(0,Vs.isTag)(s)?s.name==="br"?`
`:Rf(s.children):(0,Vs.isCDATA)(s)?Rf(s.children):(0,Vs.isText)(s)?s.data:""}Ni.getText=Rf;function mv(s){return Array.isArray(s)?s.map(mv).join(""):(0,Vs.hasChildren)(s)&&!(0,Vs.isComment)(s)?mv(s.children):(0,Vs.isText)(s)?s.data:""}Ni.textContent=mv;function gv(s){return Array.isArray(s)?s.map(gv).join(""):(0,Vs.hasChildren)(s)&&(s.type===GMt.ElementType.Tag||(0,Vs.isCDATA)(s))?gv(s.children):(0,Vs.isText)(s)?s.data:""}Ni.innerText=gv;var Nn={};Object.defineProperty(Nn,"__esModule",{value:!0});Nn.prevElementSibling=Nn.nextElementSibling=Nn.getName=Nn.hasAttrib=Nn.getAttributeValue=Nn.getSiblings=Nn.getParent=Nn.getChildren=void 0;var dE=da,WMt=[];function pE(s){var t;return(t=s.children)!==null&&t!==void 0?t:WMt}Nn.getChildren=pE;function mE(s){return s.parent||null}Nn.getParent=mE;function $Mt(s){var t,e,n=mE(s);if(n!=null)return pE(n);for(var i=[s],r=s.prev,o=s.next;r!=null;)i.unshift(r),t=r,r=t.prev;for(;o!=null;)i.push(o),e=o,o=e.next;return i}Nn.getSiblings=$Mt;function XMt(s,t){var e;return(e=s.attribs)===null||e===void 0?void 0:e[t]}Nn.getAttributeValue=XMt;function jMt(s,t){return s.attribs!=null&&Object.prototype.hasOwnProperty.call(s.attribs,t)&&s.attribs[t]!=null}Nn.hasAttrib=jMt;function YMt(s){return s.name}Nn.getName=YMt;function ZMt(s){for(var t,e=s.next;e!==null&&!(0,dE.isTag)(e);)t=e,e=t.next;return e}Nn.nextElementSibling=ZMt;function KMt(s){for(var t,e=s.prev;e!==null&&!(0,dE.isTag)(e);)t=e,e=t.prev;return e}Nn.prevElementSibling=KMt;var vi={};Object.defineProperty(vi,"__esModule",{value:!0});vi.prepend=vi.prependChild=vi.append=vi.appendChild=vi.replaceElement=vi.removeElement=void 0;function Tu(s){if(s.prev&&(s.prev.next=s.next),s.next&&(s.next.prev=s.prev),s.parent){var t=s.parent.children;t.splice(t.lastIndexOf(s),1)}}vi.removeElement=Tu;function JMt(s,t){var e=t.prev=s.prev;e&&(e.next=t);var n=t.next=s.next;n&&(n.prev=t);var i=t.parent=s.parent;if(i){var r=i.children;r[r.lastIndexOf(s)]=t}}vi.replaceElement=JMt;function QMt(s,t){if(Tu(t),t.next=null,t.parent=s,s.children.push(t)>1){var e=s.children[s.children.length-2];e.next=t,t.prev=e}else t.prev=null}vi.appendChild=QMt;function tSt(s,t){Tu(t);var e=s.parent,n=s.next;if(t.next=n,t.prev=s,s.next=t,t.parent=e,n){if(n.prev=t,e){var i=e.children;i.splice(i.lastIndexOf(n),0,t)}}else e&&e.children.push(t)}vi.append=tSt;function eSt(s,t){if(Tu(t),t.parent=s,t.prev=null,s.children.unshift(t)!==1){var e=s.children[1];e.prev=t,t.next=e}else t.next=null}vi.prependChild=eSt;function nSt(s,t){Tu(t);var e=s.parent;if(e){var n=e.children;n.splice(n.indexOf(s),0,t)}s.prev&&(s.prev.next=t),t.parent=e,t.prev=s.prev,t.next=s,s.prev=t}vi.prepend=nSt;var ri={};Object.defineProperty(ri,"__esModule",{value:!0});ri.findAll=ri.existsOne=ri.findOne=ri.findOneChild=ri.find=ri.filter=void 0;var ou=da;function iSt(s,t,e,n){return e===void 0&&(e=!0),n===void 0&&(n=1/0),Array.isArray(t)||(t=[t]),J_(s,t,e,n)}ri.filter=iSt;function J_(s,t,e,n){for(var i=[],r=0,o=t;r<o.length;r++){var a=o[r];if(s(a)&&(i.push(a),--n<=0))break;if(e&&(0,ou.hasChildren)(a)&&a.children.length>0){var l=J_(s,a.children,e,n);if(i.push.apply(i,l),n-=l.length,n<=0)break}}return i}ri.find=J_;function sSt(s,t){return t.find(s)}ri.findOneChild=sSt;function gE(s,t,e){e===void 0&&(e=!0);for(var n=null,i=0;i<t.length&&!n;i++){var r=t[i];if((0,ou.isTag)(r))s(r)?n=r:e&&r.children.length>0&&(n=gE(s,r.children));else continue}return n}ri.findOne=gE;function vE(s,t){return t.some(function(e){return(0,ou.isTag)(e)&&(s(e)||e.children.length>0&&vE(s,e.children))})}ri.existsOne=vE;function rSt(s,t){for(var e,n=[],i=t.filter(ou.isTag),r;r=i.shift();){var o=(e=r.children)===null||e===void 0?void 0:e.filter(ou.isTag);o&&o.length>0&&i.unshift.apply(i,o),s(r)&&n.push(r)}return n}ri.findAll=rSt;var Bi={};Object.defineProperty(Bi,"__esModule",{value:!0});Bi.getElementsByTagType=Bi.getElementsByTagName=Bi.getElementById=Bi.getElements=Bi.testElement=void 0;var Fo=da,Vd=ri,qf={tag_name:function(s){return typeof s=="function"?function(t){return(0,Fo.isTag)(t)&&s(t.name)}:s==="*"?Fo.isTag:function(t){return(0,Fo.isTag)(t)&&t.name===s}},tag_type:function(s){return typeof s=="function"?function(t){return s(t.type)}:function(t){return t.type===s}},tag_contains:function(s){return typeof s=="function"?function(t){return(0,Fo.isText)(t)&&s(t.data)}:function(t){return(0,Fo.isText)(t)&&t.data===s}}};function _E(s,t){return typeof t=="function"?function(e){return(0,Fo.isTag)(e)&&t(e.attribs[s])}:function(e){return(0,Fo.isTag)(e)&&e.attribs[s]===t}}function oSt(s,t){return function(e){return s(e)||t(e)}}function yE(s){var t=Object.keys(s).map(function(e){var n=s[e];return Object.prototype.hasOwnProperty.call(qf,e)?qf[e](n):_E(e,n)});return t.length===0?null:t.reduce(oSt)}function aSt(s,t){var e=yE(s);return e?e(t):!0}Bi.testElement=aSt;function lSt(s,t,e,n){n===void 0&&(n=1/0);var i=yE(s);return i?(0,Vd.filter)(i,t,e,n):[]}Bi.getElements=lSt;function cSt(s,t,e){return e===void 0&&(e=!0),Array.isArray(t)||(t=[t]),(0,Vd.findOne)(_E("id",s),t,e)}Bi.getElementById=cSt;function uSt(s,t,e,n){return e===void 0&&(e=!0),n===void 0&&(n=1/0),(0,Vd.filter)(qf.tag_name(s),t,e,n)}Bi.getElementsByTagName=uSt;function hSt(s,t,e,n){return e===void 0&&(e=!0),n===void 0&&(n=1/0),(0,Vd.filter)(qf.tag_type(s),t,e,n)}Bi.getElementsByTagType=hSt;var Qr={};Object.defineProperty(Qr,"__esModule",{value:!0});Qr.uniqueSort=Qr.compareDocumentPosition=Qr.removeSubsets=void 0;var t1=da;function fSt(s){for(var t=s.length;--t>=0;){var e=s[t];if(t>0&&s.lastIndexOf(e,t-1)>=0){s.splice(t,1);continue}for(var n=e.parent;n;n=n.parent)if(s.includes(n)){s.splice(t,1);break}}return s}Qr.removeSubsets=fSt;function xE(s,t){var e=[],n=[];if(s===t)return 0;for(var i=(0,t1.hasChildren)(s)?s:s.parent;i;)e.unshift(i),i=i.parent;for(i=(0,t1.hasChildren)(t)?t:t.parent;i;)n.unshift(i),i=i.parent;for(var r=Math.min(e.length,n.length),o=0;o<r&&e[o]===n[o];)o++;if(o===0)return 1;var a=e[o-1],l=a.children,c=e[o],h=n[o];return l.indexOf(c)>l.indexOf(h)?a===t?20:4:a===s?10:2}Qr.compareDocumentPosition=xE;function dSt(s){return s=s.filter(function(t,e,n){return!n.includes(t,e+1)}),s.sort(function(t,e){var n=xE(t,e);return n&2?-1:n&4?1:0}),s}Qr.uniqueSort=dSt;var Gd={};Object.defineProperty(Gd,"__esModule",{value:!0});Gd.getFeed=void 0;var pSt=Ni,Cu=Bi;function mSt(s){var t=Wf(xSt,s);return t?t.name==="feed"?gSt(t):vSt(t):null}Gd.getFeed=mSt;function gSt(s){var t,e=s.children,n={type:"atom",items:(0,Cu.getElementsByTagName)("entry",e).map(function(o){var a,l=o.children,c={media:bE(l)};mi(c,"id","id",l),mi(c,"title","title",l);var h=(a=Wf("link",l))===null||a===void 0?void 0:a.attribs.href;h&&(c.link=h);var f=Wo("summary",l)||Wo("content",l);f&&(c.description=f);var d=Wo("updated",l);return d&&(c.pubDate=new Date(d)),c})};mi(n,"id","id",e),mi(n,"title","title",e);var i=(t=Wf("link",e))===null||t===void 0?void 0:t.attribs.href;i&&(n.link=i),mi(n,"description","subtitle",e);var r=Wo("updated",e);return r&&(n.updated=new Date(r)),mi(n,"author","email",e,!0),n}function vSt(s){var t,e,n=(e=(t=Wf("channel",s.children))===null||t===void 0?void 0:t.children)!==null&&e!==void 0?e:[],i={type:s.name.substr(0,3),id:"",items:(0,Cu.getElementsByTagName)("item",s.children).map(function(o){var a=o.children,l={media:bE(a)};mi(l,"id","guid",a),mi(l,"title","title",a),mi(l,"link","link",a),mi(l,"description","description",a);var c=Wo("pubDate",a);return c&&(l.pubDate=new Date(c)),l})};mi(i,"title","title",n),mi(i,"link","link",n),mi(i,"description","description",n);var r=Wo("lastBuildDate",n);return r&&(i.updated=new Date(r)),mi(i,"author","managingEditor",n,!0),i}var _St=["url","type","lang"],ySt=["fileSize","bitrate","framerate","samplingrate","channels","duration","height","width"];function bE(s){return(0,Cu.getElementsByTagName)("media:content",s).map(function(t){for(var e=t.attribs,n={medium:e.medium,isDefault:!!e.isDefault},i=0,r=_St;i<r.length;i++){var o=r[i];e[o]&&(n[o]=e[o])}for(var a=0,l=ySt;a<l.length;a++){var o=l[a];e[o]&&(n[o]=parseInt(e[o],10))}return e.expression&&(n.expression=e.expression),n})}function Wf(s,t){return(0,Cu.getElementsByTagName)(s,t,!0,1)[0]}function Wo(s,t,e){return e===void 0&&(e=!1),(0,pSt.textContent)((0,Cu.getElementsByTagName)(s,t,e,1)).trim()}function mi(s,t,e,n,i){i===void 0&&(i=!1);var r=Wo(e,n,i);r&&(s[t]=r)}function xSt(s){return s==="rss"||s==="feed"||s==="rdf:RDF"}(function(s){var t=te&&te.__createBinding||(Object.create?function(i,r,o,a){a===void 0&&(a=o),Object.defineProperty(i,a,{enumerable:!0,get:function(){return r[o]}})}:function(i,r,o,a){a===void 0&&(a=o),i[a]=r[o]}),e=te&&te.__exportStar||function(i,r){for(var o in i)o!=="default"&&!Object.prototype.hasOwnProperty.call(r,o)&&t(r,i,o)};Object.defineProperty(s,"__esModule",{value:!0}),s.hasChildren=s.isDocument=s.isComment=s.isText=s.isCDATA=s.isTag=void 0,e(Ni,s),e(Nn,s),e(vi,s),e(ri,s),e(Bi,s),e(Qr,s),e(Gd,s);var n=da;Object.defineProperty(s,"isTag",{enumerable:!0,get:function(){return n.isTag}}),Object.defineProperty(s,"isCDATA",{enumerable:!0,get:function(){return n.isCDATA}}),Object.defineProperty(s,"isText",{enumerable:!0,get:function(){return n.isText}}),Object.defineProperty(s,"isComment",{enumerable:!0,get:function(){return n.isComment}}),Object.defineProperty(s,"isDocument",{enumerable:!0,get:function(){return n.isDocument}}),Object.defineProperty(s,"hasChildren",{enumerable:!0,get:function(){return n.hasChildren}})})(FA);var ma={trueFunc:function(){return!0},falseFunc:function(){return!1}},to={},Ie;(function(s){s.Attribute="attribute",s.Pseudo="pseudo",s.PseudoElement="pseudo-element",s.Tag="tag",s.Universal="universal",s.Adjacent="adjacent",s.Child="child",s.Descendant="descendant",s.Parent="parent",s.Sibling="sibling",s.ColumnCombinator="column-combinator"})(Ie||(Ie={}));const bSt={Unknown:null,QuirksMode:"quirks",IgnoreCase:!0,CaseSensitive:!1};var un;(function(s){s.Any="any",s.Element="element",s.End="end",s.Equals="equals",s.Exists="exists",s.Hyphen="hyphen",s.Not="not",s.Start="start"})(un||(un={}));const e1=/^[^\\#]?(?:\\(?:[\da-f]{1,6}\s?|.)|[\w\-\u00b0-\uFFFF])+/,wSt=/\\([\da-f]{1,6}\s?|(\s)|.)/gi,MSt=new Map([[126,un.Element],[94,un.Start],[36,un.End],[42,un.Any],[33,un.Not],[124,un.Hyphen]]),SSt=new Set(["has","not","matches","is","where","host","host-context"]);function wE(s){switch(s.type){case Ie.Adjacent:case Ie.Child:case Ie.Descendant:case Ie.Parent:case Ie.Sibling:case Ie.ColumnCombinator:return!0;default:return!1}}const ASt=new Set(["contains","icontains"]);function ESt(s,t,e){const n=parseInt(t,16)-65536;return n!==n||e?t:n<0?String.fromCharCode(n+65536):String.fromCharCode(n>>10|55296,n&1023|56320)}function Mc(s){return s.replace(wSt,ESt)}function fg(s){return s===39||s===34}function n1(s){return s===32||s===9||s===10||s===12||s===13}function TSt(s){const t=[],e=ME(t,`${s}`,0);if(e<s.length)throw new Error(`Unmatched selector: ${s.slice(e)}`);return t}function ME(s,t,e){let n=[];function i(d){const m=t.slice(e+d).match(e1);if(!m)throw new Error(`Expected name, found ${t.slice(e)}`);const[g]=m;return e+=d+g.length,Mc(g)}function r(d){for(e+=d;e<t.length&&n1(t.charCodeAt(e));)e++}function o(){e+=1;const d=e;let m=1;for(;m>0&&e<t.length;e++)t.charCodeAt(e)===40&&!a(e)?m++:t.charCodeAt(e)===41&&!a(e)&&m--;if(m)throw new Error("Parenthesis not matched");return Mc(t.slice(d,e-1))}function a(d){let m=0;for(;t.charCodeAt(--d)===92;)m++;return(m&1)===1}function l(){if(n.length>0&&wE(n[n.length-1]))throw new Error("Did not expect successive traversals.")}function c(d){if(n.length>0&&n[n.length-1].type===Ie.Descendant){n[n.length-1].type=d;return}l(),n.push({type:d})}function h(d,m){n.push({type:Ie.Attribute,name:d,action:m,value:i(1),namespace:null,ignoreCase:"quirks"})}function f(){if(n.length&&n[n.length-1].type===Ie.Descendant&&n.pop(),n.length===0)throw new Error("Empty sub-selector");s.push(n)}if(r(0),t.length===e)return e;t:for(;e<t.length;){const d=t.charCodeAt(e);switch(d){case 32:case 9:case 10:case 12:case 13:{(n.length===0||n[0].type!==Ie.Descendant)&&(l(),n.push({type:Ie.Descendant})),r(1);break}case 62:{c(Ie.Child),r(1);break}case 60:{c(Ie.Parent),r(1);break}case 126:{c(Ie.Sibling),r(1);break}case 43:{c(Ie.Adjacent),r(1);break}case 46:{h("class",un.Element);break}case 35:{h("id",un.Equals);break}case 91:{r(1);let m,g=null;t.charCodeAt(e)===124?m=i(1):t.startsWith("*|",e)?(g="*",m=i(2)):(m=i(0),t.charCodeAt(e)===124&&t.charCodeAt(e+1)!==61&&(g=m,m=i(1))),r(0);let y=un.Exists;const _=MSt.get(t.charCodeAt(e));if(_){if(y=_,t.charCodeAt(e+1)!==61)throw new Error("Expected `=`");r(2)}else t.charCodeAt(e)===61&&(y=un.Equals,r(1));let v="",w=null;if(y!=="exists"){if(fg(t.charCodeAt(e))){const A=t.charCodeAt(e);let T=e+1;for(;T<t.length&&(t.charCodeAt(T)!==A||a(T));)T+=1;if(t.charCodeAt(T)!==A)throw new Error("Attribute value didn't end");v=Mc(t.slice(e+1,T)),e=T+1}else{const A=e;for(;e<t.length&&(!n1(t.charCodeAt(e))&&t.charCodeAt(e)!==93||a(e));)e+=1;v=Mc(t.slice(A,e))}r(0);const M=t.charCodeAt(e)|32;M===115?(w=!1,r(1)):M===105&&(w=!0,r(1))}if(t.charCodeAt(e)!==93)throw new Error("Attribute selector didn't terminate");e+=1;const b={type:Ie.Attribute,name:m,action:y,value:v,namespace:g,ignoreCase:w};n.push(b);break}case 58:{if(t.charCodeAt(e+1)===58){n.push({type:Ie.PseudoElement,name:i(2).toLowerCase(),data:t.charCodeAt(e)===40?o():null});continue}const m=i(1).toLowerCase();let g=null;if(t.charCodeAt(e)===40)if(SSt.has(m)){if(fg(t.charCodeAt(e+1)))throw new Error(`Pseudo-selector ${m} cannot be quoted`);if(g=[],e=ME(g,t,e+1),t.charCodeAt(e)!==41)throw new Error(`Missing closing parenthesis in :${m} (${t})`);e+=1}else{if(g=o(),ASt.has(m)){const y=g.charCodeAt(0);y===g.charCodeAt(g.length-1)&&fg(y)&&(g=g.slice(1,-1))}g=Mc(g)}n.push({type:Ie.Pseudo,name:m,data:g});break}case 44:{f(),n=[],r(1);break}default:{if(t.startsWith("/*",e)){const y=t.indexOf("*/",e+2);if(y<0)throw new Error("Comment was not terminated");e=y+2,n.length===0&&r(0);break}let m=null,g;if(d===42)e+=1,g="*";else if(d===124){if(g="",t.charCodeAt(e+1)===124){c(Ie.ColumnCombinator),r(2);break}}else if(e1.test(t.slice(e)))g=i(0);else break t;t.charCodeAt(e)===124&&t.charCodeAt(e+1)!==124&&(m=g,t.charCodeAt(e+1)===42?(g="*",e+=2):g=i(1)),n.push(g==="*"?{type:Ie.Universal,namespace:m}:{type:Ie.Tag,name:g,namespace:m})}}}return f(),e}const SE=["\\",'"'],AE=[...SE,"(",")"],CSt=new Set(SE.map(s=>s.charCodeAt(0))),i1=new Set(AE.map(s=>s.charCodeAt(0))),ul=new Set([...AE,"~","^","$","*","+","!","|",":","[","]"," ","."].map(s=>s.charCodeAt(0)));function EE(s){return s.map(t=>t.map(PSt).join("")).join(", ")}function PSt(s,t,e){switch(s.type){case Ie.Child:return t===0?"> ":" > ";case Ie.Parent:return t===0?"< ":" < ";case Ie.Sibling:return t===0?"~ ":" ~ ";case Ie.Adjacent:return t===0?"+ ":" + ";case Ie.Descendant:return" ";case Ie.ColumnCombinator:return t===0?"|| ":" || ";case Ie.Universal:return s.namespace==="*"&&t+1<e.length&&"name"in e[t+1]?"":`${TE(s.namespace)}*`;case Ie.Tag:return s1(s);case Ie.PseudoElement:return`::${gr(s.name,ul)}${s.data===null?"":`(${gr(s.data,i1)})`}`;case Ie.Pseudo:return`:${gr(s.name,ul)}${s.data===null?"":`(${typeof s.data=="string"?gr(s.data,i1):EE(s.data)})`}`;case Ie.Attribute:{if(s.name==="id"&&s.action===un.Equals&&s.ignoreCase==="quirks"&&!s.namespace)return`#${gr(s.value,ul)}`;if(s.name==="class"&&s.action===un.Element&&s.ignoreCase==="quirks"&&!s.namespace)return`.${gr(s.value,ul)}`;const n=s1(s);return s.action===un.Exists?`[${n}]`:`[${n}${RSt(s.action)}="${gr(s.value,CSt)}"${s.ignoreCase===null?"":s.ignoreCase?" i":" s"}]`}}}function RSt(s){switch(s){case un.Equals:return"";case un.Element:return"~";case un.Start:return"^";case un.End:return"$";case un.Any:return"*";case un.Not:return"!";case un.Hyphen:return"|";case un.Exists:throw new Error("Shouldn't be here")}}function s1(s){return`${TE(s.namespace)}${gr(s.name,ul)}`}function TE(s){return s!==null?`${s==="*"?"*":gr(s,ul)}|`:""}function gr(s,t){let e=0,n="";for(let i=0;i<s.length;i++)t.has(s.charCodeAt(i))&&(n+=`${s.slice(e,i)}\\${s.charAt(i)}`,e=i+1);return n.length>0?n+s.slice(e):s}const LSt=Object.freeze(Object.defineProperty({__proto__:null,get AttributeAction(){return un},IgnoreCaseMode:bSt,get SelectorType(){return Ie},isTraversal:wE,parse:TSt,stringify:EE},Symbol.toStringTag,{value:"Module"})),qd=Lz(LSt);var Q_={},Wd={};(function(s){Object.defineProperty(s,"__esModule",{value:!0}),s.isTraversal=s.procedure=void 0,s.procedure={universal:50,tag:30,attribute:1,pseudo:0,"pseudo-element":0,"column-combinator":-1,descendant:-1,child:-1,parent:-1,sibling:-1,adjacent:-1,_flexibleDescendant:-1};function t(e){return s.procedure[e.type]<0}s.isTraversal=t})(Wd);Object.defineProperty(Q_,"__esModule",{value:!0});var r1=qd,DSt=Wd,o1={exists:10,equals:8,not:7,start:6,end:6,any:5,hyphen:4,element:4};function ISt(s){for(var t=s.map(CE),e=1;e<s.length;e++){var n=t[e];if(!(n<0))for(var i=e-1;i>=0&&n<t[i];i--){var r=s[i+1];s[i+1]=s[i],s[i]=r,t[i+1]=t[i],t[i]=n}}}Q_.default=ISt;function CE(s){var t=DSt.procedure[s.type];if(s.type===r1.SelectorType.Attribute)t=o1[s.action],t===o1.equals&&s.name==="id"&&(t=9),s.ignoreCase&&(t>>=1);else if(s.type===r1.SelectorType.Pseudo)if(!s.data)t=3;else if(s.name==="has"||s.name==="contains")t=0;else if(Array.isArray(s.data)){t=0;for(var e=0;e<s.data.length;e++)if(s.data[e].length===1){var n=CE(s.data[e][0]);if(n===0){t=0;break}n>t&&(t=n)}s.data.length>1&&t>0&&(t-=1)}else t=1;return t}var $d={},Xd={};Object.defineProperty(Xd,"__esModule",{value:!0});Xd.attributeRules=void 0;var mf=ma,OSt=/[-[\]{}()*+?.,\\^$|#\s]/g;function a1(s){return s.replace(OSt,"\\$&")}var zSt=new Set(["accept","accept-charset","align","alink","axis","bgcolor","charset","checked","clear","codetype","color","compact","declare","defer","dir","direction","disabled","enctype","face","frame","hreflang","http-equiv","lang","language","link","media","method","multiple","nohref","noresize","noshade","nowrap","readonly","rel","rev","rules","scope","scrolling","selected","shape","target","text","type","valign","valuetype","vlink"]);function Io(s,t){return typeof s.ignoreCase=="boolean"?s.ignoreCase:s.ignoreCase==="quirks"?!!t.quirksMode:!t.xmlMode&&zSt.has(s.name)}Xd.attributeRules={equals:function(s,t,e){var n=e.adapter,i=t.name,r=t.value;return Io(t,e)?(r=r.toLowerCase(),function(o){var a=n.getAttributeValue(o,i);return a!=null&&a.length===r.length&&a.toLowerCase()===r&&s(o)}):function(o){return n.getAttributeValue(o,i)===r&&s(o)}},hyphen:function(s,t,e){var n=e.adapter,i=t.name,r=t.value,o=r.length;return Io(t,e)?(r=r.toLowerCase(),function(l){var c=n.getAttributeValue(l,i);return c!=null&&(c.length===o||c.charAt(o)==="-")&&c.substr(0,o).toLowerCase()===r&&s(l)}):function(l){var c=n.getAttributeValue(l,i);return c!=null&&(c.length===o||c.charAt(o)==="-")&&c.substr(0,o)===r&&s(l)}},element:function(s,t,e){var n=e.adapter,i=t.name,r=t.value;if(/\s/.test(r))return mf.falseFunc;var o=new RegExp("(?:^|\\s)".concat(a1(r),"(?:$|\\s)"),Io(t,e)?"i":"");return function(l){var c=n.getAttributeValue(l,i);return c!=null&&c.length>=r.length&&o.test(c)&&s(l)}},exists:function(s,t,e){var n=t.name,i=e.adapter;return function(r){return i.hasAttrib(r,n)&&s(r)}},start:function(s,t,e){var n=e.adapter,i=t.name,r=t.value,o=r.length;return o===0?mf.falseFunc:Io(t,e)?(r=r.toLowerCase(),function(a){var l=n.getAttributeValue(a,i);return l!=null&&l.length>=o&&l.substr(0,o).toLowerCase()===r&&s(a)}):function(a){var l;return!!(!((l=n.getAttributeValue(a,i))===null||l===void 0)&&l.startsWith(r))&&s(a)}},end:function(s,t,e){var n=e.adapter,i=t.name,r=t.value,o=-r.length;return o===0?mf.falseFunc:Io(t,e)?(r=r.toLowerCase(),function(a){var l;return((l=n.getAttributeValue(a,i))===null||l===void 0?void 0:l.substr(o).toLowerCase())===r&&s(a)}):function(a){var l;return!!(!((l=n.getAttributeValue(a,i))===null||l===void 0)&&l.endsWith(r))&&s(a)}},any:function(s,t,e){var n=e.adapter,i=t.name,r=t.value;if(r==="")return mf.falseFunc;if(Io(t,e)){var o=new RegExp(a1(r),"i");return function(l){var c=n.getAttributeValue(l,i);return c!=null&&c.length>=r.length&&o.test(c)&&s(l)}}return function(a){var l;return!!(!((l=n.getAttributeValue(a,i))===null||l===void 0)&&l.includes(r))&&s(a)}},not:function(s,t,e){var n=e.adapter,i=t.name,r=t.value;return r===""?function(o){return!!n.getAttributeValue(o,i)&&s(o)}:Io(t,e)?(r=r.toLowerCase(),function(o){var a=n.getAttributeValue(o,i);return(a==null||a.length!==r.length||a.toLowerCase()!==r)&&s(o)}):function(o){return n.getAttributeValue(o,i)!==r&&s(o)}}};var ty={},PE={},RE={},jd={};Object.defineProperty(jd,"__esModule",{value:!0});jd.parse=void 0;var kSt=new Set([9,10,12,13,32]),l1="0".charCodeAt(0),USt="9".charCodeAt(0);function NSt(s){if(s=s.trim().toLowerCase(),s==="even")return[2,0];if(s==="odd")return[2,1];var t=0,e=0,n=r(),i=o();if(t<s.length&&s.charAt(t)==="n"&&(t++,e=n*(i??1),a(),t<s.length?(n=r(),a(),i=o()):n=i=0),i===null||t<s.length)throw new Error("n-th rule couldn't be parsed ('".concat(s,"')"));return[e,n*i];function r(){return s.charAt(t)==="-"?(t++,-1):(s.charAt(t)==="+"&&t++,1)}function o(){for(var l=t,c=0;t<s.length&&s.charCodeAt(t)>=l1&&s.charCodeAt(t)<=USt;)c=c*10+(s.charCodeAt(t)-l1),t++;return t===l?null:c}function a(){for(;t<s.length&&kSt.has(s.charCodeAt(t));)t++}}jd.parse=NSt;var Sl={},FSt=te&&te.__importDefault||function(s){return s&&s.__esModule?s:{default:s}};Object.defineProperty(Sl,"__esModule",{value:!0});Sl.generate=Sl.compile=void 0;var c1=FSt(ma);function BSt(s){var t=s[0],e=s[1]-1;if(e<0&&t<=0)return c1.default.falseFunc;if(t===-1)return function(r){return r<=e};if(t===0)return function(r){return r===e};if(t===1)return e<0?c1.default.trueFunc:function(r){return r>=e};var n=Math.abs(t),i=(e%n+n)%n;return t>1?function(r){return r>=e&&r%n===i}:function(r){return r<=e&&r%n===i}}Sl.compile=BSt;function HSt(s){var t=s[0],e=s[1]-1,n=0;if(t<0){var i=-t,r=(e%i+i)%i;return function(){var o=r+i*n++;return o>e?null:o}}return t===0?e<0?function(){return null}:function(){return n++===0?e:null}:(e<0&&(e+=t*Math.ceil(-e/t)),function(){return t*n+++e})}Sl.generate=HSt;(function(s){Object.defineProperty(s,"__esModule",{value:!0}),s.sequence=s.generate=s.compile=s.parse=void 0;var t=jd;Object.defineProperty(s,"parse",{enumerable:!0,get:function(){return t.parse}});var e=Sl;Object.defineProperty(s,"compile",{enumerable:!0,get:function(){return e.compile}}),Object.defineProperty(s,"generate",{enumerable:!0,get:function(){return e.generate}});function n(r){return(0,e.compile)((0,t.parse)(r))}s.default=n;function i(r){return(0,e.generate)((0,t.parse)(r))}s.sequence=i})(RE);(function(s){var t=te&&te.__importDefault||function(o){return o&&o.__esModule?o:{default:o}};Object.defineProperty(s,"__esModule",{value:!0}),s.filters=void 0;var e=t(RE),n=ma;function i(o,a){return function(l){var c=a.getParent(l);return c!=null&&a.isTag(c)&&o(l)}}s.filters={contains:function(o,a,l){var c=l.adapter;return function(f){return o(f)&&c.getText(f).includes(a)}},icontains:function(o,a,l){var c=l.adapter,h=a.toLowerCase();return function(d){return o(d)&&c.getText(d).toLowerCase().includes(h)}},"nth-child":function(o,a,l){var c=l.adapter,h=l.equals,f=(0,e.default)(a);return f===n.falseFunc?n.falseFunc:f===n.trueFunc?i(o,c):function(m){for(var g=c.getSiblings(m),y=0,_=0;_<g.length&&!h(m,g[_]);_++)c.isTag(g[_])&&y++;return f(y)&&o(m)}},"nth-last-child":function(o,a,l){var c=l.adapter,h=l.equals,f=(0,e.default)(a);return f===n.falseFunc?n.falseFunc:f===n.trueFunc?i(o,c):function(m){for(var g=c.getSiblings(m),y=0,_=g.length-1;_>=0&&!h(m,g[_]);_--)c.isTag(g[_])&&y++;return f(y)&&o(m)}},"nth-of-type":function(o,a,l){var c=l.adapter,h=l.equals,f=(0,e.default)(a);return f===n.falseFunc?n.falseFunc:f===n.trueFunc?i(o,c):function(m){for(var g=c.getSiblings(m),y=0,_=0;_<g.length;_++){var v=g[_];if(h(m,v))break;c.isTag(v)&&c.getName(v)===c.getName(m)&&y++}return f(y)&&o(m)}},"nth-last-of-type":function(o,a,l){var c=l.adapter,h=l.equals,f=(0,e.default)(a);return f===n.falseFunc?n.falseFunc:f===n.trueFunc?i(o,c):function(m){for(var g=c.getSiblings(m),y=0,_=g.length-1;_>=0;_--){var v=g[_];if(h(m,v))break;c.isTag(v)&&c.getName(v)===c.getName(m)&&y++}return f(y)&&o(m)}},root:function(o,a,l){var c=l.adapter;return function(h){var f=c.getParent(h);return(f==null||!c.isTag(f))&&o(h)}},scope:function(o,a,l,c){var h=l.equals;return!c||c.length===0?s.filters.root(o,a,l):c.length===1?function(f){return h(c[0],f)&&o(f)}:function(f){return c.includes(f)&&o(f)}},hover:r("isHovered"),visited:r("isVisited"),active:r("isActive")};function r(o){return function(l,c,h){var f=h.adapter,d=f[o];return typeof d!="function"?n.falseFunc:function(g){return d(g)&&l(g)}}}})(PE);var Al={};Object.defineProperty(Al,"__esModule",{value:!0});Al.verifyPseudoArgs=Al.pseudos=void 0;Al.pseudos={empty:function(s,t){var e=t.adapter;return!e.getChildren(s).some(function(n){return e.isTag(n)||e.getText(n)!==""})},"first-child":function(s,t){var e=t.adapter,n=t.equals,i=e.getSiblings(s).find(function(r){return e.isTag(r)});return i!=null&&n(s,i)},"last-child":function(s,t){for(var e=t.adapter,n=t.equals,i=e.getSiblings(s),r=i.length-1;r>=0;r--){if(n(s,i[r]))return!0;if(e.isTag(i[r]))break}return!1},"first-of-type":function(s,t){for(var e=t.adapter,n=t.equals,i=e.getSiblings(s),r=e.getName(s),o=0;o<i.length;o++){var a=i[o];if(n(s,a))return!0;if(e.isTag(a)&&e.getName(a)===r)break}return!1},"last-of-type":function(s,t){for(var e=t.adapter,n=t.equals,i=e.getSiblings(s),r=e.getName(s),o=i.length-1;o>=0;o--){var a=i[o];if(n(s,a))return!0;if(e.isTag(a)&&e.getName(a)===r)break}return!1},"only-of-type":function(s,t){var e=t.adapter,n=t.equals,i=e.getName(s);return e.getSiblings(s).every(function(r){return n(s,r)||!e.isTag(r)||e.getName(r)!==i})},"only-child":function(s,t){var e=t.adapter,n=t.equals;return e.getSiblings(s).every(function(i){return n(s,i)||!e.isTag(i)})}};function VSt(s,t,e){if(e===null){if(s.length>2)throw new Error("pseudo-selector :".concat(t," requires an argument"))}else if(s.length===2)throw new Error("pseudo-selector :".concat(t," doesn't have any arguments"))}Al.verifyPseudoArgs=VSt;var Yd={};Object.defineProperty(Yd,"__esModule",{value:!0});Yd.aliases=void 0;Yd.aliases={"any-link":":is(a, area, link)[href]",link:":any-link:not(:visited)",disabled:`:is(
        :is(button, input, select, textarea, optgroup, option)[disabled],
        optgroup[disabled] > option,
        fieldset[disabled]:not(fieldset[disabled] legend:first-of-type *)
    )`,enabled:":not(:disabled)",checked:":is(:is(input[type=radio], input[type=checkbox])[checked], option:selected)",required:":is(input, select, textarea)[required]",optional:":is(input, select, textarea):not([required])",selected:"option:is([selected], select:not([multiple]):not(:has(> option[selected])) > :first-of-type)",checkbox:"[type=checkbox]",file:"[type=file]",password:"[type=password]",radio:"[type=radio]",reset:"[type=reset]",image:"[type=image]",submit:"[type=submit]",parent:":not(:empty)",header:":is(h1, h2, h3, h4, h5, h6)",button:":is(button, input[type=button])",input:":is(input, textarea, select, button)",text:"input:is(:not([type!='']), [type=text])"};var Zd={};(function(s){var t=te&&te.__spreadArray||function(a,l,c){if(c||arguments.length===2)for(var h=0,f=l.length,d;h<f;h++)(d||!(h in l))&&(d||(d=Array.prototype.slice.call(l,0,h)),d[h]=l[h]);return a.concat(d||Array.prototype.slice.call(l))};Object.defineProperty(s,"__esModule",{value:!0}),s.subselects=s.getNextSiblings=s.ensureIsTag=s.PLACEHOLDER_ELEMENT=void 0;var e=ma,n=Wd;s.PLACEHOLDER_ELEMENT={};function i(a,l){return a===e.falseFunc?e.falseFunc:function(c){return l.isTag(c)&&a(c)}}s.ensureIsTag=i;function r(a,l){var c=l.getSiblings(a);if(c.length<=1)return[];var h=c.indexOf(a);return h<0||h===c.length-1?[]:c.slice(h+1).filter(l.isTag)}s.getNextSiblings=r;var o=function(a,l,c,h,f){var d={xmlMode:!!c.xmlMode,adapter:c.adapter,equals:c.equals},m=f(l,d,h);return function(g){return m(g)&&a(g)}};s.subselects={is:o,matches:o,where:o,not:function(a,l,c,h,f){var d={xmlMode:!!c.xmlMode,adapter:c.adapter,equals:c.equals},m=f(l,d,h);return m===e.falseFunc?a:m===e.trueFunc?e.falseFunc:function(y){return!m(y)&&a(y)}},has:function(a,l,c,h,f){var d=c.adapter,m={xmlMode:!!c.xmlMode,adapter:d,equals:c.equals},g=l.some(function(b){return b.some(n.isTraversal)})?[s.PLACEHOLDER_ELEMENT]:void 0,y=f(l,m,g);if(y===e.falseFunc)return e.falseFunc;if(y===e.trueFunc)return function(b){return d.getChildren(b).some(d.isTag)&&a(b)};var _=i(y,d),v=y.shouldTestNextSiblings,w=v===void 0?!1:v;return g?function(b){g[0]=b;var M=d.getChildren(b),A=w?t(t([],M,!0),r(b,d),!0):M;return a(b)&&d.existsOne(_,A)}:function(b){return a(b)&&d.existsOne(_,d.getChildren(b))}}}})(Zd);(function(s){Object.defineProperty(s,"__esModule",{value:!0}),s.compilePseudoSelector=s.aliases=s.pseudos=s.filters=void 0;var t=ma,e=qd,n=PE;Object.defineProperty(s,"filters",{enumerable:!0,get:function(){return n.filters}});var i=Al;Object.defineProperty(s,"pseudos",{enumerable:!0,get:function(){return i.pseudos}});var r=Yd;Object.defineProperty(s,"aliases",{enumerable:!0,get:function(){return r.aliases}});var o=Zd;function a(l,c,h,f,d){var m=c.name,g=c.data;if(Array.isArray(g))return o.subselects[m](l,g,h,f,d);if(m in r.aliases){if(g!=null)throw new Error("Pseudo ".concat(m," doesn't have any arguments"));var y=(0,e.parse)(r.aliases[m]);return o.subselects.is(l,y,h,f,d)}if(m in n.filters)return n.filters[m](l,g,h,f);if(m in i.pseudos){var _=i.pseudos[m];return(0,i.verifyPseudoArgs)(_,m,g),_===t.falseFunc?t.falseFunc:l===t.trueFunc?function(v){return _(v,h,g)}:function(v){return _(v,h,g)&&l(v)}}throw new Error("unmatched pseudo-class :".concat(m))}s.compilePseudoSelector=a})(ty);Object.defineProperty($d,"__esModule",{value:!0});$d.compileGeneralSelector=void 0;var GSt=Xd,qSt=ty,ys=qd;function WSt(s,t,e,n,i){var r=e.adapter,o=e.equals;switch(t.type){case ys.SelectorType.PseudoElement:throw new Error("Pseudo-elements are not supported by css-select");case ys.SelectorType.ColumnCombinator:throw new Error("Column combinators are not yet supported by css-select");case ys.SelectorType.Attribute:{if(t.namespace!=null)throw new Error("Namespaced attributes are not yet supported by css-select");return(!e.xmlMode||e.lowerCaseAttributeNames)&&(t.name=t.name.toLowerCase()),GSt.attributeRules[t.action](s,t,e)}case ys.SelectorType.Pseudo:return(0,qSt.compilePseudoSelector)(s,t,e,n,i);case ys.SelectorType.Tag:{if(t.namespace!=null)throw new Error("Namespaced tag names are not yet supported by css-select");var a=t.name;return(!e.xmlMode||e.lowerCaseTags)&&(a=a.toLowerCase()),function(h){return r.getName(h)===a&&s(h)}}case ys.SelectorType.Descendant:{if(e.cacheResults===!1||typeof WeakSet>"u")return function(h){for(var f=h;f=r.getParent(f);)if(r.isTag(f)&&s(f))return!0;return!1};var l=new WeakSet;return function(h){for(var f=h;f=r.getParent(f);)if(!l.has(f)){if(r.isTag(f)&&s(f))return!0;l.add(f)}return!1}}case"_flexibleDescendant":return function(h){var f=h;do if(r.isTag(f)&&s(f))return!0;while(f=r.getParent(f));return!1};case ys.SelectorType.Parent:return function(h){return r.getChildren(h).some(function(f){return r.isTag(f)&&s(f)})};case ys.SelectorType.Child:return function(h){var f=r.getParent(h);return f!=null&&r.isTag(f)&&s(f)};case ys.SelectorType.Sibling:return function(h){for(var f=r.getSiblings(h),d=0;d<f.length;d++){var m=f[d];if(o(h,m))break;if(r.isTag(m)&&s(m))return!0}return!1};case ys.SelectorType.Adjacent:return r.prevElementSibling?function(h){var f=r.prevElementSibling(h);return f!=null&&s(f)}:function(h){for(var f=r.getSiblings(h),d,m=0;m<f.length;m++){var g=f[m];if(o(h,g))break;r.isTag(g)&&(d=g)}return!!d&&s(d)};case ys.SelectorType.Universal:{if(t.namespace!=null&&t.namespace!=="*")throw new Error("Namespaced universal selectors are not yet supported by css-select");return s}}}$d.compileGeneralSelector=WSt;var $St=te&&te.__importDefault||function(s){return s&&s.__esModule?s:{default:s}};Object.defineProperty(to,"__esModule",{value:!0});to.compileToken=to.compileUnsafe=to.compile=void 0;var ey=qd,jr=ma,XSt=$St(Q_),jSt=Wd,YSt=$d,LE=Zd;function ZSt(s,t,e){var n=DE(s,t,e);return(0,LE.ensureIsTag)(n,t.adapter)}to.compile=ZSt;function DE(s,t,e){var n=typeof s=="string"?(0,ey.parse)(s):s;return ny(n,t,e)}to.compileUnsafe=DE;function IE(s){return s.type==="pseudo"&&(s.name==="scope"||Array.isArray(s.data)&&s.data.some(function(t){return t.some(IE)}))}var KSt={type:ey.SelectorType.Descendant},JSt={type:"_flexibleDescendant"},QSt={type:ey.SelectorType.Pseudo,name:"scope",data:null};function tAt(s,t,e){for(var n=t.adapter,i=!!(e!=null&&e.every(function(l){var c=n.isTag(l)&&n.getParent(l);return l===LE.PLACEHOLDER_ELEMENT||c&&n.isTag(c)})),r=0,o=s;r<o.length;r++){var a=o[r];if(!(a.length>0&&(0,jSt.isTraversal)(a[0])&&a[0].type!=="descendant"))if(i&&!a.some(IE))a.unshift(KSt);else continue;a.unshift(QSt)}}function ny(s,t,e){var n;s=s.filter(function(l){return l.length>0}),s.forEach(XSt.default),e=(n=t.context)!==null&&n!==void 0?n:e;var i=Array.isArray(e),r=e&&(Array.isArray(e)?e:[e]);tAt(s,t,r);var o=!1,a=s.map(function(l){if(l.length>=2){var c=l[0],h=l[1];c.type!=="pseudo"||c.name!=="scope"||(i&&h.type==="descendant"?l[1]=JSt:(h.type==="adjacent"||h.type==="sibling")&&(o=!0))}return eAt(l,t,r)}).reduce(nAt,jr.falseFunc);return a.shouldTestNextSiblings=o,a}to.compileToken=ny;function eAt(s,t,e){var n;return s.reduce(function(i,r){return i===jr.falseFunc?jr.falseFunc:(0,YSt.compileGeneralSelector)(i,r,t,e,ny)},(n=t.rootFunc)!==null&&n!==void 0?n:jr.trueFunc)}function nAt(s,t){return t===jr.falseFunc||s===jr.trueFunc?s:s===jr.falseFunc||t===jr.trueFunc?t:function(n){return s(n)||t(n)}}(function(s){var t=te&&te.__createBinding||(Object.create?function(v,w,b,M){M===void 0&&(M=b);var A=Object.getOwnPropertyDescriptor(w,b);(!A||("get"in A?!w.__esModule:A.writable||A.configurable))&&(A={enumerable:!0,get:function(){return w[b]}}),Object.defineProperty(v,M,A)}:function(v,w,b,M){M===void 0&&(M=b),v[M]=w[b]}),e=te&&te.__setModuleDefault||(Object.create?function(v,w){Object.defineProperty(v,"default",{enumerable:!0,value:w})}:function(v,w){v.default=w}),n=te&&te.__importStar||function(v){if(v&&v.__esModule)return v;var w={};if(v!=null)for(var b in v)b!=="default"&&Object.prototype.hasOwnProperty.call(v,b)&&t(w,v,b);return e(w,v),w};Object.defineProperty(s,"__esModule",{value:!0}),s.aliases=s.pseudos=s.filters=s.is=s.selectOne=s.selectAll=s.prepareContext=s._compileToken=s._compileUnsafe=s.compile=void 0;var i=n(FA),r=ma,o=to,a=Zd,l=function(v,w){return v===w},c={adapter:i,equals:l};function h(v){var w,b,M,A,T=v??c;return(w=T.adapter)!==null&&w!==void 0||(T.adapter=i),(b=T.equals)!==null&&b!==void 0||(T.equals=(A=(M=T.adapter)===null||M===void 0?void 0:M.equals)!==null&&A!==void 0?A:l),T}function f(v){return function(b,M,A){var T=h(M);return v(b,T,A)}}s.compile=f(o.compile),s._compileUnsafe=f(o.compileUnsafe),s._compileToken=f(o.compileToken);function d(v){return function(b,M,A){var T=h(A);typeof b!="function"&&(b=(0,o.compileUnsafe)(b,T,M));var P=m(M,T.adapter,b.shouldTestNextSiblings);return v(b,P,T)}}function m(v,w,b){return b===void 0&&(b=!1),b&&(v=g(v,w)),Array.isArray(v)?w.removeSubsets(v):w.getChildren(v)}s.prepareContext=m;function g(v,w){for(var b=Array.isArray(v)?v.slice(0):[v],M=b.length,A=0;A<M;A++){var T=(0,a.getNextSiblings)(b[A],w);b.push.apply(b,T)}return b}s.selectAll=d(function(v,w,b){return v===r.falseFunc||!w||w.length===0?[]:b.adapter.findAll(v,w)}),s.selectOne=d(function(v,w,b){return v===r.falseFunc||!w||w.length===0?null:b.adapter.findOne(v,w)});function y(v,w,b){var M=h(b);return(typeof w=="function"?w:(0,o.compile)(w,M))(v)}s.is=y,s.default=s.selectAll;var _=ty;Object.defineProperty(s,"filters",{enumerable:!0,get:function(){return _.filters}}),Object.defineProperty(s,"pseudos",{enumerable:!0,get:function(){return _.pseudos}}),Object.defineProperty(s,"aliases",{enumerable:!0,get:function(){return _.aliases}})})(Gf);function iAt(s){return!0}function Sc(s){return s.children||[]}function u1(s){return s.parent}function sAt(s){const t=new Set(s);return t.forEach(e=>{let n=e.parent;for(;n;){if(t.has(n)){t.delete(e);return}n=n.parent}}),Array.from(t)}const El={isTag:iAt,existsOne(s,t){return t.some(e=>s(e)||El.existsOne(s,Sc(e)))},getSiblings(s){const t=u1(s);return t?Sc(t):[s]},getChildren:Sc,getParent:u1,getAttributeValue(s,t){return t==="class"?s.props.classes.join(" "):t==="id"?s.id:""},hasAttrib(s,t){return t==="id"?!!s.id:t==="class"?s.props.classes.length>0:s.traits.hash?Object.prototype.hasOwnProperty.call(s.traits.hash,t):!1},removeSubsets:sAt,getName(s){var t;return(t=s.type)!==null&&t!==void 0?t:""},findOne:function s(t,e){for(const n of e){if(t(n))return n;{const i=s(t,Sc(n));if(i)return i}}return null},findAll:function s(t,e){const n=[];for(const i of e)t(i)&&n.push(i),n.push(...s(t,Sc(i)));return n},getText:function(t){return""}},rAt=(s,t)=>{const e=[],n=Array.isArray(t)?t:[t],i=new Set(n);for(const r of Array.from(s)){let o=r;for(;o!=null;){if(i.has(o)){e.push(r);break}o=El.getParent(o)}}return e},oAt=s=>{let t=s;for(;El.getParent(t)!==null;)t=El.getParent(t);return t},aAt=(s,t)=>{try{Gf.compile(s)}catch{return[]}const e=Array.isArray(t);if(e&&t.length===0)return[];const n=oAt(e?t[0]:t),i=Gf.selectAll(s,n,{adapter:El});return t?rAt(i,t):i},lAt=s=>{try{return Gf.compile(s,{adapter:El})}catch{return()=>!1}},cAt=/^<([0-9]+|<*)$/;class OE{constructor(t){this.root=t,this.root.model=this,this.root.root=this.root,this.ids={},this.classes={},this.traits={},this.types={},this.nodes=[],this.watchers=[],this.fire=!1,this.lastNode=null,this.event={type:"update"};const e=C=>i(C.node),n=C=>r(C.node);this.root.on("add",e),this.root.on("remove",n);const i=C=>(w(C),M(C),T(C),C.on("change:node",c),c(null,C,!0),l(C)),r=C=>(b(C),A(C),P(C),y(C.id,C),v(C.classes,C),C.off("change:node",c),l(C)),o=C=>{for(const S of Array.from(this.watchers))S.match=S.matcher(C);return null},a=C=>{for(const S of Array.from(this.watchers)){const L=S.fire||(S.fire=S.match!==S.matcher(C));L&&(this.lastNode=C),this.fire||(this.fire=L)}return null},l=C=>{for(const S of Array.from(this.watchers)){const L=S.fire||(S.fire=S.matcher(C));L&&(this.lastNode=C),this.fire||(this.fire=L)}return null};this.digest=()=>{if(!this.fire)return!1;for(const C of Array.from(this.watchers.slice()))C.fire&&(C.fire=!1,C.handler());return this.fire=!1,!0};const c=(C,S,L)=>{const H=L||C.changed["node.id"],$=L||C.changed["node.classes"];let B=!1;if(H){const G=S.get("node.id");G!==S.id&&(L||o(S),B=!0,S.id!=null&&y(S.id,S),g(G,S))}if($){let G,I=(G=S.get("node.classes"))!=null?G:[];const et=I.join(",");et!==(S.classes!=null?S.classes.klass:void 0)&&(I=I.slice(),!L&&!B&&o(S),B=!0,S.classes!=null&&v(S.classes,S),_(I,S),S.classes=I,S.classes.klass=et)}return!L&&B&&a(S),null},h=function(C,S,L){if(S!=null){for(const H of Array.from(S)){const $=C[H]!=null?C[H]:[];$.push(L),C[H]=$}return null}},f=function(C,S,L){if(S!=null){for(const H of Array.from(S)){const $=C[H],B=$.indexOf(L);B>=0&&$.splice(B,1),$.length===0&&delete C[H]}return null}},d=function(C){if(!(C.length>0))return;const S=C.hash={};return Array.from(C).map(L=>S[L]=!0)},m=C=>delete C.hash,g=(C,S)=>{if(this.ids[C])throw new Error(`Duplicate node id \`${C}\``);return C!=null&&(this.ids[C]=[S]),S.id=C??S._id},y=(C,S)=>(C!=null&&delete this.ids[C],S.id=S._id),_=(C,S)=>{if(h(this.classes,C,S),C!=null)return d(C)},v=(C,S)=>{if(f(this.classes,C,S),C!=null)return m(C)},w=C=>this.nodes.push(C),b=C=>this.nodes.splice(this.nodes.indexOf(C),1),M=C=>h(this.types,[C.type],C),A=C=>f(this.types,[C.type],C),T=C=>(h(this.traits,C.traits,C),d(C.traits)),P=C=>(f(this.traits,C.traits,C),m(C.traits));i(this.root),this.root.trigger({type:"added"})}select(t,e){return aAt(t,e||this.getRoot())}watch(t,e){let n;return e.unwatch=()=>this.unwatch(e),e.watcher=n={selector:t,handler:e,matcher:this._matcher(t),match:!1,fire:!1},this.watchers.push(n),this.select(t)}unwatch(t){const{watcher:e}=t;if(e!=null)return this.watchers.splice(this.watchers.indexOf(e),1),delete t.unwatch,delete t.watcher}_matcher(t){if(cAt.test(t))throw new Error("Auto-link matcher unsupported");return lAt(t)}getRoot(){return this.root}getLastTrigger(){return this.lastNode.toString()}}const uAt=Object.freeze(Object.defineProperty({__proto__:null,Attributes:IA,Group:UA,Guard:NA,Model:OE,Node:ru},Symbol.toStringTag,{value:"Module"}));class zE{constructor(t,e){this.classes=t,this.canvas=e;const n=document.createElement("div");n.classList.add("mathbox-overlays"),this.div=n}inject(){const t=this.canvas.parentNode;if(!t)throw new Error("Canvas not inserted into document.");return t.insertBefore(this.div,this.canvas)}unject(){return this.div.parentNode.removeChild(this.div)}getTypes(){return Object.keys(this.classes)}make(t,e){return new this.classes[t](this.div,e)}}const au=[];let hAt=0;const $f={},kE=()=>({id:hAt++,type:null,props:null,children:null,rendered:null,instance:null}),UE=function(s){return s*=2,s=Math.max(0,au.length-s),mAt(0,s,!1).map(t=>au.push(kE()))},lu=function(s,t,e){const n=au.length?au.pop():kE();return n.type=s??"div",n.props=t??null,n.children=e??null,n},iy=function(s){if(!s.type)return;const{children:t}=s;if(s.type=s.props=s.children=s.instance=null,au.push(s),t!=null)for(const e of Array.from(t))iy(e)},hl=function(s,t,e,n,i){if(s!=null){if(t==null)return fl(s,n,i);{let r;if(s instanceof Node){if(r=s===t,r)return}else r=typeof s==typeof t&&t!==null&&s!==null&&s.type===t.type;if(r){let o,a,l;s.instance=t.instance;const c=s.type!=null&&s.type.isComponentClass?s.type:$f[s.type],h=t!=null?t.props:void 0,f=s.props,d=(t!=null?t.children:void 0)!=null?t!=null?t.children:void 0:null,m=s.children;if(f!=null&&(f.children=m),c!=null){let g=e._COMPONENT_DIRTY;if(h!=null!=(f!=null)&&(g=!0),d!==m&&(g=!0),h!=null&&f!=null){if(!g)for(o in h)Object.prototype.hasOwnProperty.call(f,o)||(g=!0);if(!g)for(o in f)l=f[o],(a=h[o])!==l&&(g=!0)}if(g){let y;const _=t.instance;s.props==null&&(s.props={});for(const M in _.defaultProps){const A=_.defaultProps[M];s.props[M]==null&&(s.props[M]=A)}s.props.children=s.children,typeof _.willReceiveProps=="function"&&_.willReceiveProps(s.props);const v=e._COMPONENT_FORCE||((y=typeof _.shouldUpdate=="function"?_.shouldUpdate(s.props):void 0)!=null?y:!0);if(v){const M=_.getNextState();typeof _.willUpdate=="function"&&_.willUpdate(s.props,M)}const w=_.props,b=_.applyNextState();_.props=s.props,_.children=s.children,v&&(s=s.rendered=typeof _.render=="function"?_.render(lu,s.props,s.children):void 0,hl(s,t.rendered,e,n,i),typeof _.didUpdate=="function"&&_.didUpdate(w,b))}return}else{if(h!=null)for(o in h)Object.prototype.hasOwnProperty.call(f,o)||dAt(e,o,h[o]);if(f!=null)for(o in f)l=f[o],(a=h[o])!==l&&o!=="children"&&NE(e,o,l,a);if(m!=null)if(["string","number"].includes(typeof m))m!==d&&(e.textContent=m);else if(m.type!=null)hl(m,d,e.childNodes[0],e,0);else{let g,y;const{childNodes:_}=e;if(d!=null)for(y=0;y<m.length;y++)g=m[y],hl(g,d[y],_[y],e,y);else for(y=0;y<m.length;y++)g=m[y],hl(g,null,_[y],e,y)}else d!=null&&(Lf(null,e),e.innerHTML="")}return}else return Lf(t.instance,e),e.remove(),fl(s,n,i)}}if(t!=null)return Lf(t.instance,e),t.node.remove()},fl=function(s,t,e){let n;e==null&&(e=0);const i=s.type!=null&&s.type.isComponentClass?s.type:$f[s.type];if(s instanceof Node)n=s;else{if(i!=null){let o;const a=s.type!=null&&s.type.isComponentClass?s.type:$f[s.type];if(!a)return s=s.rendered=lu("noscript"),n=fl(s,t,e),n;s.instance=o=new a(t),s.props==null&&(s.props={});for(const l in o.defaultProps){const c=o.defaultProps[l];s.props[l]==null&&(s.props[l]=c)}return s.props.children=s.children,o.props=s.props,o.children=s.children,o.setState(typeof o.getInitialState=="function"?o.getInitialState():void 0),typeof o.willMount=="function"&&o.willMount(),s=s.rendered=typeof o.render=="function"?o.render(lu,s.props,s.children):void 0,n=fl(s,t,e),typeof o.didMount=="function"&&o.didMount(s),n._COMPONENT=o,n}else if(["string","number"].includes(typeof s))n=document.createTextNode(s);else{n=document.createElement(s.type);for(const o in s.props){const a=s.props[o];NE(n,o,a)}}const{children:r}=s;if(r!=null)if(["string","number"].includes(typeof r))n.textContent=r;else if(r.type!=null)fl(r,n,0);else for(let o=0;o<r.length;o++){const a=r[o];fl(a,n,o)}}return t.insertBefore(n,t.childNodes[e]),n},Lf=function(s,t){if(s){typeof s.willUnmount=="function"&&s.willUnmount();for(const e in s)delete s[e]}return(()=>{const e=[];for(const n of Array.from(t.childNodes))Lf(n._COMPONENT,n),e.push(delete n._COMPONENT);return e})()},fAt=function(s){if(typeof document>"u")return!0;if(document.documentElement.style[s]!=null)return s;s=s[0].toUpperCase()+s.slice(1);const t=["webkit","moz","ms","o"];for(const e of Array.from(t))if(document.documentElement.style[e+s]!=null)return e+s},cu={};for(const s of["transform"])cu[s]=fAt(s);const NE=function(s,t,e,n){if(t==="style"){for(const i in e){const r=e[i];(n!=null?n[i]:void 0)!==r&&(s.style[cu[i]!=null?cu[i]:i]=r)}return}if(s[t]!=null){try{s[t]=e}catch{console.log("failed setting "+t)}return}if(s instanceof Node){s.setAttribute(t,e);return}},dAt=function(s,t,e){if(t==="style"){for(const n in e)s.style[cu[n]!=null?cu[n]:n]="";return}if(s[t]!=null&&(s[t]=void 0),s instanceof Node){s.removeAttribute(t);return}},pAt=function(s){let t;const e={willMount:"componentWillMount",didMount:"componentDidMount",willReceiveProps:"componentWillReceiveProps",shouldUpdate:"shouldComponentUpdate",willUpdate:"componentWillUpdate",didUpdate:"componentDidUpdate",willUnmount:"componentWillUnmount"};for(const i in e){const r=e[i];s[i]==null&&(s[i]=s[r])}class n{constructor(r,o,a=null,l=null){let c,h;o==null&&(o={}),this.props=o,this.state=a,this.children=l;const f=function(m,g){return typeof m=="function"?m.bind(g):m};for(c in s)h=s[c],this[c]=f(h,this);let d=null;this.setState=function(m){d==null&&(d=m?d??{}:null);for(c in m)h=m[c],d[c]=h;r._COMPONENT_DIRTY=!0},this.forceUpdate=function(){r._COMPONENT_FORCE=r._COMPONENT_DIRTY=!0;let m=r;return(()=>{const g=[];for(;m=m.parentNode;)m._COMPONENT?g.push(m._COMPONENT_FORCE=!0):g.push(void 0);return g})()},this.getNextState=()=>d,this.applyNextState=function(){r._COMPONENT_FORCE=r._COMPONENT_DIRTY=!1;const m=this.state;return[d,this.state]=Array.from([null,d]),m}}}return n.isComponentClass=!0,n.prototype.defaultProps=(t=typeof s.getDefaultProps=="function"?s.getDefaultProps():void 0)!=null?t:{},n};function mAt(s,t,e){const n=[],i=s<t,r=e?i?t+1:t-1:t;for(let o=s;i?o<r:o>r;i?o++:o--)n.push(o);return n}const gAt=Object.freeze(Object.defineProperty({__proto__:null,Types:$f,apply:hl,createClass:pAt,element:lu,hint:UE,recycle:iy},Symbol.toStringTag,{value:"Module"}));class FE{constructor(t,e){this.element=t,typeof this.init=="function"&&this.init(e)}dispose(){}}let BE=class extends FE{static initClass(){this.prototype.el=lu,this.prototype.hint=UE,this.prototype.apply=hl,this.prototype.recycle=iy}init(t){return this.last=null}dispose(){return this.unmount(),super.dispose()}mount(){const t=document.createElement("div");return t.classList.add("mathbox-overlay"),this.element.appendChild(t),this.overlay=t}unmount(t){return this.overlay&&this.overlay.parentNode&&this.element.removeChild(this.overlay),this.overlay=null}render(t){this.overlay||this.mount(),["string","number"].includes(typeof t)&&(t=this.el("div",null,t)),t instanceof Array&&(t=this.el("div",null,t)),t==null&&(t=this.el("div"));const e=t.type==="div";let{last:n}=this;const{overlay:i}=this,r=e?i:i.childNodes[0],o=e?i.parentNode:i;!n&&r&&(n=this.el("div")),this.apply(t,n,r,o,0),this.last=t,n!=null&&this.recycle(n)}};BE.initClass();const HE={dom:BE},vAt=Object.freeze(Object.defineProperty({__proto__:null,Classes:HE,Factory:zE,Overlay:FE},Symbol.toStringTag,{value:"Module"}));class bn{static initClass(){this.Node=ru,this.Group=UA,this.model=this.Node,this.defaults=null,this.traits=null,this.props=null,this.finals=null,this.freeform=!1}constructor(t,e,n){this.node=t,this._context=e,this._renderables=this._context.renderables,this._attributes=this._context.attributes,this._shaders=this._context.shaders,this._overlays=this._context.overlays,this._animator=this._context.animator,this._types=this._attributes.types,this.node.controller=this,this.node.on("added",i=>this._added()),this.node.on("removed",i=>this._removed()),this.node.on("change",i=>{if(this._root)return this.change(i.changed,i.touched)}),this.reconfigure(),this._get=this.node.get.bind(this.node),this._helpers=n(this,this.node.traits),this._handlers={inherit:{},listen:[],watch:[],compute:[]},this._root=this._parent=null,this.init()}is(t){return this.traits.hash[t]}init(){}make(){}made(){}unmake(t){}unmade(){}change(t,e,n){}refresh(){return this.change({},{},!0)}rebuild(){if(this._root)return this._removed(!0),this._added()}reconfigure(t){return t!=null&&this.node.configure(t,this._attributes),this.traits=this.node.traits,this.props=this.node.props}_added(){let t,e;this._parent=this.node.parent!=null?this.node.parent.controller:void 0,this._root=this.node.root!=null?this.node.root.controller:void 0,this.node.clock=(e=this._inherit("clock"))!=null?e:this._root;try{try{return this.make(),this.refresh(),this.made()}catch(n){throw t=n,this.node.print("warn"),console.error(t),t}}catch(n){t=n;try{return this._removed()}catch{}}}_removed(t){return t==null&&(t=!1),this.unmake(t),this._unlisten(),this._unattach(),this._uncompute(),this._root=null,this._parent=null,this.unmade(t)}_listen(t,e,n,i){if(i==null&&(i=this),t instanceof Array)for(const r of Array.from(t))return this.__listen(r,e,n,i);return this.__listen(t,e,n,i)}__listen(t,e,n,i){if(i==null&&(i=this),typeof t=="string"&&(t=this._inherit(t)),t!=null){const r=n.bind(i);r.node=this.node,t.on(e,r),this._handlers.listen.push([t,e,r])}return t}_unlisten(){if(this._handlers.listen.length){for(const[t,e,n]of Array.from(this._handlers.listen))t.off(e,n);return this._handlers.listen=[]}}_inherit(t){const e=this._handlers.inherit[t];return e!==void 0?e:this._handlers.inherit[t]=this._parent!=null?this._parent._find(t??null):void 0}_find(t){return this.is(t)?this:this._parent!=null?this._parent._find(t):void 0}_uninherit(){return this._handlers.inherit={}}_attach(t,e,n,i,r,o,a){i==null&&(i=this),r==null&&(r=this),o==null&&(o=!1),a==null&&(a=!1);const l=function(m){if(m!=null&&Array.from(m.traits).includes(e))return m},c=m=>m!=null?m.controller:void 0,h=function(m){if(m==null)return m;let g=[];for(const y of Array.from(m))y instanceof Array?g=g.concat(y):g.push(y);return g},f=m=>{let g,y;if(typeof m=="object"){if(g=m,g!=null&&g._up)return m=a?g._targets:[g[0]],m;if(g instanceof Array)return m=a?h(g.map(f)):f(g[0]),m;if(g instanceof ru)return[g]}else if(typeof m=="string"&&m[0]==="<"){let _,v=0;(_=m.match(/^<([0-9])+$/))&&(v=+_[1]-1),m.match(/^<+$/)&&(v=+m.length-1),y=[];let w=r.node;for(;w;){const{parent:b}=w;if(!b)break;if(w=b.children[w.index-1],!w&&!y.length&&(w=b),g=null,l(w)&&(g=w),g!=null&&v--<=0&&y.push(g),!a&&y.length)return y}if(a&&y.length)return y}else if(typeof m=="string"){const _=n.bind(i);this._handlers.watch.push(_);const v=this._root.watch(m,_);if(a){if(y=v.filter(l),y.length)return y}else if(l(v[0])&&(g=v[0]),g!=null)return[g]}if(!o)throw console.warn(this.node.toMarkup()),new Error(`${this.node.toString()} - Could not find ${e} \`${m}\``);return a?[]:null},d=h(f(t));return a?d!=null?d.map(c):null:d!=null?c(d[0]):null}_unattach(){if(this._handlers.watch.length){for(const t of Array.from(this._handlers.watch))t!=null&&t.unwatch();return this._handlers.watch=[]}}_compute(t,e){return this._handlers.compute.push(t),this.node.bind(t,e,!0)}_uncompute(){if(this._handlers.compute.length){for(const t of Array.from(this._handlers.compute))this.node.unbind(t,!0);return this._handlers.compute=[]}}}bn.initClass();Ss.apply(bn.prototype);class Ei extends bn{static initClass(){this.model=bn.Group,this.traits=["node"]}}Ei.initClass();class VE extends Ei{static initClass(){this.traits=["node","object","entity","visible","active"]}make(){return this._helpers.visible.make(),this._helpers.active.make()}unmake(){return this._helpers.visible.unmake(),this._helpers.active.unmake()}}VE.initClass();class GE extends Ei{static initClass(){this.traits=["node","bind"]}make(){return this._helpers.bind.make([{to:"inherit.source",trait:"node"}])}unmake(){return this._helpers.bind.unmake()}_find(t){return this.bind.source&&Array.from(this.props.traits).includes(t)?this.bind.source._inherit(t):super._find()}}GE.initClass();class qE extends Ei{static initClass(){this.traits=["node","root","clock","scene","vertex","unit"]}init(){return this.size=null,this.cameraEvent={type:"root.camera"},this.preEvent={type:"root.pre"},this.updateEvent={type:"root.update"},this.renderEvent={type:"root.render"},this.postEvent={type:"root.post"},this.clockEvent={type:"clock.tick"},this.camera=null}make(){return this._helpers.unit.make()}unmake(){return this._helpers.unit.unmake()}change(t,e,n){if(t["root.camera"]||n)return this._unattach(),this._attach(this.props.camera,"camera",this.setCamera,this,this,!0),this.setCamera()}adopt(t){return Array.from(t.renders).map(e=>this._context.scene.add(e))}unadopt(t){return Array.from(t.renders).map(e=>this._context.scene.remove(e))}select(t){return this.node.model.select(t)}watch(t,e){return this.node.model.watch(t,e)}unwatch(t){return this.node.model.unwatch(t)}resize(t){return this.size=t,this.trigger({type:"root.resize",size:t})}getSize(){return this.size}getSpeed(){return this.props.speed}getUnit(){return this._helpers.unit.get()}getUnitUniforms(){return this._helpers.unit.uniforms()}pre(){return this.getCamera().updateProjectionMatrix(),this.trigger(this.clockEvent),this.trigger(this.preEvent)}update(){return this.trigger(this.updateEvent)}render(){return this.trigger(this.renderEvent)}post(){return this.trigger(this.postEvent)}setCamera(){const t=_At(this.select(this.props.camera)[0],e=>e.controller);if(this.camera!==t)return this.camera=t,this.trigger({type:"root.camera"})}getCamera(){let t;return(t=this.camera!=null?this.camera.getCamera():void 0)!=null?t:this._context.defaultCamera}getTime(){return this._context.time}vertex(t,e){return e===2?t.pipe("view.position"):e===3?t.pipe("root.position"):t}}qE.initClass();function _At(s,t){return typeof s<"u"&&s!==null?t(s):void 0}class WE extends Ei{static initClass(){this.traits=["node","unit"]}make(){return this._helpers.unit.make()}unmake(){return this._helpers.unit.unmake()}getUnit(){return this._helpers.unit.get()}getUnitUniforms(){return this._helpers.unit.uniforms()}}WE.initClass();const Df=function(s,t){return t===vl?s.REPEAT:t===In?s.CLAMP_TO_EDGE:t===_l?s.MIRRORED_REPEAT:t===Ve?s.NEAREST:t===Qv?s.NEAREST_MIPMAP_NEAREST:t===t_?s.NEAREST_MIPMAP_LINEAR:t===fn?s.LINEAR:t===n_?s.LINEAR_MIPMAP_NEAREST:t===i_?s.LINEAR_MIPMAP_LINEAR:t===ai?s.UNSIGNED_BYTE:t===ad?s.UNSIGNED_SHORT_4_4_4_4:t===ld?s.UNSIGNED_SHORT_5_5_5_1:t===_u?s.BYTE:t===yu?s.SHORT:t===aa?s.UNSIGNED_SHORT:t===Ll?s.INT:t===ls?s.UNSIGNED_INT:t===Cn?s.FLOAT:t===s_?s.ALPHA:t===Vn?s.RGBA:t===cd?s.LUMINANCE:t===ud?s.LUMINANCE_ALPHA:t===$r?s.FUNC_ADD:t===Hv?s.FUNC_SUBTRACT:t===Vv?s.FUNC_REVERSE_SUBTRACT:t===Gv?s.ZERO:t===qv?s.ONE:t===Wv?s.SRC_COLOR:t===$v?s.ONE_MINUS_SRC_COLOR:t===rd?s.SRC_ALPHA:t===od?s.ONE_MINUS_SRC_ALPHA:t===Xv?s.DST_ALPHA:t===jv?s.ONE_MINUS_DST_ALPHA:t===Yv?s.DST_COLOR:t===Zv?s.ONE_MINUS_DST_COLOR:t===Kv?s.SRC_ALPHA_SATURATE:0},$E=function(s){switch(s){case ai:return Uint8Array;case _u:return Int8Array;case yu:return Int16Array;case aa:return Uint16Array;case Ll:return Int32Array;case ls:return Uint32Array;case Cn:return Float32Array}},sy=s=>s.map(t=>["","X","Y","Z"][t]).join(""),Fl=function(){const s=new ca,t=new Pn,e=new N,n=new N,i=new de;return function(r,o,a,l,c,h){return h==null&&(h="XYZ"),o!=null?(h instanceof Array&&(h=sy(h)),s.setFromVector3(o,h),t.setFromEuler(s)):t.set(0,0,0,1),a!=null&&t.multiply(a),r!=null?e.copy(r):e.set(0,0,0),l!=null?n.copy(l):n.set(1,1,1),i.compose(e,t,n),c!=null&&i.multiplyMatrices(i,c),i}},yAt=Object.freeze(Object.defineProperty({__proto__:null,paramToArrayStorage:$E,paramToGL:Df,swizzleToEulerOrder:sy,transformComposer:Fl},Symbol.toStringTag,{value:"Module"}));class XE extends bn{static initClass(){this.traits=["node","camera"]}init(){}make(){const t=this._context.defaultCamera;return this.camera=this.props.proxy?t:t.clone(),this.euler=new ca,this.quat=new Pn}unmake(){}getCamera(){return this.camera}change(t,e,n){if(t["camera.position"]||t["camera.quaternion"]||t["camera.rotation"]||t["camera.lookAt"]||t["camera.up"]||t["camera.fov"]||n){const{position:i,quaternion:r,rotation:o,lookAt:a,up:l,fov:c}=this.props;return i!=null&&this.camera.position.copy(i),(r!=null||o!=null||a!=null)&&(a!=null?this.camera.lookAt(a):this.camera.quaternion.set(0,0,0,1),o!=null&&(this.euler.setFromVector3(o,sy(this.props.eulerOrder)),this.quat.setFromEuler(this.euler),this.camera.quaternion.multiply(this.quat)),r!=null&&this.camera.quaternion.multiply(r)),c!=null&&this.camera.fov!=null&&(this.camera.fov=c),l!=null&&this.camera.up.copy(l),this.camera.updateMatrix()}}}XE.initClass();const ta=function(s){const t=[];let e=s;for(;typeof e!="string"&&(e!=null?e.length:void 0)!=null;)t.push(e.length),e=e[0];return t},oo=function(s,t){let e;t==null&&(t={});const{items:n,channels:i,width:r,height:o,depth:a}=t,l={};if(!s||!s.length)return{items:n,channels:i,width:r??0,height:o??0,depth:a??0};const c=ta(s),h=c.length;l.channels=i!==1&&c.length>1?c.pop():i,l.items=n!==1&&c.length>1?c.pop():n,l.width=r!==1&&c.length>1?c.pop():r,l.height=o!==1&&c.length>1?c.pop():o,l.depth=a!==1&&c.length>1?c.pop():a;let f=h;i===1&&f++,n===1&&f>1&&f++,r===1&&f>2&&f++,o===1&&f>3&&f++;let d=(e=c.pop())!=null?e:1;return f<=1&&(d/=l.channels!=null?l.channels:1),f<=2&&(d/=l.items!=null?l.items:1),f<=3&&(d/=l.width!=null?l.width:1),f<=4&&(d/=l.height!=null?l.height:1),d=Math.floor(d),l.width==null&&(l.width=d,d=1),l.height==null&&(l.height=d,d=1),l.depth==null&&(l.depth=d,d=1),l},Pu=function(s,t){switch(t){case 0:return()=>!0;case 1:return()=>s();case 2:return function(){return s(),s()};case 3:return function(){return s(),s(),s(),s()};case 4:return function(){return s(),s(),s(),s()};case 6:return function(){return s(),s(),s(),s(),s(),s()};case 8:return function(){return s(),s(),s(),s(),s(),s()}}},jE=function(s,t,e){let n;const i=(()=>{switch(e){case 0:return()=>!0;case 1:return o=>o(s());case 2:return o=>o(s(),s());case 3:return o=>o(s(),s(),s());case 4:return o=>o(s(),s(),s(),s());case 6:return o=>o(s(),s(),s(),s(),s(),s());case 8:return o=>o(s(),s(),s(),s(),s(),s(),s(),s())}})();let r=null;for(;t>0;){const o=Math.min(t,8);n=(()=>{switch(o){case 1:return a=>i(a);case 2:return function(a){return i(a),i(a)};case 3:return function(a){return i(a),i(a),i(a)};case 4:return function(a){return i(a),i(a),i(a),i(a)};case 5:return function(a){return i(a),i(a),i(a),i(a),i(a)};case 6:return function(a){return i(a),i(a),i(a),i(a),i(a),i(a)};case 7:return function(a){return i(a),i(a),i(a),i(a),i(a),i(a),i(a)};case 8:return function(a){return i(a),i(a),i(a),i(a),i(a),i(a),i(a),i(a)}}})(),r!=null?r=((a,l)=>function(c){return a(c),l(c)})(n,r):r=n,t-=o}return n=r??(()=>!0),n.reset=s.reset,n.rebind=s.rebind,n},Xf=function(s){let t,e,n,i,r,o=ta(s);const a=o.length;let l=o.pop(),c=o.pop(),h=o.pop();const f=o.pop();let d,m,g,y,_;switch(a){case 0:t=()=>0,t.reset=function(){};break;case 1:d=0,t=()=>s[d++],t.reset=()=>d=0;break;case 2:d=e=0,m=s[e]!=null?s[e]:[],t=function(){const v=m[d++];return d===l&&(d=0,e++,m=s[e]!=null?s[e]:[]),v},t.reset=function(){d=e=0,m=s[e]!=null?s[e]:[]};break;case 3:d=e=n=0,g=s[n]!=null?s[n]:[],m=g[e]!=null?g[e]:[],t=function(){const v=m[d++];return d===l&&(d=0,e++,e===c&&(e=0,n++,g=s[n]!=null?s[n]:[]),m=g[e]!=null?g[e]:[]),v},t.reset=function(){d=e=n=0,g=s[n]!=null?s[n]:[],m=g[e]!=null?g[e]:[]};break;case 4:d=e=n=i=0,y=s[i]!=null?s[i]:[],g=y[n]!=null?y[n]:[],m=g[e]!=null?g[e]:[],t=function(){const v=m[d++];return d===l&&(d=0,e++,e===c&&(e=0,n++,n===h&&(n=0,i++,y=s[i]!=null?s[i]:[]),g=y[n]!=null?y[n]:[]),m=g[e]!=null?g[e]:[]),v},t.reset=function(){d=e=n=i=0,y=s[i]!=null?s[i]:[],g=y[n]!=null?y[n]:[],m=g[e]!=null?g[e]:[]};break;case 5:d=e=n=i=r=0,_=s[r]!=null?s[r]:[],y=_[i]!=null?_[i]:[],g=y[n]!=null?y[n]:[],m=g[e]!=null?g[e]:[],t=function(){const v=m[d++];return d===l&&(d=0,e++,e===c&&(e=0,n++,n===h&&(n=0,i++,i===f&&(i=0,r++,_=s[r]!=null?s[r]:[]),y=_[i]!=null?_[i]:[]),g=y[n]!=null?y[n]:[]),m=g[e]!=null?g[e]:[]),v},t.reset=function(){d=e=n=i=r=0,_=s[r]!=null?s[r]:[],y=_[i]!=null?_[i]:[],g=y[n]!=null?y[n]:[],m=g[e]!=null?g[e]:[]};break}return t.rebind=function(v){if(s=v,o=ta(s),o.length&&(l=o.pop()),o.length&&(c=o.pop()),o.length&&(h=o.pop()),o.length)return v=o.pop()},t},ry=function(s,t,e,n){let i,r,o=i=r=0;const a=function(){return o=t*e*n,i=r=0},l=()=>r,c=()=>o-i<=0,h=(()=>{switch(e){case 1:return function(m){i+=m,r+=m};case 2:return function(m){i+=m*2,r+=m};case 3:return function(m){i+=m*3,r+=m};case 4:return function(m){i+=m*4,r+=m}}})(),f=(()=>{switch(e){case 1:return function(m){m(s[i++]),++r};case 2:return function(m){m(s[i++],s[i++]),++r};case 3:return function(m){m(s[i++],s[i++],s[i++]),++r};case 4:return function(m){m(s[i++],s[i++],s[i++],s[i++]),++r}}})(),d=(()=>{switch(e){case 1:return function(m){s[i++]=m,++r};case 2:return function(m,g){s[i++]=m,s[i++]=g,++r};case 3:return function(m,g,y){s[i++]=m,s[i++]=g,s[i++]=y,++r};case 4:return function(m,g,y,_){s[i++]=m,s[i++]=g,s[i++]=y,s[i++]=_,++r}}})();return f.reset=a,d.reset=a,a(),{emit:d,consume:f,skip:h,count:l,done:c,reset:a}},YE=function(s,t){let e,n,i,r,o;const a=new Float32Array(4096);let l=n=.5,c=i=r=o=0;const h=function(m,g,y,_){return r++,a[c++]=m*l,a[c++]=g*l,a[c++]=y*l,a[c++]=_*l},f=function(m,g,y,_){return o++,a[i++]+=m*n,a[i++]+=g*n,a[i++]+=y*n,a[i++]+=_*n},d=Math.max(s.length,t.length);return d<=3?e=function(m,g,y){c=i=r=o=0,s(h,g,y),t(f,g,y);const _=Math.min(r,o);let v=0;return h1(0,_,!1).map(w=>m(a[v++],a[v++],a[v++],a[v++]))}:d<=5?e=function(m,g,y,_,v){c=i=r=o=0,s(h,g,y,_,v),t(f,g,y,_,v);const w=Math.min(r,o);let b=0;return h1(0,w,!1).map(M=>m(a[b++],a[b++],a[b++],a[b++]))}:d<=7?e=function(m,g,y,_,v,w,b){c=i=r=o=0,s(h,g,y,_,v,w,b),t(f,g,y,_,v,w,b);const M=Math.min(r,o);let A=0;return(()=>{let T,P;const C=[];for(b=0,P=M,T=0<=P;T?b<P:b>P;T?b++:b--)C.push(m(a[A++],a[A++],a[A++],a[A++]));return C})()}:d<=9?e=function(m,g,y,_,v,w,b,M,A){c=i=r=o=0,s(h,g,y,_,v,w,b,M,A),t(f,g,y,_,v,w,b,M,A);const T=Math.min(r,o);return A=0,(()=>{let P,C;const S=[];for(M=0,C=T,P=0<=C;P?M<C:M>C;P?M++:M--)S.push(m(a[A++],a[A++],a[A++],a[A++]));return S})()}:e=function(m,g,y,_,v,w,b,M,A,T,P){c=i=0,s(h,g,y,_,v,w,b,M,A,T,P),t(f,g,y,_,v,w,b,M,A,T,P);const C=Math.min(r,o);return A=0,(()=>{let S,L;const H=[];for(M=0,L=C,S=0<=L;S?M<L:M>L;S?M++:M--)H.push(m(a[A++],a[A++],a[A++],a[A++]));return H})()},e.lerp=function(m){let g;return[l,n]=Array.from(g=[1-m,m]),g},e},ZE=function(s,t){const e=ta(s).reduce((l,c)=>l*c),n=ta(t).reduce((l,c)=>l*c),i=Math.min(e,n),r=Xf(s),o=Xf(t),a=new Float32Array(i);return a.lerp=function(l){r.reset(),o.reset();let c=0;return(()=>{const h=[];for(;c<i;){const f=r(),d=o();h.push(a[c++]=f+(d-f)*l)}return h})()},a};function h1(s,t,e){const n=[],i=s<t,r=e?i?t+1:t-1:t;for(let o=s;i?o<r:o>r;i?o++:o--)n.push(o);return n}const xAt=Object.freeze(Object.defineProperty({__proto__:null,getDimensions:oo,getLerpEmitter:YE,getLerpThunk:ZE,getSizes:ta,getStreamer:ry,getThunk:Xf,makeEmitter:jE,repeatCall:Pu},Symbol.toStringTag,{value:"Module"})),f1="xyzw".split(""),oy={0:-1,x:0,y:1,z:2,w:3},ay=function(s){return s===""+s&&(s=s.split("")),s===+s&&(s=[s]),s},Tl=function(s){return s===+s&&(s="vec"+s),s==="vec1"&&(s="float"),s},KE=function(s){if(s=""+s,s.indexOf(".")<0)return s+=".0"},JE=function(s){s==null&&(s=4);const t=KE(s);return`vec4 float2ByteIndex(vec4 xyzw, out float channelIndex) {
  float relative = xyzw.w / ${t};
  float w = floor(relative);
  channelIndex = (relative - w) * ${t};
  return vec4(xyzw.xyz, w);
}`},QE=function(s){const t=function(n,i){let r;if(n===i)r=`return texture2D(dataTextures[${n}], uv);`;else{const o=Math.ceil(n+(i-n)/2);r=`if (z < ${o-.5}) {
  ${t(n,o-1)}
}
else {
  ${t(o,i)}
}`}return r=r.replace(/\n/g,`
  `)},e=t(0,s-1);return`uniform sampler2D dataTextures[${s}];

vec4 sample2DArray(vec2 uv, float z) {
  ${e}
}`},Hi=function(s,t,e){return s=Tl(s),e!=null?`${s} binaryOperator(${s} a) {
  return a ${t} ${e};
}`:`${s} binaryOperator(${s} a, ${s} b) {
  return a ${t} b;
}`},ea=function(s,t,e){if(e==null&&(e=0),s>t)return ao(s,t);const n=t-s;s=Tl(s),t=Tl(t),e=KE(e);const r=bAt(0,n,!0).map(function(o){return o?e:"v"}).join(",");return`${t} extendVec(${s} v) { return ${t}(${r}); }`},ao=function(s,t){if(s<t)return ea(s,t);const e="."+"xyzw".substr(0,t);return s=Tl(s),t=Tl(t),`${t} truncateVec(${s} v) { return v${e}; }`},ly=function(s){const t=["0.0","0.0","0.0","0.0"];s=ay(s),s=s.map(function(i){return i===""+i?oy[i]:i});for(let i=0;i<s.length;i++){const r=s[i];t[r]=["a","b","c","d"][i]}const e=t.slice(0,4).join(", ");return`vec4 inject(${["float a","float b","float c","float d"].slice(0,s.length)}) {
  return vec4(${e});
}`},yi=function(s,t=null){const e=["0.0","xyzw.x","xyzw.y","xyzw.z","xyzw.w"];for(t==null&&(t=s.length),s=ay(s),s=s.map(function(i){return Array.from([0,1,2,3,4]).includes(+i)&&(i=+i),i===""+i&&(i=oy[i]+1),e[i]});s.length<t;)s.push("0.0");const n=s.join(", ");return`vec${t} swizzle(vec4 xyzw) {
  return vec${t}(${n});
}`.replace(/vec1/g,"float")},Kd=function(s){const t=["0.0","0.0","0.0","0.0"];s=ay(s),s=s.map(function(n){return n===+n?f1[n-1]:n});for(let n=0;n<s.length;n++){const i=s[n],r=f1[n],o=oy[i];t[o]=`xyzw.${r}`}return`vec4 invertSwizzle(vec4 xyzw) {
  return vec4(${t.join(", ")});
}`},Ws=function(s){let t=[].slice.call(arguments);return t.length>1?(t=t.map((e,n)=>["inout",e,String.fromCharCode(97+n)].join(" ")),t=t.join(", "),`void identity(${t}) { }`):`${s} identity(${s} x) {
  return x;
}`},vv=(s,t)=>`${s} constant() {
return ${t};
}`;function bAt(s,t,e){const n=[],i=s<t,r=e?i?t+1:t-1:t;for(let o=s;i?o<r:o>r;i?o++:o--)n.push(o);return n}const wAt=Object.freeze(Object.defineProperty({__proto__:null,binaryOperator:Hi,constant:vv,extendVec:ea,identity:Ws,injectVec4:ly,invertSwizzleVec4:Kd,mapByte2FloatOffset:JE,sample2DArray:QE,swizzleVec4:yi,toType:Tl,truncateVec:ao},Symbol.toStringTag,{value:"Module"}));class Jd extends bn{static initClass(){this.traits=["node","source","index"]}made(){return this.trigger({type:"source.rebuild"})}indexShader(t){return t.pipe(Ws("vec4"))}sourceShader(t){return t.pipe(Ws("vec4"))}getDimensions(){return{items:1,width:1,height:1,depth:1}}getActiveDimensions(){return this.getDimensions()}getIndexDimensions(){return this.getActiveDimensions()}getFutureDimensions(){return this.getActiveDimensions()}}Jd.initClass();let tT=class extends Jd{static initClass(){this.traits=["node","data","source","index","entity","active"]}init(){return this.dataEmitter=null,this.dataSizes=null}emitter(t,e){let n;const{data:i,bind:r,expr:o}=this.props;if(i!=null){const a=this.dataSizes,l=ta(i);if(!a||a.length!==l.length){const c=Xf(i);this.dataEmitter=this.callback(jE(c,e,t)),this.dataSizes=l}n=this.dataEmitter}else o!=null?n=this.callback(o):n=this.callback(this.passthrough);return n}callback(t){return t??function(){}}update(){}make(){return this._helpers.active.make(),this.first=!0,this._listen("root","root.update",()=>((this.isActive||this.first)&&this.update(),this.first=!1))}unmake(){return this._helpers.active.unmake(),this.dataEmitter=null,this.dataSizes=null}};tT.initClass();let Ru=class extends tT{static initClass(){this.traits=["node","buffer","active","data","source","index","texture"]}init(){this.bufferSlack=0,this.bufferFrames=0,this.bufferTime=0,this.bufferDelta=0,this.bufferClock=0,this.bufferStep=0,super.init()}make(){super.make(),this.clockParent=this._inherit("clock"),this.latchParent=this._inherit("latch")}unmake(){return super.unmake()}rawBuffer(){return this.buffer}emitter(){const{channels:t,items:e}=this.props;return super.emitter(t,e)}change(t,e,n){if(t["buffer.fps"]||n){const{fps:i}=this.props;return this.bufferSlack=i?.5/i:0}}syncBuffer(t){let e,n;if(!this.buffer)return;const{live:i,fps:r,hurry:o,limit:a,realtime:l,observe:c}=this.props,h=this.buffer.getFilled();if(h&&!i||this.latchParent&&!this.latchParent.isDirty)return;const f=this.clockParent.getTime();if(r!=null){const d=this.bufferSlack,m=f.step/f.delta;e=l?f.delta:f.step;const g=1/r;n=l&&c?m*g:g,Math.abs(f.time-this.bufferTime)>f.step*a&&(this.bufferTime=f.time,this.bufferClock=f.clock),this.bufferSlack=Math.min(a/r,d+e),this.bufferDelta=e,this.bufferStep=n;let y=Math.min(o,Math.floor(d*r));h||(y=Math.max(1,y));let _=!1;const v=()=>_=!0;return(()=>{const w=[];for(let b=0,M=y,A=0<=M;(A?b<M:b>M)&&(this.bufferTime+=e,this.bufferClock+=n,!_);A?b++:b--)t(v,this.bufferFrames++,b,y),w.push(this.bufferSlack-=g);return w})()}else return this.bufferTime=f.time,this.bufferDelta=f.delta,this.bufferClock=f.clock,this.bufferStep=f.step,t(function(){},this.bufferFrames++,0,1)}alignShader(t,e){const{minFilter:n,magFilter:i,aligned:r}=this.props,o=t.items>1&&t.width>1||t.height>1&&t.depth>1;return r||!o?void 0:(n===this.node.attributes["texture.minFilter"].enum.nearest&&i===this.node.attributes["texture.magFilter"].enum.nearest||console.warn(`${this.node.toString()} - Cannot use linear min/magFilter with 3D/4D sampling`),e.pipe("map.xyzw.align"))}};Ru.initClass();class cy extends Ru{static initClass(){this.traits=["node","buffer","active","data","source","index","array","texture","raw"]}init(){return this.buffer=this.spec=null,this.space={width:0,history:0},this.used={width:0},this.storage="arrayBuffer",this.passthrough=(t,e)=>t(e,0,0,0),super.init()}sourceShader(t){const e=this.getDimensions();return this.alignShader(e,t),this.buffer.shader(t)}getDimensions(){return{items:this.items,width:this.space.width,height:this.space.history,depth:1}}getActiveDimensions(){return{items:this.items,width:this.used.width,height:this.buffer.getFilled(),depth:1}}getFutureDimensions(){return{items:this.items,width:this.used.width,height:this.space.history,depth:1}}getRawDimensions(){return{items:this.items,width:this.space.width,height:1,depth:1}}make(){super.make();const t=this.minFilter!=null?this.minFilter:this.props.minFilter,e=this.magFilter!=null?this.magFilter:this.props.magFilter,n=this.type!=null?this.type:this.props.type,{width:i}=this.props,{history:r}=this.props,o=this.props.bufferWidth,{channels:a}=this.props,{items:l}=this.props;let c=this.spec={channels:a,items:l,width:i};this.items=c.items,this.channels=c.channels;const{data:h}=this.props;c=oo(h,c);const{space:f}=this;return f.width=Math.max(o,c.width||1),f.history=r,this.buffer=this._renderables.make(this.storage,{width:f.width,history:f.history,channels:a,items:l,minFilter:t,magFilter:e,type:n})}unmake(){if(super.unmake(),this.buffer)return this.buffer.dispose(),this.buffer=this.spec=null}change(t,e,n){if(e.texture||t["history.history"]||t["buffer.channels"]||t["buffer.items"]||t["array.bufferWidth"])return this.rebuild();if(this.buffer){if(t["array.width"]){const{width:i,bufferWidth:r}=this.props;if(this.spec.width=i,i>r)return this.rebuild()}if(t["data.map"]||t["data.data"]||t["data.resolve"]||t["data.expr"]||n)return this.buffer.setCallback(this.emitter())}}callback(t){return t.length<=2?t:(e,n)=>t(e,n,this.bufferClock,this.bufferStep)}update(){if(!this.buffer)return;const{data:t}=this.props;let{width:e}=this.props;const{space:n,used:i}=this,r=i.width,o=this.buffer.getFilled();if(this.syncBuffer(a=>{if(t!=null){const l=oo(t,this.spec);return l.width>n.width?(a(),this.rebuild()):(i.width=l.width,this.buffer.setActive(i.width),typeof this.buffer.callback.rebind=="function"&&this.buffer.callback.rebind(t),this.buffer.update())}else return e=this.spec.width||1,this.buffer.setActive(e),e=this.buffer.update(),i.width=e}),i.width!==r||o!==this.buffer.getFilled())return this.trigger({type:"source.resize"})}}cy.initClass();class eT extends cy{static initClass(){this.traits=["node","buffer","active","data","source","index","texture","array","span","interval","sampler","raw"]}updateSpan(){let t;const e=this.props.axis;let{width:n}=this.props;const{centered:i}=this.props,r=this.props.padding,o=this._helpers.span.get("",e);n+=r*2,this.a=o.x;const a=o.y-o.x;return i?(t=1/Math.max(1,n),this.a+=a*t/2):t=1/Math.max(1,n-1),this.b=a*t,this.a+=r*this.b}callback(t){return this.updateSpan(),this.last===t?this._callback:(this.last=t,t.length<=3?this._callback=(e,n)=>{const i=this.a+this.b*n;return t(e,i,n)}:this._callback=(e,n)=>{const i=this.a+this.b*n;return t(e,i,n,this.bufferClock,this.bufferStep)})}make(){return super.make(),this._helpers.span.make(),this._listen(this,"span.range",this.updateSpan)}unmake(){return super.unmake(),this._helpers.span.unmake()}change(t,e,n){super.change(t,e,n),e.span&&this.updateSpan()}}eT.initClass();function MAt(){this.__data__=[],this.size=0}var SAt=MAt;function AAt(s,t){return s===t||s!==s&&t!==t}var uy=AAt,EAt=uy;function TAt(s,t){for(var e=s.length;e--;)if(EAt(s[e][0],t))return e;return-1}var Qd=TAt,CAt=Qd,PAt=Array.prototype,RAt=PAt.splice;function LAt(s){var t=this.__data__,e=CAt(t,s);if(e<0)return!1;var n=t.length-1;return e==n?t.pop():RAt.call(t,e,1),--this.size,!0}var DAt=LAt,IAt=Qd;function OAt(s){var t=this.__data__,e=IAt(t,s);return e<0?void 0:t[e][1]}var zAt=OAt,kAt=Qd;function UAt(s){return kAt(this.__data__,s)>-1}var NAt=UAt,FAt=Qd;function BAt(s,t){var e=this.__data__,n=FAt(e,s);return n<0?(++this.size,e.push([s,t])):e[n][1]=t,this}var HAt=BAt,VAt=SAt,GAt=DAt,qAt=zAt,WAt=NAt,$At=HAt;function Bl(s){var t=-1,e=s==null?0:s.length;for(this.clear();++t<e;){var n=s[t];this.set(n[0],n[1])}}Bl.prototype.clear=VAt;Bl.prototype.delete=GAt;Bl.prototype.get=qAt;Bl.prototype.has=WAt;Bl.prototype.set=$At;var tp=Bl,XAt=tp;function jAt(){this.__data__=new XAt,this.size=0}var YAt=jAt;function ZAt(s){var t=this.__data__,e=t.delete(s);return this.size=t.size,e}var KAt=ZAt;function JAt(s){return this.__data__.get(s)}var QAt=JAt;function tEt(s){return this.__data__.has(s)}var eEt=tEt,nEt=typeof te=="object"&&te&&te.Object===Object&&te,nT=nEt,iEt=nT,sEt=typeof self=="object"&&self&&self.Object===Object&&self,rEt=iEt||sEt||Function("return this")(),Zs=rEt,oEt=Zs,aEt=oEt.Symbol,ep=aEt,d1=ep,iT=Object.prototype,lEt=iT.hasOwnProperty,cEt=iT.toString,Ac=d1?d1.toStringTag:void 0;function uEt(s){var t=lEt.call(s,Ac),e=s[Ac];try{s[Ac]=void 0;var n=!0}catch{}var i=cEt.call(s);return n&&(t?s[Ac]=e:delete s[Ac]),i}var hEt=uEt,fEt=Object.prototype,dEt=fEt.toString;function pEt(s){return dEt.call(s)}var mEt=pEt,p1=ep,gEt=hEt,vEt=mEt,_Et="[object Null]",yEt="[object Undefined]",m1=p1?p1.toStringTag:void 0;function xEt(s){return s==null?s===void 0?yEt:_Et:m1&&m1 in Object(s)?gEt(s):vEt(s)}var np=xEt;function bEt(s){var t=typeof s;return s!=null&&(t=="object"||t=="function")}var Lu=bEt,wEt=np,MEt=Lu,SEt="[object AsyncFunction]",AEt="[object Function]",EEt="[object GeneratorFunction]",TEt="[object Proxy]";function CEt(s){if(!MEt(s))return!1;var t=wEt(s);return t==AEt||t==EEt||t==SEt||t==TEt}var sT=CEt,PEt=Zs,REt=PEt["__core-js_shared__"],LEt=REt,dg=LEt,g1=function(){var s=/[^.]+$/.exec(dg&&dg.keys&&dg.keys.IE_PROTO||"");return s?"Symbol(src)_1."+s:""}();function DEt(s){return!!g1&&g1 in s}var IEt=DEt,OEt=Function.prototype,zEt=OEt.toString;function kEt(s){if(s!=null){try{return zEt.call(s)}catch{}try{return s+""}catch{}}return""}var rT=kEt,UEt=sT,NEt=IEt,FEt=Lu,BEt=rT,HEt=/[\\^$.*+?()[\]{}|]/g,VEt=/^\[object .+?Constructor\]$/,GEt=Function.prototype,qEt=Object.prototype,WEt=GEt.toString,$Et=qEt.hasOwnProperty,XEt=RegExp("^"+WEt.call($Et).replace(HEt,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$");function jEt(s){if(!FEt(s)||NEt(s))return!1;var t=UEt(s)?XEt:VEt;return t.test(BEt(s))}var YEt=jEt;function ZEt(s,t){return s==null?void 0:s[t]}var KEt=ZEt,JEt=YEt,QEt=KEt;function tTt(s,t){var e=QEt(s,t);return JEt(e)?e:void 0}var ga=tTt,eTt=ga,nTt=Zs,iTt=eTt(nTt,"Map"),hy=iTt,sTt=ga,rTt=sTt(Object,"create"),ip=rTt,v1=ip;function oTt(){this.__data__=v1?v1(null):{},this.size=0}var aTt=oTt;function lTt(s){var t=this.has(s)&&delete this.__data__[s];return this.size-=t?1:0,t}var cTt=lTt,uTt=ip,hTt="__lodash_hash_undefined__",fTt=Object.prototype,dTt=fTt.hasOwnProperty;function pTt(s){var t=this.__data__;if(uTt){var e=t[s];return e===hTt?void 0:e}return dTt.call(t,s)?t[s]:void 0}var mTt=pTt,gTt=ip,vTt=Object.prototype,_Tt=vTt.hasOwnProperty;function yTt(s){var t=this.__data__;return gTt?t[s]!==void 0:_Tt.call(t,s)}var xTt=yTt,bTt=ip,wTt="__lodash_hash_undefined__";function MTt(s,t){var e=this.__data__;return this.size+=this.has(s)?0:1,e[s]=bTt&&t===void 0?wTt:t,this}var STt=MTt,ATt=aTt,ETt=cTt,TTt=mTt,CTt=xTt,PTt=STt;function Hl(s){var t=-1,e=s==null?0:s.length;for(this.clear();++t<e;){var n=s[t];this.set(n[0],n[1])}}Hl.prototype.clear=ATt;Hl.prototype.delete=ETt;Hl.prototype.get=TTt;Hl.prototype.has=CTt;Hl.prototype.set=PTt;var RTt=Hl,_1=RTt,LTt=tp,DTt=hy;function ITt(){this.size=0,this.__data__={hash:new _1,map:new(DTt||LTt),string:new _1}}var OTt=ITt;function zTt(s){var t=typeof s;return t=="string"||t=="number"||t=="symbol"||t=="boolean"?s!=="__proto__":s===null}var kTt=zTt,UTt=kTt;function NTt(s,t){var e=s.__data__;return UTt(t)?e[typeof t=="string"?"string":"hash"]:e.map}var sp=NTt,FTt=sp;function BTt(s){var t=FTt(this,s).delete(s);return this.size-=t?1:0,t}var HTt=BTt,VTt=sp;function GTt(s){return VTt(this,s).get(s)}var qTt=GTt,WTt=sp;function $Tt(s){return WTt(this,s).has(s)}var XTt=$Tt,jTt=sp;function YTt(s,t){var e=jTt(this,s),n=e.size;return e.set(s,t),this.size+=e.size==n?0:1,this}var ZTt=YTt,KTt=OTt,JTt=HTt,QTt=qTt,tCt=XTt,eCt=ZTt;function Vl(s){var t=-1,e=s==null?0:s.length;for(this.clear();++t<e;){var n=s[t];this.set(n[0],n[1])}}Vl.prototype.clear=KTt;Vl.prototype.delete=JTt;Vl.prototype.get=QTt;Vl.prototype.has=tCt;Vl.prototype.set=eCt;var oT=Vl,nCt=tp,iCt=hy,sCt=oT,rCt=200;function oCt(s,t){var e=this.__data__;if(e instanceof nCt){var n=e.__data__;if(!iCt||n.length<rCt-1)return n.push([s,t]),this.size=++e.size,this;e=this.__data__=new sCt(n)}return e.set(s,t),this.size=e.size,this}var aCt=oCt,lCt=tp,cCt=YAt,uCt=KAt,hCt=QAt,fCt=eEt,dCt=aCt;function Gl(s){var t=this.__data__=new lCt(s);this.size=t.size}Gl.prototype.clear=cCt;Gl.prototype.delete=uCt;Gl.prototype.get=hCt;Gl.prototype.has=fCt;Gl.prototype.set=dCt;var aT=Gl;function pCt(s,t){for(var e=-1,n=s==null?0:s.length;++e<n&&t(s[e],e,s)!==!1;);return s}var mCt=pCt,gCt=ga,vCt=function(){try{var s=gCt(Object,"defineProperty");return s({},"",{}),s}catch{}}(),_Ct=vCt,y1=_Ct;function yCt(s,t,e){t=="__proto__"&&y1?y1(s,t,{configurable:!0,enumerable:!0,value:e,writable:!0}):s[t]=e}var lT=yCt,xCt=lT,bCt=uy,wCt=Object.prototype,MCt=wCt.hasOwnProperty;function SCt(s,t,e){var n=s[t];(!(MCt.call(s,t)&&bCt(n,e))||e===void 0&&!(t in s))&&xCt(s,t,e)}var cT=SCt,ACt=cT,ECt=lT;function TCt(s,t,e,n){var i=!e;e||(e={});for(var r=-1,o=t.length;++r<o;){var a=t[r],l=n?n(e[a],s[a],a,e,s):void 0;l===void 0&&(l=s[a]),i?ECt(e,a,l):ACt(e,a,l)}return e}var rp=TCt;function CCt(s,t){for(var e=-1,n=Array(s);++e<s;)n[e]=t(e);return n}var PCt=CCt;function RCt(s){return s!=null&&typeof s=="object"}var ql=RCt,LCt=np,DCt=ql,ICt="[object Arguments]";function OCt(s){return DCt(s)&&LCt(s)==ICt}var zCt=OCt,x1=zCt,kCt=ql,uT=Object.prototype,UCt=uT.hasOwnProperty,NCt=uT.propertyIsEnumerable,FCt=x1(function(){return arguments}())?x1:function(s){return kCt(s)&&UCt.call(s,"callee")&&!NCt.call(s,"callee")},BCt=FCt,HCt=Array.isArray,op=HCt,jf={exports:{}};function VCt(){return!1}var GCt=VCt;jf.exports;(function(s,t){var e=Zs,n=GCt,i=t&&!t.nodeType&&t,r=i&&!0&&s&&!s.nodeType&&s,o=r&&r.exports===i,a=o?e.Buffer:void 0,l=a?a.isBuffer:void 0,c=l||n;s.exports=c})(jf,jf.exports);var fy=jf.exports,qCt=9007199254740991,WCt=/^(?:0|[1-9]\d*)$/;function $Ct(s,t){var e=typeof s;return t=t??qCt,!!t&&(e=="number"||e!="symbol"&&WCt.test(s))&&s>-1&&s%1==0&&s<t}var XCt=$Ct,jCt=9007199254740991;function YCt(s){return typeof s=="number"&&s>-1&&s%1==0&&s<=jCt}var hT=YCt,ZCt=np,KCt=hT,JCt=ql,QCt="[object Arguments]",t2t="[object Array]",e2t="[object Boolean]",n2t="[object Date]",i2t="[object Error]",s2t="[object Function]",r2t="[object Map]",o2t="[object Number]",a2t="[object Object]",l2t="[object RegExp]",c2t="[object Set]",u2t="[object String]",h2t="[object WeakMap]",f2t="[object ArrayBuffer]",d2t="[object DataView]",p2t="[object Float32Array]",m2t="[object Float64Array]",g2t="[object Int8Array]",v2t="[object Int16Array]",_2t="[object Int32Array]",y2t="[object Uint8Array]",x2t="[object Uint8ClampedArray]",b2t="[object Uint16Array]",w2t="[object Uint32Array]",en={};en[p2t]=en[m2t]=en[g2t]=en[v2t]=en[_2t]=en[y2t]=en[x2t]=en[b2t]=en[w2t]=!0;en[QCt]=en[t2t]=en[f2t]=en[e2t]=en[d2t]=en[n2t]=en[i2t]=en[s2t]=en[r2t]=en[o2t]=en[a2t]=en[l2t]=en[c2t]=en[u2t]=en[h2t]=!1;function M2t(s){return JCt(s)&&KCt(s.length)&&!!en[ZCt(s)]}var S2t=M2t;function A2t(s){return function(t){return s(t)}}var dy=A2t,Yf={exports:{}};Yf.exports;(function(s,t){var e=nT,n=t&&!t.nodeType&&t,i=n&&!0&&s&&!s.nodeType&&s,r=i&&i.exports===n,o=r&&e.process,a=function(){try{var l=i&&i.require&&i.require("util").types;return l||o&&o.binding&&o.binding("util")}catch{}}();s.exports=a})(Yf,Yf.exports);var py=Yf.exports,E2t=S2t,T2t=dy,b1=py,w1=b1&&b1.isTypedArray,C2t=w1?T2t(w1):E2t,fT=C2t,P2t=PCt,R2t=BCt,L2t=op,D2t=fy,I2t=XCt,O2t=fT,z2t=Object.prototype,k2t=z2t.hasOwnProperty;function U2t(s,t){var e=L2t(s),n=!e&&R2t(s),i=!e&&!n&&D2t(s),r=!e&&!n&&!i&&O2t(s),o=e||n||i||r,a=o?P2t(s.length,String):[],l=a.length;for(var c in s)(t||k2t.call(s,c))&&!(o&&(c=="length"||i&&(c=="offset"||c=="parent")||r&&(c=="buffer"||c=="byteLength"||c=="byteOffset")||I2t(c,l)))&&a.push(c);return a}var dT=U2t,N2t=Object.prototype;function F2t(s){var t=s&&s.constructor,e=typeof t=="function"&&t.prototype||N2t;return s===e}var my=F2t;function B2t(s,t){return function(e){return s(t(e))}}var pT=B2t,H2t=pT,V2t=H2t(Object.keys,Object),G2t=V2t,q2t=my,W2t=G2t,$2t=Object.prototype,X2t=$2t.hasOwnProperty;function j2t(s){if(!q2t(s))return W2t(s);var t=[];for(var e in Object(s))X2t.call(s,e)&&e!="constructor"&&t.push(e);return t}var Y2t=j2t,Z2t=sT,K2t=hT;function J2t(s){return s!=null&&K2t(s.length)&&!Z2t(s)}var mT=J2t,Q2t=dT,tPt=Y2t,ePt=mT;function nPt(s){return ePt(s)?Q2t(s):tPt(s)}var gy=nPt,iPt=rp,sPt=gy;function rPt(s,t){return s&&iPt(t,sPt(t),s)}var oPt=rPt;function aPt(s){var t=[];if(s!=null)for(var e in Object(s))t.push(e);return t}var lPt=aPt,cPt=Lu,uPt=my,hPt=lPt,fPt=Object.prototype,dPt=fPt.hasOwnProperty;function pPt(s){if(!cPt(s))return hPt(s);var t=uPt(s),e=[];for(var n in s)n=="constructor"&&(t||!dPt.call(s,n))||e.push(n);return e}var mPt=pPt,gPt=dT,vPt=mPt,_Pt=mT;function yPt(s){return _Pt(s)?gPt(s,!0):vPt(s)}var vy=yPt,xPt=rp,bPt=vy;function wPt(s,t){return s&&xPt(t,bPt(t),s)}var MPt=wPt,Zf={exports:{}};Zf.exports;(function(s,t){var e=Zs,n=t&&!t.nodeType&&t,i=n&&!0&&s&&!s.nodeType&&s,r=i&&i.exports===n,o=r?e.Buffer:void 0,a=o?o.allocUnsafe:void 0;function l(c,h){if(h)return c.slice();var f=c.length,d=a?a(f):new c.constructor(f);return c.copy(d),d}s.exports=l})(Zf,Zf.exports);var SPt=Zf.exports;function APt(s,t){var e=-1,n=s.length;for(t||(t=Array(n));++e<n;)t[e]=s[e];return t}var EPt=APt;function TPt(s,t){for(var e=-1,n=s==null?0:s.length,i=0,r=[];++e<n;){var o=s[e];t(o,e,s)&&(r[i++]=o)}return r}var CPt=TPt;function PPt(){return[]}var gT=PPt,RPt=CPt,LPt=gT,DPt=Object.prototype,IPt=DPt.propertyIsEnumerable,M1=Object.getOwnPropertySymbols,OPt=M1?function(s){return s==null?[]:(s=Object(s),RPt(M1(s),function(t){return IPt.call(s,t)}))}:LPt,_y=OPt,zPt=rp,kPt=_y;function UPt(s,t){return zPt(s,kPt(s),t)}var NPt=UPt;function FPt(s,t){for(var e=-1,n=t.length,i=s.length;++e<n;)s[i+e]=t[e];return s}var vT=FPt,BPt=pT,HPt=BPt(Object.getPrototypeOf,Object),_T=HPt,VPt=vT,GPt=_T,qPt=_y,WPt=gT,$Pt=Object.getOwnPropertySymbols,XPt=$Pt?function(s){for(var t=[];s;)VPt(t,qPt(s)),s=GPt(s);return t}:WPt,yT=XPt,jPt=rp,YPt=yT;function ZPt(s,t){return jPt(s,YPt(s),t)}var KPt=ZPt,JPt=vT,QPt=op;function tRt(s,t,e){var n=t(s);return QPt(s)?n:JPt(n,e(s))}var xT=tRt,eRt=xT,nRt=_y,iRt=gy;function sRt(s){return eRt(s,iRt,nRt)}var bT=sRt,rRt=xT,oRt=yT,aRt=vy;function lRt(s){return rRt(s,aRt,oRt)}var cRt=lRt,uRt=ga,hRt=Zs,fRt=uRt(hRt,"DataView"),dRt=fRt,pRt=ga,mRt=Zs,gRt=pRt(mRt,"Promise"),vRt=gRt,_Rt=ga,yRt=Zs,xRt=_Rt(yRt,"Set"),bRt=xRt,wRt=ga,MRt=Zs,SRt=wRt(MRt,"WeakMap"),ARt=SRt,_v=dRt,yv=hy,xv=vRt,bv=bRt,wv=ARt,wT=np,Wl=rT,S1="[object Map]",ERt="[object Object]",A1="[object Promise]",E1="[object Set]",T1="[object WeakMap]",C1="[object DataView]",TRt=Wl(_v),CRt=Wl(yv),PRt=Wl(xv),RRt=Wl(bv),LRt=Wl(wv),Uo=wT;(_v&&Uo(new _v(new ArrayBuffer(1)))!=C1||yv&&Uo(new yv)!=S1||xv&&Uo(xv.resolve())!=A1||bv&&Uo(new bv)!=E1||wv&&Uo(new wv)!=T1)&&(Uo=function(s){var t=wT(s),e=t==ERt?s.constructor:void 0,n=e?Wl(e):"";if(n)switch(n){case TRt:return C1;case CRt:return S1;case PRt:return A1;case RRt:return E1;case LRt:return T1}return t});var ap=Uo,DRt=Object.prototype,IRt=DRt.hasOwnProperty;function ORt(s){var t=s.length,e=new s.constructor(t);return t&&typeof s[0]=="string"&&IRt.call(s,"index")&&(e.index=s.index,e.input=s.input),e}var zRt=ORt,kRt=Zs,URt=kRt.Uint8Array,MT=URt,P1=MT;function NRt(s){var t=new s.constructor(s.byteLength);return new P1(t).set(new P1(s)),t}var yy=NRt,FRt=yy;function BRt(s,t){var e=t?FRt(s.buffer):s.buffer;return new s.constructor(e,s.byteOffset,s.byteLength)}var HRt=BRt,VRt=/\w*$/;function GRt(s){var t=new s.constructor(s.source,VRt.exec(s));return t.lastIndex=s.lastIndex,t}var qRt=GRt,R1=ep,L1=R1?R1.prototype:void 0,D1=L1?L1.valueOf:void 0;function WRt(s){return D1?Object(D1.call(s)):{}}var $Rt=WRt,XRt=yy;function jRt(s,t){var e=t?XRt(s.buffer):s.buffer;return new s.constructor(e,s.byteOffset,s.length)}var YRt=jRt,ZRt=yy,KRt=HRt,JRt=qRt,QRt=$Rt,tLt=YRt,eLt="[object Boolean]",nLt="[object Date]",iLt="[object Map]",sLt="[object Number]",rLt="[object RegExp]",oLt="[object Set]",aLt="[object String]",lLt="[object Symbol]",cLt="[object ArrayBuffer]",uLt="[object DataView]",hLt="[object Float32Array]",fLt="[object Float64Array]",dLt="[object Int8Array]",pLt="[object Int16Array]",mLt="[object Int32Array]",gLt="[object Uint8Array]",vLt="[object Uint8ClampedArray]",_Lt="[object Uint16Array]",yLt="[object Uint32Array]";function xLt(s,t,e){var n=s.constructor;switch(t){case cLt:return ZRt(s);case eLt:case nLt:return new n(+s);case uLt:return KRt(s,e);case hLt:case fLt:case dLt:case pLt:case mLt:case gLt:case vLt:case _Lt:case yLt:return tLt(s,e);case iLt:return new n;case sLt:case aLt:return new n(s);case rLt:return JRt(s);case oLt:return new n;case lLt:return QRt(s)}}var bLt=xLt,wLt=Lu,I1=Object.create,MLt=function(){function s(){}return function(t){if(!wLt(t))return{};if(I1)return I1(t);s.prototype=t;var e=new s;return s.prototype=void 0,e}}(),SLt=MLt,ALt=SLt,ELt=_T,TLt=my;function CLt(s){return typeof s.constructor=="function"&&!TLt(s)?ALt(ELt(s)):{}}var PLt=CLt,RLt=ap,LLt=ql,DLt="[object Map]";function ILt(s){return LLt(s)&&RLt(s)==DLt}var OLt=ILt,zLt=OLt,kLt=dy,O1=py,z1=O1&&O1.isMap,ULt=z1?kLt(z1):zLt,NLt=ULt,FLt=ap,BLt=ql,HLt="[object Set]";function VLt(s){return BLt(s)&&FLt(s)==HLt}var GLt=VLt,qLt=GLt,WLt=dy,k1=py,U1=k1&&k1.isSet,$Lt=U1?WLt(U1):qLt,XLt=$Lt,jLt=aT,YLt=mCt,ZLt=cT,KLt=oPt,JLt=MPt,QLt=SPt,tDt=EPt,eDt=NPt,nDt=KPt,iDt=bT,sDt=cRt,rDt=ap,oDt=zRt,aDt=bLt,lDt=PLt,cDt=op,uDt=fy,hDt=NLt,fDt=Lu,dDt=XLt,pDt=gy,mDt=vy,gDt=1,vDt=2,_Dt=4,ST="[object Arguments]",yDt="[object Array]",xDt="[object Boolean]",bDt="[object Date]",wDt="[object Error]",AT="[object Function]",MDt="[object GeneratorFunction]",SDt="[object Map]",ADt="[object Number]",ET="[object Object]",EDt="[object RegExp]",TDt="[object Set]",CDt="[object String]",PDt="[object Symbol]",RDt="[object WeakMap]",LDt="[object ArrayBuffer]",DDt="[object DataView]",IDt="[object Float32Array]",ODt="[object Float64Array]",zDt="[object Int8Array]",kDt="[object Int16Array]",UDt="[object Int32Array]",NDt="[object Uint8Array]",FDt="[object Uint8ClampedArray]",BDt="[object Uint16Array]",HDt="[object Uint32Array]",Je={};Je[ST]=Je[yDt]=Je[LDt]=Je[DDt]=Je[xDt]=Je[bDt]=Je[IDt]=Je[ODt]=Je[zDt]=Je[kDt]=Je[UDt]=Je[SDt]=Je[ADt]=Je[ET]=Je[EDt]=Je[TDt]=Je[CDt]=Je[PDt]=Je[NDt]=Je[FDt]=Je[BDt]=Je[HDt]=!0;Je[wDt]=Je[AT]=Je[RDt]=!1;function If(s,t,e,n,i,r){var o,a=t&gDt,l=t&vDt,c=t&_Dt;if(e&&(o=i?e(s,n,i,r):e(s)),o!==void 0)return o;if(!fDt(s))return s;var h=cDt(s);if(h){if(o=oDt(s),!a)return tDt(s,o)}else{var f=rDt(s),d=f==AT||f==MDt;if(uDt(s))return QLt(s,a);if(f==ET||f==ST||d&&!i){if(o=l||d?{}:lDt(s),!a)return l?nDt(s,JLt(o,s)):eDt(s,KLt(o,s))}else{if(!Je[f])return i?s:{};o=aDt(s,f,a)}}r||(r=new jLt);var m=r.get(s);if(m)return m;r.set(s,o),dDt(s)?s.forEach(function(_){o.add(If(_,t,e,_,s,r))}):hDt(s)&&s.forEach(function(_,v){o.set(v,If(_,t,e,v,s,r))});var g=c?l?sDt:iDt:l?mDt:pDt,y=h?void 0:g(s);return YLt(y||s,function(_,v){y&&(v=_,_=s[v]),ZLt(o,v,If(_,t,e,v,s,r))}),o}var VDt=If,GDt=VDt,qDt=1,WDt=4;function $Dt(s){return GDt(s,qDt|WDt)}var XDt=$Dt;const jDt=mu(XDt);var YDt="__lodash_hash_undefined__";function ZDt(s){return this.__data__.set(s,YDt),this}var KDt=ZDt;function JDt(s){return this.__data__.has(s)}var QDt=JDt,tIt=oT,eIt=KDt,nIt=QDt;function Kf(s){var t=-1,e=s==null?0:s.length;for(this.__data__=new tIt;++t<e;)this.add(s[t])}Kf.prototype.add=Kf.prototype.push=eIt;Kf.prototype.has=nIt;var iIt=Kf;function sIt(s,t){for(var e=-1,n=s==null?0:s.length;++e<n;)if(t(s[e],e,s))return!0;return!1}var rIt=sIt;function oIt(s,t){return s.has(t)}var aIt=oIt,lIt=iIt,cIt=rIt,uIt=aIt,hIt=1,fIt=2;function dIt(s,t,e,n,i,r){var o=e&hIt,a=s.length,l=t.length;if(a!=l&&!(o&&l>a))return!1;var c=r.get(s),h=r.get(t);if(c&&h)return c==t&&h==s;var f=-1,d=!0,m=e&fIt?new lIt:void 0;for(r.set(s,t),r.set(t,s);++f<a;){var g=s[f],y=t[f];if(n)var _=o?n(y,g,f,t,s,r):n(g,y,f,s,t,r);if(_!==void 0){if(_)continue;d=!1;break}if(m){if(!cIt(t,function(v,w){if(!uIt(m,w)&&(g===v||i(g,v,e,n,r)))return m.push(w)})){d=!1;break}}else if(!(g===y||i(g,y,e,n,r))){d=!1;break}}return r.delete(s),r.delete(t),d}var TT=dIt;function pIt(s){var t=-1,e=Array(s.size);return s.forEach(function(n,i){e[++t]=[i,n]}),e}var mIt=pIt;function gIt(s){var t=-1,e=Array(s.size);return s.forEach(function(n){e[++t]=n}),e}var vIt=gIt,N1=ep,F1=MT,_It=uy,yIt=TT,xIt=mIt,bIt=vIt,wIt=1,MIt=2,SIt="[object Boolean]",AIt="[object Date]",EIt="[object Error]",TIt="[object Map]",CIt="[object Number]",PIt="[object RegExp]",RIt="[object Set]",LIt="[object String]",DIt="[object Symbol]",IIt="[object ArrayBuffer]",OIt="[object DataView]",B1=N1?N1.prototype:void 0,pg=B1?B1.valueOf:void 0;function zIt(s,t,e,n,i,r,o){switch(e){case OIt:if(s.byteLength!=t.byteLength||s.byteOffset!=t.byteOffset)return!1;s=s.buffer,t=t.buffer;case IIt:return!(s.byteLength!=t.byteLength||!r(new F1(s),new F1(t)));case SIt:case AIt:case CIt:return _It(+s,+t);case EIt:return s.name==t.name&&s.message==t.message;case PIt:case LIt:return s==t+"";case TIt:var a=xIt;case RIt:var l=n&wIt;if(a||(a=bIt),s.size!=t.size&&!l)return!1;var c=o.get(s);if(c)return c==t;n|=MIt,o.set(s,t);var h=yIt(a(s),a(t),n,i,r,o);return o.delete(s),h;case DIt:if(pg)return pg.call(s)==pg.call(t)}return!1}var kIt=zIt,H1=bT,UIt=1,NIt=Object.prototype,FIt=NIt.hasOwnProperty;function BIt(s,t,e,n,i,r){var o=e&UIt,a=H1(s),l=a.length,c=H1(t),h=c.length;if(l!=h&&!o)return!1;for(var f=l;f--;){var d=a[f];if(!(o?d in t:FIt.call(t,d)))return!1}var m=r.get(s),g=r.get(t);if(m&&g)return m==t&&g==s;var y=!0;r.set(s,t),r.set(t,s);for(var _=o;++f<l;){d=a[f];var v=s[d],w=t[d];if(n)var b=o?n(w,v,d,t,s,r):n(v,w,d,s,t,r);if(!(b===void 0?v===w||i(v,w,e,n,r):b)){y=!1;break}_||(_=d=="constructor")}if(y&&!_){var M=s.constructor,A=t.constructor;M!=A&&"constructor"in s&&"constructor"in t&&!(typeof M=="function"&&M instanceof M&&typeof A=="function"&&A instanceof A)&&(y=!1)}return r.delete(s),r.delete(t),y}var HIt=BIt,mg=aT,VIt=TT,GIt=kIt,qIt=HIt,V1=ap,G1=op,q1=fy,WIt=fT,$It=1,W1="[object Arguments]",$1="[object Array]",gf="[object Object]",XIt=Object.prototype,X1=XIt.hasOwnProperty;function jIt(s,t,e,n,i,r){var o=G1(s),a=G1(t),l=o?$1:V1(s),c=a?$1:V1(t);l=l==W1?gf:l,c=c==W1?gf:c;var h=l==gf,f=c==gf,d=l==c;if(d&&q1(s)){if(!q1(t))return!1;o=!0,h=!1}if(d&&!h)return r||(r=new mg),o||WIt(s)?VIt(s,t,e,n,i,r):GIt(s,t,l,e,n,i,r);if(!(e&$It)){var m=h&&X1.call(s,"__wrapped__"),g=f&&X1.call(t,"__wrapped__");if(m||g){var y=m?s.value():s,_=g?t.value():t;return r||(r=new mg),i(y,_,e,n,r)}}return d?(r||(r=new mg),qIt(s,t,e,n,i,r)):!1}var YIt=jIt,ZIt=YIt,j1=ql;function CT(s,t,e,n,i){return s===t?!0:s==null||t==null||!j1(s)&&!j1(t)?s!==s&&t!==t:ZIt(s,t,e,n,CT,i)}var KIt=CT,JIt=KIt;function QIt(s,t){return JIt(s,t)}var tOt=QIt;const eOt=mu(tOt);class PT extends Ei{static initClass(){this.traits=["node","entity","active","latch"]}init(){this.data=void 0,this.isDirty=!0}make(){this._helpers.active.make(),this._listen("root","root.update",function(){this.isActive&&this.update()})}unmake(){this._helpers.active.unmake(),this.data=void 0}swap(){const{deep:t,data:e}=this.props;(t?!eOt(e,this.data):e!=this.data)&&(this.data=t?jDt(e):e)}update(){this.isDirty=this.swap()}}PT.initClass();class xy extends Ru{static initClass(){this.traits=["node","buffer","active","data","source","index","texture","matrix","raw"]}init(){return this.buffer=this.spec=null,this.space={width:0,height:0,history:0},this.used={width:0,height:0},this.storage="matrixBuffer",this.passthrough=(t,e,n)=>t(e,n,0,0),super.init()}sourceShader(t){const e=this.getDimensions();return this.alignShader(e,t),this.buffer.shader(t)}getDimensions(){return{items:this.items,width:this.space.width,height:this.space.height,depth:this.space.history}}getActiveDimensions(){return{items:this.items,width:this.used.width,height:this.used.height,depth:this.buffer.getFilled()}}getFutureDimensions(){return{items:this.items,width:this.used.width,height:this.used.height,depth:this.space.history}}getRawDimensions(){return{items:this.items,width:this.space.width,height:this.space.height,depth:1}}make(){super.make();const t=this.minFilter!=null?this.minFilter:this.props.minFilter,e=this.magFilter!=null?this.magFilter:this.props.magFilter,n=this.type!=null?this.type:this.props.type,{width:i}=this.props,{height:r}=this.props,{history:o}=this.props,a=this.props.bufferWidth,l=this.props.bufferHeight,{channels:c}=this.props,{items:h}=this.props;let f=this.spec={channels:c,items:h,width:i,height:r};this.items=f.items,this.channels=f.channels;const{data:d}=this.props;f=oo(d,f);const{space:m}=this;return m.width=Math.max(a,f.width||1),m.height=Math.max(l,f.height||1),m.history=o,this.buffer=this._renderables.make(this.storage,{width:m.width,height:m.height,history:m.history,channels:c,items:h,minFilter:t,magFilter:e,type:n})}unmake(){if(super.unmake(),this.buffer)return this.buffer.dispose(),this.buffer=this.spec=null}change(t,e,n){if(e.texture||t["matrix.history"]||t["buffer.channels"]||t["buffer.items"]||t["matrix.bufferWidth"]||t["matrix.bufferHeight"])return this.rebuild();if(this.buffer){if(t["matrix.width"]){const{width:i,bufferWidth:r}=this.props;if(this.spec.width=i,i>r)return this.rebuild()}if(t["matrix.height"]){const{height:i,bufferHeight:r}=this.props;if(this.spec.height=i,i>r)return this.rebuild()}if(t["data.map"]||t["data.data"]||t["data.resolve"]||t["data.expr"]||n)return this.buffer.setCallback(this.emitter())}}callback(t){return t.length<=3?t:(e,n,i)=>t(e,n,i,this.bufferClock,this.bufferStep)}update(){if(!this.buffer)return;const{data:t}=this.props,{space:e,used:n}=this,i=n.width,r=n.height,o=this.buffer.getFilled();if(this.syncBuffer(a=>{if(t!=null){const l=oo(t,this.spec);return l.width>e.width||l.height>e.height?(a(),this.rebuild()):(n.width=l.width,n.height=l.height,this.buffer.setActive(n.width,n.height),typeof this.buffer.callback.rebind=="function"&&this.buffer.callback.rebind(t),this.buffer.update())}else{let l;const c=this.spec.width||1,h=this.spec.height||1;this.buffer.setActive(c,h);const f=this.buffer.update();n.width=l=c,n.height=Math.min(h,Math.ceil(f/l)),n.height===1&&(n.width=Math.min(c,f))}}),n.width!==i||n.height!==r||o!==this.buffer.getFilled())return this.trigger({type:"source.resize"})}}xy.initClass();class RT extends xy{static initClass(){this.traits=["node","buffer","active","data","source","index","matrix","texture","raw","span:x","span:y","area","sampler:x","sampler:y"]}updateSpan(){let t,e;const n=this.props.axes;let{width:i}=this.props,{height:r}=this.props;const{centeredX:o}=this.props,{centeredY:a}=this.props,l=this.props.paddingX,c=this.props.paddingY,h=this._helpers.span.get("x.",n[0]),f=this._helpers.span.get("y.",n[1]);this.aX=h.x,this.aY=f.x;const d=h.y-h.x,m=f.y-f.x;return i+=l*2,r+=c*2,o?(t=1/Math.max(1,i),this.aX+=d*t/2):t=1/Math.max(1,i-1),a?(e=1/Math.max(1,r),this.aY+=m*e/2):e=1/Math.max(1,r-1),this.bX=d*t,this.bY=m*e,this.aX+=l*this.bX,this.aY+=c*this.bY}callback(t){return this.updateSpan(),this.last===t?this._callback:(this.last=t,t.length<=5?this._callback=(e,n,i)=>{const r=this.aX+this.bX*n,o=this.aY+this.bY*i;return t(e,r,o,n,i)}:this._callback=(e,n,i)=>{const r=this.aX+this.bX*n,o=this.aY+this.bY*i;return t(e,r,o,n,i,this.bufferClock,this.bufferStep)})}make(){return super.make(),this._helpers.span.make(),this._listen(this,"span.range",this.updateSpan)}unmake(){return super.unmake(),this._helpers.span.unmake()}change(t,e,n){super.change(t,e,n),(e.x||e.y)&&this.updateSpan()}}RT.initClass();class Du extends Ru{constructor(...t){super(...t),this.update=this.update.bind(this)}static initClass(){this.traits=["node","buffer","active","data","source","index","texture","voxel","raw"]}init(){this.buffer=this.spec=null,this.space={width:0,height:0,depth:0},this.used={width:0,height:0,depth:0},this.storage="voxelBuffer",this.passthrough=(t,e,n,i)=>t(e,n,i,0),super.init()}sourceShader(t){const e=this.getDimensions();return this.alignShader(e,t),this.buffer.shader(t)}getDimensions(){return{items:this.items,width:this.space.width,height:this.space.height,depth:this.space.depth}}getActiveDimensions(){return{items:this.items,width:this.used.width,height:this.used.height,depth:this.used.depth*this.buffer.getFilled()}}getRawDimensions(){return this.getDimensions()}make(){super.make();const t=this.minFilter!=null?this.minFilter:this.props.minFilter,e=this.magFilter!=null?this.magFilter:this.props.magFilter,n=this.type!=null?this.type:this.props.type,{width:i}=this.props,{height:r}=this.props,{depth:o}=this.props,a=this.props.bufferWidth,l=this.props.bufferHeight,c=this.props.bufferDepth,{channels:h}=this.props,{items:f}=this.props;let d=this.spec={channels:h,items:f,width:i,height:r,depth:o};this.items=d.items,this.channels=d.channels;const{data:m}=this.props;d=oo(m,d);const{space:g}=this;return g.width=Math.max(a,d.width||1),g.height=Math.max(l,d.height||1),g.depth=Math.max(c,d.depth||1),this.buffer=this._renderables.make(this.storage,{width:g.width,height:g.height,depth:g.depth,channels:h,items:f,minFilter:t,magFilter:e,type:n})}unmake(){if(super.unmake(),this.buffer)return this.buffer.dispose(),this.buffer=this.spec=null}change(t,e,n){if(e.texture||t["buffer.channels"]||t["buffer.items"]||t["voxel.bufferWidth"]||t["voxel.bufferHeight"]||t["voxel.bufferDepth"])return this.rebuild();if(this.buffer){if(t["voxel.width"]){const{width:i,bufferWidth:r}=this.props;if(this.spec.width=i,i>r)return this.rebuild()}if(t["voxel.height"]){const{height:i,bufferHeight:r}=this.props;if(this.spec.height=i,i>r)return this.rebuild()}if(t["voxel.depth"]){const{depth:i,bufferDepth:r}=this.props;if(this.spec.depth=i,i>r)return this.rebuild()}if(t["data.map"]||t["data.data"]||t["data.resolve"]||t["data.expr"]||n)return this.buffer.setCallback(this.emitter())}}callback(t){return t.length<=4?t:(e,n,i,r)=>t(e,n,i,r,this.bufferClock,this.bufferStep)}update(){if(!this.buffer)return;const{data:t}=this.props,{space:e,used:n}=this,i=n.width,r=n.height,o=n.depth,a=this.buffer.getFilled();if(this.syncBuffer(l=>{if(t!=null){const c=oo(t,this.spec);return c.width>e.width||c.height>e.height||c.depth>e.depth?(l(),this.rebuild()):(n.width=c.width,n.height=c.height,n.depth=c.depth,this.buffer.setActive(n.width,n.height,n.depth),typeof this.buffer.callback.rebind=="function"&&this.buffer.callback.rebind(t),this.buffer.update())}else{let c,h;const f=this.spec.width||1,d=this.spec.height||1,m=this.spec.depth||1;this.buffer.setActive(f,d,m);const g=this.buffer.update();n.width=h=f,n.height=c=d,n.depth=Math.min(m,Math.ceil(g/h/c)),n.depth===1&&(n.height=Math.min(d,Math.ceil(g/h)),n.height===1&&(n.width=Math.min(f,g)))}}),n.width!==i||n.height!==r||n.depth!==o||a!==this.buffer.getFilled())return this.trigger({type:"source.resize"})}}Du.initClass();class LT extends Du{static initClass(){this.traits=["node","buffer","active","data","source","index","texture","voxel","span:x","span:y","span:z","volume","sampler:x","sampler:y","sampler:z","raw"]}updateSpan(){let t,e,n;const i=this.props.axes;let{width:r}=this.props,{height:o}=this.props,{depth:a}=this.props;const{centeredX:l}=this.props,{centeredY:c}=this.props,{centeredZ:h}=this.props,f=this.props.paddingX,d=this.props.paddingY,m=this.props.paddingZ,g=this._helpers.span.get("x.",i[0]),y=this._helpers.span.get("y.",i[1]),_=this._helpers.span.get("z.",i[2]);this.aX=g.x,this.aY=y.x,this.aZ=_.x;const v=g.y-g.x,w=y.y-y.x,b=_.y-_.x;return r+=f*2,o+=d*2,a+=m*2,l?(t=1/Math.max(1,r),this.aX+=v*t/2):t=1/Math.max(1,r-1),c?(e=1/Math.max(1,o),this.aY+=w*e/2):e=1/Math.max(1,o-1),h?(n=1/Math.max(1,a),this.aZ+=b*n/2):n=1/Math.max(1,a-1),this.bX=v*t,this.bY=w*e,this.bZ=b*n,this.aX+=this.bX*f,this.aY+=this.bY*d,this.aZ+=this.bZ*d}callback(t){return this.updateSpan(),this.last===t?this._callback:(this.last=t,t.length<=7?this._callback=(e,n,i,r)=>{const o=this.aX+this.bX*n,a=this.aY+this.bY*i,l=this.aZ+this.bZ*r;return t(e,o,a,l,n,i,r)}:this._callback=(e,n,i,r)=>{const o=this.aX+this.bX*n,a=this.aY+this.bY*i,l=this.aZ+this.bZ*r;return t(e,o,a,l,n,i,r,this.bufferClock,this.bufferStep)})}make(){return super.make(),this._helpers.span.make(),this._listen(this,"span.range",this.updateSpan)}unmake(){return super.unmake(),this._helpers.span.unmake()}change(t,e,n){super.change(t,e,n),(e.x||e.y||e.z)&&this.updateSpan()}}LT.initClass();const by=function(s,t,e){+t===t&&(t=[t]);const n=Array.from(t).includes(1)?0:e.x,i=Array.from(t).includes(2)?0:e.y,r=Array.from(t).includes(3)?0:e.z,o=Array.from(t).includes(4)?0:e.w;return s.set(n,i,r,o)},wy=function(){const s=new Oe;return function(t,e,n){return by(s,e,n),t.add(s)}}(),jo=function(s,t){const e=t===1?1:0,n=t===2?1:0,i=t===3?1:0,r=t===4?1:0;return s.set(e,n,i,r)},nOt=function(s,t){const e=t===1?1:0,n=t===2?1:0,i=t===3?1:0,r=t===4?1:0;return s.set(n,i+e,r,0)},Cl=function(){const s=[0,0];return function(t,e,n,i){if(i==null&&(i=0),n>0){const r=t,o=t+e,a=Math.max(Math.abs(r),Math.abs(o)),l=a*i,c=Math.min(r,o),h=Math.max(r,o);t=c+(-a+l-c)*n,e=h+(a+l-h)*n-t}return s[0]=t,s[1]=e,s}}(),iOt=Object.freeze(Object.defineProperty({__proto__:null,addOrigin:wy,recenterAxis:Cl,setDimension:jo,setDimensionNormal:nOt,setOrigin:by},Symbol.toStringTag,{value:"Module"}));class DT extends Jd{static initClass(){this.traits=["node","source","index","interval","span","scale","raw","origin"]}init(){return this.used=this.space=this.scaleAxis=this.sampler=null}rawBuffer(){return this.buffer}sourceShader(t){return t.pipe(this.sampler)}getDimensions(){return{items:1,width:this.space,height:1,depth:1}}getActiveDimensions(){return{items:1,width:this.used,height:this.buffer.getFilled(),depth:1}}getRawDimensions(){return this.getDimensions()}make(){let t;this.space=t=this._helpers.scale.divide(""),this.buffer=this._renderables.make("dataBuffer",{width:t,channels:1,items:1});const e={scaleAxis:this._attributes.make(this._types.vec4()),scaleOffset:this._attributes.make(this._types.vec4())};this.scaleAxis=e.scaleAxis.value,this.scaleOffset=e.scaleOffset.value;const n=this.sampler=this._shaders.shader();return n.require(this.buffer.shader(this._shaders.shader(),1)),n.pipe("scale.position",e),this._helpers.span.make(),this._listen(this,"span.range",this.updateRanges)}unmake(){return this.scaleAxis=null,this._helpers.span.unmake()}change(t,e,n){if(t["scale.divide"])return this.rebuild();if(e.view||e.interval||e.span||e.scale||e.origin||n)return this.updateRanges()}updateRanges(){const{used:t}=this,{axis:e,origin:n}=this.props,i=this._helpers.span.get("",e),r=i.x,o=i.y,a=this._helpers.scale.generate("",this.buffer,r,o);if(jo(this.scaleAxis,e),by(this.scaleOffset,e,n),this.used=a.length,this.used!==t)return this.trigger({type:"source.resize"})}}DT.initClass();const Si=function(){const s={};for(const t of Array.from(arguments))for(const e in t){const n=t[e];s[e]=n}return s},sOt=s=>JSON.parse(JSON.serialize(s)),IT=function(s){let t="";const e=o=>o=o.replace(/\\/g,""),n=function(o){return t.length&&r.push(e(t)),t=o??""};s=s.split(/(?=(?:\\.|["' ,]))/g);let i=!1;const r=[];for(const o of Array.from(s)){const a=o[0],l=o.slice(1);switch(a){case'"':case"'":if(i)i===a?(i=!1,n(l)):t+=o;else{if(t!=="")throw new Error(`ParseError: String \`${s}\` does not contain comma-separated quoted tokens.`);i=a,t+=l}break;case" ":case",":i?t+=o:n(l);break;default:t+=o}}return n(),r},rOt=Object.freeze(Object.defineProperty({__proto__:null,clone:sOt,merge:Si,parseQuoted:IT},Symbol.toStringTag,{value:"Module"}));let OT=class extends bn{static initClass(){this.traits=["node","object","visible","style","line","axis","span","interval","arrow","position","origin","shade"],this.defaults={end:!0,zBias:-1}}constructor(t,e,n){super(t,e,n),this.axisPosition=this.axisStep=this.resolution=this.line=this.arrows=null}make(){const t={axisPosition:this._attributes.make(this._types.vec4()),axisStep:this._attributes.make(this._types.vec4())};this.axisPosition=t.axisPosition.value,this.axisStep=t.axisStep.value;let e=this._shaders.shader();e.pipe("axis.position",t),e=this._helpers.position.pipeline(e);const n=this._helpers.style.uniforms(),i=this._helpers.line.uniforms(),r=this._helpers.arrow.uniforms(),o=this._inherit("unit").getUnitUniforms(),{detail:a}=this.props,l=a+1;this.resolution=1/a;const{start:c,end:h}=this.props,{stroke:f,join:d}=this.props;let m=this._helpers.object.mask();const g=this._helpers.shade.pipeline()||!1,{crossed:y,axis:_}=this.props;if(!y&&m!=null&&_>1){const w=["x000","y000","z000","w000"][_];m=this._helpers.position.swizzle(m,w)}const v=Si(r,i,n,o);return this.line=this._renderables.make("line",{uniforms:v,samples:l,position:e,clip:c||h,stroke:f,join:d,mask:m,material:g}),this.arrows=[],c&&this.arrows.push(this._renderables.make("arrow",{uniforms:v,flip:!0,samples:l,position:e,mask:m,material:g})),h&&this.arrows.push(this._renderables.make("arrow",{uniforms:v,samples:l,position:e,mask:m,material:g})),this._helpers.visible.make(),this._helpers.object.make(this.arrows.concat([this.line])),this._helpers.span.make(),this._listen(this,"span.range",this.updateRanges)}unmake(){return this._helpers.visible.unmake(),this._helpers.object.unmake(),this._helpers.span.unmake()}change(t,e,n){if(t["axis.detail"]||t["line.stroke"]||t["line.join"]||t["axis.crossed"]||t["interval.axis"]&&this.props.crossed)return this.rebuild();if(e.interval||e.span||e.view||e.origin||n)return this.updateRanges()}updateRanges(){const{axis:t,origin:e}=this.props,n=this._helpers.span.get("",t),i=n.x,r=n.y;return jo(this.axisPosition,t).multiplyScalar(i),jo(this.axisStep,t).multiplyScalar((r-i)*this.resolution),wy(this.axisPosition,t,e)}};OT.initClass();let zT=class extends bn{static initClass(){this.traits=["node","object","visible","style","line","mesh","face","geometry","position","bind","shade"]}constructor(t,e,n){super(t,e,n),this.face=null}resize(){if(this.bind.points==null)return;const t=this.bind.points.getActiveDimensions(),{items:e,width:n,height:i,depth:r}=t;if(this.face&&this.face.geometry.clip(n,i,r,e),this.line&&this.line.geometry.clip(e,n,i,r),this.bind.map!=null){const o=this.bind.map.getActiveDimensions();if(this.face)return this.face.geometry.map(o.width,o.height,o.depth,o.items)}}make(){let t,e;if(this._helpers.bind.make([{to:"geometry.points",trait:"source"},{to:"geometry.colors",trait:"source"},{to:"mesh.map",trait:"source"}]),this.bind.points==null)return;let n=this.bind.points.sourceShader(this._shaders.shader());n=this._helpers.position.pipeline(n);const i=this._helpers.style.uniforms(),r=this._helpers.line.uniforms(),o=this._inherit("unit").getUnitUniforms(),a={};a.styleZBias=this._attributes.make(this._types.number()),this.wireZBias=a.styleZBias;const l=this.bind.points.getDimensions(),{items:c,width:h,height:f,depth:d}=l,{line:m,shaded:g,fill:y,stroke:_,join:v}=this.props;this.bind.colors&&(t=this._shaders.shader(),this.bind.colors.sourceShader(t));const w=this._helpers.object.mask(),b=this._helpers.shade.map(this.bind.map!=null?this.bind.map.sourceShader(this._shaders.shader()):void 0),M=this._helpers.shade.pipeline(),A=M||g,T=M||!1,P=[];if(m){const C=this._shaders.shader();C.pipe(yi("yzwx")),C.pipe(n),e=Si(o,r,i,a),this.line=this._renderables.make("line",{uniforms:e,samples:c,strips:h,ribbons:f,layers:d,position:C,color:t,stroke:_,join:v,material:T,mask:w,closed:!0}),P.push(this.line)}return y&&(e=Si(o,i,{}),this.face=this._renderables.make("face",{uniforms:e,width:h,height:f,depth:d,items:c,position:n,color:t,material:A,mask:w,map:b}),P.push(this.face)),this._helpers.visible.make(),this._helpers.object.make(P)}made(){return this.resize()}unmake(){return this._helpers.bind.unmake(),this._helpers.visible.unmake(),this._helpers.object.unmake(),this.face=this.line=null}change(t,e,n){if(t["geometry.points"]||e.mesh)return this.rebuild();if(t["style.zBias"]||t["mesh.lineBias"]||n){const{fill:i,zBias:r,lineBias:o}=this.props;return this.wireZBias.value=r+(i?o:0)}}};zT.initClass();let kT=class extends bn{static initClass(){this.traits=["node","object","visible","style","line","grid","area","position","origin","shade","axis:x","axis:y","scale:x","scale:y","span:x","span:y"],this.defaults={width:1,zBias:-2}}constructor(t,e,n){super(t,e,n),this.axes=null}make(){let t,e=this._helpers.object.mask();const n=this._helpers.shade.pipeline()||!1;t=(d,m,g)=>{let y;const _=this._get(d+"axis.detail"),v=_+1,w=1/_,b=this._helpers.scale.divide(m),M=this._renderables.make("dataBuffer",{width:b,channels:1}),A={gridPosition:this._attributes.make(this._types.vec4()),gridStep:this._attributes.make(this._types.vec4()),gridAxis:this._attributes.make(this._types.vec4())},T={gridPosition:A.gridPosition.value,gridStep:A.gridStep.value,gridAxis:A.gridAxis.value},P=y=this._shaders.shader();g!=null&&e!=null&&(e=this._helpers.position.swizzle(e,g)),P.require(M.shader(this._shaders.shader(),2)),P.pipe("grid.position",A),y=this._helpers.position.pipeline(P);const C=this._helpers.style.uniforms(),S=this._helpers.line.uniforms(),L=this._inherit("unit").getUnitUniforms(),H=Si(S,C,L),$=this._renderables.make("line",{uniforms:H,samples:v,strips:b,position:y,stroke:c,join:h,mask:e,material:n});return{first:d,second:m,resolution:w,samples:v,line:$,buffer:M,values:T}};const{lineX:i,lineY:r,crossed:o,axes:a}=this.props,l=["0000","x000","y000","z000","w000"][a[1]],{stroke:c,join:h}=this.props;this.axes=[],i&&this.axes.push(t("x.","y.",null)),r&&this.axes.push(t("y.","x.",o?null:l));const f=(()=>{const d=[];for(t of this.axes)d.push(t.line);return d})();return this._helpers.visible.make(),this._helpers.object.make(f),this._helpers.span.make(),this._listen(this,"span.range",this.updateRanges)}unmake(){this._helpers.visible.unmake(),this._helpers.object.unmake(),this._helpers.span.unmake();for(const t of this.axes)t.buffer.dispose();this.axes=null}change(t,e,n){if(t["x.axis.detail"]||t["y.axis.detail"]||t["x.axis.factor"]||t["y.axis.factor"]||t["grid.lineX"]||t["grid.lineY"]||t["line.stroke"]||t["line.join"]||t["grid.crossed"]||t["grid.axes"]&&this.props.crossed)return this.rebuild();if(e.x||e.y||e.area||e.grid||e.view||e.origin||n)return this.updateRanges()}updateRanges(){const t=(l,c,h,f,d)=>{const{second:m,resolution:g,samples:y,line:_,buffer:v,values:w}=d;let b=h.x,M=h.y;jo(w.gridPosition,l).multiplyScalar(b),jo(w.gridStep,l).multiplyScalar((M-b)*g),wy(w.gridPosition,e,n),b=f.x,M=f.y;const A=this._helpers.scale.generate(m,v,b,M);jo(w.gridAxis,c);const T=A.length;return _.geometry.clip(y,T,1,1)},{axes:e,origin:n}=this.props,i=this._helpers.span.get("x.",e[0]),r=this._helpers.span.get("y.",e[1]),{lineX:o,lineY:a}=this.props;o&&t(e[0],e[1],i,r,this.axes[0]),a&&t(e[1],e[0],r,i,this.axes[+o]),window.cake1=this.axes[0].buffer,window.cake2=this.axes[1].buffer,window.cake3=this.axes[0]}};kT.initClass();let UT=class extends bn{static initClass(){this.traits=["node","object","visible","style","line","arrow","geometry","position","bind","shade"]}constructor(t,e,n){super(t,e,n),this.line=this.arrows=null}resize(){if(this.bind.points==null)return;const t=this.bind.points.getActiveDimensions(),e=t.width,n=t.height,i=t.depth,r=t.items;return this.line.geometry.clip(e,n,i,r),Array.from(this.arrows).map(o=>o.geometry.clip(e,n,i,r))}make(){let t;if(this._helpers.bind.make([{to:"geometry.points",trait:"source"},{to:"geometry.colors",trait:"source"}]),this.bind.points==null)return;let e=this._shaders.shader();e=this.bind.points.sourceShader(e),e=this._helpers.position.pipeline(e);const n=this._helpers.style.uniforms(),i=this._helpers.line.uniforms(),r=this._helpers.arrow.uniforms(),o=this._inherit("unit").getUnitUniforms(),{start:a,end:l}=this.props,{stroke:c,join:h,proximity:f,closed:d}=this.props;this.proximity=f;const m=this.bind.points.getDimensions(),g=m.width,y=m.height,_=m.depth,v=m.items;this.bind.colors&&(t=this._shaders.shader(),this.bind.colors.sourceShader(t));const w=this._helpers.object.mask(),b=this._helpers.shade.pipeline()||!1,M=Si(r,i,n,o);return this.line=this._renderables.make("line",{uniforms:M,samples:g,strips:y,ribbons:_,layers:v,position:e,color:t,clip:a||l,stroke:c,join:h,proximity:f,closed:d,mask:w,material:b}),this.arrows=[],a&&this.arrows.push(this._renderables.make("arrow",{uniforms:M,flip:!0,samples:g,strips:y,ribbons:_,layers:v,position:e,color:t,closed:d,mask:w,material:b})),l&&this.arrows.push(this._renderables.make("arrow",{uniforms:M,samples:g,strips:y,ribbons:_,layers:v,position:e,color:t,closed:d,mask:w,material:b})),this._helpers.visible.make(),this._helpers.object.make(this.arrows.concat([this.line]))}made(){return this.resize()}unmake(){return this._helpers.bind.unmake(),this._helpers.visible.unmake(),this._helpers.object.unmake(),this.line=this.arrows=null}change(t,e,n){if(t["geometry.points"]||t["line.stroke"]||t["line.join"]||t["arrow.start"]||t["arrow.end"])return this.rebuild();if(t["line.proximity"]&&this.proximity!=null!=(this.props.proximity!=null))return this.rebuild()}};UT.initClass();let NT=class extends bn{static initClass(){this.traits=["node","object","visible","style","point","geometry","position","bind","shade"]}constructor(t,e,n){super(t,e,n),this.point=null}resize(){if(this.bind.points==null)return;const t=this.bind.points.getActiveDimensions(),{items:e,width:n,height:i,depth:r}=t;return this.point.geometry.clip(n,i,r,e)}make(){let t,e;if(this._helpers.bind.make([{to:"geometry.points",trait:"source"},{to:"geometry.colors",trait:"source"},{to:"point.sizes",trait:"source"}]),this.bind.points==null)return;let n=this._shaders.shader();n=this.bind.points.sourceShader(n),n=this._helpers.position.pipeline(n);const i=this.bind.points.getDimensions(),{items:r,width:o,height:a,depth:l}=i,c=this._helpers.style.uniforms(),h=this._helpers.point.uniforms(),f=this._inherit("unit").getUnitUniforms();this.bind.colors&&(t=this._shaders.shader(),this.bind.colors.sourceShader(t)),this.bind.sizes&&(e=this._shaders.shader(),this.bind.sizes.sourceShader(e));const d=this._helpers.object.mask(),m=this._helpers.shade.pipeline()||!1,{shape:g}=this.props,{fill:y}=this.props,{optical:_}=this.props,v=Si(f,h,c);this.point=this._renderables.make("point",{uniforms:v,width:o,height:a,depth:l,items:r,position:n,color:t,size:e,shape:g,optical:_,fill:y,mask:d,material:m}),this._helpers.visible.make(),this._helpers.object.make([this.point])}made(){return this.resize()}unmake(){this._helpers.bind.unmake(),this._helpers.visible.unmake(),this._helpers.object.unmake(),this.point=null}change(t,e,n){if(t["geometry.points"]||t["point.shape"]||t["point.fill"])return this.rebuild()}};NT.initClass();let FT=class extends bn{static initClass(){this.traits=["node","object","visible","style","line","mesh","strip","geometry","position","bind","shade"]}constructor(t,e,n){super(t,e,n),this.strip=null}resize(){if(this.bind.points==null)return;const t=this.bind.points.getActiveDimensions(),{items:e,width:n,height:i,depth:r}=t;if(this.strip&&this.strip.geometry.clip(n,i,r,e),this.line&&this.line.geometry.clip(e,n,i,r),this.bind.map!=null){const o=this.bind.map.getActiveDimensions();if(this.strip)return this.strip.geometry.map(o.width,o.height,o.depth,o.items)}}make(){let t,e;if(this._helpers.bind.make([{to:"geometry.points",trait:"source"},{to:"geometry.colors",trait:"source"},{to:"mesh.map",trait:"source"}]),this.bind.points==null)return;let n=this._shaders.shader();n=this.bind.points.sourceShader(n),n=this._helpers.position.pipeline(n);const i=this._helpers.style.uniforms(),r=this._helpers.line.uniforms(),o=this._inherit("unit").getUnitUniforms(),{line:a,shaded:l,fill:c,stroke:h,join:f}=this.props,d={};d.styleZBias=this._attributes.make(this._types.number()),this.wireZBias=d.styleZBias;const m=this.bind.points.getDimensions(),{items:g,width:y,height:_,depth:v}=m;this.bind.colors&&(t=this._shaders.shader(),t=this.bind.colors.sourceShader(t));const w=this._helpers.object.mask();this._helpers.shade.map(this.bind.map!=null?this.bind.map.sourceShader(this._shaders.shader()):void 0);const b=this._helpers.shade.pipeline(),M=b||l,A=b||!1,T=[];if(a){const P=this._shaders.shader();P.pipe(yi("yzwx")),P.pipe(n),e=Si(o,r,i,d),this.line=this._renderables.make("line",{uniforms:e,samples:g,strips:y,ribbons:_,layers:v,position:P,color:t,stroke:h,join:f,mask:w,material:A}),T.push(this.line)}return c&&(e=Si(i,{}),this.strip=this._renderables.make("strip",{uniforms:e,width:y,height:_,depth:v,items:g,position:n,color:t,material:M}),T.push(this.strip)),this._helpers.visible.make(),this._helpers.object.make(T)}made(){return this.resize()}unmake(){return this._helpers.bind.unmake(),this._helpers.visible.unmake(),this._helpers.object.unmake(),this.strip=null}change(t,e,n){if(t["geometry.points"]||e.mesh)return this.rebuild();if(t["style.zBias"]||t["mesh.lineBias"]||n){const{fill:i,zBias:r,lineBias:o}=this.props;return this.wireZBias.value=r+(i?o:0)}}};FT.initClass();let BT=class extends bn{static initClass(){this.traits=["node","object","visible","style","line","mesh","geometry","surface","position","grid","bind","shade"],this.defaults={lineX:!1,lineY:!1}}constructor(t,e,n){super(t,e,n),this.lineX=this.lineY=this.surface=null}resize(){if(this.bind.points==null)return;const t=this.bind.points.getActiveDimensions(),{width:e,height:n,depth:i,items:r}=t;if(this.surface&&this.surface.geometry.clip(e,n,i,r),this.lineX&&this.lineX.geometry.clip(e,n,i,r),this.lineY&&this.lineY.geometry.clip(n,e,i,r),this.bind.map!=null){const o=this.bind.map.getActiveDimensions();if(this.surface)return this.surface.geometry.map(o.width,o.height,o.depth,o.items)}}make(){let t,e;if(this._helpers.bind.make([{to:"geometry.points",trait:"source"},{to:"geometry.colors",trait:"source"},{to:"mesh.normals",trait:"source"},{to:"mesh.map",trait:"source"}]),this.bind.points==null)return;let n=this._shaders.shader();n=this.bind.points.sourceShader(n),n=this._helpers.position.pipeline(n);const i=this._helpers.style.uniforms(),r=this._helpers.style.uniforms(),o=this._helpers.line.uniforms(),a=this._helpers.surface.uniforms(),l=this._inherit("unit").getUnitUniforms();r.styleColor=this._attributes.make(this._types.color()),r.styleZBias=this._attributes.make(this._types.number()),this.wireColor=r.styleColor.value,this.wireZBias=r.styleZBias,this.wireScratch=new Vt;const c=this.bind.points.getDimensions(),{width:h,height:f,depth:d,items:m}=c,{shaded:g,fill:y,lineX:_,lineY:v,closedX:w,closedY:b,stroke:M,join:A,proximity:T,crossed:P}=this.props,C=[];this.proximity=T,this.bind.normals!=null&&(e=this._shaders.shader(),this.bind.normals.sourceShader(e),this._helpers.shade.normal(e)),this.bind.colors!=null&&(t=this._shaders.shader(),this.bind.colors.sourceShader(t));const S=this._helpers.object.mask(),L=this._helpers.shade.map(this.bind.map!=null?this.bind.map.sourceShader(this._shaders.shader()):void 0),H=this._helpers.shade.pipeline(),$=H||g,B=H||!1,{swizzle:G,swizzle2:I}=this._helpers.position;let et=Si(l,o,i,r);const Y=_||v?-50:0;return _&&(this.lineX=this._renderables.make("line",{uniforms:et,samples:h,strips:f,ribbons:d,layers:m,position:n,color:t,normal:e,zUnits:-Y,stroke:M,join:A,mask:S,material:B,proximity:T,closed:w||closed}),C.push(this.lineX)),v&&(this.lineY=this._renderables.make("line",{uniforms:et,samples:f,strips:h,ribbons:d,layers:m,position:I(n,"yxzw","yxzw"),color:G(t,"yxzw"),zUnits:-Y,stroke:M,join:A,mask:G(S,P?"xyzw":"yxzw"),material:B,proximity:T,closed:b||closed}),C.push(this.lineY)),y&&(et=Si(l,a,i),this.surface=this._renderables.make("surface",{uniforms:et,width:h,height:f,surfaces:d,layers:m,position:n,color:t,zUnits:Y,stroke:M,material:$,mask:S,map:L,intUV:!0,closedX:w||closed,closedY:b||closed}),C.push(this.surface)),this._helpers.visible.make(),this._helpers.object.make(C)}made(){return this.resize()}unmake(){return this._helpers.bind.unmake(),this._helpers.visible.unmake(),this._helpers.object.unmake(),this.lineX=this.lineY=this.surface=null}_convertGammaToLinear(t,e=2){return t.r=Math.pow(t.r,e),t.g=Math.pow(t.g,e),t.b=Math.pow(t.b,e),t}_convertLinearToGamma(t,e=2){const n=e>0?1/e:1;return t.r=Math.pow(t.r,n),t.g=Math.pow(t.g,n),t.b=Math.pow(t.b,n),t}change(t,e,n){if(t["geometry.points"]||t["mesh.shaded"]||t["mesh.fill"]||t["line.stroke"]||t["line.join"]||e.grid)return this.rebuild();if(t["style.color"]||t["style.zBias"]||t["mesh.fill"]||t["mesh.lineBias"]||n){const{fill:i,color:r,zBias:o,lineBias:a}=this.props;if(this.wireZBias.value=o+(i?a:0),this.wireColor.copy(r),i){const l=this.wireScratch;l.setRGB(r.r,r.g,r.b),this._convertLinearToGamma(this._convertGammaToLinear(l).multiplyScalar(.75)),this.wireColor.r=l.r,this.wireColor.g=l.g,this.wireColor.b=l.b}}if(t["line.proximity"]&&this.proximity!=null!=(this.props.proximity!=null))return this.rebuild()}};BT.initClass();let HT=class extends bn{static initClass(){this.traits=["node","object","visible","style","line","ticks","geometry","position","bind","shade"]}init(){return this.tickStrip=this.line=null}resize(){if(this.bind.points==null)return;const t=this.bind.points.getActiveDimensions(),e=+(t.items>0),n=t.width*e,i=t.height*e,r=t.depth*e;return this.line.geometry.clip(2,n,i,r),this.tickStrip.set(0,n-1)}make(){let t,e;if(this._helpers.bind.make([{to:"geometry.points",trait:"source"},{to:"geometry.colors",trait:"source"}]),this.bind.points==null)return;const n=this._helpers.style.uniforms(),i=this._helpers.line.uniforms(),r=this._inherit("unit").getUnitUniforms(),o=Si(i,n,r),a={tickEpsilon:this.node.attributes["ticks.epsilon"],tickSize:this.node.attributes["ticks.size"],tickNormal:this.node.attributes["ticks.normal"],tickStrip:this._attributes.make(this._types.vec2(0,0)),worldUnit:o.worldUnit,focusDepth:o.focusDepth};this.tickStrip=a.tickStrip.value;const l=e=this._shaders.shader();l.require(this.bind.points.sourceShader(this._shaders.shader())),l.require(this._helpers.position.pipeline(this._shaders.shader())),l.pipe("ticks.position",a);const{stroke:c,join:h}=this.props,f=this.bind.points.getDimensions(),d=f.width,m=f.height,g=f.depth;this.bind.colors&&(t=this._shaders.shader(),this.bind.colors.sourceShader(t));const y=this._helpers.object.mask(),_=this._helpers.shade.pipeline()||!1,{swizzle:v}=this._helpers.position;return this.line=this._renderables.make("line",{uniforms:o,samples:2,strips:d,ribbons:m,layers:g,position:e,color:t,stroke:c,join:h,mask:v(y,"yzwx"),material:_}),this._helpers.visible.make(),this._helpers.object.make([this.line])}made(){return this.resize()}unmake(){return this.line=null,this._helpers.visible.unmake(),this._helpers.object.unmake()}change(t,e,n){if(t["geometry.points"]||t["line.stroke"]||t["line.join"])return this.rebuild()}};HT.initClass();class VT extends bn{static initClass(){this.traits=["node","object","visible","style","line","arrow","geometry","position","bind","shade"]}constructor(t,e,n){super(t,e,n),this.line=this.arrows=null}resize(){if(this.bind.points==null)return;const t=this.bind.points.getActiveDimensions(),e=t.items,n=t.width,i=t.height,r=t.depth;return this.line.geometry.clip(e,n,i,r),Array.from(this.arrows).map(o=>o.geometry.clip(e,n,i,r))}make(){let t;if(this._helpers.bind.make([{to:"geometry.points",trait:"source"},{to:"geometry.colors",trait:"source"}]),this.bind.points==null)return;let e=this._shaders.shader();this.bind.points.sourceShader(e),this._helpers.position.pipeline(e);const n=this._helpers.style.uniforms(),i=this._helpers.line.uniforms(),r=this._helpers.arrow.uniforms(),o=this._inherit("unit").getUnitUniforms(),{start:a,end:l}=this.props,{stroke:c,join:h,proximity:f,closed:d}=this.props;this.proximity=f;const m=this.bind.points.getDimensions(),g=m.items,y=m.width,_=m.height,v=m.depth;this.bind.colors&&(t=this._shaders.shader(),this.bind.colors.sourceShader(t));let w=this._helpers.object.mask(),b=this._helpers.shade.pipeline()||!1;const{swizzle:M,swizzle2:A}=this._helpers.position;e=A(e,"yzwx","yzwx"),t=M(t,"yzwx"),w=M(w,"yzwx"),b=M(b,"yzwx");const T=Si(r,i,n,o);return this.line=this._renderables.make("line",{uniforms:T,samples:g,ribbons:_,strips:y,layers:v,position:e,color:t,clip:a||l,stroke:c,join:h,proximity:f,closed:d,mask:w,material:b}),this.arrows=[],a&&this.arrows.push(this._renderables.make("arrow",{uniforms:T,flip:!0,samples:g,ribbons:_,strips:y,layers:v,position:e,color:t,closed:d,mask:w,material:b})),l&&this.arrows.push(this._renderables.make("arrow",{uniforms:T,samples:g,ribbons:_,strips:y,layers:v,position:e,color:t,closed:d,mask:w,material:b})),this._helpers.visible.make(),this._helpers.object.make(this.arrows.concat([this.line]))}made(){return this.resize()}unmake(){return this._helpers.bind.unmake(),this._helpers.visible.unmake(),this._helpers.object.unmake(),this.line=this.arrows=null}change(t,e,n){if(t["geometry.points"]||t["line.stroke"]||t["line.join"]||t["arrow.start"]||t["arrow.end"])return this.rebuild();if(t["line.proximity"]&&this.proximity!=null!=(this.props.proximity!=null))return this.rebuild()}}VT.initClass();class GT extends Du{static initClass(){this.traits=["node","buffer","active","data","voxel","html"],this.finals={channels:1}}init(){super.init(),this.storage="pushBuffer"}make(){super.make();const{items:t,width:e,height:n,depth:i}=this.getDimensions();return this.dom=this._overlays.make("dom"),this.dom.hint(t*e*n*i)}unmake(){if(super.unmake(),this.dom!=null)return this.dom.dispose(),this.dom=null}update(){return super.update()}change(t,e,n){return e.html?this.rebuild():super.change(t,e,n)}nodes(){return this.buffer.read()}callback(t){const{el:e}=this.dom;return t.length<=6?(n,i,r,o,a)=>t(n,e,i,r,o,a):(n,i,r,o,a)=>t(n,e,i,r,o,a,this.bufferClock,this.bufferStep)}}GT.initClass();class qT extends bn{static initClass(){this.traits=["node","bind","object","visible","overlay","dom","attach","position"]}init(){this.emitter=this.root=null,this.active={}}make(){if(super.make(),this._helpers.bind.make([{to:"dom.html",trait:"html"},{to:"dom.points",trait:"source"}]),this.bind.points==null||this.bind.html==null)return;this.root=this._inherit("root"),this._listen("root","root.update",this.update),this._listen("root","root.post",this.post);const t=this.bind.points.getDimensions(),e=this.bind.html.getDimensions(),n=Math.min(t.items,e.items),i=Math.min(t.width,e.width),r=Math.min(t.height,e.height),o=Math.min(t.depth,e.depth);let a=this.bind.points.sourceShader(this._shaders.shader());a=this._helpers.position.pipeline(a);const l=this._shaders.shader({globals:["projectionMatrix"]});l.pipe("project.readback"),a.pipe(l);const c=this._shaders.shader();this.readback=this._renderables.make("readback",{map:a,indexer:c,items:n,width:i,height:r,depth:o,channels:4,stpq:!0}),this.dom=this._overlays.make("dom"),this.dom.hint(n*i*r*o*2),this.emitter=this.callback(this.bind.html.nodes()),this.readback.setCallback(this.emitter),this._helpers.visible.make()}unmake(){this.readback!=null&&(this.readback.dispose(),this.dom.dispose(),this.readback=this.dom=null,this.root=null,this.emitter=null,this.active={}),this._helpers.bind.unmake(),this._helpers.visible.unmake()}update(){this.readback!=null&&this.props.visible&&(this.readback.update(this.root!=null?this.root.getCamera():void 0),this.readback.post(),this.readback.iterate())}post(){this.readback!=null&&this.dom.render(this.isVisible?this.emitter.nodes():null)}callback(t){let e,n;const i=this._inherit("unit").getUnitUniforms(),r=i.viewWidth,o=i.viewHeight,a=this.node.attributes["dom.attributes"],l=this.node.attributes["dom.size"],c=this.node.attributes["dom.zoom"],h=this.node.attributes["dom.color"],f=this.node.attributes["dom.outline"],d=this.node.attributes["dom.pointerEvents"],m=this.node.attributes["overlay.opacity"],g=this.node.attributes["overlay.zIndex"],y=this.node.attributes["attach.offset"],_=this.node.attributes["attach.depth"],v=this.node.attributes["attach.snap"],{el:w}=this.dom;let b=[],M=null,A=null,T=e=n=0,P="";const C=function(S,L,H,$,B,G,I,et){let Y;const J=et+T*B+e*G+n*I,ut=t[J],dt=$<0,ft=1+(1/$-1)*_.value,Lt=dt?0:ft,Ot=+y.value.x*Lt,It=+y.value.y*Lt;let Kt=(S+1)*r.value*.5+Ot,Ht=(L-1)*o.value*.5+It;Kt/=c.value,Ht/=c.value,v.value&&(Kt=Math.round(Kt),Ht=Math.round(Ht));const qt=Math.min(.999,dt?0:m.value),ee={className:A,style:{transform:`translate3d(${Kt}px, ${-Ht}px, ${1-$}px) translate(-50%, -50%) scale(${Lt},${Lt})`,opacity:qt}};for(I in M)Y=M[I],ee.style[I]=Y;const le=a.value;if(le!=null){const $t=le.style;for(I in le)Y=le[I],["style","className"].includes(I)||(ee[I]=Y);if($t!=null)for(I in $t)Y=$t[I],ee.style[I]=Y}return ee.className+=" "+((le!=null?le.className:void 0)!=null?le!=null?le.className:void 0:"mathbox-label"),b.push(w("div",ee,ut))};return C.reset=()=>{b=[],[T,e,n]=Array.from([this.strideI,this.strideJ,this.strideK]);const S=h.value,L=H=>Math.floor(H*255);if(P=S?`rgb(${[L(S.x),L(S.y),L(S.z)]})`:"",A=`mathbox-outline-${Math.round(f.value)}`,M={},S&&(M.color=P),M.fontSize=`${l.value}px`,c.value!==1&&(M.zoom=c.value),g.value>0&&(M.zIndex=g.value),d.value)return M.pointerEvents="auto"},C.nodes=()=>b,C}resize(){let t,e;if(this.readback==null)return;const n=this.bind.points.getActiveDimensions(),i=this.bind.html.getActiveDimensions(),r=Math.min(n.items,i.items),o=Math.min(n.width,i.width),a=Math.min(n.height,i.height),l=Math.min(n.depth,i.depth);this.readback.setActive(r,o,a,l),this.strideI=t=i.items,this.strideJ=e=t*i.width,this.strideK=e*i.height}change(t,e,n){if(t["dom.html"]||t["dom.points"])return this.rebuild()}}qT.initClass();class WT extends Du{static initClass(){this.traits=["node","buffer","active","data","texture","voxel","text","font"],this.defaults={minFilter:"linear",magFilter:"linear"},this.finals={channels:1}}init(){return super.init(),this.atlas=null}textShader(t){return this.atlas.shader(t)}textIsSDF(){return this.props.sdf>0}textHeight(){return this.props.detail}make(){let{minFilter:t,magFilter:e,type:n}=this.props;const{font:i,style:r,variant:o,weight:a,detail:l,sdf:c}=this.props;this.atlas=this._renderables.make("textAtlas",{font:i,size:l,style:r,variant:o,weight:a,outline:c,minFilter:t,magFilter:e,type:n}),this.minFilter=Ve,this.magFilter=Ve,this.type=Cn,Ru.prototype.make.call(this),t=this.minFilter!=null?this.minFilter:this.props.minFilter,e=this.magFilter!=null?this.magFilter:this.props.magFilter,n=this.type!=null?this.type:this.props.type;const{width:h}=this.props,{height:f}=this.props,{depth:d}=this.props,m=this.props.bufferWidth,g=this.props.bufferHeight,y=this.props.bufferDepth,{channels:_}=this.props,{items:v}=this.props;let w=this.spec={channels:_,items:v,width:h,height:f,depth:d};this.items=w.items,this.channels=w.channels;const{data:b}=this.props;w=oo(b,w);const{space:M}=this;M.width=Math.max(m,w.width||1),M.height=Math.max(g,w.height||1),M.depth=Math.max(y,w.depth||1),this.buffer=this._renderables.make(this.storage,{width:M.width,height:M.height,depth:M.depth,channels:4,items:v,minFilter:t,magFilter:e,type:n});const{atlas:A}=this,{emit:T}=this.buffer.streamer;return this.buffer.streamer.emit=P=>A.map(P,T)}unmake(){if(super.unmake(),this.atlas)return this.atlas.dispose(),this.atlas=null}update(){return this.atlas.begin(),super.update(),this.atlas.end()}change(t,e,n){return e.font?this.rebuild():super.change(t,e,n)}}WT.initClass();class Kn extends Jd{static initClass(){this.traits=["node","bind","operator","source","index"]}indexShader(t){return Y1(this.bind.source,"indexShader",e=>e.indexShader(t))}sourceShader(t){return Y1(this.bind.source,"sourceShader",e=>e.sourceShader(t))}getDimensions(){return this.bind.source.getDimensions()}getFutureDimensions(){return this.bind.source.getFutureDimensions()}getActiveDimensions(){return this.bind.source.getActiveDimensions()}getIndexDimensions(){return this.bind.source.getIndexDimensions()}init(){return this.sourceSpec=[{to:"operator.source",trait:"source",optional:!0}]}make(){return super.make(),this._helpers.bind.make(this.sourceSpec)}made(){return this.resize(),super.made()}unmake(){return this._helpers.bind.unmake()}resize(t){return this.trigger({type:"source.resize"})}}Kn.initClass();function Y1(s,t,e){if(typeof s<"u"&&s!==null&&typeof s[t]=="function")return e(s,t)}class $T extends Kn{static initClass(){this.traits=["node","bind","operator","texture","text","format","font"],this.defaults={minFilter:"linear",magFilter:"linear"}}init(){return super.init(),this.atlas=this.buffer=this.used=this.time=null,this.filled=!1}sourceShader(t){return this.buffer.shader(t)}textShader(t){return this.atlas.shader(t)}textIsSDF(){return this.props.sdf>0}textHeight(){return this.props.detail}make(){this._helpers.bind.make([{to:"operator.source",trait:"raw"}]);let{minFilter:t,magFilter:e,type:n}=this.props;const{font:i,style:r,variant:o,weight:a,detail:l,sdf:c}=this.props;this.atlas=this._renderables.make("textAtlas",{font:i,size:l,style:r,variant:o,weight:a,outline:c,minFilter:t,magFilter:e,type:n}),t=Ve,e=Ve,n=Cn;const h=this.bind.source.getDimensions(),{items:f,width:d,height:m,depth:g}=h;this.buffer=this._renderables.make("voxelBuffer",{width:d,height:m,depth:g,channels:4,items:f,minFilter:t,magFilter:e,type:n});const{atlas:y}=this,{emit:_}=this.buffer.streamer;return this.buffer.streamer.emit=v=>y.map(v,_),this.clockParent=this._inherit("clock"),this._listen("root","root.update",this.update)}made(){return super.made(),this.resize()}unmake(){if(super.unmake(),this.buffer&&(this.buffer.dispose(),this.buffer=null),this.atlas)return this.atlas.dispose(),this.atlas=null}update(){if(this.filled&&!this.props.live||!this.through)return;this.time=this.clockParent.getTime();const{used:t}=this;if(this.atlas.begin(),this.used=this.through(),this.buffer.write(this.used),this.atlas.end(),this.filled=!0,t!==this.used)return this.trigger({type:"source.resize"})}change(t,e,n){if(e.font)return this.rebuild();if(t["format.expr"]||t["format.digits"]||t["format.data"]||n){let i,{expr:r}=this.props;const{digits:o,data:a}=this.props;r==null&&(a!=null?r=(c,h,f,d,m)=>a[m]:r=c=>c);const{length:l}=r;return o!=null&&(r=(c=>(h,f,d,m,g,y,_,v,w,b)=>+c(h,f,d,m,g,y,_,v,w,b).toPrecision(o))(r)),l>8?i=(c,h,f,d,m,g,y,_,v,w,b)=>c(r(h,f,d,m,g,y,_,v,this.time.clock,this.time.step)):i=(c,h,f,d,m,g,y,_,v)=>c(r(h,f,d,m,g,y,_,v)),this.through=this.bind.source.rawBuffer().through(i,this.buffer)}}}$T.initClass();class XT extends bn{static initClass(){this.traits=["node","bind","object","visible","style","label","attach","geometry","position"]}make(){let t;if(super.make(),this._helpers.bind.make([{to:"label.text",trait:"text"},{to:"geometry.points",trait:"source"},{to:"geometry.colors",trait:"source"}]),this.bind.points==null||this.bind.text==null)return;const e=this.bind.points.getDimensions(),n=this.bind.text.getDimensions(),i=this.bind.text.textIsSDF(),r=Math.min(e.items,n.items),o=Math.min(e.width,n.width),a=Math.min(e.height,n.height),l=Math.min(e.depth,n.depth);let c=this.bind.points.sourceShader(this._shaders.shader());c=this._helpers.position.pipeline(c);const h=this.bind.text.sourceShader(this._shaders.shader()),f=this._shaders.shader().pipe("label.map");f.pipe(this.bind.text.textShader(this._shaders.shader()));const d={spriteDepth:this.node.attributes["attach.depth"],spriteOffset:this.node.attributes["attach.offset"],spriteSnap:this.node.attributes["attach.snap"],spriteScale:this._attributes.make(this._types.number()),outlineStep:this._attributes.make(this._types.number()),outlineExpand:this._attributes.make(this._types.number()),outlineColor:this.node.attributes["label.background"]};this.spriteScale=d.spriteScale,this.outlineStep=d.outlineStep,this.outlineExpand=d.outlineExpand;const m=i?"label.outline":"label.alpha",g=this._shaders.shader().pipe(m,d);this.bind.colors&&(t=this._shaders.shader(),this.bind.colors.sourceShader(t));const y=this._helpers.object.mask(),_=this._helpers.style.uniforms(),v=this._inherit("unit").getUnitUniforms(),w=Si(v,_,d);return this.sprite=this._renderables.make("sprite",{uniforms:w,width:o,height:a,depth:l,items:r,position:c,sprite:h,map:f,combine:g,color:t,mask:y,linear:!0}),this._helpers.visible.make(),this._helpers.object.make([this.sprite])}unmake(){return this._helpers.bind.unmake(),this._helpers.visible.unmake(),this._helpers.object.unmake(),this.sprite=null}resize(){const t=this.bind.points.getActiveDimensions(),e=this.bind.text.getActiveDimensions(),n=Math.min(t.items,e.items),i=Math.min(t.width,e.width),r=Math.min(t.height,e.height),o=Math.min(t.depth,e.depth);return this.sprite.geometry.clip(i,r,o,n)}change(t,e,n){if(e.geometry||t["label.text"])return this.rebuild();if(this.bind.points==null)return;const{size:i}=this.props,{outline:r}=this.props,{expand:o}=this.props,a=this.bind.text.textHeight(),l=i/a;return this.outlineExpand.value=o/l*16/255,this.outlineStep.value=r/l*16/255,this.spriteScale.value=l}}XT.initClass();class My extends Kn{static initClass(){this.traits=["node","bind","operator","source","index","resample","sampler:x","sampler:y","sampler:z","sampler:w","include"]}indexShader(t){return t.pipe(this.indexer),super.indexShader(t)}sourceShader(t){return t.pipe(this.operator)}getDimensions(){return this._resample(this.bind.source.getDimensions())}getActiveDimensions(){return this._resample(this.bind.source.getActiveDimensions())}getFutureDimensions(){return this._resample(this.bind.source.getFutureDimensions())}getIndexDimensions(){return this._resample(this.bind.source.getIndexDimensions())}_resample(t){const e=this.resampled,n=this.centered,i=this.padding;return this.relativeSize?(n.items||t.items--,n.width||t.width--,n.height||t.height--,n.depth||t.depth--,e.items!=null&&(t.items*=e.items),e.width!=null&&(t.width*=e.width),e.height!=null&&(t.height*=e.height),e.depth!=null&&(t.depth*=e.depth),n.items||t.items++,n.width||t.width++,n.height||t.height++,n.depth||t.depth++,t.items-=i.items*2,t.width-=i.width*2,t.height-=i.height*2,t.depth-=i.depth*2):(e.items!=null&&(t.items=e.items),e.width!=null&&(t.width=e.width),e.height!=null&&(t.height=e.height),e.depth!=null&&(t.depth=e.depth)),t.items=Math.max(0,Math.floor(t.items)),t.width=Math.max(0,Math.floor(t.width)),t.height=Math.max(0,Math.floor(t.height)),t.depth=Math.max(0,Math.floor(t.depth)),t}make(){if(super.make(),this.bind.source==null)return;this._helpers.bind.make([{to:"include.shader",trait:"shader",optional:!0}]);const{indices:t,channels:e}=this.props,{shader:n}=this.bind,{sample:i,size:r,items:o,width:a,height:l,depth:c}=this.props,h=i===this.node.attributes["resample.sample"].enum.relative,f=r===this.node.attributes["resample.size"].enum.relative;this.resampled={},o!=null&&(this.resampled.items=o),a!=null&&(this.resampled.width=a),l!=null&&(this.resampled.height=l),c!=null&&(this.resampled.depth=c),this.centered={},this.centered.items=this.props.centeredW,this.centered.width=this.props.centeredX,this.centered.height=this.props.centeredY,this.centered.depth=this.props.centeredZ,this.padding={},this.padding.items=this.props.paddingW,this.padding.width=this.props.paddingX,this.padding.height=this.props.paddingY,this.padding.depth=this.props.paddingZ;const d=this._shaders.shader(),m=this._shaders.shader(),g=[null,this._types.number,this._types.vec2,this._types.vec3,this._types.vec4][t],y={dataSize:this._attributes.make(g(0,0,0,0)),dataResolution:this._attributes.make(g(0,0,0,0)),targetSize:this._attributes.make(g(0,0,0,0)),targetResolution:this._attributes.make(g(0,0,0,0)),resampleFactor:this._attributes.make(this._types.vec4(0,0,0,0)),resampleBias:this._attributes.make(this._types.vec4(0,0,0,0))};this.dataResolution=y.dataResolution,this.dataSize=y.dataSize,this.targetResolution=y.targetResolution,this.targetSize=y.targetSize,this.resampleFactor=y.resampleFactor,this.resampleBias=y.resampleBias;const _=o!=null||a!=null||l!=null||c!=null;d.pipe("resample.padding",y);let v=[],w=!1;const b=["width","height","depth","items"];for(let M=0;M<b.length;M++){const A=b[M],T=this.centered[A];w||(w=T),v[M]=T?"0.5":"0.0"}return w&&(v=`vec4(${v})`,d.pipe(Hi(4,"+",v)),_&&m.pipe(Hi(4,"+",v))),h&&(_?(d.pipe("resample.relative",y),m.pipe("resample.relative",y)):m.pipe(Ws("vec4"))),n!=null?(t!==4&&d.pipe(ao(4,t)),d.callback(),t!==4&&d.pipe(ea(t,4)),w&&d.pipe(Hi(4,"-",v)),d.pipe(this.bind.source.sourceShader(this._shaders.shader())),e!==4&&d.pipe(ao(4,e)),d.join(),this.bind.shader!=null&&d.pipe(this.bind.shader.shaderBind(y)),e!==4&&d.pipe(ea(e,4))):(w&&d.pipe(Hi(4,"-",v)),d.pipe(this.bind.source.sourceShader(this._shaders.shader()))),w&&_&&m.pipe(Hi(4,"-",v)),this.operator=d,this.indexer=m,this.indices=t,this.relativeSample=h,this.relativeSize=f}unmake(){return super.unmake(),this.operator=null}resize(){if(this.bind.source==null)return;const t=this.bind.source.getActiveDimensions(),e=this.getActiveDimensions(),n=d=>{const m=this.centered[d],g=this.padding[d];return e[d]+=g*2,[m?t[d]/Math.max(1,e[d]):Math.max(1,t[d]-1)/Math.max(1,e[d]-1),g]},[i,r]=Array.from(n("width")),[o,a]=Array.from(n("height")),[l,c]=Array.from(n("depth")),[h,f]=Array.from(n("items"));return this.indices===1?(this.dataResolution.value=1/t.width,this.targetResolution.value=1/e.width,this.dataSize.value=t.width,this.targetSize.value=e.width):(this.dataResolution.value.set(1/t.width,1/t.height,1/t.depth,1/t.items),this.targetResolution.value.set(1/e.width,1/e.height,1/e.depth,1/e.items),this.dataSize.value.set(t.width,t.height,t.depth,t.items),this.targetSize.value.set(e.width,e.height,e.depth,e.items)),this.resampleFactor.value.set(i,o,l,h),this.resampleBias.value.set(r,a,c,f),super.resize()}change(t,e,n){if(e.operator||e.resample||e.sampler||e.include)return this.rebuild()}}My.initClass();class jT extends My{static initClass(){this.traits=["node","bind","operator","resample","sampler:x","sampler:y","sampler:z","sampler:w","include","text"]}init(){return this.sourceSpec=[{to:"operator.source",trait:"text"}]}textShader(t){return this.bind.source.textShader(t)}textIsSDF(){return(this.bind.source!=null?this.bind.source.props.sdf:void 0)>0}textHeight(){return this.bind.source!=null?this.bind.source.props.detail:void 0}}jT.initClass();class YT extends Ei{static initClass(){this.traits=["node","clock","seek","play"]}init(){return this.skew=0,this.last=0,this.time={now:+new Date/1e3,time:0,delta:0,clock:0,step:0}}make(){return this._listen("clock","clock.tick",this.tick)}reset(){return this.skew=0}tick(t){const{from:e,to:n,speed:i,seek:r,pace:o,delay:a,realtime:l}=this.props,c=this._inherit("clock").getTime(),h=l?c.time:c.clock,f=l?c.delta:c.step,d=i/o;this.skew+=f*(d-1),this.last>h&&(this.skew=0),this.time.now=c.now+this.skew,this.time.time=c.time,this.time.delta=c.delta;const m=r??c.clock+this.skew;return this.time.clock=Math.min(n,e+Math.max(0,m-a*d)),this.time.step=f*d,this.last=h,this.trigger(t)}getTime(){return this.time}}YT.initClass();class ZT extends Ei{static initClass(){this.traits=["node","clock","now"]}init(){let t;return this.now=t=+new Date/1e3,this.skew=0,this.time={now:t,time:0,delta:0,clock:0,step:0}}make(){return this.clockParent=this._inherit("clock"),this._listen("clock","clock.tick",this.tick)}unmake(){return this.clockParent=null}change(t,e,n){if(t["date.now"])return this.skew=0}tick(t){const{seek:e,pace:n,speed:i}=this.props,r=this.clockParent.getTime();return this.skew+=r.step*n/i,e!=null&&(this.skew=e),this.time.now=this.time.time=this.time.clock=(this.props.now!=null?this.props.now:this.now)+this.skew,this.time.delta=this.time.step=r.delta,this.trigger(t)}getTime(){return this.time}}ZT.initClass();class va extends Ei{static initClass(){this.traits=["node","vertex","fragment"]}vertex(t,e){let n;return(n=Z1(this._inherit("vertex"),i=>i.vertex(t,e)))!=null?n:t}fragment(t,e){let n;return(n=Z1(this._inherit("fragment"),i=>i.fragment(t,e)))!=null?n:t}}va.initClass();function Z1(s,t){return typeof s<"u"&&s!==null?t(s):void 0}class KT extends va{static initClass(){this.traits=["node","vertex","transform3"]}make(){return this.uniforms={transformMatrix:this._attributes.make(this._types.mat4())},this.composer=Fl()}unmake(){return delete this.uniforms}change(t,e,n){if(t["transform3.pass"])return this.rebuild();if(!e.transform3&&!n)return;const i=this.props.position,r=this.props.quaternion,o=this.props.rotation,a=this.props.scale,l=this.props.matrix,c=this.props.eulerOrder;return this.uniforms.transformMatrix.value=this.composer(i,o,r,a,l,c)}vertex(t,e){return e===this.props.pass&&t.pipe("transform3.position",this.uniforms),super.vertex(t,e)}}KT.initClass();class JT extends va{static initClass(){this.traits=["node","vertex","transform4"]}make(){return this.uniforms={transformMatrix:this._attributes.make(this._types.mat4()),transformOffset:this.node.attributes["transform4.position"]},this.transformMatrix=this.uniforms.transformMatrix.value}unmake(){return delete this.uniforms}change(t,e,n){if(t["transform4.pass"])return this.rebuild();if(!e.transform4&&!n)return;const i=this.props.scale,r=this.props.matrix,o=this.transformMatrix;return o.copy(r),o.scale(i)}vertex(t,e){return e===this.props.pass&&t.pipe("transform4.position",this.uniforms),super.vertex(t,e)}}JT.initClass();class QT extends va{static initClass(){this.traits=["node","include","vertex","bind"]}make(){return this._helpers.bind.make([{to:"include.shader",trait:"shader",optional:!0}])}unmake(){return this._helpers.bind.unmake()}change(t,e,n){if(e.include)return this.rebuild()}vertex(t,e){return this.bind.shader!=null&&e===this.props.pass&&t.pipe(this.bind.shader.shaderBind()),super.vertex(t,e)}}QT.initClass();class tC extends va{static initClass(){this.traits=["node","include","fragment","bind"]}make(){return this._helpers.bind.make([{to:"include.shader",trait:"shader",optional:!0}])}unmake(){return this._helpers.bind.unmake()}change(t,e,n){if(e.include||t["fragment.gamma"])return this.rebuild()}fragment(t,e){return this.bind.shader!=null&&e===this.props.pass&&(this.props.gamma&&t.pipe("mesh.gamma.out"),t.pipe(this.bind.shader.shaderBind()),t.split(),this.props.gamma&&t.pipe("mesh.gamma.in"),t.pass()),super.fragment(t,e)}}tC.initClass();class eC extends va{static initClass(){this.traits=["node","vertex","layer"]}make(){return this._listen("root","root.resize",this.update),this.uniforms={layerScale:this._attributes.make(this._types.vec4()),layerBias:this._attributes.make(this._types.vec4())}}update(){const t=this._inherit("root").getCamera(),e=t.aspect!=null?t.aspect:1,n=t.fov!=null?t.fov:1,i=Math.tan(n*Math.PI/360),r=this.node.attributes["layer.fit"].enum;let{fit:o}=this.props;const{depth:a}=this.props;switch(o){case r.contain:o=e>1?r.y:r.x;break;case r.cover:o=e>1?r.x:r.y;break}switch(o){case r.x:this.uniforms.layerScale.value.set(i*e,i*e,1,1);break;case r.y:this.uniforms.layerScale.value.set(i,i,1,1);break}return this.uniforms.layerBias.value.set(0,0,-a,0)}change(t,e,n){if(t["layer.fit"]||t["layer.depth"]||n)return this.update()}vertex(t,e){return e===2?t.pipe("layer.position",this.uniforms):e===3?t.pipe("root.position"):t}}eC.initClass();class nC extends Ei{static initClass(){this.traits=["node","include","mask","bind"]}make(){return this._helpers.bind.make([{to:"include.shader",trait:"shader",optional:!0}])}unmake(){return this._helpers.bind.unmake()}change(t,e,n){if(e.include)return this.rebuild()}mask(t){let e,n;return this.bind.shader!=null?t?(n=this._shaders.shader(),n.pipe(Ws("vec4")),n.fan(),n.pipe(t),n.next(),n.pipe(this.bind.shader.shaderBind()),n.end(),n.pipe("float combine(float a, float b) { return min(a, b); }")):(n=this._shaders.shader(),n.pipe(this.bind.shader.shaderBind())):n=t,(e=oOt(this._inherit("mask"),i=>i.mask(n)))!=null?e:n}}nC.initClass();function oOt(s,t){return typeof s<"u"&&s!==null?t(s):void 0}class iC extends Kn{static initClass(){this.traits=["node","bind","operator","source","index","clamp"]}indexShader(t){return t.pipe(this.operator),super.indexShader(t)}sourceShader(t){return t.pipe(this.operator),super.sourceShader(t)}make(){if(super.make(),this.bind.source==null)return;const t={clampLimit:this._attributes.make(this._types.vec4())};this.clampLimit=t.clampLimit;const e=this._shaders.shader();return e.pipe("clamp.position",t),this.operator=e}unmake(){return super.unmake()}resize(){if(this.bind.source!=null){const t=this.bind.source.getActiveDimensions();this.clampLimit.value.set(t.width-1,t.height-1,t.depth-1,t.items-1)}return super.resize()}change(t,e,n){if(e.operator||e.clamp)return this.rebuild()}}iC.initClass();class sC extends Kn{static initClass(){this.traits=["node","bind","operator","source","index","grow"]}sourceShader(t){return t.pipe(this.operator)}make(){if(super.make(),this.bind.source==null)return;const t={growScale:this.node.attributes["grow.scale"],growMask:this._attributes.make(this._types.vec4()),growAnchor:this._attributes.make(this._types.vec4())};this.growMask=t.growMask.value,this.growAnchor=t.growAnchor.value;const e=this._shaders.shader();return e.require(this.bind.source.sourceShader(this._shaders.shader())),e.pipe("grow.position",t),this.operator=e}unmake(){return super.unmake()}resize(){return this.update(),super.resize()}update(){const t=this.bind.source.getFutureDimensions(),e=["width","height","depth","items"],n=(i,r)=>((i||1)-1)*(.5-r*.5);return(()=>{const i=[];for(let r=0;r<e.length;r++){const o=e[r],a=this.props[o];this.growMask.setComponent(r,+(a==null)),i.push(this.growAnchor.setComponent(r,a!=null?n(t[o],a):0))}return i})()}change(t,e,n){if(e.operator)return this.rebuild();if(e.grow)return this.update()}}sC.initClass();let rC=class extends Kn{static initClass(){this.traits=["node","bind","operator","source","index","join"]}indexShader(t){return t.pipe(this.operator),super.indexShader(t)}sourceShader(t){return t.pipe(this.operator),super.sourceShader(t)}getDimensions(){return this._resample(this.bind.source.getDimensions())}getActiveDimensions(){return this._resample(this.bind.source.getActiveDimensions())}getFutureDimensions(){return this._resample(this.bind.source.getFutureDimensions())}getIndexDimensions(){return this._resample(this.bind.source.getIndexDimensions())}_resample(t){let e,n;const{order:i,axis:r,stride:o}=this,a=["width","height","depth","items"],l=i.map(m=>a[m-1]),c=i.indexOf(r);let h=(()=>{const m=[];for(n of Array.from(l))m.push(t[n]);return m})();const f=((e=h[c+1])!=null?e:1)*o;h.splice(c,2,f),h=h.slice(0,3),h.push(1);const d={};for(let m=0;m<l.length;m++)n=l[m],d[n]=h[m];return d}make(){if(super.make(),this.bind.source==null)return;const{order:t}=this.props;let{axis:e}=this.props,{overlap:n}=this.props;const i=t.join("");e==null&&(e=t[0]);const r=i.indexOf(e),o=i.replace(e,"00").substring(0,4),l=[null,"width","height","depth","items"][e],h=this.bind.source.getDimensions()[l];n=Math.min(h-1,n);const f=h-n,d={joinStride:this._attributes.make(this._types.number(f)),joinStrideInv:this._attributes.make(this._types.number(1/f))},m=this._shaders.shader();return m.require(yi(e,1)),m.require(yi(o,4)),m.require(ly([r,r+1])),m.pipe("join.position",d),m.pipe(Kd(t)),this.operator=m,this.order=t,this.axis=e,this.overlap=n,this.length=h,this.stride=f}unmake(){return super.unmake()}change(t,e,n){if(e.join||e.operator)return this.rebuild()}};rC.initClass();class oC extends Kn{static initClass(){this.traits=["node","bind","operator","source","index","lerp","sampler:x","sampler:y","sampler:z","sampler:w"]}indexShader(t){return t.pipe(this.indexer),super.indexShader(t)}sourceShader(t){return t.pipe(this.operator)}getDimensions(){return this._resample(this.bind.source.getDimensions())}getActiveDimensions(){return this._resample(this.bind.source.getActiveDimensions())}getFutureDimensions(){return this._resample(this.bind.source.getFutureDimensions())}getIndexDimensions(){return this._resample(this.bind.source.getIndexDimensions())}_resample(t){const e=this.resampled,n=this.centered,i=this.padding;return this.relativeSize?(n.items||t.items--,n.width||t.width--,n.height||t.height--,n.depth||t.depth--,e.items!=null&&(t.items*=e.items),e.width!=null&&(t.width*=e.width),e.height!=null&&(t.height*=e.height),e.depth!=null&&(t.depth*=e.depth),n.items||t.items++,n.width||t.width++,n.height||t.height++,n.depth||t.depth++,t.items-=i.items*2,t.width-=i.width*2,t.height-=i.height*2,t.depth-=i.depth*2):(e.items!=null&&(t.items=e.items),e.width!=null&&(t.width=e.width),e.height!=null&&(t.height=e.height),e.depth!=null&&(t.depth=e.depth)),t.items=Math.max(0,Math.floor(t.items)),t.width=Math.max(0,Math.floor(t.width)),t.height=Math.max(0,Math.floor(t.height)),t.depth=Math.max(0,Math.floor(t.depth)),t}make(){let t,e;if(super.make(),this.bind.source==null)return;const{size:n,items:i,width:r,height:o,depth:a}=this.props,l=n===this.node.attributes["lerp.size"].enum.relative;this.resampled={},i!=null&&(this.resampled.items=i),r!=null&&(this.resampled.width=r),o!=null&&(this.resampled.height=o),a!=null&&(this.resampled.depth=a),this.centered={},this.centered.items=this.props.centeredW,this.centered.width=this.props.centeredX,this.centered.height=this.props.centeredY,this.centered.depth=this.props.centeredZ,this.padding={},this.padding.items=this.props.paddingW,this.padding.width=this.props.paddingX,this.padding.height=this.props.paddingY,this.padding.depth=this.props.paddingZ;const c=this._shaders.shader(),h=this._shaders.shader(),f={resampleFactor:this._attributes.make(this._types.vec4(0,0,0,0)),resampleBias:this._attributes.make(this._types.vec4(0,0,0,0))};this.resampleFactor=f.resampleFactor,this.resampleBias=f.resampleBias;const d=i!=null||r!=null||o!=null||a!=null;c.pipe("resample.padding",f);const m=[];let g=!1;const y=["width","height","depth","items"];for(t=0;t<y.length;t++){e=y[t];const b=this.centered[e];g||(g=b),m[t]=b?"0.5":"0.0"}let _;g&&d&&(_=`vec4(${m})`,c.pipe(Hi(4,"+",_)),h.pipe(Hi(4,"+",_))),d?(c.pipe("resample.relative",f),h.pipe("resample.relative",f)):(c.pipe(Ws("vec4")),h.pipe(Ws("vec4"))),g&&d&&(c.pipe(Hi(4,"-",_)),h.pipe(Hi(4,"-",_)));let v=this.bind.source.sourceShader(this._shaders.shader());const w=["width","height","depth","items"];for(t=0;t<w.length;t++){e=w[t];const b=`lerp.${e}`;this.props[e]!=null&&(v=this._shaders.shader().require(v),v.pipe(b,f))}return c.pipe(v),this.operator=c,this.indexer=h,this.relativeSize=l}unmake(){return super.unmake(),this.operator=null}resize(){if(this.bind.source==null)return;const t=this.bind.source.getActiveDimensions(),e=this.getActiveDimensions(),n=d=>{const m=this.centered[d],g=this.padding[d];return e[d]+=g*2,[m?t[d]/Math.max(1,e[d]):Math.max(1,t[d]-1)/Math.max(1,e[d]-1),g]},[i,r]=Array.from(n("width")),[o,a]=Array.from(n("height")),[l,c]=Array.from(n("depth")),[h,f]=Array.from(n("items"));return this.resampleFactor.value.set(i,o,l,h),this.resampleBias.value.set(r,a,c,f),super.resize()}change(t,e,n){if(e.operator||e.lerp||e.sampler)return this.rebuild()}}oC.initClass();let aC=class extends Kn{static initClass(){this.traits=["node","bind","active","operator","source","index","texture","memo"]}sourceShader(t){return this.memo.shaderAbsolute(t,1)}make(){if(super.make(),this.bind.source==null)return;this._helpers.active.make(),this._listen("root","root.update",()=>{if(this.isActive)return this.update()});const{minFilter:t,magFilter:e,type:n}=this.props,i=this.bind.source.getDimensions(),{items:r,width:o,height:a,depth:l}=i;this.memo=this._renderables.make("memo",{items:r,width:o,height:a,depth:l,minFilter:t,magFilter:e,type:n});const c=this._shaders.shader();return this.bind.source.sourceShader(c),this.compose=this._renderables.make("memoScreen",{map:c,items:r,width:o,height:a,depth:l}),this.memo.adopt(this.compose),this.objects=[this.compose],this.renders=this.compose.renders}unmake(){this._helpers.active.unmake(),this.bind.source!=null&&(this.memo.unadopt(this.compose),this.memo.dispose(),this.memo=this.compose=null,super.unmake())}update(){return this.memo!=null?this.memo.render():void 0}resize(){if(this.bind.source==null)return;const t=this.bind.source.getActiveDimensions(),{width:e,height:n,depth:i}=t;return this.compose.cover(e,n,i),super.resize()}change(t,e,n){if(e.texture||e.operator)return this.rebuild()}};aC.initClass();let lC=class extends bn{static initClass(){this.traits=["node","bind","operator","readback","entity","active"],this.finals={channels:4}}init(){return this.emitter=this.root=null,this.active={}}make(){if(super.make(),this._compute("readback.data",()=>this.readback!=null?this.readback.data:void 0),this._compute("readback.items",()=>this.readback!=null?this.readback.items:void 0),this._compute("readback.width",()=>this.readback!=null?this.readback.width:void 0),this._compute("readback.height",()=>this.readback!=null?this.readback.height:void 0),this._compute("readback.depth",()=>this.readback!=null?this.readback.depth:void 0),this._helpers.bind.make([{to:"operator.source",trait:"source"}]),this.bind.source==null)return;const{type:t,channels:e,expr:n}=this.props;this.root=this._inherit("root"),this._listen("root","root.update",this.update);const{items:i,width:r,height:o,depth:a}=this.bind.source.getDimensions(),l=this.bind.source.sourceShader(this._shaders.shader());this.readback=this._renderables.make("readback",{map:l,items:i,width:r,height:o,depth:a,channels:e,type:t}),n!=null&&this.readback.setCallback(n),this._helpers.active.make()}unmake(){return this.readback!=null&&(this.readback.dispose(),this.readback=null,this.root=null,this.emitter=null,this.active={}),this._helpers.active.unmake(),this._helpers.bind.unmake()}update(){this.readback!=null&&this.isActive&&(this.readback.update(this.root!=null?this.root.getCamera():void 0),this.readback.post(),this.props.expr!=null&&this.readback.iterate())}resize(){let t,e;if(this.readback==null)return;const{items:n,width:i,height:r,depth:o}=this.bind.source.getActiveDimensions();return this.readback.setActive(n,i,r,o),this.strideI=t=n,this.strideJ=e=t*i,this.strideK=e*r}change(t,e,n){if(t["readback.type"])return this.rebuild();if(t["readback.expr"]&&this.readback)return this.readback.setCallback(this.props.expr)}};lC.initClass();class cC extends Kn{static initClass(){this.traits=["node","bind","operator","source","index","repeat"]}indexShader(t){return t.pipe(this.operator),super.indexShader(t)}sourceShader(t){return t.pipe(this.operator),super.sourceShader(t)}getDimensions(){return this._resample(this.bind.source.getDimensions())}getActiveDimensions(){return this._resample(this.bind.source.getActiveDimensions())}getFutureDimensions(){return this._resample(this.bind.source.getFutureDimensions())}getIndexDimensions(){return this._resample(this.bind.source.getIndexDimensions())}_resample(t){const e=this.resample;return{items:e.items*t.items,width:e.width*t.width,height:e.height*t.height,depth:e.depth*t.depth}}make(){if(super.make(),this.bind.source==null)return;this.resample={};const t={repeatModulus:this._attributes.make(this._types.vec4())};this.repeatModulus=t.repeatModulus;const e=this._shaders.shader();return e.pipe("repeat.position",t),this.operator=e}unmake(){return super.unmake()}resize(){if(this.bind.source!=null){const t=this.bind.source.getActiveDimensions();this.repeatModulus.value.set(t.width,t.height,t.depth,t.items)}return super.resize()}change(t,e,n){if(e.operator||e.repeat)return this.rebuild();if(n)return["items","width","height","depth"].map(i=>this.resample[i]=this.props[i])}}cC.initClass();class uC extends Kn{static initClass(){this.traits=["node","bind","operator","source","index","reverse"]}getDimensions(){return this.bind.source.getDimensions()}getActiveDimensions(){return this.bind.source.getActiveDimensions()}getFutureDimensions(){return this.bind.source.getFutureDimensions()}getIndexDimensions(){return this.bind.source.getIndexDimensions()}sourceShader(t){return t.pipe("reverse.position",this.uniforms),this.bind.source.sourceShader(t)}_resolveScale(t,e){return this.props[t]?-1:1}_resolveOffset(t,e){const n=this.props[t],i=e[t];return n?i-1:0}make(){if(super.make(),this.bind.source!=null)return this.uniforms={reverseScale:this._attributes.make(this._types.vec4()),reverseOffset:this._attributes.make(this._types.vec4())}}unmake(){return super.unmake()}resize(){if(this.bind.source==null)return;const t=this.bind.source.getActiveDimensions();return this.uniforms.reverseScale.value.set(this._resolveScale("width",t),this._resolveScale("height",t),this._resolveScale("depth",t),this._resolveScale("items",t)),this.uniforms.reverseOffset.value.set(this._resolveOffset("width",t),this._resolveOffset("height",t),this._resolveOffset("depth",t),this._resolveOffset("items",t)),super.resize()}change(t,e,n){if(e.operator)return this.rebuild();if(e.reverse)return this.resize()}}uC.initClass();class hC extends Kn{static initClass(){this.traits=["node","bind","operator","source","index","swizzle"]}sourceShader(t){return t=super.sourceShader(t),this.swizzler&&t.pipe(this.swizzler),t}make(){if(super.make(),this.bind.source==null)return;const{order:t}=this.props;if(t.join()!=="1234")return this.swizzler=yi(t,4)}unmake(){return super.unmake(),this.swizzler=null}change(t,e,n){if(e.swizzle||e.operator)return this.rebuild()}}hC.initClass();class fC extends Kn{static initClass(){this.traits=["node","bind","operator","source","index","spread"]}sourceShader(t){return t.pipe(this.operator)}make(){if(super.make(),this.bind.source==null)return;const t={spreadMatrix:this._attributes.make(this._types.mat4()),spreadOffset:this._attributes.make(this._types.vec4())};this.spreadMatrix=t.spreadMatrix,this.spreadOffset=t.spreadOffset;const e=this._shaders.shader();return e.require(this.bind.source.sourceShader(this._shaders.shader())),e.pipe("spread.position",t),this.operator=e}unmake(){return super.unmake()}resize(){return this.update(),super.resize()}update(){let t,e,n,i;const r=this.bind.source.getFutureDimensions(),a=this.spreadMatrix.value.elements,l=["width","height","depth","items"],c=["alignWidth","alignHeight","alignDepth","alignItems"],{unit:h}=this.props,f=this.node.attributes["spread.unit"].enum,d=(()=>{switch(h){case f.relative:return(m,g,y,_)=>a[g*4+y]=_/Math.max(1,r[m]-1);case f.absolute:return(m,g,y,_)=>a[g*4+y]=_}})();return(()=>{const m=[];for(e=0;e<l.length;e++){let g;t=l[e];const y=this.props[t],_=this.props[c[e]];y!=null?g=-((r[t]!=null?r[t]:1)-1)*(.5-_*.5):g=0,this.spreadOffset.value.setComponent(e,g),m.push((()=>{const v=[];for(n=0;n<=3;n++){let w;i=(w=y!=null?y.getComponent(n):void 0)!=null?w:0,v.push(a[e*4+n]=d(t,e,n,i))}return v})())}return m})()}change(t,e,n){if(e.operator)return this.rebuild();if(e.spread)return this.update()}}fC.initClass();class dC extends Kn{static initClass(){this.traits=["node","bind","operator","source","index","split"]}indexShader(t){return t.pipe(this.operator),super.indexShader(t)}sourceShader(t){return t.pipe(this.operator),super.sourceShader(t)}getDimensions(){return this._resample(this.bind.source.getDimensions())}getActiveDimensions(){return this._resample(this.bind.source.getActiveDimensions())}getFutureDimensions(){return this._resample(this.bind.source.getFutureDimensions())}getIndexDimensions(){return this._resample(this.bind.source.getIndexDimensions())}_resample(t){let e;const{order:n}=this,{axis:i}=this,{overlap:r}=this,{length:o}=this,{stride:a}=this,l=["width","height","depth","items"],c=n.map(g=>l[g-1]),h=n.indexOf(i);let f=(()=>{const g=[];for(e of Array.from(c))g.push(t[e]);return g})();const d=Math.floor((f[h]-r)/a);f.splice(h,1,o,d),f=f.slice(0,4);const m={};for(let g=0;g<c.length;g++)e=c[g],m[e]=f[g];return m}make(){let t;if(super.make(),this.bind.source==null)return;const{order:e}=this.props;let{axis:n}=this.props,{overlap:i}=this.props;const{length:r}=this.props,o=e.join("");n==null&&(n=e[0]);const a=o.indexOf(n),l=o[a]+((t=o[a+1])!=null?t:0),c=o.replace(l[1],"").replace(l[0],"0")+"0";i=Math.min(r-1,i);const h=r-i,f={splitStride:this._attributes.make(this._types.number(h))},d=this._shaders.shader();return d.require(yi(l,2)),d.require(yi(c,4)),d.require(ly(a)),d.pipe("split.position",f),d.pipe(Kd(e)),this.operator=d,this.order=e,this.axis=n,this.overlap=i,this.length=r,this.stride=h}unmake(){return super.unmake()}change(t,e,n){if(t["split.axis"]||t["split.order"]||e.operator)return this.rebuild()}}dC.initClass();class pC extends Kn{static initClass(){this.traits=["node","bind","operator","source","index","slice"]}getDimensions(){return this._resample(this.bind.source.getDimensions())}getActiveDimensions(){return this._resample(this.bind.source.getActiveDimensions())}getFutureDimensions(){return this._resample(this.bind.source.getFutureDimensions())}getIndexDimensions(){return this._resample(this.bind.source.getIndexDimensions())}sourceShader(t){return t.pipe("slice.position",this.uniforms),this.bind.source.sourceShader(t)}_resolve(t,e){const n=this.props[t],i=e[t];if(n==null)return[0,i];const r=function(l,c){return l<0?c+l:l},o=r(Math.round(n.x),i);let a=r(Math.round(n.y),i);return a=Math.max(o,a),[o,a-o]}_resample(t){return t.width=this._resolve("width",t)[1],t.height=this._resolve("height",t)[1],t.depth=this._resolve("depth",t)[1],t.items=this._resolve("items",t)[1],t}make(){if(super.make(),this.bind.source!=null)return this.uniforms={sliceOffset:this._attributes.make(this._types.vec4())}}unmake(){return super.unmake()}resize(){if(this.bind.source==null)return;const t=this.bind.source.getActiveDimensions();return this.uniforms.sliceOffset.value.set(this._resolve("width",t)[0],this._resolve("height",t)[0],this._resolve("depth",t)[0],this._resolve("items",t)[0]),super.resize()}change(t,e,n){if(e.operator)return this.rebuild();if(e.slice)return this.resize()}}pC.initClass();class mC extends Kn{static initClass(){this.traits=["node","bind","operator","source","index","subdivide"]}indexShader(t){return t.pipe(this.indexer),super.indexShader(t)}sourceShader(t){return t.pipe(this.operator)}getDimensions(){return this._resample(this.bind.source.getDimensions())}getActiveDimensions(){return this._resample(this.bind.source.getActiveDimensions())}getFutureDimensions(){return this._resample(this.bind.source.getFutureDimensions())}getIndexDimensions(){return this._resample(this.bind.source.getIndexDimensions())}_resample(t){const e=this.resampled;return t.items--,t.width--,t.height--,t.depth--,e.items!=null&&(t.items*=e.items),e.width!=null&&(t.width*=e.width),e.height!=null&&(t.height*=e.height),e.depth!=null&&(t.depth*=e.depth),t.items++,t.width++,t.height++,t.depth++,t}make(){if(super.make(),this.bind.source==null)return;let{lerp:t}=this.props;const{items:e,width:n,height:i,depth:r}=this.props;this.resampled={},e!=null&&(this.resampled.items=e),n!=null&&(this.resampled.width=n),i!=null&&(this.resampled.height=i),r!=null&&(this.resampled.depth=r);const o=this._shaders.shader(),a=this._shaders.shader(),l={resampleFactor:this._attributes.make(this._types.vec4(0,0,0,0)),subdivideBevel:this.node.attributes["subdivide.bevel"]};this.resampleFactor=l.resampleFactor,this.resampleBias=l.resampleBias,e!=null||n!=null||i!=null||r!=null?(o.pipe("resample.relative",l),a.pipe("resample.relative",l)):(o.pipe(Ws("vec4")),a.pipe(Ws("vec4")));let h=this.bind.source.sourceShader(this._shaders.shader());t=t?".lerp":"";const f=["width","height","depth","items"];for(let d=0;d<f.length;d++){const m=f[d],g=`subdivide.${m}${t}`;this.props[m]!=null&&(h=this._shaders.shader().require(h),h.pipe(g,l))}return o.pipe(h),this.operator=o,this.indexer=a}unmake(){return super.unmake(),this.operator=null}resize(){if(this.bind.source==null)return;const t=this.bind.source.getActiveDimensions(),e=this.getActiveDimensions(),n=l=>Math.max(1,t[l]-1)/Math.max(1,e[l]-1),i=n("width"),r=n("height"),o=n("depth"),a=n("items");return this.resampleFactor.value.set(i,r,o,a),super.resize()}change(t,e,n){if(e.operator||e.subdivide)return this.rebuild()}}mC.initClass();const K1={1:"width",2:"height",3:"depth",4:"items"};class gC extends Kn{static initClass(){this.traits=["node","bind","operator","source","index","transpose"]}indexShader(t){return this.swizzler&&t.pipe(this.swizzler),super.indexShader(t)}sourceShader(t){return this.swizzler&&t.pipe(this.swizzler),super.sourceShader(t)}getDimensions(){return this._remap(this.transpose,this.bind.source.getDimensions())}getActiveDimensions(){return this._remap(this.transpose,this.bind.source.getActiveDimensions())}getFutureDimensions(){return this._remap(this.transpose,this.bind.source.getFutureDimensions())}getIndexDimensions(){return this._remap(this.transpose,this.bind.source.getIndexDimensions())}_remap(t,e){const n={};for(let i=0;i<=3;i++){const r=K1[i+1],o=K1[t[i]];n[r]=e[o]!=null?e[o]:1}return n}make(){if(super.make(),this.bind.source==null)return;const{order:t}=this.props;return t.join()!=="1234"&&(this.swizzler=Kd(t)),this.transpose=t,this.trigger({type:"source.rebuild"})}unmake(){return super.unmake(),this.swizzler=null}change(t,e,n){if(e.transpose||e.operator)return this.rebuild()}}gC.initClass();class Sy extends Ei{static initClass(){this.traits=["node","transition","transform","mask","visible","active"]}init(){return this.animate=null,this.uniforms=null,this.state={isVisible:!0,isActive:!0,enter:1,exit:1},this.latched=null,this.locked=null}make(){this.uniforms={transitionFrom:this._attributes.make(this._types.vec4()),transitionTo:this._attributes.make(this._types.vec4()),transitionActive:this._attributes.make(this._types.bool()),transitionScale:this._attributes.make(this._types.vec4()),transitionBias:this._attributes.make(this._types.vec4()),transitionEnter:this._attributes.make(this._types.number()),transitionExit:this._attributes.make(this._types.number()),transitionSkew:this._attributes.make(this._types.number())};const t=this._inherit("slide"),e=this._inherit("visible"),n=this._inherit("active");return this._listen(t,"transition.latch",i=>this.latch(i.step)),this._listen(t,"transition.release",()=>this.release()),this._listen(e,"visible.change",()=>this.update(this.state.isVisible=e.isVisible)),this._listen(n,"active.change",()=>this.update(this.state.isActive=n.isActive)),this.animate=this._animator.make(this._types.vec2(1,1),{step:i=>(this.state.enter=i.x,this.state.exit=i.y,this.update()),complete:i=>this.complete(i)}),this.move=this.props.from!=null||this.props.to!=null}unmake(){return this.animate.dispose()}latch(t){let e;if(this.locked=null,this.latched=e={isVisible:this.state.isVisible,isActive:this.state.isActive,step:t},!this.isVisible){const i=e.step>=0,[r,o]=Array.from(i?[0,1]:[1,0]);return this.animate.set(r,o)}}release(){const{latched:t}=this,{state:e}=this;if(this.latched=null,t.isVisible!==e.isVisible){const n=t.step>=0,i=e.isVisible,[r,o]=Array.from(i?[1,1]:n?[1,0]:[0,1]);let{duration:a,durationEnter:l,durationExit:c}=this.props;l==null&&(l=a),c==null&&(c=a),a=i*l+!i*c;let{delay:h,delayEnter:f,delayExit:d}=this.props;f==null&&(f=h),d==null&&(d=h),h=i*f+!i*d,this.animate.immediate({x:r,y:o},{duration:a,delay:h,ease:"linear"}),this.locked={isVisible:!0,isActive:t.isActive||e.isActive}}return this.update()}complete(t){if(t)return this.locked=null,this.update()}update(){if(this.latched!=null)return;let{enter:t,exit:e}=this.props;t==null&&({enter:t}=this.state),e==null&&({exit:e}=this.state);const n=t*e;let i=n>0;const r=n<1;this.uniforms.transitionEnter.value=t,this.uniforms.transitionExit.value=e,this.uniforms.transitionActive.value=r,i&&(i=!!this.state.isVisible),this.locked!=null&&(i=this.locked.isVisible),this.isVisible!==i&&(this.isVisible=i,this.trigger({type:"visible.change"}));const o=!!(this.state.isActive||this.locked!=null&&this.locked.isActive);if(this.isActive!==o)return this.isActive=o,this.trigger({type:"active.change"})}change(t,e,n){if((t["transition.enter"]||t["transition.exit"]||n)&&this.update(),t["transition.stagger"]||n){const{stagger:i}=this.props,r=i.x<0,o=i.y<0,a=i.z<0,l=i.w<0,c=Math.abs(i.x),h=Math.abs(i.y),f=Math.abs(i.z),d=Math.abs(i.w);return this.uniforms.transitionSkew.value=c+h+f+d,this.uniforms.transitionScale.value.set((1-r*2)*c,(1-o*2)*h,(1-a*2)*f,(1-l*2)*d),this.uniforms.transitionBias.value.set(r*c,o*h,a*f,l*d)}}}Sy.initClass();class vC extends Sy{static initClass(){this.traits=["node","transition","vertex","move","visible","active"]}make(){super.make();const t={moveFrom:this.node.attributes["move.from"],moveTo:this.node.attributes["move.to"]};for(const e in t){const n=t[e];this.uniforms[e]=n}}vertex(t,e){let n;return e===this.props.pass&&t.pipe("move.position",this.uniforms),(n=aOt(this._inherit("vertex"),i=>i.vertex(t,e)))!=null?n:t}}vC.initClass();function aOt(s,t){return typeof s<"u"&&s!==null?t(s):void 0}function lp(s,t,e){return Math.max(t,Math.min(e,s))}function uu(s){return .5-.5*Math.cos(lp(s,0,1)*Math.PI)}function Ay(s){return+(s>=.5)}function Ey(s){return+(s>=1)}const lOt=Object.freeze(Object.defineProperty({__proto__:null,binary:Ay,clamp:lp,cosine:uu,hold:Ey},Symbol.toStringTag,{value:"Module"})),Lc=function(s){const t={};for(const e in s){const n=s[e];n instanceof Array?t[e]=n.slice():n!=null&&typeof n=="object"?t[e]=Lc(n):t[e]=n}return t};class Ty extends bn{static initClass(){this.traits=["node","track","seek","bind"]}init(){return this.handlers={},this.script=null,this.values=null,this.playhead=0,this.velocity=null,this.section=null,this.expr=null}make(){let t;this._helpers.bind.make([{to:"track.target",trait:"node",callback:null}]);const{script:e}=this.props,{node:n}=this.bind.target;return this.targetNode=n,[this.script,this.values,this.start,this.end]=Array.from(t=this._process(n,e)),t}unmake(){return this.unbindExpr(),this._helpers.bind.unmake(),this.script=this.values=this.start=this.end=this.section=this.expr=null,this.playhead=0}bindExpr(t){this.unbindExpr(),this.expr=t,this.targetNode.bind(t,!0);const{clock:e}=this.targetNode,n=this;return this._attributes.bind(this.measure=function(){let i=null;return()=>{const{step:r}=e.getTime();return i!=null&&(n.velocity=(n.playhead-i)/r),i=n.playhead}}())}unbindExpr(){return this.expr!=null&&this.targetNode.unbind(this.expr,!0),this.measure!=null&&this._attributes.unbind(this.measure),this.expr=this.measure=null}_process(t,e){let n,i,r,o,a,l,c;if(e instanceof Array){a={};for(let y=0;y<e.length;y++)l=e[y],a[y]=l;e=a}a=[];for(i in e)l=e[i],l==null&&(l=[]),l instanceof Array?l={key:+i,props:l[0]!=null?Lc(l[0]):{},bind:l[1]!=null?Lc(l[1]):{}}:(l.key==null&&!l.props&&!l.bind?l={props:Lc(l)}:l=Lc(l),l.key=l.key!=null?+l.key:+i,l.props==null&&(l.props={}),l.bind==null&&(l.bind={})),a.push(l);if(e=a,!e.length)return[[],{},0,0];e.sort((y,_)=>y.key-_.key);const h=e[0].key,f=e[e.length-1].key;for(i in e)l=e[i],r!=null&&(r.next=l),r=l;r.next=r,e=a;const d={},m={};for(i in e){l=e[i];for(n in l.props)c=l.props[n],d[n]=!0}for(i in e){l=e[i];for(n in l.bind)c=l.bind[n],d[n]=!0}for(n in d)d[n]=t.get(n);try{for(n in d)m[n]=[t.attribute(n).T.make(),t.attribute(n).T.make(),t.attribute(n).T.make()]}catch{throw console.warn(this.node.toMarkup()),o=`${this.node.toString()} - Target ${t} has no \`${n}\` property`,new Error(o)}const g=[];for(l of Array.from(e)){for(n in d)if(c=d[n],c=t.validate(n,l.props[n]!=null?l.props[n]:c),d[n]=l.props[n]=c,l.bind[n]!=null&&typeof l.bind[n]!="function")throw console.warn(this.node.toMarkup()),o=`${this.node.toString()} - Bind expression \`${l.bind[n]}\` on property \`${n}\` is not a function`,new Error(o);g.push(l)}return[g,m,h,f]}update(){let{playhead:t}=this;const{script:e}=this,{ease:n,seek:i}=this.props,r=this.targetNode;if(i!=null&&(t=i),e.length){let o;const a=function(){let b=e[0];for(let M=0;M<e.length;M++){const A=e[M];if(A.key>t)break;b=A}return b};let{section:l}=this;if((!l||t<l.key||t>l.next.key)&&(l=a()),l===this.section)return;this.section=l;const c=l,h=l.next,f=c.key,d=h.key,m=(()=>{switch(n){case"linear":case 0:return lp;case"cosine":case 1:return uu;case"binary":case 2:return Ay;case"hold":case 3:return Ey;default:return uu}})(),{clock:g}=r,y=b=>{if(this.velocity==null)return this.playhead;const M=g.getTime();return this.playhead+this.velocity*(b-M.time)},_=function(){const b=1/Math.max(1e-4,d-f);return M=>m((y(M)-f)*b,0,1)}(),v=b=>{const M=c.bind[b],A=h.bind[b],T=c.props[b],P=h.props[b],C=function(){throw console.warn(r.toMarkup()),new Error(`${this.node.toString()} - Invalid expression result on track \`${b}\``)},S=r.attribute(b),L=this.values[b],H=this._animator;return M&&A?(($,B,G)=>function(I,et){let Y,J;return $[0]=Y=S.T.validate(M(I,et),$[0],C),$[1]=J=S.T.validate(A(I,et),$[1],C),$[2]=H.lerp(S.T,Y,J,_(I),$[2])})(L):M?(($,B,G)=>function(I,et){let Y;return $[0]=Y=S.T.validate(M(I,et),$[0],C),$[1]=H.lerp(S.T,Y,P,_(I),$[1])})(L):A?(($,B,G)=>function(I,et){let Y;return $[0]=Y=S.T.validate(A(I,et),$[0],C),$[1]=H.lerp(S.T,T,Y,_(I),$[1])})(L):(($,B,G)=>(I,et)=>$[0]=H.lerp(S.T,T,P,_(I),$[0]))(L)},w={};for(o in c.bind)w[o]==null&&(w[o]=v(o));for(o in h.bind)w[o]==null&&(w[o]=v(o));for(o in c.props)w[o]==null&&(w[o]=v(o));for(o in h.props)w[o]==null&&(w[o]=v(o));return this.bindExpr(w)}}change(t,e,n){if(t["track.target"]||t["track.script"]||t["track.mode"])return this.rebuild();if(t["seek.seek"]||n)return this.update()}}Ty.initClass();class _C extends Ty{static initClass(){this.traits=["node","track","trigger","play","bind"]}init(){return super.init(),this.skew=null,this.start=null}reset(t){return t==null&&(t=!0),this.skew=t?0:null,this.start=null}make(){super.make(),this._listen("slide","slide.step",e=>{const{trigger:n}=this.props;if(n!=null&&e.index===n)return this.reset();if(n!=null&&e.index===0)return this.reset(!1)}),(!this.props.trigger||this._inherit("slide")==null)&&this.reset();const t=this._inherit("clock");return this._listen(t,"clock.tick",()=>{const{from:e,to:n,speed:i,pace:r,delay:o,realtime:a}=this.props,l=t.getTime();if(this.skew!=null){const c=a?l.time:l.clock,h=a?l.delta:l.step,f=i/r;this.start==null&&(this.start=c),this.skew+=h*(f-1);let d=Math.max(0,c-this.start+this.skew-o*f);this.props.loop&&(d=d%(n-e)),this.playhead=Math.min(n,e+d)}else this.playhead=0;return this.update()})}update(){return super.update()}change(t,e,n){return t["trigger.trigger"]||t["play.realtime"]?this.rebuild():super.change(t,e,n)}}_C.initClass();class yC extends Ei{static initClass(){this.traits=["node","present"]}init(){}make(){return this.nodes=[],this.steps=[],this.length=0,this.last=[],this.index=0,this.dirty=[],this._listen("root","root.update",this.update),this._compute("present.length",()=>this.length)}adopt(t){const{node:e}=t;return this.nodes.indexOf(t)<0&&this.nodes.push(e),this.dirty.push(t)}unadopt(t){return this.nodes=this.nodes.filter(e=>e!==t),this.dirty.push(t)}update(){if(this.dirty.length){for(const t of Array.from(this.dirty))this.slideReset(t);return[this.steps,this.indices]=Array.from(this.process(this.nodes)),this.length=this.steps.length,this.index=null,this.go(this.props.index),this.dirty=[]}}slideLatch(t,e,n){return t.slideLatch(e,n)}slideStep(t,e,n){return t.slideStep(this.mapIndex(t,e),n)}slideRelease(t,e){return t.slideRelease()}slideReset(t){return t.slideReset()}mapIndex(t,e){return e-this.indices[t.node._id]}process(t){const e=m=>Array.from(m).map(g=>i(g).filter(r)),i=(m=>g=>(()=>{let y,_;const v=[];for(;g&&([g,y]=Array.from(_=[m(g),g]),_);)v.push(y);return v})())(function(m){return m.parent.traits.hash.present?null:m.parent}),r=m=>t.indexOf(m)>=0,o=m=>m.sort(function(g,y){const _=g.length,v=y.length;let w=Math.min(_,v);for(let b=1,M=w,A=1<=M;A?b<=M:b>=M;A?b++:b--){const T=g[_-b],P=y[v-b],C=T.props.order,S=P.props.order;if(C!=null||S!=null){if(C!=null&&S!=null&&(w=C-S)!==0)return w;if(C!=null)return-1;if(S!=null)return 1}if(P.order!==T.order)return P.order-T.order}return w=_-v,w!==0?w:0}),a=function(m){const g=[],y=[];for(const _ of Array.from(m))(_[0].props.steps!=null?g:y).push(_);return[g,y]},l=function(m){let g;const[y,_]=Array.from(m),v=100,w={};let b=[];const M=function(T,P){let C;const{props:S}=C=T[0],L=T[1],H=L!=null?w[L._id]:0,$=P;let B=S.from!=null?H+S.from:$-S.early,G=S.to!=null?H+S.to:$+S.steps+S.late;B=Math.max(0,B),G=Math.min(v,G),w[C._id]==null&&(w[C._id]=B);for(let I=B,et=G,Y=B<=et;Y?I<et:I>et;Y?I++:I--)b[I]=(b[I]!=null?b[I]:b[I]=[]).concat(T);return S.steps};let A=0;for(g of Array.from(y))A+=M(g,A);for(g of Array.from(_))M(g,0);return b=(()=>{const T=[];for(g of Array.from(b))T.push(h(c(g)));return T})(),[b,w]},c=function(m){return m?(()=>{const g=[];for(let y=0;y<m.length;y++){const _=m[y];m.indexOf(_)===y&&g.push(_)}return g})():[]},h=m=>m.sort((g,y)=>g.order-y.order),f=e(t),d=o(f);return l(a(d))}go(t){let e,n;t=Math.max(0,Math.min(this.length+1,+t||0));const i=(e=this.steps[t-1])!=null?e:[],r=this.props.directed?t-this.index:1;this.index=t;const o=(()=>{const f=[];for(n of Array.from(i))this.last.indexOf(n)<0&&f.push(n);return f})(),a=(()=>{const f=[];for(n of Array.from(this.last))i.indexOf(n)<0&&f.push(n);return f})(),l=(()=>{const f=[];for(n of Array.from(i))o.indexOf(n)<0&&a.indexOf(n)<0&&f.push(n);return f})(),c=f=>f.sort((d,m)=>d.order-m.order),h=f=>f.sort((d,m)=>m.order-d.order);for(n of Array.from(c(o)))this.slideLatch(n.controller,!0,r);for(n of Array.from(c(l)))this.slideLatch(n.controller,null,r);for(n of Array.from(c(a)))this.slideLatch(n.controller,!1,r);for(n of Array.from(o))this.slideStep(n.controller,t,r);for(n of Array.from(l))this.slideStep(n.controller,t,r);for(n of Array.from(a))this.slideStep(n.controller,t,r);for(n of Array.from(h(o)))this.slideRelease(n.controller);for(n of Array.from(h(l)))this.slideRelease(n.controller);for(n of Array.from(h(a)))this.slideRelease(n.controller);this.last=i}change(t,e,n){if(t["present.index"]||n)return this.go(this.props.index)}}yC.initClass();class xC extends Sy{static initClass(){this.traits=["node","transition","mask","visible","active"]}mask(t){let e,n;return t?(n=this._shaders.shader(),n.pipe(Ws("vec4")),n.fan(),n.pipe(t,this.uniforms),n.next(),n.pipe("reveal.mask",this.uniforms),n.end(),n.pipe("float combine(float a, float b) { return min(a, b); }")):(n=this._shaders.shader(),n.pipe("reveal.mask",this.uniforms)),(e=cOt(this._inherit("mask"),i=>i.mask(n)))!=null?e:n}}xC.initClass();function cOt(s,t){return typeof s<"u"&&s!==null?t(s):void 0}class bC extends Ei{static initClass(){this.traits=["node","slide","visible","active"]}make(){if(this._helpers.visible.make(),this._helpers.active.make(),!this._inherit("present"))throw new Error(`${this.node.toString()} must be placed inside <present></present>`);return this._inherit("present").adopt(this)}unmake(){return this._helpers.visible.unmake(),this._helpers.active.unmake(),this._inherit("present").unadopt(this)}change(t,e,n){if(t["slide.early"]||t["slide.late"]||t["slide.steps"]||t["slide.from"]||t["slide.to"])return this.rebuild()}slideLatch(t,e){if(this.trigger({type:"transition.latch",step:e}),t!=null)return this._instant(t)}slideStep(t,e){return this.trigger({type:"slide.step",index:t,step:e})}slideRelease(){return this.trigger({type:"transition.release"})}slideReset(){return this._instant(!1),this.trigger({type:"slide.reset"})}_instant(t){return this.setVisible(t),this.setActive(t)}}bC.initClass();class wC extends Ty{static initClass(){this.traits=["node","track","step","trigger","bind"]}make(){super.make();const t=this._inherit("clock");return this.actualIndex==null&&(this.actualIndex=null),this.animateIndex=this._animator.make(this._types.number(0),{clock:t,realtime:this.props.realtime,step:e=>this.actualIndex=e}),this.lastIndex==null&&(this.lastIndex=null),this.animateStep=this._animator.make(this._types.number(0),{clock:t,realtime:this.props.realtime,step:e=>(this.playhead=e,this.update())}),this.stops=this.props.stops!=null?this.props.stops:uOt(0,this.script.length,!1),this._listen("slide","slide.reset",e=>this.lastIndex=null),this._listen("slide","slide.step",e=>{let n,{duration:i}=this.props;const{delay:r,pace:o,speed:a,playback:l,rewind:c,skip:h,trigger:f}=this.props,d=Math.max(0,Math.min(this.stops.length-1,e.index-f)),m=this.playhead,g=this.stops[d];if(this.lastIndex==null&&f){this.lastIndex=d,this.animateStep.set(g),this.animateIndex.set(d);return}let y=(n=this.actualIndex!=null?this.actualIndex:this.lastIndex)!=null?n:0;const _=d-y,v=this.stops.slice(Math.min(y,d),Math.max(y,d));let w=0;y=v.shift();for(const M of Array.from(v))y===M&&w++,y=M;this.lastIndex=d;let b=a*(e.step>=0?1:c);if(b*=h?Math.max(1,Math.abs(_)-w):1,i+=Math.abs(g-m)*o/b,m!==g)return this.animateIndex.immediate(d,{delay:r,duration:i,ease:l}),this.animateStep.immediate(g,{delay:r,duration:i,ease:l})})}made(){return this.update()}unmake(){return this.animateIndex.dispose(),this.animateStep.dispose(),this.animateIndex=this.animateStep=null,super.unmake()}change(t,e,n){return t["step.stops"]||t["step.realtime"]?this.rebuild():super.change(t,e,n)}}wC.initClass();function uOt(s,t,e){const n=[],i=s<t,r=e?i?t+1:t-1:t;for(let o=s;i?o<r:o>r;i?o++:o--)n.push(o);return n}class MC extends Ei{static initClass(){this.traits=["node","root","scene","vertex","texture","rtt","source","index","image"],this.defaults={minFilter:"linear",magFilter:"linear",type:"unsignedByte"}}init(){return this.rtt=this.scene=this.camera=this.width=this.height=this.history=this.rootSize=this.size=null}indexShader(t){return t}imageShader(t){return this.rtt.shaderRelative(t)}sourceShader(t){return this.rtt.shaderAbsolute(t,this.history)}getDimensions(){return{items:1,width:this.width,height:this.height,depth:this.history}}getActiveDimensions(){return this.getDimensions()}make(){let t;if(this.parentRoot=this._inherit("root"),this.rootSize=this.parentRoot.getSize(),this._listen(this.parentRoot,"root.pre",this.pre),this._listen(this.parentRoot,"root.update",this.update),this._listen(this.parentRoot,"root.render",this.render),this._listen(this.parentRoot,"root.post",this.post),this._listen(this.parentRoot,"root.camera",this.setCamera),this._listen(this.parentRoot,"root.resize",function(g){return this.resize(g.size)}),this.rootSize==null)return;const{minFilter:e,magFilter:n,type:i}=this.props,{width:r,height:o,history:a,size:l}=this.props,c=l===this.node.attributes["rtt.size"].enum.relative,h=c?this.rootSize.renderWidth:1,f=c?this.rootSize.renderHeight:1;this.width=Math.round(r!=null?r*h:this.rootSize.renderWidth),this.height=Math.round(o!=null?o*f:this.rootSize.renderHeight),this.history=a,this.aspect=t=this.width/this.height,this.scene==null&&(this.scene=this._renderables.make("scene")),this.rtt=this._renderables.make("renderToTexture",{scene:this.scene,camera:this._context.defaultCamera,width:this.width,height:this.height,frames:this.history,minFilter:e,magFilter:n,type:i}),t=r||o?t:this.rootSize.aspect;const d=r??this.rootSize.viewWidth,m=o??this.rootSize.viewHeight;return this.size={renderWidth:this.width,renderHeight:this.height,aspect:t,viewWidth:d,viewHeight:m,pixelRatio:this.height/m}}made(){if(this.trigger({type:"source.rebuild"}),this.size)return this.trigger({type:"root.resize",size:this.size})}unmake(t){if(this.rtt!=null)return this.rtt.dispose(),t||this.scene.dispose(),this.rtt=this.width=this.height=this.history=null}change(t,e,n){if(e.texture||t["rtt.width"]||t["rtt.height"])return this.rebuild();if(t["root.camera"]||n)return this._unattach(),this._attach(this.props.camera,"camera",this.setCamera,this,this,!0),this.setCamera()}adopt(t){return Array.from(t.renders).map(e=>this.scene.add(e))}unadopt(t){return Array.from(t.renders).map(e=>this.scene.remove(e))}resize(t){let e,n;this.rootSize=t,{width:n,height:e,size:t}=this.props;const i=t===this.node.attributes["rtt.size"].enum.relative;if(!this.rtt||n==null||e==null||i)return this.rebuild()}select(t){return this._root.node.model.select(t,[this.node])}watch(t,e){return this._root.node.model.watch(t,e)}unwatch(t){return this._root.node.model.unwatch(t)}pre(t){return this.trigger(t)}update(t){let e;return(e=this.getOwnCamera())!=null&&(e.aspect=this.aspect||1,e.updateProjectionMatrix()),this.trigger(t)}render(t){return this.trigger(t),this.rtt!=null?this.rtt.render(this.getCamera()):void 0}post(t){return this.trigger(t)}setCamera(){const t=hOt(this.select(this.props.camera)[0],e=>e.controller);if(this.camera!==t)return this.camera=t,this.rtt.camera=this.getCamera(),this.trigger({type:"root.camera"});if(!this.camera)return this.trigger({type:"root.camera"})}getOwnCamera(){return this.camera!=null?this.camera.getCamera():void 0}getCamera(){let t;return(t=this.getOwnCamera())!=null?t:this._inherit("root").getCamera()}vertex(t,e){return e===2?t.pipe("view.position"):e===3?t.pipe("root.position"):t}}MC.initClass();function hOt(s,t){return typeof s<"u"&&s!==null?t(s):void 0}class SC extends bn{static initClass(){this.traits=["node","bind","object","visible","operator","style","compose"],this.defaults={zWrite:!1,zTest:!1,color:"#ffffff"}}init(){return this.compose=null}resize(){if(!this.compose||!this.bind.source)return;const t=this.bind.source.getActiveDimensions(),{width:e}=t,{height:n}=t;return this.remapUVScale.set(e,n)}make(){if(this._helpers.bind.make([{to:"operator.source",trait:"source"}]),this.bind.source==null)return;const t={remapUVScale:this._attributes.make(this._types.vec2())};this.remapUVScale=t.remapUVScale.value;let e=this._shaders.shader();const{alpha:n}=this.props;this.bind.source.is("image")?(e.pipe("screen.pass.uv",t),e=this.bind.source.imageShader(e)):(e.pipe("screen.map.xy",t),e=this.bind.source.sourceShader(e)),n||e.pipe("color.opaque");const i=this._helpers.style.uniforms();return this.compose=this._renderables.make("screen",{map:e,uniforms:i,linear:!0}),this._helpers.visible.make(),this._helpers.object.make([this.compose])}made(){return this.resize()}unmake(){return this._helpers.bind.unmake(),this._helpers.visible.unmake(),this._helpers.object.unmake()}change(t,e,n){if(t["operator.source"]||t["compose.alpha"])return this.rebuild()}}SC.initClass();class ho extends va{static initClass(){this.traits=["node","object","visible","view","vertex"]}make(){return this._helpers.visible.make()}unmake(){return this._helpers.visible.unmake()}axis(t){return this.props.range[t-1]}}ho.initClass();class AC extends ho{static initClass(){this.traits=["node","object","visible","view","view3","vertex"]}make(){super.make(),this.uniforms={viewMatrix:this._attributes.make(this._types.mat4())},this.viewMatrix=this.uniforms.viewMatrix.value,this.composer=Fl()}unmake(){super.unmake(),delete this.viewMatrix,delete this.objectMatrix,delete this.uniforms}change(t,e,n){if(!e.view&&!e.view3&&!n)return;const i=this.props.position,r=this.props.scale,o=this.props.quaternion,a=this.props.rotation,l=this.props.range,c=this.props.eulerOrder,{x:h}=l[0],f=l[1].x,d=l[2].x,m=l[0].y-h||1,g=l[1].y-f||1,y=l[2].y-d||1;this.viewMatrix.set(2/m,0,0,-(2*h+m)/m,0,2/g,0,-(2*f+g)/g,0,0,2/y,-(2*d+y)/y,0,0,0,1);const _=this.composer(i,a,o,r,null,c);this.viewMatrix.multiplyMatrices(_,this.viewMatrix),t["view.range"]&&this.trigger({type:"view.range"})}vertex(t,e){return e===1&&t.pipe("cartesian.position",this.uniforms),super.vertex(t,e)}}AC.initClass();class EC extends ho{static initClass(){this.traits=["node","object","visible","view","view4","vertex"]}make(){return super.make(),this.uniforms={basisOffset:this._attributes.make(this._types.vec4()),basisScale:this._attributes.make(this._types.vec4())},this.basisScale=this.uniforms.basisScale.value,this.basisOffset=this.uniforms.basisOffset.value}unmake(){return super.unmake(),delete this.basisScale,delete this.basisOffset,delete this.uniforms}change(t,e,n){if(!e.view&&!e.view4&&!n)return;const i=this.props.position,r=this.props.scale,o=this.props.range,{x:a}=o[0],l=o[1].x,c=o[2].x,h=o[3].x,f=o[0].y-a||1,d=o[1].y-l||1,m=o[2].y-c||1,g=o[3].y-h||1,y=function(_,v){return _.x*=v.x,_.y*=v.y,_.z*=v.z,_.w*=v.w};if(this.basisScale.set(2/f,2/d,2/m,2/g),this.basisOffset.set(-(2*a+f)/f,-(2*l+d)/d,-(2*c+m)/m,-(2*h+g)/g),y(this.basisScale,r),y(this.basisOffset,r),this.basisOffset.add(i),t["view.range"])return this.trigger({type:"view.range"})}vertex(t,e){return e===1&&t.pipe("cartesian4.position",this.uniforms),super.vertex(t,e)}}EC.initClass();class TC extends ho{static initClass(){this.traits=["node","object","visible","view","view3","polar","vertex"]}make(){super.make();const{types:t}=this._attributes;return this.uniforms={polarBend:this.node.attributes["polar.bend"],polarHelix:this.node.attributes["polar.helix"],polarFocus:this._attributes.make(t.number()),polarAspect:this._attributes.make(t.number()),viewMatrix:this._attributes.make(t.mat4())},this.viewMatrix=this.uniforms.viewMatrix.value,this.composer=Fl(),this.aspect=1}unmake(){return super.unmake(),delete this.viewMatrix,delete this.objectMatrix,delete this.aspect,delete this.uniforms}change(t,e,n){let i,r,o;if(!e.view&&!e.view3&&!e.polar&&!n)return;this.helix=this.props.helix,this.bend=r=this.props.bend,this.focus=o=r>0?1/r-1:0;const a=this.props.position,l=this.props.scale,c=this.props.quaternion,h=this.props.rotation,f=this.props.range,d=this.props.eulerOrder,{x:m}=f[0];let g=f[1].x;const y=f[2].x,_=f[0].y-m||1;let v=f[1].y-g||1;const w=f[2].y-y||1,b=l.x,M=l.y,A=_>0?1:-1;[g,v]=Array.from(Cl(g,v,r));const T=Math.abs(v),P=_+(T*A-_)*r,C=P/b,S=v/M;this.aspect=i=Math.abs(C/S),this.uniforms.polarFocus.value=o,this.uniforms.polarAspect.value=i,this.viewMatrix.set(2/P,0,0,-(2*m+_)/_,0,2/v,0,-(2*g+v)/v,0,0,2/w,-(2*y+w)/w,0,0,0,1);const L=this.composer(a,h,c,l,null,d);this.viewMatrix.multiplyMatrices(L,this.viewMatrix),(t["view.range"]||e.polar)&&this.trigger({type:"view.range"})}vertex(t,e){return e===1&&t.pipe("polar.position",this.uniforms),super.vertex(t,e)}axis(t){const e=this.props.range[t-1];let n=e.x,i=e.y;return t===2&&this.bend>0&&(i=Math.max(Math.abs(i),Math.abs(n)),n=Math.max(-this.focus/this.aspect,n)),new pt(n,i)}}TC.initClass();class CC extends ho{static initClass(){this.traits=["node","object","visible","view","view3","spherical","vertex"]}make(){return super.make(),this.uniforms={sphericalBend:this.node.attributes["spherical.bend"],sphericalFocus:this._attributes.make(this._types.number()),sphericalAspectX:this._attributes.make(this._types.number()),sphericalAspectY:this._attributes.make(this._types.number()),sphericalScaleY:this._attributes.make(this._types.number()),viewMatrix:this._attributes.make(this._types.mat4())},this.viewMatrix=this.uniforms.viewMatrix.value,this.composer=Fl(),this.aspectX=1,this.aspectY=1}unmake(){return super.unmake(),delete this.viewMatrix,delete this.objectMatrix,delete this.aspectX,delete this.aspectY,delete this.uniforms}change(t,e,n){let i,r,o,a,l;if(!e.view&&!e.view3&&!e.spherical&&!n)return;this.bend=o=this.props.bend,this.focus=a=o>0?1/o-1:0;const c=this.props.position,h=this.props.scale,f=this.props.quaternion,d=this.props.rotation,m=this.props.range,g=this.props.eulerOrder,{x:y}=m[0];let _=m[1].x,v=m[2].x;const w=m[0].y-y||1;let b=m[1].y-_||1,M=m[2].y-v||1;const A=h.x,T=h.y,P=h.z;[_,b]=Array.from(Cl(_,b,o)),[v,M]=Array.from(Cl(v,M,o));const C=w>0?1:-1,S=b>0?1:-1,L=Math.abs(M),H=w+(L*C-w)*o,$=b+(L*S-b)*o,B=H/A,G=$/T,I=M/P;this.aspectX=i=Math.abs(B/I),this.aspectY=r=Math.abs(G/I/i);const et=b/w*A/T*2;this.scaleY=l=Math.min(r/o,1+(et-1)*o),this.uniforms.sphericalBend.value=o,this.uniforms.sphericalFocus.value=a,this.uniforms.sphericalAspectX.value=i,this.uniforms.sphericalAspectY.value=r,this.uniforms.sphericalScaleY.value=l,this.viewMatrix.set(2/H,0,0,-(2*y+w)/w,0,2/$,0,-(2*_+b)/b,0,0,2/M,-(2*v+M)/M,0,0,0,1);const Y=this.composer(c,d,f,h,null,g);if(this.viewMatrix.multiplyMatrices(Y,this.viewMatrix),t["view.range"]||e.spherical)return this.trigger({type:"view.range"})}vertex(t,e){return e===1&&t.pipe("spherical.position",this.uniforms),super.vertex(t,e)}axis(t){const e=this.props.range[t-1];let n=e.x,i=e.y;return t===3&&this.bend>0&&(i=Math.max(Math.abs(i),Math.abs(n)),n=Math.max(-this.focus/this.aspectX+.001,n)),new pt(n,i)}}CC.initClass();class PC extends ho{static initClass(){this.traits=["node","object","visible","view","view3","stereographic","vertex"]}make(){return super.make(),this.uniforms={stereoBend:this.node.attributes["stereographic.bend"],viewMatrix:this._attributes.make(this._types.mat4())},this.viewMatrix=this.uniforms.viewMatrix.value,this.composer=Fl()}unmake(){return super.unmake(),delete this.viewMatrix,delete this.rotationMatrix,delete this.uniforms}change(t,e,n){let i;if(!e.view&&!e.view3&&!e.stereographic&&!n)return;this.bend=i=this.props.bend;const r=this.props.position,o=this.props.scale,a=this.props.quaternion,l=this.props.rotation,c=this.props.range,h=this.props.eulerOrder,{x:f}=c[0],d=c[1].x;let m=c[2].x;const g=c[0].y-f||1,y=c[1].y-d||1;let _=c[2].y-m||1;[m,_]=Array.from(Cl(m,_,i,1)),this.uniforms.stereoBend.value=i,this.viewMatrix.set(2/g,0,0,-(2*f+g)/g,0,2/y,0,-(2*d+y)/y,0,0,2/_,-(2*m+_)/_,0,0,0,1);const v=this.composer(r,l,a,o,null,h);if(this.viewMatrix.multiplyMatrices(v,this.viewMatrix),t["view.range"]||e.stereographic)return this.trigger({type:"view.range"})}vertex(t,e){return e===1&&t.pipe("stereographic.position",this.uniforms),super.vertex(t,e)}}PC.initClass();class RC extends ho{static initClass(){this.traits=["node","object","visible","view","view4","stereographic","vertex"]}make(){super.make(),this.uniforms={basisOffset:this._attributes.make(this._types.vec4()),basisScale:this._attributes.make(this._types.vec4()),stereoBend:this.node.attributes["stereographic.bend"]},this.basisScale=this.uniforms.basisScale.value,this.basisOffset=this.uniforms.basisOffset.value}unmake(){super.unmake(),delete this.basisScale,delete this.basisOffset,delete this.uniforms}change(t,e,n){let i;if(!e.view&&!e.view4&&!e.stereographic&&!n)return;this.bend=i=this.props.bend;const r=this.props.position,o=this.props.scale,a=this.props.range,{x:l}=a[0],c=a[1].x,h=a[2].x;let f=a[3].x;const d=a[0].y-l||1,m=a[1].y-c||1,g=a[2].y-h||1;let y=a[3].y-f||1;const _=function(v,w){v.x*=w.x,v.y*=w.y,v.z*=w.z,v.w*=w.w};[f,y]=Array.from(Cl(f,y,i,1)),this.basisScale.set(2/d,2/m,2/g,2/y),this.basisOffset.set(-(2*l+d)/d,-(2*c+m)/m,-(2*h+g)/g,-(2*f+y)/y),_(this.basisScale,o),_(this.basisOffset,o),this.basisOffset.add(r),(t["view.range"]||e.stereographic)&&this.trigger({type:"view.range"})}vertex(t,e){return e===1&&t.pipe("stereographic4.position",this.uniforms),super.vertex(t,e)}}RC.initClass();class LC extends bn{static initClass(){this.traits=["node","bind","shader"],this.freeform=!0}init(){return this.shader=null}make(){const{language:t,code:e}=this.props;if(t!=="glsl")throw new Error("GLSL required");this._helpers.bind.make([{to:"shader.sources",trait:"source",multiple:!0}]);const n=this._shaders.fetch(e),i=this._types,r={},o=a=>{let l;switch(a){case"i":return i.int();case"f":return i.number();case"v2":return i.vec2();case"v3":return i.vec3();case"v4":return i.vec4();case"m3":return i.mat3();case"m4":return i.mat4();case"t":return i.object();default:return l=a.split(""),l.pop()==="v"?i.array(o(l.join(""))):null}};for(const a of Array.from(n._signatures.uniform)){let l;(l=o(a.type))&&(r[a.name]=l)}return this.reconfigure({props:{uniform:r}})}made(){return this.trigger({type:"source.rebuild"})}unmake(){return this.shader=null}change(t,e,n){if(t["shader.uniforms"]||t["shader.code"]||t["shader.language"])return this.rebuild()}shaderBind(t){let e,n,i;t==null&&(t={});const{code:r,indices:o,channels:a}=this.props;for(e in this.node.attributes)i=this.node.attributes[e],i.type!=null&&i.short!=null&&i.ns==="uniform"&&t[i.short]==null&&(t[i.short]=i);if((n=this.props.uniforms)!=null)for(e in n)i=n[e],t[e]=i;const l=this._shaders.shader();if(this.bind.sources!=null)for(const c of Array.from(this.bind.sources))l.callback(),o!=4&&l.pipe(ea(o,4)),l.pipe(c.sourceShader(this._shaders.shader())),a!=4&&l.pipe(ao(4,a)),l.join();return l.pipe(r,t)}}LC.initClass();const fOt={axis:OT,face:zT,grid:kT,line:UT,point:NT,strip:FT,surface:BT,ticks:HT,vector:VT,view:ho,cartesian:AC,cartesian4:EC,polar:TC,spherical:CC,stereographic:PC,stereographic4:RC,transform:KT,transform4:JT,vertex:QT,fragment:tC,layer:eC,mask:nC,array:cy,interval:eT,matrix:xy,area:RT,voxel:Du,volume:LT,scale:DT,latch:PT,html:GT,dom:qT,text:WT,format:$T,label:XT,retext:jT,clamp:iC,grow:sC,join:rC,lerp:oC,memo:aC,readback:lC,resample:My,repeat:cC,reverse:uC,swizzle:hC,spread:fC,split:dC,slice:pC,subdivide:mC,transpose:gC,group:VE,inherit:GE,root:qE,unit:WE,shader:LC,camera:XE,rtt:MC,compose:SC,clock:YT,now:ZT,move:vC,play:_C,present:yC,reveal:xC,slide:bC,step:wC},dOt={array(s,t,e=null){const n=s.lerp?function(r,o,a,l){const c=Math.min(r.length,o.length);for(let h=0,f=c,d=0<=f;d?h<f:h>f;d?h++:h--)a[h]=s.lerp(r[h],o[h],a[h],l);return a}:void 0,i=s.op?function(r,o,a,l){const c=Math.min(r.length,o.length);for(let h=0,f=c,d=0<=f;d?h<f:h>f;d?h++:h--)a[h]=s.op(r[h],o[h],a[h],l);return a}:void 0;return e!=null&&!(e instanceof Array)&&(e=[e]),{uniform(){if(s.uniform)return s.uniform()+"v"},make(){return e!=null?e.slice():t?mOt(0,t,!1).map(r=>s.make()):[]},validate(r,o,a){r instanceof Array||(r=[r]);const l=o.length=t||r.length;for(let c=0,h=l,f=0<=h;f?c<h:c>h;f?c++:c--){const d=r[c]!=null?r[c]:s.make();o[c]=s.validate(d,o[c],a)}return o},equals(r,o){const a=r.length,l=o.length;if(a!==l)return!1;const c=Math.min(a,l);for(let h=0,f=c,d=0<=f;d?h<f:h>f;d?h++:h--)if(!(typeof s.equals=="function"&&s.equals(r[h],o[h])))return!1;return!0},lerp:n,op:i,clone(r){return Array.from(r).map(o=>s.clone(o))}}},letters(s,t,e=null){if(e!=null){e===""+e&&(e=e.split(""));for(let i=0;i<e.length;i++){const r=e[i];e[i]=s.validate(r,r)}}const n=ze.array(s,t,e);return{uniform(){return n.uniform()},make(){return n.make()},validate(i,r,o){return i===""+i&&(i=i.split("")),n.validate(i,r,o)},equals(i,r){return n.equals(i,r)},clone:n.clone}},nullable(s,t){t==null&&(t=!1);let e=t?s.make():null;const n=s.emitter?function(o,a){return a==null?o:o==null?a:s.emitter(o,a)}:void 0,i=s.lerp?function(o,a,l,c){return o===null||a===null?c<.5?o:a:(l==null&&(l=s.make()),e=s.lerp(o,a,l,c),l)}:void 0,r=s.op?function(o,a,l,c){return o===null||a===null?null:(l==null&&(l=s.make()),e=s.op(o,a,l,c),e)}:void 0;return{make(){return e},validate(o,a,l){return o===null?o:(a===null&&(a=s.make()),s.validate(o,a,l))},uniform(){return typeof s.uniform=="function"?s.uniform():void 0},equals(o,a){let l;const c=o===null,h=a===null;return c&&h?!0:c^h?!1:(l=typeof s.equals=="function"?s.equals(o,a):void 0)!=null?l:o===a},lerp:i,op:r,emitter:n}},enum(s,t,e){let n;t==null&&(t=[]),e==null&&(e={});let i=0;const r={};for(n of Array.from(t))n!==+n&&e[n]==null&&(e[n]=i++);for(n of Array.from(t))n===+n&&(r[n]=n);for(n in e)i=e[n],r[i]=!0;return r[s]==null&&(s=e[s]),{enum(){return e},make(){return s},validate(o,a,l){const c=r[o]?o:e[o];return c??l()}}},enumber(s,t,e){e==null&&(e={});const n=ze.enum(s,t,e);return{enum:n.enum,uniform(){return"f"},make(){let i;return(i=n.make())!=null?i:+s},validate(i,r,o){return i===+i?i:n.validate(i,r,o)},op(i,r,o,a){return a(i,r)}}},select(s){return s==null&&(s="<"),{make(){return s},validate(t,e,n){return typeof t=="string"||typeof t=="object"?t:n()}}},bool(s){return s=!!s,{uniform(){return"f"},make(){return s},validate(t,e,n){return!!t}}},int(s){return s==null&&(s=0),s=+Math.round(s),{uniform(){return"i"},make(){return s},validate(t,e,n){let i;return t!==(i=+t)?n():Math.round(i)||0},op(t,e,n,i){return i(t,e)}}},round(s){return s==null&&(s=0),s=+Math.round(s),{uniform(){return"f"},make(){return s},validate(t,e,n){let i;return t!==(i=+t)?n():Math.round(i)||0},op(t,e,n,i){return i(t,e)}}},number(s){return s==null&&(s=0),{uniform(){return"f"},make(){return+s},validate(t,e,n){let i;return t!==(i=+t)?n():i||0},op(t,e,n,i){return i(t,e)}}},positive(s,t){return t==null&&(t=!1),{uniform:s.uniform,make:s.make,validate(e,n,i){return e=s.validate(e,n,i),e<0||t&&e<=0?i():e},op(e,n,i,r){return r(e,n)}}},string(s){return s==null&&(s=""),{make(){return""+s},validate(t,e,n){let i;return t!==(i=""+t)?n():i}}},func(){return{make(){return function(){}},validate(s,t,e){return typeof s=="function"?s:e()}}},emitter(){return{make(){return s=>s(1,1,1,1)},validate(s,t,e){return typeof s=="function"?s:e()},emitter(s,t){return YE(s,t)}}},object(s){return{make(){return s??{}},validate(t,e,n){return typeof t=="object"?t:n()},clone(t){return JSON.parse(JSON.stringify(t))}}},timestamp(s=null){return typeof s=="string"&&(s=Date.parse(s)),{uniform(){return"f"},make(){return s??+new Date},validate(t,e,n){return t=Date.parse(t),t!==+t?n():t},op(t,e,n,i){return i(t,e)}}},vec2(s,t){s==null&&(s=0),t==null&&(t=0);const e=[s,t];return{uniform(){return"v2"},make(){return new pt(s,t)},validate(n,i,r){if(n===+n&&(n=[n]),n!=null&&n.isVector2)i.copy(n);else if(n instanceof Array)n=n.concat(e.slice(n.length)),i.set.apply(i,n);else if(n!=null){const o=n.x!=null?n.x:s,a=n.y!=null?n.y:t;i.set(o,a)}else return r();return i},equals(n,i){return n.x===i.x&&n.y===i.y},op(n,i,r,o){return r.x=o(n.x,i.x),r.y=o(n.y,i.y),r}}},ivec2(s,t){s==null&&(s=0),t==null&&(t=0);const e=ze.vec2(s,t),{validate:n}=e;return e.validate=function(i,r,o){return n(i,r,o),r.x=Math.round(r.x),r.y=Math.round(r.y),r},e},vec3(s,t,e){s==null&&(s=0),t==null&&(t=0),e==null&&(e=0);const n=[s,t,e];return{uniform(){return"v3"},make(){return new N(s,t,e)},validate(i,r,o){if(i===+i&&(i=[i]),i!=null&&i.isVector3)r.copy(i);else if(i instanceof Array)i=i.concat(n.slice(i.length)),r.set.apply(r,i);else if(i!=null){const a=i.x!=null?i.x:s,l=i.y!=null?i.y:t,c=i.z!=null?i.z:e;r.set(a,l,c)}else return o();return r},equals(i,r){return i.x===r.x&&i.y===r.y&&i.z===r.z},op(i,r,o,a){return o.x=a(i.x,r.x),o.y=a(i.y,r.y),o.z=a(i.z,r.z),o}}},ivec3(s,t,e){s==null&&(s=0),t==null&&(t=0),e==null&&(e=0);const n=ze.vec3(s,t,e),{validate:i}=n;return n.validate=function(r,o,a){return i(r,o,a),o.x=Math.round(o.x),o.y=Math.round(o.y),o.z=Math.round(o.z),o},n},vec4(s,t,e,n){s==null&&(s=0),t==null&&(t=0),e==null&&(e=0),n==null&&(n=0);const i=[s,t,e,n];return{uniform(){return"v4"},make(){return new Oe(s,t,e,n)},validate(r,o,a){if(r===+r&&(r=[r]),r!=null&&r.isVector4)o.copy(r);else if(r instanceof Array)r=r.concat(i.slice(r.length)),o.set.apply(o,r);else if(r!=null){const l=r.x!=null?r.x:s,c=r.y!=null?r.y:t,h=r.z!=null?r.z:e,f=r.w!=null?r.w:n;o.set(l,c,h,f)}else return a();return o},equals(r,o){return r.x===o.x&&r.y===o.y&&r.z===o.z&&r.w===o.w},op(r,o,a,l){return a.x=l(r.x,o.x),a.y=l(r.y,o.y),a.z=l(r.z,o.z),a.w=l(r.w,o.w),a}}},ivec4(s,t,e,n){s==null&&(s=0),t==null&&(t=0),e==null&&(e=0),n==null&&(n=0);const i=ze.vec4(s,t,e,n),{validate:r}=i;return i.validate=function(o,a,l){return r(o,a,l),a.x=Math.round(a.x),a.y=Math.round(a.y),a.z=Math.round(a.z),a.w=Math.round(a.w),a},i},mat3(s,t,e,n,i,r,o,a,l){s==null&&(s=1),t==null&&(t=0),e==null&&(e=0),n==null&&(n=0),i==null&&(i=1),r==null&&(r=0),o==null&&(o=0),a==null&&(a=0),l==null&&(l=1);const c=[s,t,e,n,i,r,o,a,l];return{uniform(){return"m4"},make(){const h=new Te;return h.set(s,t,e,n,i,r,o,a,l),h},validate(h,f,d){if(h!=null&&h.isMatrix3)f.copy(h);else if(h instanceof Array)h=h.concat(c.slice(h.length)),f.set.apply(f,h);else return d();return f}}},mat4(s,t,e,n,i,r,o,a,l,c,h,f,d,m,g,y){s==null&&(s=1),t==null&&(t=0),e==null&&(e=0),n==null&&(n=0),i==null&&(i=0),r==null&&(r=1),o==null&&(o=0),a==null&&(a=0),l==null&&(l=0),c==null&&(c=0),h==null&&(h=1),f==null&&(f=0),d==null&&(d=0),m==null&&(m=0),g==null&&(g=0),y==null&&(y=1);const _=[s,t,e,n,i,r,o,a,l,c,h,f,d,m,g,y];return{uniform(){return"m4"},make(){const v=new de;return v.set(s,t,e,n,i,r,o,a,l,c,h,f,d,m,g,y),v},validate(v,w,b){if(v!=null&&v.isMatrix4)w.copy(v);else if(v instanceof Array)v=v.concat(_.slice(v.length)),w.set.apply(w,v);else return b();return w}}},quat(s,t,e,n){s==null&&(s=0),t==null&&(t=0),e==null&&(e=0),n==null&&(n=1);const i=ze.vec4(s,t,e,n);return{uniform(){return"v4"},make(){return new Pn},validate(r,o,a){return r!=null&&r.isQuaternion?o.copy(r):o=i.validate(r,o,a),o.normalize(),o},equals(r,o){return r.x===o.x&&r.y===o.y&&r.z===o.z&&r.w===o.w},op(r,o,a,l){return a.x=l(r.x,o.x),a.y=l(r.y,o.y),a.z=l(r.z,o.z),a.w=l(r.w,o.w),a.normalize(),a},lerp(r,o,a,l){return a.slerpQuaternions?a.slerpQuaternions(r,o,l):Pn.slerp(r,o,a,l),a}}},color(s,t,e){s==null&&(s=.5),t==null&&(t=.5),e==null&&(e=.5);const n=[s,t,e];return{uniform(){return"c"},make(){return new Vt(s,t,e)},validate(i,r,o){if(i===""+i?i=new Vt().setStyle(i):i===+i&&(i=new Vt(i)),i!=null&&i.isColor)r.copy(i);else if(i instanceof Array)i=i.concat(n.slice(i.length)),r.setRGB.apply(r,i);else if(i!=null){const a=i.r!=null?i.r:s,l=i.g!=null?i.g:t,c=i.b!=null?i.b:e;r.set(a,l,c)}else return o();return r},equals(i,r){return i.r===r.r&&i.g===r.g&&i.b===r.b},op(i,r,o,a){return o.r=a(i.r,r.r),o.g=a(i.g,r.g),o.b=a(i.b,r.b),o}}},axis(s,t){let e;s==null&&(s=1),t==null&&(t=!1);const n={x:1,y:2,z:3,w:4,W:1,H:2,D:3,I:4,zero:0,null:0,width:1,height:2,depth:3,items:4},i=t?[0,1,2,3,4]:[1,2,3,4];return(e=n[s])!=null&&(s=e),{make(){return s},validate(r,o,a){let l;return(e=n[r])!=null&&(r=e),r=(l=Math.round(r))!=null?l:0,Array.from(i).includes(r)?r:a()}}},transpose(s){s==null&&(s=[1,2,3,4]);const t=ze.letters(ze.axis(null,!1),0,s),e=ze.letters(ze.axis(null,!1),4,s);return{make(){return e.make()},validate(n,i,r){let o=[1,2,3,4];if(t.validate(n,o,r),o.length<4){const l=[1,2,3,4].filter(c=>o.indexOf(c)===-1);o=o.concat(l)}return Array.from(o).map((l,c)=>o.indexOf(l)===c).indexOf(!1)<0?e.validate(o,i,r):r()},equals:e.equals,clone:e.clone}},swizzle(s,t=null){s==null&&(s=[1,2,3,4]),t==null&&(t=s.length),s=s.slice(0,t);const e=ze.letters(ze.axis(null,!1),0,s),n=ze.letters(ze.axis(null,!0),t,s);return{make(){return n.make()},validate(i,r,o){let a=s.slice();return e.validate(i,a,o),a.length<t&&(a=a.concat([0,0,0,0]).slice(0,t)),n.validate(a,r,o)},equals:n.equals,clone:n.clone}},classes(){const s=ze.array(ze.string());return{make(){return s.make()},validate(t,e,n){return t===""+t&&(t=t.split(" ")),t=t.filter(i=>!!i.length),s.validate(t,e,n)},equals:s.equals,clone:s.clone}},blending(s){s==null&&(s="normal");const t=["no","normal","add","subtract","multiply","custom"];return ze.enum(s,t)},filter(s){s==null&&(s="nearest");const t={nearest:Ve,nearestMipMapNearest:Qv,nearestMipMapLinear:t_,linear:fn,linearMipMapNearest:n_,linearMipmapLinear:i_};return ze.enum(s,[],t)},type(s){s==null&&(s="unsignedByte");const t={unsignedByte:ai,byte:_u,short:yu,unsignedShort:aa,int:Ll,unsignedInt:ls,float:Cn};return ze.enum(s,[],t)},scale(s){s==null&&(s="linear");const t=["linear","log"];return ze.enum(s,t)},mapping(s){s==null&&(s="relative");const t=["relative","absolute"];return ze.enum(s,t)},indexing(s){s==null&&(s="original");const t=["original","final"];return ze.enum(s,t)},shape(s){s==null&&(s="circle");const t=["circle","square","diamond","up","down","left","right"];return ze.enum(s,t)},join(s){s==null&&(s="miter");const t=["miter","round","bevel"];return ze.enum(s,t)},stroke(s){s==null&&(s="solid");const t=["solid","dotted","dashed"];return ze.enum(s,t)},vertexPass(s){s==null&&(s="view");const t=["data","view","world","eye"];return ze.enum(s,t)},fragmentPass(s){s==null&&(s="light");const t=["color","light","rgba"];return ze.enum(s,t)},ease(s){s==null&&(s="linear");const t=["linear","cosine","binary","hold"];return ze.enum(s,t)},fit(s){s==null&&(s="contain");const t=["x","y","contain","cover"];return ze.enum(s,t)},anchor(s){s==null&&(s="middle");const t={first:1,middle:0,last:-1};return ze.enumber(s,[],t)},transitionState(s){s==null&&(s="enter");const t={enter:-1,visible:0,exit:1};return ze.enumber(s,[],t)},font(s){s==null&&(s="sans-serif");const t=IT;s instanceof Array||(s=t(s));const e=ze.array(ze.string(),0,s);return{make(){return e.make()},validate(n,i,r){try{n instanceof Array||(n=t(n))}catch{return r()}return n=n.filter(o=>!!o.length),e.validate(n,i,r)},equals:e.equals,clone:e.clone}},data(s){return{make(){return[]},validate(t,e,n){return t instanceof Array||(t!=null?t.length:void 0)!=null?t:n()},emitter(t,e){return ZE(t,e)}}}},pOt=function(s){for(const t in s){const e=s[t];s[t]=(n=>function(){const i=n.apply(n,arguments);return i.validate==null&&(i.validate=r=>r!=null),i.equals==null&&(i.equals=(r,o)=>r===o),i.clone==null&&(i.clone=function(r){let o;return(o=gOt(r,"clone",a=>a.clone()))!=null?o:r}),i})(e)}return s},ze=pOt(dOt);function mOt(s,t,e){const n=[],i=s<t,r=e?i?t+1:t-1:t;for(let o=s;i?o<r:o>r;i?o++:o--)n.push(o);return n}function gOt(s,t,e){if(typeof s<"u"&&s!==null&&typeof s[t]=="function")return e(s,t)}const D=ze,vOt={node:{id:D.nullable(D.string()),classes:D.classes()},entity:{active:D.bool(!0)},object:{visible:D.bool(!0)},latch:{data:D.nullable(D.object()),deep:D.nullable(D.bool(!0))},unit:{scale:D.nullable(D.number()),fov:D.nullable(D.number()),focus:D.nullable(D.number(1),!0)},span:{range:D.nullable(D.vec2(-1,1))},view:{range:D.array(D.vec2(-1,1),4)},view3:{position:D.vec3(),quaternion:D.quat(),rotation:D.vec3(),scale:D.vec3(1,1,1),eulerOrder:D.swizzle("xyz")},view4:{position:D.vec4(),scale:D.vec4(1,1,1,1)},layer:{depth:D.number(1),fit:D.fit("y")},vertex:{pass:D.vertexPass()},fragment:{pass:D.fragmentPass(),gamma:D.bool(!1)},transform3:{position:D.vec3(),quaternion:D.quat(),rotation:D.vec3(),eulerOrder:D.swizzle("xyz"),scale:D.vec3(1,1,1),matrix:D.mat4(1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1)},transform4:{position:D.vec4(),scale:D.vec4(1,1,1,1),matrix:D.mat4(1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1)},camera:{proxy:D.bool(!1),position:D.nullable(D.vec3()),quaternion:D.nullable(D.quat()),rotation:D.nullable(D.vec3()),lookAt:D.nullable(D.vec3()),up:D.nullable(D.vec3()),eulerOrder:D.swizzle("xyz"),fov:D.nullable(D.number(1))},polar:{bend:D.number(1),helix:D.number(0)},spherical:{bend:D.number(1)},stereographic:{bend:D.number(1)},interval:{axis:D.axis()},area:{axes:D.swizzle([1,2],2)},volume:{axes:D.swizzle([1,2,3],3)},origin:{origin:D.vec4()},scale:{divide:D.number(10),unit:D.number(1),base:D.number(10),mode:D.scale(),start:D.bool(!0),end:D.bool(!0),zero:D.bool(!0),factor:D.positive(D.number(1)),nice:D.bool(!0)},grid:{lineX:D.bool(!0),lineY:D.bool(!0),crossed:D.bool(!1),closedX:D.bool(!1),closedY:D.bool(!1)},axis:{detail:D.int(1),crossed:D.bool(!1)},data:{data:D.nullable(D.data()),expr:D.nullable(D.emitter()),bind:D.nullable(D.func()),live:D.bool(!0)},buffer:{channels:D.enum(4,[1,2,3,4]),items:D.int(1),fps:D.nullable(D.int(60)),hurry:D.int(5),limit:D.int(60),realtime:D.bool(!1),observe:D.bool(!1),aligned:D.bool(!1)},sampler:{centered:D.bool(!1),padding:D.number(0)},array:{width:D.nullable(D.positive(D.int(1),!0)),bufferWidth:D.int(1),history:D.int(1)},matrix:{width:D.nullable(D.positive(D.int(1),!0)),height:D.nullable(D.positive(D.int(1),!0)),history:D.int(1),bufferWidth:D.int(1),bufferHeight:D.int(1)},voxel:{width:D.nullable(D.positive(D.int(1),!0)),height:D.nullable(D.positive(D.int(1),!0)),depth:D.nullable(D.positive(D.int(1),!0)),bufferWidth:D.int(1),bufferHeight:D.int(1),bufferDepth:D.int(1)},resolve:{expr:D.nullable(D.func()),items:D.int(1)},style:{opacity:D.positive(D.number(1)),color:D.color(),blending:D.blending(),zWrite:D.bool(!0),zTest:D.bool(!0),zIndex:D.positive(D.round()),zBias:D.number(0),zOrder:D.nullable(D.int())},geometry:{points:D.select(),colors:D.nullable(D.select())},point:{size:D.positive(D.number(4)),sizes:D.nullable(D.select()),shape:D.shape(),optical:D.bool(!0),fill:D.bool(!0),depth:D.number(1)},line:{width:D.positive(D.number(2)),depth:D.positive(D.number(1)),join:D.join(),stroke:D.stroke(),proximity:D.nullable(D.number(1/0)),closed:D.bool(!1)},mesh:{fill:D.bool(!0),shaded:D.bool(!1),normals:D.nullable(D.select()),map:D.nullable(D.select()),lineBias:D.number(5)},strip:{line:D.bool(!1)},face:{line:D.bool(!1)},arrow:{size:D.number(3),start:D.bool(!1),end:D.bool(!1)},ticks:{normal:D.vec3(0,0,1),size:D.positive(D.number(10)),epsilon:D.positive(D.number(.001))},attach:{offset:D.vec2(0,-20),snap:D.bool(!1),depth:D.number(0)},format:{digits:D.nullable(D.positive(D.number(3))),data:D.nullable(D.data()),expr:D.nullable(D.func()),live:D.bool(!0)},font:{font:D.font("sans-serif"),style:D.string(),variant:D.string(),weight:D.string(),detail:D.number(24),sdf:D.number(5)},label:{text:D.select(),size:D.number(16),outline:D.number(2),expand:D.number(0),background:D.color(1,1,1)},overlay:{opacity:D.number(1),zIndex:D.positive(D.round(0))},dom:{points:D.select(),html:D.select(),size:D.number(16),outline:D.number(2),zoom:D.number(1),color:D.nullable(D.color()),attributes:D.nullable(D.object()),pointerEvents:D.bool(!1)},texture:{minFilter:D.filter("nearest"),magFilter:D.filter("nearest"),type:D.type("float")},shader:{sources:D.nullable(D.select()),indices:D.number(4),channels:D.number(4),language:D.string("glsl"),code:D.string(),uniforms:D.nullable(D.object())},include:{shader:D.select()},operator:{source:D.select()},spread:{unit:D.mapping(),items:D.nullable(D.vec4()),width:D.nullable(D.vec4()),height:D.nullable(D.vec4()),depth:D.nullable(D.vec4()),alignItems:D.anchor(),alignWidth:D.anchor(),alignHeight:D.anchor(),alignDepth:D.anchor()},grow:{scale:D.number(1),items:D.nullable(D.anchor()),width:D.nullable(D.anchor()),height:D.nullable(D.anchor()),depth:D.nullable(D.anchor())},split:{order:D.transpose("wxyz"),axis:D.nullable(D.axis()),length:D.int(1),overlap:D.int(0)},join:{order:D.transpose("wxyz"),axis:D.nullable(D.axis()),overlap:D.int(0)},swizzle:{order:D.swizzle()},transpose:{order:D.transpose()},repeat:{items:D.number(1),width:D.number(1),height:D.number(1),depth:D.number(1)},slice:{items:D.nullable(D.vec2()),width:D.nullable(D.vec2()),height:D.nullable(D.vec2()),depth:D.nullable(D.vec2())},reverse:{items:D.bool(!1),width:D.bool(!1),height:D.bool(!1),depth:D.bool(!1)},lerp:{size:D.mapping("absolute"),items:D.nullable(D.number()),width:D.nullable(D.number()),height:D.nullable(D.number()),depth:D.nullable(D.number())},subdivide:{items:D.nullable(D.positive(D.int(),!0)),width:D.nullable(D.positive(D.int(),!0)),height:D.nullable(D.positive(D.int(),!0)),depth:D.nullable(D.positive(D.int(),!0)),bevel:D.number(1),lerp:D.bool(!0)},resample:{indices:D.number(4),channels:D.number(4),sample:D.mapping(),size:D.mapping("absolute"),items:D.nullable(D.number()),width:D.nullable(D.number()),height:D.nullable(D.number()),depth:D.nullable(D.number())},readback:{type:D.type("float"),expr:D.nullable(D.func()),data:D.data(),channels:D.enum(4,[1,2,3,4]),items:D.nullable(D.int()),width:D.nullable(D.int()),height:D.nullable(D.int()),depth:D.nullable(D.int())},root:{speed:D.number(1),camera:D.select("[camera]")},inherit:{source:D.select(),traits:D.array(D.string())},rtt:{size:D.mapping("absolute"),width:D.nullable(D.number()),height:D.nullable(D.number()),history:D.int(1)},compose:{alpha:D.bool(!1)},present:{index:D.int(1),directed:D.bool(!0),length:D.number(0)},slide:{order:D.nullable(D.int(0)),steps:D.number(1),early:D.int(0),late:D.int(0),from:D.nullable(D.int(0)),to:D.nullable(D.int(1))},transition:{stagger:D.vec4(),enter:D.nullable(D.number(1)),exit:D.nullable(D.number(1)),delay:D.number(0),delayEnter:D.nullable(D.number(0)),delayExit:D.nullable(D.number(0)),duration:D.number(.3),durationEnter:D.nullable(D.number(0)),durationExit:D.nullable(D.number(0))},move:{from:D.vec4(),to:D.vec4()},seek:{seek:D.nullable(D.number(0))},track:{target:D.select(),script:D.object({}),ease:D.ease("cosine")},trigger:{trigger:D.nullable(D.int(1),!0)},step:{playback:D.ease("linear"),stops:D.nullable(D.array(D.number())),delay:D.number(0),duration:D.number(.3),pace:D.number(0),speed:D.number(1),rewind:D.number(2),skip:D.bool(!0),realtime:D.bool(!1)},play:{delay:D.number(0),pace:D.number(1),speed:D.number(1),from:D.number(0),to:D.number(1/0),realtime:D.bool(!1),loop:D.bool(!1)},now:{now:D.nullable(D.timestamp()),seek:D.nullable(D.number(0)),pace:D.number(1),speed:D.number(1)}},DC=function(s,t,e,n,i,r,o,a,l,c){let h,f,d;c==null&&(c=!0),e||(e=10),n||(n=1),i||(i=10),r||(r=1);const g=(t-s)/e;if(!c)return h=(()=>{let M,A;const T=[];for(f=0,A=e,M=0<=A;M?f<=A:f>=A;M?f++:f--)T.push(s+f*g);return T})(),o||h.shift(),a||h.pop(),l||(h=h.filter(M=>M!==0)),h;n||(n=1),i||(i=10);const y=n*Math.pow(i,Math.floor(Math.log(g/n)/Math.log(i))),_=i%2===0?[i/2,1,1/2]:i%3===0?[i/3,1,1/3]:[1],v=(()=>{const M=[];for(d of Array.from(_))M.push(y*d);return M})();let w=1/0,b=v.reduce(function(M,A){d=A/g;const T=Math.max(d,1/d);return T<w?(w=T,A):M},y);return b*=r,s=Math.ceil(s/b+ +!o)*b,t=(Math.floor(t/b)-+!a)*b,e=Math.ceil((t-s)/b),h=(()=>{let M,A;const T=[];for(f=0,A=e,M=0<=A;M?f<=A:f>=A;M?f++:f--)T.push(s+f*b);return T})(),l||(h=h.filter(M=>M!==0)),h},IC=function(s,t,e,n,i,r,o,a,l,c){throw new Error("Log ticks not yet implemented.")},_Ot=0,yOt=1,OC=function(s,t,e,n,i,r,o,a,l,c,h){switch(s){case _Ot:return DC(t,e,n,i,r,o,a,l,c,h);case yOt:return IC()}},xOt=Object.freeze(Object.defineProperty({__proto__:null,linear:DC,log:IC,make:OC},Symbol.toStringTag,{value:"Module"})),bOt={bind:{make(s){this.bind==null&&(this.bind={}),this.bound==null&&(this.bound=[]);for(const t of Array.from(s)){let{callback:e}=t;const{to:n,trait:i,optional:r,unique:o,multiple:a}=t;e==null&&(e=this.rebuild);const l=n.split(/\./g).pop(),c=this._get(n);let h=null;if(c!=null){let f=this,d=!1;for(;!d;){f=h=this._attach(c,i,e,this,f,r,a);const m=o&&(h==null||this.bound.indexOf(h)<0);d=a||r||!o||m}}if(h!=null)if(this.resize!=null&&this._listen(h,"source.resize",this.resize),e&&this._listen(h,"source.rebuild",e),a)for(const f of Array.from(h))this.bound.push(f);else this.bound.push(h);this.bind[l]=h}return null},unmake(){if(this.bind)return delete this.bind,delete this.bound}},span:{make(){return this.spanView=this._inherit("view"),this._listen("view","view.range",()=>this.trigger({type:"span.range"}))},unmake(){return delete this.spanView},get:function(){const s=new pt(-1,1);return function(t,e){let n;const i=this._get(t+"span.range");return i??((n=this.spanView!=null?this.spanView.axis(e):void 0)!=null?n:s)}}()},scale:{divide(s){const t=this._get(s+"scale.divide"),e=this._get(s+"scale.factor");return Math.round(t*2.5/e)},generate(s,t,e,n){const i=this._get(s+"scale.mode"),r=this._get(s+"scale.divide"),o=this._get(s+"scale.unit"),a=this._get(s+"scale.base"),l=this._get(s+"scale.factor"),c=this._get(s+"scale.start"),h=this._get(s+"scale.end"),f=this._get(s+"scale.zero"),d=this._get(s+"scale.nice"),m=OC(i,e,n,r,o,a,l,c,h,f,d);return t.copy(m),m}},style:{uniforms(){return{styleColor:this.node.attributes["style.color"],styleOpacity:this.node.attributes["style.opacity"],styleZBias:this.node.attributes["style.zBias"],styleZIndex:this.node.attributes["style.zIndex"]}}},arrow:{uniforms(){const{start:s}=this.props,{end:t}=this.props,e=this._attributes.make(this._types.number(1.25/(s+t))),n=this._attributes.make(this._types.vec2(+s,+t)),i=this.node.attributes["arrow.size"];return{clipStyle:n,clipRange:i,clipSpace:e,arrowSpace:e,arrowSize:i}}},point:{uniforms(){return{pointSize:this.node.attributes["point.size"],pointDepth:this.node.attributes["point.depth"]}}},line:{uniforms(){return{lineWidth:this.node.attributes["line.width"],lineDepth:this.node.attributes["line.depth"],lineProximity:this.node.attributes["line.proximity"]}}},surface:{uniforms(){return{}}},shade:{pipeline(s){if(!this._inherit("fragment"))return s;s==null&&(s=this._shaders.shader());for(let t=0;t<=2;t++)s=J1(this._inherit("fragment"),e=>e.fragment(s,t));return s.pipe("fragment.map.rgba"),s},normal(s){return s.pipe(yi("xyz")),s},map(s){return s&&(s=this._shaders.shader().pipe("mesh.map.uvwo").pipe(s))}},position:{pipeline(s){if(!this._inherit("vertex"))return s;s==null&&(s=this._shaders.shader());for(let t=0;t<=3;t++)s=J1(this._inherit("vertex"),e=>e.vertex(s,t));return s},swizzle(s,t){if(s)return this._shaders.shader().pipe(yi(t)).pipe(s)},swizzle2(s,t,e){if(s)return this._shaders.shader().split().pipe(yi(t)).next().pipe(yi(e)).join().pipe(s)}},visible:{make(){const s={type:"visible.change"};let t=null;this.setVisible=function(i){return i!=null&&(t=i),e()};const e=()=>{let i;const r=this.isVisible;let o=(i=t??this._get("object.visible"))!=null?i:!0;if(n!=null&&o&&(o=n.isVisible),this.isVisible=o,r!==this.isVisible)return this.trigger(s)},n=this._inherit("visible");return n&&this._listen(n,"visible.change",e),this.is("object")&&this._listen(this.node,"change:object",e),e()},unmake(){return delete this.isVisible}},active:{make(){const s={type:"active.change"};let t=null;this.setActive=function(i){return i!=null&&(t=i),e()};const e=()=>{let i;const r=this.isActive;let o=(i=t??this._get("entity.active"))!=null?i:!0;if(n!=null&&o&&(o=n.isActive),this.isActive=o,r!==this.isActive)return this.trigger(s)},n=this._inherit("active");return n&&this._listen(n,"active.change",e),this.is("entity")&&this._listen(this.node,"change:entity",e),e()},unmake(){return delete this.isActive}},object:{make(s){let t,e;s==null&&(s=[]),this.objects=s,this.renders=this.objects.reduce((h,f)=>h.concat(f.renders),[]);const n=this._inherit("scene");let i=t=e=null;const r=Array.from(this.traits).includes("style");i=1,t=Yr;let o=!0,a=!0;r&&({opacity:i}=this.props,{blending:t}=this.props,{zOrder:e}=this.props,{zWrite:o}=this.props,{zTest:a}=this.props);const l=h=>{const{changed:f}=h;let d=null;if(f["style.opacity"]&&(d=i=this.props.opacity),f["style.blending"]&&(d=t=this.props.blending),f["style.zOrder"]&&(d=e=this.props.zOrder),f["style.zWrite"]&&(d=o=this.props.zWrite),f["style.zTest"]&&(d=a=this.props.zTest),d!=null)return c()},c=()=>{const h=e!=null?-e:this.node.order;return(this.isVisible!=null?this.isVisible:!0)&&i>0?r?(()=>{const d=[];for(const m of Array.from(this.objects))m.show(i<1,t,h),d.push(m.depth(o,a));return d})():(()=>{const d=[];for(const m of Array.from(this.objects))d.push(m.show(!0,t,h));return d})():(()=>{const d=[];for(const m of Array.from(this.objects))d.push(m.hide());return d})()};this._listen(this.node,"change:style",l),this._listen(this.node,"reindex",c),this._listen(this,"visible.change",c);for(const h of Array.from(this.objects))n.adopt(h);return c()},unmake(s){let t;if(s==null&&(s=!0),!this.objects)return;const e=this._inherit("scene");for(t of Array.from(this.objects))e.unadopt(t);if(s)return(()=>{const n=[];for(t of Array.from(this.objects))n.push(t.dispose());return n})()},mask(){let s,t;if(s=this._inherit("mask"))return t=s.mask(t)}},unit:{make(){let s,t,e,n,i,r,o,a,l,c,h,f,d=Math.PI;this.unitUniforms={renderScaleInv:a=this._attributes.make(this._types.number(1)),renderScale:o=this._attributes.make(this._types.number(1)),renderAspect:n=this._attributes.make(this._types.number(1)),renderWidth:l=this._attributes.make(this._types.number(0)),renderHeight:i=this._attributes.make(this._types.number(0)),viewWidth:h=this._attributes.make(this._types.number(0)),viewHeight:c=this._attributes.make(this._types.number(0)),pixelRatio:t=this._attributes.make(this._types.number(1)),pixelUnit:e=this._attributes.make(this._types.number(1)),worldUnit:f=this._attributes.make(this._types.number(1)),focusDepth:s=this._attributes.make(this._types.number(1)),renderOdd:r=this._attributes.make(this._types.vec2())};const m=new N,g=new N,y=()=>{let v,w;if((w=_!=null?_.getSize():void 0)==null)return;d=Math.PI;const{scale:b}=this.props,{fov:M}=this.props,A=this.props.focus!=null?this.props.focus:this.inherit("unit").props.focus,T=b===null;let P=1;if(v=_!=null?_.getCamera():void 0){const B=v.projectionMatrix;m.set(0,-.5,1).applyMatrix4(B),g.set(0,.5,1).applyMatrix4(B),m.sub(g),P=m.y}const C=w.renderHeight/w.viewHeight,S=M!=null?P*Math.tan(M*d/360):1,L=T?C:w.renderHeight/b*S,H=w.renderHeight*P/2,$=L/H;return h.value=w.viewWidth,c.value=w.viewHeight,l.value=w.renderWidth,i.value=w.renderHeight,n.value=w.aspect,o.value=H,a.value=1/H,t.value=C,e.value=L,f.value=$,s.value=A,r.value.set(w.renderWidth%2,w.renderHeight%2).multiplyScalar(.5)},_=this.is("root")?this:this._inherit("root");return this._listen(_,"root.update",y),y()},unmake(){return delete this.unitUniforms},get(){const s={};for(const t in this.unitUniforms){const e=this.unitUniforms[t];s[t]=e.value}return s},uniforms(){return this.unitUniforms}}},wOt=function(s,t){const e={};for(const n of Array.from(t)){let i;if(i=bOt[n]){e[n]={};for(const r in i){const o=i[r];e[n][r]=o.bind(s)}}}return e};function J1(s,t){return typeof s<"u"&&s!==null?t(s):void 0}const MOt=Object.freeze(Object.defineProperty({__proto__:null,Classes:fOt,Helpers:wOt,Traits:vOt,Types:D},Symbol.toStringTag,{value:"Module"}));class zC{constructor(t,e){this.context=e,this.classes=t.Classes,this.helpers=t.Helpers}getTypes(){return Object.keys(this.classes)}make(t,e,n=null){e==null&&(e={});const i=this.classes[t];if(i==null)throw new Error(`Unknown primitive class \`${t}\``);const r=new i.model(t,i.defaults,e,n,i,this.context.attributes);return new i(r,this.context,this.helpers),r}}const Mv=MOt,SOt=Object.freeze(Object.defineProperty({__proto__:null,Factory:zC,Primitive:bn,Types:Mv},Symbol.toStringTag,{value:"Module"}));class $l{constructor(t,e){this.renderer=t,this.shaders=e,this.gl=this.renderer.getContext(),this.uniforms==null&&(this.uniforms={})}dispose(){this.uniforms=null}_adopt(t){for(const e in t){const n=t[e];this.uniforms[e]=n}}_set(t){for(const e in t){const n=t[e];this.uniforms[e]!=null&&(this.uniforms[e].value=n)}}}class AOt extends Ne{constructor(){super(),this.rotationAutoUpdate=!1,this.frustumCulled=!1,this.matrixAutoUpdate=!1}}let kC=class extends $l{constructor(t,e,n){super(t,e,n),this.root=new AOt,(n!=null?n.scene:void 0)!=null&&(this.scene=n.scene),this.scene==null&&(this.scene=new zl),this.pending=[],this.async=0,this.scratch=new Wi(1,1),this.camera=new nn}inject(t){return t!=null&&(this.scene=t),this.scene.add(this.root)}unject(){return this.scene!=null?this.scene.remove(this.root):void 0}add(t){return this.async?this.pending.push(t):this._add(t)}remove(t){if(this.pending=this.pending.filter(e=>e!==t),t.parent!=null)return this._remove(t)}_add(t){return this.root.add(t)}_remove(t){return this.root.remove(t)}dispose(){if(this.root.parent!=null)return this.unject()}warmup(t){return this.async=+t||0}render(){if(!this.pending.length)return;const{children:t}=this.root,e=[];for(let r=0,o=this.async,a=0<=o;a?r<o:r>o;a?r++:r--){const l=this.pending.shift();if(!l)break;this._add(l),e.push(e)}const n=t.map(function(r){return r.visible});t.map(r=>r.visible=!Array.from(e).includes(r));const i=this.renderer.getRenderTarget();return this.renderer.setRenderTarget(this.scratch),this.renderer.render(this.scene,this.camera),this.renderer.setRenderTarget(i),t.map((r,o)=>r.visible=n[o])}toJSON(){return this.root.toJSON()}};class UC{constructor(t,e,n){this.classes=t,this.renderer=e,this.shaders=n}getTypes(){return Object.keys(this.classes)}make(t,e){return new this.classes[t](this.renderer,this.shaders,e)}}class NC extends $l{constructor(t,e,n){super(t,e),this.items==null&&(this.items=n.items||1),this.samples==null&&(this.samples=n.samples||1),this.channels==null&&(this.channels=n.channels||4),this.callback==null&&(this.callback=n.callback||function(){})}dispose(){return super.dispose()}update(){const t=this.fill();return this.write(t),t}setActive(t,e,n,i){}setCallback(t){this.callback=t}write(){}fill(){}generate(t){return ry(t,this.samples,this.channels,this.items)}}class Cy{constructor(t,e,n,i,r){this.renderer=t,this.width=e,this.height=n,this.channels=i,this.n=this.width*this.height*this.channels;const o=this.renderer.getContext();this.gl=o;const a=(r!=null?r.minFilter:void 0)!=null?r!=null?r.minFilter:void 0:Ve,l=(r!=null?r.magFilter:void 0)!=null?r!=null?r.magFilter:void 0:Ve,c=(r!=null?r.type:void 0)!=null?r!=null?r.type:void 0:Cn;this.minFilter=Df(o,a),this.magFilter=Df(o,l),this.type=Df(o,c),this.ctor=$E(c),this.build(r)}build(t){const{gl:e}=this,n=this.renderer.state;this.texture=e.createTexture(),this.format=[null,e.LUMINANCE,e.LUMINANCE_ALPHA,e.RGB,e.RGBA][this.channels],this.format3=[null,cd,ud,void 0,Vn][this.channels],n.bindTexture(e.TEXTURE_2D,this.texture),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_S,e.CLAMP_TO_EDGE),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_T,e.CLAMP_TO_EDGE),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MIN_FILTER,this.minFilter),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MAG_FILTER,this.magFilter),this.data=new this.ctor(this.n),e.pixelStorei(e.UNPACK_ALIGNMENT,1),e.texImage2D(e.TEXTURE_2D,0,this.format,this.width,this.height,0,this.format,this.type,this.data),this.textureObject=new xn(new Image,vu,In,In,t!=null?t.minFilter:void 0,t!=null?t.magFilter:void 0),this.textureProperties=this.renderer.properties.get(this.textureObject),this.textureProperties.__webglInit=!0,this.textureProperties.__webglTexture=this.texture,this.textureObject.format=this.format3,this.textureObject.type=Cn,this.textureObject.unpackAlignment=1,this.textureObject.flipY=!1,this.textureObject.generateMipmaps=!1,this.uniforms={dataResolution:{type:"v2",value:new pt(1/this.width,1/this.height)},dataTexture:{type:"t",value:this.textureObject}}}write(t,e,n,i,r){const{gl:o}=this;return this.renderer.state.bindTexture(o.TEXTURE_2D,this.texture),o.pixelStorei(o.UNPACK_ALIGNMENT,1),o.pixelStorei(o.UNPACK_FLIP_Y_WEBGL,!1),o.pixelStorei(o.UNPACK_PREMULTIPLY_ALPHA_WEBGL,!1),o.texSubImage2D(o.TEXTURE_2D,0,e,n,i,r,this.format,this.type,t)}dispose(){return this.gl.deleteTexture(this.texture),this.textureProperties.__webglInit=!1,this.textureProperties.__webglTexture=null,this.textureProperties=null,this.textureObject=this.texture=null}}class cp extends NC{constructor(t,e,n,i){i==null&&(i=!0);const r=n.width||1,o=n.height||1,a=n.depth||1,l=r*o*a;n.samples||(n.samples=l),super(t,e,n),this.width=r,this.height=o,this.depth=a,this.samples==null&&(this.samples=l),i&&this.build(n)}shader(t,e){e==null&&(e=4),this.items>1||this.depth>1?(e!==4&&t.pipe(ea(e,4)),t.pipe("map.xyzw.texture",this.uniforms)):e!==2&&t.pipe(ao(e,2));const n=this.wrap?".wrap":"";return t.pipe(`map.2d.data${n}`,this.uniforms),t.pipe("sample.2d",this.uniforms),this.channels<4&&t.pipe(yi(["0000","x000","xw00","xyz0"][this.channels])),t}build(t){this.data=new Float32Array(this.samples*this.channels*this.items),this.texture=new Cy(this.renderer,this.items*this.width,this.height*this.depth,this.channels,t),this.filled=0,this.used=0,this._adopt(this.texture.uniforms),this._adopt({dataPointer:{type:"v2",value:new pt},textureItems:{type:"f",value:this.items},textureHeight:{type:"f",value:this.height}}),this.dataPointer=this.uniforms.dataPointer.value,this.streamer=this.generate(this.data)}dispose(){return this.data=null,this.texture.dispose(),super.dispose()}getFilled(){return this.filled}setCallback(t){return this.callback=t,this.filled=0}copy(t){const e=Math.min(t.length,this.samples*this.channels*this.items),n=this.data;for(let i=0,r=e,o=0<=r;o?i<r:i>r;o?i++:i--)n[i]=t[i];this.write(Math.ceil(e/this.channels/this.items))}write(t){t==null&&(t=this.samples);let e=t/this.width;t*=this.items;const n=e<1?t:this.items*this.width;e=Math.ceil(e),this.texture.write(this.data,0,0,n,e),this.dataPointer.set(.5,.5),this.filled=1,this.used=t}through(t,e){let n,i;const{consume:r,done:o}=i=this.streamer,{emit:a}=n=e.streamer;let l=0,c=()=>r((h,f,d,m)=>t(a,h,f,d,m,l));return c=Pu(c,this.items),()=>{i.reset(),n.reset();const h=this.used;for(l=0;!o()&&l<h;)c(),l++;return i.count()}}}class EOt extends cp{constructor(t,e,n){const i=n.width||1,r=n.history||1;n.width=i,n.height=r,n.depth=1,super(t,e,n,!1),this.width=i,this.history=r,this.samples=i,this.wrap=r>1,this.build(n)}build(t){return super.build(),this.index=0,this.pad=0,this.streamer=this.generate(this.data)}setActive(t){return this.pad=Math.max(0,this.width-t)}fill(){const{callback:t}=this;typeof t.reset=="function"&&t.reset();const{emit:e,count:n,done:i,reset:r}=this.streamer;r();const o=this.samples-this.pad;let a=0;for(;!i()&&a<o&&t(e,a++)!==!1;);return Math.floor(n()/this.items)}write(t){return t==null&&(t=this.samples),t*=this.items,this.texture.write(this.data,0,this.index,t,1),this.dataPointer.set(.5,this.index+.5),this.index=(this.index+this.history-1)%this.history,this.filled=Math.min(this.history,this.filled+1)}through(t,e){let n,i;const{consume:r,done:o}=i=this.streamer,{emit:a}=n=e.streamer;let l=0,c=()=>r((h,f,d,m)=>t(a,h,f,d,m,l));return c=Pu(c,this.items),()=>{i.reset(),n.reset();const h=this.samples-this.pad;for(l=0;!o()&&l<h;)c(),l++;return i.count()}}}class TOt extends we{constructor(){super(),new we(this),this.uniforms==null&&(this.uniforms={}),this.groups==null&&(this.groups=[])}_reduce(t,e){let n=!1;for(let i=0;i<t.length;i++){const r=t[i],o=e[i];n&&(t[i]=o),r>1&&(n=!0)}return t.reduce((i,r)=>i*r)}_emitter(t){const e=t=="index"?this.getIndex():this.getAttribute(t),n=e.itemSize,{array:i}=e;let r=0;return[null,function(h){i[r++]=h},function(h,f){i[r++]=h,i[r++]=f},function(h,f,d){i[r++]=h,i[r++]=f,i[r++]=d},function(h,f,d,m){i[r++]=h,i[r++]=f,i[r++]=d,i[r++]=m}][n]}_finalize(){}_offsets(t){this.groups=t}}class Xl extends TOt{_clipUniforms(){return this.geometryClip=new Oe(1e10,1e10,1e10,1e10),this.geometryResolution=new Oe,this.mapSize=new Oe,this.uniforms==null&&(this.uniforms={}),this.uniforms.geometryClip={type:"v4",value:this.geometryClip},this.uniforms.geometryResolution={type:"v4",value:this.geometryResolution},this.uniforms.mapSize={type:"v4",value:this.mapSize}}_clipGeometry(t,e,n,i){const r=a=>Math.max(0,a-1),o=a=>1/Math.max(1,a-1);return this.geometryClip.set(r(t),r(e),r(n),r(i)),this.geometryResolution.set(o(t),o(e),o(n),o(i))}_clipMap(t,e,n,i){return this.mapSize.set(t,e,n,i)}_clipOffsets(t,e,n,i,r,o,a,l,c){const h=[i,n,e,r],f=[l,a,o,c],d=this._reduce(h,f);return this._offsets([{start:0,count:d*t,materialIndex:0}])}}class COt extends Xl{constructor(t){let e,n,i,r,o,a,l,c,h,f,d;super(t),this._clipUniforms(),this.sides=c=+t.sides||12,this.samples=l=+t.samples||2,this.strips=h=+t.strips||1,this.ribbons=a=+t.ribbons||1,this.layers=o=+t.layers||1,this.flip=n=t.flip!=null?t.flip:!1,this.closed=i=t.closed!=null?t.closed:!1,this.anchor=e=t.anchor!=null?t.anchor:n||i?0:l-1;const m=h*a*o,g=(c+2)*m,y=c*2*m;this.setIndex(new ue(new Uint32Array(y*3),1)),this.setAttribute("position4",new ue(new Float32Array(g*4),4)),this.setAttribute("arrow",new ue(new Float32Array(g*3),3)),this.setAttribute("attach",new ue(new Float32Array(g*2),2));const _=this._emitter("index"),v=this._emitter("position4"),w=this._emitter("arrow"),b=this._emitter("attach"),M=[];for(r=0,d=c,f=0<=d;f?r<d:r>d;f?r++:r--){const S=r/c*2*Math.PI;M.push([Math.cos(S),Math.sin(S),1])}let A=0;for(let S=0,L=m,H=0<=L;H?S<L:S>L;H?S++:S--){let $,B;const G=A++,I=G+c+1;for(r=0,B=c,$=0<=B;$?r<B:r>B;$?r++:r--){const et=A+r%c,Y=A+(r+1)%c;_(G),_(et),_(Y),_(Y),_(et),_(I)}A+=c+1}const T=n?1:i?l-1:-1,P=n&&!i?l-1:0,C=e;for(let S=0,L=o,H=0<=L;H?S<L:S>L;H?S++:S--)for(let $=0,B=a,G=0<=B;G?$<B:$>B;G?$++:$--)for(let I=0,et=h,Y=0<=et;Y?I<et:I>et;Y?I++:I--){let J,ut;for(v(C,I,$,S),w(0,0,0),b(T,P),r=0,ut=c,J=0<=ut;J?r<ut:r>ut;J?r++:r--){v(C,I,$,S);const dt=M[r];w(dt[0],dt[1],dt[2]),b(T,P)}v(C,I,$,S),w(0,0,1),b(T,P)}this._finalize(),this.clip()}clip(t,e,n,i){let r;if(t==null&&({samples:t}=this),e==null&&({strips:e}=this),n==null&&({ribbons:n}=this),i==null&&({layers:i}=this),this._clipGeometry(t,e,n,i),t>0){const o=[i,n,e],a=[this.layers,this.ribbons,this.strips];r=this.sides*this._reduce(o,a)}else r=0;return this._offsets([{start:0,count:r*6,materialIndex:0}])}}class Cr extends $l{constructor(t,e,n){super(t,e,n),this.zUnits=n.zUnits!=null?n.zUnits:0}raw(){for(const t of Array.from(this.renders))this._raw(t);return null}depth(t,e){for(const n of Array.from(this.renders))this._depth(n,t,e);return null}polygonOffset(t,e){for(const n of Array.from(this.renders))this._polygonOffset(n,t,e);return null}show(t,e,n){return Array.from(this.renders).map(i=>this._show(i,t,e,n))}hide(){for(const t of Array.from(this.renders))this._hide(t);return null}_injectPreamble(t,e){const n=t+`
`+e;return e.match(/#extension/)?this._hoist(n):n}_hoist(t){const e=t.split(`
`),n=[];for(const i of Array.from(e))i.match(/^\s*#extension/)?n.unshift(i):n.push(i);return n.join(`
`)}_material(t){const e=this.renderer.capabilities.precision,n=`    precision ${e} float;
    precision ${e} int;
uniform mat4 modelMatrix;
uniform mat4 modelViewMatrix;
uniform mat4 projectionMatrix;
uniform mat4 viewMatrix;
uniform mat3 normalMatrix;
uniform vec3 cameraPosition;`,i=`    precision ${e} float;
    precision ${e} int;
uniform mat4 viewMatrix;
uniform vec3 cameraPosition;`,r={};Object.assign(r,t),delete r.attributes,delete r.varyings,delete r.inspect,delete r.vertexGraph,delete r.fragmentGraph;const o=new P_(r);return["vertexGraph","fragmentGraph","inspect"].forEach(a=>o[a]=t[a]),o.vertexShader=this._injectPreamble(n,o.vertexShader),o.fragmentShader=this._injectPreamble(i,o.fragmentShader),o}_raw(t){t.rotationAutoUpdate=!1,t.frustumCulled=!1,t.matrixAutoUpdate=!1,t.material.defaultAttributeValues=void 0}_depth(t,e,n){const i=t.material;return i.depthWrite=e,i.depthTest=n}_polygonOffset(t,e,n){n-=this.zUnits;const i=n!==0,r=t.material;if(r.polygonOffset=i,i)return r.polygonOffsetFactor=e,r.polygonOffsetUnits=n}_show(t,e,n,i){e=!0;const r=t.material;return t.renderOrder=-i,t.visible=!0,r.transparent=e,r.blending=n,null}_hide(t){return t.visible=!1}_vertexColor(t,e){if(!t&&!e)return;const n=this.shaders.shader();return t&&(n.require(t),n.pipe("mesh.vertex.color",this.uniforms)),e&&(n.require(e),n.pipe("mesh.vertex.mask",this.uniforms)),n}_vertexPosition(t,e,n,i,r){let o;const a=this.shaders.shader();return(n||e&&e!==!0)&&(o={},(i>0||r)&&(o.POSITION_MAP=""),i>0&&(o[["POSITION_U","POSITION_UV","POSITION_UVW","POSITION_UVWO"][i-1]]=""),r&&(o.POSITION_STPQ="")),a.require(t),a.pipe("mesh.vertex.position",this.uniforms,o)}_fragmentColor(t,e,n,i,r,o,a,l,c){const h=this.shaders.shader();let f=!1,d=!1;const m={};return o>0&&(m[["POSITION_U","POSITION_UV","POSITION_UVW","POSITION_UVWO"][o-1]]=""),a&&(m.POSITION_STPQ=""),t&&(h.pipe("style.color",this.uniforms),f=!0,(n||r||e)&&((!c||n)&&h.pipe("mesh.gamma.in"),d=!0)),n&&(h.isolate(),h.pipe("mesh.fragment.color",this.uniforms),(!c||f)&&h.pipe("mesh.gamma.in"),h.end(),f&&h.pipe(Hi("vec4","*")),c&&f&&h.pipe("mesh.gamma.out"),f=!0,d=!0),r&&(!f&&l&&h.pipe(vv("vec4","vec4(1.0)")),h.isolate(),h.require(r),h.pipe("mesh.fragment.map",this.uniforms,m),c||h.pipe("mesh.gamma.in"),h.end(),l?h.pipe(l):f&&h.pipe(Hi("vec4","*")),f=!0,d=!0),e&&(f||h.pipe(vv("vec4","vec4(1.0)")),e===!0?h.pipe("mesh.fragment.shaded",this.uniforms):(h.require(e),h.pipe("mesh.fragment.material",this.uniforms,m)),d=!0),d&&!c&&h.pipe("mesh.gamma.out"),i&&(h.pipe("mesh.fragment.mask",this.uniforms),f&&h.pipe(Hi("vec4","*"))),h}}class POt extends Cr{constructor(t,e,n){let i;super(t,e,n);let{uniforms:r}=n;const{material:o,position:a,color:l,mask:c,map:h,combine:f,stpq:d,linear:m}=n;r==null&&(r={});const g=r.styleColor!=null;this.geometry=new COt({sides:n.sides,samples:n.samples,strips:n.strips,ribbons:n.ribbons,layers:n.layers,anchor:n.anchor,flip:n.flip,closed:n.closed}),this._adopt(r),this._adopt(this.geometry.uniforms);const y={};closed&&(y.ARROW_CLOSED="");const _=e.material(),v=_.vertex;v.pipe(this._vertexColor(l,c)),v.require(this._vertexPosition(a,o,h,1,d)),v.pipe("arrow.position",this.uniforms,y),v.pipe("project.position",this.uniforms),_.fragment=i=this._fragmentColor(g,o,l,c,h,1,d,f,m),i.pipe("fragment.color",this.uniforms);const w=_.link({side:An});this.material=this._material(w);const b=new Xe(this.geometry,this.material);b.frustumCulled=!1,b.matrixAutoUpdate=!1,b.userData=w,this._raw(b),this.renders=[b]}dispose(){return this.geometry.dispose(),this.material.dispose(),this.renders=this.geometry=this.material=null,super.dispose()}}class ROt extends Cy{constructor(t,e,n,i,r){super(t,e,n,i,r),this.data=new this.ctor(this.n)}resize(t,e){const n=this.data,i=this.width,r=this.height;this.width=t,this.height=e,this.n=t*e*this.channels,this.data=new this.ctor(this.n);const{gl:o}=this;return this.renderer.state.bindTexture(o.TEXTURE_2D,this.texture),o.pixelStorei(o.UNPACK_ALIGNMENT,1),o.texImage2D(o.TEXTURE_2D,0,this.format,t,e,0,this.format,this.type,this.data),this.uniforms.dataResolution.value.set(1/t,1/e),this.write(n,0,0,i,r)}write(t,e,n,i,r){let o;const{width:a}=this,l=this.data,{channels:c}=this;let h=0;if(a===i&&e===0){o=n*i*c;const f=i*r*c;for(;h<f;)l[o++]=t[h++]}else{const f=a*c,d=i*c,m=e*c;let g=n;const y=n+r;for(;g<y;){let _=0;for(o=m+g*f;_++<d;)l[o++]=t[h++];g++}}return super.write(t,e,n,i,r)}dispose(){return this.data=null,super.dispose()}}class FC extends $l{constructor(t,e,n,i){i==null&&(i=!0),super(t,e),this.width==null&&(this.width=n.width||512),this.height==null&&(this.height=n.height||512),this.channels==null&&(this.channels=n.channels||4),this.backed==null&&(this.backed=n.backed||!1),this.samples=this.width*this.height,i&&this.build(n)}shader(t){return t.pipe("map.2d.data",this.uniforms),t.pipe("sample.2d",this.uniforms),this.channels<4&&t.pipe(yi(["0000","x000","xw00","xyz0"][this.channels])),t}build(t){let e;return this.klass=e=this.backed?ROt:Cy,this.texture=new e(this.renderer,this.width,this.height,this.channels,t),this.uniforms={dataPointer:{type:"v2",value:new pt(0,0)}},this._adopt(this.texture.uniforms),this.reset()}reset(){return this.rows=[],this.bottom=0}resize(t,e){if(!this.backed)throw new Error("Cannot resize unbacked texture atlas");return t>2048&&e>2048?console.warn(`Giant text atlas ${t}x${e}.`):console.info(`Resizing text atlas ${t}x${e}.`),this.texture.resize(t,e),this.width=t,this.height=e,this.samples=t*e}collapse(t){let e;const{rows:n}=this;if(n.splice(n.indexOf(t),1),this.bottom=(e=LOt(n[n.length-1],i=>i.bottom))!=null?e:0,this.last===t)return this.last=null}allocate(t,e,n,i){const r=this.width,o=this.height,a=n*2;if(e>r)return this.resize(r*2,o*2),this.last=null,this.allocate(t,e,n,i);let l=this.last;if(l!=null&&l.height>=n&&l.height<a&&l.width+e<=r){l.append(t,e,n,i);return}let c=0,h=-1,f=0;for(let d=0;d<this.rows.length;d++)if(l=this.rows[d],l.top-c>=n&&h<0&&(h=d,f=c),{bottom:c}=l,l.height>=n&&l.height<a&&l.width+e<=r){l.append(t,e,n,i),this.last=l;return}if(h>=0)l=new Q1(f,n),this.rows.splice(h,0,l);else{if(f=c,c+=n,c>=o)return this.resize(r*2,o*2),this.last=null,this.allocate(t,e,n,i);l=new Q1(f,n),this.rows.push(l),this.bottom=c}l.append(t,e,n,i),this.last=l}read(){return this.texture.textureObject}write(t,e,n,i,r){return this.texture.write(t,e,n,i,r)}dispose(){return this.texture.dispose(),this.data=null,super.dispose()}}class Q1{constructor(t,e){this.top=t,this.bottom=t+e,this.width=0,this.height=e,this.alive=0,this.keys=[]}append(t,e,n,i){const r=this.width,o=this.top;return this.alive++,this.width+=e,this.keys.push(t),i(this,r,o)}}function LOt(s,t){return typeof s<"u"&&s!==null?t(s):void 0}class DOt extends Cr{constructor(t,e,n){super(t,e,n),this.geometry=new Il(1,1),this.material=new Tr({map:n.map}),this.material.side=An;const i=new Xe(this.geometry,this.material);i.position.x+=n.x||0,i.position.y+=n.y||0,i.frustumCulled=!1,i.scale.set(2,2,2),i.__debug=!0,this.objects=[i]}dispose(){return this.geometry.dispose(),this.material.dispose(),this.objects=this.geometry=this.material=null,super.dispose()}}class IOt extends Xl{constructor(t){let e,n,i,r,o;super(t),this._clipUniforms(),this.items=i=+t.items||2,this.width=o=+t.width||1,this.height=n=+t.height||1,this.depth=e=+t.depth||1,this.sides=r=Math.max(0,i-2);const a=o*n*e,l=i*a,c=r*a;this.setIndex(new ue(new Uint32Array(c*3),1)),this.setAttribute("position4",new ue(new Float32Array(l*4),4));const h=this._emitter("index"),f=this._emitter("position4");let d=0;for(let m=0,g=a,y=0<=g;y?m<g:m>g;y?m++:m--){for(let _=0,v=r,w=0<=v;w?_<v:_>v;w?_++:_--)h(d),h(d+_+1),h(d+_+2);d+=i}for(let m=0,g=e,y=0<=g;y?m<g:m>g;y?m++:m--)for(let _=0,v=n,w=0<=v;w?_<v:_>v;w?_++:_--)for(let b=0,M=o,A=0<=M;A?b<M:b>M;A?b++:b--)for(let T=0,P=i,C=0<=P;C?T<P:T>P;C?T++:T--)f(b,_,m,T);this._finalize(),this.clip()}clip(t,e,n,i){t==null&&({width:t}=this),e==null&&({height:e}=this),n==null&&({depth:n}=this),i==null&&({items:i}=this);const r=Math.max(0,i-2);return this._clipGeometry(t,e,n,i),this._clipOffsets(3,t,e,n,r,this.width,this.height,this.depth,this.sides)}}class OOt extends Cr{constructor(t,e,n){let i;super(t,e,n);let{uniforms:r,material:o}=n;const{position:a,color:l,mask:c,map:h,combine:f,stpq:d,linear:m}=n;r==null&&(r={}),o==null&&(o=!0);const g=r.styleColor!=null;this.geometry=new IOt({items:n.items,width:n.width,height:n.height,depth:n.depth}),this._adopt(r),this._adopt(this.geometry.uniforms);const y=e.material(),_=y.vertex;_.pipe(this._vertexColor(l,c)),_.require(this._vertexPosition(a,o,h,2,d)),o||_.pipe("face.position",this.uniforms),o&&_.pipe("face.position.normal",this.uniforms),_.pipe("project.position",this.uniforms),y.fragment=i=this._fragmentColor(g,o,l,c,h,2,d,f,m),i.pipe("fragment.color",this.uniforms);const v=y.link({side:An});this.material=this._material(v);const w=new Xe(this.geometry,this.material);w.userData=v,this._raw(w),this.renders=[w]}dispose(){return this.geometry.dispose(),this.material.dispose(),this.renders=this.geometry=this.material=null,super.dispose()}}class zOt extends Xl{constructor(t){let e,n,i,r,o,a,l,c,h,f,d,m,g,y,_;super(t),this._clipUniforms(),this.closed=e=t.closed||!1,this.samples=h=(+t.samples||2)+(e?1:0),this.strips=d=+t.strips||1,this.ribbons=c=+t.ribbons||1,this.layers=l=+t.layers||1,this.detail=n=+t.detail||1;const v=h-1;this.joints=o=n-1,this.vertices=m=(v-(e?0:1))*o+h,this.segments=f=(v-(e?0:1))*o+v;const w=m*d*c*l*2,M=f*d*c*l*2;this.setIndex(new ue(new Uint32Array(M*3),1)),this.setAttribute("position4",new ue(new Float32Array(w*4),4)),this.setAttribute("line",new ue(new Float32Array(w*1),1)),n>1&&this.setAttribute("joint",new ue(new Float32Array(w),1));const A=this._emitter("index"),T=this._emitter("position4"),P=this._emitter("line");n>1&&(r=this._emitter("joint"));let C=0;for(let L=0,H=c*l,$=0<=H;$?L<H:L>H;$?L++:L--)for(let B=0,G=d,I=0<=G;I?B<G:B>G;I?B++:B--){for(let et=0,Y=f,J=0<=Y;J?et<Y:et>Y;J?et++:et--)A(C),A(C+1),A(C+2),A(C+2),A(C+1),A(C+3),C+=2;C+=2}const S=e?()=>0:function(L){return L===0?-1:L===h-1?1:0};if(n>1){let L,H;for(a=0,H=l,L=0<=H;L?a<H:a>H;L?a++:a--){let $,B;for(_=0,B=c,$=0<=B;$?_<B:_>B;$?_++:_--){let G,I;for(y=0,I=d,G=0<=I;G?y<I:y>I;G?y++:y--){let et,Y,J;for(J=0,g=J,Y=h,et=0<=Y;et?J<Y:J>Y;et?J++:J--,g=J)if(i=S(g),i!==0)T(g,y,_,a),T(g,y,_,a),P(1),P(-1),r(.5),r(.5);else for(let ut=0,dt=n,nt=0<=dt;nt?ut<dt:ut>dt;nt?ut++:ut--)T(g,y,_,a),T(g,y,_,a),P(1),P(-1),r(ut/o),r(ut/o)}}}}else{let L,H;for(a=0,H=l,L=0<=H;L?a<H:a>H;L?a++:a--){let $,B;for(_=0,B=c,$=0<=B;$?_<B:_>B;$?_++:_--){let G,I;for(y=0,I=d,G=0<=I;G?y<I:y>I;G?y++:y--){let et,Y,J;for(J=0,g=J,Y=h,et=0<=Y;et?J<Y:J>Y;et?J++:J--,g=J)T(g,y,_,a),T(g,y,_,a),P(1),P(-1)}}}}this._finalize(),this.clip()}clip(t,e,n,i){t==null&&(t=this.samples-this.closed),e==null&&({strips:e}=this),n==null&&({ribbons:n}=this),i==null&&({layers:i}=this);const o=t+(t-(this.closed?0:2))*this.joints-(this.closed?0:1);return t+=this.closed,this._clipGeometry(t,e,n,i),this._clipOffsets(6,o,e,n,i,this.segments,this.strips,this.ribbons,this.layers)}}class kOt extends Cr{constructor(t,e,n){let i;super(t,e,n);let{uniforms:r,stroke:o,join:a}=n;const{material:l,position:c,color:h,mask:f,map:d,combine:m,stpq:g,linear:y,clip:_,proximity:v,closed:w}=n;r==null&&(r={}),o=[null,"dotted","dashed"][o];const b=r.styleColor!=null;a=(i=["miter","round","bevel"][a])!=null?i:"miter";const M={miter:1,round:4,bevel:2}[a];this.geometry=new zOt({samples:n.samples,strips:n.strips,ribbons:n.ribbons,layers:n.layers,anchor:n.anchor,closed:n.closed,detail:M}),this._adopt(r),this._adopt(this.geometry.uniforms);const A=e.material(),T={};o&&(T.LINE_STROKE=""),_&&(T.LINE_CLIP=""),v!=null&&(T.LINE_PROXIMITY=""),T["LINE_JOIN_"+a.toUpperCase()]="",M>1&&(T.LINE_JOIN_DETAIL=M),w&&(T.LINE_CLOSED="");const P=A.vertex;P.pipe(this._vertexColor(h,f)),P.require(this._vertexPosition(c,l,d,2,g)),P.pipe("line.position",this.uniforms,T),P.pipe("project.position",this.uniforms);const C=A.fragment;o&&C.pipe(`fragment.clip.${o}`,this.uniforms),_&&C.pipe("fragment.clip.ends",this.uniforms),v!=null&&C.pipe("fragment.clip.proximity",this.uniforms),C.pipe(this._fragmentColor(b,l,h,f,d,2,g,m,y)),C.pipe("fragment.color",this.uniforms);const S=A.link({side:An});this.material=this._material(S);const L=new Xe(this.geometry,this.material);L.userData=S,this._raw(L),this.renders=[L]}dispose(){return this.geometry.dispose(),this.material.dispose(),this.renders=this.geometry=this.material=null,super.dispose()}}class UOt extends cp{constructor(t,e,n){const i=n.width||1,r=n.height||1,o=n.history||1;n.depth=o,super(t,e,n,!1),this.width=i,this.height=r,this.history=o,this.samples=i*r,this.wrap=o>1,this.build(n)}build(t){return super.build(),this.index=0,this.pad={x:0,y:0},this.streamer=this.generate(this.data)}getFilled(){return this.filled}setActive(t,e){let n;return[this.pad.x,this.pad.y]=Array.from(n=[Math.max(0,this.width-t),Math.max(0,this.height-e)]),n}fill(){let t,e,n;const{callback:i}=this;typeof i.reset=="function"&&i.reset();const{emit:r,skip:o,count:a,done:l,reset:c}=this.streamer;c();const h=this.width,f=this.pad.x,d=this.samples-this.pad.y*h;let m=t=e=0;if(f)for(;!l()&&e<d&&(e++,n=i(r,m,t),++m===h-f&&(o(f),e+=f,m=0,t++),n!==!1););else for(;!l()&&e<d&&(e++,n=i(r,m,t),++m===h&&(m=0,t++),n!==!1););return Math.floor(a()/this.items)}write(t){t==null&&(t=this.samples),t*=this.items;const e=this.width*this.items,n=Math.ceil(t/e);return this.texture.write(this.data,0,this.index*this.height,e,n),this.dataPointer.set(.5,this.index*this.height+.5),this.index=(this.index+this.history-1)%this.history,this.filled=Math.min(this.history,this.filled+1)}through(t,e){let n,i,r;const{consume:o,skip:a,done:l}=r=this.streamer,{emit:c}=n=e.streamer;let h=i=0,f=()=>o((d,m,g,y)=>t(c,d,m,g,y,h,i));return f=Pu(f,this.items),()=>{let d;r.reset(),n.reset();const m=this.width,g=this.pad.x,y=this.samples-this.pad.y*m;if(h=i=d=0,g)for(;!l()&&d<y;)d++,f(),++h===m-g&&(a(g),h=0,i++);else for(;!l()&&d<y;)d++,f(),++h===m&&(h=0,i++);return r.count()}}}class NOt{constructor(t,e,n,i,r){this.gl=t,r==null&&(r={}),r.minFilter==null&&(r.minFilter=Ve),r.magFilter==null&&(r.magFilter=Ve),r.format==null&&(r.format=Vn),r.type==null&&(r.type=ai),this.options=r,this.width=e||1,this.height=n||1,this.frames=i||1,this.buffers=this.frames+1,this.build()}build(){let t;const e=()=>new Wi(this.width,this.height,this.options);this.targets=(()=>{let i,r;const o=[];for(t=0,r=this.buffers,i=0<=r;i?t<r:t>r;i?t++:t--)o.push(e());return o})();const n=[];this.targets.forEach(i=>n.push(i.texture)),this.reads=n,this.write=this.targets[this.buffers-1],this.uniforms={dataResolution:{type:"v2",value:new pt(1/this.width,1/this.height)},dataTexture:{type:"t",value:this.reads[0]},dataTextures:{type:"tv",value:this.reads}}}cycle(){this.targets.unshift(this.targets.pop()),this.write=this.targets[this.buffers-1],this.reads.unshift(this.reads.pop()),this.uniforms.dataTexture.value=this.reads[0]}warmup(t){return(()=>{const e=[];for(let n=0,i=this.buffers,r=0<=i;r?n<i:n>i;r?n++:n--)t(this.write),e.push(this.cycle());return e})()}dispose(){for(const t of Array.from(this.targets))t.dispose();return this.targets=this.reads=this.write=null}}class BC extends $l{constructor(t,e,n){super(t,e),this.scene=n.scene!=null?n.scene:new zl,this.camera=n.camera,this.build(n)}shaderRelative(t){return t==null&&(t=this.shaders.shader()),t.pipe("sample.2d",this.uniforms)}shaderAbsolute(t,e,n){if(e==null&&(e=1),n==null&&(n=4),t==null&&(t=this.shaders.shader()),e<=1)return n>2&&t.pipe(ao(n,2)),t.pipe("map.2d.data",this.uniforms),t.pipe("sample.2d",this.uniforms);{const i=QE(Math.min(e,this.target.frames));return n<4&&t.pipe(ea(n,4)),t.pipe("map.xyzw.2dv"),t.split(),t.pipe("map.2d.data",this.uniforms),t.pass(),t.pipe(i,this.uniforms)}}build(t){return this.camera||(this.camera=new nn,this.camera.position.set(0,0,3),this.camera.lookAt(new N)),typeof this.scene.inject=="function"&&this.scene.inject(),this.target=new NOt(this.gl,t.width,t.height,t.frames,t),this.target.warmup(e=>this.renderer.setRenderTarget(e)),this.renderer.setRenderTarget(null),this._adopt(this.target.uniforms),this._adopt({dataPointer:{type:"v2",value:new pt(.5,.5)}}),this.filled=0}adopt(t){return Array.from(t.renders).map(e=>this.scene.add(e))}unadopt(t){return Array.from(t.renders).map(e=>this.scene.remove(e))}render(t){t==null&&({camera:t}=this);const e=this.renderer.getRenderTarget();if(this.renderer.setRenderTarget(this.target.write),this.renderer.render(this.scene.scene!=null?this.scene.scene:this.scene,t),this.renderer.setRenderTarget(e),this.target.cycle(),this.filled<this.target.frames)return this.filled++}read(t){return t==null&&(t=0),this.target.reads[Math.abs(t)]}getFrames(){return this.target.frames}getFilled(){return this.filled}dispose(){return typeof this.scene.unject=="function"&&this.scene.unject(),this.scene=this.camera=null,this.target.dispose(),super.dispose()}}class Sv extends BC{constructor(t,e,n){let i,r;const o=n.items||1,a=n.channels||4,l=n.width||1,c=n.height||1,h=n.depth||1;n.format=Vn,n.width=r=o*l,n.height=i=c*h,n.frames=1,delete n.items,delete n.depth,delete n.channels,super(t,e,n),this.items==null&&(this.items=o),this.channels==null&&(this.channels=a),this.width==null&&(this.width=l),this._width=r,this.height==null&&(this.height=c),this._height=i,this.depth==null&&(this.depth=h),this._adopt({textureItems:{type:"f",value:this.items},textureHeight:{type:"f",value:this.height}})}shaderAbsolute(t){return t==null&&(t=this.shaders.shader()),t.pipe("map.xyzw.texture",this.uniforms),super.shaderAbsolute(t,1,2)}}class HC extends Xl{constructor(t,e){e==null&&(e=!0),super(),e&&this.construct(t)}construct(t){let e,n,i,r,o,a,l,c;this._clipUniforms(),this.closedX=e=t.closedX||!1,this.closedY=n=t.closedY||!1,this.width=c=(+t.width||2)+(e?1:0),this.height=i=(+t.height||2)+(n?1:0),this.surfaces=l=+t.surfaces||1,this.layers=r=+t.layers||1,this.segmentsX=o=Math.max(0,c-1),this.segmentsY=a=Math.max(0,i-1);const h=c*i*l*r,d=o*a*l*r*2;this.setIndex(new ue(new Uint32Array(d*3),1)),this.setAttribute("position4",new ue(new Float32Array(h*4),4)),this.setAttribute("surface",new ue(new Float32Array(h*2),2));const m=this._emitter("index"),g=this._emitter("position4");let y=0;for(let _=0,v=l*r,w=0<=v;w?_<v:_>v;w?_++:_--){for(let b=0,M=a,A=0<=M;A?b<M:b>M;A?b++:b--){for(let T=0,P=o,C=0<=P;C?T<P:T>P;C?T++:T--)m(y),m(y+1),m(y+c),m(y+c),m(y+1),m(y+c+1),y++;y++}y+=c}for(let _=0,v=r,w=0<=v;w?_<v:_>v;w?_++:_--)for(let b=0,M=l,A=0<=M;A?b<M:b>M;A?b++:b--)for(let T=0,P=T,C=i,S=0<=C;S?T<C:T>C;S?T++:T--,P=T)for(let L=0,H=L,$=c,B=0<=$;B?L<$:L>$;B?L++:L--,H=L)g(H,P,b,_);this._finalize(),this.clip()}clip(t,e,n,i){t==null&&(t=this.width-this.closedX),e==null&&(e=this.height-this.closedY),n==null&&({surfaces:n}=this),i==null&&({layers:i}=this),t+=this.closedX,e+=this.closedY;const r=Math.max(0,t-1),o=Math.max(0,e-1);return this._clipGeometry(t,e,n,i),this._clipOffsets(6,r,o,n,i,this.segmentsX,this.segmentsY,this.surfaces,this.layers)}map(t,e,n,i){return t==null&&({width:t}=this),e==null&&({height:e}=this),n==null&&({surfaces:n}=this),i==null&&({layers:i}=this),this._clipMap(t,e,n,i)}}class FOt extends HC{constructor(t){t.width=Math.max(2,+t.width!=null?+t.width:2),t.height=Math.max(2,+t.height!=null?+t.height:2),super(t,!1),this.uniforms==null&&(this.uniforms={}),this.uniforms.geometryScale={type:"v4",value:new Oe},this.cover(),this.construct(t)}cover(t,e,n,i){t==null&&(t=1),this.scaleX=t,e==null&&(e=1),this.scaleY=e,n==null&&(n=1),this.scaleZ=n,i==null&&(i=1),this.scaleW=i}clip(t,e,n,i){t==null&&({width:t}=this),e==null&&({height:e}=this),n==null&&({surfaces:n}=this),i==null&&({layers:i}=this),super.clip(t,e,n,i);const r=o=>1/Math.max(1,o-1);return this.uniforms.geometryScale.value.set(r(t)*this.scaleX,r(e)*this.scaleY,r(n)*this.scaleZ,r(i)*this.scaleW)}}class VC extends Cr{constructor(t,e,n){let i;super(t,e,n);let{uniforms:r}=n;const{map:o,combine:a,stpq:l,linear:c}=n;r==null&&(r={});const h=r.styleColor!=null;this.geometry=new FOt({width:n.width,height:n.height}),this._adopt(r),this._adopt(this.geometry.uniforms);const f=e.material(),d=f.vertex;d.pipe("raw.position.scale",this.uniforms),d.fan(),d.pipe("stpq.xyzw.2d",this.uniforms),d.next(),d.pipe("screen.position",this.uniforms),d.join(),f.fragment=i=this._fragmentColor(h,!1,null,null,o,2,l,a,c),i.pipe("fragment.color",this.uniforms);const m=f.link({side:An});this.material=this._material(m);const g=new Xe(this.geometry,this.material);g.frustumCulled=!1,g.userData=m,this._raw(g),this.renders=[g]}dispose(){return this.geometry.dispose(),this.material.dispose(),this.renders=this.geometry=this.material=null,super.dispose()}}class Av extends VC{constructor(t,e,n){const{items:i,width:r,height:o,depth:a,stpq:l}=n,c=m=>1/Math.max(1,m),h=m=>1/Math.max(1,m-1),f={remapUVScale:{type:"v2",value:new pt(i*r,o*a)},remapModulus:{type:"v2",value:new pt(i,o)},remapModulusInv:{type:"v2",value:new pt(c(i),c(o))},remapSTPQScale:{type:"v4",value:new Oe(h(r),h(o),h(a),h(i))}},d=e.shader();d.pipe("screen.map.xyzw",f),n.map!=null&&(l&&d.pipe("screen.map.stpq",f),d.pipe(n.map)),super(t,e,{map:d,linear:!0}),this.memo=n,this.uniforms=f;for(const m of Array.from(this.renders))m.transparent=!1}cover(t,e,n,i){t==null&&({width:t}=this.memo),e==null&&({height:e}=this.memo),n==null&&({depth:n}=this.memo),i==null&&({items:i}=this.memo);const r=l=>1/Math.max(1,l-1);this.uniforms.remapSTPQScale.value.set(r(t),r(e),r(n),r(i));const o=t/this.memo.width;let a=n/this.memo.depth;return this.memo.depth===1&&(a=e/this.memo.height),this.geometry.cover(o,a)}}class GC extends Xl{constructor(t){let e,n,i,r;super(t),this._clipUniforms(),this.items=i=+t.items||2,this.width=r=+t.width||1,this.height=n=+t.height||1,this.depth=e=+t.depth||1;const o=i*r*n*e,a=o*4,l=o*2;this.setIndex(new ue(new Uint32Array(l*3),1)),this.setAttribute("position4",new ue(new Float32Array(a*4),4)),this.setAttribute("sprite",new ue(new Float32Array(a*2),2));const c=this._emitter("index"),h=this._emitter("position4"),f=this._emitter("sprite"),d=[[-1,-1],[-1,1],[1,-1],[1,1]];let m=0;for(let g=0,y=o,_=0<=y;_?g<y:g>y;_?g++:g--)c(m),c(m+1),c(m+2),c(m+1),c(m+2),c(m+3),m+=4;for(let g=0,y=e,_=0<=y;_?g<y:g>y;_?g++:g--)for(let v=0,w=n,b=0<=w;b?v<w:v>w;b?v++:v--)for(let M=0,A=r,T=0<=A;T?M<A:M>A;T?M++:M--)for(let P=0,C=i,S=0<=C;S?P<C:P>C;S?P++:P--)for(const L of Array.from(d))h(M,v,g,P),f(L[0],L[1]);this._finalize(),this.clip()}clip(t,e,n,i){return t==null&&({width:t}=this),e==null&&({height:e}=this),n==null&&({depth:n}=this),i==null&&({items:i}=this),this._clipGeometry(t,e,n,i),this._clipOffsets(6,t,e,n,i,this.width,this.height,this.depth,this.items)}}class BOt extends Cr{constructor(t,e,n){let i,r;super(t,e,n);let{uniforms:o,shape:a,fill:l}=n;const{material:c,position:h,color:f,size:d,mask:m,map:g,combine:y,linear:_,optical:v,stpq:w}=n;o==null&&(o={}),a=+a!=null?+a:0,l==null&&(l=!0);const b=o.styleColor!=null,M=["circle","square","diamond","up","down","left","right"],A=["circle","generic","generic","generic","generic","generic","generic"],T=[1.2,1,1.414,1.16,1.16,1.16,1.16],P=A[a]!=null?A[a]:A[0],C=M[a]!=null?M[a]:M[0],S=(r=v&&T[a])!=null?r:1,L=l?P:`${P}.hollow`;this.geometry=new GC({items:n.items,width:n.width,height:n.height,depth:n.depth}),this._adopt(o),this._adopt(this.geometry.uniforms);const H={POINT_SHAPE_SCALE:+(S+1e-5)},$=e.material(),B=$.vertex;B.pipe(this._vertexColor(f,m)),d?(B.isolate(),B.require(d),B.require("point.size.varying",this.uniforms),B.end()):B.require("point.size.uniform",this.uniforms),B.require(this._vertexPosition(h,c,g,2,w)),B.pipe("point.position",this.uniforms,H),B.pipe("project.position",this.uniforms),$.fragment=i=this._fragmentColor(b,c,f,m,g,2,w,y,_);const G=e.material();G.vertex.pipe(B),i=G.fragment.pipe($.fragment),i.require(`point.mask.${C}`,this.uniforms),i.require(`point.alpha.${L}`,this.uniforms),i.pipe("point.edge",this.uniforms);const I=e.material();I.vertex.pipe(B),i=I.fragment.pipe($.fragment),i.require(`point.mask.${C}`,this.uniforms),i.require(`point.alpha.${L}`,this.uniforms),i.pipe("point.fill",this.uniforms);const et=I.link({side:An});this.fillMaterial=this._material(et);const Y=G.link({side:An});this.edgeMaterial=this._material(Y),this.fillObject=new Xe(this.geometry,this.fillMaterial),this.edgeObject=new Xe(this.geometry,this.edgeMaterial),this._raw(this.fillObject),this.fillObject.userData=et,this._raw(this.edgeObject),this.edgeObject.userData=Y,this.renders=[this.fillObject,this.edgeObject]}show(t,e,n,i){return this._show(this.edgeObject,!0,e,n,i),this._show(this.fillObject,t,e,n,i)}dispose(){return this.geometry.dispose(),this.edgeMaterial.dispose(),this.fillMaterial.dispose(),this.renders=this.edgeObject=this.fillObject=this.geometry=this.edgeMaterial=this.fillMaterial=null,super.dispose()}}class HOt extends NC{constructor(t,e,n){const i=n.width||1,r=n.height||1,o=n.depth||1,a=i*r*o;n.samples||(n.samples=a),super(t,e,n),this.width=i,this.height=r,this.depth=o,this.samples==null&&(this.samples=a),this.build(n)}build(t){return this.data=[],this.data.length=this.samples,this.filled=0,this.pad={x:0,y:0,z:0},this.streamer=this.generate(this.data)}dispose(){return this.data=null,super.dispose()}getFilled(){return this.filled}setActive(t,e,n){let i;return[this.pad.x,this.pad.y,this.pad.z]=Array.from(i=[this.width-t,this.height-e,this.depth-n]),i}read(){return this.data}copy(t){const e=Math.min(t.length,this.samples),n=this.data;return VOt(0,e,!1).map(i=>n[i]=t[i])}fill(){let t,e,n,i;const{callback:r}=this;typeof r.reset=="function"&&r.reset();const{emit:o,skip:a,count:l,done:c,reset:h}=this.streamer;h();const f=this.width,d=this.height,m=this.pad.x,g=this.pad.y,y=this.samples-this.pad.z*f*d;let _=t=e=n=0;if(m>0||g>0)for(;!c()&&n<y&&(n++,i=r(o,_,t,e),++_===f-m&&(a(m),_=0,++t===d-g&&(a(f*g),t=0,e++)),i!==!1););else for(;!c()&&n<y&&(n++,i=r(o,_,t,e),++_===f&&(_=0,++t===d&&(t=0,e++)),i!==!1););return this.filled=1,l()}}function VOt(s,t,e){const n=[],i=s<t,r=e?i?t+1:t-1:t;for(let o=s;i?o<r:o>r;i?o++:o--)n.push(o);return n}class GOt extends $l{constructor(t,e,n){super(t,e),this.items==null&&(this.items=n.items||1),this.channels==null&&(this.channels=n.channels||4),this.width==null&&(this.width=n.width||1),this.height==null&&(this.height=n.height||1),this.depth==null&&(this.depth=n.depth||1),this.type==null&&(this.type=n.type||Cn),this.stpq==null&&(this.stpq=n.stpq||!1),this.isFloat=this.type===Cn,this.active=this.sampled=this.rect=this.pad=null,this.build(n)}build(t){let e,n,i;const{map:r}=t,{indexer:o}=t,a=o!=null&&!o.empty();let{stpq:l}=this;const{items:c,width:h,height:f,depth:d}=this;let m=r;a&&(this._adopt({indexModulus:{type:"v4",value:new Oe(c,c*h,c*h*f,1)}}),m=this.shaders.shader(),m.require(r),m.require(o),m.pipe("float.index.pack",this.uniforms)),this.isFloat&&this.channels>1&&(this.floatMemo=new Sv(this.renderer,this.shaders,{items:c,channels:4,width:h,height:f,depth:d,history:0,type:Cn}),this.floatCompose=new Av(this.renderer,this.shaders,{map:m,items:c,width:h,height:f,depth:d,stpq:l}),this.floatMemo.adopt(this.floatCompose),l=!1,m=this.shaders.shader(),this.floatMemo.shaderAbsolute(m)),this.isFloat?(i=this.channels,e=4):(i=1,e=this.channels),i>1?(n=this.shaders.shader(),n.pipe(JE(i)),n.require(m),n.pipe("float.stretch"),n.pipe("float.encode"),m=n):this.isFloat&&(n=this.shaders.shader(),n.pipe(m),n.pipe(ao(4,1)),n.pipe("float.encode"),m=n),this.byteMemo=new Sv(this.renderer,this.shaders,{items:c*i,channels:e,width:h,height:f,depth:d,history:0,type:ai}),this.byteCompose=new Av(this.renderer,this.shaders,{map:m,items:c*i,width:h,height:f,depth:d,stpq:l}),this.byteMemo.adopt(this.byteCompose);const g=c*h*i,y=f*d;return this.samples=this.width*this.height*this.depth,this.bytes=new Uint8Array(g*y*4),this.isFloat&&(this.floats=new Float32Array(this.bytes.buffer)),this.data=this.isFloat?this.floats:this.bytes,this.streamer=this.generate(this.data),this.active={items:0,width:0,height:0,depth:0},this.sampled={items:0,width:0,height:0,depth:0},this.rect={w:0,h:0},this.pad={x:0,y:0,z:0,w:0},this.stretch=i,this.isIndexed=a,this.setActive(c,h,f,d)}generate(t){return ry(t,this.samples,4,this.items)}setActive(t,e,n,i){let r;if(t===this.active.items&&e===this.active.width&&n===this.active.height&&i===this.active.depth)return;[this.active.items,this.active.width,this.active.height,this.active.depth]=Array.from([t,e,n,i]),this.floatCompose!=null&&this.floatCompose.cover(e,n,i),this.byteCompose!=null&&this.byteCompose.cover(e*this.stretch,n,i),{items:t}=this,{width:e}=this.active,n=this.depth===1?this.active.height:this.height,{depth:i}=this.active;const o=t*e*this.stretch,a=n*i;return[this.sampled.items,this.sampled.width,this.sampled.height,this.sampled.depth]=Array.from([t,e,n,i]),[this.rect.w,this.rect.h]=Array.from([o,a]),[this.pad.x,this.pad.y,this.pad.z,this.pad.w]=Array.from(r=[this.sampled.width-this.active.width,this.sampled.height-this.active.height,this.sampled.depth-this.active.depth,this.sampled.items-this.active.items]),r}update(t){return this.floatMemo!=null&&this.floatMemo.render(t),this.byteMemo!=null?this.byteMemo.render(t):void 0}post(){const t=this.renderer.getRenderTarget();this.renderer.setRenderTarget(this.byteMemo.target.targets[0]),this.gl.readPixels(0,0,this.rect.w,this.rect.h,this.gl.RGBA,this.gl.UNSIGNED_BYTE,this.bytes),this.renderer.setRenderTarget(t)}readFloat(t){return this.floatMemo!=null?this.floatMemo.read(t):void 0}readByte(t){return this.byteMemo!=null?this.byteMemo.read(t):void 0}setCallback(t){this.emitter=this.callback(t)}callback(t){if(!this.isIndexed)return t;const e=this.width,n=this.height,i=this.items,r=function(o,a,l,c){let h=c;const f=h%i;h=(h-f)/i;const d=h%e;h=(h-d)/e;const m=h%n;return h=(h-m)/n,t(o,a,l,c,d,m,h,f)};return r.reset=()=>typeof t.reset=="function"?t.reset():void 0,r}iterate(){let t,e,n,i=this.emitter;typeof i.reset=="function"&&i.reset();const{consume:r,skip:o,count:a,done:l,reset:c}=this.streamer;c();const h=this.sampled.width|0;let f=this.sampled.height|0;const d=this.sampled.depth|0,m=this.sampled.items|0,g=this.pad.x|0,y=this.pad.y|0,_=this.pad.z|0,v=this.pad.w|0,w=h*f*m*(d-_);if(!this.isIndexed){const M=i;i=(A,T,P,C)=>M(A,T,P,C,b,t,e,n)}let b=t=e=n=f=0;for(;!l()&&f<w;){f++;const M=r(i);if(++n===m-v&&(o(g),n=0,++b===h-g&&(o(m*g),b=0,++t===f-y&&(o(m*h*y),t=0,e++))),M===!1)break}return Math.floor(a()/m)}dispose(){return this.floatMemo!=null&&this.floatMemo.unadopt(this.floatCompose),this.floatMemo!=null&&this.floatMemo.dispose(),this.floatCompose!=null&&this.floatCompose.dispose(),this.byteMemo!=null&&this.byteMemo.unadopt(this.byteCompose),this.byteMemo!=null&&this.byteMemo.dispose(),this.byteCompose!=null&&this.byteCompose.dispose(),this.floatMemo=this.byteMemo=this.floatCompose=this.byteCompose=null}}class qOt extends Cr{constructor(t,e,n){let i;super(t,e,n);let{uniforms:r}=n;const{material:o,position:a,sprite:l,map:c,combine:h,linear:f,color:d,mask:m,stpq:g}=n;r==null&&(r={});const y=r.styleColor!=null;this.geometry=new GC({items:n.items,width:n.width,height:n.height,depth:n.depth}),this._adopt(r),this._adopt(this.geometry.uniforms);const _=e.material(),v=_.vertex;v.pipe(this._vertexColor(d,m)),v.require(this._vertexPosition(a,o,c,2,g)),v.require(l),v.pipe("sprite.position",this.uniforms),v.pipe("project.position",this.uniforms),_.fragment=i=this._fragmentColor(y,o,d,m,c,2,g,h,f);const w=e.material();w.vertex.pipe(v),w.fragment.pipe(i),w.fragment.pipe("fragment.transparent",this.uniforms);const b=e.material();b.vertex.pipe(v),b.fragment.pipe(i),b.fragment.pipe("fragment.solid",this.uniforms);const M=b.link({side:An});this.fillMaterial=this._material(M);const A=w.link({side:An});this.edgeMaterial=this._material(A),this.fillObject=new Xe(this.geometry,this.fillMaterial),this.edgeObject=new Xe(this.geometry,this.edgeMaterial),this._raw(this.fillObject),this.fillObject.userData=M,this._raw(this.edgeObject),this.edgeObject.userData=A,this.renders=[this.fillObject,this.edgeObject]}show(t,e,n,i){return this._show(this.edgeObject,!0,e,n,i),this._show(this.fillObject,t,e,n,i)}dispose(){return this.geometry.dispose(),this.edgeMaterial.dispose(),this.fillMaterial.dispose(),this.renders=this.geometry=this.edgeMaterial=this.fillMaterial=this.edgeObject=this.fillObject=null,super.dispose()}}class WOt extends Xl{constructor(t){let e,n,i,r,o;super(t),this._clipUniforms(),this.items=i=+t.items||2,this.width=o=+t.width||1,this.height=n=+t.height||1,this.depth=e=+t.depth||1,this.sides=r=Math.max(0,i-2);const a=o*n*e,l=i*a,c=r*a;this.setIndex(new ue(new Uint32Array(c*3),1)),this.setAttribute("position4",new ue(new Float32Array(l*4),4)),this.setAttribute("strip",new ue(new Float32Array(l*3),3));const h=this._emitter("index"),f=this._emitter("position4"),d=this._emitter("strip");let m=0;for(let y=0,_=a,v=0<=_;v?y<_:y>_;v?y++:y--){let w=m;for(let b=0,M=r,A=0<=M;A?b<M:b>M;A?b++:b--)b&1?(h(w+1),h(w),h(w+2)):(h(w),h(w+1),h(w+2)),w++;m+=i}const g=i-1;for(let y=0,_=e,v=0<=_;v?y<_:y>_;v?y++:y--)for(let w=0,b=n,M=0<=b;M?w<b:w>b;M?w++:w--)for(let A=0,T=o,P=0<=T;P?A<T:A>T;P?A++:A--){let C=1;f(A,w,y,0),d(1,2,C);for(let S=1,L=g,H=1<=L;H?S<L:S>L;H?S++:S--)f(A,w,y,S),d(S-1,S+1,C=-C);f(A,w,y,g),d(g-2,g-1,-C)}this._finalize(),this.clip()}clip(t,e,n,i){t==null&&({width:t}=this),e==null&&({height:e}=this),n==null&&({depth:n}=this),i==null&&({items:i}=this);const r=Math.max(0,i-2);return this._clipGeometry(t,e,n,i),this._clipOffsets(3,t,e,n,r,this.width,this.height,this.depth,this.sides)}}class $Ot extends Cr{constructor(t,e,n){let i;super(t,e,n);let{uniforms:r,material:o}=n;const{position:a,color:l,mask:c,map:h,combine:f,linear:d,stpq:m}=n;r==null&&(r={}),o==null&&(o=!0);const g=r.styleColor!=null;this.geometry=new WOt({items:n.items,width:n.width,height:n.height,depth:n.depth}),this._adopt(r),this._adopt(this.geometry.uniforms);const y=e.material(),_=y.vertex;_.pipe(this._vertexColor(l,c)),_.require(this._vertexPosition(a,o,h,2,m)),o||_.pipe("mesh.position",this.uniforms),o&&_.pipe("strip.position.normal",this.uniforms),_.pipe("project.position",this.uniforms),y.fragment=i=this._fragmentColor(g,o,l,c,h,2,m,f,d),i.pipe("fragment.color",this.uniforms);const v=y.link({side:An});this.material=this._material(v);const w=new Xe(this.geometry,this.material);w.userData=v,this._raw(w),this.renders=[w]}dispose(){return this.geometry.dispose(),this.material.dispose(),this.renders=this.geometry=this.material=null,super.dispose()}}class XOt extends Cr{constructor(t,e,n){let i;super(t,e,n);let{uniforms:r,material:o}=n;const{position:a,color:l,normal:c,mask:h,map:f,combine:d,linear:m,stpq:g,intUV:y}=n;r==null&&(r={}),o==null&&(o=!0);const _=r.styleColor!=null;this.geometry=new HC({width:n.width,height:n.height,surfaces:n.surfaces,layers:n.layers,closedX:n.closedX,closedY:n.closedY}),this._adopt(r),this._adopt(this.geometry.uniforms);const v={};n.closedX&&(v.SURFACE_CLOSED_X=""),n.closedY&&(v.SURFACE_CLOSED_Y=""),y&&(v.POSITION_UV_INT="");const w=e.material(),b=w.vertex;b.pipe(this._vertexColor(l,h)),b.require(this._vertexPosition(a,o,f,2,g)),c?(b.require(c),b.pipe("surface.position.normal",this.uniforms,v)):(o||b.pipe("surface.position",this.uniforms,v),o&&b.pipe("surface.position.shaded",this.uniforms,v)),b.pipe("project.position",this.uniforms),w.fragment=i=this._fragmentColor(_,o,l,h,f,2,g,d,m),i.pipe("fragment.color",this.uniforms);const M=w.link({side:An});this.material=this._material(M);const A=new Xe(this.geometry,this.material);A.userData=M,this._raw(A),this.renders=[A]}dispose(){return this.geometry.dispose(),this.material.dispose(),this.renders=this.geometry=this.material=null,super.dispose()}}const jOt=512/16;class YOt extends FC{constructor(t,e,n){let i;if(n.width||(n.width=256),n.height||(n.height=256),n.type=ai,n.channels=1,n.backed=!0,super(t,e,n,!1),this.font=n.font!=null?n.font:["sans-serif"],this.size=n.size||24,this.style=n.style!=null?n.style:"normal",this.variant=n.variant!=null?n.variant:"normal",this.weight=n.weight!=null?n.weight:"normal",this.outline=(i=+(n.outline!=null?n.outline:5))!=null?i:0,this.gamma=1,typeof navigator<"u"){const r=navigator.userAgent;r.match(/Chrome/)&&r.match(/OS X/)&&(this.gamma=.5)}this.scratchW=this.scratchH=0,this.build(n)}build(t){super.build(t);let e=16;e=this.size,e+=4+2*Math.min(1,this.outline);const n=jOt*e,i=document.createElement("canvas");i.width=n,i.height=e;const r=f=>`${f.replace(/(['"\\])/g,"\\$1")}`,o=this.font.map(r).join(", "),a=i.getContext("2d",{willReadFrequently:!0});a.font=`${this.style} ${this.variant} ${this.weight} ${this.size}px ${o}`,a.fillStyle="#FF0000",a.textAlign="left",a.textBaseline="bottom",a.lineJoin="round";const l=[],c=this.outline*3;for(let f=0,d=c,m=0<=d;m?f<d:f>d;m?f++:f--){const g=("00"+Math.max(0,-f*8+128-!f*8).toString(16)).slice(-2);l.push("#"+g+g+g)}const h=new Uint8Array(n*e*2);return this.canvas=i,this.context=a,this.lineHeight=e,this.maxWidth=n,this.colors=l,this.scratch=h,this._allocate=this.allocate.bind(this),this._write=this.write.bind(this)}reset(){return super.reset(),this.mapped={}}begin(){return Array.from(this.rows).map(t=>t.alive=0)}end(){const{mapped:t}=this;for(const e of Array.from(this.rows.slice()))if(e.alive===0){for(const n of Array.from(e.keys))delete t[n];this.collapse(e)}}map(t,e){const{mapped:n}=this,i=n[t];if(i!=null)return i.row.alive++,e(i.x,i.y,i.w,i.h);this.draw(t);const r=this.scratch,o=this.scratchW,a=this.scratchH,l=this._allocate,c=this._write;return l(t,o,a,function(h,f,d){return n[t]={x:f,y:d,w:o,h:a,row:h},c(r,f,d,o,a),e(f,d,o,a)})}draw(t){let e,n,i,r=this.width;const o=this.lineHeight,a=this.outline,l=this.context,c=this.scratch,h=this.maxWidth,{colors:f}=this,d=a+1,m=Math.round(o*1.05-1),g=l.measureText(t);if(r=Math.min(h,Math.ceil(g.width+2*d+1)),l.clearRect(0,0,r,o),this.outline===0){let y,_;for(l.fillText(t,d,m),{data:e}=l.getImageData(0,0,r,o),i=3,n=0,_=e.length/4,y=0<=_;y?n<_:n>_;y?n++:n--)c[n]=e[i],i+=4;return this.scratchW=r,this.scratchH=o}else{let y,_,v,w;for(l.globalCompositeOperation="source-over",_=a+1,n=_,y=_<=1;y?n<=1:n>=1;y?n++:n--)i=n>1?n*2-2:n,l.strokeStyle=f[i-1],l.lineWidth=i,l.strokeText(t,d,m);l.globalCompositeOperation="multiply",l.fillText(t,d,m),{data:e}=l.getImageData(0,0,r,o),i=0;const{gamma:b}=this;for(n=0,w=e.length/4,v=0<=w;v?n<w:n>w;v?n++:n--){const M=e[i];let A=M?e[i+1]/M:1;b===.5&&(A=Math.sqrt(A)),A=Math.min(1,Math.max(0,A));const T=256-M,P=T+(M-T)*A;c[n]=Math.max(0,Math.min(255,P+2)),i+=4}return this.scratchW=r,this.scratchH=o}}}class ZOt extends cp{build(t){return super.build(),this.pad={x:0,y:0,z:0},this.streamer=this.generate(this.data)}setActive(t,e,n){let i;return[this.pad.x,this.pad.y,this.pad.z]=Array.from(i=[Math.max(0,this.width-t),Math.max(0,this.height-e),Math.max(0,this.depth-n)]),i}fill(){let t,e,n,i;const{callback:r}=this;typeof r.reset=="function"&&r.reset();const{emit:o,skip:a,count:l,done:c,reset:h}=this.streamer;h();const f=this.width,d=this.height,m=this.pad.x,g=this.pad.y,y=this.samples-this.pad.z*f*d;let _=t=e=n=0;if(m>0||g>0)for(;!c()&&n<y&&(n++,i=r(o,_,t,e),++_===f-m&&(a(m),n+=m,_=0,++t===d-g&&(a(f*g),n+=f*g,t=0,e++)),i!==!1););else for(;!c()&&n<y&&(n++,i=r(o,_,t,e),++_===f&&(_=0,++t===d&&(t=0,e++)),i!==!1););return Math.floor(l()/this.items)}through(t,e){let n,i,r,o;const{consume:a,done:l,skip:c}=o=this.streamer,{emit:h}=n=e.streamer;let f=i=r=0,d=()=>a((m,g,y,_)=>t(h,m,g,y,_,f,i,r));return d=Pu(d,this.items),()=>{let m;o.reset(),n.reset();const g=this.width,y=this.height,_=this.pad.x,v=this.pad.y,w=this.samples-this.pad.z*g*y;if(f=i=r=m=0,_>0||v>0)for(;!l()&&m<w;)m++,d(),++f===g-_&&(c(_),f=0,++i===y-v&&(c(g*v),i=0,r++));else for(;!l()&&m<w;)m++,d(),++f===g&&(f=0,++i===y&&(i=0,r++));return o.count()}}}const qC={sprite:qOt,point:BOt,line:kOt,surface:XOt,face:OOt,strip:$Ot,arrow:POt,screen:VC,memoScreen:Av,debug:DOt,dataBuffer:cp,arrayBuffer:EOt,matrixBuffer:UOt,voxelBuffer:ZOt,pushBuffer:HOt,renderToTexture:BC,memo:Sv,readback:GOt,atlas:FC,textAtlas:YOt,scene:kC},KOt=Object.freeze(Object.defineProperty({__proto__:null,Classes:qC,Factory:UC,Scene:kC},Symbol.toStringTag,{value:"Module"})),JOt=`uniform float worldUnit;
uniform float lineDepth;
uniform float lineWidth;
uniform float focusDepth;

uniform vec4 geometryClip;
uniform float arrowSize;
uniform float arrowSpace;

attribute vec4 position4;
attribute vec3 arrow;
attribute vec2 attach;

// External
vec3 getPosition(vec4 xyzw, float canonical);

void getArrowGeometry(vec4 xyzw, float near, float mid, float far, out vec3 left, out vec3 right, out vec3 middle, out vec3 start) {
  right  = getPosition(xyzw, 1.0);
  left   = getPosition(vec4(near, xyzw.yzw), 0.0);
  middle = getPosition(vec4(mid,  xyzw.yzw), 0.0);
  start  = getPosition(vec4(far,  xyzw.yzw), 0.0);
}

mat4 getArrowMatrix(vec3 left, vec3 right, vec3 middle, vec3 start) {

  float depth = focusDepth;
  if (lineDepth < 1.0) {
    // Depth blending
    float z = max(0.00001, -right.z);
    depth = mix(z, focusDepth, lineDepth);
  }

  vec3 diff = left - right;
  float l = length(diff);
  if (l == 0.0) {
    return mat4(1.0, 0.0, 0.0, 0.0,
                0.0, 1.0, 0.0, 0.0,
                0.0, 0.0, 1.0, 0.0,
                0.0, 0.0, 0.0, 1.0);
  }

  // Construct TBN matrix around shaft
  vec3 t = normalize(diff);
  vec3 n = normalize(cross(t, t.yzx + vec3(.1, .2, .3)));
  vec3 b = cross(n, t);

  // Shrink arrows when vector gets too small
  // Approach linear scaling with cubic ease the smaller we get
  float size = arrowSize * lineWidth * worldUnit * depth * 1.25;
  l = max(length(right - middle), length(middle - start)) * 2.0 * arrowSpace;
  float mini = clamp(1.0 - l / size * .333, 0.0, 1.0);
  float scale = 1.0 - mini * mini * mini;
  float range = size * scale;

  // Size to 2.5:1 ratio
  float rangeNB = range / 2.5;

  // Anchor at end position
  return mat4(vec4(n * rangeNB,  0),
              vec4(b * rangeNB,  0),
              vec4(t * range, 0),
              vec4(right,  1.0));
}

vec3 getArrowPosition() {
  vec3 left, right, middle, start;

  // Clip arrow position and attachment anchors to data
  vec4 p = min(geometryClip, position4);
  vec3 a = vec3(min(geometryClip.x, p.x + attach.x), geometryClip.x / 2.0, min(geometryClip.x, attach.y));

  getArrowGeometry(p, a.x, a.y, a.z, left, right, middle, start);
  mat4 matrix = getArrowMatrix(left, right, middle, start);

  return (matrix * vec4(arrow.xyz, 1.0)).xyz;

}
`,QOt=`uniform vec4 axisStep;
uniform vec4 axisPosition;

vec4 getAxisPosition(vec4 xyzw, inout vec4 stpq) {
  return axisStep * xyzw.x + axisPosition;
}
`,tzt=`uniform vec4 basisScale;
uniform vec4 basisOffset;
uniform vec4 viewScale;
uniform vec4 viewOffset;

vec4 getCartesian4Position(vec4 position, inout vec4 stpq) {
  return position * basisScale + basisOffset;
}
`,ezt=`uniform mat4 viewMatrix;

vec4 getCartesianPosition(vec4 position, inout vec4 stpq) {
  return viewMatrix * vec4(position.xyz, 1.0);
}
`,nzt=`uniform vec4 clampLimit;

vec4 getClampXYZW(vec4 xyzw) {
  return clamp(xyzw, vec4(0.0), clampLimit);
}
`,izt=`vec4 opaqueColor(vec4 color) {
  return vec4(color.rgb, 1.0);
}
`,szt=`uniform vec4 geometryClip;
attribute vec4 position4;

// External
vec3 getPosition(vec4 xyzw, float canonical);

vec3 getFacePosition() {
  vec4 p = min(geometryClip, position4);
  return getPosition(p, 1.0);
}
`,rzt=`attribute vec4 position4;

// External
vec3 getPosition(vec4 xyzw, float canonical);

varying vec3 vNormal;
varying vec3 vLight;
varying vec3 vPosition;

void getFaceGeometry(vec4 xyzw, out vec3 pos, out vec3 normal) {
  vec3 a, b, c;

  a   = getPosition(vec4(xyzw.xyz, 0.0), 0.0);
  b   = getPosition(vec4(xyzw.xyz, 1.0), 0.0);
  c   = getPosition(vec4(xyzw.xyz, 2.0), 0.0);

  pos = getPosition(xyzw, 1.0);
  normal = normalize(cross(c - a, b - a));
}

vec3 getFacePositionNormal() {
  vec3 center, normal;

  getFaceGeometry(position4, center, normal);
  vNormal   = normal;
  vLight    = normalize((viewMatrix * vec4(1.0, 2.0, 2.0, 0.0)).xyz);
  vPosition = -center;

  return center;
}
`,ozt=`/*
Float encoding technique by
Carlos Scheidegger
https://github.com/cscheid/lux/blob/master/src/shade/bits/encode_float.js

Conversion to GLSL by:
http://concord-consortium.github.io/lab/experiments/webgl-gpgpu/script.js
*/

float shift_right(float v, float amt) { 
  v = floor(v) + 0.5; 
  return floor(v / exp2(amt)); 
}

float shift_left(float v, float amt) { 
  return floor(v * exp2(amt) + 0.5); 
}

float mask_last(float v, float bits) { 
  return mod(v, shift_left(1.0, bits)); 
}

float extract_bits(float num, float from, float to) { 
  from = floor(from + 0.5); to = floor(to + 0.5); 
  return mask_last(shift_right(num, from), to - from); 
}

vec4 encode_float(float val) { 
  if (val == 0.0) return vec4(0, 0, 0, 0); 
  float valuesign = val > 0.0 ? 0.0 : 1.0; 
  val = abs(val); 
  float exponent = floor(log2(val)); 
  float biased_exponent = exponent + 127.0; 
  float fraction = ((val / exp2(exponent)) - 1.0) * 8388608.0; 
  float t = biased_exponent / 2.0; 
  float last_bit_of_biased_exponent = fract(t) * 2.0; 
  float remaining_bits_of_biased_exponent = floor(t); 
  float byte4 = extract_bits(fraction, 0.0, 8.0) / 255.0; 
  float byte3 = extract_bits(fraction, 8.0, 16.0) / 255.0; 
  float byte2 = (last_bit_of_biased_exponent * 128.0 + extract_bits(fraction, 16.0, 23.0)) / 255.0; 
  float byte1 = (valuesign * 128.0 + remaining_bits_of_biased_exponent) / 255.0; 
  return vec4(byte4, byte3, byte2, byte1); 
}
`,azt=`uniform vec4 indexModulus;

vec4 getSample(vec4 xyzw);
vec4 getIndex(vec4 xyzw);

vec4 floatPackIndex(vec4 xyzw) {
  vec4 value = getSample(xyzw);
  vec4 index = getIndex(xyzw);

  vec4 offset = floor(index + .5) * indexModulus;
  vec2 sum2 = offset.xy + offset.zw;
  float sum = sum2.x + sum2.y;
  return vec4(value.xyz, sum);
}`,lzt=`vec4 getSample(vec4 xyzw);

float floatStretch(vec4 xyzw, float channelIndex) {
  vec4 sample = getSample(xyzw);
  vec2 xy = channelIndex > 1.5 ? sample.zw : sample.xy;
  return mod(channelIndex, 2.0) > .5 ? xy.y : xy.x;
}`,czt=`varying float vClipStrokeWidth;
varying float vClipStrokeIndex;
varying vec3  vClipStrokeEven;
varying vec3  vClipStrokeOdd;
varying vec3  vClipStrokePosition;

void clipStrokeFragment() {
  bool odd = mod(vClipStrokeIndex, 2.0) >= 1.0;

  vec3 tangent;
  if (odd) {
    tangent = vClipStrokeOdd;
  }
  else {
    tangent = vClipStrokeEven;
  }

  float travel = dot(vClipStrokePosition, normalize(tangent)) / vClipStrokeWidth;
  if (mod(travel, 16.0) > 8.0) {
    discard;
  }
}
`,uzt=`varying float vClipStrokeWidth;
varying float vClipStrokeIndex;
varying vec3  vClipStrokeEven;
varying vec3  vClipStrokeOdd;
varying vec3  vClipStrokePosition;

void clipStrokeFragment() {
  bool odd = mod(vClipStrokeIndex, 2.0) >= 1.0;

  vec3 tangent;
  if (odd) {
    tangent = vClipStrokeOdd;
  }
  else {
    tangent = vClipStrokeEven;
  }

  float travel = dot(vClipStrokePosition, normalize(tangent)) / vClipStrokeWidth;
  if (mod(travel, 4.0) > 2.0) {
    discard;
  }
}
`,hzt=`varying vec2 vClipEnds;

void clipEndsFragment() {
  if (vClipEnds.x < 0.0 || vClipEnds.y < 0.0) discard;
}
`,fzt=`varying float vClipProximity;

void clipProximityFragment() {
  if (vClipProximity >= 0.5) discard;
}`,dzt=`void setFragmentColor(vec4 color) {
  gl_FragColor = color;
}`,pzt=`vec4 fragmentRGBA(vec4 rgba, vec4 stpq) {
  return rgba;
}`,mzt=`void setFragmentColor(vec4 color) {
  if (color.a < 1.0) discard;
  gl_FragColor = color;
}`,gzt=`void setFragmentColor(vec4 color) {
  if (color.a >= 1.0) discard;
  gl_FragColor = color;
}`,vzt=`uniform vec4 gridPosition;
uniform vec4 gridStep;
uniform vec4 gridAxis;

vec4 sampleData(vec2 xy);

vec4 getGridPosition(vec4 xyzw) {
  vec4 onAxis  = gridAxis * sampleData(vec2(xyzw.y, 0.0)).x;
  vec4 offAxis = gridStep * xyzw.x + gridPosition;
  return onAxis + offAxis;
}
`,_zt=`uniform float growScale;
uniform vec4  growMask;
uniform vec4  growAnchor;

vec4 getSample(vec4 xyzw);

vec4 getGrowSample(vec4 xyzw) {
  vec4 anchor = xyzw * growMask + growAnchor;

  vec4 position = getSample(xyzw);
  vec4 center = getSample(anchor);

  return mix(center, position, growScale);
}`,yzt=`uniform float joinStride;
uniform float joinStrideInv;

float getIndex(vec4 xyzw);
vec4 getRest(vec4 xyzw);
vec4 injectIndices(float a, float b);

vec4 getJoinXYZW(vec4 xyzw) {

  float a = getIndex(xyzw);
  float b = a * joinStrideInv;

  float integer  = floor(b);
  float fraction = b - integer;
  
  return injectIndices(fraction * joinStride, integer) + getRest(xyzw);
}
`,xzt=`varying float vPixelSize;

vec4 getLabelAlphaColor(vec4 color, vec4 sample) {
  float mask = clamp(sample.r * 1000.0, 0.0, 1.0);
  float alpha = (sample.r - .5) * vPixelSize + .5;
  float a = mask * alpha * color.a;
  if (a <= 0.0) discard;
  return vec4(color.xyz, a);
}
`,bzt=`vec2 mapUV(vec4 uvwo, vec4 stpq) {
  return uvwo.xy;
}
`,wzt=`uniform float outlineExpand;
uniform float outlineStep;
uniform vec3  outlineColor;

varying float vPixelSize;

const float PIXEL_STEP = 255.0 / 16.0;

vec4 getLabelOutlineColor(vec4 color, vec4 sample) {
  float ps = vPixelSize * PIXEL_STEP;
  float os = outlineStep;

  float sdf = sample.r - .5 + outlineExpand;
  vec2  sdfs = vec2(sdf, sdf + os);
  vec2  alpha = clamp(sdfs * ps + .5, 0.0, 1.0);

  if (alpha.y <= 0.0) {
    discard;
  }

  vec3 blend = color.xyz;
  if (alpha.y > alpha.x) {
    blend = sqrt(mix(outlineColor * outlineColor, blend * blend, alpha.x));
  }
  
  return vec4(blend, alpha.y * color.a);
}
`,Mzt=`uniform vec4 layerScale;
uniform vec4 layerBias;

#define PROJECT_ORTHOGONAL

vec4 layerPosition(vec4 position, inout vec4 stpq) {
  return layerScale * position + layerBias;
}
`,Szt=`// External
vec4 sampleData(vec4 xyzw);

vec4 lerpDepth(vec4 xyzw) {
  float x = xyzw.z;
  float i = floor(x);
  float f = x - i;
    
  vec4 xyzw1 = vec4(xyzw.xy, i, xyzw.w);
  vec4 xyzw2 = vec4(xyzw.xy, i + 1.0, xyzw.w);
  
  vec4 a = sampleData(xyzw1);
  vec4 b = sampleData(xyzw2);

  return mix(a, b, f);
}
`,Azt=`// External
vec4 sampleData(vec4 xyzw);

vec4 lerpHeight(vec4 xyzw) {
  float x = xyzw.y;
  float i = floor(x);
  float f = x - i;
    
  vec4 xyzw1 = vec4(xyzw.x, i, xyzw.zw);
  vec4 xyzw2 = vec4(xyzw.x, i + 1.0, xyzw.zw);
  
  vec4 a = sampleData(xyzw1);
  vec4 b = sampleData(xyzw2);

  return mix(a, b, f);
}
`,Ezt=`// External
vec4 sampleData(vec4 xyzw);

vec4 lerpItems(vec4 xyzw) {
  float x = xyzw.w;
  float i = floor(x);
  float f = x - i;
    
  vec4 xyzw1 = vec4(xyzw.xyz, i);
  vec4 xyzw2 = vec4(xyzw.xyz, i + 1.0);
  
  vec4 a = sampleData(xyzw1);
  vec4 b = sampleData(xyzw2);

  return mix(a, b, f);
}
`,Tzt=`// External
vec4 sampleData(vec4 xyzw);

vec4 lerpWidth(vec4 xyzw) {
  float x = xyzw.x;
  float i = floor(x);
  float f = x - i;
    
  vec4 xyzw1 = vec4(i, xyzw.yzw);
  vec4 xyzw2 = vec4(i + 1.0, xyzw.yzw);
  
  vec4 a = sampleData(xyzw1);
  vec4 b = sampleData(xyzw2);

  return mix(a, b, f);
}
`,Czt=`// Units and calibration
uniform float worldUnit;
uniform float lineWidth;
uniform float lineDepth;
uniform float focusDepth;

// General data index
uniform vec4 geometryClip;
attribute vec4 position4;

// (Top/bottom -1,1)
attribute float line;

// 0...1 for round or bevel joins
#ifdef LINE_JOIN_DETAIL
attribute float joint;
#else
const float joint = 0.0;
#endif

// Knock out excessively long line segments (e.g. for asymtpotes)
#ifdef LINE_PROXIMITY
uniform float lineProximity;
varying float vClipProximity;
#endif

// Ghetto line stroking (local only, not global)
#ifdef LINE_STROKE
varying float vClipStrokeWidth;
varying float vClipStrokeIndex;
varying vec3  vClipStrokeEven;
varying vec3  vClipStrokeOdd;
varying vec3  vClipStrokePosition;
#endif

// External
vec3 getPosition(vec4 xyzw, float canonical);

// Clip line ends for arrows / decoration
#ifdef LINE_CLIP
uniform float clipRange;
uniform vec2  clipStyle;
uniform float clipSpace;

attribute vec2 strip;

varying vec2 vClipEnds;

void clipEnds(vec4 xyzw, vec3 center, vec3 pos) {

  // Sample start of line strip
  vec4 xyzwS = vec4(0.0, xyzw.yzw);
  vec3 start = getPosition(xyzwS, 0.0);

  // Sample middle of line strip
  vec4 xyzwM = vec4(geometryClip.x / 2.0, xyzw.yzw);
  vec3 middle = getPosition(xyzwM, 0.0);

#ifdef LINE_CLOSED
  vec3 end = start;
#else
  // Sample other end of line strip
  vec4 xyzwE = vec4(geometryClip.x, xyzw.yzw);
  vec3 end   = getPosition(xyzwE, 0.0);
#endif

  // Measure length
  float l = max(length(end - middle), length(middle - start)) * clipSpace * 2.0;

  // Arrow length (=2.5x radius)
  float arrowSize = 1.25 * clipRange * lineWidth * worldUnit;

#ifdef LINE_CLOSED
  // Clip around start/end
  end = start;
#endif

  vClipEnds = vec2(1.0);

  if (clipStyle.y > 0.0) {
    // Depth blend end
    float depth = focusDepth;
    if (lineDepth < 1.0) {
      float z = max(0.00001, -end.z);
      depth = mix(z, focusDepth, lineDepth);
    }

    // Absolute arrow length
    float size = arrowSize * depth;

    // Adjust clip range
    // Approach linear scaling with cubic ease the smaller we get
    float mini = clamp(1.0 - l / size * .333, 0.0, 1.0);
    float scale = 1.0 - mini * mini * mini;
    float invrange = 1.0 / (size * scale);

    // Clip end
    vec3 diff = end - center;
    if(diff == vec3(0.0))
      vClipEnds.x = -1.0;
    else {
      diff = normalize(end - center);
      float d = dot(end - pos, diff);
      vClipEnds.x = d * invrange - 1.0;
    }
  }

  if (clipStyle.x > 0.0) {
    // Depth blend start
    float depth = focusDepth;
    if (lineDepth < 1.0) {
      float z = max(0.00001, -start.z);
      depth = mix(z, focusDepth, lineDepth);
    }

    // Absolute arrow length
    float size = arrowSize * depth;

    // Adjust clip range
    // Approach linear scaling with cubic ease the smaller we get
    float mini = clamp(1.0 - l / size * .333, 0.0, 1.0);
    float scale = 1.0 - mini * mini * mini;
    float invrange = 1.0 / (size * scale);

    // Clip start
    vec3 diff = center - start;
    if(diff == vec3(0.0))
      vClipEnds.y = -1.0;
    else {
      diff = normalize(center - start);
      float d = dot(pos - start, diff);
      vClipEnds.y = d * invrange - 1.0;
    }
  }
}
#endif

// Adjust left/center/right to be inside near/far z range
const float epsilon = 1e-5;
void fixCenter(inout vec3 left, inout vec3 center, inout vec3 right) {
  if (center.z >= 0.0) {
    if (left.z < 0.0) {
      float d = (center.z + epsilon) / (center.z - left.z);
      center = mix(center, left, d);
    }
    else if (right.z < 0.0) {
      float d = (center.z + epsilon) / (center.z - right.z);
      center = mix(center, right, d);
    }
  }

  if (left.z >= 0.0) {
    if (center.z < 0.0) {
      float d = (left.z + epsilon) / (left.z - center.z);
      left = mix(left, center, d);
    }
  }

  if (right.z >= 0.0) {
    if (center.z < 0.0) {
      float d = (right.z + epsilon) / (right.z - center.z);
      right = mix(right, center, d);
    }
  }
}

vec4 wrapAround(vec4 xyzw) {
#ifdef LINE_CLOSED
  float gx = geometryClip.x;
  if (xyzw.x < 0.0) xyzw.x += gx;
  if (xyzw.x >= gx) xyzw.x -= gx;
#endif
  return xyzw;
}

// Sample the source data in an edge-aware manner
void getLineGeometry(vec4 xyzw, float edge, out vec3 left, out vec3 center, out vec3 right) {
  vec4 delta = vec4(1.0, 0.0, 0.0, 0.0);

  center = getPosition(xyzw, 1.0);
  left   = (edge > -0.5) ? getPosition(wrapAround(xyzw - delta), 0.0) : center;
  right  = (edge < 0.5)  ? getPosition(wrapAround(xyzw + delta), 0.0) : center;
}

// Calculate the position for a vertex along the line, including joins
vec3 getLineJoin(float edge, bool odd, vec3 left, vec3 center, vec3 right, float width, float offset, float joint) {
  vec2 join = vec2(1.0, 0.0);

  fixCenter(left, center, right);

  vec4 a = vec4(left.xy, right.xy);
  vec4 b = a / vec4(left.zz, right.zz);

  vec2 l = b.xy;
  vec2 r = b.zw;
  vec2 c = center.xy / center.z;

  vec4 d = vec4(l, c) - vec4(c, r);
  float l1 = dot(d.xy, d.xy);
  float l2 = dot(d.zw, d.zw);

  if (l1 + l2 > 0.0) {

    if (edge > 0.5 || l2 == 0.0) {
      vec2 nl = normalize(d.xy);
      vec2 tl = vec2(nl.y, -nl.x);

#ifdef LINE_PROXIMITY
      vClipProximity = 1.0;
#endif

#ifdef LINE_STROKE
      vClipStrokeEven = vClipStrokeOdd = normalize(left - center);
#endif
      join = tl;
    }
    else if (edge < -0.5 || l1 == 0.0) {
      vec2 nr = normalize(d.zw);
      vec2 tr = vec2(nr.y, -nr.x);

#ifdef LINE_PROXIMITY
      vClipProximity = 1.0;
#endif

#ifdef LINE_STROKE
      vClipStrokeEven = vClipStrokeOdd = normalize(center - right);
#endif
      join = tr;
    }
    else {
      // Limit join stretch for tiny segments
      float lmin2 = min(l1, l2) / (width * width);

      // Hide line segment if ratio of leg lengths exceeds promixity threshold
#ifdef LINE_PROXIMITY
      float lr     = l1 / l2;
      float rl     = l2 / l1;
      float ratio  = max(lr, rl);
      float thresh = lineProximity + 1.0;
      vClipProximity = (ratio > thresh * thresh) ? 1.0 : 0.0;
#endif

      // Calculate normals/tangents
      vec2 nl = normalize(d.xy);
      vec2 nr = normalize(d.zw);

      // Calculate tangents
      vec2 tl = vec2(nl.y, -nl.x);
      vec2 tr = vec2(nr.y, -nr.x);

#ifdef LINE_PROXIMITY
      // Mix tangents according to leg lengths
      vec2 tc = normalize(mix(tl, tr, l1/(l1+l2)));
#else
      // Average tangent
      vec2 tc = normalize(tl + tr);
#endif

      // Miter join
      float cosA   = dot(nl, tc);
      float sinA   = max(0.1, abs(dot(tl, tc)));
      float factor = cosA / sinA;
      float scale  = sqrt(1.0 + min(lmin2, factor * factor));

      // Stroke normals
#ifdef LINE_STROKE
      vec3 stroke1 = normalize(left - center);
      vec3 stroke2 = normalize(center - right);

      if (odd) {
        vClipStrokeEven = stroke1;
        vClipStrokeOdd  = stroke2;
      }
      else {
        vClipStrokeEven = stroke2;
        vClipStrokeOdd  = stroke1;
      }
#endif

#ifdef LINE_JOIN_MITER
      // Apply straight up miter
      join = tc * scale;
#endif

#ifdef LINE_JOIN_ROUND
      // Slerp bevel join into circular arc
      float dotProduct = dot(nl, nr);
      float angle = acos(dotProduct);
      float sinT  = sin(angle);
      join = (sin((1.0 - joint) * angle) * tl + sin(joint * angle) * tr) / sinT;
#endif

#ifdef LINE_JOIN_BEVEL
      // Direct bevel join between two flat ends
      float dotProduct = dot(nl, nr);
      join = mix(tl, tr, joint);
#endif

#ifdef LINE_JOIN_DETAIL
      // Check if on inside or outside of joint
      float crossProduct = nl.x * nr.y - nl.y * nr.x;
      if (offset * crossProduct < 0.0) {
        // For near-180-degree bends, correct back to a miter to avoid discontinuities
        float ratio = clamp(-dotProduct * 2.0 - 1.0, 0.0, 1.0);
        // Otherwise collapse the inside vertices into one.
        join = mix(tc * scale, join, ratio * ratio * ratio);
      }
#endif

    }
    return vec3(join, 0.0);
  }
  else {
    return vec3(0.0);
  }

}

// Calculate final line position
vec3 getLinePosition() {
  vec3 left, center, right, join;

  // Up/down along segment
  float offset = line;

  // Clip data
  vec4 p = min(geometryClip, position4);

  // Left/center/right
  float edge = 0.0;
#ifdef LINE_CLOSED
  if (p.x == geometryClip.x) p.x = 0.0;
#else
  if (p.x == geometryClip.x) edge = 1.0;
  if (p.x == 0.0) edge = -1.0;
#endif

  // Get position + adjacent neighbours
  getLineGeometry(p, edge, left, center, right);

#ifdef LINE_STROKE
  // Set parameters for line stroke fragment shader
  vClipStrokePosition = center;
  vClipStrokeIndex = p.x;
  bool odd = mod(p.x, 2.0) >= 1.0;
#else
  bool odd = true;
#endif

  // Divide line width up/down
  float width = lineWidth * 0.5;

  float depth = focusDepth;
  if (lineDepth < 1.0) {
    // Depth blending
    float z = max(0.00001, -center.z);
    depth = mix(z, focusDepth, lineDepth);
  }
  width *= depth;

  // Convert to world units
  width *= worldUnit;

  // Calculate line join
#ifdef LINE_CLOSED
  join = getLineJoin(0.0, odd, left, center, right, width, offset, joint);
#else
  join = getLineJoin(edge, odd, left, center, right, width, offset, joint);
#endif
  vec3 pos = center + join * offset * width;

#ifdef LINE_STROKE
  vClipStrokeWidth = width;
#endif

#ifdef LINE_CLIP
  clipEnds(p, center, pos);
#endif

  return pos;
}
`,Pzt=`uniform vec2 dataResolution;
uniform vec2 dataPointer;

vec2 map2DData(vec2 xy) {
  return (xy + dataPointer) * dataResolution;
}
`,Rzt=`uniform vec2 dataResolution;
uniform vec2 dataPointer;

vec2 map2DData(vec2 xy) {
  return fract((xy + dataPointer) * dataResolution);
}
`,Lzt=`void mapXyzw2DV(vec4 xyzw, out vec2 xy, out float z) {
  xy = xyzw.xy;
  z  = xyzw.z;
}

`,Dzt=`vec4 alignXYZW(vec4 xyzw) {
  return floor(xyzw + .5);
}

`,Izt=`uniform float textureItems;
uniform float textureHeight;

vec2 mapXyzwTexture(vec4 xyzw) {
  
  float x = xyzw.x;
  float y = xyzw.y;
  float z = xyzw.z;
  float i = xyzw.w;
  
  return vec2(i, y) + vec2(x, z) * vec2(textureItems, textureHeight);
}

`,Ozt=`varying vec4 vColor;

vec4 getColor() {
  if (vColor.a <= 0.0) discard;
  return vColor;
}
`,zzt=`#ifdef POSITION_STPQ
varying vec4 vSTPQ;
#endif
#ifdef POSITION_U
varying float vU;
#endif
#ifdef POSITION_UV
varying vec2 vUV;
#endif
#ifdef POSITION_UVW
varying vec3 vUVW;
#endif
#ifdef POSITION_UVWO
varying vec4 vUVWO;
#endif

vec4 getSample(vec4 uvwo, vec4 stpq);

vec4 getMapColor() {
  #ifdef POSITION_STPQ
  vec4 stpq = vSTPQ;
  #else
  vec4 stpq = vec4(0.0);
  #endif

  #ifdef POSITION_U
  vec4 uvwo = vec4(vU, 0.0, 0.0, 0.0);
  #endif
  #ifdef POSITION_UV
  vec4 uvwo = vec4(vUV, 0.0, 0.0);
  #endif
  #ifdef POSITION_UVW
  vec4 uvwo = vec4(vUVW, 0.0);
  #endif
  #ifdef POSITION_UVWO
  vec4 uvwo = vec4(vUVWO);
  #endif

  return getSample(uvwo, stpq);
}
`,kzt=`varying float vMask;

float ease(float t) {
  t = clamp(t, 0.0, 1.0);
  return t * t * (3.0 - 2.0 * t);
}

vec4 maskColor() {
  if (vMask <= 0.0) discard;
  return vec4(vec3(1.0), ease(vMask));
}
`,Uzt=`#ifdef POSITION_STPQ
varying vec4 vSTPQ;
#endif
#ifdef POSITION_U
varying float vU;
#endif
#ifdef POSITION_UV
varying vec2 vUV;
#endif
#ifdef POSITION_UVW
varying vec3 vUVW;
#endif
#ifdef POSITION_UVWO
varying vec4 vUVWO;
#endif

vec4 getSample(vec4 rgba, vec4 stpq);

vec4 getMaterialColor(vec4 rgba) {
  vec4 stpq = vec4(0.0);

  #ifdef POSITION_U
  stpq.x = vU;
  #endif
  #ifdef POSITION_UV
  stpq.xy = vUV;
  #endif
  #ifdef POSITION_UVW
  stpq.xyz = vUVW;
  #endif
  #ifdef POSITION_UVWO
  stpq = vUVWO;
  #endif

  #ifdef POSITION_STPQ
  stpq = vSTPQ;
  #endif

  return getSample(rgba, stpq);
}
`,Nzt=`
#extension GL_OES_standard_derivatives : enable
varying vec3 vNormal;
varying vec3 vLight;
varying vec3 vPosition;

vec3 offSpecular(vec3 color) {
  vec3 c = 1.0 - color;
  return 1.0 - c * c;
}

vec4 getShadedColor(vec4 rgba) {
  
  vec3 color = rgba.xyz;
  vec3 color2 = offSpecular(rgba.xyz);

  vec3 normal = normalize(vNormal);
  vec3 light = normalize(vLight);
  vec3 position = normalize(vPosition);
  
  // Workaround to avoid gl_FrontFacing. See https://github.com/unconed/mathbox/pull/26
  vec3 pdx = dFdx(vPosition);
  vec3 pdy = dFdy(vPosition);
  bool frontFacting = dot(vNormal, cross(pdx, pdy)) > 0.0;

  float side = frontFacting ? 1.0 : -1.0;
  float cosine  = side * dot(normal, light);
  float diffuse = mix(max(0.0, cosine), .5 + .5 * cosine, .1);
  
  vec3  halfLight = normalize(light + position);
	float cosineHalf = max(0.0, side * dot(normal, halfLight));
	float specular = pow(cosineHalf, 16.0);
	
	return vec4(color * (diffuse * .9 + .05) + .25 * color2 * specular, rgba.a);
}
`,Fzt="",Bzt=`vec4 getGammaInColor(vec4 rgba) {
  return vec4(rgba.rgb * rgba.rgb, rgba.a);
}
`,Hzt=`vec4 getGammaOutColor(vec4 rgba) {
  return vec4(sqrt(rgba.rgb), rgba.a);
}
`,Vzt=`vec4 mapUVWO(vec4 uvwo, vec4 stpq) {
  return uvwo;
}
`,Gzt=`uniform vec4 geometryClip;
attribute vec4 position4;

// External
vec3 getPosition(vec4 xyzw, float canonical);

vec3 getMeshPosition() {
  vec4 p = min(geometryClip, position4);
  return getPosition(p, 1.0);
}
`,qzt=`attribute vec4 position4;
uniform vec4 geometryClip;
varying vec4 vColor;

// External
vec4 getSample(vec4 xyzw);

void vertexColor() {
  vec4 p = min(geometryClip, position4);
  vColor = getSample(p);
}
`,Wzt=`attribute vec4 position4;
uniform vec4 geometryResolution;
uniform vec4 geometryClip;
varying float vMask;

// External
float getSample(vec4 xyzw);

void maskLevel() {
  vec4 p = min(geometryClip, position4);
  vMask = getSample(p * geometryResolution);
}
`,$zt=`uniform vec4 geometryResolution;

#ifdef POSITION_STPQ
varying vec4 vSTPQ;
#endif
#ifdef POSITION_U
varying float vU;
#endif
#ifdef POSITION_UV
varying vec2 vUV;
#endif
#ifdef POSITION_UVW
varying vec3 vUVW;
#endif
#ifdef POSITION_UVWO
varying vec4 vUVWO;
#endif

// External
vec3 getPosition(vec4 xyzw, in vec4 stpqIn, out vec4 stpqOut);

vec3 getMeshPosition(vec4 xyzw, float canonical) {
  vec4 stpqOut, stpqIn = xyzw * geometryResolution;
  vec3 xyz = getPosition(xyzw, stpqIn, stpqOut);

  #ifdef POSITION_MAP
  if (canonical > 0.5) {
    #ifdef POSITION_STPQ
    vSTPQ = stpqOut;
    #endif
    #ifdef POSITION_U
    vU = stpqOut.x;
    #endif
    #ifdef POSITION_UV
    vUV = stpqOut.xy;
    #endif
    #ifdef POSITION_UVW
    vUVW = stpqOut.xyz;
    #endif
    #ifdef POSITION_UVWO
    vUVWO = stpqOut;
    #endif
  }
  #endif
  return xyz;
}
`,Xzt=`uniform float transitionEnter;
uniform float transitionExit;
uniform vec4  transitionScale;
uniform vec4  transitionBias;
uniform float transitionSkew;
uniform float transitionActive;

uniform vec4  moveFrom;
uniform vec4  moveTo;

float ease(float t) {
  t = clamp(t, 0.0, 1.0);
  return 1.0 - (2.0 - t) * t;
}

vec4 getTransitionPosition(vec4 xyzw, inout vec4 stpq) {
  if (transitionActive < 0.5) return xyzw;

  float enter   = transitionEnter;
  float exit    = transitionExit;
  float skew    = transitionSkew;
  vec4  scale   = transitionScale;
  vec4  bias    = transitionBias;

  float factor  = 1.0 + skew;
  float offset  = dot(vec4(1.0), stpq * scale + bias);

  float a1 = ease(enter * factor - offset);
  float a2 = ease(exit  * factor + offset - skew);

  return xyzw + a1 * moveFrom + a2 * moveTo;
}`,jzt=`vec4 getMask(vec4 xyzw) {
  return vec4(1.0);
}`,Yzt=`varying float vPixelSize;

float getDiscAlpha(float mask) {
  // Approximation: 1 - x*x is approximately linear around x = 1 with slope 2
  return vPixelSize * (1.0 - mask);
  //  return vPixelSize * 2.0 * (1.0 - sqrt(mask));
}
`,Zzt=`varying float vPixelSize;

float getDiscHollowAlpha(float mask) {
  return vPixelSize * (0.5 - 2.0 * abs(sqrt(mask) - .75));
}
`,Kzt=`varying float vPixelSize;

float getGenericAlpha(float mask) {
  return vPixelSize * 2.0 * (1.0 - mask);
}
`,Jzt=`varying float vPixelSize;

float getGenericHollowAlpha(float mask) {
  return vPixelSize * (0.5 - 2.0 * abs(mask - .75));
}
`,Qzt=`varying vec2 vSprite;

float getSpriteMask(vec2 xy);
float getSpriteAlpha(float mask);

void setFragmentColorFill(vec4 color) {
  float mask = getSpriteMask(vSprite);
  if (mask > 1.0) {
    discard;
  }
  float alpha = getSpriteAlpha(mask);
  if (alpha >= 1.0) {
    discard;
  }
  gl_FragColor = vec4(color.rgb, alpha * color.a);
}
`,tkt=`varying vec2 vSprite;

float getSpriteMask(vec2 xy);
float getSpriteAlpha(float mask);

void setFragmentColorFill(vec4 color) {
  float mask = getSpriteMask(vSprite);
  if (mask > 1.0) {
    discard;
  }
  float alpha = getSpriteAlpha(mask);
  if (alpha < 1.0) {
    discard;
  }
  gl_FragColor = color;
}

`,ekt=`varying float vPixelSize;

float getCircleMask(vec2 uv) {
  return dot(uv, uv);
}
`,nkt=`varying float vPixelSize;

float getDiamondMask(vec2 uv) {
  vec2 a = abs(uv);
  return a.x + a.y;
}
`,ikt=`varying float vPixelSize;

float getTriangleDownMask(vec2 uv) {
  uv.y += .25;
  return max(uv.y, abs(uv.x) * .866 - uv.y * .5 + .6);
}
`,skt=`varying float vPixelSize;

float getTriangleLeftMask(vec2 uv) {
  uv.x += .25;
  return max(uv.x, abs(uv.y) * .866 - uv.x * .5 + .6);
}
`,rkt=`varying float vPixelSize;

float getTriangleRightMask(vec2 uv) {
  uv.x -= .25;
  return max(-uv.x, abs(uv.y) * .866 + uv.x * .5 + .6);
}
`,okt=`varying float vPixelSize;

float getSquareMask(vec2 uv) {
  vec2 a = abs(uv);
  return max(a.x, a.y);
}
`,akt=`varying float vPixelSize;

float getTriangleUpMask(vec2 uv) {
  uv.y -= .25;
  return max(-uv.y, abs(uv.x) * .866 + uv.y * .5 + .6);
}
`,lkt=`uniform float pointDepth;

uniform float pixelUnit;
uniform float renderScale;
uniform float renderScaleInv;
uniform float focusDepth;

uniform vec4 geometryClip;
attribute vec4 position4;
attribute vec2 sprite;

varying vec2 vSprite;
varying float vPixelSize;

const float pointScale = POINT_SHAPE_SCALE;

// External
float getPointSize(vec4 xyzw);
vec3 getPosition(vec4 xyzw, float canonical);

vec3 getPointPosition() {
  // Discard out-of-range points by generating degenerate face
  if (
    position4.x > geometryClip.x ||
    position4.y > geometryClip.y ||
    position4.z > geometryClip.z ||
    position4.w > geometryClip.w
  ) return vec3(0.0, 0.0, 0.0);
  vec4 p = position4;

  vec3 center = getPosition(p, 1.0);

  // Depth blending
  // TODO: orthographic camera
  // Workaround: set depth = 0
  float z = -center.z;
  float depth = mix(z, focusDepth, pointDepth);

  // Match device/unit mapping
  // Sprite goes from -1..1, width = 2.
  float pointSize = getPointSize(p);
  float size = pointScale * pointSize * pixelUnit * .5;
  float depthSize = depth * size;

  // Pad sprite by half a pixel to make the anti-aliasing straddle the pixel edge
  // Note: pixelsize measures radius
  float pixelSize = .5 * (pointDepth > 0.0 ? depthSize / z : size);
  float paddedSize = pixelSize + 0.5;
  float padFactor = paddedSize / pixelSize;

  vPixelSize = paddedSize;
  vSprite    = sprite;

  return center + vec3(sprite * depthSize * renderScaleInv * padFactor, 0.0);
}
`,ckt=`uniform float pointSize;

float getPointSize(vec4 xyzw) {
  return pointSize;
}`,ukt=`uniform float pointSize;

vec4 getSample(vec4 xyzw);

float getPointSize(vec4 xyzw) {
  return pointSize * getSample(xyzw).x;
}`,hkt=`uniform float polarBend;
uniform float polarFocus;
uniform float polarAspect;
uniform float polarHelix;

uniform mat4 viewMatrix;

vec4 getPolarPosition(vec4 position, inout vec4 stpq) {
  if (polarBend > 0.0) {

    if (polarBend < 0.001) {
      // Factor out large addition/subtraction of polarFocus
      // to avoid numerical error
      // sin(x) ~ x
      // cos(x) ~ 1 - x * x / 2
      vec2 pb = position.xy * polarBend;
      float ppbbx = pb.x * pb.x;
      return viewMatrix * vec4(
        position.x * (1.0 - polarBend + (pb.y * polarAspect)),
        position.y * (1.0 - .5 * ppbbx) - (.5 * ppbbx) * polarFocus / polarAspect,
        position.z + position.x * polarHelix * polarBend,
        1.0
      );
    }
    else {
      vec2 xy = position.xy * vec2(polarBend, polarAspect);
      float radius = polarFocus + xy.y;
      return viewMatrix * vec4(
        sin(xy.x) * radius,
        (cos(xy.x) * radius - polarFocus) / polarAspect,
        position.z + position.x * polarHelix * polarBend,
        1.0
      );
    }
  }
  else {
    return viewMatrix * vec4(position.xyz, 1.0);
  }
}`,fkt=`uniform float styleZBias;
uniform float styleZIndex;

void setPosition(vec3 position) {

  #ifdef PROJECT_ORTHOGONAL
  // Orthogonal projection with depth preservation around z = 1
  vec4 pos = projectionMatrix * vec4(position, 1.0);
  pos.xy *= -position.z;
  #else
  // Normal perspective projection
  vec4 pos = projectionMatrix * vec4(position, 1.0);
  #endif

  // Apply relative Z bias
  float bias  = (1.0 - styleZBias / 32768.0);
  pos.z *= bias;

  // Apply large scale Z index changes
  if (styleZIndex > 0.0) {
    float z = pos.z / pos.w;
    pos.z = ((z + 1.0) / (styleZIndex + 1.0) - 1.0) * pos.w;
  }

  gl_Position = pos;
}`,dkt=`// This is three.js' global uniform, missing from fragment shaders.
uniform mat4 projectionMatrix;

vec4 readbackPosition(vec3 position, vec4 stpq) {
  vec4 pos = projectionMatrix * vec4(position, 1.0);
  vec3 final = pos.xyz / pos.w;
  if (final.z < -1.0) {
    return vec4(0.0, 0.0, 0.0, -1.0);
  }
  else {
    return vec4(final, -position.z);
  }
}
`,pkt=`uniform vec4 geometryScale;
attribute vec4 position4;

vec4 getRawPositionScale() {
  return geometryScale * position4;
}
`,mkt=`uniform vec4 repeatModulus;

vec4 getRepeatXYZW(vec4 xyzw) {
  return mod(xyzw + .5, repeatModulus) - .5;
}
`,gkt=`uniform vec4 resampleBias;

vec4 resamplePadding(vec4 xyzw) {
  return xyzw + resampleBias;
}`,vkt=`uniform vec4 resampleFactor;

vec4 resampleRelative(vec4 xyzw) {
  return xyzw * resampleFactor;
}`,_kt=`uniform float transitionEnter;
uniform float transitionExit;
uniform vec4  transitionScale;
uniform vec4  transitionBias;
uniform float transitionSkew;
uniform float transitionActive;

float getTransitionSDFMask(vec4 stpq) {
  if (transitionActive < 0.5) return 1.0;

  float enter   = transitionEnter;
  float exit    = transitionExit;
  float skew    = transitionSkew;
  vec4  scale   = transitionScale;
  vec4  bias    = transitionBias;

  float factor  = 1.0 + skew;
  float offset  = dot(vec4(1.0), stpq * scale + bias);

  vec2 d = vec2(enter, exit) * factor + vec2(-offset, offset - skew);
  if (exit  == 1.0) return d.x;
  if (enter == 1.0) return d.y;
  return min(d.x, d.y);
}`,ykt=`uniform vec4 reverseScale;
uniform vec4 reverseOffset;

vec4 getReverseOffset(vec4 xyzw) {
  return xyzw * reverseScale + reverseOffset;
}`,xkt=`vec3 getRootPosition(vec4 position, in vec4 stpqIn, out vec4 stpqOut) {
  stpqOut = stpqIn; // avoid inout confusion
  return position.xyz;
}`,bkt=`uniform sampler2D dataTexture;

vec4 sample2D(vec2 uv) {
  return texture2D(dataTexture, uv);
}
`,wkt=`uniform vec4 scaleAxis;
uniform vec4 scaleOffset;

vec4 sampleData(float x);

vec4 getScalePosition(vec4 xyzw) {
  return scaleAxis * sampleData(xyzw.x).x + scaleOffset;
}
`,Mkt=`uniform vec4 remapSTPQScale;

vec4 screenMapSTPQ(vec4 xyzw, out vec4 stpq) {
  stpq = xyzw * remapSTPQScale;
  return xyzw;
}
`,Skt=`uniform vec2 remapUVScale;

vec4 screenMapXY(vec4 uvwo, vec4 stpq) {
  return vec4(floor(remapUVScale * uvwo.xy), 0.0, 0.0);
}
`,Akt=`uniform vec2 remapUVScale;
uniform vec2 remapModulus;
uniform vec2 remapModulusInv;

vec4 screenMapXYZW(vec4 uvwo, vec4 stpq) {
  vec2 st = floor(remapUVScale * uvwo.xy);
  vec2 xy = st * remapModulusInv;
  vec2 ixy = floor(xy);
  vec2 fxy = xy - ixy;
  vec2 zw = fxy * remapModulus;
  return vec4(ixy.x, zw.y, ixy.y, zw.x);
}
`,Ekt=`vec2 screenPassUV(vec4 uvwo, vec4 stpq) {
  return uvwo.xy;
}
`,Tkt=`void setScreenPosition(vec4 position) {
  gl_Position = vec4(position.xy * 2.0 - 1.0, 0.5, 1.0);
}
`,Ckt=`uniform vec4 sliceOffset;

vec4 getSliceOffset(vec4 xyzw) {
  return xyzw + sliceOffset;
}
`,Pkt=`uniform float sphericalBend;
uniform float sphericalFocus;
uniform float sphericalAspectX;
uniform float sphericalAspectY;
uniform float sphericalScaleY;

uniform mat4 viewMatrix;

vec4 getSphericalPosition(vec4 position, inout vec4 stpq) {
  if (sphericalBend > 0.0001) {

    vec3 xyz = position.xyz * vec3(sphericalBend, sphericalBend / sphericalAspectY * sphericalScaleY, sphericalAspectX);
    float radius = sphericalFocus + xyz.z;
    float cosine = cos(xyz.y) * radius;

    return viewMatrix * vec4(
      sin(xyz.x) * cosine,
      sin(xyz.y) * radius * sphericalAspectY,
      (cos(xyz.x) * cosine - sphericalFocus) / sphericalAspectX,
      1.0
    );
  }
  else {
    return viewMatrix * vec4(position.xyz, 1.0);
  }
}`,Rkt=`uniform float splitStride;

vec2 getIndices(vec4 xyzw);
vec4 getRest(vec4 xyzw);
vec4 injectIndex(float v);

vec4 getSplitXYZW(vec4 xyzw) {
  vec2 uv = getIndices(xyzw);
  float offset = uv.x + uv.y * splitStride;
  return injectIndex(offset) + getRest(xyzw);
}
`,Lkt=`uniform vec4 spreadOffset;
uniform mat4 spreadMatrix;

// External
vec4 getSample(vec4 xyzw);

vec4 getSpreadSample(vec4 xyzw) {
  vec4 sample = getSample(xyzw);
  return sample + spreadMatrix * (spreadOffset + xyzw);
}
`,Dkt=`varying vec2 vSprite;

vec4 getSample(vec2 xy);

vec4 getSpriteColor() {
  return getSample(vSprite);
}`,Ikt=`uniform vec2 spriteOffset;
uniform float spriteScale;
uniform float spriteDepth;
uniform float spriteSnap;

uniform vec2 renderOdd;
uniform float renderScale;
uniform float renderScaleInv;
uniform float pixelUnit;
uniform float focusDepth;

uniform vec4 geometryClip;
attribute vec4 position4;
attribute vec2 sprite;

varying float vPixelSize;

// External
vec3 getPosition(vec4 xyzw, float canonical);
vec4 getSprite(vec4 xyzw);

vec3 getSpritePosition() {
  // Clip points
  vec4 p = min(geometryClip, position4);
  float diff = length(position4 - p);
  if (diff > 0.0) {
    return vec3(0.0, 0.0, 1000.0);
  }

  // Make sprites
  vec3 center = getPosition(p, 1.0);
  vec4 atlas = getSprite(p);

  // Sprite goes from -1..1, width = 2.
  // -1..1 -> -0.5..0.5
  vec2 halfSprite = sprite * .5;
  vec2 halfFlipSprite = vec2(halfSprite.x, -halfSprite.y);

#ifdef POSITION_UV
  // Assign UVs
  vUV = atlas.xy + atlas.zw * (halfFlipSprite + .5);
#endif

  // Depth blending
  // TODO: orthographic camera
  // Workaround: set depth = 0
  float depth = focusDepth, z;
  z = -center.z;
  if (spriteDepth < 1.0) {
    depth = mix(z, focusDepth, spriteDepth);
  }
  
  // Match device/unit mapping 
  float size = pixelUnit * spriteScale;
  float depthSize = depth * size;

  // Calculate pixelSize for anti-aliasing
  float pixelSize = (spriteDepth > 0.0 ? depthSize / z : size);
  vPixelSize = pixelSize;

  // Position sprite
  vec2 atlasOdd = fract(atlas.zw / 2.0);
  vec2 offset = (spriteOffset + halfSprite * atlas.zw) * depthSize;
  if (spriteSnap > 0.5) {
    // Snap to pixel (w/ epsilon shift to avoid jitter)
    return vec3(((floor(center.xy / center.z * renderScale + 0.001) + renderOdd + atlasOdd) * center.z + offset) * renderScaleInv, center.z);
  }
  else {
    // Place directly
    return center + vec3(offset * renderScaleInv, 0.0);
  }

}
`,Okt=`uniform float stereoBend;
uniform vec4 basisScale;
uniform vec4 basisOffset;
uniform mat4 viewMatrix;
uniform vec2 view4D;

vec4 getStereographic4Position(vec4 position, inout vec4 stpq) {
  
  vec4 transformed;
  if (stereoBend > 0.0001) {

    float r = length(position);
    float w = r + position.w;
    vec4 project = vec4(position.xyz / w, r);
    
    transformed = mix(position, project, stereoBend);
  }
  else {
    transformed = position;
  }

  vec4 pos4 = transformed * basisScale - basisOffset;
  vec3 xyz = (viewMatrix * vec4(pos4.xyz, 1.0)).xyz;
  return vec4(xyz, pos4.w * view4D.y + view4D.x);
}
`,zkt=`uniform float stereoBend;

uniform mat4 viewMatrix;

vec4 getStereoPosition(vec4 position, inout vec4 stpq) {
  if (stereoBend > 0.0001) {

    vec3 pos = position.xyz;
    float r = length(pos);
    float z = r + pos.z;
    vec3 project = vec3(pos.xy / z, r);
    
    vec3 lerped = mix(pos, project, stereoBend);

    return viewMatrix * vec4(lerped, 1.0);
  }
  else {
    return viewMatrix * vec4(position.xyz, 1.0);
  }
}`,kkt=`varying vec2 vST;

vec4 getSample(vec2 st);

vec4 getSTSample() {
  return getSample(vST);
}
`,Ukt=`varying vec2 vUV;

void setRawUV(vec4 xyzw) {
  vUV = xyzw.xy;
}
`,Nkt=`uniform vec4 geometryClip;
attribute vec4 position4;
attribute vec3 strip;

// External
vec3 getPosition(vec4 xyzw, float canonical);

varying vec3 vNormal;
varying vec3 vLight;
varying vec3 vPosition;

void getStripGeometry(vec4 xyzw, vec3 strip, out vec3 pos, out vec3 normal) {
  vec3 a, b, c;

  a   = getPosition(xyzw, 1.0);
  b   = getPosition(vec4(xyzw.xyz, strip.x), 0.0);
  c   = getPosition(vec4(xyzw.xyz, strip.y), 0.0);

  normal = normalize(cross(c - a, b - a)) * strip.z;
  
  pos = a;
}

vec3 getStripPositionNormal() {
  vec3 center, normal;

  vec4 p = min(geometryClip, position4);

  getStripGeometry(p, strip, center, normal);
  vNormal   = normal;
  vLight    = normalize((viewMatrix * vec4(1.0, 2.0, 2.0, 0.0)).xyz);
  vPosition = -center;

  return center;
}
`,Fkt=`uniform vec3 styleColor;
uniform float styleOpacity;

vec4 getStyleColor() {
  return vec4(styleColor, styleOpacity);
}
`,Bkt=`uniform float subdivideBevel;

// External
vec4 sampleData(vec4 xyzw);

vec4 subdivideDepth(vec4 xyzw) {
  float x = xyzw.z;
  float i = floor(x);
  float f = x - i;

  float minf = subdivideBevel * min(f, 1.0 - f);
  float g = (f > 0.5) ? 1.0 - minf : (f < 0.5) ? minf : 0.5;

  return sampleData(vec4(xyzw.xy, i + g, xyzw.w));
}
`,Hkt=`uniform float subdivideBevel;

// External
vec4 sampleData(vec4 xyzw);

vec4 subdivideDepthLerp(vec4 xyzw) {
  float x = xyzw.z;
  float i = floor(x);
  float f = x - i;

  float minf = subdivideBevel * min(f, 1.0 - f);
  float g = (f > 0.5) ? 1.0 - minf : (f < 0.5) ? minf : 0.5;

  vec4 xyzw1 = vec4(xyzw.xy, i, xyzw.w);
  vec4 xyzw2 = vec4(xyzw.xy, i + 1.0, xyzw.w);
  
  vec4 a = sampleData(xyzw1);
  vec4 b = sampleData(xyzw2);

  return mix(a, b, g);
}
`,Vkt=`uniform float subdivideBevel;

// External
vec4 sampleData(vec4 xyzw);

vec4 subdivideHeight(vec4 xyzw) {
  float x = xyzw.y;
  float i = floor(x);
  float f = x - i;

  float minf = subdivideBevel * min(f, 1.0 - f);
  float g = (f > 0.5) ? 1.0 - minf : (f < 0.5) ? minf : 0.5;

  return sampleData(vec4(xyzw.x, i + g, xyzw.zw));
}
`,Gkt=`uniform float subdivideBevel;

// External
vec4 sampleData(vec4 xyzw);

vec4 subdivideHeightLerp(vec4 xyzw) {
  float x = xyzw.y;
  float i = floor(x);
  float f = x - i;

  float minf = subdivideBevel * min(f, 1.0 - f);
  float g = (f > 0.5) ? 1.0 - minf : (f < 0.5) ? minf : 0.5;

  vec4 xyzw1 = vec4(xyzw.x, i, xyzw.zw);
  vec4 xyzw2 = vec4(xyzw.x, i + 1.0, xyzw.zw);
  
  vec4 a = sampleData(xyzw1);
  vec4 b = sampleData(xyzw2);

  return mix(a, b, g);
}
`,qkt=`uniform float subdivideBevel;

// External
vec4 sampleData(vec4 xyzw);

vec4 subdivideItems(vec4 xyzw) {
  float x = xyzw.w;
  float i = floor(x);
  float f = x - i;

  float minf = subdivideBevel * min(f, 1.0 - f);
  float g = (f > 0.5) ? 1.0 - minf : (f < 0.5) ? minf : 0.5;

  return sampleData(vec4(xyzw.xyz, i + g));
}
`,Wkt=`uniform float subdivideBevel;

// External
vec4 sampleData(vec4 xyzw);

vec4 subdivideItemsLerp(vec4 xyzw) {
  float x = xyzw.w;
  float i = floor(x);
  float f = x - i;

  float minf = subdivideBevel * min(f, 1.0 - f);
  float g = (f > 0.5) ? 1.0 - minf : (f < 0.5) ? minf : 0.5;

  vec4 xyzw1 = vec4(xyzw.xyz, i);
  vec4 xyzw2 = vec4(xyzw.xyz, i + 1.0);
  
  vec4 a = sampleData(xyzw1);
  vec4 b = sampleData(xyzw2);

  return mix(a, b, g);
}
`,$kt=`uniform float subdivideBevel;

// External
vec4 sampleData(vec4 xyzw);

vec4 subdivideWidth(vec4 xyzw) {
  float x = xyzw.x;
  float i = floor(x);
  float f = x - i;

  float minf = subdivideBevel * min(f, 1.0 - f);
  float g = (f > 0.5) ? 1.0 - minf : (f < 0.5) ? minf : 0.5;

  return sampleData(vec4(i + g, xyzw.yzw));
}
`,Xkt=`uniform float subdivideBevel;

// External
vec4 sampleData(vec4 xyzw);

vec4 subdivideWidthLerp(vec4 xyzw) {
  float x = xyzw.x;
  float i = floor(x);
  float f = x - i;

  float minf = subdivideBevel * min(f, 1.0 - f);
  float g = (f > 0.5) ? 1.0 - minf : (f < 0.5) ? minf : 0.5;

  vec4 xyzw1 = vec4(i, xyzw.yzw);
  vec4 xyzw2 = vec4(i + 1.0, xyzw.yzw);
  
  vec4 a = sampleData(xyzw1);
  vec4 b = sampleData(xyzw2);

  return mix(a, b, g);
}
`,jkt=`attribute vec4 position4;

float getSurfaceHollowMask(vec4 xyzw) {
  vec4 df = abs(fract(position4) - .5);
  vec2 df2 = min(df.xy, df.zw);
  float df3 = min(df2.x, df2.y);
  return df3;
}`,Ykt=`uniform vec4 geometryClip;
uniform vec4 geometryResolution;
uniform vec4 mapSize;

attribute vec4 position4;

// External
vec3 getPosition(vec4 xyzw, float canonical);

vec3 getSurfacePosition() {
  vec4 p = min(geometryClip, position4);

#ifdef SURFACE_CLOSED_X
  if (p.x == geometryClip.x) p.x = 0.0;
#endif
#ifdef SURFACE_CLOSED_Y
  if (p.y == geometryClip.y) p.y = 0.0;
#endif

  vec3 xyz = getPosition(p, 1.0);

  // Overwrite UVs
#ifdef POSITION_UV
#ifdef POSITION_UV_INT
  vUV = -.5 + (position4.xy * geometryResolution.xy) * mapSize.xy;
#else
  vUV = position4.xy * geometryResolution.xy;
#endif
#endif

  return xyz;
}
`,Zkt=`uniform vec4 mapSize;
uniform vec4 geometryResolution;
uniform vec4 geometryClip;
attribute vec4 position4;

// External
vec3 getPosition(vec4 xyzw, float canonical);
vec3 getNormal(vec4 xyzw);

varying vec3 vNormal;
varying vec3 vLight;
varying vec3 vPosition;

vec3 getSurfacePositionNormal() {

  vec4 p = min(geometryClip, position4);
#ifdef SURFACE_CLOSED_X
  if (p.x == geometryClip.x) p.x = 0.0;
#endif
#ifdef SURFACE_CLOSED_Y
  if (p.y == geometryClip.y) p.y = 0.0;
#endif

  vec3 center = getPosition(p, 1.0);
  vNormal     = normalMatrix * normalize(getNormal(p));
  vLight      = normalize((viewMatrix * vec4(1.0, 2.0, 2.0, 0.0)).xyz); // hardcoded directional light
  vPosition   = -center;

#ifdef POSITION_UV
#ifdef POSITION_UV_INT
  vUV = -.5 + (position4.xy * geometryResolution.xy) * mapSize.xy;
#else
  vUV = position4.xy * geometryResolution.xy;
#endif
#endif

  return center;
}
`,Kkt=`uniform vec4 mapSize;
uniform vec4 geometryResolution;
uniform vec4 geometryClip;
attribute vec4 position4;

// External
vec3 getPosition(vec4 xyzw, float canonical);

vec4 wrapAround(vec4 xyzw) {
#ifdef SURFACE_CLOSED_X
  float gx = geometryClip.x;
  if (xyzw.x < 0.0) xyzw.x += gx;
  if (xyzw.x >= gx) xyzw.x -= gx;
#endif
#ifdef SURFACE_CLOSED_Y
  float gy = geometryClip.y;
  if (xyzw.y < 0.0) xyzw.y += gy;
  if (xyzw.y >= gy) xyzw.y -= gy;
#endif
  return xyzw;
}

void getSurfaceGeometry(vec4 xyzw, float edgeX, float edgeY, out vec3 left, out vec3 center, out vec3 right, out vec3 up, out vec3 down) {
  vec4 deltaX = vec4(1.0, 0.0, 0.0, 0.0);
  vec4 deltaY = vec4(0.0, 1.0, 0.0, 0.0);

  center =                  getPosition(xyzw, 1.0);
  left   =                  center;
  down   =                  center;
  right  = (edgeX < 0.5)  ? getPosition(wrapAround(xyzw + deltaX), 0.0) : (2.0 * center - getPosition(xyzw - deltaX, 0.0));
  up     = (edgeY < 0.5)  ? getPosition(wrapAround(xyzw + deltaY), 0.0) : (2.0 * center - getPosition(xyzw - deltaY, 0.0));
}

vec3 getSurfaceNormal(vec3 left, vec3 center, vec3 right, vec3 up, vec3 down) {
  vec3 dx = right - left;
  vec3 dy = up    - down;
  vec3 n = cross(dy, dx);
  if (length(n) > 0.0) {
    return normalize(n);
  }
  return vec3(0.0, 1.0, 0.0);
}

varying vec3 vNormal;
varying vec3 vLight;
varying vec3 vPosition;

vec3 getSurfacePositionShaded() {
  vec3 left, center, right, up, down;

  vec4 p = min(geometryClip, position4);
  vec2 surface = vec2(0.0);
#ifdef SURFACE_CLOSED_X
  if (p.x == geometryClip.x) p.x = 0.0;
#else
  if (p.x == geometryClip.x) surface.x = 1.0;
  //if (p.x == 0.0) surface.x = -1.0;
#endif
#ifdef SURFACE_CLOSED_Y
  if (p.y == geometryClip.y) p.y = 0.0;
#else
  if (p.y == geometryClip.y) surface.y = 1.0;
  //if (p.y == 0.0) surface.y = -1.0;
#endif

  getSurfaceGeometry(p, surface.x, surface.y, left, center, right, up, down);
  vNormal   = getSurfaceNormal(left, center, right, up, down);
  vLight    = normalize((viewMatrix * vec4(1.0, 2.0, 2.0, 0.0)).xyz); // hardcoded directional light
  vPosition = -center;

#ifdef POSITION_UV
#ifdef POSITION_UV_INT
  vUV = -.5 + (position4.xy * geometryResolution.xy) * mapSize.xy;
#else
  vUV = position4.xy * geometryResolution.xy;
#endif
#endif

  return center;
}
`,Jkt=`uniform float worldUnit;
uniform float focusDepth;
uniform float tickSize;
uniform float tickEpsilon;
uniform vec3  tickNormal;
uniform vec2  tickStrip;

vec4 getSample(vec4 xyzw);

vec3 transformPosition(vec4 position, in vec4 stpqIn, out vec4 stpqOut);

vec3 getTickPosition(vec4 xyzw, in vec4 stpqIn, out vec4 stpqOut) {
  float epsilon = tickEpsilon;

  // determine tick direction
  float leftX  = max(tickStrip.x, xyzw.y - 1.0);
  float rightX = min(tickStrip.y, xyzw.y + 1.0);
  
  vec4 left    = getSample(vec4(leftX,  xyzw.zw, 0.0));
  vec4 right   = getSample(vec4(rightX, xyzw.zw, 0.0));
  vec4 diff    = right - left;

  vec3 normal  = cross(normalize(diff.xyz + vec3(diff.w)), tickNormal);
  float bias   = max(0.0, 1.0 - length(normal) * 2.0);
       normal  = mix(normal, tickNormal.yzx, bias * bias);
  
  // transform (point) and (point + delta)
  vec4 center  = getSample(vec4(xyzw.yzw, 0.0));
  vec4 delta   = vec4(normal, 0.0) * epsilon;

  vec4 a = center;
  vec4 b = center + delta;

  vec4 _;
  vec3 c = transformPosition(a, stpqIn, stpqOut);
  vec3 d = transformPosition(b, stpqIn, _);
  
  // sample on either side to create line
  float line = xyzw.x - .5;
  vec3  mid  = c;
  vec3  side = normalize(d - c);

  return mid + side * line * tickSize * worldUnit * focusDepth;
}
`,Qkt=`uniform mat4 transformMatrix;

vec4 transformPosition(vec4 position, inout vec4 stpq) {
  return transformMatrix * vec4(position.xyz, 1.0);
}
`,t3t=`uniform mat4 transformMatrix;
uniform vec4 transformOffset;

vec4 transformPosition(vec4 position, inout vec4 stpq) {
  return transformMatrix * position + transformOffset;
}
`,e3t=`// Implicit three.js uniform
// uniform mat4 viewMatrix;

vec4 getViewPosition(vec4 position, inout vec4 stpq) {
  return (viewMatrix * vec4(position.xyz, 1.0));
}
`;let Yn=class Ev{static initClass(){this.index=0,this.IN=0,this.OUT=1}static id(t){return++Ev.index}constructor(t,e=null){this.parent=e,this.id=Ev.id(),this.nodes=[],t&&this.add(t)}inputs(){const t=[];for(const e of Array.from(this.nodes))for(const n of Array.from(e.inputs))n.input===null&&t.push(n);return t}outputs(){const t=[];for(const e of Array.from(this.nodes))for(const n of Array.from(e.outputs))n.output.length===0&&t.push(n);return t}getIn(t){return Array.from(this.inputs()).filter(e=>e.name===t)[0]}getOut(t){return Array.from(this.outputs()).filter(e=>e.name===t)[0]}add(t,e){if(t.length){for(const n of Array.from(t))this.add(n);return}if(t.graph&&!e)throw new Error("Adding node to two graphs at once");t.graph=this,this.nodes.push(t)}remove(t,e){if(t.length){for(const n of Array.from(t))this.remove(n);return}if(t.graph!==this)throw new Error("Removing node from wrong graph.");e||t.disconnect(),this.nodes.splice(this.nodes.indexOf(t),1),t.graph=null}adopt(t){if(t.length){for(const e of Array.from(t))this.adopt(e);return}t.graph.remove(t,!0),this.add(t,!0)}};Yn.initClass();class _i{static initClass(){this.index=0}static make(t,e){e==null&&(e={});const n=e;if(t.meta!=null)for(const i in t.meta){const r=t.meta[i];n[i]=r}return new _i(t.inout,t.name,t.hint,t.type,n)}static id(t){return`_io_${++_i.index}_${t}`}static hint(t){return t=t.replace(/^_io_[0-9]+_/,""),t=t.replace(/_i_o$/,""),t=t.replace(/(In|Out|Inout|InOut)$/,"")}constructor(t,e,n,i,r,o){this.inout=t,this.name=e,this.hint=n,this.type=i,r==null&&(r={}),this.meta=r,this.id=o,this.hint==null&&(this.hint=_i.hint(this.name)),this.node=null,this.input=null,this.output=[],this.id==null&&(this.id=_i.id(this.hint))}morph(t){return this.inout=t.inout,this.name=t.name,this.hint=t.hint,this.type=t.type,this.meta=t.meta}dupe(t){t==null&&(t=this.id);const e=_i.make(this);return e.name=t,e}connect(t){if(this.inout===Yn.IN&&t.inout===Yn.OUT)return t.connect(this);if(this.inout!==Yn.OUT||t.inout!==Yn.IN)throw new Error("Can only connect out to in.");if(t.input!==this)return t.disconnect(),t.input=this,this.output.push(t)}disconnect(t){if(this.input&&this.input.disconnect(this),this.output.length)if(t){const e=this.output.indexOf(t);if(e>=0)return this.output.splice(e,1),t.input=null}else{for(t of Array.from(this.output))t.input=null;return this.output=[]}}}_i.initClass();let Py=class Tv{static initClass(){this.index=0}static id(t){return++Tv.index}constructor(t,e){this.owner=t,this.graph=null,this.inputs=[],this.outputs=[],this.all=[],this.outlets=null,this.id=Tv.id(),this.setOutlets(e)}getIn(t){return Array.from(this.inputs).filter(e=>e.name===t)[0]}getOut(t){return Array.from(this.outputs).filter(e=>e.name===t)[0]}get(t){return this.getIn(t)||this.getOut(t)}setOutlets(t){if(t!=null){let e;if(this.outlets==null){this.outlets={};for(e of Array.from(t))e instanceof _i||(e=_i.make(e)),this._add(e);return}const n=r=>[r.name,r.inout,r.type].join("-"),i={};for(e of Array.from(t))i[n(e)]=!0;for(let r in this.outlets)e=this.outlets[r],r=n(e),i[r]?i[r]=e:this._remove(e);for(e of Array.from(t)){const r=i[n(e)];r instanceof _i?this._morph(r,e):(e instanceof _i||(e=_i.make(e)),this._add(e))}}return this.outlets}connect(t,e,n){let i,r,o,a,l;const c={},h={},f=m=>l+"/"+m.hint;for(i of Array.from(t.inputs)){let m;!n&&i.input||({type:l}=i,o=f(i),h[o]||(h[o]=i),c[l]=m=c[l]||[],m.push(i))}let d=this.outputs;d=d.filter(m=>!(e&&m.output.length));for(a of Array.from(d.slice()))({type:l}=a),o=f(a),r=c[l],(i=h[o])&&(a.connect(i),delete h[o],r.splice(r.indexOf(i),1),d.splice(d.indexOf(a),1));if(!d.length)return this;for(a of Array.from(d.slice()))({type:l}=a),r=c[l],r&&r.length&&a.connect(r.shift());return this}disconnect(t){let e;for(e of Array.from(this.inputs))e.disconnect();for(e of Array.from(this.outputs))e.disconnect();return this}_key(t){return[t.name,t.inout].join("-")}_add(t){const e=this._key(t);if(t.node)throw new Error("Adding outlet to two nodes at once.");if(this.outlets[e])throw new Error(`Adding two identical outlets to same node. (${e})`);return t.node=this,t.inout===Yn.IN&&this.inputs.push(t),t.inout===Yn.OUT&&this.outputs.push(t),this.all.push(t),this.outlets[e]=t}_morph(t,e){let n=this._key(e);return delete this.outlets[n],t.morph(e),n=this._key(e),this.outlets[n]=e}_remove(t){const e=this._key(t);if(t.node!==this)throw new Error("Removing outlet from wrong node.");return t.disconnect(),t.node=null,delete this.outlets[e],t.inout===Yn.IN&&this.inputs.splice(this.inputs.indexOf(t),1),t.inout===Yn.OUT&&this.outputs.splice(this.outputs.indexOf(t),1),this.all.splice(this.all.indexOf(t),1),this}};Py.initClass();const{IN:hu,OUT:Ry}=Yn,n3t=Object.freeze(Object.defineProperty({__proto__:null,Graph:Yn,IN:hu,Node:Py,OUT:Ry,Outlet:_i},Symbol.toStringTag,{value:"Module"}));let Iu=class Dc{static initClass(){this.index=0}static namespace(){return`_sn_${++Dc.index}_`}static load(t,e,n){const i=t.parse(e,n),[r,o]=Array.from(t.compile(i));return new Dc(t,r,o,e,n)}constructor(t,e,n,i,r){this.language=t,this._signatures=e,this._compiler=n,this._name=i,this._original=r,this.namespace=null,this.code=null,this.main=null,this.entry=null,this.uniforms=null,this.externals=null,this.symbols=null,this.attributes=null,this.varyings=null,this.language||delete this.language,this._signatures||delete this._signatures,this._compiler||delete this._compiler,this._original||delete this._original,this._name||(this._name=this._signatures!=null?this._signatures.main.name:void 0)}clone(){return new Dc(this.language,this._signatures,this._compiler,this._name,this._original)}bind(t,e,n,i){let r,o,a;e===""+e?[n,e,i]=Array.from([e,n??{},i??{}]):n!==""+n&&([i,n]=Array.from([n??{},void 0])),this.main=this._signatures.main,this.namespace=(o=n??this.namespace)!=null?o:Dc.namespace(),this.entry=this.namespace+this.main.name,this.uniforms={},this.varyings={},this.attributes={},this.externals={},this.symbols=[];const l={},c={},h=function(A){return c[A]=!0,A},f=A=>this.namespace+A;if(t.globals)for(const A of Array.from(t.globals))h(A);const d=t.globalUniforms?h:f,m=t.globalVaryings?h:f,g=t.globalAttributes?h:f,y=f,_=A=>l[A.name]=!0,v=(A,T)=>this.uniforms[d(T??A.name)]=A;a=A=>this.varyings[m(A.name)]=A;const w=A=>this.attributes[g(A.name)]=A,b=A=>{const T=y(A.name);return this.externals[T]=A,this.symbols.push(T)},M=A=>({type:A.type,name:A.name,value:A.value});for(r of Array.from(this._signatures.uniform))_(r);for(r of Array.from(this._signatures.uniform))v(M(r));for(r of Array.from(this._signatures.varying))a(M(r));for(r of Array.from(this._signatures.external))b(r);for(r of Array.from(this._signatures.attribute))w(M(r));for(const A in e)r=e[A],l[A]&&v(r,A);if(this.body=this.code=this._compiler(this.namespace,c,i),i){const A=(()=>{const T=[];for(const P in i)a=i[P],T.push(`#define ${P} ${a}`);return T})().join(`
`);A.length&&(this._original=[A,"//----------------------------------------",this._original].join(`
`))}return null}};Iu.initClass();var Ns={};(function(s){s.make=function(t){return t==null&&(t=[]),t instanceof Array||(t=[+t!=null?+t:0]),t},s.nest=(t,e)=>t.concat(e),s.compare=function(t,e){const n=Math.min(t.length,e.length);for(let i=0,r=n,o=0<=r;o?i<r:i>r;o?i++:i--){const a=t[i],l=e[i];if(a>l)return-1;if(a<l)return 1}return t=t.length,e=e.length,t>e?-1:t<e?1:0},s.max=function(t,e){return s.compare(t,e)>0?e:t}})(Ns);const WC=function(s,t,e,n){const i=s,r={},o=[],a={},l={},c={},h={},f=function(){let w,b;for(b in n){const C=n[b];y(C.node,C.module)}[w,e]=Array.from(d(e)),t!=null&&(w.entry=t);const M=i.build(w,e),T=(()=>{const C=[];for(b in h){const S=h[b];C.push(S)}return C})().sort((C,S)=>Ns.compare(C.priority,S.priority)).map(C=>C.code);T.push(M.code);const P=i.lines(T);return{namespace:M.name,library:h,body:M.code,code:P,main:M,entry:M.name,symbols:o,externals:r,uniforms:a,varyings:l,attributes:c}},d=w=>{let b;w=(()=>{const T=[];for(const P in w)b=w[P],T.push(b);return T})(),w.sort((T,P)=>P.priority-T.priority);const M=(T,P,C)=>{g(T,P,C);const{main:S}=P,{entry:L}=P,H=B=>v(T,B),$=B=>_(T,B);return i.call(H,$,L,S.signature,A)},A=i.body();for(b of Array.from(w))M(b.node,b.module,b.priority);return[A,w]},m=function(w,b,M){const A=h[w];return A!=null?A.priority=Ns.max(A.priority,M):h[w]={code:b,priority:M}},g=function(w,b,M){let A,T;M=Ns.make(M);for(const P in b.library){const C=b.library[P];m(P,C.code,Ns.nest(M,C.priority))}m(b.namespace,b.body,M);for(T in b.uniforms)A=b.uniforms[T],a[T]=A;for(T in b.varyings)A=b.varyings[T],l[T]=A;for(T in b.attributes)A=b.attributes[T],c[T]=A;return y(w,b)},y=(w,b)=>(()=>{const M=[];for(const A of Array.from(b.symbols)){const T=b.externals[A];if(_(w,T.name)){const P={};for(const C in T){const S=T[C];P[C]=S}P.name=v(w,T.name),r[A]=P,M.push(o.push(A))}else M.push(void 0)}return M})(),_=function(w,b){const M=w.get(b);if(M.inout===hu)return M.input===null;if(M.inout===Ry)return M.output.length===0},v=function(w,b){let M=w.get(b);return M?(M.input&&(M=M.input),{name:b}=M,M.id):null};return f()};class eo{static initClass(){this.index=0}static entry(){return`_pg_${++eo.index}_`}constructor(t,e,n){this.language=t,this.namespace=e,this.graph=n,this.calls={},this.requires={}}call(t,e,n){let i;const r=e.namespace;return(i=this.calls[r])?i.priority=Math.max(i.priority,n):this.calls[r]={node:t,module:e,priority:n},this}require(t,e){const n=e.namespace;return this.requires[n]={node:t,module:e}}assemble(){const t=WC(this.language,this.namespace!=null?this.namespace:eo.entry,this.calls,this.requires),e=new Iu;for(const n in t)e[n]=t[n];return e.graph=this.graph,e}}eo.initClass();const $C=function(s,t,e,n){const i=s;let r=[];const o=[],a={},l={},c={},h={},f={},d=function(){const _=i.links(t),v=[];_.defs!=null&&v.push(_.defs),_.bodies!=null&&v.push(_.bodies);for(const A of Array.from(e))g(A.node,A.module,A.priority);r=(()=>{const A=[];for(const T in f){const P=f[T];A.push(P)}return A})().sort((A,T)=>Ns.compare(A.priority,T.priority)).map(A=>A.code);let b=i.lines(r);b=i.defuse(b),v.length&&(b=[i.lines(v),b].join(`
`)),b=i.hoist(b),b=i.dedupe(b);const M=n;return{namespace:M.main.name,code:b,main:M.main,entry:M.main.name,externals:a,uniforms:l,attributes:c,varyings:h}},m=function(_,v,w){const b=f[_];return b!=null?b.priority=Ns.max(b.priority,w):f[_]={code:v,priority:w}},g=function(_,v,w){let b,M;w=Ns.make(w);for(const A in v.library){const T=v.library[A];m(A,T.code,Ns.nest(w,T.priority))}m(v.namespace,v.body,w);for(M in v.uniforms)b=v.uniforms[M],l[M]=b;for(M in v.varyings)b=v.varyings[M],h[M]=b;for(M in v.attributes)b=v.attributes[M],c[M]=b;return(()=>{const A=[];for(M of Array.from(v.symbols)){const T=v.externals[M];y(_,T.name)?(a[M]=T,A.push(o.push(M))):A.push(void 0)}return A})()},y=function(_,v){const w=_.get(v);if(!w){const b=(_.owner.snippet!=null?_.owner.snippet._name:void 0)!=null?_.owner.snippet!=null?_.owner.snippet._name:void 0:_.owner.namespace;throw new Error(`Unable to link program. Unlinked callback \`${v}\` on \`${b}\``)}if(w.inout===hu)return w.input===null;if(w.inout===Ry)return w.output.length===0};return d()};class XC{constructor(t,e){this.language=t,this.graph=e,this.links=[],this.includes=[],this.modules={},this.visits={}}callback(t,e,n,i,r){return this.links.push({node:t,module:e,priority:n,name:i,external:r})}include(t,e,n){let i;return(i=this.modules[e.namespace])!=null?i.priority=Math.max(n,i.priority):(this.modules[e.namespace]=!0,this.includes.push({node:t,module:e,priority:n}))}visit(t){return this.visits[t]?!1:this.visits[t]=!0}link(t){const e=$C(this.language,this.links,this.includes,t),n=new Iu;for(const i in e)n[i]=e[i];return n.graph=this.graph,n}}const{load:i3t}=Iu,jC=Az({__proto__:null,Layout:XC,Program:eo,Snippet:Iu,assemble:WC,link:$C,load:i3t},[Ns]);class Fs{static previous(t){return t.input!=null?t.input.node.owner:void 0}constructor(t){t==null&&(t=!1),t||this.construct()}construct(){let t;return this.namespace==null&&(this.namespace=eo.entry()),this.node=new Py(this,(t=typeof this.makeOutlets=="function"?this.makeOutlets():void 0)!=null?t:{})}refresh(){let t;return this.node.setOutlets((t=typeof this.makeOutlets=="function"?this.makeOutlets():void 0)!=null?t:{})}clone(){return new Fs}compile(t,e){const n=new eo(t,e??eo.entry(),this.node.graph);return this.call(n,0),n.assemble()}link(t,e){const n=this.compile(t,e),i=new XC(t,this.node.graph);return this._include(n,i,0),this.export(i,0),i.link(n)}call(t,e){}callback(t,e,n,i,r){}export(t,e){}_info(t){let e=(this.node.owner.snippet!=null?this.node.owner.snippet._name:void 0)!=null?this.node.owner.snippet!=null?this.node.owner.snippet._name:void 0:this.node.owner.namespace;if(t!=null)return e+="."+t}_outlet(t,e){const n=_i.make(t,e);return n.meta.def=t,n}_call(t,e,n){return e.call(this.node,t,n)}_require(t,e){return e.require(this.node,t)}_inputs(t,e,n){return(()=>{const i=[];for(const r of Array.from(t.main.signature)){const o=this.node.get(r.name);i.push(tM(Fs.previous(o),a=>a.call(e,n+1)))}return i})()}_callback(t,e,n,i,r,o){return e.callback(this.node,t,n,i,r,o)}_include(t,e,n){return e.include(this.node,t,n)}_link(t,e,n){return(()=>{const i=[];for(const r of Array.from(t.symbols)){const o=t.externals[r];let a=this.node.get(o.name);if(!a)throw new Cv(`External not found on ${this._info(o.name)}`);if(a.meta.child!=null)continue;let l=a,c;for(;!c&&l;)[l,a]=Array.from([a.meta.parent,l]);if(c=Fs.previous(a),!c)throw new Cv(`Missing connection on ${this._info(o.name)}`);c.callback(e,n+1,r,o,a.input),i.push(c!=null?c.export(e,n+1):void 0)}return i})()}_trace(t,e,n){return(()=>{const i=[];for(const r of Array.from(t.main.signature)){const o=this.node.get(r.name);i.push(tM(Fs.previous(o),a=>a.export(e,n+1)))}return i})()}}const Cv=function(s){const t=new Error(s);return t.name="OutletError",t};Cv.prototype=new Error;function tM(s,t){return typeof s<"u"&&s!==null?t(s):void 0}class up extends Fs{constructor(t){super(!0),this.snippet=t,this.namespace=t.namespace,this.construct()}clone(){return new up(this.snippet)}makeOutlets(){const t=this.snippet.main.signature,{externals:e}=this.snippet,{symbols:n}=this.snippet,i=Array.from(t).map(o=>this._outlet(o,{callback:!1})),r=Array.from(n).map(o=>this._outlet(e[o],{callback:!0}));return i.concat(r)}call(t,e){return this._call(this.snippet,t,e),this._inputs(this.snippet,t,e)}export(t,e){if(t.visit(this.namespace,e))return this._link(this.snippet,t,e),this._trace(this.snippet,t,e)}}class fu extends Fs{constructor(t){super(!0),this.graph=t,this.construct()}refresh(){return super.refresh(),delete this.subroutine}clone(){return new fu(this.graph)}makeOutlets(){let t;this.make();const e=[];let n=[],i=[];const r=(a,l)=>{if(a.meta.callback){if(a.inout===Yn.IN){const c=a.dupe();return c.meta.child==null&&(c.meta.child=a),a.meta.parent=c,e.push(c)}}else return l.push(a.type)};for(t of Array.from(this.graph.inputs()))r(t,n);for(t of Array.from(this.graph.outputs()))r(t,i);n=n.join(","),i=i.join(",");const o=`(${n})(${i})`;return e.push({name:"callback",type:o,inout:Yn.OUT,meta:{callback:!0,def:this.subroutine.main}}),e}make(){return this.subroutine=this.graph.compile(this.namespace)}export(t,e){if(t.visit(this.namespace,e))return this._link(this.subroutine,t,e),this.graph.export(t,e)}call(t,e){return this._require(this.subroutine,t,e)}callback(t,e,n,i,r){return this._include(this.subroutine,t,e),this._callback(this.subroutine,t,e,n,i,r)}}class du extends Fs{constructor(t){super(!0),this.graph=t,this.construct()}refresh(){return super.refresh(),delete this.subroutine}clone(){return new du(this.graph)}makeOutlets(){this.make();const t=[],e={},n={};for(const i of["inputs","outputs"])for(const r of Array.from(this.graph[i]())){let o;["return","callback"].includes(r.hint)&&r.inout===Yn.OUT&&(o=r.hint),e[o]!=null&&(o=void 0);const a=r.dupe(o);a.meta.child==null&&(a.meta.child=r),r.meta.parent=a,o!=null&&(e[o]=!0),n[r.name]=a,t.push(a)}return t}make(){return this.subroutine=this.graph.compile(this.namespace)}call(t,e){return this._call(this.subroutine,t,e),this._inputs(this.subroutine,t,e)}export(t,e){if(t.visit(this.namespace,e))return this._link(this.subroutine,t,e),this._trace(this.subroutine,t,e),this.graph.export(t,e)}callback(t,e,n,i,r){return r=r.meta.child,r.node.owner.callback(t,e,n,i,r)}}class hp extends Fs{constructor(t){super(!0),this.nodes=t,this.construct()}clone(){return new hp(this.nodes)}makeOutlets(){return[]}call(t,e){return(()=>{const n=[];for(const i of Array.from(this.nodes)){const r=i.owner;n.push(r.call(t,e))}return n})()}export(t,e){return(()=>{const n=[];for(const i of Array.from(this.nodes)){const r=i.owner;n.push(r.export(t,e))}return n})()}}const Of=function(s){const t=[],e=[];for(const n of Array.from(s.nodes)){let i;const r={id:n.id,name:null,type:null,depth:null,graph:null,inputs:[],outputs:[]};t.push(r);const{inputs:o}=r,{outputs:a}=r,l=n.owner;l instanceof up?(r.name=l.snippet._name,r.type="call",r.code=l.snippet._original):l instanceof fu?(r.name="Callback",r.type="callback",r.graph=Of(l.graph)):l instanceof du?(r.name="Isolate",r.type="isolate",r.graph=Of(l.graph)):l instanceof hp?(r.name="Join",r.type="join"):l!=null&&(r.name==null&&(r.name=l.name!=null?l.name:l.type),r.type==null&&(r.type=l.type),r.code==null&&(r.code=l.code),l.graph!=null&&(r.graph=Of(l.graph)));const c=function(h){return h=h.replace(")(",")→("),h=h.replace("()","")};for(i of Array.from(n.inputs))o.push({id:i.id,name:i.name,type:c(i.type),open:i.input==null});for(i of Array.from(n.outputs)){a.push({id:i.id,name:i.name,type:c(i.type),open:!i.output.length});for(const h of Array.from(i.output))e.push({from:n.id,out:i.id,to:h.node.id,in:h.id,type:c(i.type)})}}return{nodes:t,links:e}},s3t=3432918353,r3t=461845907,o3t=3864292196,a3t=2246822507,l3t=3266489909;let sl=function(s,t){const e=s>>>16&65535,n=s&65535,i=t>>>16&65535,r=t&65535;return n*r+(e*r+n*i<<16>>>0)|0};Math.imul!=null&&Math.imul(4294967295,5)===-5&&({imul:sl}=Math);const Ly=function(s){let t;const e=s.length;let n=Math.floor(e/2),i=t=0;const r=()=>s.charCodeAt(i++),o=function(a,l){let c=a|l<<16;return c^=c<<9,c=sl(c,s3t),c=c<<15|c>>>17,c=sl(c,r3t),t^=c,t=t<<13|t>>>19,t=sl(t,5),t=t+o3t|0};for(;n--;)o(r(),r());return e&1&&o(r(),0),t^=e,t^=t>>>16,t=sl(t,a3t),t^=t>>>13,t=sl(t,l3t),t^=t>>>16},c3t=s=>(""+s).replace(/^\s+|\s+$/g,""),u3t=(s,t,e,n)=>"rgba("+[s,t,e,n].join(", ")+")",eM=function(s,t){t==null&&(t=1);const e=Ly(s)^1193046;let n=e&255,i=e>>>8&255,r=e>>>16&255;const o=Math.max(n,i,r),a=140/o,l=Math.round(o/3);return n=Math.min(255,Math.round(a*Math.max(n,l))),i=Math.min(255,Math.round(a*Math.max(i,l))),r=Math.min(255,Math.round(a*Math.max(r,l))),u3t(n,i,r,t)},vf=function(s){return s=s??"",s.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/'/g,"&#39;").replace(/"/g,"&quot;")},h3t=function(s){const t=[],e=YC(s,t);return e.update=()=>m3t(e,t),f3t(e),e},f3t=function(s){const t=s.querySelectorAll(".shadergraph-code");return Array.from(t).map(e=>function(){const n=e;return n.parentNode.classList.add("shadergraph-has-code"),n.parentNode.addEventListener("click",i=>n.style.display={block:"none",none:"block"}[n.style.display||"none"])}())},d3t=function(s){let t,e;const n={},i={};for(e of Array.from(s.nodes))n[e.id]=e;for(t of Array.from(s.links))i[t.from]==null&&(i[t.from]=[]),i[t.from].push(t);const r=function(o,a){let l;if(a==null&&(a=0),o.depth=Math.max(o.depth!=null?o.depth:0,a),l=i[o.id])for(t of Array.from(l))r(n[t.to],a+1);return null};for(e of Array.from(s.nodes))e.depth==null&&r(e);return null},YC=function(s,t){let e;d3t(s);const n=document.createElement("div");n.classList.add("shadergraph-graph");const i=[],r={};for(const o of Array.from(s.nodes)){let a;const l=document.createElement("div");l.classList.add("shadergraph-node"),l.classList.add(`shadergraph-node-${o.type}`),l.innerHTML=`<div class="shadergraph-header">${vf(o.name)}</div>`;const c=function(h,f){const d=eM(h.type),m=document.createElement("div");return m.classList.add("shadergraph-outlet"),m.classList.add(`shadergraph-outlet-${f}`),m.innerHTML=`<div class="shadergraph-point" style="background: ${d}"></div>
<div class="shadergraph-type" style="color: ${d}">${vf(h.type)}</div>
<div class="shadergraph-name">${vf(h.name)}</div>`,l.appendChild(m),r[h.id]=m.querySelector(".shadergraph-point")};for(a of Array.from(o.inputs))c(a,"in");for(a of Array.from(o.outputs))c(a,"out");if(o.graph!=null)l.appendChild(YC(o.graph,t));else{const h=document.createElement("div");h.classList.add("shadergraph-clear"),l.appendChild(h)}if(o.code!=null){const h=document.createElement("div");h.classList.add("shadergraph-code"),h.innerHTML=vf(c3t(o.code)),l.appendChild(h)}e=i[o.depth],e==null&&(e=document.createElement("div"),e.classList.add("shadergraph-column"),i[o.depth]=e),e.appendChild(l)}for(e of Array.from(i))e!=null&&n.appendChild(e);for(const o of Array.from(s.links)){const a=eM(o.type);t.push({color:a,out:r[o.out],in:r[o.in]})}return n},nM=s=>s*s,p3t=function(s,t,e,n){let i;const r=e-s,o=n-t,a=Math.sqrt(nM(r)+nM(o));if(Math.abs(o)>Math.abs(r)){const c=(s+e)/2,h=(t+n)/2,f=o>0?.3:-.3;return i=Math.min(Math.abs(r)/2,20+a/8),["M",s,t,"C",s+i,t+",",c,h-a*f,c,h,"C",c,h+a*f,e-i,n+",",e,n].join(" ")}else return i=Math.min(Math.abs(r)/2.5,20+a/4),["M",s,t,"C",s+i,t+",",e-i,n+",",e,n].join(" ")},iM=function(s){return s==null&&(s="svg"),document.createElementNS("http://www.w3.org/2000/svg",s)},m3t=function(s,t){let e;if(s.parentNode==null)return;const n=s.getBoundingClientRect();for(e of Array.from(t)){const o=e.out.getBoundingClientRect(),a=e.in.getBoundingClientRect();e.coords={x1:(o.left+o.right)/2-n.left,y1:(o.top+o.bottom)/2-n.top,x2:(a.left+a.right)/2-n.left,y2:(a.top+a.bottom)/2-n.top}}let i=s.querySelector("svg");i!=null&&s.removeChild(i);let r=s;for(;r.parentNode&&r.offsetHeight===0;)r=r.parentNode;i=iM(),i.setAttribute("width",r.offsetWidth),i.setAttribute("height",r.offsetHeight);for(e of Array.from(t)){const o=e.coords,a=iM("path");a.setAttribute("d",p3t(o.x1,o.y1,o.x2,o.y2)),a.setAttribute("stroke",e.color),a.setAttribute("stroke-width",3),a.setAttribute("fill","transparent"),i.appendChild(a)}return s.appendChild(i)},g3t=function(s){const t=document.createElement("div");t.setAttribute("class","shadergraph-overlay");const e=document.createElement("div");e.setAttribute("class","shadergraph-close"),e.innerHTML="&times;";const n=document.createElement("div");n.setAttribute("class","shadergraph-view");const i=document.createElement("div");return i.setAttribute("class","shadergraph-inside"),i.appendChild(s),n.appendChild(i),t.appendChild(n),t.appendChild(e),e.addEventListener("click",()=>t.parentNode.removeChild(t)),t},sM=function(s){if(s instanceof Node)return s;const t=document.createElement("span");return t.innerText=s??"",t},v3t=function(s){if(s.length!==1){let t;const e=document.createElement("div");for(t of Array.from(s))e.appendChild(sM(t));return e.update=()=>(()=>{const n=[];for(t of Array.from(s))n.push(typeof t.update=="function"?t.update():void 0);return n})(),e}else return sM(s[0])},_3t=Object.freeze(Object.defineProperty({__proto__:null,merge:v3t,overlay:g3t,process:h3t},Symbol.toStringTag,{value:"Module"})),Dy=Of,fp=_3t,y3t=function(s){if(!s)return;if(!s.nodes)return s;const t=Dy(s);return fp.process(t)},zf=function(s){return s==null?s:s instanceof Array?s.map(zf):s.vertex!=null&&s.fragment!=null?[zf(s.vertex,zf(s.fragment))]:s._graph!=null?s._graph:s.graph!=null?s.graph:s},ZC=function(s){let t=[];for(const e of Array.from(s))e instanceof Array?t=t.concat(ZC(e)):e!=null&&t.push(e);return t},KC=function(){const s=ZC(zf([].slice.call(arguments)));return fp.merge(Array.from(s).filter(t=>t).map(t=>y3t(t)))},Xr=function(){const s=KC.apply(null,arguments),t=fp.overlay(s);for(const e of Array.from(document.querySelectorAll(".shadergraph-overlay")))e.remove();return document.body.appendChild(t),s.update(),t},JC=Object.freeze(Object.defineProperty({__proto__:null,inspect:Xr,markup:fp,serialize:Dy,visualize:KC},Symbol.toStringTag,{value:"Module"}));let QC=class Pv{constructor(t,e,n){this.language=t,this.fetch=e,this.config=n,this.graph()}pipe(t,e,n,i){return t instanceof Pv?this._concat(t):t!=null&&this._call(t,e,n,i),this}call(t,e,n,i){return this.pipe(t,e,n,i)}require(t,e,n,i){return t instanceof Pv?this._import(t):t!=null&&(this.callback(),this._call(t,e,n,i),this.end()),this}import(t,e,n,i){return this.require(t,e,n,i)}split(){return this._group("_combine",!0),this}fan(){return this._group("_combine",!1),this}isolate(){return this._group("_isolate"),this}callback(){return this._group("_callback"),this}next(){return this._next(),this}pass(){const t=this._stack[2].end;return this.end(),this._state.end=this._state.end.concat(t),this}end(){const[t,e]=Array.from(this._exit()),{op:n}=t;return this[n]&&this[n](t,e),this}join(){return this.end()}graph(){for(;(this._stack!=null?this._stack.length:void 0)>1;)this.end();this._graph&&this._tail(this._state,this._graph);const t=this._graph;return this._graph=new Yn,this._state=new _f,this._stack=[this._state],t}compile(t){return t==null&&(t="main"),this.graph().compile(t)}link(t){return t==null&&(t="main"),this.graph().link(t)}serialize(){return Dy(this._graph)}empty(){return this._graph.nodes.length===0}_concat(t){let e;if(t._state.nodes.length===0)return this;this._tail(t._state,t._graph);try{e=new du(t._graph)}catch(n){throw this.config.autoInspect&&Xr(n,this._graph,t),n}return this._auto(e),this}_import(t){let e;if(t._state.nodes.length===0)throw"Can't import empty callback";this._tail(t._state,t._graph);try{e=new fu(t._graph)}catch(n){throw this.config.autoInspect&&Xr(n,this._graph,t),n}return this._auto(e),this}_combine(t,e){for(const n of Array.from(t.start))for(const i of Array.from(e.end))i.connect(n,t.multi);return e.end=t.end,e.nodes=e.nodes.concat(t.nodes)}_isolate(t,e){if(t.nodes.length){let n;const i=this._subgraph(t);this._tail(t,i);try{n=new du(i)}catch(r){throw this.config.autoInspect&&Xr(r,this._graph,i),r}return this._auto(n)}}_callback(t,e){if(t.nodes.length){let n;const i=this._subgraph(t);this._tail(t,i);try{n=new fu(i)}catch(r){throw this.config.autoInspect&&Xr(r,this._graph,i),r}return this._auto(n)}}_call(t,e,n,i){const r=this.fetch(t);r.bind(this.config,e,n,i);const o=new up(r);return this._auto(o)}_subgraph(t){const e=new Yn(null,this._graph);return e.adopt(t.nodes),e}_tail(t,e){let n=t.end.concat(t.tail);if(n=n.filter((i,r)=>n.indexOf(i)===r),n.length>1&&(n=new hp(n),n=[n.node],this._graph.add(n)),e.tail=n[0],t.end=n,t.tail=[],!e.tail)throw new Error("Cannot finalize empty graph");return e.compile=i=>{i==null&&(i="main");try{return e.tail.owner.compile(this.language,i)}catch(r){throw this.config.autoInspect&&e.inspect(r),r}},e.link=i=>{i==null&&(i="main");try{return e.tail.owner.link(this.language,i)}catch(r){throw this.config.autoInspect&&e.inspect(r),r}},e.export=(i,r)=>e.tail.owner.export(i,r),e.inspect=(i=null)=>Xr(i,e)}_group(t,e){return this._push(t,e),this._push(),this}_next(){const t=this._pop();return this._state.start=this._state.start.concat(t.start),this._state.end=this._state.end.concat(t.end),this._state.nodes=this._state.nodes.concat(t.nodes),this._state.tail=this._state.tail.concat(t.tail),this._push()}_exit(){return this._next(),this._pop(),[this._pop(),this._state]}_push(t,e){return this._stack.unshift(new _f(t,e)),this._state=this._stack[0]}_pop(){let t;return this._state=this._stack[1],this._state==null&&(this._state=new _f),(t=this._stack.shift())!=null?t:new _f}_auto(t){return t.node.inputs.length?this._append(t):this._insert(t)}_append(t){let e;const{node:n}=t;this._graph.add(n);for(e of Array.from(this._state.end))e.connect(n);this._state.start.length||(this._state.start=[n]),this._state.end=[n],this._state.nodes.push(n),n.outputs.length||this._state.tail.push(n)}_prepend(t){let e;const{node:n}=t;this._graph.add(n);for(e of Array.from(this._state.start))n.connect(e);this._state.end.length||(this._state.end=[n]),this._state.start=[n],this._state.nodes.push(n),n.outputs.length||this._state.tail.push(n)}_insert(t){const{node:e}=t;if(this._graph.add(e),this._state.start.push(e),this._state.end.push(e),this._state.nodes.push(e),!e.outputs.length)return this._state.tail.push(e)}};class _f{constructor(t=null,e,n,i,r,o){this.op=t,e==null&&(e=!1),this.multi=e,n==null&&(n=[]),this.start=n,i==null&&(i=[]),this.end=i,r==null&&(r=[]),this.nodes=r,o==null&&(o=[]),this.tail=o}}class t2{constructor(t,e){this.vertex=t,this.fragment=e}build(t){return this.link(t)}link(t){t==null&&(t={});const e={},n={},i={},r=this.vertex.link("main"),o=this.fragment.link("main");for(const a of[r,o]){for(const l in a.uniforms){const c=a.uniforms[l];e[l]=c}for(const l in a.varyings){const c=a.varyings[l];n[l]=c}for(const l in a.attributes){const c=a.attributes[l];i[l]=c}}return t.vertexShader=r.code,t.vertexGraph=r.graph,t.fragmentShader=o.code,t.fragmentGraph=o.graph,t.attributes=i,t.uniforms=e,t.varyings=n,t.inspect=()=>Xr("Vertex Shader",r,"Fragment Shader",o.graph),t}inspect(){return Xr("Vertex Shader",this.vertex,"Fragment Shader",this.fragment.graph)}}const x3t=function(s,t,e){let n=null,i={};t!=null&&(typeof t=="function"?n=a=>e(s,a,t(a)):typeof t=="object"&&(n=function(a){if(t[a]==null)throw new Error(`Unknown snippet \`${a}\``);return e(s,a,t[a])}));const r=a=>e(s,"",a);if(n==null)return r;const o=function(a){return a.match(/[{;]/)?r(a):(i[a]=!0,n(a))};return o.used=function(a){return a==null&&(a=i),i=a},o},e2=function(s){s==null&&(s=100);const t={};let e=null,n=null,i=0;const r=function(a){if(a.prev=null,a.next=e,e!=null&&(e.prev=a),e=a,n==null)return n=a},o=function(a){const{prev:l}=a,{next:c}=a;if(l!=null&&(l.next=c),c!=null&&(c.prev=l),e===a&&(e=c),n===a)return n=l};return function(a){let l,c;return(c=t[a])&&c!==e?(o(c),r(c)):(i===s?(l=n.key,o(n),delete t[l]):i++,c={next:e,prev:null,key:a},r(c),t[a]=c),l}},b3t=function(s){const t={},e=e2(100);return function(n){const i=n.length>32?"##"+Ly(n).toString(16):n,r=e(i);return r!=null&&delete t[r],t[i]==null&&(t[i]=s(n)),t[i].clone()}},n2=Object.freeze(Object.defineProperty({__proto__:null,Factory:QC,Material:t2,cache:b3t,hash:Ly,library:x3t,queue:e2},Symbol.toStringTag,{value:"Module"})),w3t=function(s){const{code:t,signatures:e}=s,n=M3t(e),i=S3t(t,n);return[e,i]},M3t=function(s){const t={},e=n=>t[n.name]=!0;e(s.main);for(const n of["external","internal","varying","uniform","attribute"])for(const i of s[n])e(i);return t},S3t=function(s,t){let e;const n=new RegExp("\\b("+(()=>{const i=[];for(e in t)i.push(e);return i})().join("|")+")\\b","g");return s=s.replace(/\/\/[^\n]*/g,""),s=s.replace(/\/\*([^*]|\*[^/])*\*\//g,""),function(i,r,o){let a;i==null&&(i=""),r==null&&(r={}),o==null&&(o={});const l={};for(a in t)l[a]=r[a]!=null?a:i+a;const c=s.replace(n,f=>l[f]),h=(()=>{const f=[];for(a in o){const d=o[a];f.push(`#define ${a} ${d}`)}return f})();return h.length&&h.push(""),h.join(`
`)+c}};var i2=["precision","highp","mediump","lowp","attribute","const","uniform","varying","break","continue","do","for","while","if","else","in","out","inout","float","int","uint","void","bool","true","false","discard","return","mat2","mat3","mat4","vec2","vec3","vec4","ivec2","ivec3","ivec4","bvec2","bvec3","bvec4","sampler1D","sampler2D","sampler3D","samplerCube","sampler1DShadow","sampler2DShadow","struct","asm","class","union","enum","typedef","template","this","packed","goto","switch","default","inline","noinline","volatile","public","static","extern","external","interface","long","short","double","half","fixed","unsigned","input","output","hvec2","hvec3","hvec4","dvec2","dvec3","dvec4","fvec2","fvec3","fvec4","sampler2DRect","sampler3DRect","sampler2DRectShadow","sizeof","cast","namespace","using"],A3t=["<<=",">>=","++","--","<<",">>","<=",">=","==","!=","&&","||","+=","-=","*=","/=","%=","&=","^^","^=","|=","(",")","[","]",".","!","~","*","/","%","+","-","<",">","&","^","|","?",":","=",",",";","{","}"],s2=["abs","acos","all","any","asin","atan","ceil","clamp","cos","cross","dFdx","dFdy","degrees","distance","dot","equal","exp","exp2","faceforward","floor","fract","gl_BackColor","gl_BackLightModelProduct","gl_BackLightProduct","gl_BackMaterial","gl_BackSecondaryColor","gl_ClipPlane","gl_ClipVertex","gl_Color","gl_DepthRange","gl_DepthRangeParameters","gl_EyePlaneQ","gl_EyePlaneR","gl_EyePlaneS","gl_EyePlaneT","gl_Fog","gl_FogCoord","gl_FogFragCoord","gl_FogParameters","gl_FragColor","gl_FragCoord","gl_FragData","gl_FragDepth","gl_FragDepthEXT","gl_FrontColor","gl_FrontFacing","gl_FrontLightModelProduct","gl_FrontLightProduct","gl_FrontMaterial","gl_FrontSecondaryColor","gl_LightModel","gl_LightModelParameters","gl_LightModelProducts","gl_LightProducts","gl_LightSource","gl_LightSourceParameters","gl_MaterialParameters","gl_MaxClipPlanes","gl_MaxCombinedTextureImageUnits","gl_MaxDrawBuffers","gl_MaxFragmentUniformComponents","gl_MaxLights","gl_MaxTextureCoords","gl_MaxTextureImageUnits","gl_MaxTextureUnits","gl_MaxVaryingFloats","gl_MaxVertexAttribs","gl_MaxVertexTextureImageUnits","gl_MaxVertexUniformComponents","gl_ModelViewMatrix","gl_ModelViewMatrixInverse","gl_ModelViewMatrixInverseTranspose","gl_ModelViewMatrixTranspose","gl_ModelViewProjectionMatrix","gl_ModelViewProjectionMatrixInverse","gl_ModelViewProjectionMatrixInverseTranspose","gl_ModelViewProjectionMatrixTranspose","gl_MultiTexCoord0","gl_MultiTexCoord1","gl_MultiTexCoord2","gl_MultiTexCoord3","gl_MultiTexCoord4","gl_MultiTexCoord5","gl_MultiTexCoord6","gl_MultiTexCoord7","gl_Normal","gl_NormalMatrix","gl_NormalScale","gl_ObjectPlaneQ","gl_ObjectPlaneR","gl_ObjectPlaneS","gl_ObjectPlaneT","gl_Point","gl_PointCoord","gl_PointParameters","gl_PointSize","gl_Position","gl_ProjectionMatrix","gl_ProjectionMatrixInverse","gl_ProjectionMatrixInverseTranspose","gl_ProjectionMatrixTranspose","gl_SecondaryColor","gl_TexCoord","gl_TextureEnvColor","gl_TextureMatrix","gl_TextureMatrixInverse","gl_TextureMatrixInverseTranspose","gl_TextureMatrixTranspose","gl_Vertex","greaterThan","greaterThanEqual","inversesqrt","length","lessThan","lessThanEqual","log","log2","matrixCompMult","max","min","mix","mod","normalize","not","notEqual","pow","radians","reflect","refract","sign","sin","smoothstep","sqrt","step","tan","texture2D","texture2DLod","texture2DProj","texture2DProjLod","textureCube","textureCubeLod","texture2DLodEXT","texture2DProjLodEXT","textureCubeLodEXT","texture2DGradEXT","texture2DProjGradEXT","textureCubeGradEXT"],E3t=i2,T3t=E3t.slice().concat(["layout","centroid","smooth","case","mat2x2","mat2x3","mat2x4","mat3x2","mat3x3","mat3x4","mat4x2","mat4x3","mat4x4","uvec2","uvec3","uvec4","samplerCubeShadow","sampler2DArray","sampler2DArrayShadow","isampler2D","isampler3D","isamplerCube","isampler2DArray","usampler2D","usampler3D","usamplerCube","usampler2DArray","coherent","restrict","readonly","writeonly","resource","atomic_uint","noperspective","patch","sample","subroutine","common","partition","active","filter","image1D","image2D","image3D","imageCube","iimage1D","iimage2D","iimage3D","iimageCube","uimage1D","uimage2D","uimage3D","uimageCube","image1DArray","image2DArray","iimage1DArray","iimage2DArray","uimage1DArray","uimage2DArray","image1DShadow","image2DShadow","image1DArrayShadow","image2DArrayShadow","imageBuffer","iimageBuffer","uimageBuffer","sampler1DArray","sampler1DArrayShadow","isampler1D","isampler1DArray","usampler1D","usampler1DArray","isampler2DRect","usampler2DRect","samplerBuffer","isamplerBuffer","usamplerBuffer","sampler2DMS","isampler2DMS","usampler2DMS","sampler2DMSArray","isampler2DMSArray","usampler2DMSArray"]),Rv=s2;Rv=Rv.slice().filter(function(s){return!/^(gl\_|texture)/.test(s)});var C3t=Rv.concat(["gl_VertexID","gl_InstanceID","gl_Position","gl_PointSize","gl_FragCoord","gl_FrontFacing","gl_FragDepth","gl_PointCoord","gl_MaxVertexAttribs","gl_MaxVertexUniformVectors","gl_MaxVertexOutputVectors","gl_MaxFragmentInputVectors","gl_MaxVertexTextureImageUnits","gl_MaxCombinedTextureImageUnits","gl_MaxTextureImageUnits","gl_MaxFragmentUniformVectors","gl_MaxDrawBuffers","gl_MinProgramTexelOffset","gl_MaxProgramTexelOffset","gl_DepthRangeParameters","gl_DepthRange","trunc","round","roundEven","isnan","isinf","floatBitsToInt","floatBitsToUint","intBitsToFloat","uintBitsToFloat","packSnorm2x16","unpackSnorm2x16","packUnorm2x16","unpackUnorm2x16","packHalf2x16","unpackHalf2x16","outerProduct","transpose","determinant","inverse","texture","textureSize","textureProj","textureLod","textureOffset","texelFetch","texelFetchOffset","textureProjOffset","textureLodOffset","textureProjLod","textureProjLodOffset","textureGrad","textureGradOffset","textureProjGrad","textureProjGradOffset"]),P3t=F3t,R3t=i2,rM=A3t,L3t=s2,D3t=T3t,I3t=C3t,xs=999,oM=9999,gg=0,vg=1,aM=2,lM=3,cM=4,Ec=5,O3t=6,z3t=7,k3t=8,uM=9,U3t=10,hM=11,N3t=["block-comment","line-comment","preprocessor","operator","integer","float","ident","builtin","keyword","whitespace","eof","integer"];function F3t(s){var t=0,e=0,n=xs,i,r,o=[],a=[],l=1,c=0,h=0,f=!1,d=!1,m="",g;s=s||{};var y=L3t,_=R3t;s.version==="300 es"&&(y=I3t,_=D3t);for(var v={},w={},t=0;t<y.length;t++)v[y[t]]=!0;for(var t=0;t<_.length;t++)w[_[t]]=!0;return function(Y){return a=[],Y!==null?M(Y):A()};function b(Y){Y.length&&a.push({type:N3t[n],data:Y,position:h,line:l,column:c})}function M(Y){t=0,Y.toString&&(Y=Y.toString()),m+=Y.replace(/\r\n/g,`
`),g=m.length;for(var J;i=m[t],t<g;){switch(J=t,n){case gg:t=L();break;case vg:t=S();break;case aM:t=C();break;case lM:t=H();break;case cM:t=G();break;case hM:t=B();break;case Ec:t=I();break;case oM:t=et();break;case uM:t=P();break;case xs:t=T();break}if(J!==t)switch(m[J]){case`
`:c=0,++l;break;default:++c;break}}return e+=t,m=m.slice(t),a}function A(Y){return o.length&&b(o.join("")),n=U3t,b("(eof)"),a}function T(){return o=o.length?[]:o,r==="/"&&i==="*"?(h=e+t-1,n=gg,r=i,t+1):r==="/"&&i==="/"?(h=e+t-1,n=vg,r=i,t+1):i==="#"?(n=aM,h=e+t,t):/\s/.test(i)?(n=uM,h=e+t,t):(f=/\d/.test(i),d=/[^\w_]/.test(i),h=e+t,n=f?cM:d?lM:oM,t)}function P(){return/[^\s]/g.test(i)?(b(o.join("")),n=xs,t):(o.push(i),r=i,t+1)}function C(){return(i==="\r"||i===`
`)&&r!=="\\"?(b(o.join("")),n=xs,t):(o.push(i),r=i,t+1)}function S(){return C()}function L(){return i==="/"&&r==="*"?(o.push(i),b(o.join("")),n=xs,t+1):(o.push(i),r=i,t+1)}function H(){if(r==="."&&/\d/.test(i))return n=Ec,t;if(r==="/"&&i==="*")return n=gg,t;if(r==="/"&&i==="/")return n=vg,t;if(i==="."&&o.length){for(;$(o););return n=Ec,t}if(i===";"||i===")"||i==="("){if(o.length)for(;$(o););return b(i),n=xs,t+1}var Y=o.length===2&&i!=="=";if(/[\w_\d\s]/.test(i)||Y){for(;$(o););return n=xs,t}return o.push(i),r=i,t+1}function $(Y){var J=0,ut,dt;do{if(ut=rM.indexOf(Y.slice(0,Y.length+J).join("")),dt=rM[ut],ut===-1){if(J--+Y.length>0)continue;dt=Y.slice(0,1).join("")}return b(dt),h+=dt.length,o=o.slice(dt.length),o.length}while(1)}function B(){return/[^a-fA-F0-9]/.test(i)?(b(o.join("")),n=xs,t):(o.push(i),r=i,t+1)}function G(){return i==="."||/[eE]/.test(i)?(o.push(i),n=Ec,r=i,t+1):i==="x"&&o.length===1&&o[0]==="0"?(n=hM,o.push(i),r=i,t+1):/[^\d]/.test(i)?(b(o.join("")),n=xs,t):(o.push(i),r=i,t+1)}function I(){return i==="f"&&(o.push(i),r=i,t+=1),/[eE]/.test(i)||(i==="-"||i==="+")&&/[eE]/.test(r)?(o.push(i),r=i,t+1):/[^\d]/.test(i)?(b(o.join("")),n=xs,t):(o.push(i),r=i,t+1)}function et(){if(/[^\d\w_]/.test(i)){var Y=o.join("");return w[Y]?n=k3t:v[Y]?n=z3t:n=O3t,b(o.join("")),n=xs,t}return o.push(i),r=i,t+1}}var B3t=P3t,H3t=V3t;function V3t(s,t){var e=B3t(t),n=[];return n=n.concat(e(s)),n=n.concat(e(null)),n}const G3t=mu(H3t);let Ms,cs,Bc,Jf;const q3t={nud:function(){return this.children&&this.children.length?this:fM("unexpected")()},led:fM("missing operator")},Bo={};function Ou(){return this}ci("(ident)").nud=Ou;ci("(keyword)").nud=Ou;ci("(builtin)").nud=Ou;ci("(literal)").nud=Ou;ci("(end)");ci(":");ci(";");ci(",");ci(")");ci("]");ci("}");Iy("&&",30);Iy("||",30);Rn("|",43);Rn("^",44);Rn("&",45);Rn("==",46);Rn("!=",46);Rn("<",47);Rn("<=",47);Rn(">",47);Rn(">=",47);Rn(">>",48);Rn("<<",48);Rn("+",50);Rn("-",50);Rn("*",60);Rn("/",60);Rn("%",60);Rn("?",20,function(s){return this.children=[s,$s(0),(Er(":"),$s(0))],this.type="ternary",this});Rn(".",80,function(s){return cs.type="literal",Ms.fake(cs),this.children=[s,cs],Er(),this});Rn("[",80,function(s){return this.children=[s,$s(0)],this.type="binary",Er("]"),this});Rn("(",80,function(s){if(this.children=[s],this.type="call",cs.data!==")")for(;this.children.push($s(0)),cs.data===",";)Er(",");return Er(")"),this});fo("-");fo("+");fo("!");fo("~");fo("defined");fo("(",function(){return this.type="group",this.children=[$s(0)],Er(")"),this});fo("++");fo("--");r2("++");r2("--");Rs("=");Rs("+=");Rs("-=");Rs("*=");Rs("/=");Rs("%=");Rs("&=");Rs("|=");Rs("^=");Rs(">>=");Rs("<<=");var W3t=function(s,t){Ms=s,Bc=t,Jf=0;let e;if(!Bc.length)return;if(Er(),e=$s(0),e.parent=Ms[0],n(e),Jf<Bc.length)throw new Error("did not use all tokens");e.parent.children=[e];function n(i){Ms.unshift(i,!1);for(let r=0,o=i.children.length;r<o;++r)n(i.children[r]);Ms.shift()}};function ci(s,t){let e=Bo[s];return t=t||0,e?t>e.lbp&&(e.lbp=t):(e=Object.create(q3t),e.id=s,e.lbp=t,Bo[s]=e),e}function $s(s){let t,e=cs;for(Er(),t=e.nud();s<cs.lbp;)e=cs,Er(),t=e.led(t);return t}function Rn(s,t,e){const n=ci(s,t);n.led=e||function(i){return this.children=[i,$s(t)],this.type="binary",this}}function Iy(s,t,e){const n=ci(s,t);return n.led=e||function(i){return this.children=[i,$s(t-1)],this.type="binary",this},n}function fo(s,t){const e=ci(s);return e.nud=t||function(){return this.children=[$s(70)],this.type="unary",this},e}function r2(s){const t=ci(s,150);t.led=function(e){return this.children=[e],this.type="suffix",this}}function Rs(s){return Iy(s,10,function(t){return this.children=[t,$s(9)],this.assignment=!0,this.type="assign",this})}function Er(s){let t,e,n,i;if(s&&cs.data!==s)return Ms.unexpected("expected `"+s+"`, got `"+cs.data+"`");if(Jf>=Bc.length){cs=Bo["(end)"];return}if(t=Bc[Jf++],e=t.data,n=t.type,n==="ident")i=Ms.scope.find(e)||Ms.create_node(),n=i.type;else if(n==="builtin")i=Bo["(builtin)"];else if(n==="keyword")i=Bo["(keyword)"];else if(n==="operator"){if(i=Bo[e],!i)return Ms.unexpected("unknown operator `"+e+"`")}else if(n==="float"||n==="integer")n="literal",i=Bo["(literal)"];else return Ms.unexpected("unexpected token.");return i&&(i.nud||(i.nud=Ou),i.children||(i.children=[])),i=Object.create(i),i.token=t,i.type=n,i.data||(i.data=e),cs=i}function fM(s){return function(){return Ms.unexpected(s)}}var $3t=Qf;function Qf(s){if(this.constructor!==Qf)return new Qf(s);this.state=s,this.scopes=[],this.current=null}const X3t=Qf,dp=X3t.prototype;dp.enter=function(s){this.scopes.push(this.current=this.state[0].scope=s||{})};dp.exit=function(){this.scopes.pop(),this.current=this.scopes[this.scopes.length-1]};dp.define=function(s){this.current[s]=this.state[0]};dp.find=function(s,t){for(let e=this.scopes.length-1;e>-1;--e)if(this.scopes[e].hasOwnProperty(s))return this.scopes[e][s];return null};var j3t=cUt;const Y3t=W3t,Z3t=$3t,Se=new Object;let sn=0,Tc=sn++,dM=sn++,_g=sn++,pM=sn++,yg=sn++,mM=sn++,gM=sn++,vM=sn++,_M=sn++,yM=sn++,xM=sn++,bM=sn++,wM=sn++,MM=sn++,K3t=sn++,xg=sn++,J3t=sn++,SM=sn++,Q3t=sn++,tUt=sn++,eUt=sn++,AM=sn++,yf=sn++,EM=sn++;const Oy=1,Lv=2,nUt=4,zy=8,o2=16,a2=32,l2=64,dl=255,iUt=dl&~(Oy|Lv|a2|zy|nUt),sUt=dl&~(Oy|zy|o2|l2),rUt=!1,oUt=!1,aUt={"block-comment":MM,"line-comment":MM,preprocessor:K3t},lUt=sn=["ident","stmt","stmtlist","struct","function","functionargs","decl","decllist","forloop","whileloop","if","expr","precision","comment","preprocessor","keyword","keyword_or_ident","return","break","continue","discard","do-while","placeholder","quantifier"];function cUt(){const s=X(_g),t=X(dM),e=X(vM),n=X(wM),i=X(Tc),r=X(yg),o=X(mM),a=X(_M),l=X(xM),c=X(yM),h=X(SM),f=X(AM),d=X(EM);let m,g,y,_,v,w,b,M,A,T,P=arguments.length?[].slice.call(arguments):[],C=!1,S=[],L=[],H=[],$=[],B=!1,G,I,et;return S.shift=Lt,S.unshift=ft,S.fake=nt,S.unexpected=wt,S.scope=new Z3t(S),S.create_node=function(){const tt=ii(Tc,I);return tt.parent=Y.program,tt},Jt(),et=s(),et.expecting="(eof)",et.mode=_g,et.token={type:"(program)",data:"(program)"},G=et,Y.program=G,Y.scope=function(tt){return arguments.length===1&&(S.scope=tt),S.scope},S.unshift(et),Y;function Y(tt){return tt===null?(ut(),G):(L=[],J(tt),L)}function J(tt){if(tt.type==="whitespace"||tt.type==="line-comment"||tt.type==="block-comment"){$.push(tt);return}for(H.push(tt),I=I||H[0],I&&$.length&&(I.preceding=I.preceding||[],I.preceding=I.preceding.concat($),$=[]);dt();)switch(S[0].mode){case dM:It();break;case _g:Ot();break;case gM:Ht();break;case vM:qt();break;case bM:Mt();break;case pM:m(!0,!0);break;case wM:g();break;case Tc:$t();break;case xg:le();break;case J3t:ee();break;case yg:A();break;case mM:T();break;case _M:_();break;case yM:b();break;case AM:M();break;case SM:w();break;case xM:v();break;case EM:y();break}}function ut(tt){if(arguments.length&&J(tt),S.length>1){wt("unexpected EOF");return}}function dt(){return B||!S.length?!1:I=H[0]}function nt(tt){S.unshift(tt),S.shift()}function ft(tt,Q){tt.parent=S[0];const V=[].unshift.call(this,tt);return Q=Q===void 0?!0:Q,Q&&et!==tt&&et.children.push(tt),et=tt,V}function Lt(){let tt=[].shift.call(this),Q=P[this.length],V=!1;return P.length?typeof P[0]=="function"?V=P[0](tt):Q!==void 0&&(V=Q.test?Q.test(tt.type):Q===tt.type):V=!0,V&&!B&&L.push(tt),et=tt.parent,tt}function Ot(){return Qt(function(){return S.scope.enter(),Se},tt)();function tt(){if(I.data===S[0].expecting)return S.scope.exit(),S.shift();switch(I.type){case"preprocessor":S.fake(bt()),H.shift();return;default:S.unshift(t());return}}}function It(){if(S[0].brace)return I.data!=="}"?wt("expected `}`, got "+I.data):(S[0].brace=!1,H.shift(),S.shift());switch(I.type){case"eof":return Kt();case"keyword":switch(I.data){case"for":return S.unshift(a());case"if":return S.unshift(l());case"while":return S.unshift(c());case"do":return S.unshift(f());case"break":return S.fake(ii(Q3t,I)),H.shift();case"continue":return S.fake(ii(tUt,I)),H.shift();case"discard":return S.fake(ii(eUt,I)),H.shift();case"return":return S.unshift(h());case"precision":return S.unshift(n())}return S.unshift(W(dl));case"ident":var tt;if(tt=S.scope.find(I.data))return tt.parent.type==="struct"?S.unshift(W(dl)):S.unshift(ct(";"));case"operator":if(I.data==="{"){S[0].brace=!0;const Q=s();return Q.expecting="}",H.shift(),S.unshift(Q)}if(I.data===";")return H.shift(),S.shift();default:return S.unshift(ct(";"))}}function Kt(){return C&&(B=!0),C=!0,S.shift()}function Ht(){const tt=S[0];return Qt(Q,V,_t,zt,Ut,kt,ne,_e,Z)();function Q(){return I.data==="invariant"?tt.flags&zy?(S.unshift(Ct()),Se):wt("`invariant` is not allowed here"):(S.fake(ii(yf,{data:"",position:I.position})),Se)}function V(){return uUt(I)?tt.flags&o2?(S.unshift(Ct()),Se):wt("storage is not allowed here"):(S.fake(ii(yf,{data:"",position:I.position})),Se)}function _t(){return hUt(I)?tt.flags&a2?wt("parameter is not allowed here"):(S.unshift(Ct()),Se):(S.fake(ii(yf,{data:"",position:I.position})),Se)}function zt(){return fUt(I)?(S.unshift(Ct()),Se):(S.fake(ii(yf,{data:"",position:I.position})),Se)}function Ut(){if(I.data==="struct")return tt.flags&l2?(S.unshift(st()),Se):wt("cannot nest structs");if(I.type==="keyword")return S.unshift(Ct()),Se;const Rt=S.scope.find(I.data);return Rt?(S.fake(Object.create(Rt)),H.shift(),Se):wt("expected user defined type, struct or keyword, got "+I.data)}function kt(){if(I.data===","&&!(tt.flags&Lv))return S.shift();if(I.data==="["){S.unshift(d());return}return I.data===")"?S.shift():I.data===";"?tt.stage+3:I.type!=="ident"&&I.type!=="builtin"?wt("expected identifier, got "+I.data):(tt.collected_name=H.shift(),Se)}function ne(){return I.data==="("?(H.unshift(tt.collected_name),delete tt.collected_name,S.unshift(r()),tt.stage+2):Se}function _e(){return H.unshift(tt.collected_name),delete tt.collected_name,S.unshift(e()),Se}function Z(){return S.shift()}}function qt(){if(I.type==="ident"||I.type==="builtin"){const tt=I.data;S.unshift(i()),S.scope.define(tt);return}if(I.type==="operator"){if(I.data===",")return S[1].flags&Lv?H.shift():S.shift();if(I.data==="="){if(!(S[1].flags&Oy))return wt("`=` is not allowed here.");H.shift(),S.unshift(ct(",",";"));return}else if(I.data==="["){S.unshift(d());return}}return S.shift()}function ee(){if(I.type==="keyword"){S[0].type="keyword",S[0].mode=xg;return}if(I.type==="ident"){S[0].type="ident",S[0].mode=Tc;return}return wt("expected keyword or user-defined name, got "+I.data)}function le(){return I.type!=="keyword"?wt("expected keyword, got "+I.data):(S.shift(),H.shift())}function $t(){return I.type!=="ident"&&I.type!=="builtin"?wt("expected user-defined name, got "+I.data):(S[0].data=I.data,S.shift(),H.shift())}function Mt(){const tt=S[0].expecting;if(S[0].tokens=S[0].tokens||[],S[0].parenlevel===void 0&&(S[0].parenlevel=0,S[0].bracelevel=0),S[0].parenlevel<1&&tt.indexOf(I.data)>-1)return Q(S[0].tokens);switch(I.data==="("?++S[0].parenlevel:I.data===")"&&--S[0].parenlevel,I.data){case"{":++S[0].bracelevel;break;case"}":--S[0].bracelevel;break;case"(":++S[0].parenlevel;break;case")":--S[0].parenlevel;break}if(S[0].parenlevel<0)return wt("unexpected `)`");if(S[0].bracelevel<0)return wt("unexpected `}`");S[0].tokens.push(H.shift());return;function Q(V){try{Y3t(S,V)}catch(_t){throw B=!0,_t}return S.shift()}}function X(tt){return function(){return ii(tt,I)}}function bt(){return ii(aUt[I.type],I)}function W(tt){const Q=ii(gM,I);return Q.flags=tt,Q}function st(tt,Q){const V=ii(pM,I);return V.allow_assign=tt===void 0?!0:tt,V.allow_comma=Q===void 0?!0:Q,V}function ct(){const tt=ii(bM,I);return tt.expecting=[].slice.call(arguments),tt}function Ct(tt){let Q=I;return tt&&(Q={type:"(implied)",data:"(default)",position:Q.position}),ii(xg,Q)}function wt(tt){throw B=!0,new Error((tt||"unexpected "+S)+" at line "+S[0].token.line)}function Tt(tt,Q){return Xt(tt,I.type)&&Xt(Q,I.data)}function Xt(tt,Q){switch(typeof tt){case"string":return Q!==tt&&wt("expected `"+tt+"`, got "+Q+`
`+I.data),!B;case"object":return tt&&tt.indexOf(Q)===-1&&wt("expected one of `"+tt.join("`, `")+"`, got "+Q),!B}return!0}function Qt(){let tt=[].slice.call(arguments),Q,V;return function(){const _t=S[0];if(_t.stage||(_t.stage=0),Q=tt[_t.stage],!Q)return wt("parser in undefined state!");if(V=Q(),V===Se)return++_t.stage;V!==void 0&&(_t.stage=V)}}function U(tt,Q){return Q=Q||"operator",function(){if(!Tt(Q,tt))return;const V=H.shift(),_t=S[0].children,zt=_t[_t.length-1];return zt&&zt.token&&V.preceding&&(zt.token.succeeding=zt.token.succeeding||[],zt.token.succeeding=zt.token.succeeding.concat(V.preceding)),Se}}function k(tt){return function(){return S.unshift(ct(tt)),Se}}function ht(tt){return tt?function(){const Q=I.data;return Tt("ident")&&(S.unshift(i()),S.scope.define(Q),Se)}:function(){if(!Tt("ident"))return;const Q=Object.create(S.scope.find(I.data));return Q.token=I,H.shift(),Se}}function St(){return function(){const tt=s();return tt.expecting="}",S.unshift(tt),Se}}function Et(tt){return function(){const Q=S[0].stage;return I.data!=="{"?(S.unshift(t()),Q+tt):(H.shift(),Se)}}function Dt(){return function(){return S.shift(),S.shift()}}function Jt(){m=Qt(U("struct","keyword"),function(){return I.data==="{"?(S.fake(ii(Tc,{data:"",position:I.position,type:"ident"})),Se):ht(!0)()},function(){return S.scope.enter(),Se},U("{"),function(){if(I.type==="preprocessor"){S.fake(bt()),H.shift();return}if(I.data==="}")return S.scope.exit(),H.shift(),S.shift();if(I.data===";"){H.shift();return}S.unshift(W(sUt))}),g=Qt(function(){return H.shift(),Se},function(){return Tt("keyword",["lowp","mediump","highp"])&&(S.unshift(Ct()),Se)},function(){return S.unshift(Ct()),Se},function(){return S.shift()}),y=Qt(U("["),k("]"),U("]"),function(){return S.shift()}),_=Qt(U("for","keyword"),U("("),function(){let tt;if(I.type==="ident"){if((tt=S.scope.find(I.data))||(tt=S.create_node()),tt.parent.type==="struct")return S.unshift(W(dl)),Se}else if(I.type==="builtin"||I.type==="keyword")return S.unshift(W(dl)),Se;return k(";")()},U(";"),k(";"),U(";"),k(")"),U(")"),Et(3),St(),U("}"),Dt()),v=Qt(U("if","keyword"),U("("),k(")"),U(")"),Et(3),St(),U("}"),function(){return I.data==="else"?(H.shift(),S.unshift(t()),Se):Dt()()},Dt()),w=Qt(U("return","keyword"),function(){return I.data===";"||S.unshift(ct(";")),Se},function(){H.shift(),Dt()()}),b=Qt(U("while","keyword"),U("("),k(")"),U(")"),Et(3),St(),U("}"),Dt()),M=Qt(U("do","keyword"),Et(3),St(),U("}"),U("while","keyword"),U("("),k(")"),U(")"),Dt()),A=Qt(function(){for(let tt=1,Q=S.length;tt<Q;++tt)if(S[tt].mode===yg)return wt("function definition is not allowed within another function");return Se},function(){if(!Tt("ident"))return;const tt=I.data,Q=S.scope.find(tt);return S.unshift(i()),S.scope.define(tt),S.scope.enter(Q?Q.scope:null),Se},U("("),function(){return S.unshift(o()),Se},U(")"),function(){return I.data===";"?(S.scope.exit(),S.shift(),S.shift()):Se},U("{"),St(),U("}"),function(){return S.scope.exit(),Se},function(){return S.shift(),S.shift(),S.shift()}),T=Qt(function(){if(I.data==="void")return S.fake(Ct()),H.shift(),Se;if(I.data===")"){S.shift();return}return I.data==="struct"?(S.unshift(st(rUt,oUt)),Se):(S.unshift(W(iUt)),Se)},function(){if(I.data===",")return H.shift(),0;if(I.data===")"){S.shift();return}wt("expected one of `,` or `)`, got "+I.data)})}}function ii(s,t){return{mode:s,token:t,children:[],type:lUt[s],id:(Math.random()*4294967295).toString(16)}}function uUt(s){return s.data==="const"||s.data==="attribute"||s.data==="uniform"||s.data==="varying"}function hUt(s){return s.data==="in"||s.data==="inout"||s.data==="out"}function fUt(s){return s.data==="highp"||s.data==="mediump"||s.data==="lowp"}var dUt=j3t,pUt=mUt;function mUt(s){for(var t=dUt(),e=0;e<s.length;e++)t(s[e]);return t(null)}const gUt=mu(pUt);function ky(s,t,e){return Math.max(t,Math.min(e,s))}class Uy{constructor(t=0,e=0){Uy.prototype.isVector2=!0,this.x=t,this.y=e}get width(){return this.x}set width(t){this.x=t}get height(){return this.y}set height(t){this.y=t}set(t,e){return this.x=t,this.y=e,this}setScalar(t){return this.x=t,this.y=t,this}setX(t){return this.x=t,this}setY(t){return this.y=t,this}setComponent(t,e){switch(t){case 0:this.x=e;break;case 1:this.y=e;break;default:throw new Error("index is out of range: "+t)}return this}getComponent(t){switch(t){case 0:return this.x;case 1:return this.y;default:throw new Error("index is out of range: "+t)}}clone(){return new this.constructor(this.x,this.y)}copy(t){return this.x=t.x,this.y=t.y,this}add(t){return this.x+=t.x,this.y+=t.y,this}addScalar(t){return this.x+=t,this.y+=t,this}addVectors(t,e){return this.x=t.x+e.x,this.y=t.y+e.y,this}addScaledVector(t,e){return this.x+=t.x*e,this.y+=t.y*e,this}sub(t){return this.x-=t.x,this.y-=t.y,this}subScalar(t){return this.x-=t,this.y-=t,this}subVectors(t,e){return this.x=t.x-e.x,this.y=t.y-e.y,this}multiply(t){return this.x*=t.x,this.y*=t.y,this}multiplyScalar(t){return this.x*=t,this.y*=t,this}divide(t){return this.x/=t.x,this.y/=t.y,this}divideScalar(t){return this.multiplyScalar(1/t)}applyMatrix3(t){const e=this.x,n=this.y,i=t.elements;return this.x=i[0]*e+i[3]*n+i[6],this.y=i[1]*e+i[4]*n+i[7],this}min(t){return this.x=Math.min(this.x,t.x),this.y=Math.min(this.y,t.y),this}max(t){return this.x=Math.max(this.x,t.x),this.y=Math.max(this.y,t.y),this}clamp(t,e){return this.x=Math.max(t.x,Math.min(e.x,this.x)),this.y=Math.max(t.y,Math.min(e.y,this.y)),this}clampScalar(t,e){return this.x=Math.max(t,Math.min(e,this.x)),this.y=Math.max(t,Math.min(e,this.y)),this}clampLength(t,e){const n=this.length();return this.divideScalar(n||1).multiplyScalar(Math.max(t,Math.min(e,n)))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}roundToZero(){return this.x=this.x<0?Math.ceil(this.x):Math.floor(this.x),this.y=this.y<0?Math.ceil(this.y):Math.floor(this.y),this}negate(){return this.x=-this.x,this.y=-this.y,this}dot(t){return this.x*t.x+this.y*t.y}cross(t){return this.x*t.y-this.y*t.x}lengthSq(){return this.x*this.x+this.y*this.y}length(){return Math.sqrt(this.x*this.x+this.y*this.y)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)}normalize(){return this.divideScalar(this.length()||1)}angle(){return Math.atan2(-this.y,-this.x)+Math.PI}angleTo(t){const e=Math.sqrt(this.lengthSq()*t.lengthSq());if(e===0)return Math.PI/2;const n=this.dot(t)/e;return Math.acos(ky(n,-1,1))}distanceTo(t){return Math.sqrt(this.distanceToSquared(t))}distanceToSquared(t){const e=this.x-t.x,n=this.y-t.y;return e*e+n*n}manhattanDistanceTo(t){return Math.abs(this.x-t.x)+Math.abs(this.y-t.y)}setLength(t){return this.normalize().multiplyScalar(t)}lerp(t,e){return this.x+=(t.x-this.x)*e,this.y+=(t.y-this.y)*e,this}lerpVectors(t,e,n){return this.x=t.x+(e.x-t.x)*n,this.y=t.y+(e.y-t.y)*n,this}equals(t){return t.x===this.x&&t.y===this.y}fromArray(t,e=0){return this.x=t[e],this.y=t[e+1],this}toArray(t=[],e=0){return t[e]=this.x,t[e+1]=this.y,t}fromBufferAttribute(t,e){return this.x=t.getX(e),this.y=t.getY(e),this}rotateAround(t,e){const n=Math.cos(e),i=Math.sin(e),r=this.x-t.x,o=this.y-t.y;return this.x=r*n-o*i+t.x,this.y=r*i+o*n+t.y,this}random(){return this.x=Math.random(),this.y=Math.random(),this}*[Symbol.iterator](){yield this.x,yield this.y}}class vUt{constructor(t=0,e=0,n=0,i=1){this.isQuaternion=!0,this._x=t,this._y=e,this._z=n,this._w=i}static slerpFlat(t,e,n,i,r,o,a){let l=n[i+0],c=n[i+1],h=n[i+2],f=n[i+3];const d=r[o+0],m=r[o+1],g=r[o+2],y=r[o+3];if(a===0){t[e+0]=l,t[e+1]=c,t[e+2]=h,t[e+3]=f;return}if(a===1){t[e+0]=d,t[e+1]=m,t[e+2]=g,t[e+3]=y;return}if(f!==y||l!==d||c!==m||h!==g){let _=1-a;const v=l*d+c*m+h*g+f*y,w=v>=0?1:-1,b=1-v*v;if(b>Number.EPSILON){const A=Math.sqrt(b),T=Math.atan2(A,v*w);_=Math.sin(_*T)/A,a=Math.sin(a*T)/A}const M=a*w;if(l=l*_+d*M,c=c*_+m*M,h=h*_+g*M,f=f*_+y*M,_===1-a){const A=1/Math.sqrt(l*l+c*c+h*h+f*f);l*=A,c*=A,h*=A,f*=A}}t[e]=l,t[e+1]=c,t[e+2]=h,t[e+3]=f}static multiplyQuaternionsFlat(t,e,n,i,r,o){const a=n[i],l=n[i+1],c=n[i+2],h=n[i+3],f=r[o],d=r[o+1],m=r[o+2],g=r[o+3];return t[e]=a*g+h*f+l*m-c*d,t[e+1]=l*g+h*d+c*f-a*m,t[e+2]=c*g+h*m+a*d-l*f,t[e+3]=h*g-a*f-l*d-c*m,t}get x(){return this._x}set x(t){this._x=t,this._onChangeCallback()}get y(){return this._y}set y(t){this._y=t,this._onChangeCallback()}get z(){return this._z}set z(t){this._z=t,this._onChangeCallback()}get w(){return this._w}set w(t){this._w=t,this._onChangeCallback()}set(t,e,n,i){return this._x=t,this._y=e,this._z=n,this._w=i,this._onChangeCallback(),this}clone(){return new this.constructor(this._x,this._y,this._z,this._w)}copy(t){return this._x=t.x,this._y=t.y,this._z=t.z,this._w=t.w,this._onChangeCallback(),this}setFromEuler(t,e){const n=t._x,i=t._y,r=t._z,o=t._order,a=Math.cos,l=Math.sin,c=a(n/2),h=a(i/2),f=a(r/2),d=l(n/2),m=l(i/2),g=l(r/2);switch(o){case"XYZ":this._x=d*h*f+c*m*g,this._y=c*m*f-d*h*g,this._z=c*h*g+d*m*f,this._w=c*h*f-d*m*g;break;case"YXZ":this._x=d*h*f+c*m*g,this._y=c*m*f-d*h*g,this._z=c*h*g-d*m*f,this._w=c*h*f+d*m*g;break;case"ZXY":this._x=d*h*f-c*m*g,this._y=c*m*f+d*h*g,this._z=c*h*g+d*m*f,this._w=c*h*f-d*m*g;break;case"ZYX":this._x=d*h*f-c*m*g,this._y=c*m*f+d*h*g,this._z=c*h*g-d*m*f,this._w=c*h*f+d*m*g;break;case"YZX":this._x=d*h*f+c*m*g,this._y=c*m*f+d*h*g,this._z=c*h*g-d*m*f,this._w=c*h*f-d*m*g;break;case"XZY":this._x=d*h*f-c*m*g,this._y=c*m*f-d*h*g,this._z=c*h*g+d*m*f,this._w=c*h*f+d*m*g;break;default:console.warn("THREE.Quaternion: .setFromEuler() encountered an unknown order: "+o)}return e!==!1&&this._onChangeCallback(),this}setFromAxisAngle(t,e){const n=e/2,i=Math.sin(n);return this._x=t.x*i,this._y=t.y*i,this._z=t.z*i,this._w=Math.cos(n),this._onChangeCallback(),this}setFromRotationMatrix(t){const e=t.elements,n=e[0],i=e[4],r=e[8],o=e[1],a=e[5],l=e[9],c=e[2],h=e[6],f=e[10],d=n+a+f;if(d>0){const m=.5/Math.sqrt(d+1);this._w=.25/m,this._x=(h-l)*m,this._y=(r-c)*m,this._z=(o-i)*m}else if(n>a&&n>f){const m=2*Math.sqrt(1+n-a-f);this._w=(h-l)/m,this._x=.25*m,this._y=(i+o)/m,this._z=(r+c)/m}else if(a>f){const m=2*Math.sqrt(1+a-n-f);this._w=(r-c)/m,this._x=(i+o)/m,this._y=.25*m,this._z=(l+h)/m}else{const m=2*Math.sqrt(1+f-n-a);this._w=(o-i)/m,this._x=(r+c)/m,this._y=(l+h)/m,this._z=.25*m}return this._onChangeCallback(),this}setFromUnitVectors(t,e){let n=t.dot(e)+1;return n<Number.EPSILON?(n=0,Math.abs(t.x)>Math.abs(t.z)?(this._x=-t.y,this._y=t.x,this._z=0,this._w=n):(this._x=0,this._y=-t.z,this._z=t.y,this._w=n)):(this._x=t.y*e.z-t.z*e.y,this._y=t.z*e.x-t.x*e.z,this._z=t.x*e.y-t.y*e.x,this._w=n),this.normalize()}angleTo(t){return 2*Math.acos(Math.abs(ky(this.dot(t),-1,1)))}rotateTowards(t,e){const n=this.angleTo(t);if(n===0)return this;const i=Math.min(1,e/n);return this.slerp(t,i),this}identity(){return this.set(0,0,0,1)}invert(){return this.conjugate()}conjugate(){return this._x*=-1,this._y*=-1,this._z*=-1,this._onChangeCallback(),this}dot(t){return this._x*t._x+this._y*t._y+this._z*t._z+this._w*t._w}lengthSq(){return this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w}length(){return Math.sqrt(this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w)}normalize(){let t=this.length();return t===0?(this._x=0,this._y=0,this._z=0,this._w=1):(t=1/t,this._x=this._x*t,this._y=this._y*t,this._z=this._z*t,this._w=this._w*t),this._onChangeCallback(),this}multiply(t){return this.multiplyQuaternions(this,t)}premultiply(t){return this.multiplyQuaternions(t,this)}multiplyQuaternions(t,e){const n=t._x,i=t._y,r=t._z,o=t._w,a=e._x,l=e._y,c=e._z,h=e._w;return this._x=n*h+o*a+i*c-r*l,this._y=i*h+o*l+r*a-n*c,this._z=r*h+o*c+n*l-i*a,this._w=o*h-n*a-i*l-r*c,this._onChangeCallback(),this}slerp(t,e){if(e===0)return this;if(e===1)return this.copy(t);const n=this._x,i=this._y,r=this._z,o=this._w;let a=o*t._w+n*t._x+i*t._y+r*t._z;if(a<0?(this._w=-t._w,this._x=-t._x,this._y=-t._y,this._z=-t._z,a=-a):this.copy(t),a>=1)return this._w=o,this._x=n,this._y=i,this._z=r,this;const l=1-a*a;if(l<=Number.EPSILON){const m=1-e;return this._w=m*o+e*this._w,this._x=m*n+e*this._x,this._y=m*i+e*this._y,this._z=m*r+e*this._z,this.normalize(),this._onChangeCallback(),this}const c=Math.sqrt(l),h=Math.atan2(c,a),f=Math.sin((1-e)*h)/c,d=Math.sin(e*h)/c;return this._w=o*f+this._w*d,this._x=n*f+this._x*d,this._y=i*f+this._y*d,this._z=r*f+this._z*d,this._onChangeCallback(),this}slerpQuaternions(t,e,n){return this.copy(t).slerp(e,n)}random(){const t=Math.random(),e=Math.sqrt(1-t),n=Math.sqrt(t),i=2*Math.PI*Math.random(),r=2*Math.PI*Math.random();return this.set(e*Math.cos(i),n*Math.sin(r),n*Math.cos(r),e*Math.sin(i))}equals(t){return t._x===this._x&&t._y===this._y&&t._z===this._z&&t._w===this._w}fromArray(t,e=0){return this._x=t[e],this._y=t[e+1],this._z=t[e+2],this._w=t[e+3],this._onChangeCallback(),this}toArray(t=[],e=0){return t[e]=this._x,t[e+1]=this._y,t[e+2]=this._z,t[e+3]=this._w,t}fromBufferAttribute(t,e){return this._x=t.getX(e),this._y=t.getY(e),this._z=t.getZ(e),this._w=t.getW(e),this}toJSON(){return this.toArray()}_onChange(t){return this._onChangeCallback=t,this}_onChangeCallback(){}*[Symbol.iterator](){yield this._x,yield this._y,yield this._z,yield this._w}}class Ks{constructor(t=0,e=0,n=0){Ks.prototype.isVector3=!0,this.x=t,this.y=e,this.z=n}set(t,e,n){return n===void 0&&(n=this.z),this.x=t,this.y=e,this.z=n,this}setScalar(t){return this.x=t,this.y=t,this.z=t,this}setX(t){return this.x=t,this}setY(t){return this.y=t,this}setZ(t){return this.z=t,this}setComponent(t,e){switch(t){case 0:this.x=e;break;case 1:this.y=e;break;case 2:this.z=e;break;default:throw new Error("index is out of range: "+t)}return this}getComponent(t){switch(t){case 0:return this.x;case 1:return this.y;case 2:return this.z;default:throw new Error("index is out of range: "+t)}}clone(){return new this.constructor(this.x,this.y,this.z)}copy(t){return this.x=t.x,this.y=t.y,this.z=t.z,this}add(t){return this.x+=t.x,this.y+=t.y,this.z+=t.z,this}addScalar(t){return this.x+=t,this.y+=t,this.z+=t,this}addVectors(t,e){return this.x=t.x+e.x,this.y=t.y+e.y,this.z=t.z+e.z,this}addScaledVector(t,e){return this.x+=t.x*e,this.y+=t.y*e,this.z+=t.z*e,this}sub(t){return this.x-=t.x,this.y-=t.y,this.z-=t.z,this}subScalar(t){return this.x-=t,this.y-=t,this.z-=t,this}subVectors(t,e){return this.x=t.x-e.x,this.y=t.y-e.y,this.z=t.z-e.z,this}multiply(t){return this.x*=t.x,this.y*=t.y,this.z*=t.z,this}multiplyScalar(t){return this.x*=t,this.y*=t,this.z*=t,this}multiplyVectors(t,e){return this.x=t.x*e.x,this.y=t.y*e.y,this.z=t.z*e.z,this}applyEuler(t){return this.applyQuaternion(TM.setFromEuler(t))}applyAxisAngle(t,e){return this.applyQuaternion(TM.setFromAxisAngle(t,e))}applyMatrix3(t){const e=this.x,n=this.y,i=this.z,r=t.elements;return this.x=r[0]*e+r[3]*n+r[6]*i,this.y=r[1]*e+r[4]*n+r[7]*i,this.z=r[2]*e+r[5]*n+r[8]*i,this}applyNormalMatrix(t){return this.applyMatrix3(t).normalize()}applyMatrix4(t){const e=this.x,n=this.y,i=this.z,r=t.elements,o=1/(r[3]*e+r[7]*n+r[11]*i+r[15]);return this.x=(r[0]*e+r[4]*n+r[8]*i+r[12])*o,this.y=(r[1]*e+r[5]*n+r[9]*i+r[13])*o,this.z=(r[2]*e+r[6]*n+r[10]*i+r[14])*o,this}applyQuaternion(t){const e=this.x,n=this.y,i=this.z,r=t.x,o=t.y,a=t.z,l=t.w,c=l*e+o*i-a*n,h=l*n+a*e-r*i,f=l*i+r*n-o*e,d=-r*e-o*n-a*i;return this.x=c*l+d*-r+h*-a-f*-o,this.y=h*l+d*-o+f*-r-c*-a,this.z=f*l+d*-a+c*-o-h*-r,this}project(t){return this.applyMatrix4(t.matrixWorldInverse).applyMatrix4(t.projectionMatrix)}unproject(t){return this.applyMatrix4(t.projectionMatrixInverse).applyMatrix4(t.matrixWorld)}transformDirection(t){const e=this.x,n=this.y,i=this.z,r=t.elements;return this.x=r[0]*e+r[4]*n+r[8]*i,this.y=r[1]*e+r[5]*n+r[9]*i,this.z=r[2]*e+r[6]*n+r[10]*i,this.normalize()}divide(t){return this.x/=t.x,this.y/=t.y,this.z/=t.z,this}divideScalar(t){return this.multiplyScalar(1/t)}min(t){return this.x=Math.min(this.x,t.x),this.y=Math.min(this.y,t.y),this.z=Math.min(this.z,t.z),this}max(t){return this.x=Math.max(this.x,t.x),this.y=Math.max(this.y,t.y),this.z=Math.max(this.z,t.z),this}clamp(t,e){return this.x=Math.max(t.x,Math.min(e.x,this.x)),this.y=Math.max(t.y,Math.min(e.y,this.y)),this.z=Math.max(t.z,Math.min(e.z,this.z)),this}clampScalar(t,e){return this.x=Math.max(t,Math.min(e,this.x)),this.y=Math.max(t,Math.min(e,this.y)),this.z=Math.max(t,Math.min(e,this.z)),this}clampLength(t,e){const n=this.length();return this.divideScalar(n||1).multiplyScalar(Math.max(t,Math.min(e,n)))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this.z=Math.floor(this.z),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this.z=Math.ceil(this.z),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this.z=Math.round(this.z),this}roundToZero(){return this.x=this.x<0?Math.ceil(this.x):Math.floor(this.x),this.y=this.y<0?Math.ceil(this.y):Math.floor(this.y),this.z=this.z<0?Math.ceil(this.z):Math.floor(this.z),this}negate(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this}dot(t){return this.x*t.x+this.y*t.y+this.z*t.z}lengthSq(){return this.x*this.x+this.y*this.y+this.z*this.z}length(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)}normalize(){return this.divideScalar(this.length()||1)}setLength(t){return this.normalize().multiplyScalar(t)}lerp(t,e){return this.x+=(t.x-this.x)*e,this.y+=(t.y-this.y)*e,this.z+=(t.z-this.z)*e,this}lerpVectors(t,e,n){return this.x=t.x+(e.x-t.x)*n,this.y=t.y+(e.y-t.y)*n,this.z=t.z+(e.z-t.z)*n,this}cross(t){return this.crossVectors(this,t)}crossVectors(t,e){const n=t.x,i=t.y,r=t.z,o=e.x,a=e.y,l=e.z;return this.x=i*l-r*a,this.y=r*o-n*l,this.z=n*a-i*o,this}projectOnVector(t){const e=t.lengthSq();if(e===0)return this.set(0,0,0);const n=t.dot(this)/e;return this.copy(t).multiplyScalar(n)}projectOnPlane(t){return bg.copy(this).projectOnVector(t),this.sub(bg)}reflect(t){return this.sub(bg.copy(t).multiplyScalar(2*this.dot(t)))}angleTo(t){const e=Math.sqrt(this.lengthSq()*t.lengthSq());if(e===0)return Math.PI/2;const n=this.dot(t)/e;return Math.acos(ky(n,-1,1))}distanceTo(t){return Math.sqrt(this.distanceToSquared(t))}distanceToSquared(t){const e=this.x-t.x,n=this.y-t.y,i=this.z-t.z;return e*e+n*n+i*i}manhattanDistanceTo(t){return Math.abs(this.x-t.x)+Math.abs(this.y-t.y)+Math.abs(this.z-t.z)}setFromSpherical(t){return this.setFromSphericalCoords(t.radius,t.phi,t.theta)}setFromSphericalCoords(t,e,n){const i=Math.sin(e)*t;return this.x=i*Math.sin(n),this.y=Math.cos(e)*t,this.z=i*Math.cos(n),this}setFromCylindrical(t){return this.setFromCylindricalCoords(t.radius,t.theta,t.y)}setFromCylindricalCoords(t,e,n){return this.x=t*Math.sin(e),this.y=n,this.z=t*Math.cos(e),this}setFromMatrixPosition(t){const e=t.elements;return this.x=e[12],this.y=e[13],this.z=e[14],this}setFromMatrixScale(t){const e=this.setFromMatrixColumn(t,0).length(),n=this.setFromMatrixColumn(t,1).length(),i=this.setFromMatrixColumn(t,2).length();return this.x=e,this.y=n,this.z=i,this}setFromMatrixColumn(t,e){return this.fromArray(t.elements,e*4)}setFromMatrix3Column(t,e){return this.fromArray(t.elements,e*3)}setFromEuler(t){return this.x=t._x,this.y=t._y,this.z=t._z,this}setFromColor(t){return this.x=t.r,this.y=t.g,this.z=t.b,this}equals(t){return t.x===this.x&&t.y===this.y&&t.z===this.z}fromArray(t,e=0){return this.x=t[e],this.y=t[e+1],this.z=t[e+2],this}toArray(t=[],e=0){return t[e]=this.x,t[e+1]=this.y,t[e+2]=this.z,t}fromBufferAttribute(t,e){return this.x=t.getX(e),this.y=t.getY(e),this.z=t.getZ(e),this}random(){return this.x=Math.random(),this.y=Math.random(),this.z=Math.random(),this}randomDirection(){const t=(Math.random()-.5)*2,e=Math.random()*Math.PI*2,n=Math.sqrt(1-t**2);return this.x=n*Math.cos(e),this.y=n*Math.sin(e),this.z=t,this}*[Symbol.iterator](){yield this.x,yield this.y,yield this.z}}const bg=new Ks,TM=new vUt;class Ny{constructor(t=0,e=0,n=0,i=1){Ny.prototype.isVector4=!0,this.x=t,this.y=e,this.z=n,this.w=i}get width(){return this.z}set width(t){this.z=t}get height(){return this.w}set height(t){this.w=t}set(t,e,n,i){return this.x=t,this.y=e,this.z=n,this.w=i,this}setScalar(t){return this.x=t,this.y=t,this.z=t,this.w=t,this}setX(t){return this.x=t,this}setY(t){return this.y=t,this}setZ(t){return this.z=t,this}setW(t){return this.w=t,this}setComponent(t,e){switch(t){case 0:this.x=e;break;case 1:this.y=e;break;case 2:this.z=e;break;case 3:this.w=e;break;default:throw new Error("index is out of range: "+t)}return this}getComponent(t){switch(t){case 0:return this.x;case 1:return this.y;case 2:return this.z;case 3:return this.w;default:throw new Error("index is out of range: "+t)}}clone(){return new this.constructor(this.x,this.y,this.z,this.w)}copy(t){return this.x=t.x,this.y=t.y,this.z=t.z,this.w=t.w!==void 0?t.w:1,this}add(t){return this.x+=t.x,this.y+=t.y,this.z+=t.z,this.w+=t.w,this}addScalar(t){return this.x+=t,this.y+=t,this.z+=t,this.w+=t,this}addVectors(t,e){return this.x=t.x+e.x,this.y=t.y+e.y,this.z=t.z+e.z,this.w=t.w+e.w,this}addScaledVector(t,e){return this.x+=t.x*e,this.y+=t.y*e,this.z+=t.z*e,this.w+=t.w*e,this}sub(t){return this.x-=t.x,this.y-=t.y,this.z-=t.z,this.w-=t.w,this}subScalar(t){return this.x-=t,this.y-=t,this.z-=t,this.w-=t,this}subVectors(t,e){return this.x=t.x-e.x,this.y=t.y-e.y,this.z=t.z-e.z,this.w=t.w-e.w,this}multiply(t){return this.x*=t.x,this.y*=t.y,this.z*=t.z,this.w*=t.w,this}multiplyScalar(t){return this.x*=t,this.y*=t,this.z*=t,this.w*=t,this}applyMatrix4(t){const e=this.x,n=this.y,i=this.z,r=this.w,o=t.elements;return this.x=o[0]*e+o[4]*n+o[8]*i+o[12]*r,this.y=o[1]*e+o[5]*n+o[9]*i+o[13]*r,this.z=o[2]*e+o[6]*n+o[10]*i+o[14]*r,this.w=o[3]*e+o[7]*n+o[11]*i+o[15]*r,this}divideScalar(t){return this.multiplyScalar(1/t)}setAxisAngleFromQuaternion(t){this.w=2*Math.acos(t.w);const e=Math.sqrt(1-t.w*t.w);return e<1e-4?(this.x=1,this.y=0,this.z=0):(this.x=t.x/e,this.y=t.y/e,this.z=t.z/e),this}setAxisAngleFromRotationMatrix(t){let e,n,i,r;const l=t.elements,c=l[0],h=l[4],f=l[8],d=l[1],m=l[5],g=l[9],y=l[2],_=l[6],v=l[10];if(Math.abs(h-d)<.01&&Math.abs(f-y)<.01&&Math.abs(g-_)<.01){if(Math.abs(h+d)<.1&&Math.abs(f+y)<.1&&Math.abs(g+_)<.1&&Math.abs(c+m+v-3)<.1)return this.set(1,0,0,0),this;e=Math.PI;const b=(c+1)/2,M=(m+1)/2,A=(v+1)/2,T=(h+d)/4,P=(f+y)/4,C=(g+_)/4;return b>M&&b>A?b<.01?(n=0,i=.707106781,r=.707106781):(n=Math.sqrt(b),i=T/n,r=P/n):M>A?M<.01?(n=.707106781,i=0,r=.707106781):(i=Math.sqrt(M),n=T/i,r=C/i):A<.01?(n=.707106781,i=.707106781,r=0):(r=Math.sqrt(A),n=P/r,i=C/r),this.set(n,i,r,e),this}let w=Math.sqrt((_-g)*(_-g)+(f-y)*(f-y)+(d-h)*(d-h));return Math.abs(w)<.001&&(w=1),this.x=(_-g)/w,this.y=(f-y)/w,this.z=(d-h)/w,this.w=Math.acos((c+m+v-1)/2),this}min(t){return this.x=Math.min(this.x,t.x),this.y=Math.min(this.y,t.y),this.z=Math.min(this.z,t.z),this.w=Math.min(this.w,t.w),this}max(t){return this.x=Math.max(this.x,t.x),this.y=Math.max(this.y,t.y),this.z=Math.max(this.z,t.z),this.w=Math.max(this.w,t.w),this}clamp(t,e){return this.x=Math.max(t.x,Math.min(e.x,this.x)),this.y=Math.max(t.y,Math.min(e.y,this.y)),this.z=Math.max(t.z,Math.min(e.z,this.z)),this.w=Math.max(t.w,Math.min(e.w,this.w)),this}clampScalar(t,e){return this.x=Math.max(t,Math.min(e,this.x)),this.y=Math.max(t,Math.min(e,this.y)),this.z=Math.max(t,Math.min(e,this.z)),this.w=Math.max(t,Math.min(e,this.w)),this}clampLength(t,e){const n=this.length();return this.divideScalar(n||1).multiplyScalar(Math.max(t,Math.min(e,n)))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this.z=Math.floor(this.z),this.w=Math.floor(this.w),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this.z=Math.ceil(this.z),this.w=Math.ceil(this.w),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this.z=Math.round(this.z),this.w=Math.round(this.w),this}roundToZero(){return this.x=this.x<0?Math.ceil(this.x):Math.floor(this.x),this.y=this.y<0?Math.ceil(this.y):Math.floor(this.y),this.z=this.z<0?Math.ceil(this.z):Math.floor(this.z),this.w=this.w<0?Math.ceil(this.w):Math.floor(this.w),this}negate(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this.w=-this.w,this}dot(t){return this.x*t.x+this.y*t.y+this.z*t.z+this.w*t.w}lengthSq(){return this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w}length(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)+Math.abs(this.w)}normalize(){return this.divideScalar(this.length()||1)}setLength(t){return this.normalize().multiplyScalar(t)}lerp(t,e){return this.x+=(t.x-this.x)*e,this.y+=(t.y-this.y)*e,this.z+=(t.z-this.z)*e,this.w+=(t.w-this.w)*e,this}lerpVectors(t,e,n){return this.x=t.x+(e.x-t.x)*n,this.y=t.y+(e.y-t.y)*n,this.z=t.z+(e.z-t.z)*n,this.w=t.w+(e.w-t.w)*n,this}equals(t){return t.x===this.x&&t.y===this.y&&t.z===this.z&&t.w===this.w}fromArray(t,e=0){return this.x=t[e],this.y=t[e+1],this.z=t[e+2],this.w=t[e+3],this}toArray(t=[],e=0){return t[e]=this.x,t[e+1]=this.y,t[e+2]=this.z,t[e+3]=this.w,t}fromBufferAttribute(t,e){return this.x=t.getX(e),this.y=t.getY(e),this.z=t.getZ(e),this.w=t.getW(e),this}random(){return this.x=Math.random(),this.y=Math.random(),this.z=Math.random(),this.w=Math.random(),this}*[Symbol.iterator](){yield this.x,yield this.y,yield this.z,yield this.w}}class pp{constructor(t,e,n,i,r,o,a,l,c){pp.prototype.isMatrix3=!0,this.elements=[1,0,0,0,1,0,0,0,1],t!==void 0&&this.set(t,e,n,i,r,o,a,l,c)}set(t,e,n,i,r,o,a,l,c){const h=this.elements;return h[0]=t,h[1]=i,h[2]=a,h[3]=e,h[4]=r,h[5]=l,h[6]=n,h[7]=o,h[8]=c,this}identity(){return this.set(1,0,0,0,1,0,0,0,1),this}copy(t){const e=this.elements,n=t.elements;return e[0]=n[0],e[1]=n[1],e[2]=n[2],e[3]=n[3],e[4]=n[4],e[5]=n[5],e[6]=n[6],e[7]=n[7],e[8]=n[8],this}extractBasis(t,e,n){return t.setFromMatrix3Column(this,0),e.setFromMatrix3Column(this,1),n.setFromMatrix3Column(this,2),this}setFromMatrix4(t){const e=t.elements;return this.set(e[0],e[4],e[8],e[1],e[5],e[9],e[2],e[6],e[10]),this}multiply(t){return this.multiplyMatrices(this,t)}premultiply(t){return this.multiplyMatrices(t,this)}multiplyMatrices(t,e){const n=t.elements,i=e.elements,r=this.elements,o=n[0],a=n[3],l=n[6],c=n[1],h=n[4],f=n[7],d=n[2],m=n[5],g=n[8],y=i[0],_=i[3],v=i[6],w=i[1],b=i[4],M=i[7],A=i[2],T=i[5],P=i[8];return r[0]=o*y+a*w+l*A,r[3]=o*_+a*b+l*T,r[6]=o*v+a*M+l*P,r[1]=c*y+h*w+f*A,r[4]=c*_+h*b+f*T,r[7]=c*v+h*M+f*P,r[2]=d*y+m*w+g*A,r[5]=d*_+m*b+g*T,r[8]=d*v+m*M+g*P,this}multiplyScalar(t){const e=this.elements;return e[0]*=t,e[3]*=t,e[6]*=t,e[1]*=t,e[4]*=t,e[7]*=t,e[2]*=t,e[5]*=t,e[8]*=t,this}determinant(){const t=this.elements,e=t[0],n=t[1],i=t[2],r=t[3],o=t[4],a=t[5],l=t[6],c=t[7],h=t[8];return e*o*h-e*a*c-n*r*h+n*a*l+i*r*c-i*o*l}invert(){const t=this.elements,e=t[0],n=t[1],i=t[2],r=t[3],o=t[4],a=t[5],l=t[6],c=t[7],h=t[8],f=h*o-a*c,d=a*l-h*r,m=c*r-o*l,g=e*f+n*d+i*m;if(g===0)return this.set(0,0,0,0,0,0,0,0,0);const y=1/g;return t[0]=f*y,t[1]=(i*c-h*n)*y,t[2]=(a*n-i*o)*y,t[3]=d*y,t[4]=(h*e-i*l)*y,t[5]=(i*r-a*e)*y,t[6]=m*y,t[7]=(n*l-c*e)*y,t[8]=(o*e-n*r)*y,this}transpose(){let t;const e=this.elements;return t=e[1],e[1]=e[3],e[3]=t,t=e[2],e[2]=e[6],e[6]=t,t=e[5],e[5]=e[7],e[7]=t,this}getNormalMatrix(t){return this.setFromMatrix4(t).invert().transpose()}transposeIntoArray(t){const e=this.elements;return t[0]=e[0],t[1]=e[3],t[2]=e[6],t[3]=e[1],t[4]=e[4],t[5]=e[7],t[6]=e[2],t[7]=e[5],t[8]=e[8],this}setUvTransform(t,e,n,i,r,o,a){const l=Math.cos(r),c=Math.sin(r);return this.set(n*l,n*c,-n*(l*o+c*a)+o+t,-i*c,i*l,-i*(-c*o+l*a)+a+e,0,0,1),this}scale(t,e){return this.premultiply(wg.makeScale(t,e)),this}rotate(t){return this.premultiply(wg.makeRotation(-t)),this}translate(t,e){return this.premultiply(wg.makeTranslation(t,e)),this}makeTranslation(t,e){return t.isVector2?this.set(1,0,t.x,0,1,t.y,0,0,1):this.set(1,0,t,0,1,e,0,0,1),this}makeRotation(t){const e=Math.cos(t),n=Math.sin(t);return this.set(e,-n,0,n,e,0,0,0,1),this}makeScale(t,e){return this.set(t,0,0,0,e,0,0,0,1),this}equals(t){const e=this.elements,n=t.elements;for(let i=0;i<9;i++)if(e[i]!==n[i])return!1;return!0}fromArray(t,e=0){for(let n=0;n<9;n++)this.elements[n]=t[n+e];return this}toArray(t=[],e=0){const n=this.elements;return t[e]=n[0],t[e+1]=n[1],t[e+2]=n[2],t[e+3]=n[3],t[e+4]=n[4],t[e+5]=n[5],t[e+6]=n[6],t[e+7]=n[7],t[e+8]=n[8],t}clone(){return new this.constructor().fromArray(this.elements)}}const wg=new pp,xf=2e3,CM=2001;class pu{constructor(t,e,n,i,r,o,a,l,c,h,f,d,m,g,y,_){pu.prototype.isMatrix4=!0,this.elements=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],t!==void 0&&this.set(t,e,n,i,r,o,a,l,c,h,f,d,m,g,y,_)}set(t,e,n,i,r,o,a,l,c,h,f,d,m,g,y,_){const v=this.elements;return v[0]=t,v[4]=e,v[8]=n,v[12]=i,v[1]=r,v[5]=o,v[9]=a,v[13]=l,v[2]=c,v[6]=h,v[10]=f,v[14]=d,v[3]=m,v[7]=g,v[11]=y,v[15]=_,this}identity(){return this.set(1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1),this}clone(){return new pu().fromArray(this.elements)}copy(t){const e=this.elements,n=t.elements;return e[0]=n[0],e[1]=n[1],e[2]=n[2],e[3]=n[3],e[4]=n[4],e[5]=n[5],e[6]=n[6],e[7]=n[7],e[8]=n[8],e[9]=n[9],e[10]=n[10],e[11]=n[11],e[12]=n[12],e[13]=n[13],e[14]=n[14],e[15]=n[15],this}copyPosition(t){const e=this.elements,n=t.elements;return e[12]=n[12],e[13]=n[13],e[14]=n[14],this}setFromMatrix3(t){const e=t.elements;return this.set(e[0],e[3],e[6],0,e[1],e[4],e[7],0,e[2],e[5],e[8],0,0,0,0,1),this}extractBasis(t,e,n){return t.setFromMatrixColumn(this,0),e.setFromMatrixColumn(this,1),n.setFromMatrixColumn(this,2),this}makeBasis(t,e,n){return this.set(t.x,e.x,n.x,0,t.y,e.y,n.y,0,t.z,e.z,n.z,0,0,0,0,1),this}extractRotation(t){const e=this.elements,n=t.elements,i=1/il.setFromMatrixColumn(t,0).length(),r=1/il.setFromMatrixColumn(t,1).length(),o=1/il.setFromMatrixColumn(t,2).length();return e[0]=n[0]*i,e[1]=n[1]*i,e[2]=n[2]*i,e[3]=0,e[4]=n[4]*r,e[5]=n[5]*r,e[6]=n[6]*r,e[7]=0,e[8]=n[8]*o,e[9]=n[9]*o,e[10]=n[10]*o,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,this}makeRotationFromEuler(t){const e=this.elements,n=t.x,i=t.y,r=t.z,o=Math.cos(n),a=Math.sin(n),l=Math.cos(i),c=Math.sin(i),h=Math.cos(r),f=Math.sin(r);if(t.order==="XYZ"){const d=o*h,m=o*f,g=a*h,y=a*f;e[0]=l*h,e[4]=-l*f,e[8]=c,e[1]=m+g*c,e[5]=d-y*c,e[9]=-a*l,e[2]=y-d*c,e[6]=g+m*c,e[10]=o*l}else if(t.order==="YXZ"){const d=l*h,m=l*f,g=c*h,y=c*f;e[0]=d+y*a,e[4]=g*a-m,e[8]=o*c,e[1]=o*f,e[5]=o*h,e[9]=-a,e[2]=m*a-g,e[6]=y+d*a,e[10]=o*l}else if(t.order==="ZXY"){const d=l*h,m=l*f,g=c*h,y=c*f;e[0]=d-y*a,e[4]=-o*f,e[8]=g+m*a,e[1]=m+g*a,e[5]=o*h,e[9]=y-d*a,e[2]=-o*c,e[6]=a,e[10]=o*l}else if(t.order==="ZYX"){const d=o*h,m=o*f,g=a*h,y=a*f;e[0]=l*h,e[4]=g*c-m,e[8]=d*c+y,e[1]=l*f,e[5]=y*c+d,e[9]=m*c-g,e[2]=-c,e[6]=a*l,e[10]=o*l}else if(t.order==="YZX"){const d=o*l,m=o*c,g=a*l,y=a*c;e[0]=l*h,e[4]=y-d*f,e[8]=g*f+m,e[1]=f,e[5]=o*h,e[9]=-a*h,e[2]=-c*h,e[6]=m*f+g,e[10]=d-y*f}else if(t.order==="XZY"){const d=o*l,m=o*c,g=a*l,y=a*c;e[0]=l*h,e[4]=-f,e[8]=c*h,e[1]=d*f+y,e[5]=o*h,e[9]=m*f-g,e[2]=g*f-m,e[6]=a*h,e[10]=y*f+d}return e[3]=0,e[7]=0,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,this}makeRotationFromQuaternion(t){return this.compose(_Ut,t,yUt)}lookAt(t,e,n){const i=this.elements;return ki.subVectors(t,e),ki.lengthSq()===0&&(ki.z=1),ki.normalize(),Wr.crossVectors(n,ki),Wr.lengthSq()===0&&(Math.abs(n.z)===1?ki.x+=1e-4:ki.z+=1e-4,ki.normalize(),Wr.crossVectors(n,ki)),Wr.normalize(),bf.crossVectors(ki,Wr),i[0]=Wr.x,i[4]=bf.x,i[8]=ki.x,i[1]=Wr.y,i[5]=bf.y,i[9]=ki.y,i[2]=Wr.z,i[6]=bf.z,i[10]=ki.z,this}multiply(t){return this.multiplyMatrices(this,t)}premultiply(t){return this.multiplyMatrices(t,this)}multiplyMatrices(t,e){const n=t.elements,i=e.elements,r=this.elements,o=n[0],a=n[4],l=n[8],c=n[12],h=n[1],f=n[5],d=n[9],m=n[13],g=n[2],y=n[6],_=n[10],v=n[14],w=n[3],b=n[7],M=n[11],A=n[15],T=i[0],P=i[4],C=i[8],S=i[12],L=i[1],H=i[5],$=i[9],B=i[13],G=i[2],I=i[6],et=i[10],Y=i[14],J=i[3],ut=i[7],dt=i[11],nt=i[15];return r[0]=o*T+a*L+l*G+c*J,r[4]=o*P+a*H+l*I+c*ut,r[8]=o*C+a*$+l*et+c*dt,r[12]=o*S+a*B+l*Y+c*nt,r[1]=h*T+f*L+d*G+m*J,r[5]=h*P+f*H+d*I+m*ut,r[9]=h*C+f*$+d*et+m*dt,r[13]=h*S+f*B+d*Y+m*nt,r[2]=g*T+y*L+_*G+v*J,r[6]=g*P+y*H+_*I+v*ut,r[10]=g*C+y*$+_*et+v*dt,r[14]=g*S+y*B+_*Y+v*nt,r[3]=w*T+b*L+M*G+A*J,r[7]=w*P+b*H+M*I+A*ut,r[11]=w*C+b*$+M*et+A*dt,r[15]=w*S+b*B+M*Y+A*nt,this}multiplyScalar(t){const e=this.elements;return e[0]*=t,e[4]*=t,e[8]*=t,e[12]*=t,e[1]*=t,e[5]*=t,e[9]*=t,e[13]*=t,e[2]*=t,e[6]*=t,e[10]*=t,e[14]*=t,e[3]*=t,e[7]*=t,e[11]*=t,e[15]*=t,this}determinant(){const t=this.elements,e=t[0],n=t[4],i=t[8],r=t[12],o=t[1],a=t[5],l=t[9],c=t[13],h=t[2],f=t[6],d=t[10],m=t[14],g=t[3],y=t[7],_=t[11],v=t[15];return g*(+r*l*f-i*c*f-r*a*d+n*c*d+i*a*m-n*l*m)+y*(+e*l*m-e*c*d+r*o*d-i*o*m+i*c*h-r*l*h)+_*(+e*c*f-e*a*m-r*o*f+n*o*m+r*a*h-n*c*h)+v*(-i*a*h-e*l*f+e*a*d+i*o*f-n*o*d+n*l*h)}transpose(){const t=this.elements;let e;return e=t[1],t[1]=t[4],t[4]=e,e=t[2],t[2]=t[8],t[8]=e,e=t[6],t[6]=t[9],t[9]=e,e=t[3],t[3]=t[12],t[12]=e,e=t[7],t[7]=t[13],t[13]=e,e=t[11],t[11]=t[14],t[14]=e,this}setPosition(t,e,n){const i=this.elements;return t.isVector3?(i[12]=t.x,i[13]=t.y,i[14]=t.z):(i[12]=t,i[13]=e,i[14]=n),this}invert(){const t=this.elements,e=t[0],n=t[1],i=t[2],r=t[3],o=t[4],a=t[5],l=t[6],c=t[7],h=t[8],f=t[9],d=t[10],m=t[11],g=t[12],y=t[13],_=t[14],v=t[15],w=f*_*c-y*d*c+y*l*m-a*_*m-f*l*v+a*d*v,b=g*d*c-h*_*c-g*l*m+o*_*m+h*l*v-o*d*v,M=h*y*c-g*f*c+g*a*m-o*y*m-h*a*v+o*f*v,A=g*f*l-h*y*l-g*a*d+o*y*d+h*a*_-o*f*_,T=e*w+n*b+i*M+r*A;if(T===0)return this.set(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0);const P=1/T;return t[0]=w*P,t[1]=(y*d*r-f*_*r-y*i*m+n*_*m+f*i*v-n*d*v)*P,t[2]=(a*_*r-y*l*r+y*i*c-n*_*c-a*i*v+n*l*v)*P,t[3]=(f*l*r-a*d*r-f*i*c+n*d*c+a*i*m-n*l*m)*P,t[4]=b*P,t[5]=(h*_*r-g*d*r+g*i*m-e*_*m-h*i*v+e*d*v)*P,t[6]=(g*l*r-o*_*r-g*i*c+e*_*c+o*i*v-e*l*v)*P,t[7]=(o*d*r-h*l*r+h*i*c-e*d*c-o*i*m+e*l*m)*P,t[8]=M*P,t[9]=(g*f*r-h*y*r-g*n*m+e*y*m+h*n*v-e*f*v)*P,t[10]=(o*y*r-g*a*r+g*n*c-e*y*c-o*n*v+e*a*v)*P,t[11]=(h*a*r-o*f*r-h*n*c+e*f*c+o*n*m-e*a*m)*P,t[12]=A*P,t[13]=(h*y*i-g*f*i+g*n*d-e*y*d-h*n*_+e*f*_)*P,t[14]=(g*a*i-o*y*i-g*n*l+e*y*l+o*n*_-e*a*_)*P,t[15]=(o*f*i-h*a*i+h*n*l-e*f*l-o*n*d+e*a*d)*P,this}scale(t){const e=this.elements,n=t.x,i=t.y,r=t.z;return e[0]*=n,e[4]*=i,e[8]*=r,e[1]*=n,e[5]*=i,e[9]*=r,e[2]*=n,e[6]*=i,e[10]*=r,e[3]*=n,e[7]*=i,e[11]*=r,this}getMaxScaleOnAxis(){const t=this.elements,e=t[0]*t[0]+t[1]*t[1]+t[2]*t[2],n=t[4]*t[4]+t[5]*t[5]+t[6]*t[6],i=t[8]*t[8]+t[9]*t[9]+t[10]*t[10];return Math.sqrt(Math.max(e,n,i))}makeTranslation(t,e,n){return t.isVector3?this.set(1,0,0,t.x,0,1,0,t.y,0,0,1,t.z,0,0,0,1):this.set(1,0,0,t,0,1,0,e,0,0,1,n,0,0,0,1),this}makeRotationX(t){const e=Math.cos(t),n=Math.sin(t);return this.set(1,0,0,0,0,e,-n,0,0,n,e,0,0,0,0,1),this}makeRotationY(t){const e=Math.cos(t),n=Math.sin(t);return this.set(e,0,n,0,0,1,0,0,-n,0,e,0,0,0,0,1),this}makeRotationZ(t){const e=Math.cos(t),n=Math.sin(t);return this.set(e,-n,0,0,n,e,0,0,0,0,1,0,0,0,0,1),this}makeRotationAxis(t,e){const n=Math.cos(e),i=Math.sin(e),r=1-n,o=t.x,a=t.y,l=t.z,c=r*o,h=r*a;return this.set(c*o+n,c*a-i*l,c*l+i*a,0,c*a+i*l,h*a+n,h*l-i*o,0,c*l-i*a,h*l+i*o,r*l*l+n,0,0,0,0,1),this}makeScale(t,e,n){return this.set(t,0,0,0,0,e,0,0,0,0,n,0,0,0,0,1),this}makeShear(t,e,n,i,r,o){return this.set(1,n,r,0,t,1,o,0,e,i,1,0,0,0,0,1),this}compose(t,e,n){const i=this.elements,r=e._x,o=e._y,a=e._z,l=e._w,c=r+r,h=o+o,f=a+a,d=r*c,m=r*h,g=r*f,y=o*h,_=o*f,v=a*f,w=l*c,b=l*h,M=l*f,A=n.x,T=n.y,P=n.z;return i[0]=(1-(y+v))*A,i[1]=(m+M)*A,i[2]=(g-b)*A,i[3]=0,i[4]=(m-M)*T,i[5]=(1-(d+v))*T,i[6]=(_+w)*T,i[7]=0,i[8]=(g+b)*P,i[9]=(_-w)*P,i[10]=(1-(d+y))*P,i[11]=0,i[12]=t.x,i[13]=t.y,i[14]=t.z,i[15]=1,this}decompose(t,e,n){const i=this.elements;let r=il.set(i[0],i[1],i[2]).length();const o=il.set(i[4],i[5],i[6]).length(),a=il.set(i[8],i[9],i[10]).length();this.determinant()<0&&(r=-r),t.x=i[12],t.y=i[13],t.z=i[14],bs.copy(this);const c=1/r,h=1/o,f=1/a;return bs.elements[0]*=c,bs.elements[1]*=c,bs.elements[2]*=c,bs.elements[4]*=h,bs.elements[5]*=h,bs.elements[6]*=h,bs.elements[8]*=f,bs.elements[9]*=f,bs.elements[10]*=f,e.setFromRotationMatrix(bs),n.x=r,n.y=o,n.z=a,this}makePerspective(t,e,n,i,r,o,a=xf){const l=this.elements,c=2*r/(e-t),h=2*r/(n-i),f=(e+t)/(e-t),d=(n+i)/(n-i);let m,g;if(a===xf)m=-(o+r)/(o-r),g=-2*o*r/(o-r);else if(a===CM)m=-o/(o-r),g=-o*r/(o-r);else throw new Error("THREE.Matrix4.makePerspective(): Invalid coordinate system: "+a);return l[0]=c,l[4]=0,l[8]=f,l[12]=0,l[1]=0,l[5]=h,l[9]=d,l[13]=0,l[2]=0,l[6]=0,l[10]=m,l[14]=g,l[3]=0,l[7]=0,l[11]=-1,l[15]=0,this}makeOrthographic(t,e,n,i,r,o,a=xf){const l=this.elements,c=1/(e-t),h=1/(n-i),f=1/(o-r),d=(e+t)*c,m=(n+i)*h;let g,y;if(a===xf)g=(o+r)*f,y=-2*f;else if(a===CM)g=r*f,y=-1*f;else throw new Error("THREE.Matrix4.makeOrthographic(): Invalid coordinate system: "+a);return l[0]=2*c,l[4]=0,l[8]=0,l[12]=-d,l[1]=0,l[5]=2*h,l[9]=0,l[13]=-m,l[2]=0,l[6]=0,l[10]=y,l[14]=-g,l[3]=0,l[7]=0,l[11]=0,l[15]=1,this}equals(t){const e=this.elements,n=t.elements;for(let i=0;i<16;i++)if(e[i]!==n[i])return!1;return!0}fromArray(t,e=0){for(let n=0;n<16;n++)this.elements[n]=t[n+e];return this}toArray(t=[],e=0){const n=this.elements;return t[e]=n[0],t[e+1]=n[1],t[e+2]=n[2],t[e+3]=n[3],t[e+4]=n[4],t[e+5]=n[5],t[e+6]=n[6],t[e+7]=n[7],t[e+8]=n[8],t[e+9]=n[9],t[e+10]=n[10],t[e+11]=n[11],t[e+12]=n[12],t[e+13]=n[13],t[e+14]=n[14],t[e+15]=n[15],t}}const il=new Ks,bs=new pu,_Ut=new Ks(0,0,0),yUt=new Ks(1,1,1),Wr=new Ks,bf=new Ks,ki=new Ks,We={};We.in=0;We.out=1;We.inout=2;const Bs=s=>s.token.data;We.node=function(s){if((s.children[5]!=null?s.children[5].type:void 0)==="function")return We.function(s);if((s.token!=null?s.token.type:void 0)==="keyword")return We.external(s)};We.external=function(s){let t=s.children,e=Bs(t[1]);const n=Bs(t[4]),i=t[5];["attribute","uniform","varying"].includes(e)||(e="global");const r=[];for(let o=0;o<i.children.length;o++)if(t=i.children[o],t.type==="ident"){const a=Bs(t),l=i.children[o+1],c=(l!=null?l.type:void 0)==="quantifier";r.push({decl:"external",storage:e,type:n,ident:a,quant:!!c,count:c})}return r};We.function=function(s){const t=s.children,e=Bs(t[1]),n=Bs(t[4]),i=t[5],r=Bs(i.children[0]),o=i.children[1],a=i.children[2],l=Array.from(o.children).map(c=>We.argument(c));return[{decl:"function",storage:e,type:n,ident:r,body:!!a,args:l}]};We.argument=function(s){const t=s.children,e=Bs(t[1]),n=Bs(t[2]),i=Bs(t[4]),r=t[5],o=Bs(r.children[0]),a=r.children[1],l=a?a.children[0].token.data:void 0;return{decl:"argument",storage:e,inout:n,type:i,ident:o,quant:!!a,count:l}};We.param=function(s,t,e,n,i){let r=[];t!=null&&r.push(t),e!=null&&r.push(e),r.push(""),r=r.join(" ");const o=n?"["+i+"]":"";s!==""&&(s+=" ");const a=(l,c)=>(c?s:"")+`${r}${l}${o}`;return a.split=l=>We.param(l,t,e,n,i),a};const xUt=typeof window<"u",Cc=xUt&&!!window.THREE,bUt={int:0,float:0,vec2:Cc?Uy:null,vec3:Cc?Ks:null,vec4:Cc?Ny:null,mat2:null,mat3:Cc?pp:null,mat4:Cc?pu:null,sampler2D:0,samplerCube:0},wUt={int:"i",float:"f",vec2:"v2",vec3:"v3",vec4:"v4",mat2:"m2",mat3:"m3",mat4:"m4",sampler2D:"t",samplerCube:"t"};We.type=function(s,t,e,n,i,r){const o={in:We.in,out:We.out,inout:We.inout},a={const:"const"};let l=wUt[t];e&&(l+="v");let c=bUt[t];c!=null&&c.call&&(c=new c),e&&(c=[c]);const h=o[i]!=null?o[i]:o.in;r=a[r];const f=We.param(i,r,t,e,n);return new td(s,l,t,f,c,h)};class td{constructor(t,e,n,i,r,o,a){this.name=t,this.type=e,this.spec=n,this.param=i,this.value=r,this.inout=o,this.meta=a}split(){const t=this.meta.shadowed!=null,e=t?"in":"out",n=t?We.in:We.out,i=this.param.split(e);return new td(this.name,this.type,this.spec,i,this.value,n)}copy(t,e){return new td(t??this.name,this.type,this.spec,this.param,this.value,this.inout,e)}}const Fy="_i_o",na="return";let Pl=!1;const MUt=function(s,t){const e=SUt(s,t);return AUt(e,t)},SUt=function(s,t){let e,n,i=[];Pl&&(n=c2());try{const o=G3t(t);e=gUt(o)}catch(o){i=[{message:o}]}Pl&&n("GLSL Tokenize & Parse");const r=function(o){o=o.split(`
`);const a=(""+o.length).length,l=function(c){return(c=""+c).length<a?("       "+c).slice(-a):c};return o.map((c,h)=>`${l(h+1)}: ${c}`).join(`
`)};if(!e||i.length){s||(s="(inline code)"),console.warn(r(t));for(const o of i)console.error(`${s} -`,o.message);throw new Error("GLSL parse error")}return e},AUt=function(s,t){let e;Pl&&(e=c2());const n=[];By(EUt,TUt(n),s,"");const[i,r,o]=Array.from(CUt(n)),a=PUt(i,r,o);return Pl&&e("GLSL AST"),{ast:s,code:t,signatures:a}},EUt=function(s,t){switch(s.type){case"decl":return t(We.node(s)),!1}return!0},TUt=s=>function(t){t!=null&&Array.from(t).map(e=>s.push(e))},CUt=function(s){let t=null;const e=[];let n=[];const i={};let r=!1;for(const o of Array.from(s))o.body?(i[o.ident]&&(n=Array.from(n).filter(a=>a.ident!==o.ident),delete i[o.ident]),e.push(o),o.ident==="main"?(t=o,r=!0):r||(t=o)):o.storage==="global"?e.push(o):(n.push(o),i[o.ident]=!0);return[t,e,n]},PUt=function(s,t,e){let n;const i={uniform:[],attribute:[],varying:[],external:[],internal:[],global:[],main:null},r=a=>We.type(a.ident,a.type,a.quant,a.count,a.inout,a.storage),o=function(a,l){let c;const h=Array.from(a.args).map(g=>r(g));for(c of Array.from(h))if(c.inout===We.inout){const g=c,y=c.copy();g.inout=We.in,y.inout=We.out,y.meta={shadow:g.name},y.name+=Fy,g.meta={shadowed:y.name},h.push(y)}a.type!=="void"&&h.unshift(We.type(na,a.type,!1,"","out"));const f=(()=>{const g=[];for(c of Array.from(h))c.inout===We.in&&g.push(c.type);return g})().join(","),d=(()=>{const g=[];for(c of Array.from(h))c.inout===We.out&&g.push(c.type);return g})().join(","),m=`(${f})(${d})`;return{name:a.ident,type:m,signature:h,inout:l,spec:a.type}};i.main=o(s,We.out);for(n of Array.from(t))i.internal.push({name:n.ident});for(n of Array.from(e)){let a;switch(n.decl){case"external":a=r(n),i[n.storage].push(a);break;case"function":a=o(n,We.in),i.external.push(a);break}}return i};Pl=!1;const By=function(s,t,e,n){if(Pl&&console.log(n,e.type,e.token!=null?e.token.data:void 0,e.token!=null?e.token.type:void 0),s(e,t))for(let r=0;r<e.children.length;r++){const o=e.children[r];By(s,t,o,n+"  ")}return null},c2=function(){const s=+new Date;return function(t){const e=+new Date-s;return console.log(t,e+" ms"),e}};function RUt(s){const t=s.replace(Fy,"");return t!==s?t:null}function u2(s){return s.join(`
`)}function Hy(s){return s.join(", ")}function ed(s){return s.join(`;
`)}function Dv(s){return{entry:s,type:"void",params:[],signature:[],return:"",vars:{},calls:[],post:[],chain:{}}}function Vy(s,t){return`#define ${s} ${t}`}function h2(s,t,e,n,i){return`${s} ${t}(${e}) {
${n}${i}}`}function f2(s,t,e){return s=s?`${s} = `:"",e=Hy(e),`  ${s}${t}(${e})`}function Gy(s,t){for(let e=0;e<s.length;e++){const n=s[e],i=t[e];if(!i||n.type!==i.type||n.name===na!=(i.name===na))return!1}return!0}function Iv(s,t,e,n,i){const r=[];let o="";for(let a of Array.from(n)){let l,c;const{name:h}=a;let f=l=s(h),d=null,m=null,g=!1;const y=h===na;if((c=a.meta!=null?a.meta.shadowed:void 0)&&(d=s(c),d&&(i.vars[d]="  "+a.param(d),i.calls.push(`  ${d} = ${l}`),t(c)?m={shadowed:d}:a=a.split())),(c=a.meta!=null?a.meta.shadow:void 0)&&(d=s(c),d))if(!t(c))a=a.split(),g=!0;else{m={shadow:d};continue}if(y?o=l:g||r.push(d??l),t(h)){let _="push";y?i.return===""?(_="unshift",f=h,i.type=a.spec,i.return=`  return ${l}`,i.vars[l]="  "+a.param(l)):(i.vars[l]="  "+a.param(l),i.params.push(a.param(l,!0))):i.params.push(a.param(l,!0)),a=a.copy(f,m),i.signature[_](a)}else i.vars[l]="  "+a.param(l)}return i.calls.push(f2(o,e,r))}function Ov(s,t){const{entry:e}=s;let n=null;if(t&&t.length===1&&e!=="main"){const i=t[0].module;Gy(s.signature,i.main.signature)&&(n=Vy(e,i.entry))}if(n==null){let i=(()=>{const c=[];for(const h in s.vars){const f=s.vars[h];c.push(f)}return c})();({calls:t}=s);const{post:r}=s;let{params:o}=s;const{type:a}=s,l=s.return;t=t.concat(r),l!==""&&t.push(l),t.push(""),i.length?(i.push(""),i=ed(i)+`
`):i="",t=ed(t),o=Hy(o),n=h2(a,e,o,i,t)}return{signature:s.signature,code:n,name:e}}function LUt(s){const t={defs:[],bodies:[]};for(const e of Array.from(s))d2(e,t);return t.defs=u2(t.defs),t.bodies=ed(t.bodies),t.defs===""&&delete t.defs,t.bodies===""&&delete t.bodies,t}const d2=(s,t)=>{let e,n;const{module:i,name:r,external:o}=s,{main:a}=i,{entry:l}=i;if(Gy(a.signature,o.signature))return t.defs.push(Vy(r,l));const c=[],h=[];let f={};const d=[i.namespace,na].join("");for(e of Array.from(o.signature))n=e.inout===hu?c:h,n.push(e);for(e of Array.from(a.signature)){n=e.inout===hu?c:h;let w=n.shift().name;w===na&&(w=d),f[e.name]=w}let m=v=>f[v];const g=()=>!0,y=Dv();Iv(m,g,l,a.signature,y),y.entry=l,f={return:d},m=v=>f[v]!=null?f[v]:v;const _=Dv();return Iv(m,g,l,o.signature,_),_.calls=y.calls,_.entry=r,t.bodies.push(Ov(y).code.split(" {")[0]),t.bodies.push(Ov(_).code)};function DUt(s){const t=/([A-Za-z0-9_]+\s+)?[A-Za-z0-9_]+\s+[A-Za-z0-9_]+\s*\([^)]*\)\s*;\s*/gm,e=r=>r.replace(t,o=>""),n=s.split(/(?=[{}])/g);let i=0;for(let r=0;r<n.length;r++){const o=n[r];switch(o[0]){case"{":i++;break;case"}":i--;break}if(i===0){const a=o.split(/^[ \t]*#/m);for(let l=0;l<a.length;l++){let c=a[l];if(l>0){c=c.split(/\n/);const h=c.shift(),f=c.join(`
`);a[l]=[h,e(f)].join(`
`)}else a[l]=e(c)}n[r]=a.join("#")}}return s=n.join("")}function IUt(s){const t={},e=/((attribute|uniform|varying)\s+)[A-Za-z0-9_]+\s+([A-Za-z0-9_]+)\s*(\[[^\]]*\]\s*)?;\s*/gm;return s.replace(e,function(n,i,r,o,a){return t[o]?"":(t[o]=!0,n)})}function OUt(s){const t=function(n,i){const r=[],o=[];for(const a of Array.from(n))(a.match(i)?r:o).push(a);return r.concat(o)};let e=s.split(`
`);return e=t(e,/^#define ([^ ]+ _pg_[0-9]+_|_pg_[0-9]+_ [^ ]+)$/),e=t(e,/^#extension/),e.join(`
`)}const zv=Object.freeze(Object.defineProperty({__proto__:null,RETURN_ARG:na,SHADOW_ARG:Fy,body:Dv,build:Ov,call:Iv,compile:w3t,dedupe:IUt,define:Vy,defuse:DUt,fn:h2,hoist:OUt,invoke:f2,lines:u2,link:d2,links:LUt,list:Hy,parse:MUt,same:Gy,statements:ed,unshadow:RUt,walk:By},Symbol.toStringTag,{value:"Module"})),{library:zUt,cache:kUt}=n2,{visualize:UUt,inspect:p2}=JC,{Snippet:NUt}=jC,PM=function(s,t={}){const e={};for(let n in s)e[n]=t[n]||s[n];return e};class Xs{constructor(t,e){const n={globalUniforms:!1,globalVaryings:!0,globalAttributes:!0,globals:[],autoInspect:!1};this.config=PM(n,e),this.fetch=kUt(zUt(zv,t,NUt.load))}shader(t){t==null&&(t={});const e=PM(this.config,t);return new QC(zv,this.fetch,e)}material(t){return new t2(this.shader(t),this.shader(t))}inspect(t){return Xs.inspect(t)}visualize(t){return Xs.visualize(t)}static inspect(t){return p2(t)}static visualize(t){return UUt(t)}}Xs.Block=Fs;Xs.Factory=n2;Xs.GLSL=zv;Xs.Graph=n3t;Xs.Linker=jC;Xs.Visualize=JC;function FUt(s,t={}){return new Xs(s,t)}const m2=function(s){function t(e){const n=s[e];if(n!=null)return n;const r=["#",".",":","["].includes(e[0])?e:`#${e}`,o=document.querySelector(r);if(o!=null&&o.tagName==="SCRIPT")return o.textContent||o.innerText;throw new Error(`Unknown shader \`${e}\``)}return FUt(t,{autoInspect:!0})},g2={"arrow.position":JOt,"axis.position":QOt,"cartesian.position":ezt,"cartesian4.position":tzt,"clamp.position":nzt,"color.opaque":izt,"face.position":szt,"face.position.normal":rzt,"float.encode":ozt,"float.index.pack":azt,"float.stretch":lzt,"fragment.clip.dashed":czt,"fragment.clip.dotted":uzt,"fragment.clip.ends":hzt,"fragment.clip.proximity":fzt,"fragment.color":dzt,"fragment.map.rgba":pzt,"fragment.solid":mzt,"fragment.transparent":gzt,"grid.position":vzt,"grow.position":_zt,"join.position":yzt,"label.alpha":xzt,"label.map":bzt,"label.outline":wzt,"layer.position":Mzt,"lerp.depth":Szt,"lerp.height":Azt,"lerp.items":Ezt,"lerp.width":Tzt,"line.position":Czt,"map.2d.data":Pzt,"map.2d.data.wrap":Rzt,"map.xyzw.2dv":Lzt,"map.xyzw.align":Dzt,"map.xyzw.texture":Izt,"mesh.fragment.color":Ozt,"mesh.fragment.map":zzt,"mesh.fragment.mask":kzt,"mesh.fragment.material":Uzt,"mesh.fragment.shaded":Nzt,"mesh.fragment.texture":Fzt,"mesh.gamma.in":Bzt,"mesh.gamma.out":Hzt,"mesh.map.uvwo":Vzt,"mesh.position":Gzt,"mesh.vertex.color":qzt,"mesh.vertex.mask":Wzt,"mesh.vertex.position":$zt,"move.position":Xzt,"object.mask.default":jzt,"point.alpha.circle":Yzt,"point.alpha.circle.hollow":Zzt,"point.alpha.generic":Kzt,"point.alpha.generic.hollow":Jzt,"point.edge":Qzt,"point.fill":tkt,"point.mask.circle":ekt,"point.mask.diamond":nkt,"point.mask.down":ikt,"point.mask.left":skt,"point.mask.right":rkt,"point.mask.square":okt,"point.mask.up":akt,"point.position":lkt,"point.size.uniform":ckt,"point.size.varying":ukt,"polar.position":hkt,"project.position":fkt,"project.readback":dkt,"raw.position.scale":pkt,"repeat.position":mkt,"resample.padding":gkt,"resample.relative":vkt,"reveal.mask":_kt,"reverse.position":ykt,"root.position":xkt,"sample.2d":bkt,"scale.position":wkt,"screen.map.stpq":Mkt,"screen.map.xy":Skt,"screen.map.xyzw":Akt,"screen.pass.uv":Ekt,"screen.position":Tkt,"slice.position":Ckt,"spherical.position":Pkt,"split.position":Rkt,"spread.position":Lkt,"sprite.fragment":Dkt,"sprite.position":Ikt,"stereographic.position":zkt,"stereographic4.position":Okt,"stpq.sample.2d":kkt,"stpq.xyzw.2d":Ukt,"strip.position.normal":Nkt,"style.color":Fkt,"subdivide.depth":Bkt,"subdivide.depth.lerp":Hkt,"subdivide.height":Vkt,"subdivide.height.lerp":Gkt,"subdivide.items":qkt,"subdivide.items.lerp":Wkt,"subdivide.width":$kt,"subdivide.width.lerp":Xkt,"surface.mask.hollow":jkt,"surface.position":Ykt,"surface.position.normal":Zkt,"surface.position.shaded":Kkt,"ticks.position":Jkt,"transform3.position":Qkt,"transform4.position":t3t,"view.position":e3t},BUt=Object.freeze(Object.defineProperty({__proto__:null,Factory:m2,Snippets:g2},Symbol.toStringTag,{value:"Module"}));class v2{constructor(t){this.context=t,this.anims=[]}make(t,e){const n=new HUt(this,this.context.time,t,e);return this.anims.push(n),n}unmake(t){return this.anims=Array.from(this.anims).filter(e=>e!==t)}update(){const{time:t}=this.context;return this.anims=(()=>{const e=[];for(const n of Array.from(this.anims))n.update(t)!==!1&&e.push(n);return e})()}lerp(t,e,n,i,r){if(r==null&&(r=t.make()),t.lerp)r=t.lerp(e,n,r,i);else if(t.emitter){const o=e.emitterFrom,a=n.emitterTo;if(o!=null&&a!=null&&o===a)return o.lerp(i),o;{const l=t.emitter(e,n);return e.emitterFrom=l,n.emitterTo=l,l.lerp(i),l}}else if(t.op){const o=function(a,l){return a===+a&&l===+l?a+(l-a)*i:i>.5?l:a};r=t.op(e,n,r,o)}else r=i>.5?n:e;return r}}class HUt{constructor(t,e,n,i){this.animator=t,this.time=e,this.type=n,this.options=i,this.value=this.type.make(),this.target=this.type.make(),this.queue=[]}dispose(){return this.animator.unmake(this)}set(){let{target:t}=this,e=arguments.length>1?[].slice.call(arguments):arguments[0],n=!1;return e=this.type.validate(e,t,()=>n=!0),n||(t=e),this.cancel(),this.target=this.value,this.value=t,this.notify()}getTime(){const{clock:t}=this.options,e=t?t.getTime():this.time;return this.options.realtime?e.time:e.clock}cancel(t){let e;t==null&&(t=this.getTime());const{queue:n}=this,i=(()=>{const r=[];for(e of Array.from(n))e.end>=t&&r.push(e);return r})();this.queue=(()=>{const r=[];for(e of Array.from(n))e.end<t&&r.push(e);return r})();for(e of Array.from(i))typeof e.complete=="function"&&e.complete(!1);typeof this.options.complete=="function"&&this.options.complete(!1)}notify(){return typeof this.options.step=="function"?this.options.step(this.value):void 0}immediate(t,e){const{duration:n,delay:i,ease:r,step:o,complete:a}=e,c=this.getTime()+i,h=c+n;let f=!1,d=this.type.make();return t=this.type.validate(t,d,function(){return f=!0,null}),t!==void 0&&!f&&(d=t),this.cancel(c),this.queue.push({from:null,to:d,start:c,end:h,ease:r,step:o,complete:a})}update(t){if(this.time=t,this.queue.length===0)return!0;const e=this.getTime();let{value:n}=this;const{queue:i}=this;let r=!1;for(;!r;){const o=i[0];let{from:a}=o;const{to:l,start:c,end:h,step:f,complete:d,ease:m}=o;a==null&&(a=o.from=this.type.clone(this.value));let g=lp((e-c)/Math.max(1e-5,h-c)||0,0,1);if(g===0)return;const y=(()=>{switch(m){case"linear":case 0:return null;case"cosine":case 1:return uu;case"binary":case 2:return Ay;case"hold":case 3:return Ey;default:return uu}})();if(y!=null&&(g=y(g)),r=g<1,n=r?this.animator.lerp(this.type,a,l,g,n):l,typeof f=="function"&&f(n),!r&&(typeof d=="function"&&d(!0),typeof this.options.complete=="function"&&this.options.complete(!0),i.shift(),i.length===0))break}return this.value=n,this.notify()}}class mp{v2(){return this}constructor(t,e,n){this._context=t,this._up=e,this._targets=n;const i=this._context.controller.getRoot();this._targets==null&&(this._targets=[i]),this.isRoot=this._targets.length===1&&this._targets[0]===i,this.isLeaf=this._targets.length===1&&this._targets[0].children==null;for(let r=0;r<this._targets.length;r++){const o=this._targets[r];this[r]=o}this.length=this._targets.length;for(const r of Array.from(this._context.controller.getTypes()))["root"].includes(r)||(this[r]=(o,a)=>this.add(r,o,a))}select(t){const e=this._context.model.select(t,this.isRoot?null:this._targets);return this._push(e)}eq(t){return this._targets.length>t?this._push([this._targets[t]]):this._push([])}filter(t){if(typeof t=="string"){const e=this._context.model._matcher(t);t=n=>e(n)}return this._push(this._targets.filter(t))}map(t){return VUt(0,this.length,!1).map(e=>t(this[e],e,this))}each(t){for(let e=0,n=this.length,i=0<=n;i?e<n:e>n;i?e++:e--)t(this[e],e,this);return this}add(t,e,n){const{controller:i}=this._context;if(this.isLeaf)return this._pop().add(t,e,n);const r=[];for(const o of this._targets){const a=i.make(t,e,n);i.add(a,o),r.push(a)}return this._push(r)}remove(t){if(t)return this.select(t).remove();for(const e of Array.from(this._targets.slice().reverse()))this._context.controller.remove(e);return this._pop()}set(t,e){for(const n of Array.from(this._targets))this._context.controller.set(n,t,e);return this}getAll(t){return Array.from(this._targets).map(e=>this._context.controller.get(e,t))}get(t){return this._targets[0]!=null?this._targets[0].get(t):void 0}evaluate(t,e){return this._targets[0]!=null?this._targets[0].evaluate(t,e):void 0}bind(t,e){for(const n of Array.from(this._targets))this._context.controller.bind(n,t,e);return this}unbind(t){for(const e of Array.from(this._targets))this._context.controller.unbind(e,t);return this}end(){return(this.isLeaf?this._pop():this)._pop()}_push(t){return new mp(this._context,this,t)}_pop(){return this._up!=null?this._up:this}_reset(){let t;return(t=this._up!=null?this._up.reset():void 0)!=null?t:this}map(t){return this._targets.map(t)}on(){const t=arguments;return this._targets.map(e=>e.on.apply(e,t)),this}off(){const t=arguments;return this._targets.map(e=>e.off.apply(e,t)),this}toString(){const t=this._targets.map(e=>e.toString());return this._targets.length>1?`[${t.join(", ")}]`:t[0]}toMarkup(){return this._targets.map(e=>e.toMarkup()).join(`

`)}print(){return W_(this._targets.map(t=>t.toMarkup()).join(`

`)),this}debug(){const t=this.inspect();console.log("Renderables: ",t.renderables),console.log("Renders: ",t.renders),console.log("Shaders: ",t.shaders);const e=i=>i.constructor.name,n=[];for(const i of Array.from(t.shaders)){const r=e(i.owner);n.push(`${r} - Vertex`),n.push(i.vertex),n.push(`${r} - Fragment`),n.push(i.fragment)}return p2(n)}inspect(t,e,n){let i;typeof e=="boolean"&&(n=e,e=null),n==null&&(n=!0);const r=h=>(h.controller!=null?h.controller.objects:void 0)!=null?h.controller!=null?h.controller.objects:void 0:[],o=i=function(h,f){if(f==null&&(f=[]),(!e||h.traits.hash[e])&&f.push(r(h)),h.children!=null)for(const d of Array.from(h.children))i(d,f);return f},a=function(h){return h=h.reduce((f,d)=>f.concat(d),[]),h=h.filter((f,d)=>f!=null&&h.indexOf(f)===d)},l=function(h,f){const d={};return d.owner=h,d.geometry=f.geometry,d.material=f.material,d.vertex=f.userData.vertexGraph,d.fragment=f.userData.fragmentGraph,d},c={nodes:this._targets.slice(),renderables:[],renders:[],shaders:[]};for(const h of Array.from(this._targets)){let f;n&&h.print(t,"info");const d={renderables:f=a(o(h)),renders:a(f.map(m=>m.renders)),shaders:a(f.map(m=>m.renders!=null?m.renders.map(g=>l(m,g)):void 0))};for(const m in d)c[m]=c[m].concat(d[m])}return c}}function VUt(s,t,e){const n=[],i=s<t,r=e?i?t+1:t-1:t;for(let o=s;i?o<r:o>r;i?o++:o--)n.push(o);return n}class _2{constructor(t,e){this.model=t,this.primitives=e}getRoot(){return this.model.getRoot()}getTypes(){return this.primitives.getTypes()}make(t,e,n){return this.primitives.make(t,e,n)}get(t,e){return t.get(e)}set(t,e,n){try{return t.set(e,n)}catch(i){return t.print(null,"warn"),console.error(i)}}bind(t,e,n){try{return t.bind(e,n)}catch(i){return t.print(null,"warn"),console.error(i)}}unbind(t,e){try{return t.unbind(e)}catch(n){return t.print(null,"warn"),console.error(n)}}add(t,e){return e==null&&(e=this.model.getRoot()),e.add(t)}remove(t){const e=t.parent;if(e)return e.remove(t)}}const GUt=Object.freeze(Object.defineProperty({__proto__:null,API:mp,Animator:v2,Controller:_2},Symbol.toStringTag,{value:"Module"})),qUt=iOt,WUt=xAt,$Ut=lOt,XUt=wAt,jUt=rOt,YUt=HV,ZUt=yAt,KUt=xOt,y2=gAt,JUt=Object.freeze(Object.defineProperty({__proto__:null,Axis:qUt,Data:WUt,Ease:$Ut,GLSL:XUt,JS:jUt,Pretty:YUt,Three:ZUt,Ticks:KUt,VDOM:y2},Symbol.toStringTag,{value:"Module"}));let qy=class{static initClass(){this.Namespace={Model:uAt,Overlay:vAt,Primitives:SOt,Render:KOt,Shaders:BUt,Stage:GUt,Util:JUt,DOM:y2},this.Version="2.3.1"}constructor(t,e=null,n=null){let i;this.canvas=i=t.domElement,this.element=null,this.shaders=m2(g2),this.renderables=new UC(qC,t,this.shaders),this.overlays=new zE(HE,i),this.scene=this.renderables.make("scene",{scene:e}),this.camera=this.defaultCamera=n??new nn,this.attributes=new IA(Mv,this),this.primitives=new zC(Mv,this),this.root=this.primitives.make("root"),this.model=new OE(this.root),this.guard=new NA,this.controller=new _2(this.model,this.primitives),this.animator=new v2(this),this.api=new mp(this),this.speed=1,this.time={now:+new Date/1e3,time:0,delta:0,clock:0,step:0}}init(){return this.scene.inject(),this.overlays.inject(),this}destroy(){return this.scene.unject(),this.overlays.unject(),this}resize(t){return t==null&&(t={}),t.renderWidth==null&&(t.renderWidth=t.viewWidth!=null?t.viewWidth:t.viewWidth=1280),t.renderHeight==null&&(t.renderHeight=t.viewHeight!=null?t.viewHeight:t.viewHeight=720),t.pixelRatio==null&&(t.pixelRatio=t.renderWidth/Math.max(1e-6,t.viewWidth)),t.aspect==null&&(t.aspect=t.viewWidth/Math.max(1e-6,t.viewHeight)),this.root.controller.resize(t),this}frame(t){return this.pre(t),this.update(),this.render(),this.post(),this}pre(t){return t||(t={now:+new Date/1e3,time:0,delta:0,clock:0,step:0},t.delta=this.time.now!=null?t.now-this.time.now:0,t.delta>1&&(t.delta=1/60),t.step=t.delta*this.speed,t.time=this.time.time+t.delta,t.clock=this.time.clock+t.step),this.time=t,typeof this.root.controller.pre=="function"&&this.root.controller.pre(),this}update(){return this.animator.update(),this.attributes.compute(),this.guard.iterate({step:()=>{let t=this.attributes.digest();return t||(t=this.model.digest())},last(){return{attribute:this.attributes.getLastTrigger(),model:this.model.getLastTrigger()}}}),typeof this.root.controller.update=="function"&&this.root.controller.update(),this.camera=this.root.controller.getCamera(),this.speed=this.root.controller.getSpeed(),this}render(){return typeof this.root.controller.render=="function"&&this.root.controller.render(),this.scene.render(),this}post(){return typeof this.root.controller.post=="function"&&this.root.controller.post(),this}setWarmup(t){return this.scene.warmup(t),this}getPending(){return this.scene.pending.length}};qy.initClass();const x2=qy,RM=qy.Version;Ue.registerPlugin("mathbox",{defaults:{init:!0,warmup:2,inspect:!0,splash:!0},listen:["ready","pre","update","post","resize"],install(s){let t=!1;return this.first=!0,s.MathBox={init:e=>{if(t)return;t=!0;const n=(e!=null?e.scene:void 0)||this.options.scene||s.scene,i=(e!=null?e.camera:void 0)||this.options.camera||s.camera;this.context=new x2(s.renderer,n,i),this.context.api.three=s.three=s,this.context.api.mathbox=s.mathbox=this.context.api,this.context.api.start=()=>s.Loop.start(),this.context.api.stop=()=>s.Loop.stop(),this.context.init(),this.context.resize(s.Size),this.context.setWarmup(this.options.warmup),this.pending=0,this.warm=!this.options.warmup,console.log("MathBox²",RM),s.trigger({type:"mathbox/init",version:RM,context:this.context})},destroy:()=>{t&&(t=!1,s.trigger({type:"mathbox/destroy",context:this.context}),this.context.destroy(),delete s.mathbox,delete this.context.api.three,delete this.context)},object:()=>this.context!=null?this.context.scene.root:void 0}},uninstall(s){s.MathBox.destroy(),delete s.MathBox},ready(s,t){if(this.options.init)return t.MathBox.init(),setTimeout(()=>{if(this.options.inspect&&t.MathBox)return this.inspect(t)})},inspect(s){if(this.context.api.inspect(),!this.options.warmup)return this.info(s)},info(s){const t=function(n){const i=[];for(;n>=1e3;)i.unshift(("000"+n%1e3).slice(-3)),n=Math.floor(n/1e3);return i.unshift(n),i.join(",")},e=s.renderer.info.render;console.log("Geometry  ",t(e.triangles)+" triangles  ",t(e.points)+" points  ",t(e.lines)+" lines  ",t(e.calls)+" draw calls  ")},resize(s,t){return this.context!=null?this.context.resize(t.Size):void 0},pre(s,t){return this.context!=null?this.context.pre(t.Time):void 0},update(s,t){let e;return this.context!=null&&this.context.update(),(e=this.context!=null?this.context.camera:void 0)&&e!==t.camera&&(t.camera=e),t.Time.set({speed:this.context.speed}),this.progress(this.context.getPending(),t),this.context!=null?this.context.render():void 0},post(s,t){return this.context!=null?this.context.post():void 0},progress(s,t){if(!s&&!this.pending)return;let e=Math.max(s+this.options.warmup,this.pending);const n=e-s,i=e;t.trigger({type:"mathbox/progress",current:e-s,total:e}),s===0&&(e=0),this.pending=e,n===i&&!this.warm&&(this.warm=!0,this.options.inspect&&this.info(t))}});function QUt(s,t,e){let{view:n}=t,{dim:i}=t,{axisColor:r="#3f3f46"}=t,{gridColor:o="#262626"}=t,{axisWidth:a=2}=t,{gridWidth:l=1}=t,{opacity:c=1}=t;return n.axis({axis:1,width:a,color:r,opacity:c}).axis({axis:2,width:a,color:r,opacity:c}).grid({width:l,divideX:i,divideY:i,color:o,opacity:c}),s.$$set=h=>{"view"in h&&e(0,n=h.view),"dim"in h&&e(1,i=h.dim),"axisColor"in h&&e(2,r=h.axisColor),"gridColor"in h&&e(3,o=h.gridColor),"axisWidth"in h&&e(4,a=h.axisWidth),"gridWidth"in h&&e(5,l=h.gridWidth),"opacity"in h&&e(6,c=h.opacity)},[n,i,r,o,a,l,c]}class tNt extends Xi{constructor(t){super(),ji(this,t,QUt,null,$i,{view:0,dim:1,axisColor:2,gridColor:3,axisWidth:4,gridWidth:5,opacity:6})}}function eNt(s){let t,e;return t=new tNt({props:{view:s[0],dim:Ic}}),{c(){xi(t.$$.fragment)},l(n){bi(t.$$.fragment,n)},m(n,i){wi(t,n,i),e=!0},p:gl,i(n){e||($e(t.$$.fragment,n),e=!0)},o(n){Ye(t.$$.fragment,n),e=!1},d(n){Mi(t,n)}}}const Ic=15;function nNt(s,t,e){let{mathbox:n}=t;n.set("focus",1.2);const i=[[-Ic,Ic],[-Ic,Ic]],r=n.cartesian({range:i});return s.$$set=o=>{"mathbox"in o&&e(1,n=o.mathbox)},[r,n]}class iNt extends Xi{constructor(t){super(),ji(this,t,nNt,eNt,$i,{mathbox:1})}}function sNt(s){let t,e;return t=new EV({props:{enableDamping:!0}}),{c(){xi(t.$$.fragment)},l(n){bi(t.$$.fragment,n)},m(n,i){wi(t,n,i),e=!0},p:gl,i(n){e||($e(t.$$.fragment,n),e=!0)},o(n){Ye(t.$$.fragment,n),e=!1},d(n){Mi(t,n)}}}function rNt(s){let t,e,n,i;return t=new RA.PerspectiveCamera({props:{makeDefault:!0,position:[0,0,1.2],$$slots:{default:[sNt]},$$scope:{ctx:s}}}),n=new iNt({props:{mathbox:s[2]}}),{c(){xi(t.$$.fragment),e=Uv(),xi(n.$$.fragment)},l(r){bi(t.$$.fragment,r),e=Nv(r),bi(n.$$.fragment,r)},m(r,o){wi(t,r,o),Yo(r,e,o),wi(n,r,o),i=!0},p(r,[o]){const a={};o&256&&(a.$$scope={dirty:o,ctx:r}),t.$set(a)},i(r){i||($e(t.$$.fragment,r),$e(n.$$.fragment,r),i=!0)},o(r){Ye(t.$$.fragment,r),Ye(n.$$.fragment,r),i=!1},d(r){r&&Fe(e),Mi(t,r),Mi(n,r)}}}function oNt(s,t,e){let n,i;const{size:r,scene:o,camera:a,renderer:l}=Nl();no(s,r,f=>e(3,n=f)),no(s,a,f=>e(4,i=f));const c=new x2(l,o,i).init(),h=c.api;return LA(()=>{c.frame()}),nd(()=>{c.resize({viewWidth:n.width,viewHeight:n.height})}),[r,a,h]}class aNt extends Xi{constructor(t){super(),ji(this,t,oNt,rNt,$i,{})}}function lNt(s){let t,e;return t=new aNt({}),{c(){xi(t.$$.fragment)},l(n){bi(t.$$.fragment,n)},m(n,i){wi(t,n,i),e=!0},i(n){e||($e(t.$$.fragment,n),e=!0)},o(n){Ye(t.$$.fragment,n),e=!1},d(n){Mi(t,n)}}}function cNt(s){let t,e;return t=new dV({props:{colorManagementEnabled:!1,rendererParameters:{webgl1:!0},$$slots:{default:[lNt]},$$scope:{ctx:s}}}),{c(){xi(t.$$.fragment)},l(n){bi(t.$$.fragment,n)},m(n,i){wi(t,n,i),e=!0},p(n,[i]){const r={};i&1&&(r.$$scope={dirty:i,ctx:n}),t.$set(r)},i(n){e||($e(t.$$.fragment,n),e=!0)},o(n){Ye(t.$$.fragment,n),e=!1},d(n){Mi(t,n)}}}class uNt extends Xi{constructor(t){super(),ji(this,t,null,cNt,$i,{})}}function hNt(s){let t,e,n;return e=new uNt({}),{c(){t=ln("div"),xi(e.$$.fragment),this.h()},l(i){t=cn(i,"DIV",{class:!0});var r=IM(t);bi(e.$$.fragment,r),r.forEach(Fe),this.h()},h(){Zt(t,"class","wrapper svelte-i6dxo4")},m(i,r){Yo(i,t,r),wi(e,t,null),n=!0},p:gl,i(i){n||($e(e.$$.fragment,i),n=!0)},o(i){Ye(e.$$.fragment,i),n=!1},d(i){i&&Fe(t),Mi(e)}}}class fNt extends Xi{constructor(t){super(),ji(this,t,null,hNt,$i,{})}}const dNt="Title TK",pNt="Description tk.",LM={title:dNt,description:pNt};function mNt(){console.log("--- --- --- --- --- ---"),console.log("svelte-starter: 5.11.2"),console.log("build: 2023-07-25-12:19"),console.log("--- --- --- --- --- ---")}function gNt(s){let t,e,n,i;return t=new Rz({props:{title:s[1],description:s[2],url:s[3],preloadFont:s[0],keywords:s[4]}}),n=new fNt({}),{c(){xi(t.$$.fragment),e=Uv(),xi(n.$$.fragment)},l(r){bi(t.$$.fragment,r),e=Nv(r),bi(n.$$.fragment,r)},m(r,o){wi(t,r,o),Yo(r,e,o),wi(n,r,o),i=!0},p:gl,i(r){i||($e(t.$$.fragment,r),$e(n.$$.fragment,r),i=!0)},o(r){Ye(t.$$.fragment,r),Ye(n.$$.fragment,r),i=!1},d(r){r&&Fe(e),Mi(t,r),Mi(n,r)}}}function vNt(s,t,e){let{data:n}=t;mNt();const i=["https://pudding.cool/assets/fonts/tiempos/TiemposTextWeb-Regular.woff2","https://pudding.cool/assets/fonts/tiempos/TiemposTextWeb-Bold.woff2","https://pudding.cool/assets/fonts/national/National2Web-Regular.woff2","https://pudding.cool/assets/fonts/national/National2Web-Bold.woff2"],{title:r,description:o,url:a,keywords:l}=LM;return As("copy",LM),As("data",n.data),s.$$set=c=>{"data"in c&&e(5,n=c.data)},[i,r,o,a,l,n]}class tFt extends Xi{constructor(t){super(),ji(this,t,vNt,gNt,$i,{data:5})}}export{tFt as component};
